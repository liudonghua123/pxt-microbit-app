!function e(t,i,n){function s(r,a){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(o)return o(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[r]={exports:{}};t[r][0].call(u.exports,(function(e){return s(t[r][1][e]||e)}),u,u.exports,e,t,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BlockDragger=void 0;const n=e("blockly");class s extends n.dragging.Dragger{onDrag(e,t){super.onDrag(e,t);const i=document.getElementsByClassName("blocklyToolboxDiv")[0],n=document.getElementsByClassName("blocklyTreeRoot")[0]||document.getElementsByClassName("blocklyFlyout")[0],s=document.getElementById("blocklyTrashIcon");if(n&&s){const t=function(e,t){return Math.abs(t-(e.left+e.width/2))}(n.getBoundingClientRect(),e.clientX);if(t<200){const e=t/200;s.style.opacity=""+(1-e),s.style.display="block",i&&(n.style.opacity=`${e}`,t<50&&pxt.BrowserUtils.addClass(i,"blocklyToolboxDeleting"))}else s.style.display="none",n.style.opacity="1",i&&pxt.BrowserUtils.removeClass(i,"blocklyToolboxDeleting")}}onDragEnd(e){super.onDragEnd(e);const t=document.getElementsByClassName("blocklyToolboxDiv")[0],i=document.getElementsByClassName("blocklyTreeRoot")[0]||document.getElementsByClassName("blocklyFlyout")[0],n=document.getElementById("blocklyTrashIcon");n&&i&&(n.style.display="none",i.style.opacity="1",t&&pxt.BrowserUtils.removeClass(t,"blocklyToolboxDeleting"))}}i.BlockDragger=s},{blockly:207}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BreakpointIcon=void 0;const n=e("blockly");class s extends n.icons.Icon{constructor(e,t){super(e),this.onStateChange=t,this.isSet_=!1}getType(){return s.type}initView(e){super.initView(e),this.breakpointSvg||(this.breakpointSvg=n.utils.dom.createSvgElement("circle",{class:"blocklyBreakpointSymbol",stroke:"white","stroke-width":2,cx:7,cy:11.5,r:8},this.svgRoot),this.updateColor())}getSize(){return new n.utils.Size(25,25)}onClick(){this.isSet_=!this.isSet_,this.updateColor(),this.onStateChange(this.sourceBlock,this.isSet_)}isEnabled(){return this.isSet_}setEnabled(e){this.isSet_=e,this.updateColor()}updateColor(){this.breakpointSvg&&this.breakpointSvg.setAttribute("fill",this.isSet_?"#FF0000":"#CCCCCC")}}i.BreakpointIcon=s,s.type=new n.icons.IconType("breakpoint")},{blockly:207}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initFunctions=void 0;const n=e("blockly"),s=e("../help"),o=e("../plugins/functions"),r=e("../toolbox"),a=e("../fields"),l=e("../loader"),c=e("../importer"),u=e("../plugins/duplicateOnDrag");i.initFunctions=function(){const e=n.Msg;e.FUNCTION_CREATE_NEW=lf("Make a Function..."),e.FUNCTION_WARNING_DUPLICATE_ARG=lf("Functions cannot use the same argument name more than once."),e.FUNCTION_WARNING_ARG_NAME_IS_FUNCTION_NAME=lf("Argument names must not be the same as the function name."),e.FUNCTION_WARNING_EMPTY_NAME=lf("Function and argument names cannot be empty."),e.FUNCTIONS_DEFAULT_FUNCTION_NAME=lf("doSomething"),e.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME=lf("bool"),e.FUNCTIONS_DEFAULT_STRING_ARG_NAME=lf("text"),e.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME=lf("num"),e.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME=lf("arg"),e.PROCEDURES_HUE=pxt.toolbox.getNamespaceColor("functions"),e.REPORTERS_HUE=pxt.toolbox.getNamespaceColor("variables");const t=pxt.blocks.getBlockDefinition("procedures_defnoreturn");e.PROCEDURES_DEFNORETURN_TITLE=t.block.PROCEDURES_DEFNORETURN_TITLE,e.PROCEDURE_ALREADY_EXISTS=t.block.PROCEDURE_ALREADY_EXISTS,n.Blocks.procedures_defnoreturn.init=function(){let e=new n.FieldTextInput("",n.Procedures.rename);this.appendDummyInput().appendField(n.Msg.PROCEDURES_DEFNORETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.setColour(pxt.toolbox.getNamespaceColor("functions")),this.arguments_=[],this.argumentVarModels_=[],this.hat="cap",this.setStatements_(!0),this.statementConnection_=null},(0,s.installBuiltinHelpInfo)("procedures_defnoreturn");const i=pxt.blocks.getBlockDefinition("procedures_callnoreturn");e.PROCEDURES_CALLRETURN_TOOLTIP=t.tooltip.toString(),n.Blocks.procedures_callnoreturn={init:function(){let e=new a.FieldProcedure("");this.appendDummyInput("TOPROW").appendField(i.block.PROCEDURES_CALLNORETURN_TITLE).appendField(e,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setColour(pxt.toolbox.getNamespaceColor("functions")),this.arguments_=[],this.quarkConnections_={},this.quarkIds_=null},getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(e,t){n.Names.equals(e,this.getProcedureCall())&&this.setFieldValue(t,"NAME")},onchange:function(e){if(this.workspace&&!this.workspace.isFlyout&&!this.isInsertionMarker())if(e.type==n.Events.CREATE&&-1!=e.ids.indexOf(this.id)){let t=this.getProcedureCall(),i=n.Procedures.getDefinition(t,this.workspace);if(!i||i.type==this.defType_&&JSON.stringify(i.arguments_)==JSON.stringify(this.arguments_)||(i=null),!i){n.Events.setGroup(e.group);let t=n.utils.xml.createElement("xml"),i=n.utils.xml.createElement("block");i.setAttribute("type",this.defType_);let s=this.getRelativeToSurfaceXY(),o=s.x+n.SNAP_RADIUS*(this.RTL?-1:1),r=s.y+2*n.SNAP_RADIUS;i.setAttribute("x",o),i.setAttribute("y",r);let a=n.utils.xml.createElement("field");a.setAttribute("name","NAME"),a.appendChild(document.createTextNode(this.getProcedureCall())),i.appendChild(a),t.appendChild(i),(0,c.domToWorkspaceNoEvents)(t,this.workspace),n.Events.setGroup(!1)}}else if(e.type==n.Events.DELETE){let t=this.getProcedureCall();n.Procedures.getDefinition(t,this.workspace)||(n.Events.setGroup(e.group),this.dispose(!0,!1),n.Events.setGroup(!1))}},mutationToDom:function(){const e=document.createElement("mutation");return e.setAttribute("name",this.getProcedureCall()),e},domToMutation:function(e){const t=e.getAttribute("name");this.renameProcedure(this.getProcedureCall(),t)},customContextMenu:function(e){let t={enabled:!0};t.text=n.Msg.PROCEDURES_HIGHLIGHT_DEF;let i=this.getProcedureCall(),s=this.workspace;t.callback=function(){let e=n.Procedures.getDefinition(i,s);e&&e.select()},e.push(t)},defType_:"procedures_defnoreturn"},(0,s.installBuiltinHelpInfo)("procedures_callnoreturn");const h=pxt.blocks.getBlockDefinition("function_definition");e.FUNCTIONS_EDIT_OPTION=h.block.FUNCTIONS_EDIT_OPTION,(0,s.installBuiltinHelpInfo)("function_definition");const d=pxt.blocks.getBlockDefinition("function_call");e.FUNCTIONS_CALL_TITLE=d.block.FUNCTIONS_CALL_TITLE,e.FUNCTIONS_GO_TO_DEFINITION_OPTION=d.block.FUNCTIONS_GO_TO_DEFINITION_OPTION,(0,s.installBuiltinHelpInfo)("function_call"),(0,s.installBuiltinHelpInfo)("function_call_output"),n.Blocks.function_return={init:function(){!function(e){const t=pxt.blocks.getBlockDefinition("function_return"),i="0_add_button",s="0_rem_button";n.Extensions.apply("inline-svgs",e,!1);let o,r=!0;function a(){const n=e.getInput("RETURN_VALUE");if(r){if(!n){for(;e.getInput("");)e.removeInput("");e.jsonInit({message0:t.block.message_with_value,args0:[{type:"input_value",name:"RETURN_VALUE",check:null}],previousStatement:null,colour:pxt.toolbox.getNamespaceColor("functions")})}if(e.getInput(i)&&e.removeInput(i),e.getInput(s)||u(s,e.REMOVE_IMAGE_DATAURI,lf("Remove return value")),o){const t=e.workspace.getBlockById(o);t&&t.outputConnection&&!t.outputConnection.targetBlock()&&e.getInput("RETURN_VALUE").connection.connect(t.outputConnection),o=void 0}}else{if(n){const i=n.connection.targetBlock();i&&(i.isShadow()&&i.setShadow(!1),n.connection.disconnect(),o=i.id),e.removeInput("RETURN_VALUE"),e.jsonInit({message0:t.block.message_no_value,args0:[],previousStatement:null,colour:pxt.toolbox.getNamespaceColor("functions")})}e.getInput(s)&&e.removeInput(s),e.getInput(i)||u(i,e.ADD_IMAGE_DATAURI,lf("Add return value"))}e.setInputsInline(!0)}function l(){return n.Xml.domToText(e.mutationToDom())}function c(t,i){t!==i&&n.Events.fire(new n.Events.BlockChange(e,"mutation",null,t,i))}function u(t,i,s){e.appendDummyInput(t).appendField(new n.FieldImage(i,24,24,s,(()=>{const e=l();r=!r;const t=l();c(e,t),a(),c(t,l())}),!1))}a(),e.domToMutation=e=>{e.hasAttribute("last_connected_id")&&(o=e.getAttribute("last_connected_id")),r=function(e){return"true"!==e.getAttribute("no_return_value")}(e),a()},e.mutationToDom=()=>{const t=document.createElement("mutation");return function(e,t){e.setAttribute("no_return_value",t?"false":"true")}(t,!!e.getInput("RETURN_VALUE")),o&&t.setAttribute("last_connected_id",o),t}}(this)},onchange:function(e){const t=this;if(!t.workspace||t.workspace.isFlyout)return;const i=e.type===n.Events.BLOCK_CREATE&&-1!=e.ids.indexOf(t.id),s=e.type===n.Events.BLOCK_DRAG&&e.blocks.some((e=>e.id===t.id));if(i||s){const i=t.getRootBlock();if("function_return"===i.type||null!=i.previousConnection)return;"function_definition"!==i.type&&(n.Events.setGroup(e.group),t.previousConnection.disconnect(),n.Events.setGroup(!1))}}},(0,s.installBuiltinHelpInfo)("function_return"),n.Procedures.flyoutCategory=function(e){let t=[];if(!pxt.appTarget.appTheme.hideFlyoutHeadings){let e=(0,r.createFlyoutHeadingLabel)(lf("Functions"),pxt.toolbox.getNamespaceColor("functions"),pxt.toolbox.getNamespaceIcon("functions"),"blocklyFlyoutIconfunctions");t.push(e)}const i=lf("Make a Function..."),s=lf("New function name:");let o=n.utils.xml.createElement("button");return o.setAttribute("text",i),o.setAttribute("callbackKey","CREATE_FUNCTION"),e.registerButtonCallback("CREATE_FUNCTION",(function(t){let o=t=>{n.dialog.prompt(s,t,(function(t){pxt.tickEvent("blocks.makeafunction"),t&&(t=t.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,""))==i&&(t=null),t&&(e.getVariable(t)?n.dialog.alert(n.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",t.toLowerCase()),(function(){o(t)})):n.Procedures.isNameUsed(t,e)?(t=>{let i=e.getTopBlocks(!0)[0],s=10,o=10;if(i){let e=i.getRelativeToSurfaceXY();s=e.x+n.SNAP_RADIUS*(i.RTL?-1:1),o=e.y+2*n.SNAP_RADIUS}let r=n.utils.xml.createElement("xml"),a=n.utils.xml.createElement("block");a.setAttribute("type","procedures_defnoreturn"),a.setAttribute("x",String(s)),a.setAttribute("y",String(o));let l=n.utils.xml.createElement("field");l.setAttribute("name","NAME"),l.appendChild(document.createTextNode(t)),a.appendChild(l),r.appendChild(a);let u=(0,c.domToWorkspaceNoEvents)(r,e);n.hideChaff();let h=e.getBlockById(u[0]);h.select(),e.centerOnBlock(h.id)})(t):n.dialog.alert(n.Msg.PROCEDURE_ALREADY_EXISTS.replace("%1",t.toLowerCase()),(function(){o(t)})))}))};o("doSomething")})),t.push(o),function(e,i){for(let i=0;i<e.length;i++){let s=e[i][0],o=(e[i][1],n.utils.xml.createElement("block"));o.setAttribute("type","procedures_callnoreturn"),o.setAttribute("gap","16"),o.setAttribute("colour",pxt.toolbox.getNamespaceColor("functions"));let r=n.utils.xml.createElement("field");r.textContent=s,r.setAttribute("name","NAME"),o.appendChild(r),t.push(o)}}(n.Procedures.allProcedures(e)[0]),t};const p={number:pxt.blocks.defaultIconForArgType("number"),boolean:pxt.blocks.defaultIconForArgType("boolean"),string:pxt.blocks.defaultIconForArgType("string"),Array:pxt.blocks.defaultIconForArgType("Array")},g={},m=pxt.appTarget.runtime&&pxt.appTarget.runtime.functionsOptions;m&&m.extraFunctionEditorTypes&&m.extraFunctionEditorTypes.forEach((e=>{p[e.typeName]=e.icon||pxt.blocks.defaultIconForArgType(),e.defaultName&&(g[e.typeName]=e.defaultName)}));for(const e of Object.keys(p))o.FunctionManager.getInstance().setIconForType(e,p[e]);for(const e of Object.keys(g))o.FunctionManager.getInstance().setArgumentNameForType(e,g[e]);n.Blocks.argument_reporter_custom&&(n.Blocks.argument_reporter_custom.domToMutation=function(e){const t=e.getAttribute("typename");this.typeName_=t,e.hasAttribute(u.DUPLICATE_ON_DRAG_MUTATION_KEY)&&(this.duplicateOnDrag_="true"===e.getAttribute(u.DUPLICATE_ON_DRAG_MUTATION_KEY).toLowerCase()),this.pathObject&&this.pathObject.setHasDottedOutlineOnHover(this.duplicateOnDrag_),(0,l.setOutputCheck)(this,t,l.cachedBlockInfo)});const f=n.Blocks.function_definition.makeCallOption;n.Blocks.function_definition.makeCallOption=function(){const e=f.call(this),t=this.getName();return e.text=pxt.Util.lf("Create 'call {0}'",t),e}}},{"../fields":65,"../help":66,"../importer":67,"../loader":71,"../plugins/duplicateOnDrag":84,"../plugins/functions":99,"../toolbox":127,blockly:207}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initLists=void 0;const n=e("blockly"),s=e("../help"),o=e("../constants");i.initLists=function(){const e=n.Msg,t=pxt.blocks.getBlockDefinition("lists_create_with");e.LISTS_CREATE_EMPTY_TITLE=t.block.LISTS_CREATE_EMPTY_TITLE,e.LISTS_CREATE_WITH_INPUT_WITH=t.block.LISTS_CREATE_WITH_INPUT_WITH,e.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD=t.block.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD,e.LISTS_CREATE_WITH_ITEM_TITLE=t.block.LISTS_CREATE_WITH_ITEM_TITLE,(0,s.installBuiltinHelpInfo)("lists_create_with");const i=pxt.blocks.getBlockDefinition("lists_length");e.LISTS_LENGTH_TITLE=i.block.LISTS_LENGTH_TITLE,n.Blocks.lists_length.init=function(){this.jsonInit({message0:e.LISTS_LENGTH_TITLE,args0:[{type:"input_value",name:"VALUE",check:["Array"]}],output:"Number",outputShape:o.provider.SHAPES.ROUND})},(0,s.installBuiltinHelpInfo)("lists_length");const r=pxt.blocks.getBlockDefinition("lists_index_get");n.Blocks.lists_index_get={init:function(){this.jsonInit({message0:r.block.message0,args0:[{type:"input_value",name:"LIST",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"}],colour:pxt.toolbox.blockColors.arrays,outputShape:o.provider.SHAPES.ROUND,inputsInline:!0}),this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0),(0,s.setBuiltinHelpInfo)(this,"lists_index_get")}};const a=pxt.blocks.getBlockDefinition("lists_index_set");n.Blocks.lists_index_set={init:function(){this.jsonInit({message0:a.block.message0,args0:[{type:"input_value",name:"LIST",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"},{type:"input_value",name:"VALUE",check:null}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.arrays,inputsInline:!0}),(0,s.setBuiltinHelpInfo)(this,"lists_index_set")}}}},{"../constants":18,"../help":66,blockly:207}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initLogic=void 0;const n=e("blockly"),s=e("../help");i.initLogic=function(){const e=n.Msg,t=pxt.blocks.getBlockDefinition("controls_if"),i=t.tooltip;e.CONTROLS_IF_MSG_IF=t.block.CONTROLS_IF_MSG_IF,e.CONTROLS_IF_MSG_THEN=t.block.CONTROLS_IF_MSG_THEN,e.CONTROLS_IF_MSG_ELSE=t.block.CONTROLS_IF_MSG_ELSE,e.CONTROLS_IF_MSG_ELSEIF=t.block.CONTROLS_IF_MSG_ELSEIF,e.CONTROLS_IF_TOOLTIP_1=i.CONTROLS_IF_TOOLTIP_1,e.CONTROLS_IF_TOOLTIP_2=i.CONTROLS_IF_TOOLTIP_2,e.CONTROLS_IF_TOOLTIP_3=i.CONTROLS_IF_TOOLTIP_3,e.CONTROLS_IF_TOOLTIP_4=i.CONTROLS_IF_TOOLTIP_4,(0,s.installBuiltinHelpInfo)("controls_if");const o=pxt.blocks.getBlockDefinition("logic_compare").tooltip;e.LOGIC_COMPARE_TOOLTIP_EQ=o.LOGIC_COMPARE_TOOLTIP_EQ,e.LOGIC_COMPARE_TOOLTIP_NEQ=o.LOGIC_COMPARE_TOOLTIP_NEQ,e.LOGIC_COMPARE_TOOLTIP_LT=o.LOGIC_COMPARE_TOOLTIP_LT,e.LOGIC_COMPARE_TOOLTIP_LTE=o.LOGIC_COMPARE_TOOLTIP_LTE,e.LOGIC_COMPARE_TOOLTIP_GT=o.LOGIC_COMPARE_TOOLTIP_GT,e.LOGIC_COMPARE_TOOLTIP_GTE=o.LOGIC_COMPARE_TOOLTIP_GTE,(0,s.installBuiltinHelpInfo)("logic_compare");const r=pxt.blocks.getBlockDefinition("logic_operation"),a=r.tooltip;e.LOGIC_OPERATION_AND=r.block.LOGIC_OPERATION_AND,e.LOGIC_OPERATION_OR=r.block.LOGIC_OPERATION_OR,e.LOGIC_OPERATION_TOOLTIP_AND=a.LOGIC_OPERATION_TOOLTIP_AND,e.LOGIC_OPERATION_TOOLTIP_OR=a.LOGIC_OPERATION_TOOLTIP_OR,(0,s.installBuiltinHelpInfo)("logic_operation");const l=pxt.blocks.getBlockDefinition("logic_negate");e.LOGIC_NEGATE_TITLE=l.block.LOGIC_NEGATE_TITLE,(0,s.installBuiltinHelpInfo)("logic_negate");const c=pxt.blocks.getBlockDefinition("logic_boolean");e.LOGIC_BOOLEAN_TRUE=c.block.LOGIC_BOOLEAN_TRUE,e.LOGIC_BOOLEAN_FALSE=c.block.LOGIC_BOOLEAN_FALSE,(0,s.installBuiltinHelpInfo)("logic_boolean")}},{"../help":66,blockly:207}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initLoops=void 0;const n=e("blockly"),s=e("../help");i.initLoops=function(){const e=n.Msg,t=pxt.blocks.getBlockDefinition("controls_repeat_ext");e.CONTROLS_REPEAT_TITLE=t.block.CONTROLS_REPEAT_TITLE,e.CONTROLS_REPEAT_INPUT_DO=t.block.CONTROLS_REPEAT_INPUT_DO,(0,s.installBuiltinHelpInfo)("controls_repeat_ext");const i=pxt.blocks.getBlockDefinition("device_while");n.Blocks.device_while={init:function(){this.jsonInit({message0:i.block.message0,args0:[{type:"input_value",name:"COND",check:"Boolean"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops")}),this.appendStatementInput("DO").appendField(i.block.appendField),(0,s.setBuiltinHelpInfo)(this,"device_while")}};const o=pxt.blocks.getBlockDefinition("pxt_controls_for");n.Blocks.pxt_controls_for={init:function(){this.jsonInit({message0:o.block.message0,args0:[{type:"input_value",name:"VAR",variable:o.block.variable,check:"Variable"},{type:"input_value",name:"TO",check:"Number"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops"),inputsInline:!0}),this.appendStatementInput("DO").appendField(o.block.appendField);let e=this;(0,s.setHelpResources)(this,"pxt_controls_for",o.name,(function(){return pxt.U.rlf(o.tooltip,e.getInputTargetBlock("VAR")?e.getInputTargetBlock("VAR").getField("VAR").getText():"")}),o.url,String(pxt.toolbox.getNamespaceColor("loops")))},getVars:function(){return[this.getField("VAR").getText()]},renameVar:function(e,t){const i=this.getField("VAR");n.Names.equals(e,i.getText())&&i.setValue(t)}};const r=pxt.blocks.getBlockDefinition("controls_simple_for");n.Blocks.controls_simple_for={init:function(){this.jsonInit({message0:r.block.message0,args0:[{type:"field_variable",name:"VAR",variable:r.block.variable},{type:"input_value",name:"TO",check:"Number"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops"),inputsInline:!0}),this.appendStatementInput("DO").appendField(r.block.appendField);let e=this;(0,s.setHelpResources)(this,"controls_simple_for",r.name,(function(){return pxt.U.rlf(r.tooltip,e.getField("VAR").getText())}),r.url,String(pxt.toolbox.getNamespaceColor("loops")))},getVars:function(){return[this.getField("VAR").getText()]},renameVar:function(e,t){const i=this.getField("VAR");n.Names.equals(e,i.getText())&&i.setValue(t)},customContextMenu:function(e){var t,i;if(!this.isCollapsed()&&!(null===(i=null===(t=this.workspace)||void 0===t?void 0:t.options)||void 0===i?void 0:i.readOnly)){let t={enabled:!0},i=this.getField("VAR").getText();t.text=lf("Create 'get {0}'",i);let s=n.utils.xml.createElement("field");s.textContent=i,s.setAttribute("name","VAR");let o=n.utils.xml.createElement("block");o.setAttribute("type","variables_get"),o.appendChild(s),t.callback=n.ContextMenu.callbackFactory(this,o),e.push(t)}}};const a=pxt.blocks.getBlockDefinition(ts.pxtc.TS_BREAK_TYPE);n.Blocks[pxtc.TS_BREAK_TYPE]={init:function(){const e=pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:a.block.message0,inputsInline:!0,previousStatement:null,nextStatement:null,colour:e}),(0,s.setHelpResources)(this,ts.pxtc.TS_BREAK_TYPE,a.name,a.tooltip,a.url,e,void 0,void 0,!1)}};const l=pxt.blocks.getBlockDefinition(ts.pxtc.TS_CONTINUE_TYPE);n.Blocks[pxtc.TS_CONTINUE_TYPE]={init:function(){const e=pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:l.block.message0,inputsInline:!0,previousStatement:null,nextStatement:null,colour:e}),(0,s.setHelpResources)(this,ts.pxtc.TS_CONTINUE_TYPE,l.name,l.tooltip,l.url,e,void 0,void 0,!1)}},n.Blocks[pxtc.COLLAPSED_BLOCK]={init:function(){this.jsonInit({message0:"...",inputsInline:!0,previousStatement:null,nextStatement:null,colour:"#cccccc"}),(0,s.setHelpResources)(this,ts.pxtc.COLLAPSED_BLOCK,"...",lf("a few blocks"),void 0,"#cccccc",void 0,void 0,!1)}};const c=pxt.blocks.getBlockDefinition("pxt_controls_for_of");n.Blocks.pxt_controls_for_of={init:function(){this.jsonInit({message0:c.block.message0,args0:[{type:"input_value",name:"VAR",variable:c.block.variable,check:"Variable"},{type:"input_value",name:"LIST",check:["Array","String"]}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.loops,inputsInline:!0}),this.appendStatementInput("DO").appendField(c.block.appendField);let e=this;(0,s.setHelpResources)(this,"pxt_controls_for_of",c.name,(function(){return pxt.Util.rlf(c.tooltip,e.getInputTargetBlock("VAR")?e.getInputTargetBlock("VAR").getField("VAR").getText():"")}),c.url,String(pxt.toolbox.getNamespaceColor("loops")))}};const u=pxt.blocks.getBlockDefinition("controls_for_of");n.Blocks.controls_for_of={init:function(){this.jsonInit({message0:u.block.message0,args0:[{type:"field_variable",name:"VAR",variable:u.block.variable},{type:"input_value",name:"LIST",check:"Array"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.loops,inputsInline:!0}),this.appendStatementInput("DO").appendField(u.block.appendField);let e=this;(0,s.setHelpResources)(this,"controls_for_of",u.name,(function(){return pxt.Util.rlf(u.tooltip,e.getField("VAR").getText())}),u.url,String(pxt.toolbox.getNamespaceColor("loops")))}}}},{"../help":66,blockly:207}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initMathRoundBlock=i.initMathOpBlock=i.initMath=void 0;const n=e("blockly"),s=e("../help"),o=e("../constants"),r=e("../composableMutations"),a=e("../fields/field_dropdown");function l(){const e=pxt.blocks.MATH_FUNCTIONS.unary.concat(pxt.blocks.MATH_FUNCTIONS.binary).concat(pxt.blocks.MATH_FUNCTIONS.infix),t=pxt.blocks.getBlockDefinition("math_js_op");function i(e,t){const i=e.appendValueInput("ARG"+(t?1:0));i.setCheck("Number"),t&&(i.connection.setShadowDom(function(){if(!c){(c=document.createElement("shadow")).setAttribute("type","math_number");const e=document.createElement("field");e.setAttribute("name","NUM"),e.textContent="0",c.appendChild(e)}return c}()),i.connection.respawnShadow_())}function l(e,t){let i=!!e.getInput("ARG1");t?(i&&e.moveInputBefore("op_dropdown","ARG1"),e.moveInputBefore("ARG0","op_dropdown")):(i&&e.moveInputBefore("ARG0","ARG1"),e.moveInputBefore("op_dropdown","ARG0"))}n.Blocks.math_js_op={init:function(){const n=this;n.setPreviousStatement(!1),n.setNextStatement(!1),n.setOutput(!0,"Number"),n.setOutputShape(o.provider.SHAPES.ROUND),n.setInputsInline(!0),n.appendDummyInput("op_dropdown").appendField(new a.FieldDropdown(e.map((e=>[t.block[e],e])),(e=>function(e,t){return!function(e){return-1!==pxt.blocks.MATH_FUNCTIONS.unary.indexOf(e)}(t)?e.getInput("ARG1")||i(e,!0):e.removeInput("ARG1",!0),l(e,function(e){return-1!==pxt.blocks.MATH_FUNCTIONS.infix.indexOf(e)}(t)),t}(n,e))),"OP"),i(n,!1),(0,r.appendMutation)(n,{mutationToDom:e=>{let t;for(let e=0;e<n.inputList.length;e++){const i=n.inputList[e];if("op_dropdown"===i.name){t=!1;break}if("ARG0"===i.name){t=!0;break}}return e.setAttribute("op-type",(n.getInput("ARG1")?t?"infix":"binary":"unary").toString()),e},domToMutation:e=>{if(e.hasAttribute("op-type")){const t=e.getAttribute("op-type");"unary"!=t&&i(n,!0),l(n,"infix"===t)}}})}},(0,s.installHelpResources)("math_js_op",t.name,(function(e){return t.tooltip[e.getFieldValue("OP")]}),t.url,pxt.toolbox.getNamespaceColor(t.category))}let c;function u(){const e=pxt.blocks.ROUNDING_FUNCTIONS,t=pxt.blocks.getBlockDefinition("math_js_round");n.Blocks.math_js_round={init:function(){const i=this;i.setPreviousStatement(!1),i.setNextStatement(!1),i.setOutput(!0,"Number"),i.setOutputShape(o.provider.SHAPES.ROUND),i.setInputsInline(!0),i.appendDummyInput("round_dropdown").appendField(new a.FieldDropdown(e.map((e=>[t.block[e],e]))),"OP"),function(e){e.appendValueInput("ARG0").setCheck("Number")}(i)}},(0,s.installHelpResources)("math_js_round",t.name,(function(e){return t.tooltip[e.getFieldValue("OP")]}),t.url,pxt.toolbox.getNamespaceColor(t.category))}i.initMath=function(e){const t=pxt.blocks.getBlockDefinition("math_op2"),i=t.tooltip;n.Blocks.math_op2={init:function(){this.jsonInit({message0:lf("%1 of %2 and %3"),args0:[{type:"field_dropdown",name:"op",options:[[lf("{id:op}min"),"min"],[lf("{id:op}max"),"max"]]},{type:"input_value",name:"x",check:"Number"},{type:"input_value",name:"y",check:"Number"}],inputsInline:!0,output:"Number",outputShape:o.provider.SHAPES.ROUND,colour:pxt.toolbox.getNamespaceColor("math")}),(0,s.setHelpResources)(this,"math_op2",t.name,(function(e){return i[e.getFieldValue("op")]}),t.url,pxt.toolbox.getNamespaceColor(t.category))},codeCard:(0,s.attachCardInfo)(e,"Math.min")};const r=pxt.blocks.getBlockDefinition("math_op3");n.Blocks.math_op3={init:function(){this.jsonInit({message0:r.block.message0,args0:[{type:"input_value",name:"x",check:"Number"}],inputsInline:!0,output:"Number",outputShape:o.provider.SHAPES.ROUND,colour:pxt.toolbox.getNamespaceColor("math")}),(0,s.setBuiltinHelpInfo)(this,"math_op3")},codeCard:(0,s.attachCardInfo)(e,"Math.abs")},["math_number","math_integer","math_whole_number","math_number_minmax"].forEach((e=>{const t=pxt.blocks.getBlockDefinition(e);(0,s.installHelpResources)(e,t.name,t.tooltip,t.url,"#fff","#fff","#fff")}));const a=n.Msg,c=pxt.blocks.getBlockDefinition("math_arithmetic"),h=c.tooltip;a.MATH_ADDITION_SYMBOL=c.block.MATH_ADDITION_SYMBOL,a.MATH_SUBTRACTION_SYMBOL=c.block.MATH_SUBTRACTION_SYMBOL,a.MATH_MULTIPLICATION_SYMBOL=c.block.MATH_MULTIPLICATION_SYMBOL,a.MATH_DIVISION_SYMBOL=c.block.MATH_DIVISION_SYMBOL,a.MATH_POWER_SYMBOL=c.block.MATH_POWER_SYMBOL,(0,s.installHelpResources)("math_arithmetic",c.name,(function(e){return h[e.getFieldValue("OP")]}),c.url,pxt.toolbox.getNamespaceColor(c.category));const d=pxt.blocks.getBlockDefinition("math_modulo");a.MATH_MODULO_TITLE=d.block.MATH_MODULO_TITLE,(0,s.installBuiltinHelpInfo)("math_modulo"),l(),u()},i.initMathOpBlock=l,i.initMathRoundBlock=u},{"../composableMutations":17,"../constants":18,"../fields/field_dropdown":33,"../help":66,blockly:207}],8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initOnStart=void 0;const n=e("blockly"),s=e("../fields"),o=e("../help");i.initOnStart=function(){const e=pxt.blocks.getBlockDefinition(ts.pxtc.ON_START_TYPE);if(n.Blocks[ts.pxtc.ON_START_TYPE]={init:function(){var t;let i=null===(t=pxt.appTarget.runtime)||void 0===t?void 0:t.onStartColor;i&&(i=pxt.toolbox.getAccessibleBackground(i)),this.jsonInit({message0:e.block.message0,args0:[{type:"input_dummy"},{type:"input_statement",name:"HANDLER"}],colour:i||pxt.toolbox.getNamespaceColor("loops")}),(0,o.setHelpResources)(this,ts.pxtc.ON_START_TYPE,e.name,e.tooltip,e.url,i||pxt.toolbox.getNamespaceColor("loops"),void 0,void 0,!!pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable)}},n.Blocks[pxtc.TS_STATEMENT_TYPE]={init:function(){let e,t,i=this;i.setColour("#717171"),i.setPreviousStatement(!0),i.setNextStatement(!0),i.setInputsInline(!1),i.domToMutation=e=>{const n=parseInt(e.getAttribute("numlines"));i.declaredVariables=e.getAttribute("declaredvars"),t=[];for(let i=0;i<n;i++){const n=e.getAttribute("line"+i);t.push(n)}i.setPythonEnabled(!1)},i.mutationToDom=()=>{let e=document.createElement("mutation");return t&&(t.forEach(((t,i)=>e.setAttribute("line"+i,t))),e.setAttribute("numlines",t.length.toString())),i.declaredVariables&&e.setAttribute("declaredvars",this.declaredVariables),e},i.setPythonEnabled=n=>{if(e!==n){for(;i.inputList.length;)i.removeInput(i.inputList[0].name);e=n,n?(i.appendDummyInput().appendField(pxt.Util.lf("<python code>"),"LINE0"),i.setTooltip(lf("A Python statement that could not be converted to blocks"))):(t.forEach(((e,t)=>{i.appendDummyInput().appendField(e,"LINE"+t)})),i.setTooltip(lf("A JavaScript statement that could not be converted to blocks")))}},i.getLines=()=>t,i.setEditable(!1),(0,o.setHelpResources)(this,pxtc.TS_STATEMENT_TYPE,lf("JavaScript statement"),lf("A JavaScript statement that could not be converted to blocks"),"/blocks/javascript-blocks","#717171")}},n.Blocks[pxtc.TS_OUTPUT_TYPE]={init:function(){let e=this;e.setColour("#717171"),e.setPreviousStatement(!1),e.setNextStatement(!1),e.setOutput(!0),e.setEditable(!1),e.appendDummyInput().appendField(new s.FieldTsExpression(""),"EXPRESSION"),e.setPythonEnabled=t=>{e.getField("EXPRESSION").setPythonEnabled(t),t?e.setTooltip(lf("A Python expression that could not be converted to blocks")):e.setTooltip(lf("A JavaScript expression that could not be converted to blocks"))},(0,o.setHelpResources)(e,pxtc.TS_OUTPUT_TYPE,lf("JavaScript expression"),lf("A JavaScript expression that could not be converted to blocks"),"/blocks/javascript-blocks","#717171")}},pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock){const e=pxt.appTarget.runtime.pauseUntilBlock,t=pxt.blocks.getBlockDefinition(ts.pxtc.PAUSE_UNTIL_TYPE);n.Blocks[pxtc.PAUSE_UNTIL_TYPE]={init:function(){const i=e.color||pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:t.block.message0,args0:[{type:"input_value",name:"PREDICATE",check:"Boolean"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:i}),(0,o.setHelpResources)(this,ts.pxtc.PAUSE_UNTIL_TYPE,t.name,t.tooltip,t.url,i,void 0,void 0,!1)}}}}},{"../fields":65,"../help":66,blockly:207}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initText=void 0;const n=e("blockly"),s=e("../help"),o=e("../constants");i.initText=function(){const e=pxt.blocks.getBlockDefinition("text");(0,s.installHelpResources)("text",e.name,e.tooltip,e.url,"#fff","#fff","#fff");const t=pxt.blocks.getBlockDefinition("text_length");n.Msg.TEXT_LENGTH_TITLE=t.block.TEXT_LENGTH_TITLE,n.Blocks.text_length.init=function(){this.jsonInit({message0:n.Msg.TEXT_LENGTH_TITLE,args0:[{type:"input_value",name:"VALUE",check:["String"]}],output:"Number",outputShape:o.provider.SHAPES.ROUND})},(0,s.installBuiltinHelpInfo)("text_length");const i=pxt.blocks.getBlockDefinition("text_join");n.Msg.TEXT_JOIN_TITLE_CREATEWITH=i.block.TEXT_JOIN_TITLE_CREATEWITH,(0,s.installBuiltinHelpInfo)("text_join")}},{"../constants":18,"../help":66,blockly:207}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initVariables=void 0;const n=e("blockly"),s=e("../toolbox"),o=e("../help");i.initVariables=function(){n.FieldVariable.prototype.getVariableTypes_=()=>[""];let e=lf("{id:var}item");n.Variables.flyoutCategory=function(e){let t=[];if(!pxt.appTarget.appTheme.hideFlyoutHeadings){let e=(0,s.createFlyoutHeadingLabel)(lf("Variables"),pxt.toolbox.getNamespaceColor("variables"),pxt.toolbox.getNamespaceIcon("variables"));t.push(e)}let i=document.createElement("button");i.setAttribute("text",lf("Make a Variable...")),i.setAttribute("callbackKey","CREATE_VARIABLE"),e.registerButtonCallback("CREATE_VARIABLE",(function(e){n.Variables.createVariableButtonHandler(e.getTargetWorkspace())})),t.push(i);let o=n.Variables.flyoutCategoryBlocks(e);return t.concat(o)},n.Variables.flyoutCategoryBlocks=function(e){let t=e.getVariablesOfType(""),i=[];if(t.length>0){let e=t[t.length-1];t.sort(n.VariableModel.compareByName);for(let e=0;e<t.length;e++){const o=t[e];if(n.Blocks.variables_get){let e=(0,s.mkVariableFieldBlock)("variables_get",o.getId(),o.type,o.name,!1);e.setAttribute("gap","8"),i.push(e)}}if(i[i.length-1].setAttribute("gap","24"),(n.Blocks.variables_change||n.Blocks.variables_set)&&i.unshift((0,s.createFlyoutGroupLabel)(lf("Your Variables"))),n.Blocks.variables_change){let t=n.Blocks.variables_get?20:8,o=(0,s.mkVariableFieldBlock)("variables_change",e.getId(),e.type,e.name,!1);o.setAttribute("gap",t+"");{let e=n.utils.xml.createElement("value");e.setAttribute("name","VALUE");let t=n.utils.xml.createElement("shadow");t.setAttribute("type","math_number"),e.appendChild(t);let i=n.utils.xml.createElement("field");i.setAttribute("name","NUM"),i.appendChild(document.createTextNode("1")),t.appendChild(i),o.appendChild(e)}i.unshift(o)}if(n.Blocks.variables_set){let t=n.Blocks.variables_change?8:24,o=(0,s.mkVariableFieldBlock)("variables_set",e.getId(),e.type,e.name,!1);o.setAttribute("gap",t+"");{let e=n.utils.xml.createElement("value");e.setAttribute("name","VALUE");let t=n.utils.xml.createElement("shadow");t.setAttribute("type","math_number"),e.appendChild(t);let i=n.utils.xml.createElement("field");i.setAttribute("name","NUM"),i.appendChild(document.createTextNode("0")),t.appendChild(i),o.appendChild(e)}i.unshift(o)}}return i};const t=n.Msg,i=pxt.blocks.getBlockDefinition("variables_get");t.VARIABLES_GET_CREATE_SET=i.block.VARIABLES_GET_CREATE_SET,(0,o.installBuiltinHelpInfo)("variables_get"),(0,o.installBuiltinHelpInfo)("variables_get_reporter"),t.RENAME_VARIABLE=lf("Rename variable..."),t.DELETE_VARIABLE=lf('Delete the "%1" variable'),t.DELETE_VARIABLE_CONFIRMATION=lf('Delete %1 uses of the "%2" variable?'),t.NEW_VARIABLE_DROPDOWN=lf("New variable...");const r=pxt.blocks.getBlockDefinition("variables_set");t.VARIABLES_SET=r.block.VARIABLES_SET,t.VARIABLES_DEFAULT_NAME=e,t.VARIABLES_SET_CREATE_GET=lf("Create 'get %1'"),(0,o.installBuiltinHelpInfo)("variables_set");const a=pxt.blocks.getBlockDefinition("variables_change");n.Blocks.variables_change={init:function(){this.jsonInit({message0:a.block.message0,args0:[{type:"field_variable",name:"VAR",variable:e},{type:"input_value",name:"VALUE",check:"Number"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("variables")}),(0,o.setBuiltinHelpInfo)(this,"variables_change")},customContextMenu:function(e){var t,i;if(!(null===(i=null===(t=this.workspace)||void 0===t?void 0:t.options)||void 0===i?void 0:i.readOnly)){let t={enabled:this.workspace.remainingCapacity()>0},i=this.getField("VAR").getText();t.text=lf("Create 'get {0}'",i);let s=n.utils.xml.createElement("field");s.textContent=i,s.setAttribute("name","VAR");let o=n.utils.xml.createElement("block");o.setAttribute("type","variables_get"),o.appendChild(s),t.callback=n.ContextMenu.callbackFactory(this,o),e.push(t)}}},t.NEW_VARIABLE_TITLE=lf("New variable name:"),t.RENAME_VARIABLE_TITLE=lf("Rename all '%1' variables to:")}},{"../help":66,"../toolbox":127,blockly:207}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.renderCodeCard=void 0;const n=e("./render");i.renderCodeCard=function(e,t={}){const i=e.url?/^[^:]+:\/\//.test(e.url)?e.url:"/"+e.url.replace(/^\.?\/?/,""):e.youTubeId?`https://youtu.be/${e.youTubeId}`:void 0,s=!!i,o=(e,t,i="div",n="")=>{let s=document.createElement(i);return t&&(s.className=t),e&&e.appendChild(s),n&&s.appendChild(document.createTextNode(n+"")),s};let r=o(null,"ui "+(e.style||"card")+" "+(e.color||"")+(s?" link":""),s?"a":"div");if(t.role&&r.setAttribute("role",t.role),"option"===t.role&&r.setAttribute("aria-selected","true"),s){const e=r;e.href=i,/^https?:\/\//.test(i)&&(e.target="_blank")}if(!t.hideHeader&&e.header){let t=o(r,"ui content "+(e.responsive?" tall desktop only":""));e.header&&o(t,"description","span",e.header)}const a=(t.shortName?e.shortName:"")||e.name;let l=o(r,"ui image"+(e.responsive?" tall landscape only":""));if(e.label){let t=document.createElement("label");t.className=`ui ${e.labelClass?e.labelClass:"orange right ribbon"} label`,t.textContent=e.label,l.appendChild(t)}if(e.blocksXml){const t=(0,n.render)(e.blocksXml);if(t){let e=o(l,"");e.setAttribute("style","width:100%; min-height:10em"),e.appendChild(t)}else console.error("failed to render blocks"),pxt.debug(e.blocksXml)}if(e.typeScript){let t=document.createElement("pre");t.appendChild(document.createTextNode(e.typeScript)),l.appendChild(t)}if(e.imageUrl||(e.youTubeId?`https://img.youtube.com/vi/${e.youTubeId}/0.jpg`:void 0)){let t=document.createElement("div");t.className="ui imagewrapper";let i=document.createElement("div");i.className="ui cardimage",i.style.backgroundImage=`url("${e.imageUrl}")`,i.title=a,i.setAttribute("role","presentation"),t.appendChild(i),l.appendChild(t)}if("file"==e.cardType){let e=o(r,"ui fileimage");l.appendChild(e)}if(a||e.description){let t=o(r,"ui content");if(a&&(r.setAttribute("aria-label",a),o(t,"header","div",a)),e.description){const i=o(t,"ui description"),n=e.description.split(".")[0]+".";i.appendChild(document.createTextNode(n))}}if(e.time){let t=o(r,"meta");e.time&&o(t,"date","span").appendChild(document.createTextNode(pxt.Util.timeSince(e.time)))}return e.extracontent&&o(r,"extra content","div").appendChild(document.createTextNode(e.extracontent)),r}},{"./render":125}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.workerOpAsync=i.compileExpression=i.callKey=i.compileAsync=i.compileBlockAsync=i.PXT_WARNING_ID=void 0;const n=e("blockly"),s=e("./environment"),o=e("./typeChecker"),r=e("./util"),a=e("../toolbox"),l=e("../legacyMutations"),c=e("./variables"),u=e("../fields");function h(e,t){if(e.type===ts.pxtc.ON_START_TYPE)return 0;const i=t.stdCallTable[e.type],n=d(t,e),s=1+ts.pxtc.Util.codalHash16(n);return i&&i.attrs.afterOnStart?s:-s}function d(e,t){return t.type==ts.pxtc.ON_START_TYPE?JSON.stringify({name:ts.pxtc.ON_START_TYPE}):t.type==ts.pxtc.FUNCTION_DEFINITION_TYPE?JSON.stringify({type:"function",name:t.getFieldValue("function_name")}):JSON.stringify(p(t)).replace(/"id"\s*:\s*"[^"]+"/g,"")}function p(e){const t=[],i=[];for(const s of e.inputList){for(const e of s.fieldRow)e.name&&t.push(e.getText());s.type===n.inputs.inputTypes.VALUE&&(s.connection.targetBlock()?i.push(p(s.connection.targetBlock())):i.push(null))}return{type:e.type,fields:t,inputs:i}}function g(e,t){e.setEnabled(t);const i=e.getDescendants(!1);for(const e of i)e.setEnabled(t)}function m(e,t){if(t.isInsertionMarker())return[];let i;const n=[];switch(e.stats[t.type]=(e.stats[t.type]||0)+1,C(t,n),t.type){case"controls_if":i=function(e,t,i){let n=[];for(let s=0;s<=t.elseifCount_;++s){let o=f(e,(0,r.getInputTargetBlock)(e,t,"IF"+s),i),a=_(e,(0,r.getInputTargetBlock)(e,t,"DO"+s)),l=pxt.blocks.mkText("if (");s>0&&((l=pxt.blocks.mkText("else if (")).glueToBlock=pxt.blocks.GlueMode.WithSpace),(0,r.append)(n,[l,o,pxt.blocks.mkText(")"),a])}if(t.elseCount_){let i=pxt.blocks.mkText("else");i.glueToBlock=pxt.blocks.GlueMode.WithSpace,(0,r.append)(n,[i,_(e,(0,r.getInputTargetBlock)(e,t,"ELSE"))])}return n}(e,t,n);break;case"pxt_controls_for":case"controls_for":case"controls_simple_for":i=function(e,t,i){let n=(0,r.getInputTargetBlock)(e,t,"TO"),s=(0,r.getInputTargetBlock)(e,t,"DO"),a=(0,r.getInputTargetBlock)(e,t,"BY"),l=(0,r.getInputTargetBlock)(e,t,"FROM"),c=!a||a.type.match(/^math_number/)&&1==P(a),u=(0,o.lookup)(e,t,(0,r.getLoopVariableField)(e,t).getField("VAR").getText());return[pxt.blocks.mkText("for (let "+u.escapedName+" = "),l?f(e,l,i):pxt.blocks.mkText("0"),pxt.blocks.mkText("; "),pxt.blocks.mkInfix(pxt.blocks.mkText(u.escapedName),"<=",f(e,n,i)),pxt.blocks.mkText("; "),c?pxt.blocks.mkText(u.escapedName+"++"):pxt.blocks.mkInfix(pxt.blocks.mkText(u.escapedName),"+=",f(e,a,i)),pxt.blocks.mkText(")"),_(e,s)]}(e,t,n);break;case"pxt_controls_for_of":case"controls_for_of":i=function(e,t,i){let n=(0,r.getInputTargetBlock)(e,t,"LIST"),s=(0,r.getInputTargetBlock)(e,t,"DO"),a=(0,o.lookup)(e,t,(0,r.getLoopVariableField)(e,t).getField("VAR").getText());return[pxt.blocks.mkText("for (let "+a.escapedName+" of "),f(e,n,i),pxt.blocks.mkText(")"),_(e,s)]}(e,t,n);break;case"variables_set":i=[E(e,t,n)];break;case"variables_change":i=[b(e,t,n)];break;case"controls_repeat_ext":i=function(e,t,i){let n=f(e,(0,r.getInputTargetBlock)(e,t,"TIMES"),i),s=_(e,(0,r.getInputTargetBlock)(e,t,"DO")),a=i=>!(0,o.lookup)(e,t,i),l="index";for(let e=2;!a(l);e++)l="index"+e;return[pxt.blocks.mkText("for (let "+l+" = 0; "),pxt.blocks.mkInfix(pxt.blocks.mkText(l),"<",n),pxt.blocks.mkText("; "+l+"++)"),s]}(e,t,n);break;case"device_while":i=function(e,t,i){let n=f(e,(0,r.getInputTargetBlock)(e,t,"COND"),i),s=_(e,(0,r.getInputTargetBlock)(e,t,"DO"));return[pxt.blocks.mkText("while ("),n,pxt.blocks.mkText(")"),s]}(e,t,n);break;case"procedures_defnoreturn":i=function(e,t,i){const n=(0,r.escapeVarName)(t.getFieldValue("NAME"),e,!0),s=(0,r.getInputTargetBlock)(e,t,"STACK");return[pxt.blocks.mkText("function "+n+"() "),_(e,s)]}(e,t);break;case"function_definition":i=function(e,t,i){const n=(0,r.escapeVarName)(t.getField("function_name").getText(),e,!0),s=(0,r.getInputTargetBlock)(e,t,"STACK"),a=t.getArguments().map((i=>{if("Array"==i.type){const n=(0,o.lookup)(e,t,i.name),s=(0,o.getConcreteType)(n.type),a=(null==s?void 0:s.type)&&"Array"!==s.type?s.type:"any[]";return`${(0,r.escapeVarName)(i.name,e)}: ${a}`}return`${(0,r.escapeVarName)(i.name,e)}: ${i.type}`})),l=(0,o.isFunctionRecursive)(e,t,!1);return[pxt.blocks.mkText(`function ${n} (${a.join(", ")})${l?": any":""}`),_(e,s)]}(e,t);break;case"procedures_callnoreturn":i=[A(e,t,n)];break;case"function_call":i=[S(e,t,n,!0)];break;case pxtc.TS_RETURN_STATEMENT_TYPE:i=[R(e,t,n)];break;case ts.pxtc.ON_START_TYPE:i=function(e,t){const i=_(e,(0,r.getInputTargetBlock)(e,t,"HANDLER"));return pxt.appTarget.compile&&pxt.appTarget.compile.onStartText&&i&&i.children&&i.children.unshift(pxt.blocks.mkStmt(pxt.blocks.mkText(`// ${pxtc.ON_START_COMMENT}\n`))),i}(e,t).children;break;case pxtc.TS_STATEMENT_TYPE:i=function(e,t){return t.getLines().map((e=>pxt.blocks.mkText(e+"\n")))}(0,t);break;case pxtc.PAUSE_UNTIL_TYPE:i=function(e,t,i){const n=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;pxt.U.assert(!!n,"target has block enabled");const s=n.namespace,o=n.callName||"pauseUntil",r=L(e,t,{definitionName:"PREDICATE",actualName:"PREDICATE"},i),a=[pxt.blocks.mkGroup([pxt.blocks.mkText("() => "),r])];return s?[pxt.blocks.mkStmt(pxt.blocks.H.namespaceCall(s,o,a,!1))]:[pxt.blocks.mkStmt(pxt.blocks.H.mkCall(o,a,!1,!1))]}(e,t,n);break;case pxtc.TS_DEBUGGER_TYPE:i=function(e,t){return"1"==t.getFieldValue("ON_OFF")?[pxt.blocks.mkText("debugger;\n")]:[]}(0,t);break;case pxtc.TS_BREAK_TYPE:i=[pxt.blocks.mkText("break;\n")];break;case pxtc.TS_CONTINUE_TYPE:i=[pxt.blocks.mkText("continue;\n")];break;default:i=e.stdCallTable[t.type]?[w(e,t,n)]:[pxt.blocks.mkStmt(f(e,t,n))]}let s=i[i.length-1];return s&&!s.id&&(s.id=t.id),n.length&&function(e,t){const i=[];for(const t of e)for(const e of t.split("\n"))i.push(pxt.blocks.mkText(`// ${e}`)),i.push(pxt.blocks.mkNewLine());for(const e of i.reverse())t.unshift(e)}(n,i),i.forEach((e=>{!(e.type===pxt.blocks.NT.Block||e.type===pxt.blocks.NT.Prefix&&pxt.Util.startsWith(e.op,"//"))||t.type==pxtc.ON_START_TYPE&&e.id||(e.id=t.id)})),i}function f(e,t,i){let n;if(pxt.U.assert(null!=t),e.stats[t.type]=(e.stats[t.type]||0)+1,C(t,i),"placeholder"!=t.type&&t.isEnabled&&t.isEnabled())switch(t.type){case"math_number":case"math_integer":case"math_whole_number":case"math_number_minmax":n=function(e,t,i){return pxt.blocks.H.mkNumberLiteral(P(t))}(0,t);break;case"math_op2":n=function(e,t,i){let n=t.getFieldValue("op"),s=f(e,(0,r.getInputTargetBlock)(e,t,"x"),i),o=f(e,(0,r.getInputTargetBlock)(e,t,"y"),i);return pxt.blocks.H.mathCall(n,[s,o])}(e,t,i);break;case"math_op3":n=function(e,t,i){let n=f(e,(0,r.getInputTargetBlock)(e,t,"x"),i);return pxt.blocks.H.mathCall("abs",[n])}(e,t,i);break;case"math_arithmetic":case"logic_compare":case"logic_operation":n=function(e,t,i){let n=t.getFieldValue("OP"),s=(0,r.getInputTargetBlock)(e,t,"A"),a=(0,r.getInputTargetBlock)(e,t,"B"),l=[f(e,s,i),f(e,a,i)];(function(e){return-1!==["LT","LTE","GT","GTE","EQ","NEQ"].indexOf(e)})(n)&&D(e,s)&&D(e,a)&&pxt.blocks.flattenNode([l[0]]).output!==pxt.blocks.flattenNode([l[1]]).output&&(l=l.map((e=>pxt.blocks.H.mkParenthesizedExpression(pxt.blocks.mkGroup([e,pxt.blocks.mkText(" as any")])))));const c=(0,o.returnType)(e,s);if((0,o.isStringType)(c)){if("EQ"==n)return pxt.blocks.H.mkSimpleCall("==",l);if("NEQ"==n)return pxt.blocks.H.mkSimpleCall("!=",l)}else if((0,o.isBooleanType)(c))return pxt.blocks.H.mkSimpleCall(N[n],l);return pxt.U.assert(n in N),pxt.blocks.H.mkSimpleCall(N[n],l)}(e,t,i);break;case"math_modulo":n=function(e,t,i){let n=(0,r.getInputTargetBlock)(e,t,"DIVIDEND"),s=(0,r.getInputTargetBlock)(e,t,"DIVISOR"),o=[f(e,n,i),f(e,s,i)];return pxt.blocks.H.mkSimpleCall("%",o)}(e,t,i);break;case"logic_boolean":n=function(e,t,i){return pxt.blocks.H.mkBooleanLiteral("TRUE"==t.getFieldValue("BOOL"))}(0,t);break;case"logic_negate":n=function(e,t,i){let n=f(e,(0,r.getInputTargetBlock)(e,t,"BOOL"),i);return pxt.blocks.mkPrefix("!",[pxt.blocks.H.mkParenthesizedExpression(n)])}(e,t,i);break;case"variables_get":case"variables_get_reporter":n=function(e,t){const i=t.getField("VAR").getText();let n=(0,o.lookup)(e,t,i);return n?(n.firstReference||(n.firstReference=t),pxt.U.assert(null!=n&&null!=n.type),pxt.blocks.mkText(n.escapedName)):pxt.blocks.mkText(i)}(e,t);break;case"text":n=function(e,t,i){return pxt.blocks.H.mkStringLiteral(t.getFieldValue("TEXT"))}(0,t);break;case"text_join":n=function(e,t,i){let n,s=0;for(;;){const o=(0,r.getInputTargetBlock)(e,t,"ADD"+s);if(s++,!o){if(s<t.inputList.length)continue;break}const a=f(e,o,i);n=n?pxt.blocks.H.mkSimpleCall("+",[n,a]):0===o.type.indexOf("text")?a:pxt.blocks.H.mkSimpleCall("+",[pxt.blocks.H.mkStringLiteral(""),a])}return n||pxt.blocks.H.mkStringLiteral("")}(e,t,i);break;case"lists_create_with":n=function(e,t,i){let n=t.inputList.map((t=>t.connection&&t.connection.targetBlock()?f(e,t.connection.targetBlock(),i):void 0)).filter((e=>!!e));return pxt.blocks.H.mkArrayLiteral(n,!t.getInputsInline())}(e,t,i);break;case"lists_index_get":n=function(e,t,i){const n=f(e,(0,r.getInputTargetBlock)(e,t,"LIST"),i),s=f(e,(0,r.getInputTargetBlock)(e,t,"INDEX"),i);return pxt.blocks.mkGroup([n,pxt.blocks.mkText("["),s,pxt.blocks.mkText("]")])}(e,t,i);break;case"lists_index_set":n=function(e,t,i){const n=(0,r.getInputTargetBlock)(e,t,"LIST"),s=f(e,n,i),o=f(e,(0,r.getInputTargetBlock)(e,t,"INDEX"),i),a=f(e,(0,r.getInputTargetBlock)(e,t,"VALUE"),i),l=pxt.blocks.mkGroup([s,pxt.blocks.mkText("["),o,pxt.blocks.mkText("] = "),a]);return"lists_create_with"===n.type?T(l):l}(e,t,i);break;case"math_js_op":case"math_js_round":n=function(e,t,i){const n=t.getFieldValue("OP"),s=[f(e,(0,r.getInputTargetBlock)(e,t,"ARG0"),i)];return t.getInput("ARG1")&&s.push(f(e,(0,r.getInputTargetBlock)(e,t,"ARG1"),i)),pxt.blocks.H.mathCall(n,s)}(e,t,i);break;case pxtc.TS_OUTPUT_TYPE:n=function(e,t,i){return pxt.blocks.mkText(t.getFieldValue("EXPRESSION").trim())}(0,t);break;case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":n=function(e,t,i){const n=(0,r.escapeVarName)(t.getFieldValue("VALUE"),e);return pxt.blocks.mkText(n)}(e,t);break;case"function_call_output":n=S(e,t,i,!1);break;default:let s=e.stdCallTable[t.type];s?n=s.imageLiteral?y(e,t,s.imageLiteral,s.imageLiteralColumns,s.imageLiteralRows,s.namespace,s.f,(0,r.visibleParams)(s,(0,r.countOptionals)(t,s)).map((n=>L(e,t,n,i)))):x(e,t,s,i):(pxt.reportError("blocks","unable to compile expression",{details:t.type}),n=(0,o.defaultValueForType)((0,o.returnType)(e,t)))}else if("Array"===(0,o.find)((0,o.returnType)(e,t)).type){let i="lists_index_get"===t.getParent().type;if(!i){const n=e.stdCallTable[t.getParent().type];i=n&&n.isExpression}const s=pxt.blocks.mkText("[0]");n=i?s:T(s)}else n=(0,o.defaultValueForType)((0,o.returnType)(e,t));return n.id=t.id,n}function _(e,t){let i=[],n=t;for(;t;)t.isEnabled()&&(0,r.append)(i,m(e,t)),t=t.getNextBlock();return n&&e.blockDeclarations[n.id]&&e.blockDeclarations[n.id].filter((e=>!e.alreadyDeclared)).forEach((t=>{i.unshift(k(t,e.blocksInfo)),t.alreadyDeclared=s.BlockDeclarationType.Implicit})),pxt.blocks.mkBlock(i)}function T(e){const t=pxt.blocks.mkStmt(pxt.blocks.mkText(";"));return t.glueToBlock=pxt.blocks.GlueMode.NoSpace,pxt.blocks.mkGroup([t,e])}function E(e,t,i){let n=(0,r.getInputTargetBlock)(e,t,"VALUE"),a=(0,o.lookup)(e,t,t.getField("VAR").getText()),l=e.idToScope[t.id].declaredVars[a.name]===a&&!a.firstReference&&!a.alreadyDeclared;l&&(0,r.forEachChildExpression)(t,(t=>{"variables_get"===t.type&&(0,o.lookup)(e,t,t.getField("VAR").getText())===a&&(l=!1)}),!0);let c=f(e,n,i),u=a.escapedName+" = ";if(a.isAssigned=!0,l){a.alreadyDeclared=s.BlockDeclarationType.Assigned;const t=(0,o.getConcreteType)(a.type);if(u=`let ${a.escapedName} = `,t){const i=(0,o.getConcreteType)((0,o.returnType)(e,n));t.type!==i.type&&(u=`let ${a.escapedName}: ${t.type} = `)}}else a.firstReference||(a.firstReference=t);return pxt.blocks.mkStmt(pxt.blocks.mkText(u),c)}function b(e,t,i){let n=(0,r.getInputTargetBlock)(e,t,"VALUE"),s=(0,o.lookup)(e,t,t.getField("VAR").getText()),a=f(e,n,i),l=pxt.blocks.mkText(s.escapedName);return pxt.blocks.mkStmt(pxt.blocks.mkInfix(l,"+=",a))}function I(e,t,i,n,s,a){const c=n.map((i=>L(e,t,i,a))),u=(0,r.getInputTargetBlock)(e,t,"HANDLER"),h=_(e,u);let d;if(pxt.appTarget.compile&&pxt.appTarget.compile.emptyEventHandlerComments&&0===h.children.length&&h.children.unshift(pxt.blocks.mkStmt(pxt.blocks.mkText(`// ${pxtc.HANDLER_COMMENT}`))),(0,r.isMutatingBlock)(t)&&t.mutation.getMutationType()===l.MutatorTypes.ObjectDestructuringMutator)d=t.mutation.compileMutation(e,a);else if(i.comp.handlerArgs.length){let n=(0,o.getEscapedCBParameters)(t,i,e);d=pxt.blocks.mkText(`function (${n.join(", ")})`)}return function(e,t,i,n,s,o,r=!1){let a;return s.noFinalNewline=!0,a=o?pxt.blocks.mkGroup([o,s]):pxt.blocks.mkGroup([pxt.blocks.mkText("function ()"),s]),r?pxt.blocks.mkStmt(pxt.blocks.H.extensionCall(i,n.concat([a]),!1)):t?pxt.blocks.mkStmt(pxt.blocks.H.namespaceCall(t,i,n.concat([a]),!1)):pxt.blocks.mkStmt(pxt.blocks.H.mkCall(i,n.concat([a]),!1))}(0,s,i.f,c,h,d,i.isExtensionMethod)}function y(e,t,i,n,s,o,r,a){a=void 0===a?[]:a;let l="\n";s=s||5,n=(n||5)*i;let c=t.getFieldValue("LEDS");c=c.replace(/[ `\n]+/g,"");for(let e=0;e<s;++e){for(let t=0;t<n;++t)t>0&&(l+=" "),l+="#"===c[e*n+t]?"#":".";l+="\n"}let u=pxt.blocks.H.mkStringLiteral(l);return u.canIndentInside=!0,pxt.blocks.H.namespaceCall(o,r,[u].concat(a),!1)}function v(e,t,i){let n=pxt.blocks.flattenNode(t);return B("format",{format:{input:n.output,pos:1}}).then((()=>({source:n.output,sourceMap:n.sourceMap,stats:e.stats,diagnostics:i||[]})))}function C(e,t){var i;const n=null===(i=e.getCommentText)||void 0===i?void 0:i.call(e);n&&t.push(n)}function k(e,t){const i=(0,o.getConcreteType)(e.type);let n,s="";if("null"==(n="Array"===i.type?pxt.blocks.mkText("[]"):(0,o.defaultValueForType)(i)).op||"[]"==n.op){let e=i.type;"Array"!==e&&"null[]"!==e||(e="number[]");let o=t.apis.byQName[e];o&&o.attributes.autoCreate?n=pxt.blocks.mkText(o.attributes.autoCreate+"()"):s=": "+e}return pxt.blocks.mkStmt(pxt.blocks.mkText("let "+e.escapedName+s+" = "),n)}function O(e,t,i,n,s){const o=a(e,s.x,s.x+s.width)||a(s.x,e,e+i),r=a(t,s.y,s.y+s.height)||a(s.y,t,t+n);return o&&r;function a(e,t,i){return e>=t&&e<=i}}i.PXT_WARNING_ID="WARNING_MESSAGE",i.compileBlockAsync=function(e,t){const i=e.workspace,n=(0,s.mkEnv)(i,t);(0,o.infer)(i&&i.getAllBlocks(!1),n,i);const r=m(n,e);return n.placeholders={},v(n,r)},i.compileAsync=function(e,t,l={}){const u=(0,s.mkEnv)(e,t,l),[p,f]=function(e,t,l){try{let i=t.getAllBlocks(!1);pxt.react.getTilemapProject&&pxt.react.getTilemapProject().removeInactiveBlockAssets(i.map((e=>e.id)));let u=t.getTopBlocks(!0);u=u.sort(((t,i)=>h(t,e)-h(i,e))),function(e,t,i){const s=n.Events.isEnabled();s&&n.Events.disable(),t.forEach((e=>e.setEnabled(!0)));const o={};function a(e,t){o[e]?g(t,!1):(g(t,!0),o[e]=t)}i.forEach((t=>{const i=e.stdCallTable[t.type];if(t.type==ts.pxtc.ON_START_TYPE)a(ts.pxtc.ON_START_TYPE,t);else{if((0,r.isFunctionDefinition)(t)||i&&i.attrs.blockAllowMultiple&&!i.attrs.handlerStatement)return;if(i&&i.hasHandler&&!i.attrs.handlerStatement)a(i.attrs.blockHandlerKey||d(e,t),t);else{let e=t;for(;e;)g(t,!1),e=e.getNextBlock()}}})),s&&n.Events.enable()}(e,i,u),i=i.filter((e=>e.isEnabled())),u=u.filter((e=>e.isEnabled())),(0,c.trackAllVariables)(u,e),(0,o.infer)(i,e,t);const p=[],f=function(e,t){if(!e.length||e.some((e=>!e.rendered)))return{orphans:t,idToComments:{}};const i=e.map((e=>{const t=e.getBoundingRectangle(),i=e.getHeightWidth();return{id:e.id,x:t.left,y:t.top,width:i.width,height:i.height}})),n={orphans:[],idToComments:{}};for(const e of t){const t=e.getBoundingRectangle(),s=e.getSize(),o=t.left,r=t.top;let a;for(const e of i)(O(o,r,s.width,s.height,e)||!a&&O(o-20,r-20,s.width+40,s.height+40,e))&&(a=e);a?(n.idToComments[a.id]||(n.idToComments[a.id]=[]),n.idToComments[a.id].push(e)):n.orphans.push(e)}return n}(u,t.getTopComments(!0));f.orphans.forEach((e=>(0,r.append)(p,$(e).children))),u.forEach((t=>{if(f.idToComments[t.id]&&f.idToComments[t.id].forEach((e=>{(0,r.append)(p,$(e).children)})),t.type==ts.pxtc.ON_START_TYPE)(0,r.append)(p,m(e,t));else{const i=pxt.blocks.mkBlock(m(e,t));i.type==pxt.blocks.NT.Block?(0,r.append)(p,i.children):p.push(i)}}));const _=[];e.enums.forEach((e=>{const i=t.getVariablesOfType(e.name);if(i&&i.length){const t=i.map((e=>{const t=/^(\d+)([^0-9].*)$/.exec(e.name);return t?[t[2],parseInt(t[1])]:[e.name,-1]}));t.sort(((e,t)=>e[1]-t[1]));const n=[];let s=-1;t.forEach((([t,i],o)=>{let r;if(e.isBitMask){const e=Math.log2(i);e>=0&&Math.floor(e)===e&&(r=pxt.blocks.H.mkAssign(pxt.blocks.mkText(t),pxt.blocks.H.mkSimpleCall("<<",[pxt.blocks.H.mkNumberLiteral(1),pxt.blocks.H.mkNumberLiteral(e)])))}else if(e.isHash){const e=ts.pxtc.Util.codalHash16(t.toLowerCase());r=pxt.blocks.H.mkAssign(pxt.blocks.mkText(t),pxt.blocks.H.mkNumberLiteral(e))}r||(r=i===s+1?pxt.blocks.mkText(t):pxt.blocks.H.mkAssign(pxt.blocks.mkText(t),pxt.blocks.H.mkNumberLiteral(i))),n.push(r),s=i}));const o=pxt.blocks.mkCommaSep(n,!0);o.glueToBlock=pxt.blocks.GlueMode.NoSpace,_.push(pxt.blocks.mkGroup([pxt.blocks.mkText(`enum ${e.name}`),pxt.blocks.mkBlock([o])]))}})),e.kinds.forEach((e=>{const i=t.getVariablesOfType("KIND_"+e.name);if(i&&i.length){const t=i.map((e=>e.name)).filter((t=>-1===e.initialMembers.indexOf(t)));t.length&&_.push(pxt.blocks.mkGroup([pxt.blocks.mkText(`namespace ${e.name}`),pxt.blocks.mkBlock(t.map((t=>pxt.blocks.mkStmt(pxt.blocks.mkText(`export const ${t} = ${e.name}.${e.createFunctionName}()`)))))]))}}));const T=e.allVariables.filter((e=>!e.alreadyDeclared)).map((e=>k(e,l)));return e.allVariables.filter((e=>e.alreadyDeclared===s.BlockDeclarationType.Implicit&&!e.isAssigned)).forEach((t=>{const i=(0,o.getConcreteType)(t.type);"string"===i.type||"number"===i.type||"boolean"===i.type||(0,a.isArrayType)(i.type)||e.diagnostics.push({blockId:t.firstReference&&t.firstReference.id,message:lf("Variable '{0}' is never assigned",t.name)})})),[_.concat(T.concat(p)),e.diagnostics]}catch(t){let n=t.block;if(!n)throw t;n.setWarningText(t+"",i.PXT_WARNING_ID),e.errors.push(n)}finally{e.placeholders={}}return[null,null]}(u,e,t);return v(u,p,f)},i.callKey=d,i.compileExpression=f;let N={ADD:"+",MINUS:"-",MULTIPLY:"*",DIVIDE:"/",LT:"<",LTE:"<=",GT:">",GTE:">=",AND:"&&",OR:"||",EQ:"==",NEQ:"!=",POWER:"**"};function A(e,t,i){const n=(0,r.escapeVarName)(t.getFieldValue("NAME"),e,!0);return pxt.blocks.mkStmt(pxt.blocks.mkText(n+"()"))}function S(e,t,i,n){const s=(0,r.escapeVarName)(t.getField("function_name").getText(),e,!0),o=!t.getInputsInline(),a=t.getArguments().map((e=>({actualName:e.name,definitionName:e.id}))).map((n=>L(e,t,n,i))),l=pxt.blocks.H.stdCall(s,a,o);return n?pxt.blocks.mkStmt(l):l}function R(e,t,i){const n=(0,r.getInputTargetBlock)(e,t,"RETURN_VALUE");return n&&"placeholder"!=n.type?pxt.blocks.mkStmt(pxt.blocks.mkText("return "),f(e,n,i)):pxt.blocks.mkStmt(pxt.blocks.mkText("return"))}function w(e,t,i){const n=e.stdCallTable[t.type];return n.imageLiteral?pxt.blocks.mkStmt(y(0,t,n.imageLiteral,n.imageLiteralColumns,n.imageLiteralRows,n.namespace,n.f,(0,r.visibleParams)(n,(0,r.countOptionals)(t,n)).map((n=>L(e,t,n,i))))):n.hasHandler?I(e,t,n,function(e,t){return(0,r.visibleParams)(e,(0,r.countOptionals)(t,e)).filter((e=>!!e.definitionName))}(n,t),n.namespace,i):pxt.blocks.mkStmt(x(e,t,n,i))}function L(e,t,i,s,a=!1){let l=t.getFieldValue(i.definitionName);if(null!=l){const s=t.getField(i.definitionName);if(s instanceof n.FieldTextInput||s instanceof u.FieldTextInput)return pxt.blocks.H.mkStringLiteral(l);if(s instanceof u.FieldTilemap&&!s.isGreyBlock){const t=pxt.react.getTilemapProject(),i=s.getValue();if(i.startsWith("tilemap`"))return pxt.blocks.mkText(i);if(e.options.emitTilemapLiterals)try{const e=pxt.sprite.decodeTilemap(i,"typescript",t);if(e){const[i]=t.createNewTilemapFromData(e);return pxt.blocks.mkText(`tilemap\`${i}\``)}}catch(e){}}const o=e.blocksInfo.apis.byQName[i.type];if(o&&o.attributes.emitAsConstant)for(const t of Object.keys(e.blocksInfo.apis.byQName)){const i=e.blocksInfo.apis.byQName[t];if(i&&i.attributes&&i.attributes.enumIdentity===l)return pxt.blocks.mkText(t)}let r=pxt.blocks.mkText(l);return r.canIndentInside="string"==typeof l&&l.indexOf("\n")>=0,r}{(0,o.attachPlaceholderIf)(e,t,i.definitionName);const n=(0,r.getInputTargetBlock)(e,t,i.definitionName);return a&&"lists_create_with"===n.type?T(f(e,n,s)):i.shadowOptions&&i.shadowOptions.toString&&!(0,o.isStringType)((0,o.returnType)(e,n))?pxt.blocks.H.mkSimpleCall("+",[pxt.blocks.H.mkStringLiteral(""),pxt.blocks.H.mkParenthesizedExpression(f(e,n,s))]):f(e,n,s)}}function x(e,t,i,n){let s;if((0,r.isMutatingBlock)(t)&&t.mutation.getMutationType()===l.MutatorTypes.RestParameterMutator)s=t.mutation.compileMutation(e,n).children;else{if("ENUM_GET"===i.attrs.shim){const e=i.attrs.enumName,n=t.getFieldValue("MEMBER").replace(/^\d+/,"");return pxt.blocks.H.mkPropertyAccess(n,pxt.blocks.mkText(e))}if("KIND_GET"===i.attrs.shim){const n=e.kinds.filter((e=>e.blockId===i.attrs.blockId))[0];return pxt.blocks.H.mkPropertyAccess(t.getFieldValue("MEMBER"),pxt.blocks.mkText(n.name))}s=(0,r.visibleParams)(i,(0,r.countOptionals)(t,i)).map(((s,o)=>L(e,t,s,n,i.isExtensionMethod&&0===o&&!i.isExpression)))}let o=i.namespace,a=i.f;if(i.attrs.blockAliasFor){const t=e.blocksInfo.apis.byQName[i.attrs.blockAliasFor];t&&(a=t.name,o=t.namespace)}const c=!t.getInputsInline();if(i.isIdentity)return s[0];if(i.property)return pxt.blocks.H.mkPropertyAccess(a,s[0]);if("@get@"==a)return pxt.blocks.H.mkPropertyAccess(s[1].op.replace(/.*\./,""),s[0]);if("@set@"==a)return pxt.blocks.H.mkAssign(pxt.blocks.H.mkPropertyAccess(s[1].op.replace(/.*\./,"").replace(/@set/,""),s[0]),s[2]);if("@change@"==a)return pxt.blocks.H.mkSimpleCall("+=",[pxt.blocks.H.mkPropertyAccess(s[1].op.replace(/.*\./,"").replace(/@set/,""),s[0]),s[2]]);if(i.isExtensionMethod){if(i.attrs.defaultInstance){let o;(0,r.isMutatingBlock)(t)&&t.mutation.getMutationType()===l.MutatorTypes.DefaultInstanceMutator&&(o=t.mutation.compileMutation(e,n)),o?s.unshift(o):s.unshift(pxt.blocks.mkText(i.attrs.defaultInstance))}return pxt.blocks.H.extensionCall(a,s,c)}return o?pxt.blocks.H.namespaceCall(o,a,s,c):pxt.blocks.H.stdCall(a,s,c)}function $(e){const t=e.getText();return pxt.blocks.H.mkMultiComment(t.trim())}function D(e,t){return M(e,t)||"logic_boolean"===t.type||"text"===t.type}function M(e,t){if(!t)return!1;if("math_number"===t.type||"math_integer"===t.type||"math_number_minmax"===t.type||"math_whole_number"===t.type)return!0;const i=e.stdCallTable[t.type];if(!i)return!1;const{comp:n}=i;if("TD_ID"===i.attrs.shim&&1===n.parameters.length){const i=t.getFieldValue(n.parameters[0].definitionName);return i?!isNaN(parseInt(i)):M(e,(0,r.getInputTargetBlock)(e,t,n.parameters[0].definitionName))}return!1}function P(e){let t=e.getFieldValue("math_number_minmax"===e.type?"SLIDER":"NUM");const i=parseFloat(t);return function(e,t){isFinite(e)&&!isNaN(e)||function(e,t){let i=new Error(e);throw i.block=t,i}(lf("Number entered is either too large or too small"),t)}(i,e),i}function B(e,t){return pxt.worker.getWorker(pxt.webConfig.workerjs).opAsync(e,t)}i.workerOpAsync=B},{"../fields":65,"../legacyMutations":70,"../toolbox":127,"./environment":13,"./typeChecker":14,"./util":15,"./variables":16,blockly:207}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.mkEnv=i.emptyEnv=i.BlockDeclarationType=i.Point=void 0;const n=e("./util");var s;function o(e,t){return{workspace:e,options:t,stdCallTable:{},userFunctionReturnValues:{},diagnostics:[],errors:[],renames:{oldToNew:{},takenNames:{},oldToNewFunctions:{}},stats:{},enums:[],kinds:[],idToScope:{},blockDeclarations:{},allVariables:[],blocksInfo:null,placeholders:{}}}i.Point=class{constructor(e,t,i,n,s){this.link=e,this.type=t,this.parentType=i,this.childType=n,this.isArrayType=s}},(s=i.BlockDeclarationType||(i.BlockDeclarationType={}))[s.None=0]="None",s[s.Argument=1]="Argument",s[s.Assigned=2]="Assigned",s[s.Implicit=3]="Implicit",i.emptyEnv=o,i.mkEnv=function(e,t,i={}){let s=o(e,i);return s.blocksInfo=t,t&&(Object.keys(t.apis.byQName).forEach((e=>{const i=t.apis.byQName[e];!i.pkg||6!==i.kind&&3!==i.kind&&5!==i.kind&&4!==i.kind||(s.renames.takenNames[i.qName]=!0)})),t.enumsByName&&Object.keys(t.enumsByName).forEach((e=>s.enums.push(t.enumsByName[e]))),t.kindsByName&&Object.keys(t.kindsByName).forEach((e=>s.kinds.push(t.kindsByName[e]))),t.blocks.forEach((e=>{if(s.stdCallTable[e.attributes.blockId])return void pxt.reportError("blocks","function already defined",{details:e.attributes.blockId,qualifiedName:e.qName,packageName:e.pkg});s.renames.takenNames[e.namespace]=!0;const t=pxt.blocks.compileInfo(e),i=!!t.thisParameter;s.stdCallTable[e.attributes.blockId]={namespace:e.namespace,f:e.name,comp:t,attrs:e.attributes,isExtensionMethod:i,isExpression:e.retType&&"void"!==e.retType,imageLiteral:e.attributes.imageLiteral||e.attributes.gridLiteral,imageLiteralColumns:e.attributes.imageLiteralColumns,imageLiteralRows:e.attributes.imageLiteralRows,hasHandler:pxt.blocks.hasHandler(e),property:!e.parameters,isIdentity:"TD_ID"==e.attributes.shim}})),e.getTopBlocks(!1).filter(n.isFunctionDefinition).forEach((e=>{const t="procedures_defnoreturn"===e.type?e.getFieldValue("NAME"):e.getField("function_name").getText();(0,n.escapeVarName)(t,s,!0)}))),s}},{"./util":15}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isBooleanType=i.isStringType=i.defaultValueForType=i.getEscapedCBParameters=i.isFunctionRecursive=i.getDeclaredVariables=i.lookup=i.getConcreteType=i.attachPlaceholderIf=i.returnType=i.find=i.mkPoint=i.infer=void 0;const n=e("./environment"),s=e("./util"),o=e("../plugins/functions"),r=e("./compiler");function a(e,t){let i=m(e),n=m(t);if(A(null==i.link&&null==n.link),i==n)return;if(f(i))return void E(e.type,t.type);if(f(n))return E(e.type,t.type),e.type=null,e.link=n,i.link=n,void(i.isArrayType=n.isArrayType);if(i.childType&&n.childType){const e=i.childType;i.childType=null,a(e,n.childType)}else i.childType&&!n.childType&&(n.childType=i.childType);if(i.parentType&&n.parentType){const e=i.parentType;i.parentType=null,a(e,n.parentType)}else!i.parentType||n.parentType||n.type||(n.parentType=i.parentType);let s=E(i.type,n.type);e.link=n,i.link=n,i.isArrayType=n.isArrayType,e.type=null,t.type=s}function l(e,t,i,n){I(e,t,i);try{a(_(e,(0,s.getInputTargetBlock)(e,t,i)),n)}catch(e){}}function c(e,t=!1){return new n.Point(null,e,null,null,t)}i.infer=function(e,t,i){function n(e){var t,i;const n=null===(i=null===(t=e.connection)||void 0===t?void 0:t.getCheck())||void 0===i?void 0:i[0];return e.name?n||"T":void 0}function o(e,i){let o=e.inputList.filter((e=>"T"===n(e)));if(o.length){const n=(0,s.getInputTargetBlock)(t,e,o[0].name);if(n){const s=_(t,n),o=s.type?g(_(t,n).type+"[]"):g(null);return y(o,s),l(t,e,i,o),!0}}return!1}e&&e.filter((e=>e.isEnabled())).forEach((e=>{try{switch(e.type){case"math_op2":l(t,e,"x",g(u.type)),l(t,e,"y",g(u.type));break;case"math_op3":l(t,e,"x",g(u.type));break;case"math_arithmetic":case"logic_compare":switch(e.getFieldValue("OP")){case"ADD":case"MINUS":case"MULTIPLY":case"DIVIDE":case"LT":case"LTE":case"GT":case"GTE":case"POWER":l(t,e,"A",g(u.type)),l(t,e,"B",g(u.type));break;case"AND":case"OR":I(t,e,"A",h.type),I(t,e,"B",h.type);break;case"EQ":case"NEQ":I(t,e,"A"),I(t,e,"B");let i=_(t,(0,s.getInputTargetBlock)(t,e,"A")),n=_(t,(0,s.getInputTargetBlock)(t,e,"B"));try{a(i,n)}catch(e){}}break;case"logic_operation":I(t,e,"A",h.type),I(t,e,"B",h.type);break;case"logic_negate":I(t,e,"BOOL",h.type);break;case"controls_if":for(let i=0;i<=e.elseifCount_;++i)I(t,e,"IF"+i,h.type);break;case"pxt_controls_for":case"controls_simple_for":l(t,e,"TO",g(u.type));break;case"pxt_controls_for_of":case"controls_for_of":y(_(t,(0,s.getInputTargetBlock)(t,e,"LIST")),C(t,e,(0,s.getLoopVariableField)(t,e).getField("VAR").getText()).type);break;case"variables_set":case"variables_change":let i=C(t,e,e.getField("VAR").getText()).type;I(t,e,"VALUE");let r=(0,s.getInputTargetBlock)(t,e,"VALUE");if(r){let n=function(e,t){var i;const n=null===(i=t.outputConnection)||void 0===i?void 0:i.getCheck();return(null==n?void 0:n.length)&&"Array"!==n[0]&&"T"!==n[0]?n.map((e=>g(e))):[_(e,t)]}(t,r);const s=m(i);if(s.type&&n.slice(1).some((e=>e.type===s.type)))i.link=m(n[0]);else try{a(i,n[0])}catch(e){}}break;case"controls_repeat_ext":l(t,e,"TIMES",g(u.type));break;case"device_while":I(t,e,"COND",h.type);break;case"lists_index_get":l(t,e,"LIST",g("Array")),l(t,e,"INDEX",g(u.type)),y(_(t,(0,s.getInputTargetBlock)(t,e,"LIST")),_(t,e));break;case"lists_index_set":l(t,e,"LIST",g("Array")),I(t,e,"VALUE"),o(e,"LIST"),l(t,e,"INDEX",g(u.type));break;case"function_definition":T(t,e.getField("function_name").getText());break;case"function_call":case"function_call_output":e.getArguments().forEach((i=>{l(t,e,i.id,g(i.type))}));break;case pxtc.TS_RETURN_STATEMENT_TYPE:I(t,e,"RETURN_VALUE");break;case pxtc.PAUSE_UNTIL_TYPE:l(t,e,"PREDICATE",h);break;default:if(e.type in t.stdCallTable){const i=t.stdCallTable[e.type];if("ENUM_GET"===i.attrs.shim||"KIND_GET"===i.attrs.shim)return;(0,s.visibleParams)(i,(0,s.countOptionals)(e,i)).forEach(((s,r)=>{var a;const c=i.isExtensionMethod&&0===r;if(s.definitionName&&!e.getFieldValue(s.definitionName)){let i=e.inputList.find((e=>e.name==s.definitionName));const r=null===(a=null==i?void 0:i.connection)||void 0===a?void 0:a.getCheck();if(r){if(c&&"Array"===n(i)&&o(e,s.definitionName))return;for(let i=0;i<r.length;i++)try{let n=r[i];l(t,e,s.definitionName,g(n));break}catch(e){}}}}))}}}catch(i){const n=i.block||e;n.setWarningText(i+"",r.PXT_WARNING_ID),t.errors.push(n)}})),t.allVariables.forEach((e=>{null==v(e.type).type&&(e.isFunctionParameter?e.type.isArrayType&&(e.type.type="any[]"):a(e.type,g(e.type.isArrayType?"number[]":u.type)))}))},i.mkPoint=c;const u=c("number"),h=c("boolean"),d=c("string"),p=c("void");function g(e){if(!e)return c(e);switch(e.toLowerCase()){case"number":return u;case"boolean":return h;case"string":return d;case"void":return p;default:return c(e)}}function m(e){return e.link?m(e.link):e}function f(e){return e===u||e===h||e===d||e===p}function _(e,t){var i,n;if(A(null!=t),function(e){return"placeholder"==e.type||e.type===pxtc.TS_OUTPUT_TYPE}(t))return t.p||(t.p=c(null)),m(t.p);if("variables_get"==t.type)return m(C(e,t,t.getField("VAR").getText()).type);if("function_call_output"==t.type)return function(e,t){return T(e,t.getField("function_name").getText())}(e,t);if(!t.outputConnection)return g(p.type);const s=(null===(n=null===(i=t.outputConnection)||void 0===i?void 0:i.getCheck())||void 0===n?void 0:n[0])||"T";if("Array"===s){const i=t.outputConnection.getCheck();if(i.length>1)return g(i[1]);let n;if("lists_create_with"==t.type){if(t.inputList&&t.inputList.length)for(const i of t.inputList)if(i.connection&&i.connection.targetBlock()){let t=m(_(e,i.connection.targetBlock()));if(t){if(t.parentType)return t.parentType;y(n=t.type?g(t.type+"[]"):c(null),t);break}}}else"argument_reporter_array"==t.type&&(n||(n=C(e,t,t.getFieldValue("VALUE")).type));return n&&(n.isArrayType=!0),n||c(null,!0)}if("T"===s){const i=e.stdCallTable[t.type],n="lists_index_get"===t.type;if(n||i&&i.comp.thisParameter){let s;if((s=n?t.inputList.find((e=>"LIST"===e.name)):t.inputList.find((e=>e.name===i.comp.thisParameter.definitionName))).connection&&s.connection.targetBlock()){const t=_(e,s.connection.targetBlock());if(t.childType)return t.childType;const i=b(t.type)&&"Array"!==t.type?c(t.type.substr(0,t.type.length-2)):c(null);return y(t,i),i}}return c(null)}return g(s)}function T(e,t){if(!e.userFunctionReturnValues[t]){const i=(0,o.getDefinition)(t,e.workspace);let n=c("void");if(O(e,i,!0))n=c("any");else{const o=[];for(const t of i.getDescendants(!1))"function_return"===t.type&&(I(e,t,"RETURN_VALUE"),o.push(_(e,(0,s.getInputTargetBlock)(e,t,"RETURN_VALUE"))));if(o.length)try{const e=c(null);for(const t of o)a(e,t);n=e}catch(s){e.diagnostics.push({blockId:i.id,message:pxt.Util.lf("Function '{0}' has an invalid return type",t)}),n=c("any")}}e.userFunctionReturnValues[t]=n}return e.userFunctionReturnValues[t]}function E(e,t){if(null==e||"Array"===e&&b(t))return t;if(null==t||"Array"===t&&b(e))return e;if(e==t)return e;throw new Error("cannot mix "+e+" with "+t)}function b(e){return e&&(-1!==e.indexOf("[]")||"Array"==e)}function I(e,t,i,n){const s=t.getInputTargetBlock(i);s?s.type!==pxtc.TS_OUTPUT_TYPE||s.p||(s.p=c(null)):(e.placeholders[t.id]||(e.placeholders[t.id]={}),e.placeholders[t.id][i]||(e.placeholders[t.id][i]=function(e,t,i){return{type:"placeholder",p:c(i||null),workspace:e.workspace,parentBlock_:t,getParent:()=>t}}(e,t,n)))}function y(e,t){const i=m(e),n=m(t);i.childType?a(i.childType,n):i.type||(i.childType=n),n.parentType?a(n.parentType,i):n.type||(n.parentType=i),b(i.type)&&(i.isArrayType=!0)}function v(e,t=[]){const i=m(e);if(-1===t.indexOf(i)&&(t.push(i),!i.type||"Array"===i.type)){if(i.parentType){const e=v(i.parentType,t);if(e.type&&"Array"!==e.type)return b(e.type)?i.type=e.type.substr(0,e.type.length-2):i.type=e.type,i}if(i.childType){const e=v(i.childType,t);if(e.type)return i.type=e.type+"[]",i}}return i}function C(e,t,i){return k(i,e.idToScope[t.id])}function k(e,t){return t&&t.declaredVars[e]?t.declaredVars[e]:t&&t.parent?k(e,t.parent):null}function O(e,t,i){const n=(0,s.getFunctionName)(t),r={};return function t(a){let l;l=i?a.getDescendants(!1).filter((e=>"function_return"==e.type)).map((t=>(0,s.getInputTargetBlock)(e,t,"RETURN_VALUE"))).filter((e=>e&&"function_call_output"===e.type)):a.getDescendants(!1).filter((e=>"function_call_output"==e.type));for(const e of l){const i=(0,s.getFunctionName)(e);if(i===n)return!0;if(!r[i]&&(r[i]=!0,t((0,o.getDefinition)(i,e.workspace))))return!0}return!1}(t)}function N(e,t,i){let n=[];if(t.attrs.draggableParameters)for(let o=0;o<t.comp.handlerArgs.length;o++){const r=t.comp.handlerArgs[o];let a;const l=(0,s.getInputTargetBlock)(i,e,"HANDLER_DRAG_PARAM_"+r.name);if(null===(a="reporter"===t.attrs.draggableParameters?l&&l.getFieldValue("VALUE"):l&&l.getField("VAR").getText()))break;n.push({name:a,type:c(r.type)})}else for(let i=0;i<t.comp.handlerArgs.length;i++){const s=t.comp.handlerArgs[i],o=e.getField("HANDLER_"+s.name),r=o&&o.getText();if(null===r)break;n.push({name:r,type:c(s.type)})}return n}function A(e){if(!e)throw new Error("Assertion failure")}i.find=m,i.returnType=_,i.attachPlaceholderIf=I,i.getConcreteType=v,i.lookup=C,i.getDeclaredVariables=function(e,t){switch(e.type){case"pxt_controls_for":case"controls_simple_for":return[{name:(0,s.getLoopVariableField)(t,e).getField("VAR").getText(),type:u}];case"pxt_controls_for_of":case"controls_for_of":return[{name:(0,s.getLoopVariableField)(t,e).getField("VAR").getText(),type:c(null)}];case"function_definition":return e.getArguments().filter((e=>"Array"===e.type)).map((e=>{const t=c(null);return t.isArrayType=!0,{name:e.name,type:t,isFunctionParameter:!0}}))}if((0,s.isMutatingBlock)(e)){const t=e.mutation.getDeclaredVariables();if(t)return Object.keys(t).map((e=>({name:e,type:c(t[e])})))}let i=t.stdCallTable[e.type];return i&&i.comp.handlerArgs.length?N(e,i,t):[]},i.isFunctionRecursive=O,i.getEscapedCBParameters=function(e,t,i){return N(e,t,i).map((t=>C(i,e,t.name).escapedName))},i.defaultValueForType=function(e){if(null==e.type&&(a(e,g(u.type)),e=m(e)),b(e.type)||e.isArrayType)return pxt.blocks.mkText("[]");switch(e.type){case"boolean":return pxt.blocks.H.mkBooleanLiteral(!1);case"number":return pxt.blocks.H.mkNumberLiteral(0);case"string":return pxt.blocks.H.mkStringLiteral("");default:return pxt.blocks.mkText("null")}},i.isStringType=function(e){return e===d},i.isBooleanType=function(e){return e===h}},{"../plugins/functions":99,"./compiler":12,"./environment":13,"./util":15}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isFunctionDefinition=i.append=i.escapeVarName=i.isMutatingBlock=i.getInputTargetBlock=i.countOptionals=i.visibleParams=i.getFunctionName=i.getLoopVariableField=i.printScope=i.forEachStatementInput=i.forEachChildExpression=void 0;const n=e("blockly");function s(e){let t="";for(let i=0;i<e;i++)t+="    ";return t}function o(e,t,i){var n;return t.getInputTargetBlock(i)||(null===(n=e.placeholders[t.id])||void 0===n?void 0:n[i])}i.forEachChildExpression=function e(t,i,s=!1){t.inputList.filter((e=>e.type===n.inputs.inputTypes.VALUE)).forEach((t=>{t.connection&&t.connection.targetBlock()&&(i(t.connection.targetBlock()),s&&e(t.connection.targetBlock(),i,s))}))},i.forEachStatementInput=function(e,t){e.inputList.filter((e=>e.type===n.inputs.inputTypes.STATEMENT)).forEach((e=>{e.connection&&e.connection.targetBlock()&&t(e.connection.targetBlock())}))},i.printScope=function e(t,i=0){const n=Object.keys(t.declaredVars).map((e=>`${e}(${t.declaredVars[e].id})`)).join(",");t.referencedVars.join(", "),console.log(`${s(i)}SCOPE: ${t.firstStatement?t.firstStatement.type:"TOP-LEVEL"}`),n.length&&console.log(`${s(i)}DECS: ${n}`),t.children.forEach((t=>e(t,i+1)))},i.getLoopVariableField=function(e,t){return"pxt_controls_for"==t.type||"pxt_controls_for_of"==t.type?o(e,t,"VAR"):t},i.getFunctionName=function(e){return e.getField("function_name").getText()},i.visibleParams=function({comp:e},t){const i=[];return e.thisParameter&&i.push(e.thisParameter),e.parameters.forEach((e=>{e.isOptional&&t>0?(i.push(e),--t):e.isOptional||i.push(e)})),i},i.countOptionals=function(e,t){if(t.attrs.compileHiddenArguments)return t.comp.parameters.reduce(((e,t)=>(t.isOptional&&e++,e)),0);if(e.mutationToDom){const t=e.mutationToDom();if(t.hasAttribute("_expanded")){const e=parseInt(t.getAttribute("_expanded"));return isNaN(e)?0:Math.max(e,0)}}return 0},i.getInputTargetBlock=o,i.isMutatingBlock=function(e){return!!e.mutation},i.escapeVarName=function(e,t,i=!1){if(!e)return"_";if(i){if(t.renames.oldToNewFunctions[e])return t.renames.oldToNewFunctions[e]}else if(t.renames.oldToNew[e])return t.renames.oldToNew[e];let n=ts.pxtc.escapeIdentifier(e);if(t.renames.takenNames[n]){let e=2;for(;t.renames.takenNames[n+e];)e++;n+=e}return i?(t.renames.oldToNewFunctions[e]=n,t.renames.takenNames[n]=!0):t.renames.oldToNew[e]=n,n},i.append=function(e,t){e.push.apply(e,t)},i.isFunctionDefinition=function(e){return"procedures_defnoreturn"===e.type||"function_definition"===e.type}},{blockly:207}],16:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.trackAllVariables=void 0;const n=e("blockly"),s=e("./environment"),o=e("./typeChecker"),r=e("./util");function a(e,t){const i=Object.keys(e.declaredVars);if(i.length){const n=i.map((t=>e.declaredVars[t]));e.firstStatement&&(t.blockDeclarations[e.firstStatement.id]=n.concat(t.blockDeclarations[e.firstStatement.id]||[])),n.forEach((e=>t.allVariables.push(e)))}e.children.forEach((e=>a(e,t)))}function l(e,t){let i;if(-1!==e.referencedVars.indexOf(t))return e;for(const n of e.children)if(c(n,t)){if(u(n,t))return e;if(i)return e;i=n}return i?l(i,t):void 0}function c(e,t){if(-1!==e.referencedVars.indexOf(t))return!0;for(const i of e.children)if(c(i,t))return!0;return!1}function u(e,t){if(-1!==e.assignedVars.indexOf(t))return!0;for(const i of e.children)if(u(i,t))return!0;return!1}function h(e,t){for(const t of Object.keys(e.declaredVars)){const n=e.declaredVars[t];n.escapedName||(n.escapedName=i(t))}function i(i){if(!i)return"_";let s=ts.pxtc.escapeIdentifier(i);if(t.renames.takenNames[s]||n(s,e,i)){let o=2;for(;t.renames.takenNames[s+o]||n(s+o,e,i);)o++;s+=o}return s}function n(e,t,i){if(t){for(const n of Object.keys(t.declaredVars)){const s=t.declaredVars[n];if((i!==s.name||s.name!==s.escapedName)&&s.escapedName===e)return!0}return n(e,t.parent,i)}return!1}e.children.forEach((e=>h(e,t)))}i.trackAllVariables=function(e,t){let i,c=1;return e.forEach((e=>{if(e.type===ts.pxtc.ON_START_TYPE){const n=e.getInputTargetBlock("HANDLER");n&&u(n,i={firstStatement:n,declaredVars:{},referencedVars:[],children:[],assignedVars:[]},t)}})),i||(i={firstStatement:null,declaredVars:{},referencedVars:[],children:[],assignedVars:[]}),e.forEach((e=>{e.type!==ts.pxtc.ON_START_TYPE&&u(e,i,t)})),Object.keys(i.declaredVars).forEach((e=>{const t=i.declaredVars[e];delete i.declaredVars[e],(l(i,t.id)||i).declaredVars[e]=t})),a(i,t),h(i,t),i;function u(e,t,i){if(i.idToScope[e.id]=t,"variables_get"===e.type){const i=d(e.getField("VAR").getText(),t);t.referencedVars.push(i.id)}else if("variables_set"===e.type||"variables_change"===e.type){const i=d(e.getField("VAR").getText(),t);t.assignedVars.push(i.id),t.referencedVars.push(i.id)}else if(e.type===pxtc.TS_STATEMENT_TYPE){const i=e.declaredVariables;i&&i.split(",").forEach((e=>{d(e,t).alreadyDeclared=s.BlockDeclarationType.Argument}))}if(function(e){return e.inputList.some((e=>e.type===n.inputs.inputTypes.STATEMENT))}(e)){const n=(0,o.getDeclaredVariables)(e,i).map((e=>Object.assign(Object.assign({},e),{id:c++})));let a=t;n.length&&(a={parent:t,firstStatement:e,declaredVars:{},referencedVars:[],assignedVars:[],children:[]},n.forEach((e=>{e.alreadyDeclared=s.BlockDeclarationType.Assigned,a.declaredVars[e.name]=e})),i.idToScope[e.id]=a),t!==a&&t.children.push(a),(0,r.forEachChildExpression)(e,(e=>{u(e,a,i)})),(0,r.forEachStatementInput)(e,(e=>{const t={parent:a,firstStatement:e,declaredVars:{},referencedVars:[],assignedVars:[],children:[]};a.children.push(t),u(e,t,i)}))}else(0,r.forEachChildExpression)(e,(e=>{u(e,t,i)}));e.nextConnection&&e.nextConnection.targetBlock()&&u(e.nextConnection.targetBlock(),t,i)}function d(e,t){return t.declaredVars[e]?t.declaredVars[e]:t.parent?d(e,t.parent):(t.declaredVars[e]={name:e,type:(0,o.mkPoint)(null),id:c++},t.declaredVars[e])}}},{"./environment":13,"./typeChecker":14,"./util":15,blockly:207}],17:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initExpandableBlock=i.initVariableArgsBlock=i.appendMutation=void 0;const n=e("blockly"),s=e("./toolbox"),o=e("./constants"),r=e("./fields"),a=e("./loader");function l(e,t){const i=e,n=i.mutationToDom,s=i.domToMutation;i.mutationToDom=()=>{const e=n?n():document.createElement("mutation");return t.mutationToDom(e)},i.domToMutation=e=>{s&&s(e),t.domToMutation(e)}}i.appendMutation=l,i.initVariableArgsBlock=function(e,t){let i=0,s=0,o=e.appendDummyInput(),c=()=>{if(i!==s){if(i>s){const n=i-s;for(let i=0;i<n;i++){const n=t[s+i];o.insertFieldAt(o.fieldRow.length-1,new r.FieldArgumentVariable(n.name),"HANDLER_"+n.name);const a=e;(null==a?void 0:a.initSvg)&&a.initSvg()}}else{let e=s-i;for(let i=0;i<e;i++){const e=t[s-i-1];o.removeField("HANDLER_"+e.name)}}i>=t.length?o.removeField("_HANDLER_ADD"):s>=t.length&&u(),s=i}};function u(){o.appendField(new n.FieldImage(e.ADD_IMAGE_DATAURI,24,24,lf("Add argument"),(()=>{i=Math.min(i+1,t.length),c()}),!1),"_HANDLER_ADD")}n.Extensions.apply("inline-svgs",e,!1),u(),l(e,{mutationToDom:n=>{n.setAttribute("numArgs",i.toString());for(let s=0;s<i;s++){const i=e.getField("HANDLER_"+t[s].name);let o=i&&i.getText();n.setAttribute("arg"+s,o)}return n},domToMutation:n=>{let s=parseInt(n.getAttribute("numargs"));i=Math.min(isNaN(s)?0:s,t.length),c();for(let s=0;s<i;s++){const i=n.getAttribute("arg"+s),o="HANDLER_"+t[s].name;e.getField(o)&&(0,a.setVarFieldValue)(e,o,i)}}})},i.initExpandableBlock=function(e,t,i,r,a,u){const h="0_add_button",d="0_rem_button",p="0_add_rem_button",g="_expanded",m="_input_init",f=i.parameters.map((e=>e.name)),_=i.parameters.length,T=a?_:1,E="variable"===e.blocksById[t.type].attributes.inlineInputMode,b=e.blocksById[t.type].attributes.inlineInputModeLimit||4,I=e.blocksById[t.type].attributes.compileHiddenArguments,y=e.blocksById[t.type].attributes.expandableArgumentBreaks;let v;y&&(v=y.split(/[;,]/).map((e=>parseInt(e))));const C=new c(t);C.setEventsEnabled(!1),C.setValue(g,0),C.setValue(m,!1),C.setEventsEnabled(!0),n.Extensions.apply("inline-svgs",t,!1);let k=!1,O=!0;if(l(t,{mutationToDom:e=>(e.setAttribute(g,C.getString(g)),e.setAttribute(m,C.getString(m)),e),domToMutation:e=>{if(C.setEventsEnabled(!1),e.hasAttribute(m)&&"true"==e.getAttribute(m)&&!C.getBoolean(m)&&C.setValue(m,!0),w(),e.hasAttribute(g)){const i=parseInt(e.getAttribute(g));if(!isNaN(i)){const e=i-(C.getNumber(g)||0);C.getBoolean(m)?t.rendered||t.isInsertionMarker()?A(e,!0,t.isInsertionMarker()):(C.setValue(g,L(e)),R()):A(e,!0)}}C.setEventsEnabled(!0)}}),w(),I){let e=0;for(let n=0;n<t.inputList.length;n++){const s=t.inputList[n];(pxt.Util.startsWith(s.name,o.optionalInputWithFieldPrefix)||-1!==f.indexOf(s.name))&&(!s.connection||s.connection.isConnected()||t.isInsertionMarker()||$(s,r.definitionNameToParam[i.parameters[e].name]),++e)}}const N={updateBeforeRender:()=>{k||O&&(O=!1,k=!0,A(0,void 0,!0),k=!1)}};function A(e,n=!1,s=!1){const a=L(e);if(!s&&!n&&a===C.getNumber(g))return;C.setValue(g,a);const l=a;if(!C.getBoolean(m)&&l>0&&(w(),!t.rendered))return;let c=0;for(let e=0;e<t.inputList.length;e++){const n=t.inputList[e];if(pxt.Util.startsWith(n.name,o.optionalDummyInputPrefix))x(n,c<l||l===_);else if(pxt.Util.startsWith(n.name,o.optionalInputWithFieldPrefix)||-1!==f.indexOf(n.name)){const e=c<l;x(n,e),e&&n.connection&&!n.connection.isConnected()&&!t.isInsertionMarker()&&$(n,r.definitionNameToParam[i.parameters[c].name]),++c}}R(),E&&t.setInputsInline(l<b),n||t.render()}function S(e,i,s,o){t.appendDummyInput(e).appendField(new n.FieldImage(i,24,24,s,(()=>A(o)),!1))}function R(){if(k)return;const e=C.getNumber(g),i=e!==_,s=0!==e;t.inputList.some((e=>e.name===h))&&t.removeInput(h,!0),t.inputList.some((e=>e.name===d))&&t.removeInput(d,!0),t.inputList.some((e=>e.name===p))&&t.removeInput(p,!0),i&&s?t.appendDummyInput(p).appendField(new n.FieldImage(t.REMOVE_IMAGE_DATAURI,24,24,lf("Hide optional arguments"),(()=>A(-1*T)),!1)).appendField(new n.FieldImage(t.ADD_IMAGE_DATAURI,24,24,lf("Reveal optional arguments"),(()=>A(T)),!1)):i?S(h,t.ADD_IMAGE_DATAURI,lf("Reveal optional arguments"),T):s&&S(d,t.REMOVE_IMAGE_DATAURI,lf("Hide optional arguments"),-1*T)}function w(){C.setValue(m,!0),u(),R()}function L(e){const t=Math.min(Math.max(C.getNumber(g)+e,0),_);if(v){if(e>=0){if(0===t)return 0;for(const e of v)if(e>=t)return e;return _}for(let e=0;e<v.length;e++)if(v[e]>=t)return e>0?v[e-1]:0;return v[v.length-1]}return t}function x(e,t){e.setVisible(t)}function $(i,o){let r=(0,s.createShadowValue)(e,o);"value"===r.tagName.toLowerCase()&&(r=r.firstElementChild),n.Events.disable();try{const e=n.Xml.domToBlock(r,t.workspace);e&&i.connection.connect(e.outputConnection)}catch(e){}n.Events.enable()}t.mixin(N)};class c{constructor(e,t){this.block=e,this.fireEvents=!0,this.state=t||{}}setValue(e,t){if(this.fireEvents&&this.block.mutationToDom){const i=this.block.mutationToDom();this.state[e]=t.toString();const s=this.block.mutationToDom();Object.keys(this.state).forEach((e=>{i.getAttribute(e)!==this.state[e]&&s.setAttribute(e,this.state[e])}));const o=n.Xml.domToText(i),r=n.Xml.domToText(s);o!=r&&n.Events.fire(new n.Events.BlockChange(this.block,"mutation",null,o,r))}else this.state[e]=t.toString()}getNumber(e){return parseInt(this.state[e])}getBoolean(e){return"false"!=this.state[e]}getString(e){return this.state[e]}setEventsEnabled(e){this.fireEvents=e}}},{"./constants":18,"./fields":65,"./loader":71,"./toolbox":127,blockly:207}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.optionalInputWithFieldPrefix=i.optionalDummyInputPrefix=i.provider=void 0;const n=e("blockly");i.provider=new n.zelos.ConstantProvider,i.optionalDummyInputPrefix="0_optional_dummy",i.optionalInputWithFieldPrefix="0_optional_field"},{blockly:207}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.registerBlockitems=void 0;const n=e("blockly"),s=e("../external");var o,r;(r=o||(o={}))[r.Duplicate=10]="Duplicate",r[r.AddComment=20]="AddComment",r[r.ExpandCollapse=30]="ExpandCollapse",r[r.DeleteBlock=40]="DeleteBlock",r[r.Help=50]="Help",i.registerBlockitems=function(){n.ContextMenuRegistry.registry.unregister("blockDuplicate"),n.ContextMenuRegistry.registry.unregister("blockCollapseExpand"),n.ContextMenuRegistry.registry.unregister("blockHelp"),n.ContextMenuRegistry.registry.unregister("blockInline"),function(){const e={displayText:()=>lf("Duplicate"),preconditionFn(e){const t=e.block;return!t.isInFlyout&&t.isDeletable()&&t.isMovable()?t.isDuplicatable()?"enabled":"disabled":"hidden"},callback(e){if(!e.block)return;let t=!1;e.block.duplicateOnDrag_&&(e.block.duplicateOnDrag_=!1,t=!0);const i=e.block.toCopyData();t&&(e.block.duplicateOnDrag_=!0),i&&n.clipboard.paste(i,e.block.workspace)},scopeType:n.ContextMenuRegistry.ScopeType.BLOCK,id:"blockDuplicate",weight:o.Duplicate};n.ContextMenuRegistry.registry.register(e)}(),function(){const e={displayText:e=>e.block.isCollapsed()?pxt.U.lf("Expand Block"):pxt.U.lf("Collapse Block"),preconditionFn(e){const t=e.block;return t.workspace.getTopBlocks(!1).some((e=>e===t))&&t.statementInputCount>0&&!t.previousConnection&&!t.isInFlyout&&t.isMovable()&&t.workspace.options.collapse?"enabled":"hidden"},callback(e){e.block&&(pxt.tickEvent("blocks.context.expandCollapseBlock",void 0,{interactiveConsent:!0}),e.block.setCollapsed(!e.block.isCollapsed()))},scopeType:n.ContextMenuRegistry.ScopeType.BLOCK,id:"pxtExpandCollapseBlock",weight:o.ExpandCollapse};n.ContextMenuRegistry.registry.register(e)}(),function(){const e={displayText:()=>pxt.U.lf("Help"),preconditionFn(e){const t=e.block;return("function"==typeof t.helpUrl?t.helpUrl():t.helpUrl)?"enabled":"hidden"},callback(e){if(!e.block)return;const t=e.block,i="function"==typeof t.helpUrl?t.helpUrl():t.helpUrl;i&&(0,s.openHelpUrl)(i)},scopeType:n.ContextMenuRegistry.ScopeType.BLOCK,id:"pxtHelpBlock",weight:o.Help};n.ContextMenuRegistry.registry.register(e)}(),n.ContextMenuRegistry.registry.getItem("blockDelete").weight=o.DeleteBlock,n.ContextMenuRegistry.registry.getItem("blockComment").weight=o.AddComment}},{"../external":24,blockly:207}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setupWorkspaceContextMenu=i.initContextMenu=void 0;const n=e("blockly"),s=e("./workspaceItems"),o=e("../external"),r=e("./blockItems");i.initContextMenu=function(){const e=n.Msg;e.DUPLICATE_BLOCK=lf("{id:block}Duplicate"),e.DUPLICATE_COMMENT=lf("Duplicate Comment"),e.REMOVE_COMMENT=lf("Remove Comment"),e.ADD_COMMENT=lf("Add Comment"),e.EXTERNAL_INPUTS=lf("External Inputs"),e.INLINE_INPUTS=lf("Inline Inputs"),e.EXPAND_BLOCK=lf("Expand Block"),e.COLLAPSE_BLOCK=lf("Collapse Block"),e.ENABLE_BLOCK=lf("Enable Block"),e.DISABLE_BLOCK=lf("Disable Block"),e.DELETE_BLOCK=lf("Delete Block"),e.DELETE_X_BLOCKS=lf("Delete Blocks"),e.DELETE_ALL_BLOCKS=lf("Delete All Blocks"),e.HELP=lf("Help"),(0,s.registerWorkspaceItems)(),(0,r.registerBlockitems)()},i.setupWorkspaceContextMenu=function(e){try{n.ContextMenuItems.registerCommentOptions()}catch(e){}e.configureContextMenu=(t,i)=>{(0,o.onWorkspaceContextMenu)(e,t)}}},{"../external":24,"./blockItems":19,"./workspaceItems":22,blockly:207}],21:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),s(e("./contextMenu"),i)},{"./contextMenu":20}],22:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.registerWorkspaceItems=void 0;const n=e("blockly"),s=e("../layout"),o=e("../external");var r,a;(a=r||(r={}))[a.DeleteAll=20]="DeleteAll",a[a.FormatCode=30]="FormatCode",a[a.CollapseBlocks=40]="CollapseBlocks",a[a.ExpandBlocks=50]="ExpandBlocks",a[a.Snapshot=60]="Snapshot",a[a.Find=70]="Find",i.registerWorkspaceItems=function(){(function(){const e={displayText:()=>pxt.U.lf("Format Code"),preconditionFn:e=>e.workspace.options.readOnly?"hidden":"enabled",callback(e){e.workspace&&(pxt.tickEvent("blocks.context.format",void 0,{interactiveConsent:!0}),(0,s.flow)(e.workspace,{useViewWidth:!0}))},scopeType:n.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtFormatCode",weight:r.FormatCode};n.ContextMenuRegistry.registry.register(e)})(),function(){const e={displayText:()=>pxt.U.lf("Snapshot"),preconditionFn(e){if(!(0,s.screenshotEnabled)())return"hidden";const t=e.workspace,i=t.getTopBlocks(!1),n=t.getTopComments(!1);return 0===i.length&&0===n.length?"disabled":"enabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.screenshot",void 0,{interactiveConsent:!0}),(async()=>{var t,i;let n=await(0,s.screenshotAsync)(e.workspace,null,null===(t=pxt.appTarget.appTheme)||void 0===t?void 0:t.embedBlocksInSnapshot);pxt.BrowserUtils.isSafari()&&(n=await(0,s.screenshotAsync)(e.workspace,null,null===(i=pxt.appTarget.appTheme)||void 0===i?void 0:i.embedBlocksInSnapshot)),pxt.BrowserUtils.isSafari()&&(n=n.replace(/^data:image\/[^;]/,"data:application/octet-stream")),pxt.BrowserUtils.browserDownloadDataUri(n,`${pxt.appTarget.nickname||pxt.appTarget.id}-${lf("screenshot")}.png`)})())},scopeType:n.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtSnapshotCode",weight:r.Snapshot};n.ContextMenuRegistry.registry.register(e)}(),function(){const e={displayText:()=>pxt.U.lf("Collapse Blocks"),preconditionFn(e){const t=e.workspace;return t.options.readOnly||!pxt.appTarget.appTheme.blocksCollapsing?"hidden":t.getTopBlocks(!1).some((e=>e.isEnabled()&&!e.isCollapsed()))?"enabled":"disabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.collapse",void 0,{interactiveConsent:!0}),(0,s.setCollapsedAll)(e.workspace,!0))},scopeType:n.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtCollapseBlocks",weight:r.CollapseBlocks};n.ContextMenuRegistry.registry.register(e)}(),function(){const e={displayText:()=>pxt.U.lf("Expand Blocks"),preconditionFn(e){const t=e.workspace;return t.options.readOnly||!pxt.appTarget.appTheme.blocksCollapsing?"hidden":t.getTopBlocks(!1).some((e=>e.isEnabled()&&e.isCollapsed()))?"enabled":"disabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.expand",void 0,{interactiveConsent:!0}),(0,s.setCollapsedAll)(e.workspace,!1))},scopeType:n.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtExpandBlocks",weight:r.ExpandBlocks};n.ContextMenuRegistry.registry.register(e)}(),function(){const e=e=>{const t=[],i=e=>{if(e.isDeletable())t.push(...e.getDescendants(!1));else for(const t of e.getChildren(!1))i(t)};for(const t of e.getTopBlocks())i(t);return t},t={displayText:t=>e(t.workspace).filter((e=>!e.isShadow())).length>1?pxt.U.lf("Delete All Blocks"):pxt.U.lf("Delete Block"),preconditionFn:t=>t.workspace.options.readOnly?"hidden":0===e(t.workspace).filter((e=>!e.isShadow())).length?"disabled":"enabled",callback(t){if(!t.workspace)return;const i=e(t.workspace),s=i.filter((e=>!e.isShadow())).length;let o=n.utils.idGenerator.genUid();const r=()=>{let e=i.shift();e&&(e.isDeadOrDying()?r():(n.Events.setGroup(o),e.dispose(!1,!0),n.Events.setGroup(!1),setTimeout(r,10)))};pxt.tickEvent("blocks.context.delete",void 0,{interactiveConsent:!0}),s<2?r():n.dialog.confirm(lf("Delete all {0} blocks?",s),(e=>{e&&r()}))},scopeType:n.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtDeleteAllBlocks",weight:r.DeleteAll};n.ContextMenuRegistry.registry.register(t)}(),function(){const e={displayText:()=>pxt.U.lf("Find"),preconditionFn:e=>e.workspace.options.readOnly||!pxt.appTarget.appTheme.workspaceSearch?"hidden":"enabled",callback(e){e.workspace&&(pxt.tickEvent("blocks.context.find",void 0,{interactiveConsent:!0}),(0,o.openWorkspaceSearch)())},scopeType:n.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtWorkspaceFind",weight:r.Find};n.ContextMenuRegistry.registry.register(e)}(),n.ContextMenuRegistry.registry.unregister("workspaceDelete"),n.ContextMenuRegistry.registry.unregister("expandWorkspace"),n.ContextMenuRegistry.registry.unregister("collapseWorkspace"),n.ContextMenuRegistry.registry.unregister("cleanWorkspace"),n.ContextMenuRegistry.registry.unregister("redoWorkspace"),n.ContextMenuRegistry.registry.unregister("undoWorkspace")}},{"../external":24,"../layout":69,blockly:207}],23:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.decompiledDiffAsync=i.mergeXml=i.diffXml=i.needsDecompiledDiff=void 0;const n=e("blockly"),s=e("./importer"),o=e("./render");i.needsDecompiledDiff=function(e,t){if(!e||!t)return!1;const i={};if(e.replace(/id="([^"]+)"/g,((e,t)=>(i[t]=!0,""))),!Object.keys(i).length)return!1;let n=0,s=0;return t.replace(/id="([^"]+)"/g,((e,t)=>(n++,i[t]&&s++,""))),n>0&&0==s},i.diffXml=function(e,t,i){return a((0,s.loadWorkspaceXml)(e,!0),(0,s.loadWorkspaceXml)(t,!0),i)};const r="#d0d0d0";function a(e,t,i){try{return n.Events.disable(),function(e,t,i){pxt.tickEvent("blocks.diff",{started:1}),i=i||{};const a=l();if(!e)return{ws:void 0,message:lf("All blocks are new."),added:0,deleted:0,modified:1};if(!t)return{ws:void 0,message:lf("The current blocks seem corrupted."),added:0,deleted:0,modified:1};const u=pxt.Util.toDictionary(e.getTopBlocks(!1),(e=>c(e,!0)));t.getTopBlocks(!1).forEach((t=>{const i=c(t,!0),n=e.getBlockById(t.id)||u[i];n&&i==c(n,!0)&&(a("fast unmodified top ",t.id),t.dispose(!1),n.dispose(!1))}));const h=e.getAllBlocks(!1).filter((e=>e.isEnabled())),d=e.getTopBlocks(!1).filter((e=>e.isEnabled())),p=t.getAllBlocks(!1).filter((e=>e.isEnabled()));if(a("blocks",p.map((e=>e.toDevString()))),a(p),0==h.length&&0==p.length)return pxt.tickEvent("blocks.diff",{moves:1}),{ws:void 0,message:lf("Some blocks were moved or changed."),added:0,deleted:0,modified:1};const g=d.filter((e=>!t.getBlockById(e.id))),m=h.filter((e=>!t.getBlockById(e.id))),f=p.filter((t=>!e.getBlockById(t.id))),_=(0,o.initRenderingWorkspace)(),T=(0,s.saveWorkspaceXml)(t,!0);(0,s.domToWorkspaceNoEvents)(n.utils.xml.textToDom(T),_),_.getAllBlocks(!1).filter((e=>!e.isEnabled())).forEach((e=>{a("disabled ",e.toDevString()),e.dispose(!1)}));const E=pxt.Util.toDictionary(_.getAllBlocks(!1),(e=>e.id));a("todo blocks",E),A("start"),i.hideDeletedTopBlocks||(g.forEach((e=>{a(`deleted top ${e.toDevString()}`),N(e);const t=O(e);N(t),t.setEnabled(!1)})),A("deleted top")),f.map((e=>_.getBlockById(e.id))).filter((e=>!!e)).forEach((e=>{a(`added ${e.toDevString()}`),N(e)})),A("added");const b={};if(!i.hideDeletedBlocks){const e=m.filter((e=>!(E[e.id]||k(e)||e.outputConnection&&e.outputConnection.isConnected())));e.forEach((e=>{const t=O(e);b[e.id]=t.id,a(`deleted block ${e.toDevString()}->${t.toDevString()}`)})),e.forEach((e=>function(e){a(`stitching ${e.toDevString()}->${b[e.id]}`);const t=_.getBlockById(b[e.id]);t.setEnabled(!1),C(t),N(t);const i=e.getPreviousBlock();if(i){const s=_.getBlockById(b[i.id])||_.getBlockById(i.id);if(a(`previous ${e.id}->${t.toDevString()}: ${s.toDevString()}`),s)if(s.nextConnection)t.previousConnection.connect(s.nextConnection);else{const e=s.inputList.slice().reverse().find((e=>e.connection&&e.connection.type==n.NEXT_STATEMENT));e&&t.previousConnection.connect(e.connection)}}const s=e.getNextBlock();if(s){const i=_.getBlockById(b[s.id])||_.getBlockById(s.id);i&&(a(`next ${e.id}->${t.toDevString()}: ${i.toDevString()}`),t.nextConnection.connect(i.previousConnection))}}(e)))}let I=0;if(pxt.Util.values(E).filter((t=>function(t){const i=e.getBlockById(t.id);if(!i)return!1;const n=t.getPreviousBlock();if(n&&!E[n.id])return!1;const s=t.getNextBlock();if(s&&!E[s.id])return!1;const o=i.getPreviousBlock();if(!o&&!n)return!1;if(!!o!=!!n||o.id!=n.id)return!0;const r=i.getNextBlock();return!(!r&&!s||!!r==!!s&&r.id==s.id)}(t))).forEach((e=>{a(`moved ${e.toDevString()}`),delete E[e.id],C(e),I++})),A("moved"),pxt.Util.values(E).filter((t=>function(t){let i=e.getBlockById(t.id);if(!i)return!1;const n=c(i),s=c(t);return n!=s&&(a(`old ${i.toDevString()}`,n),a(`new ${t.toDevString()}`,s),!0)}(t))).forEach((e=>{a(`changed ${e.toDevString()}`),delete E[e.id],C(e),I++})),A("changed"),_.getTopBlocks(!1).forEach((e=>{(function(e){return!!e.getDescendants(!1).find((e=>k(e)))})(e)||(a(`unmodified top ${e.toDevString()}`),delete E[e.id],e.dispose(!1))})),A("cleaned"),pxt.Util.values(E).filter((e=>!!_.getBlockById(e.id))).forEach((e=>{!function e(t){t.setColour(r),function(e){e.inputList.forEach((e=>e.fieldRow.forEach((e=>{e.init()}))))}(t),i.statementsOnly&&(t.inputList||[]).map((e=>e.type==n.inputs.inputTypes.VALUE&&e.connection&&e.connection.targetBlock())).filter((e=>!!e)).forEach((t=>e(t)))}(e)})),A("unmodified"),!_.getAllBlocks(!1).length)return pxt.tickEvent("blocks.diff",{missed:1}),{ws:_,message:lf("Some blocks were changed."),deleted:m.length,added:f.length,modified:I};_.resize(),n.svgResize(_);const y=(0,o.renderWorkspace)(i.renderOptions||{emPixels:20,layout:4,aspectRatio:.5,useViewWidth:!0}),v={ws:_,svg:y,deleted:m.length,added:f.length,modified:I};return pxt.tickEvent("blocks.diff",{deleted:v.deleted,added:v.added,modified:v.modified}),v;function C(e){e.__pxt_used=!0}function k(e){return!!e.__pxt_used}function O(e){const t=n.Xml.blockToDom(e,!1),i=n.Xml.domToBlock(t,_);return i.nextConnection&&i.nextConnection.targetConnection&&i.nextConnection.disconnect(),i.previousConnection&&i.previousConnection.targetConnection&&i.previousConnection.disconnect(),i}function N(e){e.getDescendants(!1).forEach((e=>{delete E[e.id],C(e)}))}function A(e){a(`${e}:`,pxt.Util.values(E).map((e=>e.toDevString())))}}(e,t,i)}catch(e){return pxt.reportException(e),{ws:void 0,message:lf("Oops, we could not diff those blocks."),error:e,deleted:0,added:0,modified:0}}finally{n.Events.enable()}}function l(){return pxt.options.debug||window&&/diffdbg=1/.test(window.location.href)?console.log:(e,...t)=>{}}function c(e,t){const i=n.Xml.blockToDom(e,!0);return u(i),h(i,(e=>{u(e),t||("next"==e.localName||"statement"==e.localName||"shadow"==e.localName)&&e.remove()})),n.Xml.domToText(i)}function u(e){e.removeAttribute("id"),e.removeAttribute("x"),e.removeAttribute("y"),e.removeAttribute("deletable"),e.removeAttribute("editable"),e.removeAttribute("movable")}function h(e,t){if(e){t(e);for(const i of pxt.Util.toArray(e.children))h(i,t)}}function d(e,t){if(!t)return;let i,n;for(let s=0;s<e.length;++s){let o=e[s];o.startPos<=t.start&&o.endPos>=t.start+t.length&&(!i||n>o.endPos-o.startPos)&&(i=o,n=o.endPos-o.startPos)}return i?i.id:void 0}i.mergeXml=function(e,t,i){return e==t?i:i==t?e:void 0},i.decompiledDiffAsync=function(e,t,i,n,o={}){const r=l(),c=t.outfiles[pxt.MAIN_BLOCKS];let u=n.outfiles[pxt.MAIN_BLOCKS];r(c),r(u);const h=pxt.diff.compute(e,i,{ignoreWhitespace:!0,full:!0});r(h);const p={};let g=0,m=0;h.forEach(((e,i)=>{const s=e[0],o=e.substr(2);let a=o.length;switch(s){case"-":g+=a+1;break;case"+":m+=a+1;break;default:const i=/^\s+/.exec(o);if(i){const e=i[0].length;g+=e,m+=e,a-=e}const s=d(n.blockSourceMap,{start:m,length:a});if(s&&!p[s]){const i=d(t.blockSourceMap,{start:g,length:a});i&&(r(e),r(`id ${g}:${o.length}>${i} ==> ${m}:${o.length}>${s}`),p[s]=i,u=u.replace(s,i))}g+=a+1,m+=a+1}}));const f=(0,s.loadWorkspaceXml)(c,!0),_=(0,s.loadWorkspaceXml)(u,!0);return o.statementsOnly=!0,a(f,_,o)}},{"./importer":67,"./render":125,blockly:207}],24:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.openWorkspaceSearch=i.setOpenWorkspaceSearch=i.prompt=i.setPrompt=i.setOnWorkspaceContextMenu=i.onWorkspaceContextMenu=i.setOpenHelpUrl=i.openHelpUrl=i.setExtensionBlocklyPatch=i.extensionBlocklyPatch=i.setPromptTranslateBlock=i.promptTranslateBlock=void 0;const n=e("blockly");let s,o,r,a,l,c;i.promptTranslateBlock=function(e,t){s&&s(e,t)},i.setPromptTranslateBlock=function(e){s=e},i.extensionBlocklyPatch=function(e,t){o&&o(e,t)},i.setExtensionBlocklyPatch=function(e){o=e},i.openHelpUrl=function(e){r?r(e):window.open(e)},i.setOpenHelpUrl=function(e){r=e},i.onWorkspaceContextMenu=function(e,t){a&&a(e,t)},i.setOnWorkspaceContextMenu=function(e){a=e},i.setPrompt=function(e,t){t&&n.dialog.setPrompt(e),l=e},i.prompt=function(e,t,i,s){l?l(e,t,i,s):n.dialog.prompt(e,t,i)},i.setOpenWorkspaceSearch=function(e){c=e},i.openWorkspaceSearch=function(){c&&c()}},{blockly:207}],25:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.createFieldEditor=i.registerFieldEditor=i.initFieldEditors=void 0;const n=e("./field_animation"),s=e("./field_tilemap"),o=e("./field_textinput"),r=e("./field_sprite"),a=e("./field_gridpicker"),l=e("./field_colour"),c=e("./field_images"),u=e("./field_textdropdown"),h=e("./field_numberdropdown"),d=e("./field_imagedropdown"),p=e("./field_note"),g=e("./field_melodySandbox"),m=e("./field_toggle"),f=e("./field_toggle_downup"),_=e("./field_toggle_highlow"),T=e("./field_toggle_onoff"),E=e("./field_toggle_updown"),b=e("./field_toggle_winlose"),I=e("./field_toggle_yesno"),y=e("./field_protractor"),v=e("./field_position"),C=e("./field_speed"),k=e("./field_tileset"),O=e("./field_turnratio"),N=e("./field_musiceditor"),A=e("./field_sound_effect"),S=e("./field_autocomplete"),R=e("./field_colorwheel");let w={};function L(e,t,i){null==w[e]&&(w[e]={field:t,validator:i})}i.initFieldEditors=function(){var e;L("text",o.FieldTextInput),L("note",p.FieldNote),L("gridpicker",a.FieldGridPicker),L("textdropdown",u.FieldTextDropdown),L("numberdropdown",h.FieldNumberDropdown),L("imagedropdown",d.FieldImageDropdown),L("colorwheel",R.FieldColorWheel),L("toggle",m.FieldToggle),L("toggleonoff",T.FieldToggleOnOff),L("toggleyesno",I.FieldToggleYesNo),L("toggleupdown",E.FieldToggleUpDown),L("toggledownup",f.FieldToggleDownUp),L("togglehighlow",_.FieldToggleHighLow),L("togglewinlose",b.FieldToggleWinLose),L("colornumber",l.FieldColorNumber),L("images",c.FieldImages),L("sprite",r.FieldSpriteEditor),L("animation",n.FieldAnimationEditor),L("tilemap",s.FieldTilemap),L("tileset",k.FieldTileset),L("speed",C.FieldSpeed),L("turnratio",O.FieldTurnRatio),L("protractor",y.FieldProtractor),L("position",v.FieldPosition),L("melody",g.FieldCustomMelody),L("soundeffect",A.FieldSoundEffect),L("autocomplete",S.FieldAutoComplete),(null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.songEditor)&&L("musiceditor",N.FieldMusicEditor)},i.registerFieldEditor=L,i.createFieldEditor=function(e,t,i){if(null==w[e])return console.error(`Field editor ${e} not registered`),null;i||(i={}),pxt.Util.assert(null==i.lightMode,"lightMode is a reserved parameter for custom fields"),i.lightMode=pxt.options.light;let n=w[e];return new n.field(t,i,n.validator)}},{"./field_animation":26,"./field_autocomplete":29,"./field_colorwheel":31,"./field_colour":32,"./field_gridpicker":34,"./field_imagedropdown":35,"./field_images":36,"./field_melodySandbox":39,"./field_musiceditor":40,"./field_note":41,"./field_numberdropdown":42,"./field_position":43,"./field_protractor":45,"./field_sound_effect":46,"./field_speed":47,"./field_sprite":48,"./field_textdropdown":50,"./field_textinput":51,"./field_tilemap":52,"./field_tileset":53,"./field_toggle":54,"./field_toggle_downup":55,"./field_toggle_highlow":56,"./field_toggle_onoff":57,"./field_toggle_updown":58,"./field_toggle_winlose":59,"./field_toggle_yesno":60,"./field_turnratio":62}],26:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldAnimationEditor=void 0;var n=pxt.svgUtil;const s=e("./field_asset"),o=e("./field_utils"),r=32;class a extends s.FieldAssetEditor{constructor(){super(...arguments),this.onMouseEnter=()=>{if(this.animateRef||!this.asset)return;const e=this.getParentInterval()||this.asset.interval,t=e>50?e:50;let i=0;this.animateRef=setInterval((()=>{this.preview&&this.frames[i]&&this.preview.src(this.frames[i]),i=(i+1)%this.frames.length}),t)},this.onMouseLeave=()=>{this.animateRef&&clearInterval(this.animateRef),this.animateRef=void 0,this.preview&&this.frames[0]&&this.preview.src(this.frames[0])}}initView(){this.sourceBlock_.getSvgRoot().addEventListener("mouseenter",this.onMouseEnter),this.sourceBlock_.getSvgRoot().addEventListener("mouseleave",this.onMouseLeave)}showEditor_(){this.asset&&(this.asset.interval=this.getParentInterval()||this.asset.interval),super.showEditor_()}render_(){super.render_(),this.size_.height=42,this.size_.width=80}getAssetType(){return"animation"}createNewAsset(e){const t=pxt.react.getTilemapProject();if(e){const i=pxt.lookupProjectAssetByTSReference(e,t);if(i)return i;const n=function(e,t){return-1===e.indexOf("[")?null:(e=e.replace(/[\[\]]/gm,"")).split(",").map((e=>pxt.sprite.imageLiteralToBitmap(e,t).data())).filter((e=>e.height&&e.width))}(e,this.params.taggedTemplate);if(n&&n.length)return{internalID:-1,id:this.sourceBlock_.id,type:"animation",frames:n,interval:this.getParentInterval(),meta:{}};const s=t.lookupAssetByName("animation",e.trim());if(s)return s}return{internalID:-1,id:this.sourceBlock_.id,type:"animation",frames:[new pxt.sprite.Bitmap(this.params.initWidth,this.params.initHeight).data()],interval:500,meta:{}}}onEditorClose(e){this.setParentInterval(e.interval)}getValueText(){return this.asset?this.isTemporaryAsset()?"["+this.asset.frames.map((e=>pxt.sprite.bitmapToImageLiteral(pxt.sprite.Bitmap.fromData(e),"typescript",this.params.taggedTemplate))).join(",")+"]":pxt.getTSReferenceForAsset(this.asset):this.valueText||"[]"}redrawPreview(){if(!this.fieldGroup_)return;pxsim.U.clear(this.fieldGroup_);const e=(new n.Rect).at(35,1).size(40,40).corner(4).setClass("blocklyAnimationField");this.fieldGroup_.appendChild(e.el);const t=new n.Text("").at(5,26).setClass("semanticIcon");this.fieldGroup_.appendChild(t.el),this.asset&&(this.frames=this.asset.frames.map((e=>(0,o.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(e),r,this.lightMode))),this.preview=(new n.Image).src(this.frames[0]).at(39,5).size(r,r),this.fieldGroup_.appendChild(this.preview.el))}getParentIntervalBlock(){const e=this.sourceBlock_;if(e.getParent()){const t=e.getParent();for(const e of t.inputList)if("frameInterval"===e.name)return e.connection.targetBlock()}}setParentInterval(e){const t=this.getParentIntervalBlock();if(t){const i=l(t);i&&t.setFieldValue(String(e),i)}}getParentInterval(){const e=this.getParentIntervalBlock();if(e){const t=l(e);if(t)return Number(e.getFieldValue(t))}return 100}parseFieldOptions(e){return function(e){const t={initWidth:16,initHeight:16,disableResize:!1,lightMode:!1};return e?(t.lightMode=e.lightMode,e.filter&&(t.filter=e.filter),t.initWidth=i(e.initWidth,t.initWidth),t.initHeight=i(e.initHeight,t.initHeight),t.taggedTemplate=e.taggedTemplate,t):t;function i(e,t){const i=parseInt(e);return isNaN(i)?t:i}}(e)}}function l(e){return"math_number_minmax"===e.type?"SLIDER":function(e){return"math_number"===e||"math_integer"===e||"math_whole_number"===e}(e.type)?"NUM":"timePicker"===e.type?"ms":null}i.FieldAnimationEditor=a},{"./field_asset":28,"./field_utils":64}],27:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldArgumentVariable=void 0;const n=e("blockly");class s extends n.FieldVariable{constructor(e){super(e),this.menuGenerator_=this.generateMenu}generateMenu(){return n.FieldVariable.dropdownCreate.call(this).filter((e=>e[1]!=n.DELETE_VARIABLE_ID))}}i.FieldArgumentVariable=s},{blockly:207}],28:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BlocklyTilemapChange=i.FieldAssetEditor=void 0;const n=e("blockly");var s=pxt.svgUtil;const o=e("./field_base"),r=e("./field_utils"),a=32;class l extends o.FieldBase{constructor(e,t,i){super(e,t,i),this.pendingEdit=!1,this.isEmpty=!1,this.assetChangeListener=()=>{if(this.pendingEdit)return;const e=this.getBlockData();e&&(this.asset=pxt.react.getTilemapProject().lookupAsset(this.getAssetType(),e)),this.redrawPreview()},this.lightMode=t.lightMode,this.params=this.parseFieldOptions(t),this.blocksInfo=t.blocksInfo}onInit(){this.redrawPreview()}onValueChanged(e){return this.parseValueText(e),this.redrawPreview(),this.getValueText()}showEditor_(){if(this.isGreyBlock)return;const e=Object.assign({},this.params);let t;switch(e.blocksInfo=this.blocksInfo,this.asset.type){case"tile":case"image":t="image-editor",e.temporaryAssets=(0,r.getTemporaryAssets)(this.sourceBlock_.workspace,"image");break;case"animation":t="animation-editor",e.temporaryAssets=(0,r.getTemporaryAssets)(this.sourceBlock_.workspace,"image").concat((0,r.getTemporaryAssets)(this.sourceBlock_.workspace,"animation"));break;case"tilemap":t="tilemap-editor";const i=pxt.react.getTilemapProject();pxt.sprite.addMissingTilemapTilesAndReferences(i,this.asset);for(const e of(0,r.getTilesReferencedByTilesets)(this.sourceBlock_.workspace))-1===this.asset.data.projectReferences.indexOf(e.id)&&this.asset.data.projectReferences.push(e.id);break;case"song":t="music-editor",e.temporaryAssets=(0,r.getTemporaryAssets)(this.sourceBlock_.workspace,"song"),(0,r.setMelodyEditorOpen)(this.sourceBlock_,!0)}this.isFullscreen()?this.showEditorFullscreen(t,e):this.showEditorInWidgetDiv(t,e)}showEditorFullscreen(e,t){const i=pxt.react.getFieldEditorView(e,this.asset,t);this.undoRedoState&&i.restorePersistentData(this.undoRedoState),pxt.react.getTilemapProject().pushUndo(),i.onHide((()=>{this.onFieldEditorHide(i)})),i.show()}showEditorInWidgetDiv(e,t){let i,s={getScaledBBox:()=>i};n.WidgetDiv.show(s,this.sourceBlock_.RTL,(()=>{document.activeElement&&"INPUT"===document.activeElement.tagName&&document.activeElement.blur(),a.hide(),o.classList.remove("sound-effect-editor-widget"),o.style.transform="",o.style.position="",o.style.left="",o.style.top="",o.style.width="",o.style.height="",o.style.opacity="",o.style.transition="",o.style.alignItems="",this.onFieldEditorHide(a)}));const o=n.WidgetDiv.getDiv(),a=pxt.react.getFieldEditorView(e,this.asset,t,o),l=this.sourceBlock_,c=l.getBoundingRectangle(),u=(0,r.workspaceToScreenCoordinates)(l.workspace,new n.utils.Coordinate(c.right,c.top)),h=u.x-400,d=u.y+60-20;o.style.opacity="0",o.classList.add("sound-effect-editor-widget"),o.style.position="absolute",o.style.left=h+"px",o.style.top=d+"px",o.style.width="50rem",o.style.height="34.25rem",o.style.display="flex",o.style.alignItems="center",o.style.transition="transform 0.25s ease 0s, opacity 0.25s ease 0s",o.style.borderRadius="",a.onHide((()=>{n.WidgetDiv.hideIfOwner(s)})),a.show();const p=o.getBoundingClientRect(),g=l.workspace.getInjectionDiv().getBoundingClientRect();p.height>g.height?(o.style.height="",o.style.top="calc(1rem - 20px)",o.style.bottom="calc(1rem + 20px)"):(p.bottom>g.bottom||p.top<g.top)&&(o.style.top=g.top+g.height/2-p.height/2-20+"px");const m=l.workspace.getToolbox().getWidth(),f=g.left+m;if(p.width>g.width-m)o.style.width="",o.style.left="1rem",o.style.right="1rem";else if(p.left+p.width>=g.right){const e=(0,r.workspaceToScreenCoordinates)(l.workspace,new n.utils.Coordinate(c.left,c.top));e.x-p.width-20>f?o.style.left=e.x-p.width-20+"px":o.style.left=f+(g.width-m)/2-p.width/2+"px"}else p.left<g.left&&(o.style.left=f+"px");const _=o.getBoundingClientRect();i=new n.utils.Rect(_.top,_.bottom,_.left,_.right),requestAnimationFrame((()=>{o.style.opacity="1",o.style.transform="translateY(20px)"}))}onFieldEditorHide(e){var t;const i=e.getResult(),s=pxt.react.getTilemapProject();if("song"===this.asset.type&&(0,r.setMelodyEditorOpen)(this.sourceBlock_,!1),i){const o=this.getValue();if(pxt.assetEquals(this.asset,i))return;const r=c(this.asset)?null:this.asset.id;let a=c(i)?null:i.id;r||a!==this.sourceBlock_.id||(i.id=s.generateNewID(i.type),a=i.id),this.pendingEdit=!0,(null===(t=i.meta)||void 0===t?void 0:t.displayName)&&this.disposeOfTemporaryAsset(),this.asset=i;const l=s.revision();if(this.onEditorClose(this.asset),this.updateAssetListener(),this.updateAssetMeta(),this.redrawPreview(),this.undoRedoState=e.getPersistentData(),this.sourceBlock_&&n.Events.isEnabled()){const e=new u(this.sourceBlock_,"field",this.name,o,this.getValue(),l,s.revision());r!==a&&(e.oldAssetId=r,e.newAssetId=a),n.Events.fire(e)}this.pendingEdit=!1}}render_(){this.isGreyBlock&&!this.textElement_&&this.createTextElement_(),super.render_(),this.isGreyBlock||(this.size_.height=42,this.size_.width=50)}getDisplayText_(){if(this.isGreyBlock){const e=pxt.Util.htmlUnescape(this.valueText);return e.substr(0,e.indexOf("("))+"(...)"}return""}updateEditable(){if(this.isGreyBlock&&this.fieldGroup_){const e=this.fieldGroup_;n.utils.dom.removeClass(e,"blocklyNonEditableText"),n.utils.dom.removeClass(e,"blocklyEditableText"),e.style.cursor=""}else super.updateEditable()}getValue(){return this.isGreyBlock?pxt.Util.htmlUnescape(this.valueText):this.getValueText()}onDispose(){var e;(null===(e=this.sourceBlock_)||void 0===e?void 0:e.workspace)&&!this.sourceBlock_.workspace.rendered&&this.disposeOfTemporaryAsset(),pxt.react.getTilemapProject().removeChangeListener(this.getAssetType(),this.assetChangeListener)}disposeOfTemporaryAsset(){this.isTemporaryAsset()&&(pxt.react.getTilemapProject().removeAsset(this.asset),this.setBlockData(null),this.asset=void 0)}clearTemporaryAssetData(){this.isTemporaryAsset()&&this.setBlockData(null)}isTemporaryAsset(){return c(this.asset)}getAsset(){return this.asset}updateAsset(e){this.asset=e,this.setValue(this.getValue())}onEditorClose(e){}redrawPreview(){if(!this.fieldGroup_)return;if(pxsim.U.clear(this.fieldGroup_),this.isGreyBlock)return this.createTextElement_(),this.render_(),void this.updateEditable();const e=(new s.Rect).at(5,1).size(40,40).setClass("blocklySpriteField").stroke("#898989",1).corner(4);if(this.fieldGroup_.appendChild(e.el),this.asset){let e;switch(this.asset.type){case"image":case"tile":e=(0,r.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.asset.bitmap),a,this.lightMode);break;case"animation":e=(0,r.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.asset.frames[0]),a,this.lightMode);break;case"tilemap":e=(0,r.tilemapToImageURI)(this.asset.data,a,this.lightMode);break;case"song":e=(0,r.songToDataURI)(this.asset.song,60,20,this.lightMode)}if(e){const t=(new s.Image).src(e).at(9,5).size(a,a);this.fieldGroup_.appendChild(t.el)}}}parseValueText(e){if(e=pxt.Util.htmlUnescape(e),this.sourceBlock_){const t=pxt.react.getTilemapProject(),i=this.getBlockData(),n=t.lookupAsset(this.getAssetType(),i);!n||e&&this.isEmpty?(this.setBlockData(null),this.asset&&this.sourceBlock_&&this.asset.meta.blockIDs&&(this.asset.meta.blockIDs=this.asset.meta.blockIDs.filter((e=>e!==this.sourceBlock_.id)),this.isTemporaryAsset()||t.updateAsset(this.asset)),this.isEmpty=!e,this.asset=this.createNewAsset(e)):this.asset=n,this.updateAssetMeta(),this.updateAssetListener()}}parseFieldOptions(e){const t={initWidth:16,initHeight:16,disableResize:!1,lightMode:!1};return e?(e.disableResize&&(t.disableResize="true"===e.disableResize.toLowerCase()||"1"===e.disableResize),t.initWidth=i(e.initWidth,t.initWidth),t.initHeight=i(e.initHeight,t.initHeight),t.lightMode=e.lightMode,t):t;function i(e,t){const i=parseInt(e);return isNaN(i)?t:i}}updateAssetMeta(){if(this.asset){if(this.asset.meta||(this.asset.meta={}),this.asset.meta.blockIDs||(this.asset.meta.blockIDs=[]),this.sourceBlock_){if(-1===this.asset.meta.blockIDs.indexOf(this.sourceBlock_.id)){const e=this.asset.meta.blockIDs;e.length&&this.isTemporaryAsset()&&e.some((e=>this.sourceBlock_.workspace.getBlockById(e)))&&(this.asset=pxt.cloneAsset(this.asset),this.asset.meta.blockIDs=[]),this.asset.meta.blockIDs.push(this.sourceBlock_.id)}this.setBlockData(this.isTemporaryAsset()?null:this.asset.id)}this.isTemporaryAsset()?this.asset.meta.temporaryInfo={blockId:this.sourceBlock_.id,fieldName:this.name}:pxt.react.getTilemapProject().updateAsset(this.asset)}}updateAssetListener(){pxt.react.getTilemapProject().removeChangeListener(this.getAssetType(),this.assetChangeListener),this.asset&&!this.isTemporaryAsset()&&pxt.react.getTilemapProject().addChangeListener(this.asset,this.assetChangeListener)}isFullscreen(){return!0}}function c(e){return e&&!e.meta.displayName}i.FieldAssetEditor=l;class u extends n.Events.BlockChange{constructor(e,t,i,n,s,o,r){super(e,t,i,n,s),this.oldRevision=o,this.newRevision=r,this.fieldName=i}isNull(){return this.oldRevision===this.newRevision&&super.isNull()}run(e){if(this.newAssetId||this.oldAssetId){const t=this.getEventWorkspace_().getBlockById(this.blockId);e?(0,r.setBlockDataForField)(t,this.fieldName,this.newAssetId):(0,r.setBlockDataForField)(t,this.fieldName,this.oldAssetId)}e?(pxt.react.getTilemapProject().redo(),super.run(e)):(pxt.react.getTilemapProject().undo(),super.run(e));const t=this.getEventWorkspace_(),i=new u(t.getBlockById(this.blockId),"tilemap-revision","revision",null,pxt.react.getTilemapProject().revision(),0,0);i.recordUndo=!1,n.Events.fire(i)}}i.BlocklyTilemapChange=u},{"./field_base":30,"./field_utils":64,blockly:207}],29:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldAutoComplete=void 0;const n=e("blockly"),s=e("./field_utils"),o=e("./field_textdropdown"),r=e("../plugins/text");class a extends o.FieldTextDropdown{constructor(e,t,i){super(e,t,i),this.isFieldCustom_=!0,this.key=t.key,this.isTextValid_=!0}isOptionListDynamic(){return!0}getDisplayText_(){return this.parsedValue||""}doValueUpdate_(e){this.isDirty_=!0,null!==e&&(/['"`].*['"`]/.test(e)?this.parsedValue=JSON.parse(e):this.parsedValue=e,this.value_=this.parsedValue)}getValue(){return this.parsedValue?this.parsedValue:""}getOptions(){var e;const t=null===(e=this.sourceBlock_)||void 0===e?void 0:e.workspace;if(!t)return[];const i=[],n=(0,s.getAllFields)(t,(e=>e instanceof a&&e.getKey()===this.key)).map((e=>e.ref.getDisplayText_()));for(const e of n)e.trim()&&!i.some((t=>t[0]===e))&&i.push([e,e]);return i.sort(((e,t)=>e[0].localeCompare(t[0]))),i}showDropdown_(){this.getOptions().length&&super.showDropdown_()}getKey(){return this.key?this.key:this.sourceBlock_?this.sourceBlock_.type:void 0}initView(){this.quoteSize_=16,this.quoteWidth_=8,this.quoteLeftX_=0,this.quoteRightX_=0,this.quoteY_=10,this.quoteLeft_&&this.quoteLeft_.parentNode.removeChild(this.quoteLeft_),this.quoteLeft_=n.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),super.initView(),this.quoteRight_&&this.quoteRight_.parentNode.removeChild(this.quoteRight_),this.quoteRight_=n.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),this.quoteLeft_.appendChild(document.createTextNode('"')),this.quoteRight_.appendChild(document.createTextNode('"'))}updateSize_(){super.updateSize_();const e=Math.max(this.size_.width,1);let t=this.positionLeft(e+3);this.textElement_.setAttribute("x",t.toString()),t+=this.positionRight(t+e+3),this.size_.width=e+t}positionRight(e){if(!this.quoteRight_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteRightX_=r.FieldString.quotePadding,t=this.quoteWidth_+r.FieldString.quotePadding):(this.quoteRightX_=e+r.FieldString.quotePadding,t=this.quoteWidth_+r.FieldString.quotePadding),this.quoteRight_.setAttribute("transform","translate("+this.quoteRightX_+","+this.quoteY_+")"),t}positionLeft(e){if(!this.quoteLeft_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteLeftX_=e+this.quoteWidth_+2*r.FieldString.quotePadding,t=this.quoteWidth_+r.FieldString.quotePadding):(this.quoteLeftX_=0,t=this.quoteWidth_+r.FieldString.quotePadding),this.quoteLeft_.setAttribute("transform","translate("+this.quoteLeftX_+","+this.quoteY_+")"),t}createSVGArrow(){}}i.FieldAutoComplete=a},{"../plugins/text":122,"./field_textdropdown":50,"./field_utils":64,blockly:207}],30:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldBase=void 0;const n=e("blockly"),s=e("./field_utils");class o extends n.Field{constructor(e,t,i){super(e,i),this.SERIALIZABLE=!0,this.options=t,e&&!this.valueText&&(this.valueText=e)}static enqueueInit(e){o.pendingInit.push(e),this.pendingTimeout||(o.pendingTimeout=setTimeout((()=>o.flushInitQueue())))}static flushInitQueue(){for(const e of o.pendingInit)e.onLoadedIntoWorkspace();o.pendingTimeout=void 0,o.pendingInit=[]}init(){super.init(),this.onInit(),o.enqueueInit(this)}dispose(){this.onDispose()}getValue(){return this.valueText}doValueUpdate_(e){null!==e&&(this.valueText=this.loaded?this.onValueChanged(e):e)}getDisplayText_(){return this.valueText}onLoadedIntoWorkspace(){this.loaded||(this.loaded=!0,this.valueText=this.onValueChanged(this.valueText))}getAnchorDimensions(){const e=this.getScaledBBox();return this.sourceBlock_.RTL?e.right+=n.FieldDropdown.CHECKMARK_OVERHANG:e.left-=n.FieldDropdown.CHECKMARK_OVERHANG,e}isInitialized(){return!!this.fieldGroup_}getBlockData(){return(0,s.getBlockDataForField)(this.sourceBlock_,this.name)}setBlockData(e){(0,s.setBlockDataForField)(this.sourceBlock_,this.name,e)}getSiblingBlock(e,t=!1){const i=t?this.sourceBlock_.getParent():this.sourceBlock_;if(i&&i.inputList)for(const t of i.inputList)if(t.name===e)return t.connection.targetBlock()}getSiblingField(e,t=!1){const i=t?this.sourceBlock_.getParent():this.sourceBlock_;if(i)return i.getField(e)}}i.FieldBase=o,o.pendingInit=[]},{"./field_utils":64,blockly:207}],31:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldColorWheel=void 0;const n=e("../plugins/math");class s extends n.FieldSlider{constructor(e,t,i){super(String(e),"0","255","1","10","Color",i),this.isFieldCustom_=!0,this.params=t,this.params.min&&(this.min_=parseFloat(this.params.min)),this.params.max&&(this.max_=parseFloat(this.params.max)),this.params.label&&(this.labelText_=this.params.label),this.params.channel&&(this.channel_=this.params.channel)}setBackground_(e){let t=this.createColourStops_().join(",");e.style.background=`linear-gradient(left, ${t})`,this.params.sliderWidth&&(e.style.width=`${this.params.sliderWidth}px`)}setReadout_(e,t){const i=this.colorWheel(parseInt(t),this.channel_),n=document.createElement("span");n.className="blocklyColorReadout",n.style.backgroundColor=`${i}`,pxsim.U.clear(e),e.appendChild(n)}createColourStops_(){let e=[];for(let t=0;t<=255;t+=20)e.push(this.colorWheel(t,this.channel_));return e}colorWheel(e,t){return"hsvfast"==t?this.hsvFast(e,255,255):(e=255-e)<85?this.hex(3*e,255,255-3*e):e<170?(e-=85,this.hex(255,255-3*e,3*e)):(e-=170,this.hex(255-3*e,3*e,255))}hsvFast(e,t,i){let n=e%255>>0;n<0&&(n+=255);let s,o,r,a=i*(255-t)/255>>0,l=i-a,c=(n=192*n/255>>0)/64>>0,u=n%64>>0,h=(u*l/63.75>>0)+a,d=((63-u)*l/63.75>>0)+a;return c?1==c?(s=a,o=d,r=h):(s=h,o=a,r=d):(s=d,o=h,r=a),this.hex(s,o,r)}hex(e,t,i){return`#${this.componentToHex(255&e)}${this.componentToHex(255&t)}${this.componentToHex(255&i)}`}componentToHex(e){let t=e.toString(16);return 1==t.length?"0"+t:t}}i.FieldColorWheel=s},{"../plugins/math":107}],32:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldColorNumber=void 0;const n=e("blockly"),s=e("@blockly/field-colour");class o extends s.FieldColour{constructor(e,t,i){if(super(e,i),this.isFieldCustom_=!0,this.valueMode_="rgb",t.colours)this.setColours(JSON.parse(t.colours));else if(pxt.appTarget.runtime&&pxt.appTarget.runtime.palette){let e,t=pxt.Util.clone(pxt.appTarget.runtime.palette);t[0]="#dedede",pxt.appTarget.runtime.paletteNames&&((e=pxt.Util.clone(pxt.appTarget.runtime.paletteNames))[0]=lf("transparent")),this.setColours(t,e)}this.setValue(this.getColours_()[0]),t.columns&&this.setColumns(parseInt(t.columns)),t.valueMode&&(this.valueMode_=t.valueMode)}setColours(e,t){const i=super.setColours(e,t);return this.colours_=e,i}doClassValidation_(e){return"string"!=typeof e?null:r(e,this.getColours_())}getValue(e){if(e)return this.value_;switch(this.valueMode_){case"hex":return`"${this.value_}"`;case"rgb":return this.value_.indexOf("#")>-1?`0x${this.value_.replace(/^#/,"")}`:this.value_;case"index":if(!this.value_)return"-1";const e=this.getColours_();for(let t=0;t<e.length;t++)if(this.value_.toUpperCase()===e[t].toUpperCase())return t+""}return this.value_}doValueUpdate_(e){super.doValueUpdate_(r(e,this.getColours_()))}getColours_(){return this.colours_}applyColour(){const e=this.getSourceBlock();if(!e)throw new n.UnattachedFieldError;if(!this.fieldGroup_)return;const t=this.borderRect_;if(!t)throw new Error("The border rect has not been initialized");this.isFullBlockField()?(t.style.display="none",e.pathObject.svgPath.setAttribute("fill",r(this.getValue(),this.getColours_())),e.pathObject.svgPath.setAttribute("stroke","#fff")):(t.style.display="block",t.style.fill=this.getValue())}}function r(e,t){if(e){const i=/Colors\.([a-zA-Z]+)/.exec(e),n=/(0x|#)([0-9a-fA-F]+)/.exec(e);if(i)switch(i[1].toLocaleLowerCase()){case"red":return"#FF0000";case"orange":return"#FF7F00";case"yellow":return"#FFFF00";case"green":return"#00FF00";case"blue":return"#0000FF";case"indigo":return"#4B0082";case"violet":return"#8A2BE2";case"purple":return"#A033E5";case"pink":return"#FF007F";case"white":return"#FFFFFF";case"black":return"#000000";default:return e}else if(n){const e=n[2];if(3===e.length){let t="#";for(let i=0;i<e.length;i++){const n=e.charAt(i);t+=n+n}return t}if(6===e.length)return"#"+e}if(t){const i=parseInt(e);return isNaN(i)||null==t[i]?t[0]:t[i]}}return e}i.FieldColorNumber=o,n.Css.register("\n/* eslint-disable indent */\ntable.blocklyColourTable {\n    outline: none;\n    border-radius: 11px;\n}\n\ntable.blocklyColourTable > tr > td {\n    height: 22px;\n    width: 22px;\n    margin: 2px;\n    text-align: center;\n    cursor: pointer;\n    border-radius: 4px;\n    border: 2px solid rgba(0,0,0,.1);\n}\n\ntable.blocklyColourTable > tr > td:hover {\n    border: 1px solid #FFF;\n    box-sizing: border-box;\n}\n\ntable.blocklyColourTable > tr > td.blocklyColourSelected {\n    border: 1px solid #000;\n    box-sizing: border-box;\n    color: #fff;\n}\n\ntable.blocklyColourTable>tr>td.blocklyColourHighlighted {\n    border-color: #eee;\n    box-shadow: 2px 2px 7px 2px rgba(0,0,0,.3);\n    position: relative;\n}\n\n.blocklyColourSelected, .blocklyColourSelected:hover {\n    border-color: #eee !important;\n    outline: 1px solid #333;\n    position: relative;\n}\n/* eslint-enable indent */\n")},{"@blockly/field-colour":199,blockly:207}],33:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldDropdown=void 0;const n=e("blockly"),s=e("../plugins/newVariableField/fieldDropdownMixin");class o extends n.FieldDropdown{constructor(){super(...arguments),this.svgRootBinding=null,this.fieldRootBinding=null}initView(){super.initView(),this.shouldAddBorderRect_()||(this.createBorderRect_(),this.clickTargetRect=this.borderRect_,this.clickTargetRect.setAttribute("stroke-opacity","0"),this.clickTargetRect.setAttribute("fill-opacity","0"),this.borderRect_=void 0)}shouldAddBorderRect_(){if("variables_get"===this.sourceBlock_.type)return!1;for(const e of this.sourceBlock_.inputList)for(const t of e.fieldRow)if(t!==this&&t.EDITABLE)return!0;return!this.sourceBlock_.getInputsInline()||super.shouldAddBorderRect_()}bindEvents_(){this.shouldAddBorderRect_()?super.bindEvents_():(this.svgRootBinding=n.browserEvents.conditionalBind(this.sourceBlock_.getSvgRoot(),"pointerdown",this,(e=>{this.sourceBlock_.icons.length||this.onMouseDown_(e)}),!1),this.fieldRootBinding=n.browserEvents.conditionalBind(this.getSvgRoot(),"pointerdown",this,(e=>{this.sourceBlock_.icons.length&&this.onMouseDown_(e)}),!1))}dispose(){super.dispose(),this.svgRootBinding&&(n.browserEvents.unbind(this.svgRootBinding),n.browserEvents.unbind(this.fieldRootBinding))}positionBorderRect_(){super.positionBorderRect_(),this.clickTargetRect&&(this.clickTargetRect.setAttribute("width",String(this.size_.width)),this.clickTargetRect.setAttribute("height",String(this.size_.height)),this.clickTargetRect.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.clickTargetRect.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}showEditor_(e){s.showEditorMixin.call(this,e)}}i.FieldDropdown=o},{"../plugins/newVariableField/fieldDropdownMixin":109,blockly:207}],34:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldGridPicker=void 0;const n=e("blockly"),s=e("./field_utils");class o extends n.FieldDropdown{constructor(e,t,i){super(t.data),this.isFieldCustom_=!0,this.buttonClick_=e=>{let t=e.target.getAttribute("data-value");null!==t&&(this.setValue(t),this.closeModal_&&(this.close(),this.closeModal_=!1))},this.buttonClickAndClose_=e=>{this.closeModal_=!0,this.buttonClick_(e)},this.columns_=parseInt(t.columns)||4,this.maxRows_=parseInt(t.maxRows)||0,this.width_=parseInt(t.width)||void 0,this.backgroundColour_=(0,s.parseColour)(t.colour),this.borderColour_=pxt.toolbox.fadeColor(this.backgroundColour_,.4,!1);let n={xOffset:parseInt(t.tooltipsXOffset)||15,yOffset:parseInt(t.tooltipsYOffset)||-10};this.tooltipConfig_=n,this.hasSearchBar_=!!t.hasSearchBar||!1,this.hideRect_=!!t.hideRect||!1}dispose(){super.dispose(),this.disposeTooltip(),this.disposeIntersectionObserver()}createTooltip_(){this.gridTooltip_||(this.gridTooltip_=document.createElement("div"),this.gridTooltip_.className="goog-tooltip blocklyGridPickerTooltip",this.gridTooltip_.style.position="absolute",this.gridTooltip_.style.display="none",this.gridTooltip_.style.visibility="hidden",document.body.appendChild(this.gridTooltip_))}populateTableContainer(e,t,i){pxsim.U.removeChildren(t),0==e.length&&(this.firstItem_=void 0);for(let i=0;i<e.length/this.columns_;i++){let n=this.populateRow(i,e,t);t.appendChild(n)}}populateRow(e,t,i){const s=this.columns_,r=document.createElement("div");r.className="blocklyGridPickerRow";for(let a=s*e;a<Math.min(s*e+s,t.length);a++){let e=t[a][0];const s=t[a][1],l=document.createElement("div");l.className="goog-menuitem goog-option",l.setAttribute("id",":"+a),l.setAttribute("role","menuitem"),l.style.userSelect="none",l.title=e.alt||e,l.setAttribute("data-value",s);const c=document.createElement("div");c.setAttribute("class","goog-menuitem-content"),c.title=e.alt||e,c.setAttribute("data-value",s);const u="object"==typeof e;let h=this.backgroundColour_;if(s==this.getValue()&&(l.setAttribute("aria-selected","true"),pxt.BrowserUtils.addClass(l,"goog-option-selected"),h=this.sourceBlock_.getColourTertiary(),this.selectedItemDom=l,u&&!this.shouldShowTooltips()&&this.updateSelectedBar_(e,s)),l.style.backgroundColor=h,l.style.borderColor=this.borderColour_,u){const t=new Image(e.width,e.height);t.setAttribute("draggable","false"),"IntersectionObserver"in window?(t.src=o.DEFAULT_IMG,t.setAttribute("data-src",e.src),this.observer.observe(t)):t.src=e.src,t.alt=e.alt||"",t.setAttribute("data-value",s),c.appendChild(t)}else c.textContent=e;if(this.shouldShowTooltips()){n.browserEvents.conditionalBind(l,"click",this,this.buttonClickAndClose_);const e=this.sourceBlock_.RTL?-this.tooltipConfig_.xOffset:this.tooltipConfig_.xOffset,t=this.tooltipConfig_.yOffset;n.browserEvents.conditionalBind(l,"mousemove",this,(n=>{if(u){this.gridTooltip_.style.top=`${n.clientY+t}px`,this.gridTooltip_.style.left=`${n.clientX+e}px`;const i=document.elementFromPoint(n.clientX,n.clientY),s=i.title||i.alt;this.gridTooltip_.textContent=s,this.gridTooltip_.style.visibility=s?"visible":"hidden",this.gridTooltip_.style.display=s?"":"none"}pxt.BrowserUtils.addClass(l,"goog-menuitem-highlight"),i.setAttribute("aria-activedescendant",l.id)})),n.browserEvents.conditionalBind(l,"mouseout",this,(e=>{u&&(this.gridTooltip_.style.visibility="hidden",this.gridTooltip_.style.display="none"),pxt.BrowserUtils.removeClass(l,"goog-menuitem-highlight"),i.removeAttribute("aria-activedescendant")}))}else u?(this.selectedBar_.style.display="",n.browserEvents.conditionalBind(l,"click",this,(t=>{if(this.closeModal_)this.buttonClick_(t);else{const t=i.getElementsByClassName("goog-menuitem-highlight");for(let e=0;e<t.length;e++)pxt.BrowserUtils.removeClass(t[e],"goog-menuitem-highlight");pxt.BrowserUtils.addClass(l,"goog-menuitem-highlight"),this.updateSelectedBar_(e,s)}}))):(n.browserEvents.conditionalBind(l,"click",this,this.buttonClickAndClose_),n.browserEvents.conditionalBind(l,"mouseup",this,this.buttonClickAndClose_));l.appendChild(c),r.appendChild(l),0==a&&(this.firstItem_=l)}return r}shouldShowRect_(){return!this.hideRect_&&!this.sourceBlock_.isShadow()}doClassValidation_(e){return e}close(){this.disposeTooltip(),n.WidgetDiv.hideIfOwner(this),n.Events.setGroup(!1)}getFirstItem(){return this.firstItem_}highlightFirstItem(e){let t=e.childNodes;if(t.length&&t[0].childNodes){for(let e=0;e<t.length;++e){let i=t[e].childNodes.length;for(let n=0;n<i;++n){const i=t[e].childNodes[n];pxt.BrowserUtils.removeClass(i,"goog-menuitem-highlight"),pxt.BrowserUtils.removeClass(i,"goog-option-selected")}}t[0].childNodes[0].className+=" goog-menuitem-highlight"}}highlightAndScrollSelected(e,t){this.selectedItemDom&&n.utils.style.scrollIntoContainerView(this.selectedItemDom,t,!0)}showEditor_(){n.WidgetDiv.show(this,this.sourceBlock_.RTL,(()=>{this.onClose_()})),this.setupIntersectionObserver_(),this.createTooltip_();const e=document.createElement("div");this.positionMenu_(e)}positionMenu_(e){const t=n.utils.svgMath.getViewportBBox(),i=this.getAnchorDimensions_(),{paddingContainer:s,scrollContainer:o}=this.createWidget_(e),r={width:s.offsetWidth,height:s.offsetHeight},a=window.outerHeight;if(this.width_){const t=window.outerWidth;this.width_>t&&(this.width_=t),e.style.width=this.width_+"px"}let l=0;if(this.hasSearchBar_&&(l+=50),this.selectedBar_&&(l+=50),this.maxRows_){let t=e.children[0].offsetHeight*(this.maxRows_+.3);a<t+l&&(t=a-l),r.height>t&&(o.style.overflowY="auto",o.style.height=t+"px",r.height=t)}r.height+=l,n.WidgetDiv.positionWithAnchor(t,i,r,this.sourceBlock_.RTL),this.highlightAndScrollSelected(e,o)}shouldShowTooltips(){return!pxt.BrowserUtils.isMobile()}getAnchorDimensions_(){const e=this.getScaledBBox();return this.sourceBlock_.RTL?e.right+=n.FieldDropdown.CHECKMARK_OVERHANG:e.left-=n.FieldDropdown.CHECKMARK_OVERHANG,e}createWidget_(e){const t=n.WidgetDiv.getDiv(),i=this.getOptions();e.setAttribute("role","menu"),e.setAttribute("aria-haspopup","true");const s=document.createElement("div"),o=document.createElement("div");if(o.style.border=`solid 1px ${this.borderColour_}`,e.style.backgroundColor=this.backgroundColour_,s.style.backgroundColor=this.backgroundColour_,o.style.backgroundColor=this.backgroundColour_,e.className="blocklyGridPickerMenu",s.className="blocklyGridPickerScroller",o.className="blocklyGridPickerPadder",o.appendChild(s),s.appendChild(e),t.appendChild(o),this.hasSearchBar_){const t=this.createSearchBar_(e,s,i);o.insertBefore(t,o.childNodes[0])}return this.shouldShowTooltips()||(this.selectedBar_=this.createSelectedBar_(),o.appendChild(this.selectedBar_)),this.populateTableContainer(i,e,s),{paddingContainer:o,scrollContainer:s}}createSearchBar_(e,t,i){const n=document.createElement("div");n.setAttribute("class","ui fluid icon input");const s=document.createElement("i");s.setAttribute("class","search icon");const o=document.createElement("input");return o.setAttribute("type","search"),o.setAttribute("id","search-bar"),o.setAttribute("class","blocklyGridPickerSearchBar"),o.setAttribute("placeholder",pxt.Util.lf("Search")),o.addEventListener("click",(()=>{o.focus(),o.setSelectionRange(0,o.value.length)})),o.addEventListener("keyup",pxt.Util.debounce((()=>{let n=o.value,s=new RegExp(n,"i"),r=i.filter((e=>{const t=e[0].alt,i=e[1];return t?s.test(t):s.test(i)}));this.populateTableContainer.bind(this)(r,e,t),n?this.highlightFirstItem(e):this.highlightAndScrollSelected(e,t),this.gridTooltip_.style.visibility="hidden",this.gridTooltip_.style.display="none"}),300,!1)),o.addEventListener("keyup",(t=>{if(13==t.which){const t=e.childNodes[0];if(t){const e=t.childNodes[0];e&&(this.closeModal_=!0,e.click())}}})),n.appendChild(o),n.appendChild(s),n}createSelectedBar_(){const e=document.createElement("div");e.setAttribute("class","blocklyGridPickerSelectedBar"),e.style.display="none";const t=document.createElement("div"),i=document.createElement("div");i.className="blocklyGridPickerSelectedImage",t.appendChild(i),this.selectedImg_=document.createElement("img"),this.selectedImg_.setAttribute("width","30px"),this.selectedImg_.setAttribute("height","30px"),this.selectedImg_.setAttribute("draggable","false"),this.selectedImg_.style.display="none",this.selectedImg_.src=o.DEFAULT_IMG,i.appendChild(this.selectedImg_),this.selectedBarText_=document.createElement("span"),this.selectedBarText_.className="blocklyGridPickerTooltip",t.appendChild(this.selectedBarText_);const s=document.createElement("div"),r=document.createElement("div");r.className="ui buttons mini",s.appendChild(r);const a=document.createElement("button");a.className="ui button icon green";const l=document.createElement("i");l.className="icon check",a.appendChild(l),n.browserEvents.conditionalBind(a,"click",this,(()=>{this.setValue(this.selectedBarValue_),this.close()}));const c=document.createElement("button");c.className="ui button icon red";const u=document.createElement("i");return u.className="icon cancel",c.appendChild(u),n.browserEvents.conditionalBind(c,"click",this,(()=>{this.close()})),r.appendChild(a),r.appendChild(c),e.appendChild(t),e.appendChild(s),e}updateSelectedBar_(e,t){e.src&&(this.selectedImg_.src=e.src,this.selectedImg_.style.display=""),this.selectedImg_.alt=e.alt||e,this.selectedBarText_.textContent=e.alt||e,this.selectedBarValue_=t}setupIntersectionObserver_(){"IntersectionObserver"in window&&(this.disposeIntersectionObserver(),this.observer=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&(this.observer.unobserve(e.target),(e=>{const t=e.getAttribute("data-src");t&&(e.src=t,e.removeAttribute("data-src"))})(e.target))}))}),{rootMargin:"20px 0px",threshold:.01}))}disposeIntersectionObserver(){this.observer&&(this.observer=null)}disposeTooltip(){this.gridTooltip_&&(pxsim.U.remove(this.gridTooltip_),this.gridTooltip_=null)}onClose_(){this.disposeTooltip()}}i.FieldGridPicker=o,o.DEFAULT_IMG="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="},{"./field_utils":64,blockly:207}],35:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldImageDropdown=void 0;const n=e("blockly"),s=e("./field_utils"),o=e("./field_dropdown");class r extends o.FieldDropdown{constructor(e,t,i){super(t.data),this.isFieldCustom_=!0,this.buttonClick_=e=>{let t=e.target.getAttribute("data-value");t&&(this.setValue(t),n.DropDownDiv.hide())},this.columns_=parseInt(t.columns),this.maxRows_=parseInt(t.maxRows)||0,this.width_=parseInt(t.width)||300,this.backgroundColour_=(0,s.parseColour)(t.colour),this.borderColour_=pxt.toolbox.fadeColor(this.backgroundColour_,.4,!1)}showEditor_(){if(n.DropDownDiv.hideIfOwner(this))return;n.DropDownDiv.hideWithoutAnimation(),n.DropDownDiv.clearContent();let e=n.DropDownDiv.getContentDiv(),t=document.createElement("div");t.setAttribute("role","menu"),t.setAttribute("aria-haspopup","true");const i=this.getOptions();let s=0;for(let e=0;e<i.length;e++){let o=i[e][0];const r=i[e][1];if("placeholder"==o.type){let e=document.createElement("span");e.setAttribute("class","blocklyDropDownPlaceholder"),e.style.width=o.width+"px",e.style.height=o.height+"px",t.appendChild(e);continue}let a=document.createElement("button");a.setAttribute("id",":"+e),a.setAttribute("role","menuitem"),a.setAttribute("class","blocklyDropDownButton"),a.title=o.alt;let l=o.height;this.columns_?(l=this.width_/this.columns_-8,a.style.width=l+"px",a.style.height=l+"px"):(a.style.width=o.width+"px",a.style.height=o.height+"px"),l>s&&(s=l);let c=this.backgroundColour_;r==this.getValue()&&(c=this.sourceBlock_.getColourTertiary(),a.setAttribute("aria-selected","true")),a.style.backgroundColor=c,a.style.borderColor=this.borderColour_,n.browserEvents.bind(a,"click",this,this.buttonClick_),n.browserEvents.bind(a,"mouseover",this,(()=>{a.setAttribute("class","blocklyDropDownButton blocklyDropDownButtonHover"),t.setAttribute("aria-activedescendant",a.id)})),n.browserEvents.bind(a,"mouseout",this,(()=>{a.setAttribute("class","blocklyDropDownButton"),t.removeAttribute("aria-activedescendant")}));let u=document.createElement("img");u.src=o.src,a.setAttribute("data-value",r),u.setAttribute("data-value",r),a.appendChild(u),t.appendChild(a)}t.style.width=this.width_+"px",e.appendChild(t),this.maxRows_&&(e.style.maxHeight=(this.maxRows_+.4)*(s+8)+"px"),pxt.BrowserUtils.isFirefox()&&(e.style.paddingRight="20px"),n.DropDownDiv.setColour(this.backgroundColour_,this.borderColour_),n.DropDownDiv.showPositionedByField(this,this.onHide_.bind(this));let o=this.sourceBlock_;this.savedPrimary_=null==o?void 0:o.getColour(),(null==o?void 0:o.isShadow())?o.setColour(o.getColourTertiary()):this.borderRect_&&this.borderRect_.setAttribute("fill",o.getColourTertiary())}doValueUpdate_(e){this.selectedOption_=void 0,super.doValueUpdate_(e)}onHide_(){let e=n.DropDownDiv.getContentDiv();e.removeAttribute("role"),e.removeAttribute("aria-haspopup"),e.removeAttribute("aria-activedescendant"),e.style.width="",e.style.paddingRight="",e.style.maxHeight="";let t=this.sourceBlock_;(null==t?void 0:t.isShadow())?this.sourceBlock_.setColour(this.savedPrimary_):this.borderRect_&&this.borderRect_.setAttribute("fill",this.savedPrimary_)}}i.FieldImageDropdown=r,n.Css.register("\n.blocklyDropDownButton {\n    display: inline-block;\n    float: left;\n    padding: 0;\n    margin: 4px;\n    border-radius: 4px;\n    outline: none;\n    border: 1px solid;\n    transition: box-shadow .1s;\n    cursor: pointer;\n}\n\n.blocklyDropDownButtonHover {\n    box-shadow: 0px 0px 0px 4px rgba(255, 255, 255, 0.2);\n}\n\n.blocklyDropDownButton:active {\n    box-shadow: 0px 0px 0px 6px rgba(255, 255, 255, 0.2);\n}\n\n.blocklyDropDownButton > img {\n    width: 80%;\n    height: 80%;\n    margin-top: 5%\n}\n")},{"./field_dropdown":33,"./field_utils":64,blockly:207}],36:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldImages=void 0;const n=e("blockly"),s=e("./field_imagedropdown");class o extends s.FieldImageDropdown{constructor(e,t,i){super(e,t,i),this.isFieldCustom_=!0,this.shouldSort_=t.sort,this.addLabel_=!!t.addLabel}showEditor_(){if(n.DropDownDiv.hideIfOwner(this))return;let e=this.sourceBlock_;n.DropDownDiv.hideWithoutAnimation(),n.DropDownDiv.clearContent();let t=n.DropDownDiv.getContentDiv(),i=document.createElement("div");i.setAttribute("role","menu"),i.setAttribute("aria-haspopup","true");const s=this.getOptions();this.shouldSort_&&s.sort();for(let t=0;t<s.length;t++){const o=s[t][0],r=s[t][1];if("placeholder"==o.type){let e=document.createElement("span");e.setAttribute("class","blocklyDropDownPlaceholder"),e.style.width=o.width+"px",e.style.height=o.height+"px",i.appendChild(e);continue}let a=document.createElement("button");a.setAttribute("id",":"+t),a.setAttribute("role","menuitem"),a.setAttribute("class","blocklyDropDownButton"),a.title=o.alt,this.columns_?a.style.width=this.width_/this.columns_-8+"px":(a.style.width=o.width+"px",a.style.height=o.height+"px");let l=e.getColour();r==this.getValue()&&(l=e.getColourTertiary(),a.setAttribute("aria-selected","true")),a.style.backgroundColor=l,a.style.borderColor=e.getColourTertiary(),n.browserEvents.bind(a,"click",this,this.buttonClick_),n.browserEvents.bind(a,"mouseover",this,(()=>{a.setAttribute("class","blocklyDropDownButton blocklyDropDownButtonHover"),i.setAttribute("aria-activedescendant",a.id)})),n.browserEvents.bind(a,"mouseout",this,(()=>{a.setAttribute("class","blocklyDropDownButton"),i.removeAttribute("aria-activedescendant")}));let c=document.createElement("img");if(c.src=o.src,a.setAttribute("data-value",r),c.setAttribute("data-value",r),a.appendChild(c),this.addLabel_){const e=this.createTextNode_(o.alt);e.setAttribute("data-value",r),a.appendChild(e)}i.appendChild(a)}i.style.width=this.width_+"px",t.appendChild(i),n.DropDownDiv.setColour(e.getColour(),e.getColourTertiary()),n.DropDownDiv.showPositionedByField(this,this.onHideCallback.bind(this)),this.savedPrimary_=null==e?void 0:e.getColour(),(null==e?void 0:e.isShadow())?e.setColour(e.style.colourTertiary):this.borderRect_&&this.borderRect_.setAttribute("fill",e.style.colourTertiary)}onHideCallback(){let e=this.sourceBlock_;(null==e?void 0:e.isShadow())?e.setColour(this.savedPrimary_):this.borderRect_&&this.borderRect_.setAttribute("fill",this.savedPrimary_)}createTextNode_(e){const t=document.createElement("span");return t.setAttribute("class","blocklyDropdownTextLabel"),t.textContent=e,t}}i.FieldImages=o},{"./field_imagedropdown":35,blockly:207}],37:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldKind=void 0;const n=e("blockly"),s=e("./field_utils"),o=e("../external"),r=e("./field_dropdown");class a extends r.FieldDropdown{constructor(e){super(function(e){return function(){const t=[],i=this.getSourceBlock();return(null==i?void 0:i.workspace)&&!i.isInFlyout?i.workspace.getVariablesOfType(p(e.name)).forEach((e=>{t.push([e.name,e.name])})):e.initialMembers.forEach((e=>t.push([e,e]))),t.push([lf("Add a new {0}...",e.memberName),"CREATE"]),t.push([void 0,"SEPARATOR"]),t.push([lf("Rename {0}...",e.memberName),"RENAME"]),t.push([lf("Delete {0}...",e.memberName),"DELETE"]),t}}(e)),this.opts=e}initView(){super.initView()}onItemSelected_(e,t){const i=t.getValue();if("CREATE"===i)c(this.sourceBlock_.workspace,this.opts,lf("New {0}:",this.opts.memberName),(e=>e&&this.setValue(e)));else if("RENAME"===i){const e=this.sourceBlock_.workspace,t=e.getVariable(this.value_,p(this.opts.name)),i=t.name;if(-1!==this.opts.initialMembers.indexOf(i))return void n.dialog.alert(lf("The built-in {0} '{1}' cannot be renamed. Try creating a new kind instead!",this.opts.memberName,i));u(e,Object.assign(Object.assign({},this.opts),{toRename:t}),lf("Rename '{0}':",i),(t=>{const n=(0,s.getAllFields)(e,(e=>e instanceof a&&e.getValue()===i&&e.opts.name===this.opts.name));for(const e of n)e.ref.setValue(t)}))}else if("DELETE"===i){const e=this.sourceBlock_.workspace,t=e.getVariable(this.value_,p(this.opts.name)),i=t.name;if(-1!==this.opts.initialMembers.indexOf(i))return void n.dialog.alert(lf("The built-in {0} '{1}' cannot be deleted.",this.opts.memberName,i));const o=(0,s.getAllFields)(e,(e=>e instanceof a&&e.getValue()===i&&e.opts.name===this.opts.name));o.length>1?n.dialog.confirm(lf('Delete {0} uses of the "{1}" {2}?',o.length,i,this.opts.memberName),(i=>{if(i){n.Events.setGroup(!0);for(const e of o)e.block.dispose(!0);e.deleteVariableById(t.getId()),this.setValue(this.opts.initialMembers[0]),n.Events.setGroup(!1)}})):(e.deleteVariableById(t.getId()),this.setValue(this.opts.initialMembers[0]))}else super.onItemSelected_(e,t)}doClassValidation_(e){var t;return(null===(t=this.opts)||void 0===t?void 0:t.initialMembers)&&!this.opts.initialMembers.find((t=>t==e))&&this.getOptions(),super.doClassValidation_(e)}getOptions(e){return this.initVariables(),super.getOptions(e)}initVariables(){if(this.sourceBlock_&&this.sourceBlock_.workspace){const e=this.sourceBlock_.workspace,t=h(e,this.opts.name);this.opts.initialMembers.forEach((i=>{-1===t.indexOf(i)&&d(e,this.opts,i)})),"CREATE"!==this.getValue()&&"RENAME"!==this.getValue()&&"DELETE"!==this.getValue()||this.opts.initialMembers.length&&this.setValue(this.opts.initialMembers[0])}}}function l(e,t,i,s,r){(0,o.prompt)(i,null,(o=>{if(o){let a=!1;if(pxtc.isIdentifierStart(o.charCodeAt(0),2)){a=!0;for(let e=1;e<o.length;e++)pxtc.isIdentifierPart(o.charCodeAt(e),2)||(a=!1)}if(!a)return void n.dialog.alert(lf("Names must start with a letter and can only contain letters, numbers, '$', and '_'."),(()=>l(e,t,i,s,r)));if(pxt.blocks.isReservedWord(o)||"CREATE"===o||"RENAME"===o||"DELETE"===o)return void n.dialog.alert(lf("'{0}' is a reserved word and cannot be used.",o),(()=>l(e,t,i,s,r)));const c=h(e,t.name);for(let a=0;a<c.length;a++)if(c[a]===o)return void n.dialog.alert(lf("A {0} named '{1}' already exists.",t.memberName,o),(()=>l(e,t,i,s,r)));o===t.createFunctionName&&n.dialog.alert(lf("'{0}' is a reserved name.",t.createFunctionName),(()=>l(e,t,i,s,r))),s(o)}}),{placeholder:t.promptHint})}function c(e,t,i,n){l(e,t,i,(i=>{n(d(e,t,i))}),c)}function u(e,t,i,n){l(e,t,i,(i=>{e.getVariableMap().renameVariable(t.toRename,i),n(i)}),u)}function h(e,t){const i=e.getVariablesOfType(p(t));return i&&i.length?i.map((e=>e.name)):[]}function d(e,t,i){return n.Variables.getOrCreateVariablePackage(e,null,i,p(t.name)),i}function p(e){return"KIND_"+e}i.FieldKind=a},{"../external":24,"./field_dropdown":33,"./field_utils":64,blockly:207}],38:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldMatrix=void 0;const n=e("blockly"),s=/^.*[\.#].*$/;var o,r;(r=o||(o={}))[r.None=0]="None",r[r.Number=1]="Number",r[r.Letter=2]="Letter";class a extends n.Field{constructor(e,t,i){if(super(e,i),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.onColor="#FFFFFF",this.scale=1,this.matrixWidth=5,this.matrixHeight=5,this.yAxisLabel=o.None,this.xAxisLabel=o.None,this.cellState=[],this.cells=[],this.dontHandleMouseEvent_=e=>{e.stopPropagation(),e.preventDefault()},this.clearLedDragHandler=e=>{const t=this.sourceBlock_.getSvgRoot();pxsim.pointerEvents.down.forEach((e=>t.removeEventListener(e,this.dontHandleMouseEvent_))),t.removeEventListener(pxsim.pointerEvents.move,this.dontHandleMouseEvent_),document.removeEventListener(pxsim.pointerEvents.up,this.clearLedDragHandler),document.removeEventListener(pxsim.pointerEvents.leave,this.clearLedDragHandler),n.Touch.clearTouchIdentifier(),this.elt.removeEventListener(pxsim.pointerEvents.move,this.handleRootMouseMoveListener),e.stopPropagation(),e.preventDefault()},this.toggleRect=(e,t)=>{this.cellState[e][t]=this.currentDragState_,this.updateValue()},this.handleRootMouseMoveListener=e=>{if(!this.sourceBlock_.isEditable())return;let t,i;e.changedTouches&&1==e.changedTouches.length?(t=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY):(t=e.clientX,i=e.clientY);const n=document.elementFromPoint(t,i);if(!n)return;const s=n.getAttribute("data-x"),o=n.getAttribute("data-y");null!=s&&null!=o&&this.toggleRect(parseInt(s),parseInt(o))},this.params=t,void 0!==this.params.rows){let e=parseInt(this.params.rows);isNaN(e)||(this.matrixHeight=e)}if(void 0!==this.params.columns){let e=parseInt(this.params.columns);isNaN(e)||(this.matrixWidth=e)}void 0!==this.params.onColor&&(this.onColor=this.params.onColor),void 0!==this.params.offColor&&(this.offColor=this.params.offColor),void 0!==this.params.scale?this.scale=Math.max(.6,Math.min(2,Number(this.params.scale))):Math.max(this.matrixWidth,this.matrixHeight)>15?this.scale=.85:Math.max(this.matrixWidth,this.matrixHeight)>10&&(this.scale=.9)}showEditor_(){}initMatrix(){if(!this.sourceBlock_.isInsertionMarker()){this.elt=pxsim.svg.parseString('<svg xmlns="http://www.w3.org/2000/svg" id="field-matrix" />');for(let e=0;e<this.matrixWidth;e++){this.cellState.push([]),this.cells.push([]);for(let t=0;t<this.matrixHeight;t++)this.cellState[e].push(!1)}this.restoreStateFromString();for(let e=0;e<this.matrixWidth;e++)for(let t=0;t<this.matrixHeight;t++)this.createCell(e,t);if(this.updateValue(),this.xAxisLabel!==o.None){const e=this.scale*this.matrixHeight*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+2*a.CELL_VERTICAL_MARGIN+a.BOTTOM_MARGIN,t=pxsim.svg.child(this.elt,"g",{transform:`translate(0 ${e})`});for(let e=0;e<this.matrixWidth;e++){const i=this.getYAxisWidth()+this.scale*e*(a.CELL_WIDTH+a.CELL_HORIZONTAL_MARGIN)+a.CELL_WIDTH/2+a.CELL_HORIZONTAL_MARGIN/2;pxsim.svg.child(t,"text",{x:i,class:"blocklyText"}).textContent=this.getLabel(e,this.xAxisLabel)}}if(this.yAxisLabel!==o.None){const e=pxsim.svg.child(this.elt,"g",{});for(let t=0;t<this.matrixHeight;t++){const i=this.scale*t*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+a.CELL_WIDTH/2+2*a.CELL_VERTICAL_MARGIN;pxsim.svg.child(e,"text",{x:0,y:i,class:"blocklyText"}).textContent=this.getLabel(t,this.yAxisLabel)}}this.fieldGroup_.replaceChild(this.elt,this.fieldGroup_.firstChild)}}getLabel(e,t){switch(t){case o.Letter:return String.fromCharCode(e+65);default:return(e+1).toString()}}updateEditable(){let e=this.fieldGroup_;this.EDITABLE&&e&&(this.sourceBlock_.isEditable()?this.fieldGroup_.setAttribute("cursor","pointer"):this.fieldGroup_.removeAttribute("cursor"),super.updateEditable())}createCell(e,t){const i=this.scale*e*(a.CELL_WIDTH+a.CELL_HORIZONTAL_MARGIN)+a.CELL_HORIZONTAL_MARGIN+this.getYAxisWidth(),s=this.scale*t*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+a.CELL_VERTICAL_MARGIN,o=pxsim.svg.child(this.elt,"g",{transform:`translate(${i} ${s})`}),r=pxsim.svg.child(o,"rect",{class:"blocklyLed"+(this.cellState[e][t]?"On":"Off"),width:this.scale*a.CELL_WIDTH,height:this.scale*a.CELL_WIDTH,fill:this.getColor(e,t),"data-x":e,"data-y":t,rx:Math.max(2,this.scale*a.CELL_CORNER_RADIUS)});this.cells[e][t]=r,this.sourceBlock_.workspace.isFlyout||pxsim.pointerEvents.down.forEach((i=>r.addEventListener(i,(i=>{if(!this.sourceBlock_.isEditable())return;const s=this.sourceBlock_.getSvgRoot();this.currentDragState_=!this.cellState[e][t],n.hideChaff(),n.common.setSelected(this.sourceBlock_),this.toggleRect(e,t),pxsim.pointerEvents.down.forEach((e=>s.addEventListener(e,this.dontHandleMouseEvent_))),s.addEventListener(pxsim.pointerEvents.move,this.dontHandleMouseEvent_),document.addEventListener(pxsim.pointerEvents.up,this.clearLedDragHandler),document.addEventListener(pxsim.pointerEvents.leave,this.clearLedDragHandler),this.elt.addEventListener(pxsim.pointerEvents.move,this.handleRootMouseMoveListener),i.stopPropagation(),i.preventDefault()}),!1)))}getColor(e,t){return this.cellState[e][t]?this.onColor:this.offColor||a.DEFAULT_OFF_COLOR}getOpacity(e,t){const i=this.offColor?"1.0":"0.2";return this.cellState[e][t]?"1.0":i}updateCell(e,t){const i=this.cells[e][t];i.setAttribute("fill",this.getColor(e,t)),i.setAttribute("fill-opacity",this.getOpacity(e,t)),i.setAttribute("class","blocklyLed"+(this.cellState[e][t]?"On":"Off"))}setValue(e,t=!0){if(super.setValue(String(e)),this.elt){t&&this.restoreStateFromString();for(let e=0;e<this.matrixWidth;e++)for(let t=0;t<this.matrixHeight;t++)this.updateCell(e,t)}}render_(){this.visible_?(this.elt||this.initMatrix(),this.size_.height=this.scale*Number(this.matrixHeight)*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+2*a.CELL_VERTICAL_MARGIN+a.BOTTOM_MARGIN+this.getXAxisHeight(),this.size_.width=this.scale*Number(this.matrixWidth)*(a.CELL_WIDTH+a.CELL_HORIZONTAL_MARGIN)+this.getYAxisWidth()):this.markDirty()}getValue(){let e=function(e){const t=(e=(e||"").trim()).charAt(0);return t===e.charAt(e.length-1)&&-1!==u.indexOf(t)?e.substr(1,e.length-2).trim():e}(this.value_);return`\`\n${a.TAB}${e}\n${a.TAB}\``}restoreStateFromString(){let e=this.value_;if(e){const t=e.split("\n").filter((e=>s.test(e)));for(let e=0;e<t.length&&e<this.matrixHeight;e++){let i=0;const n=t[e];for(let t=0;t<n.length&&i<this.matrixWidth;t++)c(n[t])?(this.cellState[i][e]=!1,i++):l(n[t])&&(this.cellState[i][e]=!0,i++)}}}updateValue(){let e="";for(let t=0;t<this.matrixHeight;t++){for(let i=0;i<this.matrixWidth;i++)e+=(this.cellState[i][t]?"#":".")+" ";e+="\n"+a.TAB}this.setValue(e,!1)}getYAxisWidth(){return this.yAxisLabel===o.None?0:a.Y_AXIS_WIDTH}getXAxisHeight(){return this.xAxisLabel===o.None?0:a.X_AXIS_HEIGHT}}function l(e){return"#"===e||"*"===e||"1"===e}function c(e){return"."===e||"_"===e||"0"===e}i.FieldMatrix=a,a.CELL_WIDTH=25,a.CELL_HORIZONTAL_MARGIN=7,a.CELL_VERTICAL_MARGIN=5,a.CELL_CORNER_RADIUS=5,a.BOTTOM_MARGIN=9,a.Y_AXIS_WIDTH=9,a.X_AXIS_HEIGHT=10,a.TAB="        ",a.DEFAULT_OFF_COLOR="#000000";const u=["'",'"',"`"]},{blockly:207}],39:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldCustomMelody=i.TOTAL_WIDTH=i.HEADER_HEIGHT=void 0;const n=e("blockly");var s=pxt.svgUtil;const o=e("./field_utils");i.HEADER_HEIGHT=50,i.TOTAL_WIDTH=300;class r extends n.Field{constructor(e,t,i){super(e,i),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.soundingKeys=0,this.numRow=8,this.numCol=8,this.tempo=120,this.isPlaying=!1,this.timeouts=[],this.params=t,this.createMelodyIfDoesntExist()}init(){super.init(),this.onInit()}showEditor_(){n.DropDownDiv.hideWithoutAnimation(),n.DropDownDiv.clearContent(),n.DropDownDiv.setColour(this.getDropdownBackgroundColour(),this.getDropdownBorderColour());let e=n.DropDownDiv.getContentDiv();pxt.BrowserUtils.addClass(e,"melody-content-div"),pxt.BrowserUtils.addClass(e.parentElement,"melody-editor-dropdown"),this.gallery=new pxtmelody.MelodyGallery,this.renderEditor(e),this.prevString=this.getValue(),(0,o.setMelodyEditorOpen)(this.sourceBlock_,!0),n.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_,(()=>{this.onEditorClose(),pxt.BrowserUtils.removeClass(e,"melody-content-div"),pxt.BrowserUtils.removeClass(e.parentElement,"melody-editor-dropdown"),(0,o.setMelodyEditorOpen)(this.sourceBlock_,!1)}))}getValue(){return this.stringRep=this.getTypeScriptValue(),this.stringRep}doValueUpdate_(e){null==e||""==e||'""'==e||this.stringRep&&this.stringRep===e||(this.stringRep=e,this.parseTypeScriptValue(e),super.doValueUpdate_(this.getValue()))}getText_(){return this.invalidString?pxt.Util.lf("Invalid Input"):this.getValue()}onInit(){this.render_(),this.createMelodyIfDoesntExist(),this.invalidString||(this.fieldGroup_||(this.fieldGroup_=n.utils.dom.createSvgElement("g",{},null)),this.visible_||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.updateFieldLabel())}render_(){super.render_(),this.invalidString||(this.size_.width=r.MUSIC_ICON_WIDTH+(r.COLOR_BLOCK_WIDTH+r.COLOR_BLOCK_SPACING)*this.numCol),this.sourceBlock_.setColour("#ffffff")}renderEditor(e){let t=this.getDropdownBackgroundColour(),n=this.getDropdownBorderColour();this.topDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.topDiv,"melody-top-bar-div"),this.root=new s.SVG(this.topDiv).id("melody-editor-header-controls"),this.toggle=new c(this.root,{leftText:lf("Editor"),rightText:lf("Gallery"),baseColor:t}),this.toggle.onStateChange((e=>{e?this.hideGallery():this.showGallery()})),this.toggle.layout(),this.toggle.translate((i.TOTAL_WIDTH-this.toggle.width())/2,0),e.appendChild(this.topDiv),e.appendChild(this.gallery.getElement()),this.editorDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.editorDiv,"melody-editor-div"),this.editorDiv.style.setProperty("background-color",n),this.gridDiv=this.createGridDisplay(),this.editorDiv.appendChild(this.gridDiv),this.bottomDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.bottomDiv,"melody-bottom-bar-div"),this.doneButton=document.createElement("button"),pxt.BrowserUtils.addClass(this.doneButton,"melody-confirm-button"),this.doneButton.innerText=lf("Done"),this.doneButton.addEventListener("click",(()=>this.onDone())),this.doneButton.style.setProperty("background-color",t),this.playButton=document.createElement("button"),this.playButton.id="melody-play-button",this.playButton.addEventListener("click",(()=>this.togglePlay())),this.playIcon=document.createElement("i"),this.playIcon.id="melody-play-icon",pxt.BrowserUtils.addClass(this.playIcon,"play icon"),this.playButton.appendChild(this.playIcon),this.tempoInput=document.createElement("input"),pxt.BrowserUtils.addClass(this.tempoInput,"ui input"),this.tempoInput.type="number",this.tempoInput.title=lf("tempo"),this.tempoInput.id="melody-tempo-input",this.tempoInput.addEventListener("input",(()=>this.setTempo(+this.tempoInput.value))),this.syncTempoField(!0),this.bottomDiv.appendChild(this.tempoInput),this.bottomDiv.appendChild(this.playButton),this.bottomDiv.appendChild(this.doneButton),this.editorDiv.appendChild(this.bottomDiv),e.appendChild(this.editorDiv)}onEditorClose(){this.stopMelody(),this.gallery&&this.gallery.stopMelody(),this.clearDomReferences(),this.sourceBlock_&&n.Events.isEnabled()&&this.getValue()!==this.prevString&&n.Events.fire(new n.Events.BlockChange(this.sourceBlock_,"field",this.name,this.prevString,this.getValue())),this.prevString=void 0}onDone(){n.DropDownDiv.hideIfOwner(this),this.onEditorClose()}clearDomReferences(){this.topDiv=null,this.editorDiv=null,this.gridDiv=null,this.bottomDiv=null,this.doneButton=null,this.playButton=null,this.playIcon=null,this.tempoInput=null,this.elt=null,this.cells=null,this.toggle=null,this.root=null,this.gallery.clearDomReferences()}getTypeScriptValue(){return this.invalidString?this.invalidString:this.melody?'"'+this.melody.getStringRepresentation()+'"':""}parseTypeScriptValue(e){let t=e;try{e=(e=e.slice(1,-1)).trim(),this.createMelodyIfDoesntExist();let t=e.split(" ");t.forEach((e=>{if(!this.isValidNote(e))throw new Error(lf("Invalid note '{0}'. Notes can be C D E F G A B C5",e))})),this.melody.resetMelody();for(let e=0;e<t.length;e++)if("-"!=t[e]){let i=pxtmelody.noteToRow(t[e]);this.melody.updateMelody(i,e)}this.updateFieldLabel()}catch(e){pxt.log(e),this.invalidString=t}}isValidNote(e){switch(e){case"C":case"D":case"E":case"F":case"G":case"A":case"B":case"C5":case"-":return!0}return!1}getPreviewWidth(){return this.updateSize_(),this.size_.width}getPreviewHeight(){var e;return(null===(e=this.getConstants())||void 0===e?void 0:e.FIELD_BORDER_RECT_HEIGHT)||16}getDropdownBackgroundColour(){const e=this.sourceBlock_.getParent();return e?e.getColour():"#3D3D3D"}getDropdownBorderColour(){const e=this.sourceBlock_.getParent();return e?e.getColourTertiary():"#2A2A2A"}updateFieldLabel(){if(!this.fieldGroup_)return;pxsim.U.clear(this.fieldGroup_);let e=u("").appendClass("melody-editor-field-icon").at(6,15);this.fieldGroup_.appendChild(e.el);let t=this.melody.getStringRepresentation().trim().split(" ");for(let e=0;e<t.length;e++){let i=pxtmelody.getColorClass(pxtmelody.noteToRow(t[e]));const n=(new s.Rect).at((r.COLOR_BLOCK_WIDTH+r.COLOR_BLOCK_SPACING)*e+r.COLOR_BLOCK_X,r.COLOR_BLOCK_Y).size(r.COLOR_BLOCK_WIDTH,r.COLOR_BLOCK_HEIGHT).stroke("#898989",1).fill(h(pxtmelody.noteToRow(t[e]))).corners(3,2);pxt.BrowserUtils.addClass(n.el,i),this.fieldGroup_.appendChild(n.el)}}setTempo(e){(isNaN(e)||e<=0)&&this.tempoInput?this.tempoInput.value=this.tempo+"":this.tempo!=e&&(this.tempo=e,this.melody&&this.melody.setTempo(this.tempo),this.tempoInput&&(this.tempoInput.value=this.tempo+""),this.syncTempoField(!1))}syncTempoField(e){const t=this.sourceBlock_.getParent();if(t)for(const i of t.inputList)if("tempo"===i.name||"bpm"===i.name){const t=i.connection.targetBlock();t&&(e?t.getFieldValue("SLIDER")?(this.tempoInput.value=t.getFieldValue("SLIDER"),this.tempo=+this.tempoInput.value):this.tempoInput.value=this.tempo+"":("math_number_minmax"===t.type?t.setFieldValue(this.tempoInput.value,"SLIDER"):t.setFieldValue(this.tempoInput.value,"NUM"),this.tempoInput.focus()));break}}getDuration(){return 6e4/this.tempo}createMelodyIfDoesntExist(){return!this.melody&&(this.melody=new pxtmelody.MelodyArray,!0)}onNoteSelect(e,t){this.invalidString=null,this.melody.updateMelody(e,t),this.melody.getValue(e,t)&&!this.isPlaying&&this.playNote(e,t),this.updateGrid(),this.updateFieldLabel()}updateGrid(){for(let e=0;e<this.numRow;e++){const t=pxtmelody.getColorClass(e);for(let i=0;i<this.numCol;i++){const n=this.cells[e][i];this.melody.getValue(e,i)?(pxt.BrowserUtils.removeClass(n,"melody-default"),pxt.BrowserUtils.addClass(n,t)):(pxt.BrowserUtils.addClass(n,"melody-default"),pxt.BrowserUtils.removeClass(n,t))}}}playNote(e,t){let i=++this.soundingKeys;this.isPlaying?(this.timeouts.push(setTimeout((()=>{this.playToneCore(e)}),t*this.getDuration())),this.timeouts.push(setTimeout((()=>{pxt.AudioContextManager.stop()}),(t+1)*this.getDuration()))):(this.playToneCore(e),this.timeouts.push(setTimeout((()=>{this.soundingKeys==i&&pxt.AudioContextManager.stop()}),this.getDuration())))}queueToneForColumn(e,t,i){const n=setTimeout((()=>{++this.soundingKeys,pxt.AudioContextManager.stop();for(let t=0;t<this.numRow;t++)this.melody.getValue(t,e)&&this.playToneCore(t);this.highlightColumn(e,!0),this.timeouts=this.timeouts.filter((e=>e!==n))}),t),s=setTimeout((()=>{this.timeouts=this.timeouts.filter((e=>e!==s)),this.highlightColumn(e,!1)}),t+i);this.timeouts.push(n),this.timeouts.push(s)}playToneCore(e){let t=0;switch(e){case 0:t=523;break;case 1:t=494;break;case 2:t=440;break;case 3:t=392;break;case 4:t=349;break;case 5:t=330;break;case 6:t=294;break;case 7:t=262}pxt.AudioContextManager.tone(t)}highlightColumn(e,t){this.cells.map((t=>t[e])).forEach((e=>{t?pxt.BrowserUtils.addClass(e,"playing"):pxt.BrowserUtils.removeClass(e,"playing")}))}createGridDisplay(){r.VIEWBOX_WIDTH=(r.CELL_WIDTH+r.CELL_VERTICAL_MARGIN)*this.numCol+r.CELL_VERTICAL_MARGIN,pxt.BrowserUtils.isEdge()&&(r.VIEWBOX_WIDTH+=37),r.VIEWBOX_HEIGHT=(r.CELL_WIDTH+r.CELL_HORIZONTAL_MARGIN)*this.numRow+r.CELL_HORIZONTAL_MARGIN,this.elt=pxsim.svg.parseString(`<svg xmlns="http://www.w3.org/2000/svg" class="melody-grid-div" viewBox="0 0 ${r.VIEWBOX_WIDTH} ${r.VIEWBOX_HEIGHT}"/>`),this.cells=[];for(let e=0;e<this.numRow;e++)this.cells.push([]);for(let e=0;e<this.numRow;e++)for(let t=0;t<this.numCol;t++)this.createCell(e,t);return this.elt}createCell(e,t){const i=e*(r.CELL_WIDTH+r.CELL_HORIZONTAL_MARGIN)+r.CELL_HORIZONTAL_MARGIN,n=t*(r.CELL_WIDTH+r.CELL_VERTICAL_MARGIN)+r.CELL_VERTICAL_MARGIN,s=pxsim.svg.child(this.elt,"g",{transform:`translate(${n} ${i})`}),o=pxsim.svg.child(s,"rect",{cursor:"pointer",width:r.CELL_WIDTH,height:r.CELL_WIDTH,stroke:"white","data-x":e,"data-y":t,rx:r.CELL_CORNER_RADIUS});this.melody.getValue(e,t)?pxt.BrowserUtils.addClass(o,pxtmelody.getColorClass(e)):pxt.BrowserUtils.addClass(o,"melody-default"),this.sourceBlock_.workspace.isFlyout||(pxsim.pointerEvents.down.forEach((i=>o.addEventListener(i,(i=>{this.onNoteSelect(e,t),i.stopPropagation(),i.preventDefault()}),!1))),this.cells[e][t]=o)}togglePlay(){this.isPlaying?this.stopMelody():(this.isPlaying=!0,this.playMelody()),this.updatePlayButton()}updatePlayButton(){this.isPlaying?(pxt.BrowserUtils.removeClass(this.playIcon,"play icon"),pxt.BrowserUtils.addClass(this.playIcon,"stop icon")):(pxt.BrowserUtils.removeClass(this.playIcon,"stop icon"),pxt.BrowserUtils.addClass(this.playIcon,"play icon"))}playMelody(){if(this.isPlaying){for(let e=0;e<this.numCol;e++)this.queueToneForColumn(e,e*this.getDuration(),this.getDuration());this.timeouts.push(setTimeout((()=>this.playMelody()),this.numCol*this.getDuration()))}else this.stopMelody()}stopMelody(){if(this.isPlaying){for(;this.timeouts.length;)clearTimeout(this.timeouts.shift());pxt.AudioContextManager.stop(),this.isPlaying=!1,this.cells.forEach((e=>e.forEach((e=>pxt.BrowserUtils.removeClass(e,"playing")))))}}showGallery(){this.stopMelody(),this.updatePlayButton(),this.gallery.show((e=>{e&&(this.melody.parseNotes(e),this.gallery.hide(),this.toggle.toggle(),this.updateFieldLabel(),this.updateGrid())}))}hideGallery(){this.gallery.hide()}}i.FieldCustomMelody=r,r.CELL_WIDTH=25,r.CELL_HORIZONTAL_MARGIN=7,r.CELL_VERTICAL_MARGIN=5,r.CELL_CORNER_RADIUS=5,r.COLOR_BLOCK_WIDTH=10,r.COLOR_BLOCK_HEIGHT=20,r.COLOR_BLOCK_X=20,r.COLOR_BLOCK_Y=5,r.COLOR_BLOCK_SPACING=2,r.MUSIC_ICON_WIDTH=20;const a=200,l=40;class c{constructor(e,t){this.props=function(e){return e.baseColor||(e.baseColor="#e95153"),e.backgroundColor||(e.backgroundColor="rgba(52,73,94,.2)"),e.borderColor||(e.borderColor="rgba(52,73,94,.4)"),e.selectedTextColor||(e.selectedTextColor=e.baseColor),e.unselectedTextColor||(e.unselectedTextColor="hsla(0,0%,100%,.9)"),e.switchColor||(e.switchColor="#ffffff"),e}(t),this.root=e.group(),this.buildDom(),this.isLeft=!0}buildDom(){this.root.style().content("\n        .toggle-left {\n            transform: translateX(0px);\n            animation: mvleft 0.2s 0s ease;\n        }\n\n        .toggle-right {\n            transform: translateX(100px);\n            animation: mvright 0.2s 0s ease;\n        }\n\n        @keyframes mvright {\n            0% {\n                transform: translateX(0px);\n            }\n            100% {\n                transform: translateX(100px);\n            }\n        }\n\n        @keyframes mvleft {\n            0% {\n                transform: translateX(100px);\n            }\n            100% {\n                transform: translateX(0px);\n            }\n        }\n        "),this.root.def().create("clipPath","sprite-editor-toggle-border").clipPathUnits(!0).draw("rect").at(0,0).corners(.02,.1).size(1,1),this.root.draw("rect").size(a,l).fill(this.props.baseColor).stroke(this.props.borderColor,4).corners(4,4).clipPath("url(#sprite-editor-toggle-border)"),this.root.draw("rect").at(2,2).size(196,36).fill(this.props.backgroundColor).corners(4,4),this.switch=this.root.draw("rect").at(2,2).size(98,36).fill(this.props.switchColor).corners(4,4),this.leftElement=this.root.group(),this.leftText=u(this.props.leftText).appendClass("sprite-editor-text").fill(this.props.selectedTextColor),this.leftElement.appendChild(this.leftText),this.rightElement=this.root.group(),this.rightText=u(this.props.rightText).appendClass("sprite-editor-text").fill(this.props.unselectedTextColor),this.rightElement.appendChild(this.rightText),this.root.onClick((()=>this.toggle()))}toggle(e=!1){this.isLeft?(this.switch.removeClass("toggle-left"),this.switch.appendClass("toggle-right"),this.leftText.fill(this.props.unselectedTextColor),this.rightText.fill(this.props.selectedTextColor)):(this.switch.removeClass("toggle-right"),this.switch.appendClass("toggle-left"),this.leftText.fill(this.props.selectedTextColor),this.rightText.fill(this.props.unselectedTextColor)),this.isLeft=!this.isLeft,!e&&this.changeHandler&&this.changeHandler(this.isLeft)}onStateChange(e){this.changeHandler=e}layout(){this.leftText.moveTo(51,20),this.rightText.moveTo(149,20)}translate(e,t){this.root.translate(e,t)}height(){return l}width(){return a}}function u(e){return new s.Text(e).anchor("middle").setAttribute("dominant-baseline","middle").setAttribute("dy",pxt.BrowserUtils.isIE()||pxt.BrowserUtils.isEdge()?"0.3em":"0.1em")}function h(e){switch(e){case 0:return"#A80000";case 1:return"#D83B01";case 2:return"#FFB900";case 3:return"#107C10";case 4:return"#008272";case 5:return"#0078D7";case 6:return"#5C2D91";case 7:return"#B4009E"}return"#DCDCDC"}},{"./field_utils":64,blockly:207}],40:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldMusicEditor=void 0;var n=pxt.svgUtil;const s=e("./field_asset"),o=e("./field_utils");class r extends s.FieldAssetEditor{getAssetType(){return"song"}createNewAsset(e){const t=pxt.react.getTilemapProject();if(e){const i=pxt.lookupProjectAssetByTSReference(e,t);if(i)return i}if(this.getBlockData())return t.lookupAsset("song",this.getBlockData());let i;if(e){const t=/^\s*hex\s*`([a-fA-F0-9]+)`\s*(?:;?)\s*$/.exec(e);t&&(i=pxt.assets.music.decodeSongFromHex(t[1]))}else i=pxt.assets.music.getEmptySong(2);return i?(pxt.assets.music.inflateSong(i),{internalID:-1,id:this.sourceBlock_.id,type:"song",meta:{},song:i}):(this.isGreyBlock=!0,void(this.valueText=e))}render_(){super.render_(),this.isGreyBlock||(this.size_.height=42,this.size_.width=18+this.previewWidth())}getValueText(){return this.asset&&!this.isTemporaryAsset()?pxt.getTSReferenceForAsset(this.asset):this.asset?`hex\`${pxt.assets.music.encodeSongToHex(this.asset.song)}\``:this.valueText||""}parseFieldOptions(e){return{}}redrawPreview(){var e;if(!this.fieldGroup_)return;if(pxsim.U.clear(this.fieldGroup_),this.isGreyBlock)return void super.redrawPreview();const t=18+this.previewWidth(),i=(new n.Rect).at(5,1).size(8+this.previewWidth(),40).setClass("blocklySpriteField").stroke("#898989",1).corner(4);if(this.fieldGroup_.appendChild(i.el),this.asset){const e=(0,o.songToDataURI)(this.asset.song,this.previewWidth(),32,this.lightMode);if(e){const t=(new n.Image).src(e).at(9,5).size(this.previewWidth(),32);this.fieldGroup_.appendChild(t.el)}}(null===(e=this.size_)||void 0===e?void 0:e.width)!=t&&this.forceRerender()}previewWidth(){return 32*(this.asset?this.asset.song.measures:2)}}i.FieldMusicEditor=r},{"./field_asset":28,"./field_utils":64}],41:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldNote=void 0;const n=e("blockly"),s=e("./field_utils");var o,r;(r=o||(o={}))[r.C=262]="C",r[r.CSharp=277]="CSharp",r[r.D=294]="D",r[r.Eb=311]="Eb",r[r.E=330]="E",r[r.F=349]="F",r[r.FSharp=370]="FSharp",r[r.G=392]="G",r[r.GSharp=415]="GSharp",r[r.A=440]="A",r[r.Bb=466]="Bb",r[r.B=494]="B",r[r.C3=131]="C3",r[r.CSharp3=139]="CSharp3",r[r.D3=147]="D3",r[r.Eb3=156]="Eb3",r[r.E3=165]="E3",r[r.F3=175]="F3",r[r.FSharp3=185]="FSharp3",r[r.G3=196]="G3",r[r.GSharp3=208]="GSharp3",r[r.A3=220]="A3",r[r.Bb3=233]="Bb3",r[r.B3=247]="B3",r[r.C4=262]="C4",r[r.CSharp4=277]="CSharp4",r[r.D4=294]="D4",r[r.Eb4=311]="Eb4",r[r.E4=330]="E4",r[r.F4=349]="F4",r[r.FSharp4=370]="FSharp4",r[r.G4=392]="G4",r[r.GSharp4=415]="GSharp4",r[r.A4=440]="A4",r[r.Bb4=466]="Bb4",r[r.B4=494]="B4",r[r.C5=523]="C5",r[r.CSharp5=555]="CSharp5",r[r.D5=587]="D5",r[r.Eb5=622]="Eb5",r[r.E5=659]="E5",r[r.F5=698]="F5",r[r.FSharp5=740]="FSharp5",r[r.G5=784]="G5",r[r.GSharp5=831]="GSharp5",r[r.A5=880]="A5",r[r.Bb5=932]="Bb5",r[r.B5=988]="B5",r[r.C6=1047]="C6",r[r.CSharp6=1109]="CSharp6",r[r.D6=1175]="D6",r[r.Eb6=1245]="Eb6",r[r.E6=1319]="E6",r[r.F6=1397]="F6",r[r.FSharp6=1480]="FSharp6",r[r.G6=1568]="G6",r[r.GSharp6=1568]="GSharp6",r[r.A6=1760]="A6",r[r.Bb6=1865]="Bb6",r[r.B6=1976]="B6",r[r.C7=2093]="C7";class a extends n.FieldNumber{constructor(e,t,i){super(null,0,null,null,i),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.isTextValid_=!0,this.nKeys_=36,this.minNote_=28,this.maxNote_=63,this.eps=2,this.setSpellcheck(!1),this.prepareNotes(),this.isExpanded=!1,this.currentPage=0,this.totalPlayCount=0,t.editorColour&&(this.primaryColour=(0,s.parseColour)(t.editorColour),this.borderColour=n.utils.colour.blend("#000000",this.primaryColour,.2));const o=parseInt(t.eps);!Number.isNaN(o)&&o>=0&&(this.eps=o);const r=parseInt(t.minNote)||this.minNote_,a=parseInt(t.maxNote)||this.maxNote_;r>=28&&a<=75&&a>r&&(this.minNote_=r,this.maxNote_=a,this.nKeys_=this.maxNote_-this.minNote_+1),this.setValue(e)}doClassValidation_(e){const t=/^Note\.(.+)$/.exec(e),i=t&&t.length>1?t[1]:null;if(null===(e=o[i]?o[i]:String(parseFloat(e||"0"))))return null;const n=parseFloat(e||"0");if(isNaN(n)||n<0)return null;const s=Math.floor(n)!=n;return Number(n.toFixed(s?2:0))}getValue(){return this.value_+""}doValueUpdate_(e){isNaN(Number(e))||Number(e)<0||(this.sourceBlock_&&n.Events.isEnabled()&&this.value_!=e&&n.Events.fire(new n.Events.BlockChange(this.sourceBlock_,"field",this.name,this.value_,e)),this.value_=e,this.refreshText())}getText(){if(this.isExpanded)return""+this.value_;{const e=+this.value_;for(let t=0;t<this.nKeys_;t++)if(Math.abs(this.getKeyFreq(t+this.minNote_)-e)<this.eps)return this.getKeyName(t+this.minNote_);let t=e.toString();return isNaN(e)||(t+=" Hz"),t}}refreshText(){this.forceRerender()}onFinishEditing_(e){this.refreshText()}onHide(){this.isExpanded=!1,this.refreshText()}showEditor_(e){this.isExpanded=!0,this.updateColor(),n.DropDownDiv.hideWithoutAnimation(),n.DropDownDiv.clearContent();const t=pxt.BrowserUtils.isMobile()||pxt.BrowserUtils.isIOS();super.showEditor_(e,t),this.refreshText(),n.Events.setGroup(!0),this.piano=[],this.currentSelectedKey=void 0;const i=this.nKeys_-this.nKeys_/a.notesPerOctave*a.blackKeysPerOctave,s=a.notesPerOctave-a.blackKeysPerOctave;let o=a.keyWidth*i,r=a.keyHeight+a.labelHeight;const c=window.innerWidth<o;c&&(o=s*a.keyWidth,r=a.keyHeight+a.labelHeight+a.prevNextHeight);const u=l("blocklyPianoDiv",`width: ${o}px;\n            height: ${r}px;`);n.DropDownDiv.getContentDiv().appendChild(u),this.noteLabel=l("blocklyNoteLabel",`top: ${a.keyHeight}px;\n            width: ${o}px;\n            background-color: ${this.primaryColour};\n            border-color: ${this.primaryColour};`),u.appendChild(this.noteLabel),this.noteLabel.textContent="-";let h=0;for(let e=0;e<this.nKeys_;e++){const t=Math.floor(e/a.notesPerOctave);let i=this.getPosition(e+this.minNote_);c&&e>=a.notesPerOctave&&(i-=s*t*a.keyWidth);const n=this.getKeyDiv(e+this.minNote_,i);this.piano.push(n),u.appendChild(n),Math.abs(this.getKeyFreq(e+this.minNote_)-Number(this.getValue()))<this.eps&&(pxt.BrowserUtils.addClass(n,"selected"),this.currentSelectedKey=n,h=t)}c&&(this.setPage(h),u.appendChild(this.getNextPrevDiv(!0,o)),u.appendChild(this.getNextPrevDiv(!1,o))),n.DropDownDiv.setColour(this.primaryColour,this.borderColour),n.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_,(()=>this.onHide()))}playKey(e,t){const i=++this.totalPlayCount;this.currentSelectedKey!==e&&(this.currentSelectedKey&&pxt.BrowserUtils.removeClass(this.currentSelectedKey,"selected"),pxt.BrowserUtils.addClass(e,"selected"),this.setValue(t)),this.currentSelectedKey=e,this.htmlInput_.value=this.getText(),pxt.AudioContextManager.tone(t),setTimeout((()=>{this.totalPlayCount==i&&pxt.AudioContextManager.stop()}),300)}dispose(){n.DropDownDiv.hideIfOwner(this),super.dispose()}updateColor(){const e=this.sourceBlock_.getParent();e&&(this.sourceBlock_.isShadow()||function(e){return 1===e.inputList.length&&1===e.inputList[0].fieldRow.length}(this.sourceBlock_))?(this.primaryColour=e.getColour(),this.borderColour=e.getColourTertiary()):(this.primaryColour="#3D3D3D",this.borderColour="#2A2A2A")}setPage(e){const t=this.nKeys_/a.notesPerOctave;e=Math.max(Math.min(e,t-1),0),this.noteLabel.textContent=`Octave #${e+1}`;const i=e*a.notesPerOctave;for(let e=0;e<this.piano.length;++e){const t=e>=i&&e<i+a.notesPerOctave;this.piano[e].style.display=t?"block":"none"}this.currentPage=e}getNextPrevDiv(e,t){const i=e?0:t/2,s=l("blocklyNotePrevNext",`top: ${a.keyHeight+a.labelHeight}px;\n            left: ${i}px;\n            width: ${Math.ceil(t/2)}px;\n            ${e?"border-left-color":"border-right-color"}: ${this.primaryColour};\n            background-color: ${this.primaryColour};\n            border-bottom-color: ${this.primaryColour};`);return pxt.BrowserUtils.pointerEvents.down.forEach((t=>{n.browserEvents.conditionalBind(s,t,this,(()=>this.setPage(e?this.currentPage-1:this.currentPage+1)),!0)})),s.textContent=e?"<":">",s}getKeyDiv(e,t){const i=l("blocklyNote "+(this.isWhite(e)?"":"black"),`width: ${this.getKeyWidth(e)}px;\n            height: ${this.getKeyHeight(e)}px;\n            left: ${t}px;\n            border-color: ${this.primaryColour};`);return pxt.BrowserUtils.pointerEvents.down.forEach((t=>{n.browserEvents.conditionalBind(i,t,this,(()=>this.playKey(i,this.getKeyFreq(e))),!0)})),n.browserEvents.conditionalBind(i,"mouseover",this,(t=>{this.noteLabel.textContent=this.getKeyName(e),t.buttons&&this.playKey(i,this.getKeyFreq(e))}),!0),i}isWhite(e){switch((e+=8)%12){case 1:case 3:case 6:case 8:case 10:return!1;default:return!0}}whiteKeysBefore(e){switch((e+=8)%12){case 0:return 0;case 1:case 2:return 1;case 3:case 4:return 2;case 5:return 3;case 6:case 7:return 4;case 8:case 9:return 5;case 10:case 11:return 6}return-1}getKeyWidth(e){return this.isWhite(e)?a.keyWidth:a.keyWidth/2}getKeyHeight(e){return this.isWhite(e)?a.keyHeight:a.keyHeight/2}getKeyFreq(e){return this.getKeyNoteData(e).freq}getKeyName(e){const t=this.getKeyNoteData(e);let i=t.prefixedName;return this.nKeys_<=a.notesPerOctave?i=t.name:this.minNote_>=28&&this.maxNote_<=63&&(i=t.altPrefixedName||i),i}getKeyNoteData(e){return a.Notes[e]}getPosition(e){if(e===this.minNote_)return 0;const t=a.keyWidth/4,i=Math.floor((this.minNote_+8)/a.notesPerOctave),n=Math.floor((e+8)/a.notesPerOctave);let s=this.whiteKeysBefore(this.minNote_)*a.keyWidth;if(this.isWhite(this.minNote_)||(s-=t),n>i){const o=7*a.keyWidth,r=o-s+(n-i-1)*o;return this.whiteKeysBefore(e)*a.keyWidth+r-(this.isWhite(e)?0:t)}return this.whiteKeysBefore(e)*a.keyWidth-s-(this.isWhite(e)?0:t)}prepareNotes(){a.Notes||(a.Notes={28:{name:lf("{id:note}C"),prefixedName:lf("Low C"),freq:131},29:{name:lf("C#"),prefixedName:lf("Low C#"),freq:139},30:{name:lf("{id:note}D"),prefixedName:lf("Low D"),freq:147},31:{name:lf("D#"),prefixedName:lf("Low D#"),freq:156},32:{name:lf("{id:note}E"),prefixedName:lf("Low E"),freq:165},33:{name:lf("{id:note}F"),prefixedName:lf("Low F"),freq:175},34:{name:lf("F#"),prefixedName:lf("Low F#"),freq:185},35:{name:lf("{id:note}G"),prefixedName:lf("Low G"),freq:196},36:{name:lf("G#"),prefixedName:lf("Low G#"),freq:208},37:{name:lf("{id:note}A"),prefixedName:lf("Low A"),freq:220},38:{name:lf("A#"),prefixedName:lf("Low A#"),freq:233},39:{name:lf("{id:note}B"),prefixedName:lf("Low B"),freq:247},40:{name:lf("{id:note}C"),prefixedName:lf("Middle C"),freq:262},41:{name:lf("C#"),prefixedName:lf("Middle C#"),freq:277},42:{name:lf("{id:note}D"),prefixedName:lf("Middle D"),freq:294},43:{name:lf("D#"),prefixedName:lf("Middle D#"),freq:311},44:{name:lf("{id:note}E"),prefixedName:lf("Middle E"),freq:330},45:{name:lf("{id:note}F"),prefixedName:lf("Middle F"),freq:349},46:{name:lf("F#"),prefixedName:lf("Middle F#"),freq:370},47:{name:lf("{id:note}G"),prefixedName:lf("Middle G"),freq:392},48:{name:lf("G#"),prefixedName:lf("Middle G#"),freq:415},49:{name:lf("{id:note}A"),prefixedName:lf("Middle A"),freq:440},50:{name:lf("A#"),prefixedName:lf("Middle A#"),freq:466},51:{name:lf("{id:note}B"),prefixedName:lf("Middle B"),freq:494},52:{name:lf("{id:note}C"),prefixedName:lf("Tenor C"),altPrefixedName:lf("High C"),freq:523},53:{name:lf("C#"),prefixedName:lf("Tenor C#"),altPrefixedName:lf("High C#"),freq:554},54:{name:lf("{id:note}D"),prefixedName:lf("Tenor D"),altPrefixedName:lf("High D"),freq:587},55:{name:lf("D#"),prefixedName:lf("Tenor D#"),altPrefixedName:lf("High D#"),freq:622},56:{name:lf("{id:note}E"),prefixedName:lf("Tenor E"),altPrefixedName:lf("High E"),freq:659},57:{name:lf("{id:note}F"),prefixedName:lf("Tenor F"),altPrefixedName:lf("High F"),freq:698},58:{name:lf("F#"),prefixedName:lf("Tenor F#"),altPrefixedName:lf("High F#"),freq:740},59:{name:lf("{id:note}G"),prefixedName:lf("Tenor G"),altPrefixedName:lf("High G"),freq:784},60:{name:lf("G#"),prefixedName:lf("Tenor G#"),altPrefixedName:lf("High G#"),freq:831},61:{name:lf("{id:note}A"),prefixedName:lf("Tenor A"),altPrefixedName:lf("High A"),freq:880},62:{name:lf("A#"),prefixedName:lf("Tenor A#"),altPrefixedName:lf("High A#"),freq:932},63:{name:lf("{id:note}B"),prefixedName:lf("Tenor B"),altPrefixedName:lf("High B"),freq:988},64:{name:lf("{id:note}C"),prefixedName:lf("High C"),freq:1046},65:{name:lf("C#"),prefixedName:lf("High C#"),freq:1109},66:{name:lf("{id:note}D"),prefixedName:lf("High D"),freq:1175},67:{name:lf("D#"),prefixedName:lf("High D#"),freq:1245},68:{name:lf("{id:note}E"),prefixedName:lf("High E"),freq:1319},69:{name:lf("{id:note}F"),prefixedName:lf("High F"),freq:1397},70:{name:lf("F#"),prefixedName:lf("High F#"),freq:1478},71:{name:lf("{id:note}G"),prefixedName:lf("High G"),freq:1568},72:{name:lf("G#"),prefixedName:lf("High G#"),freq:1661},73:{name:lf("{id:note}A"),prefixedName:lf("High A"),freq:1760},74:{name:lf("A#"),prefixedName:lf("High A#"),freq:1865},75:{name:lf("{id:note}B"),prefixedName:lf("High B"),freq:1976}})}}function l(e,t){const i=document.createElement("div");return pxt.BrowserUtils.addClass(i,e),i.setAttribute("style",t.replace(/\s+/g," ")),i}i.FieldNote=a,a.keyWidth=22,a.keyHeight=90,a.labelHeight=24,a.prevNextHeight=20,a.notesPerOctave=12,a.blackKeysPerOctave=5},{"./field_utils":64,blockly:207}],42:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldNumberDropdown=void 0;const n=e("./field_textdropdown");class s extends n.BaseFieldTextDropdown{constructor(e,t,i,n,s,o){super(e+"",t,o),this.setConstraints(i,n,s)}setConstraints(e,t,i){this.setMinInternal(e),this.setMaxInternal(t),this.setPrecisionInternal(i),this.setValue(this.getValue())}getValue(){return Number(super.getValue())}setMinInternal(e){null==e?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))}setMaxInternal(e){null==e?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))}setPrecisionInternal(e){this.precision_=Number(e)||0;let t=String(this.precision_);-1!==t.indexOf("e")&&(t=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const i=t.indexOf(".");this.decimalPlaces=-1===i?e?0:null:t.length-i-1}doClassValidation_(e){if(null===e)return null;e=(e=(e=(e=`${e}`).replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity");let t=Number(e||0);return isNaN(t)?null:(t=Math.min(Math.max(t,this.min_),this.max_),this.precision_&&isFinite(t)&&(t=Math.round(t/this.precision_)*this.precision_),null!==this.decimalPlaces&&(t=Number(t.toFixed(this.decimalPlaces))),t+"")}}i.FieldNumberDropdown=class extends s{constructor(e,t,i){super(e,function(e){let t;if(e.values){const i=[],n=e.values.split(",");let s=!1;for(const e of n){const t=parseFloat(e);if(Number.isNaN(t)){s=!0;break}i.push([e,t])}s||(t=i)}else if(e.data)try{const i=JSON.parse(e.data);if(Array.isArray(i)&&i.length){if(function(e){for(const t of e)if("number"!=typeof t)return!1;return!0}(i))return i.map((e=>[""+e,e]));{let e=!1;for(const t of i)if(!Array.isArray(t)||"string"!=typeof t[0]||"number"!=typeof t[1]){e=!0;break}e||(t=i)}}}catch(e){}return t||(console.warn("Could not parse numberdropdown data field"),[])}(t),t.min,t.max,t.precision,i),this.isFieldCustom_=!0}getOptions(){let e;return this.menuGenerator_&&("string"==typeof this.menuGenerator_&&(this.menuGenerator_=JSON.parse(this.menuGenerator_)),e=this.menuGenerator_.map((e=>"object"==typeof e?[pxt.Util.rlf(e[0]),e[1]]:[String(e),String(e)]))),e}}},{"./field_textdropdown":50}],43:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldPosition=void 0;const n=e("blockly"),s=e("../plugins/math");class o extends s.FieldSlider{constructor(e,t,i){super(e,"0","100","1","1","Value",i),this.isFieldCustom_=!0,this.params=t,this.params.screenHeight||(this.params.screenHeight=120),this.params.screenWidth||(this.params.screenWidth=160),this.params.xInputName||(this.params.xInputName="x"),this.params.yInputName||(this.params.yInputName="y"),this.params.min&&(this.min_=parseInt(this.params.min)),this.params.max&&(this.max_=parseInt(this.params.max))}showEditor_(e){this.getFieldByName(this.params.xInputName)===this&&(this.max_=this.params.screenWidth,this.labelText_=this.params.xInputName),this.getFieldByName(this.params.yInputName)===this&&(this.max_=this.params.screenHeight,this.labelText_=this.params.yInputName),super.showEditor_(e),this.renderScreenPicker()}doValueUpdate_(e){super.doValueUpdate_(e),this.resetCrosshair&&this.resetCrosshair()}renderScreenPicker(){let e=n.DropDownDiv.getContentDiv();this.selectorDiv_=document.createElement("div"),this.selectorDiv_.className="blocklyCanvasOverlayOuter",e.appendChild(this.selectorDiv_);const t=document.createElement("div");t.className="blocklyCanvasOverlayDiv",this.selectorDiv_.appendChild(t);const i=document.createElement("div");i.className="cross-x",t.appendChild(i);const s=document.createElement("div");s.className="cross-y",t.appendChild(s);const o=document.createElement("div");o.className="label",t.appendChild(o);const r=1.5*this.params.screenWidth,a=1.5*this.params.screenHeight;t.style.height=a+"px",t.style.width=r+"px";const l=e.getElementsByClassName("goog-slider-horizontal")[0];if(l){l.style.width=r+"px";const e=Number(this.getValue());!isNaN(e)&&e>this.getMin()&&(this.setValue(e-1+""),this.setValue(e+""))}const c=(e,t)=>{e=Math.round(Math.max(0,Math.min(r,e))),t=Math.round(Math.max(0,Math.min(a,t))),i.style.top=t+"px",s.style.left=e+"px",e=Math.round(Math.max(0,Math.min(this.params.screenWidth,e/r*this.params.screenWidth))),t=Math.round(Math.max(0,Math.min(this.params.screenHeight,t/a*this.params.screenHeight))),isNaN(e)?o.textContent=`${this.params.yInputName}=${t}`:isNaN(t)?o.textContent=`${this.params.xInputName}=${e}`:o.textContent=`${this.params.xInputName}=${e} ${this.params.yInputName}=${t}`;const n=o.getBoundingClientRect();e>this.params.screenWidth/2?o.style.left=e*(r/this.params.screenWidth)-n.width-8+"px":o.style.left=e*(r/this.params.screenWidth)+4+"px",t>this.params.screenHeight/2?o.style.top=t*(a/this.params.screenHeight)-n.height-6+"px":o.style.top=t*(a/this.params.screenHeight)+"px"};this.resetCrosshair=()=>{const{currentX:e,currentY:t}=this.getXY();c(e/this.params.screenWidth*r,t/this.params.screenHeight*a)},this.resetCrosshair(),n.browserEvents.bind(this.selectorDiv_,"mousemove",this,(e=>{const i=t.getBoundingClientRect(),n=e.clientX-i.left,s=e.clientY-i.top;c(n,s)})),n.browserEvents.bind(this.selectorDiv_,"mouseleave",this,this.resetCrosshair),n.browserEvents.bind(this.selectorDiv_,"click",this,(e=>{const i=t.getBoundingClientRect(),n=e.clientX-i.left,s=e.clientY-i.top,o=Math.round(n/r*this.params.screenWidth),l=Math.round(s/a*this.params.screenHeight);this.close(),this.setXY(o,l)}))}resizeHandler(){this.close()}setXY(e,t){const i=this.getFieldByName(this.params.xInputName);i&&"number"==typeof i.getValue()&&i.setValue(String(e));const n=this.getFieldByName(this.params.yInputName);n&&"number"==typeof n.getValue()&&n.setValue(String(t))}getFieldByName(e){const t=this.sourceBlock_.getParent();if(t)for(let i=0;i<t.inputList.length;i++){const n=t.inputList[i];if(n.name===e)return this.getTargetField(n)}}getXY(){let e,t;const i=this.getFieldByName(this.params.xInputName);i&&(e=i.getValue());const n=this.getFieldByName(this.params.yInputName);return n&&(t=n.getValue()),{currentX:parseInt(e),currentY:parseInt(t)}}getTargetField(e){const t=e.connection.targetBlock();if(!t)return null;const i=t.inputList[0];return i?i.fieldRow[0]:null}widgetDispose_(){super.widgetDispose_(),this.close(!0)}close(e){e||(n.WidgetDiv.hideIfOwner(this),n.DropDownDiv.hideIfOwner(this)),window.removeEventListener("resize",this.resizeHandler),this.resetCrosshair=void 0,this.selectorDiv_&&(n.utils.dom.removeNode(this.selectorDiv_),this.selectorDiv_=void 0)}}i.FieldPosition=o},{"../plugins/math":107,blockly:207}],44:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldProcedure=void 0;const n=e("./field_dropdown");class s extends n.FieldDropdown{constructor(e,t){super((function(){let e=[];if(this.sourceBlock_&&this.sourceBlock_.workspace){let t=this.sourceBlock_.workspace.getAllBlocks(!1);for(let i=0;i<t.length;i++)if(t[i].getProcedureDef){let n=t[i].getProcedureDef();e.push(n[0])}}let t=this.getValue();t&&-1==e.indexOf(t)&&e.push(t),e.sort(((e,t)=>{const i=e.toLowerCase(),n=t.toLowerCase();return i===n?0:i>n?1:-1})),e.length||e.push("Temp"),this.rawValue&&-1===e.indexOf(this.rawValue)&&e.push(this.rawValue);let i=[];for(let t=0;t<e.length;t++)i[t]=[e[t],e[t]];return i}),t),this.setValue(e||"")}getOptions(e){return this.menuGenerator_()}doClassValidation_(e){return void 0===e?null:e}doValueUpdate_(e){this.rawValue=e,super.doValueUpdate_(e)}init(){this.fieldGroup_||super.init.call(this)}setSourceBlock(e){pxt.Util.assert(!e.isShadow(),"Procedure fields are not allowed to exist on shadow blocks."),super.setSourceBlock.call(this,e)}}i.FieldProcedure=s},{"./field_dropdown":33}],45:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldProtractor=void 0;const n=e("../plugins/math");class s extends n.FieldSlider{constructor(e,t,i){super(String(e),"0","180","1","15",lf("Angle"),i),this.isFieldCustom_=!0,this.params=t}createLabelDom_(e){const t=document.createElement("div");this.circleSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),pxsim.svg.hydrate(this.circleSVG,{viewBox:"0 0 200 100",width:"170"}),t.appendChild(this.circleSVG),pxsim.svg.child(this.circleSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#a8aaa8","stroke-width":"1rem"}),this.circleBar=pxsim.svg.child(this.circleSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#f12a21","stroke-width":"1rem"}),this.reporter=pxsim.svg.child(this.circleSVG,"text",{x:100,y:80,"text-anchor":"middle","dominant-baseline":"middle",style:"font-size: 50px",class:"sim-text inverted number"});const i=document.createElement("span");return i.setAttribute("class","blocklyFieldSliderReadout"),[t,i]}setReadout(e){this.updateAngle("string"==typeof e?parseFloat(e):e),this.reporter&&(this.reporter.textContent=`${e}`)}updateAngle(e){if(!this.circleBar)return;const t=(180-(e=Math.max(0,Math.min(180,e))))/180*Math.PI*90;this.circleBar.setAttribute("stroke-dashoffset",`${t}`)}}i.FieldProtractor=s},{"../plugins/math":107}],46:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSoundEffect=void 0;const n=e("blockly");var s=pxt.svgUtil;const o=e("./field_base"),r=e("./field_utils"),a=160,l=40;class c extends o.FieldBase{constructor(){super(...arguments),this.registeredChangeListener=!1,this.onWorkspaceChange=e=>{if(e.type!==n.Events.CHANGE)return;const t=this.sourceBlock_.workspace.getBlockById(e.blockId);!t||t!==this.sourceBlock_&&t.getParent()!==this.sourceBlock_||this.redrawPreview()}}onInit(){this.options||(this.options={}),this.options.durationInputName||(this.options.durationInputName="duration"),this.options.startFrequencyInputName||(this.options.startFrequencyInputName="startFrequency"),this.options.endFrequencyInputName||(this.options.endFrequencyInputName="endFrequency"),this.options.startVolumeInputName||(this.options.startVolumeInputName="startVolume"),this.options.endVolumeInputName||(this.options.endVolumeInputName="endVolume"),this.options.waveFieldName||(this.options.waveFieldName="waveShape"),this.options.interpolationFieldName||(this.options.interpolationFieldName="interpolation"),this.options.effectFieldName||(this.options.effectFieldName="effect"),this.options.useMixerSynthesizer||(this.options.useMixerSynthesizer=!1),this.redrawPreview(),this.sourceBlock_.workspace&&(this.workspace=this.sourceBlock_.workspace,this.sourceBlock_.isShadow()||this.sourceBlock_.isInsertionMarker()||(this.registeredChangeListener=!0,this.workspace.addChangeListener(this.onWorkspaceChange)))}onDispose(){this.workspace&&this.registeredChangeListener&&(this.workspace.removeChangeListener(this.onWorkspaceChange),this.registeredChangeListener=!1)}onValueChanged(e){return e}redrawPreview(){if(!this.fieldGroup_)return;if(this.drawnSound){const e=this.readCurrentSound();if(e.startFrequency===this.drawnSound.startFrequency&&e.endFrequency===this.drawnSound.endFrequency&&e.startVolume===this.drawnSound.startVolume&&e.endVolume===this.drawnSound.endVolume&&e.wave===this.drawnSound.wave&&e.interpolation===this.drawnSound.interpolation)return}pxsim.U.clear(this.fieldGroup_);const e=(new s.Rect).at(5,4).size(a,l).setClass("blocklySpriteField").stroke("#fff",1).fill("#dedede").corner(20),t="preview-clip-"+pxt.U.guidGen(),i=(new s.ClipPath).id(t).clipPathUnits(!1),n=(new s.Rect).size(115,l).fill("#FFF").at(0,0);i.appendChild(n),this.drawnSound=this.readCurrentSound();const o=(new s.Path).stroke("grey",2).fill("none").setD(pxt.assets.renderSoundPath(this.drawnSound,120,32)).clipPath("url('#"+t+"')"),r=(new s.Group).translate(35,7);r.appendChild(i),r.appendChild(o);const c=new s.Text("").appendClass("melody-editor-field-icon").setAttribute("alignment-baseline","middle").anchor("middle").at(20,24);this.fieldGroup_.appendChild(e.el),this.fieldGroup_.appendChild(c.el),this.fieldGroup_.appendChild(r.el)}showEditor_(){const e=this.readCurrentSound();let t;n.Events.disable();let i={getScaledBBox:()=>t};n.WidgetDiv.show(i,this.sourceBlock_.RTL,(()=>{document.activeElement&&"INPUT"===document.activeElement.tagName&&document.activeElement.blur(),a.hide(),s.classList.remove("sound-effect-editor-widget"),s.style.transform="",s.style.position="",s.style.left="",s.style.top="",s.style.width="",s.style.height="",s.style.opacity="",s.style.transition="",s.style.alignItems="",n.Events.enable(),n.Events.setGroup(!0),this.fireNumberInputUpdate(this.options.durationInputName,e.duration),this.fireNumberInputUpdate(this.options.startFrequencyInputName,e.startFrequency),this.fireNumberInputUpdate(this.options.endFrequencyInputName,e.endFrequency),this.fireNumberInputUpdate(this.options.startVolumeInputName,e.startVolume),this.fireNumberInputUpdate(this.options.endVolumeInputName,e.endVolume),this.fireFieldDropdownUpdate(this.options.waveFieldName,u[e.wave]),this.fireFieldDropdownUpdate(this.options.interpolationFieldName,d[e.interpolation]),this.fireFieldDropdownUpdate(this.options.effectFieldName,h[e.effect]),n.Events.setGroup(!1),this.mostRecentValue&&this.setBlockData(JSON.stringify(this.mostRecentValue))}));const s=n.WidgetDiv.getDiv(),o={onClose:()=>{a.hide(),n.WidgetDiv.hideIfOwner(i)},onSoundChange:e=>{this.mostRecentValue=e,this.updateSiblingBlocks(e),this.redrawPreview()},initialSound:e,useMixerSynthesizer:g(this.options.useMixerSynthesizer)},a=pxt.react.getFieldEditorView("soundeffect-editor",e,o,s),l=this.sourceBlock_,c=l.getBoundingRectangle(),p=(0,r.workspaceToScreenCoordinates)(l.workspace,new n.utils.Coordinate(c.right,c.top)),m=p.x+20,f=p.y-20;s.style.opacity="0",s.classList.add("sound-effect-editor-widget"),s.style.position="absolute",s.style.left=m+"px",s.style.top=f+"px",s.style.width="30rem",s.style.height="40rem",s.style.display="flex",s.style.alignItems="center",s.style.transition="transform 0.25s ease 0s, opacity 0.25s ease 0s",s.style.borderRadius="",a.onHide((()=>{})),a.show();const _=s.getBoundingClientRect(),T=l.workspace.getInjectionDiv().getBoundingClientRect();_.height>T.height?(s.style.height="",s.style.top="calc(1rem - 20px)",s.style.bottom="calc(1rem + 20px)"):(_.bottom>T.bottom||_.top<T.top)&&(s.style.top=T.top+T.height/2-_.height/2-20+"px");const E=l.workspace.getToolbox().getWidth();if(_.width>T.width-E)s.style.width="",s.style.left="1rem",s.style.right="1rem";else if(_.left+_.width>=T.right){const e=(0,r.workspaceToScreenCoordinates)(l.workspace,new n.utils.Coordinate(c.left,c.top)),t=T.left+E;e.x-_.width-20>t?s.style.left=e.x-_.width-20+"px":s.style.left=t+(T.width-E)/2-_.width/2+"px"}const b=s.getBoundingClientRect();t=new n.utils.Rect(b.top,b.bottom,b.left,b.right),requestAnimationFrame((()=>{s.style.opacity="1",s.style.transform="translateY(20px)"}))}render_(){super.render_(),this.size_.height=48,this.size_.width=165}updateSiblingBlocks(e){this.setNumberInputValue(this.options.durationInputName,e.duration),this.setNumberInputValue(this.options.startFrequencyInputName,e.startFrequency),this.setNumberInputValue(this.options.endFrequencyInputName,e.endFrequency),this.setNumberInputValue(this.options.startVolumeInputName,e.startVolume),this.setNumberInputValue(this.options.endVolumeInputName,e.endVolume),this.setFieldDropdownValue(this.options.waveFieldName,u[e.wave]),this.setFieldDropdownValue(this.options.interpolationFieldName,d[e.interpolation]),this.setFieldDropdownValue(this.options.effectFieldName,h[e.effect])}setNumberInputValue(e,t){const i=this.getSiblingBlock(e)||this.getSiblingBlock(e,!0);i&&("math_number"===i.type||"math_integer"===i.type||"math_whole_number"===i.type?i.setFieldValue(Math.round(t),"NUM"):"math_number_minmax"===i.type&&i.setFieldValue(Math.round(t),"SLIDER"))}getNumberInputValue(e,t){const i=this.getSiblingBlock(e)||this.getSiblingBlock(e,!0);return i?"math_number"===i.type||"math_integer"===i.type||"math_whole_number"===i.type?parseInt(i.getFieldValue("NUM")+""):"math_number_minmax"===i.type?parseInt(i.getFieldValue("SLIDER")+""):t:t}fireNumberInputUpdate(e,t){const i=this.getSiblingBlock(e)||this.getSiblingBlock(e,!0);if(!i)return;let s;"math_number"===i.type||"math_integer"===i.type||"math_whole_number"===i.type?s="NUM":"math_number_minmax"===i.type&&(s="SLIDER"),s&&n.Events.fire(new n.Events.BlockChange(i,"field",s,t,this.getNumberInputValue(e,t)))}setFieldDropdownValue(e,t){const i=this.getSiblingField(e)||this.getSiblingField(e,!0);i&&i.setValue(t)}getFieldDropdownValue(e){const t=this.getSiblingField(e)||this.getSiblingField(e,!0);if(t)return t.getValue()}fireFieldDropdownUpdate(e,t){const i=this.getSiblingField(e)||this.getSiblingField(e,!0);i&&n.Events.fire(new n.Events.BlockChange(i.getSourceBlock(),"field",i.name,t,this.getFieldDropdownValue(e)))}readCurrentSound(){const e=this.readBlockDataSound();return{duration:this.getNumberInputValue(this.options.durationInputName,e.duration),startFrequency:this.getNumberInputValue(this.options.startFrequencyInputName,e.startFrequency),endFrequency:this.getNumberInputValue(this.options.endFrequencyInputName,e.endFrequency),startVolume:this.getNumberInputValue(this.options.startVolumeInputName,e.startVolume),endVolume:this.getNumberInputValue(this.options.endVolumeInputName,e.endVolume),wave:p(u,this.getFieldDropdownValue(this.options.waveFieldName))||e.wave,interpolation:p(d,this.getFieldDropdownValue(this.options.interpolationFieldName))||e.interpolation,effect:p(h,this.getFieldDropdownValue(this.options.effectFieldName))||e.effect}}readBlockDataSound(){const e=this.getBlockData();let t;try{t=JSON.parse(e)}catch(e){t={duration:1e3,startFrequency:100,endFrequency:4800,startVolume:100,endVolume:0,wave:"sine",interpolation:"linear",effect:"none"}}return t}}i.FieldSoundEffect=c;const u={sine:"WaveShape.Sine",square:"WaveShape.Square",sawtooth:"WaveShape.Sawtooth",triangle:"WaveShape.Triangle",noise:"WaveShape.Noise"},h={none:"SoundExpressionEffect.None",vibrato:"SoundExpressionEffect.Vibrato",tremolo:"SoundExpressionEffect.Tremolo",warble:"SoundExpressionEffect.Warble"},d={linear:"InterpolationCurve.Linear",curve:"InterpolationCurve.Curve",logarithmic:"InterpolationCurve.Logarithmic"};function p(e,t){return Object.keys(e).find((i=>e[i]===t))}function g(e){if(!e)return!1;if("string"==typeof e)switch(e.toLowerCase().trim()){case"1":case"yes":case"y":case"on":case"true":return!0;default:return!1}return!!e}},{"./field_base":30,"./field_utils":64,blockly:207}],47:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSpeed=void 0;const n=e("../plugins/math");class s extends n.FieldSlider{constructor(e,t,i){super(String(e),"-100","100","1","10","Speed",i),this.isFieldCustom_=!0,this.params=t,this.params.min&&(this.min_=parseFloat(this.params.min)),this.params.max&&(this.max_=parseFloat(this.params.max)),this.params.label&&(this.labelText_=this.params.label),this.params.format||(this.params.format="{0}%")}createLabelDom_(e){const t=document.createElement("div");this.speedSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),pxsim.svg.hydrate(this.speedSVG,{viewBox:"0 0 200 100",width:"170"}),t.appendChild(this.speedSVG),pxsim.svg.child(this.speedSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#a8aaa8","stroke-width":"1rem"}),this.circleBar=pxsim.svg.child(this.speedSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#f12a21","stroke-width":"1rem"}),this.reporter=pxsim.svg.child(this.speedSVG,"text",{x:100,y:80,"text-anchor":"middle","dominant-baseline":"middle",style:`font-size: ${Math.max(14,50-5*(this.params.format.length-4))}px`,class:"sim-text inverted number"});const i=document.createElement("span");return i.setAttribute("class","blocklyFieldSliderReadout"),[t,i]}setReadout(e){this.updateSpeed("string"==typeof e?parseFloat(e):e),this.params&&this.reporter&&(this.reporter.textContent=ts.pxtc.U.rlf(this.params.format,e))}updateSpeed(e){if(!this.circleBar)return;let t=this.sign(e);e=Math.abs(e)/100*50+50,-1==t&&(e=50-e);let i=(100-e)/100*(180*Math.PI);this.circleBar.setAttribute("stroke-dashoffset",`${i}`)}sign(e){return e?e<0?-1:1:0}}i.FieldSpeed=s},{"../plugins/math":107}],48:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSpriteEditor=void 0;const n=e("./field_asset");class s extends n.FieldAssetEditor{getAssetType(){return"image"}createNewAsset(e){const t=pxt.react.getTilemapProject();if(e){const i=pxt.lookupProjectAssetByTSReference(e,t);if(i)return i}if(this.getBlockData())return t.lookupAsset("image",this.getBlockData());const i=e?pxt.sprite.imageLiteralToBitmap(e,this.params.taggedTemplate):new pxt.sprite.Bitmap(this.params.initWidth,this.params.initHeight);let n;if(!i){if(!(n=o(e)))return this.isGreyBlock=!0,void(this.valueText=e);this.qName=e}return n||(n=i.data()),{internalID:-1,id:this.sourceBlock_.id,type:"image",jresData:pxt.sprite.base64EncodeBitmap(n),meta:{},bitmap:n}}getValueText(){if(!this.asset)return this.valueText||"";if(this.asset&&!this.isTemporaryAsset())return pxt.getTSReferenceForAsset(this.asset);if(this.qName){const e=o(this.qName);if(e&&pxt.sprite.bitmapEquals(e,this.asset.bitmap))return this.qName}return pxt.sprite.bitmapToImageLiteral(this.asset&&pxt.sprite.Bitmap.fromData(this.asset.bitmap),"typescript",this.params.taggedTemplate)}parseFieldOptions(e){return function(e){const t={initColor:1,initWidth:16,initHeight:16,disableResize:!1,lightMode:!1};if(!e)return t;if(t.lightMode=e.lightMode,e.sizes){const i=e.sizes.split(";"),n=[];for(let e=0;e<i.length;e++){const t=i[e].split(",");if(2!==t.length)continue;let s=parseInt(t[0]),o=parseInt(t[1]);if(isNaN(s)||isNaN(o))continue;const r=pxt.appTarget.runtime&&pxt.appTarget.runtime.screenSize;s<0&&r&&(s=r.width),o<0&&r&&(o=r.height),n.push([s,o])}n.length>0&&(t.initWidth=n[0][0],t.initHeight=n[0][1])}return e.filter&&(t.filter=e.filter),e.disableResize&&(t.disableResize="true"===e.disableResize.toLowerCase()||"1"===e.disableResize),t.initColor=i(e.initColor,t.initColor),t.initWidth=i(e.initWidth,t.initWidth),t.initHeight=i(e.initHeight,t.initHeight),t.taggedTemplate=e.taggedTemplate,t;function i(e,t){const i=parseInt(e);return isNaN(i)?t:i}}(e)}}function o(e){const t=pxt.react.getTilemapProject().getGalleryAssets("image").filter((t=>t.id===e)),i=t.length&&t[0];if(i)return i.bitmap}i.FieldSpriteEditor=s},{"./field_asset":28}],49:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldStyledLabel=void 0;const n=e("blockly");class s extends n.FieldLabel{constructor(e,t,i){super(e,function(e){if(e){if(e.bold&&e.italics)return"blocklyBoldItalicizedText";if(e.bold)return"blocklyBoldText";if(e.italics)return"blocklyItalicizedText"}}(t)),this.isFieldCustom_=!0}}i.FieldStyledLabel=s},{blockly:207}],50:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTextDropdown=i.BaseFieldTextDropdown=void 0;const n=e("blockly");class s extends n.FieldTextInput{constructor(e,t,i){super(e,i),this.menuGenerator_=t,this.selectedMenuItem=null,this.menu_=null,this.svgArrow=null,this.generatedOptions=null}initView(){super.initView(),this.createSVGArrow()}showEditor_(e,t){super.showEditor_(e,t),this.dropDownOpen_||this.showDropdown_(),n.Touch.clearTouchIdentifier()}doValueUpdate_(e){(null==e?void 0:e.length)>1&&e.charAt(0)===e.charAt(e.length-1)&&("'"===e.charAt(0)||'"'===e.charAt(0))&&(e=e.slice(1,e.length-1)),super.doValueUpdate_(e)}getOptions(e){if(!this.menuGenerator_)throw TypeError("A menu generator was never defined.");return Array.isArray(this.menuGenerator_)?this.menuGenerator_:(e&&this.generatedOptions||function(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");let t=!1;for(let i=0;i<e.length;i++){const n=e[i];Array.isArray(n)?"string"!=typeof n[1]?(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option id must be a string. Found "+n[1]+" in: ",n)):n[0]&&"string"!=typeof n[0]&&"string"!=typeof n[0].src&&(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option must have a string label or image description. Found"+n[0]+" in: ",n)):(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option must be an array. Found: ",n))}if(t)throw TypeError("Found invalid FieldDropdown options.")}(this.generatedOptions),this.generatedOptions)}isOptionListDynamic(){return"function"==typeof this.menuGenerator_}dropdownDispose_(){this.dropDownOpen_=!1,this.menu_&&this.menu_.dispose(),this.menu_=null,this.selectedMenuItem=null,this.applyColour()}dropdownCreate(){const e=this.getSourceBlock();if(!e)throw new n.UnattachedFieldError;const t=new n.Menu;t.setRole(n.utils.aria.Role.LISTBOX),this.menu_=t;const i=this.getOptions(!1);this.selectedMenuItem=null;for(let s=0;s<i.length;s++){const[o,r]=i[s],a=(()=>{if("object"==typeof o){const e=new Image(o.width,o.height);return e.src=o.src,e.alt=o.alt||"",e}return o})(),l=new n.MenuItem(a,r);l.setRole(n.utils.aria.Role.OPTION),l.setRightToLeft(e.RTL),l.setCheckable(!0),t.addChild(l),l.setChecked(r===this.value_),r===this.value_&&(this.selectedMenuItem=l),l.onAction(this.handleMenuActionEvent,this)}}showDropdown_(e){const t=this.getSourceBlock();if(!t)throw new n.UnattachedFieldError;this.dropdownCreate(),e&&"number"==typeof e.clientX?this.menu_.openingCoords=new n.utils.Coordinate(e.clientX,e.clientY):this.menu_.openingCoords=null,n.DropDownDiv.clearContent();const i=this.menu_.render(n.DropDownDiv.getContentDiv());n.utils.dom.addClass(i,"blocklyDropdownMenu");const s=t.getParent(),o=(s||t).getColour(),r=(s||t).style.colourTertiary;n.DropDownDiv.setColour(o,r),this.dropDownOpen_=!0,n.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.selectedMenuItem&&(this.menu_.setHighlighted(this.selectedMenuItem),n.utils.style.scrollIntoContainerView(this.selectedMenuItem.getElement(),n.DropDownDiv.getContentDiv(),!0)),this.applyColour()}updateSize_(e){super.updateSize_(e);const t=this.positionSVGArrow(this.size_.width,this.size_.height/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2);if(this.sourceBlock_.RTL&&this.textElement_){const e=this.getConstants(),i=n.utils.dom.getFastTextWidth(this.textElement_,e.FIELD_TEXT_FONTSIZE,e.FIELD_TEXT_FONTWEIGHT,e.FIELD_TEXT_FONTFAMILY);this.positionTextElement_(-t,i)}this.size_.width+=t}positionSVGArrow(e,t){if(!this.svgArrow)return 0;const i=this.getSourceBlock();if(!i)throw new n.UnattachedFieldError;const s=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,o=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,r=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE,a=i.RTL?s/2:e+o;return this.svgArrow.setAttribute("transform","translate("+a+","+t+")"),r+o}createSVGArrow(){this.svgArrow=n.utils.dom.createSvgElement("image",{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(n.utils.dom.XLINK_NS,"xlink:href",o.DROPDOWN_SVG_DATAURI)}handleMenuActionEvent(e){n.DropDownDiv.hideIfOwner(this,!0),this.onItemSelected_(this.menu_,e)}onItemSelected_(e,t){this.setValue(t.getValue()),n.WidgetDiv.hideIfOwner(this)}}i.BaseFieldTextDropdown=s,s.DROPDOWN_SVG_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiM1NzVFNzUiLz48L3N2Zz4K";class o extends s{constructor(e,t,i){super(e,function(e){if(e.values)return e.values.split(",").map((e=>[e,e]));if(e.data){let t;try{const i=JSON.parse(e.data);if(Array.isArray(i)&&i.length)if(r(i))t=i.map((e=>[e,e]));else{let e=!1;for(const t of i)if(!Array.isArray(t)||2!==t.length||!r(t)){e=!0;break}e||(t=i)}}catch(e){}if(t)return t;console.warn("Could not parse textdropdown data field")}return[]}(t),i),this.isFieldCustom_=!0}}function r(e){for(const t of e)if("string"!=typeof t)return!1;return!0}i.FieldTextDropdown=o},{blockly:207}],51:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTextInput=void 0;const n=e("blockly");class s extends n.FieldTextInput{constructor(e,t,i){super(e,i),this.isFieldCustom_=!0}}i.FieldTextInput=s},{blockly:207}],52:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTilemap=void 0;const n=e("./field_asset");class s extends n.FieldAssetEditor{getInitText(){return this.initText}getTileset(){var e;return null===(e=this.asset)||void 0===e?void 0:e.data.tileset}getAssetType(){return"tilemap"}createNewAsset(e=""){var t;e&&(e=e.replace(/&#96;/g,"`"));const i=pxt.react.getTilemapProject(),n=pxt.lookupProjectAssetByTSReference(e,i);if(n)return n;if(null===(t=this.sourceBlock_)||void 0===t?void 0:t.isInFlyout)return;const s=pxt.sprite.decodeTilemap(e,"typescript",i)||i.blankTilemap(this.params.tileWidth,this.params.initWidth,this.params.initHeight);let o;if(function(e){return!!(e&&e.tilemap&&e.tilemap.width&&e.tilemap.height&&e.layers&&e.layers.width===e.tilemap.width&&e.layers.height===e.tilemap.height&&e.tileset)}(s)){this.initText=e,this.isGreyBlock=!1;const[t]=i.createNewTilemapFromData(s);o=i.getTilemap(t)}else e.trim()&&(this.isGreyBlock=!0,this.valueText=e);return o}onEditorClose(e){pxt.sprite.updateTilemapReferencesFromResult(pxt.react.getTilemapProject(),e)}getValueText(){return this.isGreyBlock?pxt.Util.htmlUnescape(this.valueText):this.asset?pxt.getTSReferenceForAsset(this.asset):this.initText?this.getInitText():this.valueText||""}parseFieldOptions(e){return function(e){const t={initWidth:16,initHeight:16,disableResize:!1,tileWidth:16,lightMode:!1};if(!e)return t;if(t.lightMode=e.lightMode,e.filter&&(t.filter=e.filter),e.tileWidth)if("number"==typeof e.tileWidth)switch(e.tileWidth){case 4:t.tileWidth=4;break;case 8:t.tileWidth=8;break;case 16:t.tileWidth=16;break;case 32:t.tileWidth=32}else switch(e.tileWidth.trim().toLowerCase()){case"4":case"four":t.tileWidth=4;break;case"8":case"eight":t.tileWidth=8;break;case"16":case"sixteen":t.tileWidth=16;break;case"32":case"thirtytwo":t.tileWidth=32}return t.initWidth=i(e.initWidth,t.initWidth),t.initHeight=i(e.initHeight,t.initHeight),t;function i(e,t){const i=parseInt(e);return isNaN(i)?t:i}}(e)}}i.FieldTilemap=s},{"./field_asset":28}],53:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTileset=void 0;const n=e("./field_images"),s=e("./field_utils"),o=32;class r extends n.FieldImages{constructor(e,t,i){super(e,t,i),this.isFieldCustom_=!0,this.menuGenerator_=()=>{var e,t;return(null===(e=this.sourceBlock_)||void 0===e?void 0:e.workspace)&&(0,s.needsTilemapUpgrade)(null===(t=this.sourceBlock_)||void 0===t?void 0:t.workspace)?[a()]:r.getReferencedTiles(this.sourceBlock_.workspace)},this.assetChangeListener=()=>{this.doValueUpdate_(this.getValue()),this.forceRerender()},this.blocksInfo=t.blocksInfo}static getReferencedTiles(e){const t=pxt.react.getTilemapProject();if(t.revision()!==r.cachedRevision||e.id!=r.cachedWorkspaceId){r.cachedRevision=t.revision(),r.cachedWorkspaceId=e.id;const i=(0,s.getAllReferencedTiles)(e),n=[16,4,8,32];for(const e of n){const n=t.getProjectTiles(e,16===e);if(n)for(const e of n.tiles)i.find((t=>t.id===e.id))||i.push(e)}let a={};i.sort(((e,t)=>e.id===t.id?0:e.bitmap.width!==t.bitmap.width?e.bitmap.width-t.bitmap.width:e.isProjectTile!==t.isProjectTile?e.isProjectTile?-1:1:(a[e.id]||(a[e.id]=c(e.id)))-(a[t.id]||(a[t.id]=c(t.id)))));const h=e=>c(e.id)<=2?l(e.bitmap.width):(0,s.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(e.bitmap),o,!1);r.referencedTiles=i.map((e=>[{src:h(e),width:o,height:o,alt:u(e)},e.id,e]))}return r.referencedTiles}initView(){super.initView(),this.sourceBlock_&&this.sourceBlock_.isInFlyout&&this.setValue(this.getOptions()[0][1])}getValue(){if(this.selectedOption_){let e=this.selectedOption_[2];return(e=pxt.react.getTilemapProject().lookupAsset(e.type,e.id))?pxt.getTSReferenceForAsset(e):super.getValue()}const e=super.getValue();return"string"==typeof e&&-1===e.indexOf(".")&&-1===e.indexOf("`")?`img\`${e}\``:e}getText(){const e=this.getValue();return"string"==typeof e&&-1!==e.indexOf("`")?e:super.getText()}render_(){if(this.value_&&this.selectedOption_&&this.selectedOption_[1]!==this.value_){const e=pxt.react.getTilemapProject().resolveTile(this.value_);r.cachedRevision=-1,e&&(this.selectedOption_=[{src:(0,s.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(e.bitmap),o,!1),width:o,height:o,alt:u(e)},this.value_,e])}super.render_()}doValueUpdate_(e){let t=!1;const i=this.getOptions(!0);if(e){const n=pxt.parseAssetTSReference(e);n&&(e=n.name),e=e.trim();for(const n of i)if(e===n[2].id||e===n[2].meta.displayName||e===pxt.getShortIDForAsset(n[2]))return this.selectedOption_=n,this.value_=this.getValue(),this.updateAssetListener(),super.doValueUpdate_(n[1]),void(t=!0);t||super.doValueUpdate_(e),this.selectedOption_=null,this.updateAssetListener()}}doClassValidation_(e){if(!this.getOptions(!0).some((([t,i])=>i===e))){if(e){const t=pxt.react.getTilemapProject(),i=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(e);if(i){const n=t.lookupAssetByName("tile",i[1]);if(n)return this.localTile=n,e}}return this.sourceBlock_&&console.warn(`Trying to set tile reference to nonexistent tile. Block type: ${this.sourceBlock_.type}, Field name: ${this.name}, Value: ${e}`),null}return e}getOptions(e){if("function"!=typeof this.menuGenerator_){this.transparent=a();const e=[this.transparent];return this.localTile&&e.push([{src:(0,s.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.localTile.bitmap),o,!1),width:o,height:o,alt:u(this.localTile)},this.localTile.id,this.localTile]),e}return this.menuGenerator_.call(this)}dispose(){super.dispose(),pxt.react.getTilemapProject().removeChangeListener("tile",this.assetChangeListener)}updateAssetListener(){const e=pxt.react.getTilemapProject();e.removeChangeListener("tile",this.assetChangeListener),this.selectedOption_&&e.addChangeListener(this.selectedOption_[2],this.assetChangeListener)}}function a(){const e=pxt.react.getTilemapProject().getTransparency(16);return[{src:l(16),width:o,height:o,alt:pxt.U.lf("transparency")},e.id,e]}function l(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.width=e,t.height=e,i.fillStyle="#aeaeae",i.fillRect(0,0,e,e),i.fillStyle="#dedede";for(let t=0;t<e;t+=4)for(let n=0;n<e;n+=4)t+n>>2&1&&i.fillRect(t,n,4,4);return t.toDataURL()}function c(e){switch(e){case"myTiles.transparency16":return 1;case"myTiles.transparency4":case"myTiles.transparency8":case"myTiles.transparency32":return 2;default:if(e.startsWith("myTiles.tile")){const t=parseInt(e.slice(12));if(!Number.isNaN(t))return t+2}return 9999999999}}function u(e){return e.meta.displayName||pxt.getShortIDForAsset(e)}i.FieldTileset=r},{"./field_images":36,"./field_utils":64}],54:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggle=i.BaseFieldToggle=void 0;const n=e("blockly"),s=e("../constants");class o extends n.FieldNumber{constructor(e,t,i,n,s){super(e,void 0,void 0,void 0,s),this.trueText=i,this.falseText=n,this.isFieldCustom_=!0,this.CURSOR="pointer",this.params=t,this.setValue(e),this.type_=t.type}initView(){if(!this.fieldGroup_)return;this.clickTarget_=this.sourceBlock_.getSvgRoot(),!this.sourceBlock_.isShadow()&&this.sourceBlock_.inputList&&this.sourceBlock_.inputList.length>1&&(this.borderRect_=n.utils.dom.createSvgElement("rect",{rx:this.getConstants().CORNER_RADIUS,ry:this.getConstants().CORNER_RADIUS,x:0,y:0,width:this.size_.width,height:this.size_.height,fill:this.sourceBlock_.getColour(),stroke:this.sourceBlock_.getColourTertiary()},null),this.fieldGroup_.insertBefore(this.borderRect_,this.textElement_));const e=this.getSize();switch(this.checkElement_=n.utils.dom.createSvgElement("g",{class:"blocklyToggle "+(this.state_?"blocklyToggleOn":"blocklyToggleOff"),transform:`translate(8, ${e.height/2})`},this.fieldGroup_),this.getOutputShape()){case s.provider.SHAPES.HEXAGONAL:this.toggleThumb_=n.utils.dom.createSvgElement("polygon",{class:"blocklyToggleRect",points:"-7,-14 -21,0 -7,14 7,14 21,0 7,-14",cursor:"pointer"},this.checkElement_);break;case s.provider.SHAPES.ROUND:this.toggleThumb_=n.utils.dom.createSvgElement("rect",{class:"blocklyToggleCircle",x:-6,y:-14,height:28,width:28,rx:14,ry:14,cursor:"pointer"},this.checkElement_);break;case s.provider.SHAPES.SQUARE:this.toggleThumb_=n.utils.dom.createSvgElement("rect",{class:"blocklyToggleRect",x:-6,y:-14,height:28,width:28,rx:3,ry:3,cursor:"pointer"},this.checkElement_)}let t=this.sourceBlock_.RTL?-e.width/2:e.width/2;this.textElement_=n.utils.dom.createSvgElement("text",{class:"blocklyText",x:t,dy:"0.6ex",y:e.height/2},this.fieldGroup_),this.updateEditable(),this.switchToggle(this.state_),this.setValue(this.getValue()),this.markDirty()}getDisplayText_(){return this.state_?this.getTrueText():this.getFalseText()}getTrueText(){return this.trueText}getFalseText(){return this.falseText}updateSize_(){switch(this.getOutputShape()){case s.provider.SHAPES.ROUND:this.size_.width=2*this.getInnerWidth()-7;break;case s.provider.SHAPES.HEXAGONAL:this.size_.width=2*this.getInnerWidth()+8-Math.floor(this.getInnerWidth()/2);break;case s.provider.SHAPES.SQUARE:this.size_.width=9+2*this.getInnerWidth()}}getInnerWidth(){return 10*this.getMaxLength()}getMaxLength(){return Math.max(this.getTrueText().length,this.getFalseText().length)}getOutputShape(){return this.sourceBlock_.isShadow()?this.sourceBlock_.getOutputShape():s.provider.SHAPES.SQUARE}doClassValidation_(e){return"boolean"==typeof this.fromVal(e)?e:"false"}applyColour(){let e=this.sourceBlock_.getColourTertiary();this.borderRect_?this.borderRect_.setAttribute("stroke",e):this.sourceBlock_.pathObject.svgPath.setAttribute("fill",e)}getValue(){return this.toVal(this.state_)}doValueUpdate_(e){let t=this.fromVal(e);this.state_!==t&&(this.sourceBlock_&&n.Events.isEnabled()&&n.Events.fire(new n.Events.BlockChange(this.sourceBlock_,"field",this.name,this.state_,t)),this.state_=t,this.switchToggle(this.state_),this.isDirty_=!0)}switchToggle(e){if(this.checkElement_){this.updateSize_();const t=this.getSize(),i=this.getInnerWidth();e?(pxt.BrowserUtils.addClass(this.checkElement_,"blocklyToggleOn"),pxt.BrowserUtils.removeClass(this.checkElement_,"blocklyToggleOff")):(pxt.BrowserUtils.removeClass(this.checkElement_,"blocklyToggleOn"),pxt.BrowserUtils.addClass(this.checkElement_,"blocklyToggleOff"));const n=this.getOutputShape();let o=0,r=0,a=0,l=0;switch(n){case s.provider.SHAPES.HEXAGONAL:a=-(r=(o=t.width/2)/2),l=r-i,this.toggleThumb_.setAttribute("points",`0,-14 -14,0 0,14 ${o},14 ${o+14},0 ${o},-14`);break;case s.provider.SHAPES.ROUND:case s.provider.SHAPES.SQUARE:r=(o=5+i)/2,this.toggleThumb_.setAttribute("width",""+o),this.toggleThumb_.setAttribute("x",`-${r}`),a=l=n==s.provider.SHAPES.SQUARE?2:-6}this.checkElement_.setAttribute("transform",`translate(${e?l+i+r:r+a}, ${t.height/2})`)}}render_(){if(this.visible_&&this.textElement_){for(;this.textElement_.firstChild;)this.textElement_.firstChild.remove();let e=document.createTextNode(this.getDisplayText_());this.textElement_.appendChild(e),pxt.BrowserUtils.addClass(this.textElement_,"blocklyToggleText"),this.updateSize_();let t=this.size_.width,i=(this.state_?t+t/8:t/2)-t/2;this.textElement_.setAttribute("x",`${i}`)}this.borderRect_&&(this.borderRect_.setAttribute("width",`${this.size_.width}`),this.borderRect_.setAttribute("height",`${this.size_.height}`))}showEditor_(){let e=!this.state_;null!==e&&this.setValue(this.toVal(e))}toVal(e){return"number"==this.type_?String(e?"1":"0"):String(e?"true":"false")}fromVal(e){return"string"==typeof e?"1"==e||"TRUE"==e.toUpperCase():!!e}}i.BaseFieldToggle=o;i.FieldToggle=class extends o{constructor(e,t,i){super(e,t,lf("True"),lf("False"),i)}}},{"../constants":18,blockly:207}],55:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleDownUp=void 0;const n=e("./field_toggle");class s extends n.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("DOWN"),lf("UP"),i)}}i.FieldToggleDownUp=s},{"./field_toggle":54}],56:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleHighLow=void 0;const n=e("./field_toggle");class s extends n.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("HIGH"),lf("LOW"),i)}}i.FieldToggleHighLow=s},{"./field_toggle":54}],57:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleOnOff=void 0;const n=e("./field_toggle");class s extends n.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("ON"),lf("OFF"),i)}}i.FieldToggleOnOff=s},{"./field_toggle":54}],58:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleUpDown=void 0;const n=e("./field_toggle");class s extends n.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("UP"),lf("DOWN"),i)}}i.FieldToggleUpDown=s},{"./field_toggle":54}],59:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleWinLose=void 0;const n=e("./field_toggle");class s extends n.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("WIN"),lf("LOSE"),i)}}i.FieldToggleWinLose=s},{"./field_toggle":54}],60:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleYesNo=void 0;const n=e("./field_toggle");class s extends n.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("Yes"),lf("No"),i)}}i.FieldToggleYesNo=s},{"./field_toggle":54}],61:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTsExpression=void 0;const n=e("blockly");class s extends n.FieldTextInput{constructor(){super(...arguments),this.isFieldCustom_=!0,this.pythonMode=!1}updateEditable(){let e=this.fieldGroup_;this.EDITABLE&&e&&(this.sourceBlock_.isEditable()?(pxt.BrowserUtils.addClass(e,"blocklyEditableText"),pxt.BrowserUtils.removeClass(e,"blocklyGreyExpressionBlockText"),this.fieldGroup_.style.cursor=this.CURSOR):(pxt.BrowserUtils.addClass(e,"blocklyGreyExpressionBlockText"),pxt.BrowserUtils.removeClass(e,"blocklyEditableText"),this.fieldGroup_.style.cursor=""))}setPythonEnabled(e){e!==this.pythonMode&&(this.pythonMode=e,this.forceRerender())}getText(){return this.pythonMode?pxt.Util.lf("<python code>"):this.getValue()}applyColour(){var e;this.sourceBlock_&&(null===(e=this.getConstants())||void 0===e?void 0:e.FULL_BLOCK_FIELDS)&&this.borderRect_&&(this.borderRect_.setAttribute("stroke",this.sourceBlock_.style.colourPrimary),this.borderRect_.setAttribute("fill",this.sourceBlock_.style.colourPrimary))}}i.FieldTsExpression=s},{blockly:207}],62:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTurnRatio=void 0;const n=e("blockly"),s=e("../plugins/math");class o extends s.FieldSlider{constructor(e,t,i){super(String(e),"-200","200","1","10","TurnRatio",i),this.isFieldCustom_=!0,this.params=t,this.sliderColor_="#a8aaa8"}createLabelDom_(e){let t=document.createElement("div"),i=n.utils.dom.createSvgElement("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:html":"http://www.w3.org/1999/xhtml","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",height:o.HALF+o.HANDLE_RADIUS+10+"px",width:2*o.HALF+"px"},t),s=n.utils.dom.createSvgElement("defs",{},i),r=n.utils.dom.createSvgElement("marker",{id:"head",orient:"auto",markerWidth:"2",markerHeight:"4",refX:"0.1",refY:"1.5"},s);n.utils.dom.createSvgElement("path",{d:"M0,0 V3 L1.5,1.5 Z",fill:"#f12a21"},r),this.reporter_=pxsim.svg.child(i,"text",{x:o.HALF,y:96,"text-anchor":"middle","dominant-baseline":"middle",style:"font-size: 50px",class:"sim-text inverted number"}),this.path_=n.utils.dom.createSvgElement("path",{x1:o.HALF,y1:o.HALF,"marker-end":"url(#head)",style:"fill: none; stroke: #f12a21; stroke-width: 10"},i),this.updateGraph_();let a=document.createElement("span");return a.setAttribute("class","blocklyFieldSliderReadout"),[t,a]}updateGraph_(){if(!this.path_)return;let e=Math.min(Math.max(Number(this.getValue())||0,-200),200);const t=e/100,i=Math.max(-1,Math.min(1,t)),n=Math.max(i)*Math.PI/2,s=o.RADIUS-6;let r=o.HALF;const a=o.HALF-22;Math.abs(t)>1&&(r-=(t-(t>0?1:-1))*s/2);const l=.2+.5*Math.abs(i),c=s*l,u=s*Math.sin(Math.PI/2-n),h=s*Math.cos(Math.PI/2-n),d=u-s*l*Math.cos(2*n),p=`M ${r} ${a} C ${r} ${a-c} ${r+(h-s*l*Math.sin(2*n))} ${a-d} ${r+h} ${a-u}`;this.path_.setAttribute("d",p),this.reporter_.textContent=`${e}`}setReadout(e){this.updateGraph_()}}i.FieldTurnRatio=o,o.HALF=80,o.HANDLE_RADIUS=30,o.RADIUS=o.HALF-o.HANDLE_RADIUS-1},{"../plugins/math":107,blockly:207}],63:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.getNextValue=i.FieldUserEnum=void 0;const n=e("blockly"),s=e("../external"),o=e("./field_dropdown");class r extends o.FieldDropdown{constructor(e){super(function(e){return function(){const t=[];return this.sourceBlock_&&this.sourceBlock_.workspace?this.sourceBlock_.workspace.getVariablesOfType(e.name).forEach((e=>{const i=e.name.replace(/^\d+/,"");t.push([i,e.name])})):e.initialMembers.forEach((e=>t.push([e,e]))),t.push([lf("Add a new {0}...",e.memberName),"CREATE"]),t}}(e)),this.opts=e}init(){super.init(),this.initVariables()}onItemSelected_(e,t){"CREATE"===t.getValue()?a(this.sourceBlock_.workspace,this.opts,lf("New {0}:",this.opts.memberName),(e=>e&&this.setValue(e))):super.onItemSelected_(e,t)}doClassValidation_(e){var t;return(null===(t=this.opts)||void 0===t?void 0:t.initialMembers)&&!this.opts.initialMembers.find((t=>t==e))&&this.getOptions(),super.doClassValidation_(e)}initVariables(){if(this.sourceBlock_&&this.sourceBlock_.workspace){const e=this.sourceBlock_.workspace,t=c(e,this.opts.name);if(this.opts.initialMembers.forEach((i=>{t.some((([e,t])=>e===i))||h(e,this.opts,i)})),"CREATE"===this.getValue()){const t=function(e,t,i){const n=e.getVariablesOfType(t);if(n&&n.length)for(let e=0;e<n.length;e++){const[t]=l(n[e]);if(t===i)return n[e].name}}(e,this.opts.name,this.opts.initialMembers[0]);t&&this.setValue(t)}}}}function a(e,t,i,o){(0,s.prompt)(i,null,(s=>{if(s){let r=!1;if(pxtc.isIdentifierStart(s.charCodeAt(0),2)){r=!0;for(let e=1;e<s.length;e++)pxtc.isIdentifierPart(s.charCodeAt(e),2)||(r=!1)}if(!r)return void n.dialog.alert(lf("Names must start with a letter and can only contain letters, numbers, '$', and '_'."),(()=>a(e,t,i,o)));const l=c(e,t.name);for(let r=0;r<l.length;r++){const[c,u]=l[r];if(c===s)return void n.dialog.alert(lf("A {0} named '{1}' already exists.",t.memberName,s),(()=>a(e,t,i,o)))}o(h(e,t,s))}}),{placeholder:t.promptHint})}function l(e){const t=/^(\d+)([^0-9].*)$/.exec(e.name);return t?[t[2],parseInt(t[1])]:[e.name,-1]}function c(e,t){const i=e.getVariablesOfType(t);return i&&i.length?i.map(l):[]}function u(e,t){const i=e.map((([e,t])=>t));if(t.isBitMask){for(let e=0;e<i.length;e++){let t=1<<e;if(i.indexOf(t)<0)return t}return 1<<i.length}if(t.isHash)return 0;{const e=t.firstValue||0;for(let t=0;t<i.length;t++)if(i.indexOf(e+t)<0)return e+t;return e+i.length}}function h(e,t,i){const s=u(c(e,t.name),t)+i;return n.Variables.getOrCreateVariablePackage(e,null,s,t.name),s}i.FieldUserEnum=r,i.getNextValue=u},{"../external":24,"./field_dropdown":33,blockly:207}],64:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.deleteBlockDataForField=i.getBlockDataForField=i.setBlockDataForField=i.setBlockData=i.getBlockData=i.workspaceToScreenCoordinates=i.setMelodyEditorOpen=i.FieldEditorOpenEvent=i.FIELD_EDITOR_OPEN_EVENT_TYPE=i.getTemporaryAssets=i.getTilesReferencedByTilesets=i.getAllReferencedTiles=i.getAllFields=i.upgradeTilemapsInWorkspace=i.needsTilemapUpgrade=i.getAllBlocksWithTilesets=i.getAllBlocksWithTilemaps=i.songToDataURI=i.tilemapToImageURI=i.bitmapToImageURI=i.parseColour=i.svg=void 0;const n=e("blockly"),s=e("./field_tilemap"),o=e("./field_animation"),r=e("./field_musiceditor"),a=e("./field_sprite"),l=e("./field_tileset");var c;function u(e,t){const i=e.getVariablesOfType(pxt.sprite.BLOCKLY_TILESET_TYPE);for(const n of i)if(parseInt(n.name.substr(0,n.name.indexOf(";")))===t.projectId){e.deleteVariableById(n.getId());break}}function h(e){return p(e,(e=>e instanceof s.FieldTilemap&&!e.isGreyBlock))}function d(e){return p(e,(e=>e instanceof l.FieldTileset))}function p(e,t){const i=[];return e.getTopBlocks(!1).forEach((e=>function e(n){for(const s of n.inputList){for(const e of s.fieldRow)t(e)&&i.push({block:n,field:e.name,ref:e});s.connection&&s.connection.targetBlock()&&e(s.connection.targetBlock())}n.nextConnection&&n.nextConnection.targetBlock()&&e(n.nextConnection.targetBlock())}(e))),i}(c=i.svg||(i.svg={})).hasClass=function(e,t){return pxt.BrowserUtils.containsClass(e,t)},c.addClass=function(e,t){pxt.BrowserUtils.addClass(e,t)},c.removeClass=function(e,t){pxt.BrowserUtils.removeClass(e,t)},i.parseColour=function(e){const t=Number(e);return isNaN(t)?"string"==typeof e&&e.match(/^#[0-9a-fA-F]{6}$/)?e:"#000":n.utils.colour.hueToHex(t)},i.bitmapToImageURI=function(e,t,i){const n=pxt.appTarget.runtime.palette.slice(1),s=document.createElement("canvas");s.width=t,s.height=t;const o=Math.min(t/e.width,t/e.height),r=Math.max(Math.floor(t*(1-e.width/e.height)/2),0),a=Math.max(Math.floor(t*(1-e.height/e.width)/2),0);let l;i?((l=s.getContext("2d",{alpha:!1})).fillStyle="#dedede",l.fillRect(0,0,t,t)):l=s.getContext("2d");for(let t=0;t<e.width;t++)for(let s=0;s<e.height;s++){const c=e.get(t,s);c?(l.fillStyle=n[c-1],l.fillRect(r+t*o,a+s*o,o,o)):i&&(l.fillStyle="#dedede",l.fillRect(r+t*o,a+s*o,o,o))}return s.toDataURL()},i.tilemapToImageURI=function(e,t,i){const n=pxt.appTarget.runtime.palette.slice(),s=document.createElement("canvas");s.width=t,s.height=t;const o=Math.min(t/e.tilemap.width,t/e.tilemap.height),r=Math.max(Math.floor(t*(1-e.tilemap.width/e.tilemap.height)/2),0),a=Math.max(Math.floor(t*(1-e.tilemap.height/e.tilemap.width)/2),0);let l;i?((l=s.getContext("2d",{alpha:!1})).fillStyle="#dedede",l.fillRect(0,0,t,t)):l=s.getContext("2d");let c=[];for(let t=0;t<e.tilemap.width;t++)for(let s=0;s<e.tilemap.height;s++){const u=e.tilemap.get(t,s);if(u){if(!c[u]){const t=e.tileset.tiles[u];c[u]=t?pxt.sprite.computeAverageColor(pxt.sprite.Bitmap.fromData(t.bitmap),n):"#dedede"}l.fillStyle=c[u],l.fillRect(r+t*o,a+s*o,o,o)}else i&&(l.fillStyle="#dedede",l.fillRect(r+t*o,a+s*o,o,o))}return s.toDataURL()},i.songToDataURI=function(e,t,i,n,s){const o=pxt.appTarget.runtime.palette.slice(),r=document.createElement("canvas");let a;r.width=t,r.height=i,n?((a=r.getContext("2d",{alpha:!1})).fillStyle="#dedede",a.fillRect(0,0,t,i)):a=r.getContext("2d");const l=[5,11,5,4,2,6,14,2,5,1];s=s||e.measures;const c=Math.max(Math.floor(t/(e.beatsPerMeasure*s*2)),1),u=Math.floor(t/c),h=Math.max(Math.floor(i/12),1),d=Math.floor(i/h);for(const t of e.tracks)for(const i of t.notes){const n=Math.floor(i.startTick/(e.ticksPerBeat/2));if(n>u)break;for(const s of i.notes){const i=12-s.note%12;i>d||(a.fillStyle=o[l[t.id||e.tracks.indexOf(t)]],a.fillRect(n*c,i*h,c,h))}}return r.toDataURL()},i.getAllBlocksWithTilemaps=h,i.getAllBlocksWithTilesets=d,i.needsTilemapUpgrade=function(e){return!!e.getVariablesOfType(pxt.sprite.BLOCKLY_TILESET_TYPE).map((e=>pxt.sprite.legacy.blocklyVariableToTile(e.name))).length},i.upgradeTilemapsInWorkspace=function(e,t){const i=e.getVariablesOfType(pxt.sprite.BLOCKLY_TILESET_TYPE).map((e=>pxt.sprite.legacy.blocklyVariableToTile(e.name)));if(i.length)try{n.Events.disable();let s=[];for(const n of i)n.qualifiedName?s[n.projectId]=t.resolveTile(n.qualifiedName):n.data&&(s[n.projectId]=t.createNewTile(n.data,"myTiles.tile"+n.projectId)),u(e,n);const o=h(e);for(const e of o){const i=pxt.sprite.legacy.decodeTilemap(e.ref.getInitText(),"typescript"),n=[],o=new pxt.sprite.TilemapData(i.tilemap,{tileWidth:i.tileset.tileWidth,tiles:i.tileset.tiles.map(((e,i)=>null!=e.projectId?s[e.projectId]:(n[i]||(n[i]=t.resolveTile(e.qualifiedName)),n[i])))},i.layers);e.ref.setValue(pxt.sprite.encodeTilemap(o,"typescript"))}const r=d(e);for(const e of r)e.ref.doValueUpdate_(e.ref.getValue()),e.ref.getSize()}finally{n.Events.enable()}},i.getAllFields=p,i.getAllReferencedTiles=function(e,t){var i;let n={};const s=h(e),o=pxt.react.getTilemapProject();for(const e of s)if(e.block.id!==t)for(const t of(null===(i=e.ref.getTileset())||void 0===i?void 0:i.tiles)||[])n[t.id]=o.lookupAsset("tile",t.id);const r=o.getAssets("tilemap");for(const e of r)for(const t of e.data.tileset.tiles)n[t.id]=o.lookupAsset("tile",t.id);const a=d(e);for(const e of a){const t=e.ref.getValue(),i=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(t);if(i){const e=o.lookupAssetByName("tile",i[1]);e&&!n[e.id]&&(n[e.id]=e)}else n[t]||(n[t]=o.resolveTile(t))}return Object.keys(n).map((e=>n[e])).filter((e=>!!e))},i.getTilesReferencedByTilesets=function(e){let t={};const i=pxt.react.getTilemapProject(),n=d(e);for(const e of n){const n=e.ref.getValue(),s=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(n);if(s){const e=i.lookupAssetByName("tile",s[1]);e&&!t[e.id]&&(t[e.id]=e)}else t[n]||(t[n]=i.resolveTile(n))}return Object.keys(t).map((e=>t[e])).filter((e=>!!e))},i.getTemporaryAssets=function(e,t){switch(t){case"image":return p(e,(e=>e instanceof a.FieldSpriteEditor&&e.isTemporaryAsset())).map((e=>e.ref.getAsset()));case"animation":return p(e,(e=>e instanceof o.FieldAnimationEditor&&e.isTemporaryAsset())).map((e=>e.ref.getAsset()));case"song":return p(e,(e=>e instanceof r.FieldMusicEditor&&e.isTemporaryAsset())).map((e=>e.ref.getAsset()));default:return[]}},i.FIELD_EDITOR_OPEN_EVENT_TYPE="field_editor_open";class g extends n.Events.UiBase{constructor(e,t){super(e.workspace.id),this.type=i.FIELD_EDITOR_OPEN_EVENT_TYPE,this.blockId=e.id,this.isOpen=t}}function m(e){return e.data?/^(?:\d+;?)+$/.test(e.data)?{commentRefs:e.data.split(";"),fieldData:{}}:JSON.parse(e.data):{commentRefs:[],fieldData:{}}}function f(e,t){e.data=JSON.stringify(t)}i.FieldEditorOpenEvent=g,i.setMelodyEditorOpen=function(e,t){n.Events.fire(new g(e,t))},i.workspaceToScreenCoordinates=function(e,t){const i=t.scale(e.scale),s=e.getOriginOffsetInPixels(),o=n.utils.Coordinate.sum(i,s),r=e.getInjectionDiv().getBoundingClientRect();return new n.utils.Coordinate(o.x+r.left,o.y+r.top)},i.getBlockData=m,i.setBlockData=f,i.setBlockDataForField=function(e,t,i){const n=m(e);n.fieldData[t]=i,f(e,n)},i.getBlockDataForField=function(e,t){return m(e).fieldData[t]},i.deleteBlockDataForField=function(e,t){const i=m(e);delete i.fieldData[t],f(e,i)}},{"./field_animation":26,"./field_musiceditor":40,"./field_sprite":48,"./field_tilemap":52,"./field_tileset":53,blockly:207}],65:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),s(e("./field_utils"),i),s(e("./fieldEditorRegistry"),i),s(e("./field_animation"),i),s(e("./field_argumentvariable"),i),s(e("./field_kind"),i),s(e("./field_asset"),i),s(e("./field_ledmatrix"),i),s(e("./field_styledlabel"),i),s(e("./field_base"),i),s(e("./field_tsexpression"),i),s(e("./field_textinput"),i),s(e("./field_tilemap"),i),s(e("./field_userenum"),i),s(e("./field_procedure"),i),s(e("./field_sprite"),i),s(e("./field_imagedropdown"),i),s(e("./field_protractor"),i),s(e("./field_toggle_highlow"),i),s(e("./field_images"),i),s(e("./field_sound_effect"),i),s(e("./field_toggle_onoff"),i),s(e("./field_speed"),i),s(e("./field_toggle_updown"),i),s(e("./field_toggle_winlose"),i),s(e("./field_autocomplete"),i),s(e("./field_melodySandbox"),i),s(e("./field_toggle_yesno"),i),s(e("./field_musiceditor"),i),s(e("./field_textdropdown"),i),s(e("./field_note"),i),s(e("./field_turnratio"),i),s(e("./field_colorwheel"),i),s(e("./field_numberdropdown"),i),s(e("./field_colour"),i),s(e("./field_position"),i),s(e("./field_tileset"),i),s(e("./field_gridpicker"),i),s(e("./field_toggle"),i)},{"./fieldEditorRegistry":25,"./field_animation":26,"./field_argumentvariable":27,"./field_asset":28,"./field_autocomplete":29,"./field_base":30,"./field_colorwheel":31,"./field_colour":32,"./field_gridpicker":34,"./field_imagedropdown":35,"./field_images":36,"./field_kind":37,"./field_ledmatrix":38,"./field_melodySandbox":39,"./field_musiceditor":40,"./field_note":41,"./field_numberdropdown":42,"./field_position":43,"./field_procedure":44,"./field_protractor":45,"./field_sound_effect":46,"./field_speed":47,"./field_sprite":48,"./field_styledlabel":49,"./field_textdropdown":50,"./field_textinput":51,"./field_tilemap":52,"./field_tileset":53,"./field_toggle":54,"./field_toggle_highlow":56,"./field_toggle_onoff":57,"./field_toggle_updown":58,"./field_toggle_winlose":59,"./field_toggle_yesno":60,"./field_tsexpression":61,"./field_turnratio":62,"./field_userenum":63,"./field_utils":64}],66:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.attachCardInfo=i.mkCard=i.installHelpResources=i.setHelpResources=i.installBuiltinHelpInfo=i.setBuiltinHelpInfo=void 0;const n=e("blockly"),s=e("./xml"),o=e("./external"),r=e("./toolbox"),a=e("./plugins/duplicateOnDrag");function l(e,t,i,n,r,l,c,u,h){!n||"string"!=typeof n&&"function"!=typeof n||e.setTooltip(n),r&&e.setHelpUrl(r),l&&e.setColour(l),h&&e.setDeletable(!1),(0,a.setDuplicateOnDragStrategy)(e);let d=document.getElementById("blocklyToolboxDefinition"),p=d?(0,s.getFirstChildWithAttr)(d,"block","type",t):void 0;e.codeCard={header:i,name:i,software:1,description:"function"==typeof n?n(e):n,blocksXml:p?'<xml xmlns="http://www.w3.org/1999/xhtml">'+((0,s.cleanOuterHTML)(p)||`<block type="${t}"></block>`)+"</xml>":void 0,url:r},pxt.Util.isTranslationMode()&&(e.customContextMenu=i=>{const n=pxt.blocks.getBlockDefinition(e.type);n&&n.translationIds&&i.push({enabled:!0,text:lf("Translate this block"),callback:function(){(0,o.promptTranslateBlock)(t,n.translationIds)}})})}function c(e,t,i,s,o,r,a){let c=n.Blocks[e],u=c.init;u&&(c.init=function(){u.call(this),l(this,e,t,i,s,o)})}function u(e,t){return{name:e.namespace+"."+e.name,shortName:e.name,description:e.attributes.jsDoc,url:e.attributes.help?"reference/"+e.attributes.help.replace(/^\//,""):void 0,blocksXml:`<xml xmlns="http://www.w3.org/1999/xhtml">${(0,s.cleanOuterHTML)(t)}</xml>`}}i.setBuiltinHelpInfo=function(e,t){const i=pxt.blocks.getBlockDefinition(t);l(e,t,i.name,i.tooltip,i.url,pxt.toolbox.getNamespaceColor(i.category))},i.installBuiltinHelpInfo=function(e){const t=pxt.blocks.getBlockDefinition(e);c(e,t.name,t.tooltip,t.url,pxt.toolbox.getNamespaceColor(t.category))},i.setHelpResources=l,i.installHelpResources=c,i.mkCard=u,i.attachCardInfo=function(e,t){const i=e.apis.byQName[t];if(i){const t=pxt.blocks.compileInfo(i);return u(i,(0,r.createToolboxBlock)(e,i,t))}}},{"./external":24,"./plugins/duplicateOnDrag":84,"./toolbox":127,"./xml":129,blockly:207}],67:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.validateAllReferencedBlocksExist=i.patchShadows=i.patchCommentIds=i.importXml=i.loadWorkspaceXml=i.loadBlocksXml=i.getFirstChildWithAttr=i.getChildrenWithAttr=i.getBlocksWithType=i.getDirectChildren=i.saveBlocksXml=i.workspaceToDom=i.saveWorkspaceXml=i.clearWithoutEvents=i.domToWorkspaceNoEvents=void 0;const n=e("blockly"),s=e("./loader"),o=e("./external"),r=e("./fields");function a(e,t,i){pxt.tickEvent("blocks.domtow");let s=[];g(e),_(e,!1);try{n.Events.disable(),s=n.Xml.domToWorkspace(e,t),r.FieldBase.flushInitQueue();for(const e of t.getAllBlocks())e.afterWorkspaceLoad&&e.afterWorkspaceLoad.call(e);!function(e,t){e.getAllBlocks(!1).filter((e=>!!e.getCommentText())).forEach((i=>{var n,s;const o=i.getCommentText();if(/@hide/.test(o)&&(null==t?void 0:t.applyHideMetaComment))return void i.dispose(!0);let r=o;/@highlight/.test(r)&&(r=r.replace(/@highlight/g,"").trim(),null===(s=(n=e).highlightBlock)||void 0===s||s.call(n,i.id,!0)),/@collapsed/.test(r)&&!i.getParent()&&(r=r.replace(/@collapsed/g,"").trim(),i.setCollapsed(!0)),o===(r=r.replace(/@validate-\S+/g,"").trim())||(null==t?void 0:t.keepMetaComments)||i.setCommentText(r||null)}))}(t,i)}catch(e){pxt.reportException(e)}finally{n.Events.enable()}return s.filter((e=>!!t.getBlockById(e)))}function l(e,t){const i=n.Xml.workspaceToDom(e,t),s=n.Xml.variablesToDom(e.getAllVariables()),o=u(i,"variables");for(const e of o)e.remove();return c(i.getElementsByTagName("block")),c(i.getElementsByTagName("shadow")),c(i.getElementsByTagName("comment")),i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s),i}function c(e){for(let t=0;t<e.length;t++){const i=e.item(t);i.hasAttribute("editable")&&i.removeAttribute("editable"),i.hasAttribute("movable")&&i.removeAttribute("movable")}}function u(e,t){const i=[];for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes.item(n);s.tagName===t&&i.push(s)}return i}function h(e,t){return d(e,"block","type",t).concat(d(e,"shadow","type",t))}function d(e,t,i,n){return pxt.Util.toArray(e.getElementsByTagName(t)).filter((e=>e.getAttribute(i)===n))}function p(e,t,i,n){const s=d(e,t,i,n);return s.length?s[0]:void 0}function g(e){const t=u(e,"comment");for(const e of t)e.hasAttribute("id")||e.setAttribute("id",n.utils.idGenerator.genUid());for(const t of e.querySelectorAll("comment:not([h])"))t.setAttribute("h","80"),t.setAttribute("w","160")}function m(e){if(2===e.parentElement.childElementCount)return void e.remove();const t=f(e);return e.parentElement.appendChild(t),e.remove(),t}function f(e){const t=n.utils.xml.createElement("block");for(const i of e.getAttributeNames())t.setAttribute(i,e.getAttribute(i));for(const i of e.childNodes)t.appendChild(i.cloneNode(!0));return t}function _(e,t){var i;if("shadow"===e.tagName)if("xml"===(null===(i=e.parentElement)||void 0===i?void 0:i.tagName)){console.warn(`Shadow block of type '${e.getAttribute("type")}' found at top level. Converting to non-shadow block`),pxt.tickEvent("blocks.import.topLevelShadow",{blockId:e.getAttribute("type")});const t=f(e);e.parentElement.insertBefore(t,e),e.remove();const i=u(e=t,"mutation")[0];(null==i?void 0:i.hasAttribute("dupliacteondrag"))&&i.removeAttribute("dupliacteondrag")}else{const t=e.getAttribute("type");let i=!1;switch(t){case"variables_get_reporter":case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":i=!0}if(i){if(!(e=m(e)))return;let t=u(e,"mutation")[0];t?t.setAttribute("duplicateondrag","true"):((t=n.utils.xml.createElement("mutation")).setAttribute("duplicateondrag","true"),e.appendChild(t))}else("variables_get"===t||T(e))&&(e=m(e))}if(e)for(const i of e.children)_(i,t||"shadow"===e.tagName)}function T(e){for(const t of e.children)if("block"===t.tagName.toLowerCase()||T(t))return!0;return!1}function E(e,t,i){var o;let r=i.getAttribute("type"),a=n.Blocks[r],l=(0,s.blockSymbol)(r);if(!l||!a)return;let c=pxt.blocks.compileInfo(l);null===(o=l.parameters)||void 0===o||o.forEach(((n,s)=>{let o=e.apis.byQName[n.type];if(o&&6==o.kind){let e=p(i,"field","name",c.actualNameToParam[n.name].definitionName);if(e){let i=t[o.name+"."+e.textContent];i&&(e.textContent=i)}}}))}i.domToWorkspaceNoEvents=a,i.clearWithoutEvents=function(e){if(pxt.tickEvent("blocks.clear"),e)try{n.Events.disable(),e.clear(),e.clearUndo()}finally{n.Events.enable()}},i.saveWorkspaceXml=function(e,t){const i=l(e,!t);return n.Xml.domToText(i)},i.workspaceToDom=l,i.saveBlocksXml=function(e,t){return e.getTopBlocks(!1).map((e=>n.Xml.domToText(n.Xml.blockToDom(e,!t))))},i.getDirectChildren=u,i.getBlocksWithType=h,i.getChildrenWithAttr=d,i.getFirstChildWithAttr=p,i.loadBlocksXml=function(e,t){let i=n.utils.xml.textToDom(t),s=n.Xml.domToBlock(i,e);if(e.getMetrics){let t=e.getMetrics(),i=s.getHeightWidth();s.moveBy(t.viewLeft+t.viewWidth/2-i.width/2,t.viewTop+t.viewHeight/2-i.height/2)}},i.loadWorkspaceXml=function(e,t=!1,i){const s=new n.Workspace;try{return a(n.utils.xml.textToDom(e),s,i),s}catch(e){return t||pxt.reportException(e),null}},i.importXml=function(e,t,i,n=!1){try{(0,s.initializeAndInject)(i);const n=(new DOMParser).parseFromString(t,"application/xml"),r=pxt.patching.computePatches(e);r&&(r.filter((e=>"blockId"==e.type)).forEach((e=>Object.keys(e.map).forEach((t=>{h(n,t).forEach((i=>{i.setAttribute("type",e.map[t]),pxt.debug(`patched block ${t} -> ${e.map[t]}`)}))})))),r.filter((e=>"blockValue"==e.type)).forEach((e=>Object.keys(e.map).forEach((t=>{const i=t.split("."),s=i[0];i[1],h(n,s).reduce(((e,t)=>e.concat(u(t,"value"))),[]).forEach((i=>{i.setAttribute("name",e.map[t]),pxt.debug(`patched block value ${t} -> ${e.map[t]}`)}))})))),r.filter((e=>"userenum"==e.type)).forEach((e=>Object.keys(e.map).forEach((t=>{d(n,"variable","type",t).forEach((i=>{i.setAttribute("type",e.map[t]),pxt.debug(`patched enum variable type ${t} -> ${e.map[t]}`)}))})))));const a=u(n.children.item(0),"shadow");for(const e of a){const t=n.createElement("block");e.getAttributeNames().forEach((i=>t.setAttribute(i,e.getAttribute(i))));for(let i=0;i<e.childNodes.length;i++)t.appendChild(e.childNodes.item(i));e.replaceWith(t)}_(n.documentElement,!1),g(n.documentElement);const l={};Object.keys(i.apis.byQName).forEach((e=>{let t=i.apis.byQName[e];7==t.kind&&(l[t.namespace+"."+(t.attributes.blockImportId||t.attributes.block||t.attributes.blockId||t.name)]=t.namespace+"."+t.name)}));const c=n.getElementsByTagName("block");for(let e=0;e<c.length;++e)E(i,l,c[e]);return function(e,t){const i=h(e,ts.pxtc.ON_START_TYPE);let n=i.length?i[0]:void 0;if(n)return void n.removeAttribute("deletable");let o=[];const r=t.blocksById;let a,l=e.firstElementChild;for(;l;){const t=l.nextElementSibling,i=l.getAttribute("type");if(!l.getAttribute("disabled")&&!l.getElementsByTagName("statement").length&&(s.buildinBlockStatements[i]||r[i]&&"void"==r[i].retType&&!(0,s.hasArrowFunction)(r[i])))if(a){const t=e.ownerDocument.createElement("next");t.appendChild(l),a.appendChild(t),l.removeAttribute("x"),l.removeAttribute("y"),a=l}else(a=e.ownerDocument.createElement("statement")).setAttribute("name","HANDLER"),n||((n=e.ownerDocument.createElement("block")).setAttribute("type",ts.pxtc.ON_START_TYPE),o.push(n)),n.appendChild(a),a.appendChild(l),l.removeAttribute("x"),l.removeAttribute("y"),a=l;l=t}o.forEach((t=>e.appendChild(t)))}(n.documentElement,i),function(e,t){pxt.U.toArray(e.querySelectorAll("block[type=procedures_defnoreturn]")).forEach((e=>{e.setAttribute("type","function_definition"),e.querySelector("field[name=NAME]").setAttribute("name","function_name")})),pxt.U.toArray(e.querySelectorAll("block[type=procedures_callnoreturn]")).forEach((e=>{e.setAttribute("type","function_call"),e.querySelector("field[name=NAME]").setAttribute("name","function_name")}))}(n.documentElement),(0,o.extensionBlocklyPatch)(e,n.documentElement),(new XMLSerializer).serializeToString(n)}catch(e){return n||pxt.reportException(e),t}},i.patchCommentIds=g,i.patchShadows=_,i.validateAllReferencedBlocksExist=function(e){pxt.U.assert(!!(null==n?void 0:n.Blocks),"Called validateAllReferencedBlocksExist before initializing Blockly");const t=n.utils.xml.textToDom(e),i=t.querySelectorAll("block");for(let e=0;e<i.length;e++)if(!n.Blocks[i.item(e).getAttribute("type")])return!1;const s=t.querySelectorAll("shadow");for(let e=0;e<s.length;e++)if(!n.Blocks[s.item(e).getAttribute("type")])return!1;return!0}},{"./external":24,"./fields":65,"./loader":71,blockly:207}],68:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),i.external=i.contextMenu=void 0,s(e("./plugins/arrays"),i),s(e("./plugins/functions"),i),s(e("./plugins/logic"),i),s(e("./plugins/math"),i),s(e("./plugins/text"),i),s(e("./plugins/renderer"),i),s(e("./plugins/flyout"),i),s(e("./plugins/newVariableField"),i),s(e("./plugins/comments"),i),s(e("./compiler/compiler"),i),s(e("./compiler/environment"),i),s(e("./loader"),i),s(e("./layout"),i),s(e("./render"),i),s(e("./toolbox"),i),s(e("./fields"),i),s(e("./sourceMap"),i),s(e("./importer"),i),s(e("./diff"),i),s(e("./legacyMutations"),i),s(e("./blockDragger"),i),s(e("./workspaceSearch"),i),s(e("./monkeyPatches"),i);const o=e("./contextMenu");i.contextMenu=o;const r=e("./external");i.external=r,s(e("./breakpointIcon"),i)},{"./blockDragger":1,"./breakpointIcon":2,"./compiler/compiler":12,"./compiler/environment":13,"./contextMenu":21,"./diff":23,"./external":24,"./fields":65,"./importer":67,"./layout":69,"./legacyMutations":70,"./loader":71,"./monkeyPatches":74,"./plugins/arrays":76,"./plugins/comments":79,"./plugins/flyout":86,"./plugins/functions":99,"./plugins/logic":105,"./plugins/math":107,"./plugins/newVariableField":111,"./plugins/renderer":117,"./plugins/text":122,"./render":125,"./sourceMap":126,"./toolbox":127,"./workspaceSearch":128}],69:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.documentToSvg=i.blocklyToSvgAsync=i.cleanUpBlocklySvg=i.serializeSvgString=i.serializeNode=i.toSvgAsync=i.toPngAsync=i.screenshotAsync=i.screenshotEnabled=i.flow=i.setCollapsedAll=i.verticalAlign=i.splitSvg=i.patchBlocksFromOldWorkspace=void 0;const n=e("blockly"),s=e("./compiler/environment"),o=e("./fields"),r=e("./compiler/compiler"),a=e("./importer");function l(e){return(e=e.replace(/\n/g,"")).trim()}i.patchBlocksFromOldWorkspace=function(e,t,i){const o=(0,a.loadWorkspaceXml)(i,!0);!function(e,t,i){let n,o;const a=t.getTopBlocks(!1).filter((e=>e.isEnabled())),c=i.getTopBlocks(!1);let u;const h=t.getTopComments(!1),d=i.getTopComments(!1);for(const i of a){const a=i.getRelativeToSurfaceXY();if(!a||0==a.x||0==a.y)continue;if(!n){n=(0,s.mkEnv)(t,e),o={};for(const e of c){const t=(0,r.callKey)(n,e),i=o[t]||[];i.push(e),o[t]=i}}const l=(o[(0,r.callKey)(n,i)]||[]).shift();if(l){const e=l.getRelativeToSurfaceXY();e.x=a.x,e.y=a.y}}for(const e of h){const t=e.getRelativeToSurfaceXY();if(!t||0==t.x||0==t.y)continue;if(!u){u={};for(const e of d){const t=l(e.getText()),i=u[t]||[];i.push(e),u[t]=i}}const i=(u[l(e.getText())]||[]).shift();if(i){const n=e.getSize();i.setText(e.getText()),i.setSize(n);const s=i.getRelativeToSurfaceXY();s.x=t.x,s.y=t.y}}}(e,t,o);const c=(0,a.workspaceToDom)(t,!0),u=(0,a.workspaceToDom)(o,!0);for(const e of c.childNodes)pxt.BrowserUtils.isElement(e)&&"block"===e.localName&&"true"===e.getAttribute("disabled")&&u.appendChild(u.ownerDocument.importNode(e,!0));return n.Xml.domToText(u)},i.splitSvg=function(e,t,i=18){const n=t.getTopComments(!0),s=t.getTopBlocks(!0);if(n.length+s.length<2)return e;const o=document.createElement("div");function r(t,n,s,r,a,l){const c=e.cloneNode(!0),u=c.querySelector(`g.blocklyWorkspace > g.${t}`),h=c.querySelector(`g.blocklyWorkspace > g.${n}`),d=pxt.Util.toArray(u.querySelectorAll(`g.blocklyWorkspace > g.${t} > ${l?"."+l:"g[transform]"}`)),p=d.splice(s,1)[0];if(!p)return void pxt.log("missing block, did block failed to load?");d.filter((e=>e!=p)).forEach((e=>{e.parentNode.removeChild(e)})),u.removeAttribute("transform"),h.parentNode.removeChild(h),p.setAttribute("transform",`translate(${a.x}, ${a.y})`);const g=r.width/i+"em",m=r.height/i+"em";c.setAttribute("viewBox",`0 0 ${r.width} ${r.height}`),c.style.width=g,c.style.height=m,c.setAttribute("width",g),c.setAttribute("height",m),o.appendChild(c)}return o.className=`blocks-svg-list ${t.getInjectionDiv().className}`,n.forEach(((e,t)=>r("blocklyBubbleCanvas","blocklyBlockCanvas",t,e.getSize(),{x:0,y:0},"blocklyComment"))),s.forEach(((e,t)=>{const n=e.getHeightWidth(),s={x:0,y:0};e.hat&&(n.height+=i,s.y+=i),r("blocklyBlockCanvas","blocklyBubbleCanvas",t,n,s)})),o},i.verticalAlign=function(e,t){let i=0;e.getTopComments(!0).forEach((e=>{e.moveBy(0,i),i+=e.getSize().height,i+=t})),e.getTopBlocks(!0).forEach(((e,n)=>{e.hat&&(i+=t),e.moveBy(0,i),i+=e.getHeightWidth().height,i+=t}))},i.setCollapsedAll=function(e,t){e.getTopBlocks(!1).filter((e=>e.isEnabled())).forEach((e=>e.setCollapsed(t)))};const c=20;function u(e,t,i){let n;i&&(n={target:pxt.appTarget.id,versions:pxt.appTarget.versions,xml:(0,a.saveBlocksXml)(e).map((e=>pxt.Util.htmlEscape(e)))});const s=0|t||4;return p(e,s).then((e=>e?pxt.BrowserUtils.encodeToPngAsync(e.xml,{width:e.width,height:e.height,pixelDensity:s,text:i?JSON.stringify(n,null,2):null}):Promise.resolve(void 0))).catch((e=>{pxt.reportException(e)}))}i.flow=function(e,t){if(t){if(t.useViewWidth){const t=e.getMetrics();if(t.viewHeight>t.viewWidth)return I(e.getTopComments(!0),e.getTopBlocks(!0),void 0,t.viewWidth),void e.scroll(c,20)}I(e.getTopComments(!0),e.getTopBlocks(!0),t.ratio)}else I(e.getTopComments(!0),e.getTopBlocks(!0));e.scroll(c,20)},i.screenshotEnabled=function(){return!pxt.BrowserUtils.isIE()},i.screenshotAsync=function(e,t,i){return u(e,t,i)},i.toPngAsync=u;const h="http://www.w3.org/1999/xlink",d=12e7;function p(e,t){if(!e)return Promise.resolve(void 0);const i=e.getBlocksBoundingBox(),n=e.getParentSvg().cloneNode(!0);f(n);let s=i.right-i.left,o=i.bottom-i.top,r=1;const a=s*o*Math.pow(t,2);return a>d&&(r=Math.sqrt(d/a)),_(n,i.left,i.top,s,o,r)}function g(e){return m((new XMLSerializer).serializeToString(e))}function m(e){return e.replace(new RegExp("&nbsp;","g"),"&#160;")}function f(e){pxt.BrowserUtils.removeClass(e,"blocklySvg"),pxt.BrowserUtils.addClass(e,"blocklyPreview pxt-renderer classic-theme"),pxt.U.toArray(e.querySelectorAll(".blocklyMainBackground,.blocklyScrollbarBackground")).forEach((e=>{e&&e.parentNode.removeChild(e)})),pxt.U.toArray(e.querySelectorAll(".blocklyConnectionIndicator,.blocklyInputConnectionIndicator")).forEach((e=>{e&&e.parentNode.removeChild(e)})),e.removeAttribute("width"),e.removeAttribute("height"),pxt.U.toArray(e.querySelectorAll(".blocklyBlockCanvas,.blocklyBubbleCanvas")).forEach((e=>e.removeAttribute("transform")));const t=new DOMParser;return pxt.U.toArray(e.querySelectorAll(".blocklyTextarea")).forEach((e=>{const i=t.parseFromString("<!doctype html><body>"+pxt.docs.html2Quote(e.value),"text/html");e.textContent=i.body.textContent})),e}async function _(e,t,i,n,s,o){var r,a;if(!e.childNodes[0])return;e.removeAttribute("width"),e.removeAttribute("height"),e.removeAttribute("transform");let l=Math.round(n*(o||1)),c=Math.round(s*(o||1));const u=g(e).replace(/^\s*<svg[^>]+>/i,"").replace(/<\/svg>\s*$/i,""),d=`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="${h}" width="${l}" height="${c}" viewBox="${t} ${i} ${n} ${s}" class="pxt-renderer classic-theme injectionDiv">${u}</svg>`,p=(new DOMParser).parseFromString(d,"image/svg+xml"),m=p.createElementNS("http://www.w3.org/1999/xhtml","style"),f=pxt.Util.isUserLanguageRtl(),_=document.getElementById(`style-${f?"rtl":""}blockly.css`).href,I=pxt.Util.toArray(document.head.getElementsByTagName("link")).filter((e=>pxt.Util.endsWith(e.getAttribute("href"),"semantic.css")))[0].href,y=await Promise.all([pxt.BrowserUtils.loadAjaxAsync(_),pxt.BrowserUtils.loadAjaxAsync(I)]),v=pxt.Util.toArray(document.head.querySelectorAll("style")).filter((e=>/\.blocklySvg/.test(e.innerText)))[0];y.unshift((null===(r=document.getElementById("blockly-common-style"))||void 0===r?void 0:r.innerText)||""),y.unshift((null===(a=document.getElementById("blockly-renderer-style-pxt-classic"))||void 0===a?void 0:a.innerText)||"");const C=(v?v.innerText:"")+"\n\n"+y.map((e=>e+"\n\n"));return m.appendChild(p.createCDATASection(C)),p.documentElement.insertBefore(m,p.documentElement.firstElementChild),await async function(e){E||(E={});const t=pxt.Util.toArray(e.getElementsByTagName("image")),i=t.filter((e=>{const t=e.getAttributeNS(h,"href");return t&&!/^data:/.test(t)}));for(const t of i){const i=t.getAttributeNS(h,"href");let n=E[i];if(!n)try{const e=await pxt.BrowserUtils.loadImageAsync(t.getAttributeNS(h,"href")),s=document.createElement("canvas"),o=s.getContext("2d");let r=e.width,a=e.height;s.width=r,s.height=a,o.drawImage(e,0,0,r,a,0,0,s.width,s.height),n=s.toDataURL("image/png"),E[i]=n}catch(e){pxt.debug(`svg render: failed to load ${i}`),n=""}t.setAttributeNS(h,"href",i)}const n=t.filter((e=>/^\/.*.svg$/.test(e.getAttribute("href"))));for(const e of n){const t=e.getAttribute("href");let i=24,n=24;e.hasAttribute("width")&&e.hasAttribute("height")?(i=parseInt(e.getAttribute("width").replace(/[^0-9]/g,"")),n=parseInt(e.getAttribute("height").replace(/[^0-9]/g,""))):e.classList.contains("blocklyResizeHandle")&&(i=12,n=12);let s=E[t];s||(s=await pxt.BrowserUtils.encodeToPngAsync(t,{width:i,height:n,pixelDensity:2})),E[t]=s,e.setAttribute("href",s)}}(p),await async function(e){if(b||(b={}),!pxt.BrowserUtils.isEdge())return;const t=pxt.Util.toArray(e.getElementsByTagName("image")).filter((e=>/^data:image\/svg\+xml/.test(e.getAttributeNS(h,"href"))));for(const e of t){const t=e.getAttributeNS(h,"href"),i=parseInt(e.getAttribute("width").replace(/[^0-9]/g,"")),n=parseInt(e.getAttribute("height").replace(/[^0-9]/g,""));let s=b[t];s||(s=await pxt.BrowserUtils.encodeToPngAsync(t,{width:i,height:n,pixelDensity:2}),console.log(`HREF: ${s}`)),b[t]=s,e.setAttributeNS(h,"href",s)}}(p),{width:l,height:c,svg:g(p).replace('<style xmlns="http://www.w3.org/1999/xhtml">',"<style>"),xml:T(p),css:C}}function T(e){const t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,"+ts.pxtc.encodeBase64(unescape(encodeURIComponent(t)))}let E,b;function I(e,t,i=1.62,n){const s=[],r={};let a;e.forEach((e=>{const t=e.data;null!=t&&(r[t]=e)})),t.sort(((e,t)=>e.isEnabled()===t.isEnabled()?e.type===t.type?0:"function_definition"===e.type?1:"function_definition"===t.type?-1:e.type.localeCompare(t.type):e.isEnabled()?-1:1)),t.forEach((e=>{const t=(0,o.getBlockData)(e).commentRefs;if(t.length){const i=[];for(let e=0;e<t.length;e++){const n=r[t[e]];n&&(i.push(y(n)),delete r[t[e]])}if(i.length)return void s.push({value:e,width:-1,height:-1,children:i})}const i=y(e);!a&&e.isEnabled()&&e.type===pxtc.ON_START_TYPE?a=i:s.push(i)})),a&&s.unshift(a),Object.keys(r).sort(((e,t)=>e.length===t.length?e>t?-1:1:e.length>t.length?-1:1)).forEach((e=>{r[e]&&s.push(y(r[e]))})),e.forEach((e=>{null==e.data&&s.push(y(e))}));let l,u=0;for(let e=0;e<s.length;e++){const t=s[e];if(t.children){const e=t.value.getHeightWidth();t.x=0,t.y=0;let i=e.width+13,n=0;for(let e=0;e<t.children.length;e++){const s=t.children[e];s.x=i,s.y=n,n+=s.height+13,t.width=Math.max(t.width,i+s.width)}t.height=Math.max(n-13,e.height)}u+=(t.height+13)*(t.width+13)}l=n>c?n-c:Math.sqrt(u)*i;let h=c,d=20,p=0;for(let e=0;e<s.length;e++){const t=s[e];if(t.children){g(t,h+t.x,d+t.y);for(let e=0;e<t.children.length;e++){const i=t.children[e];g(i,h+i.x,d+i.y)}}else g(t,h,d);h+=t.width+45,p=Math.max(p,d+t.height+45),h>l&&(h=c,d=p)}function g(e,t,i){const n=e.value.getBoundingRectangle();e.value.moveBy(t-n.left,i-n.top)}}function y(e){const t=e instanceof n.BlockSvg?e.getHeightWidth():e.getSize();return{value:e,height:t.height,width:t.width}}i.toSvgAsync=p,i.serializeNode=g,i.serializeSvgString=m,i.cleanUpBlocklySvg=f,i.blocklyToSvgAsync=_,i.documentToSvg=T},{"./compiler/compiler":12,"./compiler/environment":13,"./fields":65,"./importer":67,blockly:207}],70:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.mutateToolboxBlock=i.addMutation=i.MutatorTypes=void 0;const n=e("blockly"),s=e("./compiler/util"),o=e("./compiler/compiler"),r=e("./loader");var a,l;(l=a=i.MutatorTypes||(i.MutatorTypes={})).ObjectDestructuringMutator="objectdestructuring",l.RestParameterMutator="restparameter",l.DefaultInstanceMutator="defaultinstance",i.addMutation=function(e,t,i){let n;switch(i){case a.ObjectDestructuringMutator:if(!t.parameters||t.parameters.length<1)console.error("Destructuring mutations require at least one parameter");else{let e=!1;for(const i of t.parameters)if(-1!==i.type.indexOf("=>")){if(!i.properties||0===i.properties.length)return void console.error("Destructuring mutations only supported for functions with an event parameter that has multiple properties");e=!0}if(!e)return void console.error("Destructuring mutations must have an event parameter")}n=new u(e,t);break;case a.RestParameterMutator:n=new h(e,t);break;case a.DefaultInstanceMutator:n=new d(e,t);break;default:return void console.warn("Ignoring unknown mutation type: "+i)}e.mutationToDom=n.mutationToDom.bind(n),e.domToMutation=n.domToMutation.bind(n),e.compose=n.compose.bind(n),e.decompose=n.decompose.bind(n),e.mutation=n},i.mutateToolboxBlock=function(e,t,i){const n=document.createElement("mutation");switch(t){case a.ObjectDestructuringMutator:n.setAttribute(u.propertiesAttributeName,i);break;case a.RestParameterMutator:n.setAttribute(h.countAttributeName,i);break;case a.DefaultInstanceMutator:n.setAttribute(d.attributeName,i);default:return void console.warn("Ignoring unknown mutation type: "+t)}e.appendChild(n)};class c{constructor(e,t){this.info=t,this.block=e,this.topBlockType=this.block.type+"_mutator";const i=this.getSubBlockNames();this.initializeMutatorTopBlock(),this.initializeMutatorSubBlocks(i);const s=i.map((e=>e.type));this.block.setMutator(new n.icons.MutatorIcon(s,e))}compose(e){const t=e.getDescendants(!1).map((e=>({type:e.type,name:e.inputList[0].name})));t.shift(),this.updateBlock(t)}decompose(e){const t=e.newBlock(this.topBlockType);t.initSvg();for(const i of t.inputList)if(i.name===c.mutatorStatmentInput){let t=i.connection;this.getVisibleBlockTypes().forEach((i=>{const n=e.newBlock(i);n.initSvg(),t.connect(n.previousConnection),t=n.nextConnection}));break}return t}compileMutation(e,t){}getDeclaredVariables(){}isDeclaredByMutation(e){return!1}initializeMutatorSubBlock(e,t,i){e.appendDummyInput(t).appendField(t),e.setColour(i),e.setNextStatement(!0),e.setPreviousStatement(!0)}initializeMutatorTopBlock(){const e=this.info.attributes.mutateText,t=this.block.getColour();n.Blocks[this.topBlockType]=n.Blocks[this.topBlockType]||{init:function(){this.appendDummyInput().appendField(e),this.setColour(t),this.appendStatementInput(c.mutatorStatmentInput)}}}initializeMutatorSubBlocks(e){const t=this.block.getColour(),i=this.initializeMutatorSubBlock.bind(this);e.forEach((e=>{n.Blocks[e.type]=n.Blocks[e.type]||{init:function(){i(this,e.name,t)}}}))}}c.mutatorStatmentInput="PROPERTIES",c.mutatedVariableInputName="properties";class u extends c{constructor(e,t){super(e,t),this.currentlyVisible=[],this.parameterRenames={},this.prefix=this.info.attributes.mutatePrefix,this.block.appendDummyInput(c.mutatedVariableInputName),this.block.appendStatementInput("HANDLER").setCheck("null")}getMutationType(){return a.ObjectDestructuringMutator}compileMutation(e,t){if(!this.info.attributes.mutatePropertyEnum&&!this.parameters.length)return;const i=`function ({ ${this.parameters.map((t=>{const i=this.block.getField(t),n=i&&i.getText(),o=(0,s.escapeVarName)(t,e);return n!==t?(this.parameterRenames[t]=n,`${t}: ${(0,s.escapeVarName)(n,e)}`):o})).join(", ")} })`;return this.info.attributes.mutatePropertyEnum?pxt.blocks.mkText(` [${this.parameters.map((e=>`${this.info.attributes.mutatePropertyEnum}.${e}`)).join(", ")}],${i}`):pxt.blocks.mkText(i)}getDeclaredVariables(){const e={};return this.parameters.forEach((t=>{e[this.getVarFieldValue(t)]=this.parameterTypes[t]})),e}isDeclaredByMutation(e){return this.parameters.some((t=>this.getVarFieldValue(t)===e))}mutationToDom(){const e=document.createElement("mutation"),t=this.parameters.map((e=>{const t=this.getVarFieldValue(e);return t!==e&&(this.parameterRenames[e]=pxt.Util.htmlEscape(t)),pxt.Util.htmlEscape(e)})).join(",");e.setAttribute(u.propertiesAttributeName,t);for(const e in this.parameterRenames)e===this.parameterRenames[e]&&delete this.parameterRenames[e];return e.setAttribute(u.renameAttributeName,JSON.stringify(this.parameterRenames)),e}domToMutation(e){const t=e.getAttribute(u.propertiesAttributeName);if(t){const i=t.split(","),n=[];if(void 0===this.paramIndex&&(this.paramIndex=this.getParameterIndex()),i.forEach((e=>{const t=e.split(":");this.info.parameters[this.paramIndex].properties.some((e=>e.name===t[0]))&&n.push({property:t[0],newName:t[1]})})),this.parameterRenames=void 0,e.hasAttribute(u.renameAttributeName))try{this.parameterRenames=JSON.parse(e.getAttribute(u.renameAttributeName))}catch(e){console.warn("Ignoring invalid rename map in saved block mutation")}this.parameterRenames=this.parameterRenames||{},this.parameters=[],n.forEach((e=>{this.parameters.push(e.property),e.newName&&e.newName!==e.property&&(this.parameterRenames[e.property]=e.newName)})),this.updateVisibleProperties(),n.filter((e=>!!e.newName)).forEach((e=>this.setVarFieldValue(e.property,e.newName)))}}getVarFieldValue(e){const t=this.block.getField(e);return t&&t.getText()}setVarFieldValue(e,t){this.block.getField(e),this.block.getField(e)&&(0,r.setVarFieldValue)(this.block,e,t)}updateBlock(e){this.parameters=[],e.forEach((e=>{-1===this.parameters.indexOf(e.name)&&this.parameters.push(e.name)})),this.updateVisibleProperties()}getSubBlockNames(){return this.parameters=[],this.parameterTypes={},void 0===this.paramIndex&&(this.paramIndex=this.getParameterIndex()),this.info.parameters[this.paramIndex].properties.map((e=>(this.parameterTypes[e.name]=e.type,{type:this.propertyId(e.name),name:e.name})))}getVisibleBlockTypes(){return this.currentlyVisible.map((e=>this.propertyId(e)))}updateVisibleProperties(){if(pxt.Util.listsEqual(this.currentlyVisible,this.parameters))return;const e=this.block.inputList.find((e=>e.name===c.mutatedVariableInputName));this.prefix&&0===this.currentlyVisible.length&&e.appendField(this.prefix,u.prefixLabel),this.currentlyVisible.forEach((t=>{if(-1===this.parameters.indexOf(t)){const i=this.getVarFieldValue(t);i!==t&&(this.parameterRenames[t]=i),e.removeField(t)}})),this.parameters.forEach((t=>{if(-1===this.currentlyVisible.indexOf(t)){const i=this.parameterRenames[t]||t;e.appendField(new n.FieldVariable(i),t)}})),this.prefix&&0===this.parameters.length&&e.removeField(u.prefixLabel),this.currentlyVisible=this.parameters}propertyId(e){return this.block.type+"_"+e}getParameterIndex(){for(let e=0;e<this.info.parameters.length;e++)if(-1!==this.info.parameters[e].type.indexOf("=>"))return e}}u.propertiesAttributeName="callbackproperties",u.renameAttributeName="renamemap",u.prefixLabel="0prefix_label_";class h extends c{constructor(){super(...arguments),this.count=0}getMutationType(){return a.RestParameterMutator}compileMutation(e,t){const i=[];return this.forEachInput((n=>i.push((0,o.compileExpression)(e,n,t)))),pxt.blocks.mkGroup(i)}mutationToDom(){const e=document.createElement("mutation");return e.setAttribute(h.countAttributeName,this.count.toString()),e}domToMutation(e){const t=e.getAttribute(h.countAttributeName);if(t){try{this.count=parseInt(t)}catch(e){return}for(let e=0;e<this.count;e++)this.addNumberField(!1,e)}}updateBlock(e){if(e){const t=Math.abs(this.count-e.length);if(this.count<e.length)for(let e=0;e<t;e++)this.addNumberField(!0,this.count);else if(this.count>e.length)for(let e=0;e<t;e++)this.removeNumberField()}}getSubBlockNames(){return[{name:"Value",type:h.entryTypeName}]}getVisibleBlockTypes(){const e=[];return this.forEachInput((()=>e.push(h.entryTypeName))),e}addNumberField(e,t){const i=this.block.appendValueInput(h.valueInputPrefix+t).setCheck("Number");if(e){const e=this.block.workspace.newBlock("math_number");e.initSvg(),e.setShadow(!0),i.connection.connect(e.outputConnection),this.block.workspace.render(),this.count++}}removeNumberField(){this.count>0&&this.block.removeInput(h.valueInputPrefix+(this.count-1)),this.count--}forEachInput(e){for(let t=0;t<this.count;t++)e(this.block.getInputTargetBlock(h.valueInputPrefix+t),t)}}h.countAttributeName="count",h.entryTypeName="entry",h.valueInputPrefix="value_input_";class d extends c{constructor(){super(...arguments),this.showing=!1}getMutationType(){return a.DefaultInstanceMutator}compileMutation(e,t){if(this.showing){const i=this.block.getInputTargetBlock(d.instanceInputName);if(i)return(0,o.compileExpression)(e,i,t)}}mutationToDom(){const e=document.createElement("mutation");return e.setAttribute(d.attributeName,this.showing?"true":"false"),e}domToMutation(e){const t=e.getAttribute(d.attributeName);t?this.updateShape("true"===t):this.updateShape(!1)}updateBlock(e){this.updateShape(!(!e||!e.length))}getSubBlockNames(){return[{name:"Instance",type:d.instanceSubBlockType}]}getVisibleBlockTypes(){const e=[];return this.showing&&e.push(d.instanceSubBlockType),e}updateShape(e){this.showing!==e&&(e&&!this.block.getInputTargetBlock(d.instanceInputName)?this.block.appendValueInput(d.instanceInputName):this.block.removeInput(d.instanceInputName),this.showing=e)}}d.attributeName="showing",d.instanceInputName="__instance__",d.instanceSubBlockType="instance"},{"./compiler/compiler":12,"./compiler/util":15,"./loader":71,blockly:207}],71:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setVarFieldValue=i.generateIcons=i.getFixedInstanceDropdownValues=i.setOutputCheck=i.initialize=i.initializeAndInject=i.cleanBlocks=i.hasArrowFunction=i.injectBlocks=i.blockSymbol=i.cachedBlockInfo=i.buildinBlockStatements=i.builtinBlocks=i.isTupleType=void 0;const n=e("blockly"),s=e("./constants"),o=e("./composableMutations"),r=e("./legacyMutations"),a=e("./builtins/math"),l=e("./fields"),c=e("./builtins/functions"),u=e("./builtins/lists"),h=e("./builtins/logic"),d=e("./builtins/loops"),p=e("./builtins/text"),g=e("./toolbox"),m=e("./help"),f=e("./fields"),_=e("./fields"),T=e("./fields"),E=e("./fields"),b=e("./external"),I=e("./builtins/variables"),y=e("./builtins/misc"),v=e("./contextMenu"),C=e("./codecardRenderer"),k=e("./fields/field_dropdown"),O=e("./plugins/duplicateOnDrag");let N;function A(){return N||(N={},Object.keys(n.Blocks).forEach((e=>N[e]={block:n.Blocks[e]}))),N}i.isTupleType=function(e){let t=/^\[(.+)\]$/.exec(e);return t?t[1].split(/,\s*/):void 0},i.builtinBlocks=A,i.buildinBlockStatements={controls_if:!0,controls_for:!0,pxt_controls_for:!0,controls_simple_for:!0,controls_repeat_ext:!0,pxt_controls_for_of:!0,controls_for_of:!0,variables_set:!0,variables_change:!0,device_while:!0};let S={};function R(e){return i.cachedBlockInfo=e,(0,O.setDraggableShadowBlocks)(e.blocks.filter((e=>e.attributes.duplicateShadowOnDrag)).map((e=>e.attributes.blockId))),e.blocks.map((t=>{const i=pxt.blocks.compileInfo(t),a=(0,g.createToolboxBlock)(e,t,i,!1,2);if(t.attributes.blockBuiltin){pxt.Util.assert(!!A()[t.attributes.blockId]);const e=A()[t.attributes.blockId];e.symbol=t,e.block.codeCard=(0,m.mkCard)(t,a)}else!function(e,t,i,a){let c=t.attributes.blockId;if(A()[c])return pxt.reportError("blocks","trying to override builtin block",{details:c}),!1;let u=JSON.stringify(t);if(S[c]&&S[c].hash==u)return!0;if(n.Blocks[t.attributes.blockId])return console.error("duplicate block definition: "+c),!1;let h={hash:u,fn:t,block:{codeCard:(0,m.mkCard)(t,a),init:function(){!function(e,t,i,a){var c;const u=(i.attributes.blockNamespace||i.namespace).split(".")[0],h=1==i.kind||2==i.kind,d=t.apis.byQName[u],p=i.attributes.blockNamespace&&d&&d.attributes.color||i.attributes.color||d&&d.attributes.color||pxt.toolbox.getNamespaceColor(u)||255,g=pxt.blocks.getHelpUrl(i);g&&e.setHelpUrl(g),(0,O.setDuplicateOnDragStrategy)(e),e.setColour("string"==typeof p?pxt.toolbox.getAccessibleBackground(p):p);let m=s.provider.SHAPES.ROUND;"boolean"==i.retType&&(m=s.provider.SHAPES.HEXAGONAL),e.setOutputShape(m),i.attributes.undeletable&&e.setDeletable(!1),v(i.attributes._def);let b=!1;if(i.attributes.mutate)(0,r.addMutation)(e,i,i.attributes.mutate);else if(i.attributes.defaultInstance)(0,r.addMutation)(e,i,r.MutatorTypes.DefaultInstanceMutator);else if(i.attributes._expandedDef&&"disabled"!==i.attributes.expandableArgumentMode){const n="toggle"===i.attributes.expandableArgumentMode;(0,o.initExpandableBlock)(t,e,i.attributes._expandedDef,a,n,(()=>v(i.attributes._expandedDef,!0)))}else if(a.handlerArgs.length)if(b=!0,i.attributes.optionalVariableArgs)(0,o.initVariableArgsBlock)(e,a.handlerArgs);else if(i.attributes.draggableParameters)a.handlerArgs.filter((e=>!e.inBlockDef)).forEach((n=>{const s=e.appendValueInput("HANDLER_DRAG_PARAM_"+n.name);"reporter"==i.attributes.draggableParameters?s.setCheck($(n.type,t)):s.setCheck("Variable")}));else{let t=e.appendDummyInput();a.handlerArgs.filter((e=>!e.inBlockDef)).forEach((e=>{t.appendField(new n.FieldVariable(e.name),"HANDLER_"+e.name)}))}(0,o.appendMutation)(e,{mutationToDom:t=>(e.inputList.forEach((e=>{e.fieldRow.forEach((e=>{if(e.isFieldCustom_&&e.saveOptions){const i=e.saveOptions();i&&t.setAttribute("customfield",JSON.stringify(i))}}))})),t),domToMutation:t=>{e.inputList.forEach((e=>{e.fieldRow.forEach((e=>{if(e.isFieldCustom_&&e.restoreOptions){const i=JSON.parse(t.getAttribute("customfield"));i&&e.restoreOptions(i)}}))}))}});const I=i.attributes.imageLiteral||i.attributes.gridLiteral;if(I){const t=(i.attributes.imageLiteralColumns||5)*I,n=i.attributes.imageLiteralRows||5,s=i.attributes.imageLiteralScale,o=i.attributes.gridLiteralOnColor,r=i.attributes.gridLiteralOffColor;e.appendDummyInput().appendField(new f.FieldMatrix("",{columns:t,rows:n,scale:s,onColor:o,offColor:r}),"LEDS")}"external"===i.attributes.inlineInputMode?e.setInputsInline(!1):"inline"===i.attributes.inlineInputMode?e.setInputsInline(!0):e.setInputsInline(!i.parameters||i.parameters.length<4&&!I),((null===(c=i.parameters)||void 0===c?void 0:c.find((e=>pxtc.parameterTypeIsArrowFunction(e))))||b)&&(e.appendStatementInput("HANDLER").setCheck(null),e.setInputsInline(!0)),D(e,i.retType,t);const y=w(i);function v(o,r=!1){let c=0,u=!r&&!!a.thisParameter;const d=function(e){const t=[];let i=[];return e.parts.forEach((e=>{switch(e.kind){case"break":n();break;case"param":i.push(e),n();break;case"image":case"label":i.push(e)}})),n(),t;function n(){i.length&&(t.push(i),i=[])}}(o),g=new pxt.ImageConverter;if(("ENUM_GET"===i.attributes.shim||"KIND_GET"===i.attributes.shim)&&(a.parameters.length>1||a.thisParameter))return void console.warn(`Enum blocks may only have 1 parameter but ${i.attributes.blockId} has ${a.parameters.length}`);const m=t=>{var i;return null===(i=e.inputList)||void 0===i?void 0:i.some((e=>e.name===t))};d.forEach((o=>{const d=[];let f,b,I,y=!1;if(o.forEach((e=>{if("param"!==e.kind){const t=function(e){if("image"===e.kind)return function(e){let t=P[e];if(t)return new n.FieldImage(t,40,40,"",null,pxt.Util.isUserLanguageRtl());pxt.log(`missing jres icon ${e}`)}(e.uri);const t=function(e){if(" "===e)return"";if(e.length>1){const t=" "==e.charAt(0),i=" "==e.charAt(e.length-1);if(t||i)return e.substring(t?1:0,i?e.length-1:e.length)}return e}(e.text);return t?e.cssClass?new n.FieldLabel(t,e.cssClass):e.style.length?new _.FieldStyledLabel(t,{bold:-1!==e.style.indexOf("bold"),italics:-1!==e.style.indexOf("italics"),blocksInfo:void 0}):new n.FieldLabel(t,void 0):void 0}(e);t&&d.push({field:t})}else{if("ENUM_GET"===i.attributes.shim)return pxt.Util.assert(!!i.attributes.enumName,"Trying to create an ENUM_GET block without a valid enum name"),void d.push({name:"MEMBER",field:new T.FieldUserEnum(t.enumsByName[i.attributes.enumName])});if("KIND_GET"===i.attributes.shim)return void d.push({name:"MEMBER",field:new l.FieldKind(t.kindsByName[i.attributes.kindNamespace||i.attributes.blockNamespace||i.namespace])});{let s=function(e,t,i=!1){if(e.ref){const i="this"===e.name?t.thisParameter:t.actualNameToParam[e.name];if(!i){let i;if(t.handlerArgs.forEach((t=>{t.name===e.name&&(i=t)})),i)return i}return i}return i?t.thisParameter:t.definitionNameToParam[e.name]}(e,a,u);if(u=!1,!s)return void console.error("block "+i.attributes.blockId+": unknown parameter "+e.name+(e.ref?` (${e.ref})`:""));if(function(e){return!e.definitionName}(s))return f="HANDLER_DRAG_PARAM_"+s.name,void(b="reporter"===i.attributes.draggableParameters?$(s.type,t):"Variable");let o=pxt.Util.lookup(t.apis.byQName,s.type);y=!0;const r=s.definitionName,l=s.actualName;let c=o&&6==o.kind,m=o&&!!o.attributes.fixedInstances&&!s.shadowBlockId,_=!!i.attributes.constantShim,T="@combined@"==s.type,I=s.fieldEditor,v=r.charAt(0).toUpperCase()+r.slice(1),C=s.type;if(c||m||_||T){let e;0==(e=c?function(e,t){return pxt.Util.values(e.byQName).filter((e=>e.namespace===t&&!e.attributes.blockHidden))}(t.apis,s.type):m?F(t.apis,o.qName):T?i.combinedProperties.map((e=>pxt.Util.lookup(t.apis.byQName,e))):function(e,t){return pxt.Util.values(e.byQName).filter((e=>e.attributes.blockIdentity===t))}(t.apis,i.qName)).length&&console.error(`no instances of ${o.qName} found`);const n=e.map((e=>{let t=e.attributes.block||e.attributes.blockId||e.name,i=e.attributes.blockCombine;return e.attributes.jresURL&&!e.attributes.iconURL&&pxt.Util.startsWith(e.attributes.jresURL,"data:image/x-mkcd-f")&&(e.attributes.iconURL=g.convert(e.attributes.jresURL)),i&&(t=t.replace(/@set/,"")),[e.attributes.iconURL||e.attributes.blockImage?{src:e.attributes.iconURL||pxt.Util.pathJoin(pxt.webConfig.commitCdnUrl,`blocks/${e.namespace.toLowerCase()}/${e.name.toLowerCase()}.png`),alt:t,width:36,height:36,value:e.name}:t,e.namespace+"."+e.name]}));if(s.defaultValue){let e=-1;if(n.some(((t,i)=>t[1]===s.defaultValue&&(e=i,!0))),e>-1){const t=n.splice(e,1)[0];n.unshift(t)}}if(I){let e=i.attributes.paramDefl[l]||"";const s={data:n,colour:p,label:v,type:C,blocksInfo:t};pxt.Util.jsonMergeFrom(s,i.attributes.paramFieldEditorOptions&&i.attributes.paramFieldEditorOptions[l]||{}),d.push(B((0,E.createFieldEditor)(I,e,s),r))}else d.push(B(new k.FieldDropdown(n),r))}else if(I){const e=i.attributes.paramDefl[s.actualName]||"",n={colour:p,label:v,type:C,blocksInfo:t};pxt.Util.jsonMergeFrom(n,i.attributes.paramFieldEditorOptions&&i.attributes.paramFieldEditorOptions[s.actualName]||{}),d.push(B((0,E.createFieldEditor)(I,e,n),s.definitionName))}else f=r,h&&"this"===e.name?b=s.type:"number"==s.type&&s.shadowBlockId&&"value"==s.shadowBlockId?(f=void 0,d.push(B(new n.FieldNumber("0"),r))):b="string"==s.type&&s.shadowOptions&&s.shadowOptions.toString?null:$(s.type,t)}}})),f){if(m(f))return;(I=e.appendValueInput(f)).setAlign(n.inputs.Align.LEFT)}else if(r){const t=y?s.optionalInputWithFieldPrefix:s.optionalDummyInputPrefix;if(f=t+c++,m(f))return;I=e.appendDummyInput(f)}else I=e.appendDummyInput();b&&I.setCheck(b),d.forEach((e=>I.appendField(e.field,e.name)))})),g.logTime()}e.setPreviousStatement(!(y&&!i.attributes.handlerStatement)&&"void"==i.retType),e.setNextStatement(!(y&&!i.attributes.handlerStatement)&&"void"==i.retType),e.setTooltip(/^__/.test(i.namespace)?"":i.attributes.jsDoc)}(this,e,t,i)}}};pxt.Util.isTranslationMode()&&(h.block.customContextMenu=e=>{t.attributes.translationId&&e.push({enabled:!0,text:lf("Translate this block"),callback:function(){(0,b.promptTranslateBlock)(c,[t.attributes.translationId])}})}),S[c]=h,n.Blocks[c]=h.block}(e,t,i,a);return t}))}function w(e){var t;return!!(null===(t=e.parameters)||void 0===t?void 0:t.some((e=>pxtc.parameterTypeIsArrowFunction(e))))}i.blockSymbol=function(e){let t=S[e];return t?t.fn:void 0},i.injectBlocks=R,i.hasArrowFunction=w,i.cleanBlocks=function(){pxt.debug("removing all custom blocks");for(const e in S)M(S[e].fn)},i.initializeAndInject=function(e){x(e),R(e)},i.initialize=function(e){x(e),function(e){P={};const t=e.apis.jres;t&&Object.keys(t).forEach((e=>{const i=t[e];i&&i.icon&&(P[e]=i.icon)}))}(e)};let L=!1;function x(e){L||(L=!0,(0,E.initFieldEditors)(),(0,v.initContextMenu)(),(0,y.initOnStart)(),(0,a.initMath)(e),(0,I.initVariables)(),(0,c.initFunctions)(),(0,u.initLists)(),(0,d.initLoops)(),(0,h.initLogic)(),(0,p.initText)(),n.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="",function(){const e=e=>{if(e.disabled)return lf("This block is disabled and will not run. Attach this block to an event to enable it.");let t=e.tooltip;for(;"function"==typeof t;)t=t(e);return t};n.Tooltip.setCustomTooltip(((t,i)=>{if(i.codeCard){const n=(0,C.renderCodeCard)({header:e(i)});t.appendChild(n)}else{let s=e(i),o=(s=n.utils.string.wrap(s,n.Tooltip.LIMIT)).split("\n");for(let e=0;e<o.length;e++){let i=document.createElement("div");i.appendChild(document.createTextNode(o[e])),t.appendChild(i)}}}))}())}function $(e,t){const i=e.split(/\s*\|\s*/),n=[];for(const e of i)switch(e){case"number":n.push("Number");break;case"string":n.push("String");break;case"boolean":n.push("Boolean");break;case"T":case"any":return null;case"void":return;default:if((0,g.isArrayType)(e)){if(i.length>1)return null;n.push("Array")}const s=t.apis.byQName[e];s&&s.extendsTypes&&0<s.extendsTypes.length?n.push(...s.extendsTypes):n.push(e)}return n}function D(e,t,i){const n=$(t,i);(n||null===n)&&e.setOutput(!0,n)}function M(e){delete n.Blocks[e.attributes.blockId],delete S[e.attributes.blockId]}i.setOutputCheck=D;let P={};function B(e,t){return{field:e,name:t}}function F(e,t){return pxt.Util.values(e.byQName).filter((i=>4===i.kind&&i.attributes.fixedInstance&&function(e,t,i){if(t==i)return!0;let n=e.byQName[t];return!(!n||!n.extendsTypes)&&n.extendsTypes.indexOf(i)>=0}(e,i.retType,t))).sort(((e,t)=>(t.attributes.weight||50)-(e.attributes.weight||50)))}i.getFixedInstanceDropdownValues=F,i.generateIcons=function(e){const t=new pxt.ImageConverter;e.forEach((e=>{e.attributes.jresURL&&!e.attributes.iconURL&&pxt.Util.startsWith(e.attributes.jresURL,"data:image/x-mkcd-f")&&(e.attributes.iconURL=t.convert(e.attributes.jresURL))}))},i.setVarFieldValue=function(e,t,i){const n=e.getField(t),s=e.workspace.getAllVariables();let o=!1;if(s&&s.length)for(let e=0;e<s.length;e++){const t=s[e];t.name===i&&(n.setValue(t.getId()),o=!0)}if(!o){n.initModel();const e=n.getVariable();e.name=i,n.setValue(e.getId())}}},{"./builtins/functions":3,"./builtins/lists":4,"./builtins/logic":5,"./builtins/loops":6,"./builtins/math":7,"./builtins/misc":8,"./builtins/text":9,"./builtins/variables":10,"./codecardRenderer":11,"./composableMutations":17,"./constants":18,"./contextMenu":21,"./external":24,"./fields":65,"./fields/field_dropdown":33,"./help":66,"./legacyMutations":70,"./plugins/duplicateOnDrag":84,"./toolbox":127,blockly:207}],72:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.monkeyPatchBlockSvg=void 0;const n=e("blockly"),s=e("../plugins/renderer/constants");i.monkeyPatchBlockSvg=function(){const e=n.BlockSvg.prototype.setCollapsed;n.BlockSvg.prototype.setCollapsed=function(t){if(t!==this.isCollapsed()&&(e.call(this,t),this.isCollapsed())){const e=this.getInput(n.constants.COLLAPSED_INPUT_NAME),t=s.ConstantProvider.EXPAND_IMAGE_DATAURI;t&&e.appendField(new n.FieldImage(t,24,24,"",(()=>{this.setCollapsed(!1)}),!1))}}}},{"../plugins/renderer/constants":114,blockly:207}],73:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.monkeyPatchGrid=void 0;const n=e("blockly");i.monkeyPatchGrid=function(){var e,t;const i=null===(e=pxt.appTarget.appTheme.blocklyOptions)||void 0===e?void 0:e.grid;if(!(null===(t=null==i?void 0:i.image)||void 0===t?void 0:t.path))return;const s=[];n.Grid.createDom=function(e,t,o){const r="blocklyGridPattern"+e,a=n.utils.dom.createSvgElement(n.utils.Svg.PATTERN,{id:r,patternUnits:"userSpaceOnUse",width:i.image.width,height:i.image.height},o);return s.push(r),n.utils.dom.createSvgElement(n.utils.Svg.IMAGE,{width:i.image.width,height:i.image.height,opacity:i.image.opacity},a).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i.image.path),a};const o=n.Grid.prototype.update;n.Grid.prototype.update=function(e){o.call(this,e);const t=[];for(const n of s){const s=document.getElementById(n);s?(s.setAttribute("width",i.image.width),s.setAttribute("height",i.image.height),s.setAttribute("patternTransform","scale("+e+")")):t.push(n)}for(const e of t)s.splice(s.indexOf(e),1)}}},{blockly:207}],74:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.applyMonkeyPatches=void 0;const n=e("./blockSvg"),s=e("./grid");i.applyMonkeyPatches=function(){(0,n.monkeyPatchBlockSvg)(),(0,s.monkeyPatchGrid)()}},{"./blockSvg":72,"./grid":73}],75:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly"),s=e("../functions/constants"),o={valueConnections_:[],horizontalAfter_:3,itemCount_:3,mutationToDom:function(){const e=n.utils.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_+""),this.horizontalAfter_&&e.setAttribute("horizontalafter",this.horizontalAfter_+""),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10);const t=e.getAttribute("horizontalafter");t&&(this.horizontalAfter_=parseInt(t,10)),this.updateShape_()},storeConnections_:function(){this.valueConnections_=[];for(let e=0;e<this.itemCount_;e++)this.valueConnections_.push(this.getInput("ADD"+e).connection.targetConnection)},restoreConnections_:function(){var e;for(let t=0;t<this.itemCount_;t++)null===(e=this.valueConnections_[t])||void 0===e||e.reconnect(this,"ADD"+t)},addItem_:function(){if(this.storeConnections_(),this.update_((()=>{this.itemCount_++})),this.restoreConnections_(),this.itemCount_>1){const o=this.getInput("ADD0");if(o&&o.connection.targetConnection){const r=this.getInput("ADD"+(this.itemCount_-1)),a=o.connection.getShadowDom(),l=a&&a.getAttribute("type");if(l){const n=i("shadow",l),s=e(a,"value");for(let i=0;i<s.length;i++){const o=s[i],r=o.getAttribute("name"),a=e(o,"shadow")[0];t(n,r,a&&a.getAttribute("type"))}r.connection.setShadowDom(n)}const c=o.connection.targetConnection,u=c&&c.getSourceBlock(),h=u&&u.type;if(h&&h!==l){const e=i("block",h);if(u)if(h===s.FUNCTION_CALL_OUTPUT_BLOCK_TYPE){const t=n.utils.xml.createElement("mutation");t.setAttribute("name",u.getName()),e.appendChild(t)}else if(u.inputList)for(let i=0;i<u.inputList.length;i++){const n=u.inputList[i],s=n.connection&&n.connection.getShadowDom(),o=s&&s.getAttribute("type");t(e,n.name,o)}const o=n.Xml.domToBlock(e,this.workspace);r.connection.connect(o.outputConnection)}else r.connection.setShadowDom(r.connection.getShadowDom())}}function e(e,t){const i=[];if(!e||!e.children)return i;for(let n=0;n<e.children.length;n++){const s=e.children[n];s.tagName===t&&i.push(s)}return i}function t(e,t,s){if(!t||!s)return;const o=n.utils.xml.createElement("value");o.setAttribute("name",t),o.appendChild(i("shadow",s)),e.appendChild(o)}function i(e,t){const i=n.utils.xml.createElement(e);return i.setAttribute("type",t),i.setAttribute("id",n.utils.idGenerator.genUid()),i}},removeItem_:function(){this.storeConnections_(),this.update_((()=>{this.itemCount_--})),this.restoreConnections_()},update_:function(e){n.Events.setGroup(!0);const t=this,i=t.mutationToDom(),s=i&&n.Xml.domToText(i);e&&e.call(this),this.updateShape_(),t instanceof n.BlockSvg&&t.initSvg();const o=n.Events.getGroup(),r=t.mutationToDom(),a=r&&n.Xml.domToText(r);s!=a&&(n.Events.fire(new n.Events.BlockChange(t,"mutation",null,s,a)),setTimeout((function(){n.Events.setGroup(o),t.bumpNeighbours(),n.Events.setGroup(!1)}),n.config.bumpDelay)),t.rendered&&t instanceof n.BlockSvg&&t.render(),n.Events.setGroup(!1)},updateShape_:function(){this.itemCount_?(this.getInput("EMPTY")&&this.removeInput("EMPTY"),this.getInput("TITLE")||this.appendDummyInput("TITLE").appendField(n.Msg.LISTS_CREATE_WITH_INPUT_WITH)):(this.getInput("TITLE")&&this.removeInput("TITLE"),this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(n.Msg.LISTS_CREATE_EMPTY_TITLE));let e=0;for(e=0;e<this.itemCount_;e++)this.getInput("ADD"+e)||this.appendValueInput("ADD"+e);for(;this.getInput("ADD"+e);)this.removeInput("ADD"+e),e++;this.getInput("BUTTONS")&&this.removeInput("BUTTONS");const t=this.appendDummyInput("BUTTONS");this.itemCount_>0&&t.appendField(new n.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",(()=>{this.removeItem_()}),!1)),t.appendField(new n.FieldImage(this.ADD_IMAGE_DATAURI,24,24,"*",(()=>{this.addItem_()}),!1));const i=this.itemCount_<=this.horizontalAfter_;if(this.setInputsInline(i),this.workspace instanceof n.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(i?e.getConstants().SHAPES.ROUND:e.getConstants().SHAPES.SQUARE)}}};n.Blocks.lists_create_with=Object.assign(Object.assign({},o),{init:function(){if(n.Extensions.apply("inline-svgs",this,!1),this.setHelpUrl(n.Msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.updateShape_(),this.setOutput(!0,"Array"),this.workspace instanceof n.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(e.getConstants().SHAPES.ROUND)}this.setInputsInline(!0),this.setTooltip(n.Msg.LISTS_CREATE_WITH_TOOLTIP)}})},{"../functions/constants":94,blockly:207}],76:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),s(e("./createList"),i)},{"./createList":75}],77:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CommentIcon=void 0;const n=e("blockly"),s=e("./textinput_bubble"),o=e("../../fields"),r=n.Events,a="~commentOffsetX",l="~commentOffsetY";class c extends n.icons.Icon{constructor(e){super(e),this.sourceBlock=e,this.textInputBubble=null,this.text="",this.bubbleSize=new n.utils.Size(160,80),this.bubbleVisiblity=!1}getType(){return c.TYPE}initView(e){this.svgRoot||(super.initView(e),n.utils.dom.createSvgElement(n.utils.Svg.PATH,{class:"blocklyIconShape",d:"m 2,2 0,9.2211 3.0026599,0 1.6008929,1.5989 1.8138195,-1.5989 6.6046683,0 0,-9.2211 -13.0220406,0 z",style:"fill: #fff;"},this.svgRoot),n.utils.dom.createSvgElement("rect",{class:"blocklyIconSymbol",x:"4",y:"8",height:"1",width:"6",style:"fill: #575E75;"},this.svgRoot),n.utils.dom.createSvgElement(n.utils.Svg.RECT,{class:"blocklyIconSymbol",x:"4",y:"6",height:"1",width:"6",style:"fill: #575E75;"},this.svgRoot),n.utils.dom.createSvgElement("rect",{class:"blocklyIconSymbol",x:"4",y:"4",height:"1",width:"8",style:"fill: #575E75;"},this.svgRoot),n.utils.dom.addClass(this.svgRoot,"blockly-icon-comment"))}dispose(){var e;super.dispose(),null===(e=this.textInputBubble)||void 0===e||e.dispose()}getWeight(){return c.WEIGHT}getSize(){return new n.utils.Size(17,17)}applyColour(){var e;super.applyColour();const t=this.sourceBlock.style.colourPrimary,i=this.sourceBlock.style.colourTertiary;null===(e=this.textInputBubble)||void 0===e||e.setColour(t,i)}async updateEditable(){super.updateEditable(),this.bubbleIsVisible()&&(await this.setBubbleVisible(!1),await this.setBubbleVisible(!0))}onLocationChange(e){var t;super.onLocationChange(e);const i=this.getAnchorLocation();null===(t=this.textInputBubble)||void 0===t||t.setAnchorLocation(i)}setText(e){var t;this.text||e||this.clearSavedOffsetData();const i=this.text;r.fire(new(r.get(r.BLOCK_CHANGE))(this.sourceBlock,"comment",null,i,e)),this.text=e,null===(t=this.textInputBubble)||void 0===t||t.setText(this.text)}getText(){return this.text}setBubbleSize(e){var t;this.bubbleSize=e,null===(t=this.textInputBubble)||void 0===t||t.setSize(this.bubbleSize,!0)}getBubbleSize(){return this.bubbleSize}saveState(){return this.text?{text:this.text,pinned:this.bubbleIsVisible(),height:this.bubbleSize.height,width:this.bubbleSize.width}:null}loadState(e){var t,i,s,o;this.text=null!==(t=e.text)&&void 0!==t?t:"",this.bubbleSize=new n.utils.Size(null!==(i=e.width)&&void 0!==i?i:160,null!==(s=e.height)&&void 0!==s?s:80),this.bubbleVisiblity=null!==(o=e.pinned)&&void 0!==o&&o,this.setBubbleVisible(this.bubbleVisiblity)}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}onTextChange(){if(!this.textInputBubble)return;const e=this.textInputBubble.getText();this.text!==e&&(r.fire(new(r.get(r.BLOCK_CHANGE))(this.sourceBlock,"comment",null,this.text,e)),this.text=e)}onSizeChange(){this.textInputBubble&&(this.bubbleSize=this.textInputBubble.getSize())}onPositionChange(){if(this.textInputBubble){const e=this.textInputBubble.getPositionRelativeToAnchor();(0,o.setBlockDataForField)(this.sourceBlock,a,e.x+""),(0,o.setBlockDataForField)(this.sourceBlock,l,e.y+"")}}bubbleIsVisible(){return this.bubbleVisiblity}async setBubbleVisible(e){this.bubbleVisiblity!==e&&(e&&this.textInputBubble||(e||this.textInputBubble)&&(this.bubbleVisiblity=e,!this.sourceBlock.rendered||this.sourceBlock.isInFlyout||this.sourceBlock.isInsertionMarker()||(await n.renderManagement.finishQueuedRenders(),!this.sourceBlock.rendered||this.sourceBlock.isInFlyout||this.sourceBlock.isInsertionMarker()||(e?(this.sourceBlock.isEditable()?this.showEditableBubble():this.showNonEditableBubble(),this.applyColour()):this.hideBubble(),this.sourceBlock.isEditable()&&r.fire(new(r.get(r.BUBBLE_OPEN))(this.sourceBlock,e,"comment"))))))}showEditableBubble(){const e=this.getSavedOffsetData();this.textInputBubble=new s.TextInputBubble(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0),this.textInputBubble.addTextChangeListener((()=>this.onTextChange())),this.textInputBubble.addSizeChangeListener((()=>this.onSizeChange())),this.textInputBubble.addPositionChangeListener((()=>this.onPositionChange())),this.textInputBubble.setDeleteHandler((()=>{this.setBubbleVisible(!1),this.sourceBlock.setCommentText(null),this.clearSavedOffsetData()})),this.textInputBubble.setCollapseHandler((()=>{this.setBubbleVisible(!1)})),e&&this.textInputBubble.setPositionRelativeToAnchor(e.x,e.y)}showNonEditableBubble(){const e=this.getSavedOffsetData();this.textInputBubble=new s.TextInputBubble(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect(),!0),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0),this.textInputBubble.setCollapseHandler((()=>{this.setBubbleVisible(!1)})),e&&this.textInputBubble.setPositionRelativeToAnchor(e.x,e.y)}hideBubble(){var e;null===(e=this.textInputBubble)||void 0===e||e.dispose(),this.textInputBubble=null}getAnchorLocation(){return n.utils.Coordinate.sum(this.workspaceLocation,new n.utils.Coordinate(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new n.utils.Rect(e.y,e.y+e.height,e.x,e.x+e.width)}getSavedOffsetData(){const e=(0,o.getBlockDataForField)(this.sourceBlock,a),t=(0,o.getBlockDataForField)(this.sourceBlock,l);if(e&&t)return new n.utils.Coordinate(parseFloat(e),parseFloat(t))}clearSavedOffsetData(){(0,o.deleteBlockDataForField)(this.sourceBlock,a),(0,o.deleteBlockDataForField)(this.sourceBlock,l)}}i.CommentIcon=c,c.TYPE=n.icons.IconType.COMMENT,c.WEIGHT=3,n.icons.registry.unregister(c.TYPE.toString()),n.icons.registry.register(c.TYPE,c)},{"../../fields":65,"./textinput_bubble":80,blockly:207}],78:[function(e,t,i){"use strict";var n;Object.defineProperty(i,"__esModule",{value:!0}),i.Bubble=void 0;const s=e("blockly");var o=s.utils.dom;class r{constructor(e,t,i){this.workspace=e,this.anchor=t,this.ownerRect=i,this.size=new s.utils.Size(0,0),this.colour="#ffffff",this.disposed=!1,this.relativeTop=0,this.relativeLeft=0,this.dragStrategy=new s.dragging.BubbleDragStrategy(this,this.workspace),this.id=s.utils.idGenerator.getNextUniqueId(),this.svgRoot=o.createSvgElement(s.utils.Svg.G,{class:"blocklyBubble"},e.getBubbleCanvas());const n=o.createSvgElement(s.utils.Svg.G,{},this.svgRoot);this.tail=o.createSvgElement(s.utils.Svg.LINE,{"stroke-width":"3","stroke-linecap":"round"},n),this.background=o.createSvgElement(s.utils.Svg.RECT,{class:"blocklyDraggable","stroke-width":"3",x:0,y:0},n),this.contentContainer=o.createSvgElement(s.utils.Svg.G,{},this.svgRoot),this.topBar=o.createSvgElement(s.utils.Svg.RECT,{class:"blocklyCommentTopbarBackground",x:r.BORDER_WIDTH,y:r.BORDER_WIDTH},n),this.deleteIcon=o.createSvgElement(s.utils.Svg.IMAGE,{class:"blocklyDeleteIcon",href:`${e.options.pathToMedia}delete-icon.svg`},n),this.collapseIcon=o.createSvgElement(s.utils.Svg.IMAGE,{class:"blocklyFoldoutIcon",href:`${e.options.pathToMedia}foldout-icon.svg`},n),s.browserEvents.conditionalBind(this.background,"pointerdown",this,this.onMouseDown),s.browserEvents.conditionalBind(this.topBar,"pointerdown",this,this.onMouseDown),s.browserEvents.conditionalBind(this.collapseIcon,"pointerdown",this,this.onCollapseDown),s.browserEvents.conditionalBind(this.deleteIcon,"pointerdown",this,this.onDeleteDown)}dispose(){this.disposed||(o.removeNode(this.svgRoot),this.disposed=!0,this.isDragDelete&&this.deleteHandler&&this.deleteHandler())}setAnchorLocation(e,t=!1){this.anchor=e,t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}setPositionRelativeToAnchor(e,t){this.relativeLeft=e,this.relativeTop=t,this.positionRelativeToAnchor(),this.renderTail()}getPositionRelativeToAnchor(){return new s.utils.Coordinate(this.relativeLeft,this.relativeTop)}getSize(){return this.size}setSize(e,t=!1){const i=this.topBar.getBBox(),n=this.deleteIcon.getBBox(),s=this.collapseIcon.getBBox();e.width=Math.max(e.width,r.MIN_SIZE),e.height=Math.max(e.height,r.MIN_SIZE),this.size=e,this.background.setAttribute("width",`${e.width}`),this.background.setAttribute("height",`${e.height}`),this.topBar.setAttribute("width",""+(e.width-r.DOUBLE_BORDER)),this.updateDeleteIconPosition(e,i,n),this.updateFoldoutIconPosition(i,s),t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}getColour(){return this.colour}setColour(e,t){this.colour=e,this.tail.setAttribute("stroke",t||e),this.background.setAttribute("fill",t||e),this.background.setAttribute("stroke",t||e),this.svgRoot.setAttribute("style",`--commentBorderColour: ${e}`)}onMouseDown(e){var t;null===(t=this.workspace.getGesture(e))||void 0===t||t.handleBubbleStart(e,this),s.common.setSelected(this)}positionRelativeToAnchor(){let e=this.anchor.x;this.workspace.RTL?e-=this.relativeLeft+this.size.width:e+=this.relativeLeft;const t=this.relativeTop+this.anchor.y;this.moveTo(e,t)}moveTo(e,t){this.svgRoot.setAttribute("transform",`translate(${e}, ${t})`)}positionByRect(e=new s.utils.Rect(0,0,0,0)){const t=this.workspace.getMetricsManager().getViewMetrics(!0),i=this.getOptimalRelativeLeft(t),n=this.getOptimalRelativeTop(t),o={x:i,y:-this.size.height-this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT},r={x:-this.size.width-30,y:n},a={x:e.getWidth(),y:n},l={x:i,y:e.getHeight()},c=e.getWidth()<e.getHeight()?a:l,u=e.getWidth()<e.getHeight()?l:a,h=this.getOverlap(o,t),d=this.getOverlap(r,t),p=this.getOverlap(c,t),g=this.getOverlap(u,t),m=Math.max(h,d,p,g);return h===m?(this.relativeLeft=o.x,this.relativeTop=o.y,void this.positionRelativeToAnchor()):d===m?(this.relativeLeft=r.x,this.relativeTop=r.y,void this.positionRelativeToAnchor()):p===m?(this.relativeLeft=c.x,this.relativeTop=c.y,void this.positionRelativeToAnchor()):(this.relativeLeft=u.x,this.relativeTop=u.y,void this.positionRelativeToAnchor())}getOverlap(e,t){const i={x:this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x+this.anchor.x,y:e.y+this.anchor.y},n={x:i.x+this.size.width,y:i.y+this.size.height},s={x:t.left,y:t.top},o={x:t.left+t.width,y:t.top+t.height},r=Math.min(n.x,o.x)-Math.max(i.x,s.x),a=Math.min(n.y,o.y)-Math.max(i.y,s.y);return Math.max(0,Math.min(1,r*a/(this.size.width*this.size.height)))}getOptimalRelativeLeft(e){let t=-this.size.width/4;if(this.size.width>e.width)return t;const i=this.getWorkspaceViewRect(e);if(this.workspace.RTL){const e=this.anchor.x-t;e-this.size.width<i.left?t=-(i.left-this.anchor.x+this.size.width):e>i.right&&(t=-(i.right-this.anchor.x))}else{const e=t+this.anchor.x,n=e+this.size.width;e<i.left?t=i.left-this.anchor.x:n>i.right&&(t=i.right-this.anchor.x-this.size.width)}return t}getOptimalRelativeTop(e){let t=-this.size.height/4;if(this.size.height>e.height)return t;const i=this.anchor.y+t,n=i+this.size.height,s=this.getWorkspaceViewRect(e);return i<s.top?t=s.top-this.anchor.y:n>s.bottom&&(t=s.bottom-this.anchor.y-this.size.height),t}getWorkspaceViewRect(e){const t=e.top;let i=e.top+e.height,n=e.left,o=e.left+e.width;return i-=this.getScrollbarThickness(),this.workspace.RTL?n-=this.getScrollbarThickness():o-=this.getScrollbarThickness(),new s.utils.Rect(t,i,n,o)}getScrollbarThickness(){return s.Scrollbar.scrollbarThickness/this.workspace.scale}renderTail(){const e=this.size.width/2,t=this.size.height/2;let i=-this.relativeLeft,n=-this.relativeTop;const s=Math.atan2(t-n,e-i);i+=r.ANCHOR_RADIUS*Math.cos(s),n+=r.ANCHOR_RADIUS*Math.sin(s),this.tail.setAttribute("x1",e+""),this.tail.setAttribute("y1",t+""),this.tail.setAttribute("x2",i+""),this.tail.setAttribute("y2",n+"")}bringToFront(){var e;const t=null===(e=this.svgRoot)||void 0===e?void 0:e.parentNode;return!(!this.svgRoot||(null==t?void 0:t.lastChild)===this.svgRoot||(null==t||t.appendChild(this.svgRoot),0))}getRelativeToSurfaceXY(){return new s.utils.Coordinate(this.workspace.RTL?-this.relativeLeft+this.anchor.x-this.size.width:this.anchor.x+this.relativeLeft,this.anchor.y+this.relativeTop)}getSvgRoot(){return this.svgRoot}moveDuringDrag(e){this.moveTo(e.x,e.y),this.workspace.RTL?this.relativeLeft=this.anchor.x-e.x-this.size.width:this.relativeLeft=e.x-this.anchor.x,this.relativeTop=e.y-this.anchor.y,this.renderTail()}setDragging(e){}setDeleteStyle(e){this.isDragDelete=e,e?o.addClass(this.getSvgRoot(),"blocklyDraggingDelete"):o.removeClass(this.getSvgRoot(),"blocklyDraggingDelete")}isDeletable(){return!1}showContextMenu(e){}isMovable(){return!0}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){}unselect(){}contentTop(){const e=this.topBar.getBBox();return r.BORDER_WIDTH+e.height}setDeleteHandler(e){this.deleteHandler=e}setCollapseHandler(e){this.collapseHandler=e}onDeleteDown(e){s.browserEvents.isRightButton(e)||this.deleteHandler&&this.deleteHandler(),e.stopPropagation()}onCollapseDown(e){s.browserEvents.isRightButton(e)||this.collapseHandler&&this.collapseHandler(),e.stopPropagation()}updateDeleteIconPosition(e,t,i){const n=this.calcDeleteMargin(t,i);this.deleteIcon.setAttribute("y",`${n}`),this.deleteIcon.setAttribute("x",""+(e.width-i.width-n))}updateFoldoutIconPosition(e,t){const i=this.calcFoldoutMargin(e,t);this.collapseIcon.setAttribute("y",`${i}`),this.collapseIcon.setAttribute("x",`${i}`)}calcDeleteMargin(e,t){return(e.height-t.height)/2+r.BORDER_WIDTH}calcFoldoutMargin(e,t){return(e.height-t.height)/2+r.BORDER_WIDTH}}i.Bubble=r,n=r,r.BORDER_WIDTH=0,r.DOUBLE_BORDER=2*n.BORDER_WIDTH,r.MIN_SIZE=n.DOUBLE_BORDER,r.ANCHOR_RADIUS=8,s.Css.register("\n.blocklyBubble .blocklyDeleteIcon, .blocklyBubble .blocklyFoldoutIcon {\n    filter: grayscale(100%) brightness(100000);\n}\n\n.blocklyBubble .blocklyTextarea.blocklyText {\n    color: #575E75;\n}\n")},{blockly:207}],79:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),s(e("./blockComment"),i)},{"./blockComment":77}],80:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TextInputBubble=void 0;const n=e("./bubble.js"),s=e("blockly");var o=s.utils.dom,r=s.browserEvents;class a extends n.Bubble{constructor(e,t,i,r){super(e,t,i),this.workspace=e,this.anchor=t,this.ownerRect=i,this.readOnly=r,this.resizePointerUpListener=null,this.resizePointerMoveListener=null,this.textChangeListeners=[],this.sizeChangeListeners=[],this.positionChangeListeners=[],this.text="",this.DEFAULT_SIZE=new s.utils.Size(160+n.Bubble.DOUBLE_BORDER,80+n.Bubble.DOUBLE_BORDER),this.MIN_SIZE=new s.utils.Size(45+n.Bubble.DOUBLE_BORDER,20+n.Bubble.DOUBLE_BORDER),o.addClass(this.svgRoot,"blocklyTextInputBubble"),({inputRoot:this.inputRoot,textArea:this.textArea}=this.createEditor(this.contentContainer)),this.resizeGroup=this.createResizeHandle(this.svgRoot,e),this.setSize(this.DEFAULT_SIZE,!0),r&&(this.deleteIcon.style.display="none")}getText(){return this.text}moveTo(e,t){super.moveTo(e,t),this.onPositionChange()}setText(e){this.text=e,this.textArea.value=e,this.onTextChange()}addTextChangeListener(e){this.textChangeListeners.push(e)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}addPositionChangeListener(e){this.positionChangeListeners.push(e)}createEditor(e){const t=o.createSvgElement(s.utils.Svg.FOREIGNOBJECT,{x:n.Bubble.BORDER_WIDTH,y:this.contentTop()},e);setTimeout((()=>{t.setAttribute("y",this.contentTop()+"")}));const i=document.createElementNS(o.HTML_NS,"body");i.setAttribute("xmlns",o.HTML_NS),i.className="blocklyMinimalBody";const r=document.createElementNS(o.HTML_NS,"textarea");return r.className="blocklyTextarea blocklyText",r.setAttribute("dir",this.workspace.RTL?"RTL":"LTR"),this.readOnly&&r.setAttribute("disabled","true"),i.appendChild(r),t.appendChild(i),this.bindTextAreaEvents(r),setTimeout((()=>{r.focus()}),0),{inputRoot:t,textArea:r}}bindTextAreaEvents(e){r.conditionalBind(e,"wheel",this,(e=>{e.stopPropagation()})),r.conditionalBind(e,"focus",this,this.onStartEdit,!0),r.conditionalBind(e,"change",this,this.onTextChange)}createResizeHandle(e,t){const i=o.createSvgElement(s.utils.Svg.IMAGE,{class:"blocklyResizeHandle",href:`${t.options.pathToMedia}resize-handle.svg`},e);return r.conditionalBind(i,"pointerdown",this,this.onResizePointerDown),i}setSize(e,t=!1){e.width=Math.max(e.width,this.MIN_SIZE.width),e.height=Math.max(e.height,this.MIN_SIZE.height+this.contentTop());const i=e.width-n.Bubble.DOUBLE_BORDER,s=e.height-this.contentTop()-n.Bubble.BORDER_WIDTH;this.inputRoot.setAttribute("width",`${i}`),this.inputRoot.setAttribute("height",`${s}`),this.textArea.style.width="100%",this.textArea.style.height="100%";const o=this.resizeGroup.getBBox();this.workspace.RTL?this.resizeGroup.setAttribute("transform",`translate(${n.Bubble.BORDER_WIDTH}, ${e.height-n.Bubble.BORDER_WIDTH-o.height}) scale(-1 1)`):this.resizeGroup.setAttribute("transform",`translate(${i-o.width}, ${e.height-n.Bubble.BORDER_WIDTH-o.height})`),super.setSize(e,t),this.onSizeChange()}getSize(){return super.getSize()}isDeletable(){return!this.readOnly}onResizePointerDown(e){this.bringToFront(),r.isRightButton(e)||(this.workspace.startDrag(e,new s.utils.Coordinate(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=r.conditionalBind(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=r.conditionalBind(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation()}onResizePointerUp(e){s.Touch.clearTouchIdentifier(),this.resizePointerUpListener&&(r.unbind(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(r.unbind(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(e){const t=this.workspace.moveDrag(e);this.setSize(new s.utils.Size(this.workspace.RTL?-t.x:t.x,t.y),!1),this.onSizeChange()}onStartEdit(){this.bringToFront()&&this.textArea.focus()}onTextChange(){this.text=this.textArea.value;for(const e of this.textChangeListeners)e()}onSizeChange(){for(const e of this.sizeChangeListeners)e()}onPositionChange(){for(const e of this.positionChangeListeners)e()}}i.TextInputBubble=a,s.Css.register("\n.blocklyTextInputBubble .blocklyTextarea {\n  background-color: var(--commentFillColour);\n  border: 0;\n  display: block;\n  margin: 0;\n  outline: 0;\n  padding: 3px;\n  resize: none;\n  text-overflow: hidden;\n}\n")},{"./bubble.js":78,blockly:207}],81:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DuplicateOnDragConnectionChecker=void 0;const n=e("blockly"),s=e("./duplicateOnDrag"),o=[];o[n.ConnectionType.INPUT_VALUE]=n.ConnectionType.OUTPUT_VALUE,o[n.ConnectionType.OUTPUT_VALUE]=n.ConnectionType.INPUT_VALUE,o[n.ConnectionType.NEXT_STATEMENT]=n.ConnectionType.PREVIOUS_STATEMENT,o[n.ConnectionType.PREVIOUS_STATEMENT]=n.ConnectionType.NEXT_STATEMENT;class r extends n.ConnectionChecker{doDragChecks(e,t,i){if(!super.doDragChecks(e,t,i))return!1;const n=t.targetBlock();return!n||!(0,s.isDuplicateOnDragBlock)(n)}doSafetyChecks(e,t){if(!e||!t)return n.Connection.REASON_TARGET_NULL;let i,s,r,a;return e.isSuperior()?(i=e.getSourceBlock(),s=t.getSourceBlock(),r=e,a=t):(s=e.getSourceBlock(),i=t.getSourceBlock(),a=e,r=t),i===s?n.Connection.REASON_SELF_CONNECTION:a.type!==o[r.type]?n.Connection.REASON_WRONG_TYPE:i.workspace!==s.workspace?n.Connection.REASON_DIFFERENT_WORKSPACES:a.type===n.ConnectionType.OUTPUT_VALUE&&s.previousConnection&&s.previousConnection.isConnected()||a.type===n.ConnectionType.PREVIOUS_STATEMENT&&s.outputConnection&&s.outputConnection.isConnected()?n.Connection.REASON_PREVIOUS_AND_OUTPUT:n.Connection.CAN_CONNECT}}i.DuplicateOnDragConnectionChecker=r},{"./duplicateOnDrag":83,blockly:207}],82:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setDuplicateOnDragStrategy=i.DuplicateOnDragStrategy=void 0;const n=e("blockly"),s=e("./duplicateOnDrag");var o=n.Events,r=n.utils.Coordinate,a=n.utils.dom;class l{constructor(e){this.block=e,this.startParentConn=null,this.startChildConn=null,this.startLoc=null,this.connectionCandidate=null,this.connectionPreviewer=null,this.dragging=!1,this.dragOffset=new r(0,0),this.workspace=e.workspace}isMovable(){var e,t;return this.block.isShadow()?null!==(t=null===(e=this.block.getParent())||void 0===e?void 0:e.isMovable())&&void 0!==t&&t:this.block.isOwnMovable()&&!this.block.isDeadOrDying()&&!this.workspace.options.readOnly&&!this.block.isInFlyout}startDrag(e){var t;if(this.block.isShadow()&&!(0,s.isAllowlistedShadow)(this.block))return void this.startDraggingShadow(e);this.dragging=!0,o.getGroup()||o.setGroup(!0),this.fireDragStartEvent(),this.startLoc=this.block.getRelativeToSurfaceXY();const i=n.registry.getClassFromOptions(n.registry.Type.CONNECTION_PREVIEWER,this.workspace.options);this.connectionPreviewer=new i(this.block),a.startTextWidthCache(),this.workspace.setResizesEnabled(!1),n.blockAnimations.disconnectUiStop();const r=!!e&&(e.altKey||e.ctrlKey||e.metaKey);this.shouldDisconnect(r)&&this.disconnectBlock(r),this.block.setDragging(!0),null===(t=this.workspace.getLayerManager())||void 0===t||t.moveToDragLayer(this.block)}startDraggingShadow(e){const t=this.block.getParent();if(!t)throw new Error("Tried to drag a shadow block with no parent. Shadow blocks should always have parents.");this.dragOffset=r.difference(t.getRelativeToSurfaceXY(),this.block.getRelativeToSurfaceXY()),t.startDrag(e)}shouldDisconnect(e){return!!(this.block.getParent()||e&&this.block.nextConnection&&this.block.nextConnection.targetBlock())}disconnectBlock(e){var t,i,o,r,a,l,c,u,h;let d,p,g;const m=this.block.isShadow();m&&this.block.setShadow(!1);const f=null===(i=(t=this.block).mutationToDom)||void 0===i?void 0:i.call(t);if("true"===(null===(o=null==f?void 0:f.getAttribute(s.DUPLICATE_ON_DRAG_MUTATION_KEY))||void 0===o?void 0:o.toLowerCase())||(0,s.isAllowlistedShadow)(this.block)&&m){const e=this.block.outputConnection;if(!(null==e?void 0:e.targetConnection))return;g=n.Xml.blockToDom(this.block,!0),m||(d=n.Xml.domToBlock(g,this.block.workspace)),p=e.targetConnection}this.startParentConn=null!==(a=null===(r=this.block.outputConnection)||void 0===r?void 0:r.targetConnection)&&void 0!==a?a:null===(l=this.block.previousConnection)||void 0===l?void 0:l.targetConnection,e&&(this.startChildConn=null===(c=this.block.nextConnection)||void 0===c?void 0:c.targetConnection),p&&m&&p.setShadowDom(g),this.block.unplug(e),n.blockAnimations.disconnectUiEffect(this.block),p&&d&&(p.connect(d.outputConnection),f.setAttribute(s.DUPLICATE_ON_DRAG_MUTATION_KEY,"false"),null===(h=(u=this.block).domToMutation)||void 0===h||h.call(u,f))}fireDragStartEvent(){const e=new(o.get(o.BLOCK_DRAG))(this.block,!0,this.block.getDescendants(!1));o.fire(e)}fireDragEndEvent(){const e=new(o.get(o.BLOCK_DRAG))(this.block,!1,this.block.getDescendants(!1));o.fire(e)}fireMoveEvent(){if(this.block.isDeadOrDying())return;const e=new(o.get(o.BLOCK_MOVE))(this.block);e.setReason(["drag"]),e.oldCoordinate=this.startLoc,e.recordNew(),o.fire(e)}drag(e){var t;this.block.isShadow()?null===(t=this.block.getParent())||void 0===t||t.drag(r.sum(e,this.dragOffset)):(this.block.moveDuringDrag(e),this.updateConnectionPreview(this.block,r.difference(e,this.startLoc)))}updateConnectionPreview(e,t){const i=this.connectionCandidate,s=this.getConnectionCandidate(e,t);if(!s)return this.connectionPreviewer.hidePreview(),void(this.connectionCandidate=null);const o=i&&this.currCandidateIsBetter(i,t,s)?i:s;this.connectionCandidate=o;const{local:r,neighbour:a}=o,l=r.type===n.ConnectionType.OUTPUT_VALUE||r.type===n.ConnectionType.PREVIOUS_STATEMENT,c=a.isConnected()&&!a.targetBlock().isInsertionMarker();l&&c&&!this.orphanCanConnectAtEnd(e,a.targetBlock(),r.type)?this.connectionPreviewer.previewReplacement(r,a,a.targetBlock()):this.connectionPreviewer.previewConnection(r,a)}orphanCanConnectAtEnd(e,t,i){const s=i===n.ConnectionType.OUTPUT_VALUE?t.outputConnection:t.previousConnection;return!!n.Connection.getConnectionForOrphanedConnection(e,s)}currCandidateIsBetter(e,t,i){const{local:s,neighbour:o}=e,a=new r(s.x,s.y),l=new r(o.x,o.y),c=r.distance(r.sum(a,t),l);return i.distance>c-n.config.currentConnectionPreference}getConnectionCandidate(e,t){const i=this.getLocalConnections(e);let s=this.connectionCandidate?n.config.connectingSnapRadius:n.config.snapRadius,o=null;for(const e of i){const{connection:i,radius:n}=e.closest(s,t);i&&(o={local:e,neighbour:i,distance:n},s=n)}return o}getLocalConnections(e){const t=e.getConnections_(!1),i=e.lastConnectionInStack(!0);return i&&i!==e.nextConnection&&t.push(i),t}endDrag(e){var t,i;this.block.isShadow()?null===(t=this.block.getParent())||void 0===t||t.endDrag(e):(this.fireDragEndEvent(),this.fireMoveEvent(),a.stopTextWidthCache(),n.blockAnimations.disconnectUiStop(),this.connectionPreviewer.hidePreview(),!this.block.isDeadOrDying()&&this.dragging&&(null===(i=this.workspace.getLayerManager())||void 0===i||i.moveOffDragLayer(this.block,50),this.block.setDragging(!1)),this.connectionCandidate?this.applyConnections(this.connectionCandidate):this.block.queueRender(),this.block.snapToGrid(),this.connectionPreviewer.dispose(),this.workspace.setResizesEnabled(!0),o.setGroup(!1))}applyConnections(e){const{local:t,neighbour:i}=e;t.connect(i);const s=t.isSuperior()?i:t,o=this.block.getRootBlock();n.renderManagement.finishQueuedRenders().then((()=>{n.blockAnimations.connectionUiEffect(s.getSourceBlock()),setTimeout((()=>{o.bringToFront()}),0)}))}revertDrag(){var e,t,i;if(this.block.isShadow())null===(e=this.block.getParent())||void 0===e||e.revertDrag();else{if(null===(t=this.startChildConn)||void 0===t||t.connect(this.block.nextConnection),this.startParentConn)switch(this.startParentConn.type){case n.ConnectionType.INPUT_VALUE:this.startParentConn.connect(this.block.outputConnection);break;case n.ConnectionType.NEXT_STATEMENT:this.startParentConn.connect(this.block.previousConnection)}else this.block.moveTo(this.startLoc,["drag"]),null===(i=this.workspace.getLayerManager())||void 0===i||i.moveOffDragLayer(this.block,50),n.bumpObjects.bumpIntoBounds(this.workspace,this.workspace.getMetricsManager().getScrollMetrics(!0),this.block);this.startChildConn=null,this.startParentConn=null,this.connectionPreviewer.hidePreview(),this.connectionCandidate=null,this.block.setDragging(!1),this.dragging=!1}}}i.DuplicateOnDragStrategy=l,i.setDuplicateOnDragStrategy=function(e){var t,i;null===(i=(t=e).setDragStrategy)||void 0===i||i.call(t,new l(e))}},{"./duplicateOnDrag":83,blockly:207}],83:[function(e,t,i){"use strict";let n;Object.defineProperty(i,"__esModule",{value:!0}),i.isAllowlistedShadow=i.setDraggableShadowBlocks=i.isDuplicateOnDragBlock=i.DUPLICATE_ON_DRAG_MUTATION_KEY=void 0,i.DUPLICATE_ON_DRAG_MUTATION_KEY="duplicateondrag",i.isDuplicateOnDragBlock=function(e){var t,n,s;return"true"===(null===(s=null===(n=null===(t=e.mutationToDom)||void 0===t?void 0:t.call(e))||void 0===n?void 0:n.getAttribute(i.DUPLICATE_ON_DRAG_MUTATION_KEY))||void 0===s?void 0:s.toLowerCase())},i.setDraggableShadowBlocks=function(e){n=e},i.isAllowlistedShadow=function(e){return!(!n||-1===n.indexOf(e.type))}},{}],84:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),s(e("./duplicateOnDrag"),i),s(e("./variablesGetReporter"),i),s(e("./connectionChecker"),i),s(e("./dragStrategy"),i)},{"./connectionChecker":81,"./dragStrategy":82,"./duplicateOnDrag":83,"./variablesGetReporter":85}],85:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly"),s=e("./duplicateOnDrag"),o={duplicateOnDrag_:!1,mutationToDom(){const e=n.utils.xml.createElement("mutation");return this.duplicateOnDrag_&&e.setAttribute(s.DUPLICATE_ON_DRAG_MUTATION_KEY,"true"),e},domToMutation(e){e.hasAttribute(s.DUPLICATE_ON_DRAG_MUTATION_KEY)&&(this.duplicateOnDrag_="true"===e.getAttribute(s.DUPLICATE_ON_DRAG_MUTATION_KEY).toLowerCase(),this.pathObject&&this.pathObject.setHasDottedOutlineOnHover(this.duplicateOnDrag_))}};n.Extensions.registerMutator("variables_get_reporter_mutator",o),n.defineBlocksWithJsonArray([{type:"variables_get_reporter",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,colour:"%{BKY_VARIABLES_HUE}",outputShape:(new n.zelos.ConstantProvider).SHAPES.ROUND,helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableReporter"],mutator:"variables_get_reporter_mutator"}])},{"./duplicateOnDrag":83,blockly:207}],86:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),s(e("./verticalFlyout"),i)},{"./verticalFlyout":87}],87:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.VerticalFlyout=void 0;const n=e("blockly");i.VerticalFlyout=class{constructor(e){this.options=e,this.horizontalLayout=!1,this.autoClose=!0,this.cached=[],this.dummyWorkspace=new n.WorkspaceSvg(e)}createDom(e){return this.element||(this.dummyWorkspace.createDom(),this.element=n.utils.dom.createSvgElement(e,{class:"blocklyFlyout"}),this.element.id="multiFlyout",this.element.style.display="none"),this.element}init(e){this.targetWorkspace=e}dispose(){for(const e of this.cached)e.dispose()}getWidth(){return this.activeFlyout?this.activeFlyout.getWidth():0}getHeight(){return this.activeFlyout?this.activeFlyout.getHeight():0}getWorkspace(){return this.activeFlyout?this.activeFlyout.getWorkspace():this.dummyWorkspace}isVisible(){return this.visible}setVisible(e){if(e!==this.visible){this.visible=e,this.element.style.display=e?"block":"none";for(const e of this.cached)e!==this.activeFlyout&&e.isVisible()&&e.setVisible(!1);this.activeFlyout&&this.activeFlyout.setVisible(e)}}setContainerVisible(e){if(this.containerVisible!==e){this.containerVisible=e;for(const t of this.cached)t.setContainerVisible(e)}}hide(){this.activeFlyout&&this.activeFlyout.hide(),this.setVisible(!1)}show(e,t){const i=t||this.hashBlocks(e);this.activeFlyout&&this.activeFlyout.hide();const n=this.cached.find((e=>e.key===i));if(this.element.style.display="block",this.visible=!0,n)return this.activeFlyout=n,this.activeFlyout.autoClose=this.autoClose,this.activeFlyout.setContainerVisible(this.containerVisible),void this.activeFlyout.show(e);this.activeFlyout=new s(this.options),this.cached.push(this.activeFlyout),this.element.appendChild(this.activeFlyout.createDom("g")),this.activeFlyout.init(this.targetWorkspace),this.activeFlyout.key=i,this.activeFlyout.autoClose=this.autoClose,this.activeFlyout.setContainerVisible(this.containerVisible),this.activeFlyout.show(e)}createBlock(e){if(this.activeFlyout)return this.activeFlyout.createBlock(e)}reflow(){this.activeFlyout&&this.activeFlyout.reflow()}isScrollable(){return!this.activeFlyout||this.activeFlyout.isScrollable()}getX(){return this.activeFlyout?this.activeFlyout.getX():0}getY(){return this.activeFlyout?this.activeFlyout.getY():0}position(){this.activeFlyout&&this.activeFlyout.position()}isDragTowardWorkspace(e){return!!this.activeFlyout&&this.activeFlyout.isDragTowardWorkspace(e)}isBlockCreatable(e){return!!this.activeFlyout&&this.activeFlyout.isBlockCreatable(e)}scrollToStart(){this.activeFlyout&&this.activeFlyout.scrollToStart()}getContents(){var e;return(null===(e=this.activeFlyout)||void 0===e?void 0:e.getContents())||[]}blocksToString(e){let t=null;return e.map((e=>e?e.outerHTML?e.outerHTML:(t||(t=new XMLSerializer),t.serializeToString(e)):"\x3c!-- invalid block here! --\x3e")).reduce(((e,t)=>e+t),"")}hashBlocks(e){if(Array.isArray(e))return pxt.Util.codalHash16(this.blocksToString(e))}};class s extends n.VerticalFlyout{constructor(e){super(e),this.options=e,this.buttonListeners=[]}show(e){Array.isArray(e)&&(this.def=e.slice()),super.show(e)}blockIsRecyclable_(e){switch(e.type){case"variables_get":case"variables_set":case"variables_change":return!1}return!0}initFlyoutButton_(e,t,i){const s=n.FlyoutButton.TEXT_MARGIN_X,o=n.FlyoutButton.TEXT_MARGIN_Y;e.isLabel()||(n.FlyoutButton.TEXT_MARGIN_X=17.5,n.FlyoutButton.TEXT_MARGIN_Y=14);const r=e.createDom();if(e.moveTo(t,i),e.show(),this.buttonListeners.push(n.browserEvents.conditionalBind(r,"pointerdown",this,this.onButtonMouseDown)),this.buttons_.push(e),n.FlyoutButton.TEXT_MARGIN_X=s,n.FlyoutButton.TEXT_MARGIN_Y=o,!this.def)return;const a=this.def.find((t=>t.getAttribute("text")===e.getButtonText()));if(this.def.splice(this.def.indexOf(a),1),!a)return;a.hasAttribute("web-class")&&r.classList.add(a.getAttribute("web-class"));const l=a.getAttribute("web-icon"),c=a.getAttribute("web-icon-class"),u=a.getAttribute("web-icon-color");if(l||c){const t=n.utils.dom.createSvgElement("text",{class:c?"blocklyFlyoutLabelIcon "+c:"blocklyFlyoutLabelIcon",x:0,y:0,"text-anchor":"start"},r);l&&(t.textContent=l),u&&t.setAttribute("style","fill: "+u);const i=e.getTargetWorkspace();t.setAttribute("dominant-baseline","central"),t.setAttribute("dy","0"),t.setAttribute("x",(i.RTL?e.width+n.FlyoutButton.TEXT_MARGIN_X:0)+""),t.setAttribute("y",e.height/2+n.FlyoutButton.TEXT_MARGIN_Y+"");const s=n.utils.dom.getTextWidth(t)+2*n.FlyoutButton.TEXT_MARGIN_X;e.width+=s;for(let e=0;e<r.children.length;e++){const i=r.children.item(e);if(i!==t){const e=Number(i.getAttribute("x"));i.setAttribute("x",e+s+"")}}}const h=a.getAttribute("web-line"),d=a.getAttribute("web-line-width");if(h){const t=n.utils.dom.createSvgElement("line",{class:"blocklyFlyoutLine","stroke-dasharray":h,"text-anchor":"middle"},r);t.setAttribute("x1","0"),t.setAttribute("x2",null!=d?d:e.width+""),t.setAttribute("y1",e.height+10+""),t.setAttribute("y2",e.height+10+"")}}onButtonMouseDown(e){const t=this.targetWorkspace.getGesture(e);t&&t.handleFlyoutStart(e,this)}}},{blockly:207}],88:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly"),s=e("../constants"),o={typeName_:"",getTypeName(){return this.typeName_},removeFieldCallback(e){const t=this.getParent();(null==t?void 0:t.removeFieldCallback)&&t.removeFieldCallback(e)}};n.Blocks[s.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"bool"}],extensions:["output_boolean","text_field_color"]}),this.typeName_="boolean"}}),n.Blocks[s.ARGUMENT_EDITOR_STRING_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"text"}],extensions:["output_string","text_field_color"]}),this.typeName_="string"}}),n.Blocks[s.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"num"}],extensions:["output_number","text_field_color"]}),this.typeName_="number"}}),n.Blocks[s.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"list"}],extensions:["output_array","text_field_color"]}),this.typeName_="Array"}}),n.Blocks[s.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"arg"}],outputShape:(new n.zelos.ConstantProvider).SHAPES.ROUND,extensions:["text_field_color"]}),this.typeName_="any"},mutationToDom(){const e=n.utils.xml.createElement("mutation");return e.setAttribute("typename",this.typeName_),e},domToMutation(e){this.typeName_=e.getAttribute("typename"),this.setOutput(!0,this.typeName_)}})},{"../constants":94,blockly:207}],89:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly"),s=e("../constants"),o=e("../msg"),r=e("../../duplicateOnDrag"),a={typeName_:"",duplicateOnDrag_:!1,getTypeName(){return this.typeName_},mutationToDom(){const e=n.utils.xml.createElement("mutation");return this.duplicateOnDrag_&&e.setAttribute(r.DUPLICATE_ON_DRAG_MUTATION_KEY,"true"),e},domToMutation(e){e.hasAttribute(r.DUPLICATE_ON_DRAG_MUTATION_KEY)&&(this.duplicateOnDrag_="true"===e.getAttribute(r.DUPLICATE_ON_DRAG_MUTATION_KEY).toLowerCase(),this.pathObject&&this.pathObject.setHasDottedOutlineOnHover(this.duplicateOnDrag_))}};n.Blocks[s.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:n.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_boolean"]}),this.typeName_="boolean",(0,r.setDuplicateOnDragStrategy)(this)}}),n.Blocks[s.ARGUMENT_REPORTER_STRING_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:n.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_string"]}),this.typeName_="string",(0,r.setDuplicateOnDragStrategy)(this)}}),n.Blocks[s.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:n.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_number"]}),this.typeName_="number",(0,r.setDuplicateOnDragStrategy)(this)}}),n.Blocks[s.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:n.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_array"]}),this.typeName_="Array",(0,r.setDuplicateOnDragStrategy)(this)}}),n.Blocks[s.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:n.Msg[o.MsgKey.REPORTERS_HUE],inputsInline:!0,outputShape:(new n.zelos.ConstantProvider).SHAPES.ROUND,output:null}),this.typeName_="",(0,r.setDuplicateOnDragStrategy)(this)},mutationToDom(){const e=a.mutationToDom.call(this);return e.setAttribute("typename",this.typeName_),e},domToMutation(e){this.typeName_=e.getAttribute("typename"),this.setOutput(!0,this.typeName_),a.domToMutation.call(this,e),this.pathObject&&this.pathObject.setHasDottedOutlineOnHover(this.duplicateOnDrag_)}})},{"../../duplicateOnDrag":84,"../constants":94,"../msg":100,blockly:207}],90:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly"),s=e("../commonFunctionMixin"),o=e("../constants"),r=e("../utils"),a=e("../msg"),l=Object.assign(Object.assign({},s.COMMON_FUNCTION_MIXIN),{populateArgument_:function(e,t,i){let s=null,o=null;if(t&&e.id in t){const i=t[e.id];s=i.block,o=i.shadow}const r=null==s?void 0:s.workspace.connectionChecker;n.Events.disable();try{if(s&&!s.isDisposed()&&t&&(null==r?void 0:r.canConnectWithReason(null==s?void 0:s.outputConnection,i.connection,!1))===n.Connection.CAN_CONNECT){let r;s.outputConnection.connect(i.connection),"variables_get"!==(r=s.isShadow()?n.Xml.blockToDom(s):o||this.buildShadowDom_(e.type)).getAttribute("type")&&i.connection.setShadowDom(r),delete t[i.name]}else this.attachShadow_(i,e.type)}finally{n.Events.enable()}},afterWorkspaceLoad:function(){var e;for(const t of this.inputList){if(t.type!==n.inputs.inputTypes.VALUE)continue;const i=null===(e=t.connection)||void 0===e?void 0:e.targetBlock();i&&i.isShadow()&&i.getVarModels().length&&i.setShadow(!1);const s=t.connection&&t.getShadowDom();(0,r.isVariableBlockType)(null==s?void 0:s.getAttribute("type"))&&t.setShadowDom(null)}},addFunctionLabel_:function(e){this.appendDummyInput("function_name").appendField(new n.FieldLabel(e,"functionNameText"),"function_name")},updateFunctionLabel_:function(e){this.getField("function_name").setValue(e)},attachShadow_(e,t){const i=(0,r.getShadowBlockInfoFromType_)(t,this.workspace),s=i[0],o=i[1],a=i[2];n.Events.disable();let l=null;try{(l=this.workspace.newBlock(s)).setFieldValue(a,o),l.setShadow("variables_get"!==s),!this.isInsertionMarker()&&l instanceof n.BlockSvg&&(l.initSvg(),l.render())}finally{n.Events.enable()}l&&(l.setShadow(!0),l.outputConnection.connect(e.connection))},buildShadowDom_(e){const t=n.utils.xml.createElement("shadow"),i=(0,r.getShadowBlockInfoFromType_)(e,this.workspace),s=i[0],o=i[1],a=i[2],l="variables_get"===s;t.setAttribute("type",s);const c=n.utils.xml.createElement("field");if(c.textContent=a,l){c.setAttribute("id",a);const e=this.workspace.getVariableById(a);c.textContent=e?e.name:""}return c.setAttribute("name",o),t.appendChild(c),t},onchange(e){var t;if(this.workspace&&!this.workspace.isFlyout)if(e.type==n.Events.BLOCK_CREATE&&-1!=(null===(t=e.ids)||void 0===t?void 0:t.indexOf(this.id))){const t=this.getName(),i=(0,r.getDefinition)(t,this.workspace);if(i){const e=i.getArguments().slice(),t=this.arguments_.slice();JSON.stringify(t)!==JSON.stringify(e)&&(0,r.mutateCallersAndDefinition)(i.getName(),this.workspace,i.mutationToDom()),this.functionId_=i.functionId_}else{n.Events.setGroup(e.group);const t=n.utils.xml.createElement("xml"),i=n.utils.xml.createElement("block");i.setAttribute("type",o.FUNCTION_DEFINITION_BLOCK_TYPE);const s=this.getRelativeToSurfaceXY(),r=s.x+n.config.snapRadius*(this.RTL?-1:1),a=s.y+2*n.config.snapRadius;i.setAttribute("x",r+""),i.setAttribute("y",a+"");const l=this.mutationToDom();i.appendChild(l),t.appendChild(i),n.Xml.domToWorkspace(t,this.workspace),n.Events.setGroup(!1)}}else if(e.type==n.Events.BLOCK_DELETE){const t=this.getName();(0,r.getDefinition)(t,this.workspace)||(n.Events.setGroup(e.group),this.dispose(!0),n.Events.setGroup(!1))}}});n.Blocks[o.FUNCTION_CALL_BLOCK_TYPE]=Object.assign(Object.assign({},l),{init:function(){this.jsonInit({extensions:["function_contextmenu_edit"]}),this.name_="",this.arguments_=[],this.functionId_="",this.setPreviousStatement(!0),this.setNextStatement(!0),this.setColour(n.Msg[a.MsgKey.PROCEDURES_HUE]),this.setHelpUrl(n.Msg[a.MsgKey.PROCEDURES_CALLNORETURN_HELPURL]),this.setTooltip(n.Msg[a.MsgKey.FUNCTION_CALL_TOOLTIP]),this.setInputsInline(!0)}}),n.Blocks[o.FUNCTION_CALL_OUTPUT_BLOCK_TYPE]=Object.assign(Object.assign({},l),{init:function(){this.jsonInit({extensions:["function_contextmenu_edit"]}),this.name_="",this.arguments_=[],this.functionId_="",this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0,null),this.setOutputShape((new n.zelos.ConstantProvider).SHAPES.ROUND),this.setColour(n.Msg[a.MsgKey.PROCEDURES_HUE]),this.setHelpUrl(n.Msg[a.MsgKey.PROCEDURES_CALLNORETURN_HELPURL]),this.setTooltip(n.Msg[a.MsgKey.FUNCTION_CALL_TOOLTIP]),this.setInputsInline(!0)}})},{"../commonFunctionMixin":93,"../constants":94,"../msg":100,"../utils":102,blockly:207}],91:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.newFunctionMutation=void 0;const n=e("blockly"),s=e("../commonFunctionMixin"),o=e("../constants"),r=e("../utils"),a=e("../fields/fieldAutocapitalizeTextInput"),l=e("../functionManager"),c=e("../msg"),u=Object.assign(Object.assign({},s.COMMON_FUNCTION_MIXIN),{populateArgument_:function(e,t,i){const n=this.createArgumentEditor_(e.type,e.name);i.connection.connect(n.outputConnection)},addFunctionLabel_:function(e){const t=new a.FieldAutocapitalizeTextInput(e||"",void 0,{spellcheck:!1,disableAutocapitalize:!0});this.appendDummyInput("function_name").appendField(t,"function_name")},updateFunctionLabel_:function(e){n.Events.disable(),this.getField("function_name").setValue(e),n.Events.enable()},createArgumentEditor_:function(e,t){let i;n.Events.disable();try{let s="";switch(e){case"boolean":s=o.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE;break;case"number":s=o.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE;break;case"string":s=o.ARGUMENT_EDITOR_STRING_BLOCK_TYPE;break;case"Array":s=o.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE;break;default:s=o.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE}(i=s==o.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE?(0,r.createCustomArgumentEditor)(e,this.workspace):this.workspace.newBlock(s)).setFieldValue(t,"TEXT"),i.setShadow(!0),!this.isInsertionMarker()&&i instanceof n.BlockSvg&&(i.initSvg(),i.render())}finally{n.Events.enable()}return i},focusLastEditor_(){if(this.inputList.length>0){let e=this.inputList[this.inputList.length-2];if(e.type==n.inputs.inputTypes.DUMMY){const t=this.workspace;t instanceof n.WorkspaceSvg&&t.centerOnBlock(this.id),e.fieldRow[0].showEditor()}else if(e.type==n.inputs.inputTypes.VALUE){const t=e.connection.targetBlock(),i=t.workspace;i instanceof n.WorkspaceSvg&&i.centerOnBlock(t.id),t.getField("TEXT").showEditor()}}},removeFieldCallback(e){let t=null;for(let i=0;i<this.inputList.length&&!t;i++){let n=this.inputList[i];if(n.connection){let i=n.connection.targetBlock();if(!i)continue;i.getField(e.name)===e&&(t=n.name)}else for(let i=0;i<n.fieldRow.length;i++)n.fieldRow[i]==e&&(t=n.name)}t&&(n.WidgetDiv.hide(),this.removeInput(t),this.updateFunctionSignature(),this.updateDisplay_())},addParam_(e,t){n.WidgetDiv.hide();const i=(0,r.findUniqueParamName)(t,this.arguments_.map((e=>e.name)));this.arguments_.push({id:n.utils.idGenerator.genUid(),name:i,type:e}),this.updateDisplay_(),this.focusLastEditor_()},addBooleanExternal(){this.addParam_("boolean",n.Msg[c.MsgKey.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME])},addStringExternal(){this.addParam_("string",n.Msg[c.MsgKey.FUNCTIONS_DEFAULT_STRING_ARG_NAME])},addNumberExternal(){this.addParam_("number",n.Msg[c.MsgKey.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME])},addArrayExternal(){this.addParam_("Array",n.Msg[c.MsgKey.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME])},addCustomExternal(e){this.addParam_(e,l.FunctionManager.getInstance().getArgumentNameForType(e))},updateFunctionSignature(){this.arguments_=[];for(let e=1;e<this.inputList.length;e++){const t=this.inputList[e];switch(t.type){case n.inputs.inputTypes.STATEMENT:break;case n.inputs.inputTypes.DUMMY:this.name_=t.fieldRow[0].getValue()||t.fieldRow[0].getText();break;case n.inputs.inputTypes.VALUE:const e=t.connection.targetBlock();this.arguments_.push({id:t.name,name:e.getFieldValue("TEXT"),type:e.getTypeName()});break;default:console.warn("Unexpected input type on a function mutator root: "+t.type)}}}});i.newFunctionMutation=function(e){const t=(0,r.findLegalName)(n.Msg[c.MsgKey.FUNCTIONS_DEFAULT_FUNCTION_NAME],e),i=n.utils.xml.createElement("mutation");return i.setAttribute("name",t),i.setAttribute("functionid",n.utils.idGenerator.genUid()),i},n.Blocks[o.FUNCTION_DECLARATION_BLOCK_TYPE]=Object.assign(Object.assign({},u),{init:function(){this.jsonInit({style:{hat:"cap"}}),this.name_="",this.arguments_=[],this.functionId_="",this.createAllInputs_(),this.setColour(n.Msg[c.MsgKey.PROCEDURES_HUE]),this.setStatements_(!0),this.setDeletable(!1),this.setMovable(!1),this.contextMenu=!1,this.setInputsInline(!0)}})},{"../commonFunctionMixin":93,"../constants":94,"../fields/fieldAutocapitalizeTextInput":97,"../functionManager":98,"../msg":100,"../utils":102,blockly:207}],92:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly"),s=e("../commonFunctionMixin"),o=e("../constants"),r=e("../utils"),a=e("../fields/fieldAutocapitalizeTextInput"),l=e("../msg"),c=e("../functionManager"),u=e("../svgs"),h=e("../../duplicateOnDrag"),d=Object.assign(Object.assign({},s.COMMON_FUNCTION_MIXIN),{populateArgument_:function(e,t,i){let n,s=null;(null==t?void 0:t[e.id])&&(s=t[e.id].block),t&&s&&!s.isDisposed()?((n=s).setFieldValue(e.name,"VALUE"),delete t[i.name]):n=this.createArgumentReporter_(e),n.duplicateOnDrag_=!0,i.connection.connect(n.outputConnection)},afterWorkspaceLoad:function(){var e;for(const t of this.inputList){if(t.type!==n.inputs.inputTypes.VALUE)continue;const i=null===(e=t.connection)||void 0===e?void 0:e.targetBlock();(null==i?void 0:i.isShadow())&&i.mutationToDom&&i.mutationToDom().getAttribute(h.DUPLICATE_ON_DRAG_MUTATION_KEY)&&i.setShadow(!1);const s=t.connection&&t.getShadowDom();(0,r.isVariableBlockType)(null==s?void 0:s.getAttribute("type"))&&t.setShadowDom(null)}},addFunctionLabel_:function(e){const t=new a.FieldAutocapitalizeTextInput(e||"",r.rename,{spellcheck:!1,disableAutocapitalize:!0});this.appendDummyInput("function_name").appendField(t,"function_name")},updateFunctionLabel_:function(e){n.Events.disable(),this.getField("function_name").setValue(e),n.Events.enable()},createArgumentReporter_:function(e){let t,i="";switch(e.type){case"boolean":i=o.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE;break;case"number":i=o.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE;break;case"string":i=o.ARGUMENT_REPORTER_STRING_BLOCK_TYPE;break;case"Array":i=o.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE;break;default:i=o.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE}n.Events.disable();try{(t=i==o.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE?(0,r.createCustomArgumentReporter)(e.type,this.workspace):this.workspace.newBlock(i)).setFieldValue(e.name,"VALUE"),t.setShadow(!0),!this.isInsertionMarker()&&t instanceof n.BlockSvg&&(t.initSvg(),t.render())}finally{n.Events.enable()}return t},customContextMenu:function(e){var t,i;this.isInFlyout||(null===(i=null===(t=this.workspace)||void 0===t?void 0:t.options)||void 0===i?void 0:i.readOnly)||(e.push(this.makeEditOption()),e.push(this.makeCallOption()))},makeEditOption:function(){var e,t;return{enabled:!(null===(t=null===(e=this.workspace)||void 0===e?void 0:e.options)||void 0===t?void 0:t.readOnly),text:n.Msg.FUNCTIONS_EDIT_OPTION,callback:()=>{!function(e){if(e.type==o.FUNCTION_CALL_BLOCK_TYPE||e.type==o.FUNCTION_CALL_OUTPUT_BLOCK_TYPE){const t=e.workspace;e=(0,r.getDefinition)(e.getName(),t)}n.hideChaff(),n.getSelected()&&n.getSelected().unselect(),c.FunctionManager.getInstance().editFunctionExternal(e.mutationToDom(),(t=>{t&&((0,r.mutateCallersAndDefinition)(e.getName(),e.workspace,t),e.updateDisplay_()),setTimeout((()=>{e.afterWorkspaceLoad&&e.afterWorkspaceLoad()}))}))}(this)}}},makeCallOption:function(){var e,t;const i=this.getName(),s=n.utils.xml.createElement("mutation");s.setAttribute("name",i);const r=n.utils.xml.createElement("block");return r.appendChild(s),r.setAttribute("type",o.FUNCTION_CALL_BLOCK_TYPE),{enabled:this.workspace.remainingCapacity()>0&&!(null===(t=null===(e=this.workspace)||void 0===e?void 0:e.options)||void 0===t?void 0:t.readOnly),text:n.Msg.FUNCTIONS_CREATE_CALL_OPTION.replace("%1",i),callback:n.ContextMenu.callbackFactory(this,r)}}});n.Blocks[o.FUNCTION_DEFINITION_BLOCK_TYPE]=Object.assign(Object.assign({},d),{init:function(){if(this.jsonInit({style:{hat:"cap"}}),this.name_="",this.arguments_=[],this.functionId_="",this.createAllInputs_(),this.setColour(n.Msg[l.MsgKey.PROCEDURES_HUE]),this.setTooltip(n.Msg[l.MsgKey.PROCEDURES_DEFNORETURN_TOOLTIP]),this.setHelpUrl(n.Msg[l.MsgKey.PROCEDURES_DEFNORETURN_HELPURL]),this.setStatements_(!0),this.setInputsInline(!0),this.workspace.options.collapse){const e=u.COLLAPSE_IMAGE_DATAURI;this.appendDummyInput("function_collapse").appendField(new n.FieldImage(e,24,24,"",(()=>{this.setCollapsed(!0)}),!1))}}})},{"../../duplicateOnDrag":84,"../commonFunctionMixin":93,"../constants":94,"../fields/fieldAutocapitalizeTextInput":97,"../functionManager":98,"../msg":100,"../svgs":101,"../utils":102,blockly:207}],93:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.COMMON_FUNCTION_MIXIN=void 0;const n=e("blockly"),s=e("./constants"),o=e("./utils"),r=e("./msg");i.COMMON_FUNCTION_MIXIN={name_:"",functionId_:"",arguments_:[],mutationToDom:function(){this.ensureIds_();const e=n.utils.xml.createElement("mutation");return e.setAttribute("name",this.name_),e.setAttribute("functionid",this.functionId_),this.arguments_.forEach((function(t){const i=n.utils.xml.createElement("arg");i.setAttribute("name",t.name),i.setAttribute("id",t.id),i.setAttribute("type",t.type),e.appendChild(i)})),e},domToMutation:function(e){const t=[];for(let i=0;i<e.childNodes.length;++i){const n=e.childNodes[i];"arg"==n.nodeName.toLowerCase()&&t.push({id:n.getAttribute("id"),name:n.getAttribute("name"),type:n.getAttribute("type")})}this.arguments_=t,this.name_=e.getAttribute("name"),this.restoreSavedFunctionId(e.getAttribute("functionid"))},saveExtraState:function(){return{name:this.name_,functionid:this.functionId_,arguments:this.arguments_.slice()}},loadExtraState:function(e){this.arguments_=e.arguments.slice(),this.name_=e.name,this.restoreSavedFunctionId(e.functionid)},restoreSavedFunctionId:function(e){(0,o.idsInUse)(this.workspace).indexOf(e)<0&&(this.functionId_=e),this.ensureIds_();let t=null;this instanceof n.BlockSvg&&(t=this.getHeightWidth()),this.type!==s.FUNCTION_DEFINITION_BLOCK_TYPE||t&&!t.height&&!t.width?this.updateDisplay_():!this.getFieldValue("function_name")&&this.name_&&(this.setFieldValue(this.name_,"function_name"),this.updateDisplay_())},getName:function(){return this.name_},getFunctionId:function(){return this.functionId_},getArguments:function(){return this.arguments_},removeValueInputs_:function(){const e=[];for(let t,i=0;t=this.inputList[i];i++)t.type==n.inputs.inputTypes.VALUE?t.dispose():e.push(t);this.inputList=e},disconnectOldBlocks_:function(){let e={};for(let t,i=0;t=this.inputList[i];i++)if("STACK"!==t.name&&t.connection){let i=t.connection.targetBlock(),n={shadow:t.connection.getShadowDom(),block:i};e[t.name]=n,t.connection.setShadowDom(null),t.connection.targetConnection&&t.connection.disconnect()}return e},deleteShadows_:function(e){if(e)for(let t in e){let i=e[t];if(i){const n=i.block;(null==n?void 0:n.isShadow())&&(n.isDeadOrDying()||n.dispose(!1),delete e[t])}}},createAllInputs_:function(e){let t=!1,i=!1,a=!1;if(this.inputList.forEach((function(e){"function_title"==e.name?t=!0:"function_name"==e.name?i=!0:"function_collapse"==e.name&&(a=!0)})),!t){let e="";switch(this.type){case s.FUNCTION_CALL_OUTPUT_BLOCK_TYPE:case s.FUNCTION_CALL_BLOCK_TYPE:e=n.Msg[r.MsgKey.FUNCTIONS_CALL_TITLE];break;case s.FUNCTION_DEFINITION_BLOCK_TYPE:case s.FUNCTION_DECLARATION_BLOCK_TYPE:e=n.Msg[r.MsgKey.FUNCTIONS_DEFNORETURN_TITLE]}this.appendDummyInput("function_title").appendField(e,"function_title")}i?this.updateFunctionLabel_(this.getName()):this.addFunctionLabel_(this.getName());let l=this;this.arguments_.forEach((function(t){let i=l.appendValueInput(t.id);(0,o.isCustomType)(t.type)?i.setCheck(t.type):i.setCheck(t.type.charAt(0).toUpperCase()+t.type.slice(1)),l.isInsertionMarker()||l.populateArgument_(t,e,i)})),a&&this.moveInputBefore("function_collapse",null),this.hasStatements_&&this.moveInputBefore("STACK",null)},updateDisplay_:function(){let e=this.rendered,t=this.disconnectOldBlocks_();this.removeValueInputs_(),this.createAllInputs_(t),this.deleteShadows_(t),e&&!this.isInsertionMarker()&&this instanceof n.BlockSvg&&(this.initSvg(),this.render())},setStatements_:function(e){this.hasStatements_!==e&&(e?this.appendStatementInput("STACK"):this.removeInput("STACK",!0),this.hasStatements_=e)},ensureIds_:function(){switch(this.type){case s.FUNCTION_DEFINITION_BLOCK_TYPE:this.functionId_&&"null"!=this.functionId_||(this.functionId_=n.utils.idGenerator.genUid());for(let e=0;e<this.arguments_.length;++e)this.arguments_[e].id||(this.arguments_[e].id=n.utils.idGenerator.genUid());break;case s.FUNCTION_CALL_OUTPUT_BLOCK_TYPE:case s.FUNCTION_CALL_BLOCK_TYPE:const e=(0,o.getDefinition)(this.name_,this.workspace);if(e){this.functionId_=e.getFunctionId();const t=e.getArguments();for(let e=0;e<this.arguments_.length;++e)for(let i=0;i<t.length;++i)if(t[i].name==this.arguments_[e].name){this.arguments_[e].id=t[i].id;break}}}}}},{"./constants":94,"./msg":100,"./utils":102,blockly:207}],94:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE=i.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE=i.ARGUMENT_EDITOR_STRING_BLOCK_TYPE=i.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE=i.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE=i.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE=i.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE=i.ARGUMENT_REPORTER_STRING_BLOCK_TYPE=i.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE=i.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE=i.FUNCTION_CALL_OUTPUT_BLOCK_TYPE=i.FUNCTION_CALL_BLOCK_TYPE=i.FUNCTION_DECLARATION_BLOCK_TYPE=i.FUNCTION_DEFINITION_BLOCK_TYPE=void 0,i.FUNCTION_DEFINITION_BLOCK_TYPE="function_definition",i.FUNCTION_DECLARATION_BLOCK_TYPE="function_declaration",i.FUNCTION_CALL_BLOCK_TYPE="function_call",i.FUNCTION_CALL_OUTPUT_BLOCK_TYPE="function_call_output",i.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE="argument_reporter_boolean",i.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE="argument_reporter_number",i.ARGUMENT_REPORTER_STRING_BLOCK_TYPE="argument_reporter_string",i.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE="argument_reporter_array",i.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE="argument_reporter_custom",i.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE="argument_editor_boolean",i.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE="argument_editor_number",i.ARGUMENT_EDITOR_STRING_BLOCK_TYPE="argument_editor_string",i.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE="argument_editor_array",i.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE="argument_editor_custom"},{}],95:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly"),s=e("./utils"),o=e("./msg"),r=e("./svgs"),a=new n.zelos.ConstantProvider;const l={customContextMenu:function(e){var t,i;const r={enabled:!(null===(i=null===(t=this.workspace)||void 0===t?void 0:t.options)||void 0===i?void 0:i.readOnly),text:n.Msg[o.MsgKey.FUNCTIONS_GO_TO_DEFINITION_OPTION],callback:()=>{const e=this.getField("function_name").getText(),t=(0,s.getDefinition)(e,this.workspace);t&&this.workspace instanceof n.WorkspaceSvg&&this.workspace.centerOnBlock(t.id)}};e.push(r)}},c={customContextMenu:function(e){if(this.isCollapsed())return;const t={text:n.Msg.RENAME_VARIABLE,enabled:!this.workspace.options.readOnly,callback:()=>{const e=this.workspace,t=this.getField("VAR").getVariable();n.Variables.renameVariable(e,t)}};if(e.unshift(t),!this.isInFlyout){const t=this.workspace.getVariablesOfType("");for(const i of t){const t={enabled:!this.workspace.options.readOnly,text:i.name,callback:()=>{let e=this.getField("VAR");e||console.log("Tried to get a variable field on the wrong type of block."),e.setValue(i.getId())}};e.unshift(t)}}}};n.Extensions.registerMixin("function_contextmenu_edit",l),n.Extensions.registerMixin("contextMenu_variableReporter",c),n.Extensions.register("output_number",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.ROUND),this.setOutput(!0,"Number")})),n.Extensions.register("output_string",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.ROUND),this.setOutput(!0,"String")})),n.Extensions.register("output_boolean",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.HEXAGONAL),this.setOutput(!0,"Boolean")})),n.Extensions.register("output_array",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.ROUND),this.setOutput(!0,"Array")})),n.Extensions.register("text_field_color",(function(){if(this.workspace instanceof n.WorkspaceSvg){const e=this.workspace.getRenderer().getConstants();this.setColour(e.FIELD_BORDER_RECT_COLOUR)}else this.setColour("#fff")})),n.Extensions.register("inline-svgs",(function(){this.ADD_IMAGE_DATAURI=r.ADD_IMAGE_DATAURI,this.REMOVE_IMAGE_DATAURI=r.REMOVE_IMAGE_DATAURI}))},{"./msg":100,"./svgs":101,"./utils":102,blockly:207}],96:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldArgumentEditor=void 0;const n=e("blockly"),s=e("../functionManager");class o extends n.FieldTextInput{constructor(e,t,i){super(e,t,i),this.typeName=i.typeName}showEditor(e){var t;super.showEditor(e);const i=n.WidgetDiv.getDiv();i.className+=" argumentEditorInput";const r=document.createElement("img");if(r.setAttribute("class","argumentEditorRemoveIcon"),r.setAttribute("src",o.REMOVE_ARG_URI),this.removeButtonMouseWrapper_=n.browserEvents.conditionalBind(r,"mousedown",this,this.removeCallback),i.appendChild(r),this.typeName&&(null===(t=this.sourceBlock_)||void 0===t?void 0:t.workspace)){const e=s.FunctionManager.getInstance().getIconForType(this.typeName);if(e){const t=e+" icon argumentEditorTypeIcon",n=document.createElement("i");n.className=t,i.appendChild(n)}}}removeCallback(){var e,t;const i=null===(e=this.sourceBlock_)||void 0===e?void 0:e.getParent();if(!i)return;let s;for(const e of i.inputList)if((null===(t=e.connection)||void 0===t?void 0:t.targetBlock())===this.sourceBlock_){s=e.name;break}s&&(n.WidgetDiv.hide(),i.removeInput(s))}}i.FieldArgumentEditor=o,o.REMOVE_ARG_URI="data:image/svg+xml;charset=UTF-8,%3c?xml version='1.0' encoding='UTF-8' standalone='no'?%3e%3csvg width='20px' height='20px' viewBox='0 0 20 20' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3c!-- Generator: Sketch 48.1 (47250) - http://www.bohemiancoding.com/sketch --%3e%3ctitle%3edelete-argument v2%3c/title%3e%3cdesc%3eCreated with Sketch.%3c/desc%3e%3cdefs%3e%3c/defs%3e%3cg id='Page-1' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3e%3cg id='delete-argument-v2' stroke='%23FF661A'%3e%3cg id='Group' transform='translate(3.000000, 2.500000)'%3e%3cpath d='M1,3 L13,3 L11.8900496,14.0995037 C11.8389294,14.6107055 11.4087639,15 10.8950124,15 L3.10498756,15 C2.59123611,15 2.16107055,14.6107055 2.10995037,14.0995037 L1,3 Z' id='Rectangle' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M7,11 L7,6' id='Line' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M9.5,11 L9.5,6' id='Line-Copy' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M4.5,11 L4.5,6' id='Line-Copy-2' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3crect id='Rectangle-2' fill='%23FF661A' x='0' y='2.5' width='14' height='1' rx='0.5'%3e%3c/rect%3e%3cpath d='M6,0 L8,0 C8.55228475,-1.01453063e-16 9,0.44771525 9,1 L9,3 L5,3 L5,1 C5,0.44771525 5.44771525,1.01453063e-16 6,0 Z' id='Rectangle-3' stroke-width='1.5'%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",n.fieldRegistry.register("field_argument_editor",o),n.Css.register("\n\n.argumentEditorInput {\n    overflow: visible;\n}\n\n.functioneditor i.argumentEditorTypeIcon {\n    position: absolute;\n    width: 24px;\n    height: 24px;\n    top: 40px;\n    left: 50%;\n    margin-left: -12px;\n}\n\n.argumentEditorRemoveIcon {\n    position: absolute;\n    width: 24px;\n    height: 24px;\n    top: -40px;\n    left: 50%;\n    margin-left: -12px;\n    cursor: pointer;\n}\n\n")},{"../functionManager":98,blockly:207}],97:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldAutocapitalizeTextInput=void 0;const n=e("blockly");class s extends n.FieldTextInput{constructor(e,t,i){super(e,t,i),this.disableAutocapitalize=!1}setAutocapitalize(e){this.disableAutocapitalize=!e,this.htmlInput_&&(this.disableAutocapitalize?this.htmlInput_.setAttribute("autocapitalize","none"):this.htmlInput_.removeAttribute("autocapitalize"))}configure_(e){super.configure_(e),void 0!==e.disableAutocapitalize&&(this.disableAutocapitalize=e.disableAutocapitalize)}widgetCreate_(){const e=super.widgetCreate_();return this.disableAutocapitalize&&e.setAttribute("autocapitalize","none"),e}}i.FieldAutocapitalizeTextInput=s,n.fieldRegistry.register("field_autocapitalize_text_input",s)},{blockly:207}],98:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FunctionManager=void 0;const n=e("blockly"),s=e("./msg");class o{constructor(){this.typeIcons={},this.typeArgumentNames={}}static getInstance(){return o.instance}getIconForType(e){return this.typeIcons[e]}setIconForType(e,t){this.typeIcons[t]=e}setArgumentNameForType(e,t){this.typeArgumentNames[e]=t}getArgumentNameForType(e){return this.typeArgumentNames[e]?this.typeArgumentNames[e]:n.Msg[s.MsgKey.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME]}setEditFunctionExternal(e){this._editFunctionExternal=e}editFunctionExternal(e,t){this._editFunctionExternal?this._editFunctionExternal(e,t):console.warn("External function editor must be overriden: Blockly.Functions.editFunctionExternalHandler",e,t)}}i.FunctionManager=o,o.instance=new o},{"./msg":100,blockly:207}],99:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),i.validateFunctionExternal=i.getAllFunctionDefinitionBlocks=i.getDefinition=i.flyoutCategory=void 0,s(e("./msg"),i),s(e("./extensions"),i),s(e("./fields/fieldArgumentEditor"),i),s(e("./fields/fieldAutocapitalizeTextInput"),i),s(e("./blocks/argumentEditorBlocks"),i),s(e("./blocks/argumentReporterBlocks"),i),s(e("./blocks/functionDeclarationBlock"),i),s(e("./blocks/functionDefinitionBlock"),i),s(e("./blocks/functionCallBlocks"),i),s(e("./functionManager"),i);var o=e("./utils");Object.defineProperty(i,"flyoutCategory",{enumerable:!0,get:function(){return o.flyoutCategory}}),Object.defineProperty(i,"getDefinition",{enumerable:!0,get:function(){return o.getDefinition}}),Object.defineProperty(i,"getAllFunctionDefinitionBlocks",{enumerable:!0,get:function(){return o.getAllFunctionDefinitionBlocks}}),Object.defineProperty(i,"validateFunctionExternal",{enumerable:!0,get:function(){return o.validateFunctionExternal}})},{"./blocks/argumentEditorBlocks":88,"./blocks/argumentReporterBlocks":89,"./blocks/functionCallBlocks":90,"./blocks/functionDeclarationBlock":91,"./blocks/functionDefinitionBlock":92,"./extensions":95,"./fields/fieldArgumentEditor":96,"./fields/fieldAutocapitalizeTextInput":97,"./functionManager":98,"./msg":100,"./utils":102}],100:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MsgKey=void 0;const n=e("blockly");var s,o;function r(e,t){n.Msg[e]||(n.Msg[e]=t)}(o=s=i.MsgKey||(i.MsgKey={})).REPORTERS_HUE="REPORTERS_HUE",o.FUNCTIONS_CALL_TITLE="FUNCTIONS_CALL_TITLE",o.FUNCTIONS_DEFNORETURN_TITLE="FUNCTIONS_DEFNORETURN_TITLE",o.FUNCTIONS_GO_TO_DEFINITION_OPTION="FUNCTIONS_GO_TO_DEFINITION_OPTION",o.FUNCTION_CALL_TOOLTIP="FUNCTION_CALL_TOOLTIP",o.PROCEDURES_HUE="PROCEDURES_HUE",o.PROCEDURES_CALLNORETURN_HELPURL="PROCEDURES_CALLNORETURN_HELPURL",o.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME="FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME",o.FUNCTIONS_DEFAULT_STRING_ARG_NAME="FUNCTIONS_DEFAULT_STRING_ARG_NAME",o.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME="FUNCTIONS_DEFAULT_NUMBER_ARG_NAME",o.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME="FUNCTIONS_DEFAULT_ARRAY_ARG_NAME",o.PROCEDURES_DEFNORETURN_TOOLTIP="PROCEDURES_DEFNORETURN_TOOLTIP",o.PROCEDURES_DEFNORETURN_HELPURL="PROCEDURES_DEFNORETURN_HELPURL",o.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME="FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME",o.FUNCTIONS_DEFAULT_FUNCTION_NAME="FUNCTIONS_DEFAULT_FUNCTION_NAME",o.FUNCTION_CREATE_NEW="FUNCTION_CREATE_NEW",o.FUNCTION_FLYOUT_LABEL="FUNCTION_FLYOUT_LABEL",o.FUNCTIONS_EDIT_OPTION="FUNCTIONS_EDIT_OPTION",o.FUNCTIONS_CREATE_CALL_OPTION="FUNCTIONS_CREATE_CALL_OPTION",r(s.REPORTERS_HUE,"#A80000"),r(s.FUNCTIONS_CALL_TITLE,"call"),r(s.FUNCTIONS_DEFNORETURN_TITLE,"function"),r(s.FUNCTIONS_GO_TO_DEFINITION_OPTION,"Go to Definition"),r(s.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME,"bool"),r(s.FUNCTIONS_DEFAULT_STRING_ARG_NAME,"text"),r(s.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME,"num"),r(s.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME,"array"),r(s.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME,"value"),r(s.FUNCTIONS_DEFAULT_FUNCTION_NAME,"doSomething"),r(s.FUNCTION_CREATE_NEW,"Make a Function"),r(s.FUNCTION_FLYOUT_LABEL,"Your Functions"),r(s.FUNCTIONS_EDIT_OPTION,"Edit Function"),r(s.FUNCTIONS_CREATE_CALL_OPTION,"Create 'call %1'")},{blockly:207}],101:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.REMOVE_IMAGE_DATAURI=i.ADD_IMAGE_DATAURI=i.COLLAPSE_IMAGE_DATAURI=void 0,i.COLLAPSE_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.354)'%3E%3Cpath d='m1611 367.42q0 53-37 90l-651 651q-38 38-91 38-54 0-90-38l-651-651q-38-36-38-90 0-53 38-91l74-75q39-37 91-37 53 0 90 37l486 486 486-486q37-37 90-37 52 0 91 37l75 75q37 39 37 91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A",i.ADD_IMAGE_DATAURI="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4KCjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0icmVwZWF0IgogICB4PSIwcHgiCiAgIHk9IjBweCIKICAgdmlld0JveD0iMCAwIDI0IDI0IgogICBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiCiAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJhZGQuc3ZnIj48bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGExNSI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48ZGM6dGl0bGU+cmVwZWF0PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczEzIiAvPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZjQ4MjEiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTY4MCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5NjkiCiAgICAgaWQ9Im5hbWVkdmlldzExIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIxOS42NjY2NjciCiAgICAgaW5rc2NhcGU6Y3g9IjEyLjkxNTI1NCIKICAgICBpbmtzY2FwZTpjeT0iMTYuMDY3Nzk2IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0icmVwZWF0IiAvPjxzdHlsZQogICAgIHR5cGU9InRleHQvY3NzIgogICAgIGlkPSJzdHlsZTMiPgoJLnN0MHtmaWxsOiNDRjhCMTc7fQoJLnN0MXtmaWxsOiNGRkZGRkY7fQo8L3N0eWxlPjx0aXRsZQogICAgIGlkPSJ0aXRsZTUiPnJlcGVhdDwvdGl0bGU+PHJlY3QKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MC4wNzg0MzEzNyIKICAgICBpZD0icmVjdDQxNDMiCiAgICAgd2lkdGg9IjQuMDUwMDAwMiIKICAgICBoZWlnaHQ9IjEyLjM5NzA1IgogICAgIHg9IjkuOTc1MDAwNCIKICAgICB5PSItMTguMTk4NTI2IgogICAgIHJ4PSIwLjgxIgogICAgIHJ5PSIwLjgxIgogICAgIHRyYW5zZm9ybT0ic2NhbGUoMSwtMSkiIC8+PHJlY3QKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MC4wNzg0MzEzNyIKICAgICBpZD0icmVjdDQxNDMtMSIKICAgICB3aWR0aD0iNC4wNTAwMDAyIgogICAgIGhlaWdodD0iMTIuMzk3MTE5IgogICAgIHg9IjkuOTc1MDAwNCIKICAgICB5PSI1LjgwMTQ0MDciCiAgICAgcng9IjAuODEiCiAgICAgcnk9IjAuODEiCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMCwxLDEsMCwwLDApIiAvPjxjaXJjbGUKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICBpZD0icGF0aDQxMzYiCiAgICAgY3g9IjEyIgogICAgIGN5PSIxMiIKICAgICByPSIxMC41MDMxOTEiIC8+PC9zdmc+",i.REMOVE_IMAGE_DATAURI="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4KCjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0icmVwZWF0IgogICB4PSIwcHgiCiAgIHk9IjBweCIKICAgdmlld0JveD0iMCAwIDI0IDI0IgogICBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiCiAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJyZW1vdmUuc3ZnIj48bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGExNSI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48ZGM6dGl0bGU+cmVwZWF0PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczEzIiAvPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZjFhZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTY4MCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5NTAiCiAgICAgaWQ9Im5hbWVkdmlldzExIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIxOS42NjY2NjciCiAgICAgaW5rc2NhcGU6Y3g9IjAuMDUwODQ3NTIxIgogICAgIGlua3NjYXBlOmN5PSI5Ljk2NjEwMTciCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJyZXBlYXQiIC8+PHN0eWxlCiAgICAgdHlwZT0idGV4dC9jc3MiCiAgICAgaWQ9InN0eWxlMyI+Cgkuc3Qwe2ZpbGw6I0NGOEIxNzt9Cgkuc3Qxe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+PHRpdGxlCiAgICAgaWQ9InRpdGxlNSI+cmVwZWF0PC90aXRsZT48cmVjdAogICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eTowLjA3ODQzMTM3IgogICAgIGlkPSJyZWN0NDE0My0xIgogICAgIHdpZHRoPSI0LjA1MDAwMDIiCiAgICAgaGVpZ2h0PSIxMi4zOTcxMTkiCiAgICAgeD0iOS45NzUwMDA0IgogICAgIHk9IjUuODAxNDQwNyIKICAgICByeD0iMC44MSIKICAgICByeT0iMC44MSIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLDEsMSwwLDAsMCkiIC8+PGNpcmNsZQogICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIgogICAgIGlkPSJwYXRoNDEzNiIKICAgICBjeD0iMTIiCiAgICAgY3k9IjEyIgogICAgIHI9IjEwLjUwMzE5MSIgLz48L3N2Zz4="},{}],102:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isVariableBlockType=i.validateFunctionExternal=i.flyoutCategory=i.getShadowBlockInfoFromType_=i.findUniqueParamName=i.mutateCallersAndDefinition=i.idsInUse=i.findLegalName=i.createCustomArgumentEditor=i.createCustomArgumentReporter=i.isCustomType=i.getAllFunctionDefinitionBlocks=i.getDefinition=i.rename=void 0;const n=e("blockly"),s=e("./constants"),o=e("./functionManager"),r=e("./msg"),a=e("./blocks/functionDeclarationBlock");function l(e,t){for(const i of t.getTopBlocks(!1))if(i.type===s.FUNCTION_DEFINITION_BLOCK_TYPE){const t=i;if(t.getName()===e)return t}return null}function c(e){return e.getTopBlocks(!1).filter((e=>e.type===s.FUNCTION_DEFINITION_BLOCK_TYPE))}function u(e,t,i){const s=n.utils.xml.createElement("block");s.setAttribute("type",e);const o=n.utils.xml.createElement("mutation");return o.setAttribute("typename",t),s.appendChild(o),n.Xml.domToBlock(s,i)}function h(e,t,i){if(null==i?void 0:i.isInFlyout)return e;const n=d(t,i);for(;n[e];)e=p(e);return e}function d(e,t,i){const n={};return e.getAllVariables().forEach((function(e){n[e.name]=!0})),e.getAllBlocks(!1).forEach((function(e){const o=e;o==t||i&&o.getFunctionId&&o.getFunctionId()==i||(o.type==s.FUNCTION_DEFINITION_BLOCK_TYPE?n[o.getName()]=!0:"procedures_defreturn"==e.type||e.type)})),n}function p(e){const t=e.match(/^(.*?)(\d+)$/);return t?e=t[1]+(parseInt(t[2],10)+1):e+="2",e}function g(e,t,i){const o=l(e,t);if(o){const t=function(e,t){const i=[];for(const n of t.getAllBlocks(!1))if(n.type===s.FUNCTION_CALL_BLOCK_TYPE||n.type===s.FUNCTION_CALL_OUTPUT_BLOCK_TYPE){const t=n;t.getName()===e&&i.push(t)}return i}(e,o.workspace);t.push(o),n.Events.setGroup(!0),t.forEach((function(e){const t=e.mutationToDom(),r=t&&n.Xml.domToText(t);e.domToMutation(i);const a=e.mutationToDom(),l=a&&n.Xml.domToText(a);if(r!=l)if(n.Events.fire(new n.Events.BlockChange(e,"mutation",null,r,l)),e.id==o.id){const e=m(t,!1),i=m(a,!0);o.getDescendants(!1).forEach((function(t){if(!function(e){return e.type==s.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE||e.type==s.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE||e.type==s.ARGUMENT_REPORTER_STRING_BLOCK_TYPE||e.type==s.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE||e.type==s.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE}(t))return;let n=t.getFieldValue("VALUE"),o=e[n];void 0!==o&&(i[o]?i[o]!==n&&t.setFieldValue(i[o],"VALUE"):t.dispose(!0))}))}else setTimeout((function(){e.bumpNeighbours()}),n.config.bumpDelay)})),n.Events.setGroup(!1)}else console.warn("Attempted to change function "+e+", but no definition block was found on the workspace")}function m(e,t){const i={};for(let n=0;n<e.childNodes.length;++n){const s=e.childNodes[n],o=t?s.getAttribute("id"):s.getAttribute("name"),r=t?s.getAttribute("name"):s.getAttribute("id");i[o]=r}return i}function f(e,t){return!t||-1==t.indexOf(e)}i.rename=function(e){e=e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"");const t=this.sourceBlock_,i=h(e,t.workspace,t),n=this.getValue();if(!e)return n;if(!i)return e;if(!n)return t.name_=i,i;if(n!=e&&n!=i){t.name_=i;const e=t.mutationToDom();t.name_=n,g(n,t.workspace,e)}return i},i.getDefinition=l,i.getAllFunctionDefinitionBlocks=c,i.isCustomType=function(e){return!("boolean"==e||"string"==e||"number"==e)},i.createCustomArgumentReporter=function(e,t){return u(s.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE,e,t)},i.createCustomArgumentEditor=function(e,t){return u(s.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE,e,t)},i.findLegalName=h,i.idsInUse=function(e){const t=[];return e.getAllBlocks(!1).forEach((function(e){e.type==s.FUNCTION_DEFINITION_BLOCK_TYPE&&t.push(e.getFunctionId())})),t},i.mutateCallersAndDefinition=g,i.findUniqueParamName=function(e,t){for(;!f(e,t);)e=p(e);return e},i.getShadowBlockInfoFromType_=function(e,t){let i="",s="",r="";switch(e){case"boolean":i="logic_boolean",s="BOOL",r="TRUE";break;case"number":i="math_number",s="NUM",r="1";break;case"string":i="text",s="TEXT",r="abc";break;case"Array":i="variables_get",s="VAR",r=n.Variables.getOrCreateVariablePackage(t,null,"list","").getId();break;default:i="variables_get",s="VAR",r=n.Variables.getOrCreateVariablePackage(t,null,o.FunctionManager.getInstance().getArgumentNameForType(e),"").getId()}return[i,s,r]},i.flyoutCategory=function(e){const t=[],i=document.createElement("button"),l=n.Msg[r.MsgKey.FUNCTION_CREATE_NEW];i.setAttribute("text",l),i.setAttribute("callbackKey","CREATE_FUNCTION"),e.registerButtonCallback("CREATE_FUNCTION",(()=>{!function(e){n.hideChaff(),n.getSelected()&&n.getSelected().unselect(),o.FunctionManager.getInstance().editFunctionExternal((0,a.newFunctionMutation)(e),function(e){return function(t){if(t){const i='<xml><block type="'+s.FUNCTION_DEFINITION_BLOCK_TYPE+'">'+n.Xml.domToText(t)+"</block></xml>",o=n.utils.xml.textToDom(i);n.Events.setGroup(!0);const r=n.Xml.domToBlock(o.firstChild,e);if(r.updateDisplay_(),e.getMetrics){const t=e.getMetrics(),i=r.getHeightWidth();r.moveBy(t.viewLeft+t.viewWidth/2-i.width/2,t.viewTop+t.viewHeight/2-i.height/2),r.scheduleSnapAndBump()}e.centerOnBlock(r.id),n.Events.setGroup(!1),setTimeout((()=>{r.afterWorkspaceLoad&&r.afterWorkspaceLoad()}))}}}(e))}(e)})),t.push(i);for(const i of c(e)){const e=i.getName(),s=i.getArguments(),o=n.utils.xml.createElement("block");o.setAttribute("type","function_call"),o.setAttribute("gap","16");const r=n.utils.xml.createElement("mutation");r.setAttribute("name",e),o.appendChild(r);for(let e=0;e<s.length;e++){const t=n.utils.xml.createElement("arg");t.setAttribute("name",s[e].name),t.setAttribute("type",s[e].type),t.setAttribute("id",s[e].id),r.appendChild(t)}t.push(o)}return t},i.validateFunctionExternal=function(e,t){const i=e.getAttribute("name");if(!i)return n.dialog.alert(n.Msg.FUNCTION_WARNING_EMPTY_NAME),!1;const s={};for(let t=0;t<e.childNodes.length;++t){const i=e.childNodes[t].getAttribute("name");if(!i)return n.dialog.alert(n.Msg.FUNCTION_WARNING_EMPTY_NAME),!1;if(s[i])return n.dialog.alert(n.Msg.FUNCTION_WARNING_DUPLICATE_ARG),!1;s[i]=!0}return s[i]?(n.dialog.alert(n.Msg.FUNCTION_WARNING_ARG_NAME_IS_FUNCTION_NAME),!1):!d(t,null,e.getAttribute("functionid"))[i]||(n.dialog.alert(n.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",i)),!1)},i.isVariableBlockType=function(e){switch(e){case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":case"variables_get_reporter":case"variables_get":return!0}return!1}},{"./blocks/functionDeclarationBlock":91,"./constants":94,"./functionManager":98,"./msg":100,blockly:207}],103:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly");n.Extensions.unregister("logic_compare"),n.Extensions.register("logic_compare",(function(){}))},{blockly:207}],104:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly"),s={elseifCount_:0,elseCount_:0,valueConnections_:[],statementConnections_:[],elseStatementConnection_:null,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const e=n.utils.xml.createElement("mutation");return this.elseifCount_&&e.setAttribute("elseif",this.elseifCount_+""),this.elseCount_&&e.setAttribute("else","1"),e},domToMutation:function(e){e&&(this.elseifCount_=parseInt(e.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(e.getAttribute("else"),10)||0,this.rebuildShape_())},storeConnections_:function(e){e||(e=0),this.valueConnections_=[null],this.statementConnections_=[null],this.elseStatementConnection_=null;for(let t=1;t<=this.elseifCount_;t++)e!=t&&(this.valueConnections_.push(this.getInput("IF"+t).connection.targetConnection),this.statementConnections_.push(this.getInput("DO"+t).connection.targetConnection));this.getInput("ELSE")&&(this.elseStatementConnection_=this.getInput("ELSE").connection.targetConnection)},restoreConnections_:function(){var e,t;for(let t=1;t<=this.elseifCount_;t++)this.reconnectValueConnection_(t,this.valueConnections_),null===(e=this.statementConnections_[t])||void 0===e||e.reconnect(this,"DO"+t);this.getInput("ELSE")&&(null===(t=this.elseStatementConnection_)||void 0===t||t.reconnect(this,"ELSE"))},addElse_:function(){this.update_((()=>{this.elseCount_++}))},removeElse_:function(){this.update_((()=>{this.elseCount_--}))},addElseIf_:function(){this.update_((()=>{this.elseifCount_++}))},removeElseIf_:function(e){this.update_((()=>{this.elseifCount_--}),e)},update_:function(e,t){n.Events.setGroup(!0),this.storeConnections_(t);const i=this,s=i.mutationToDom(),o=s&&n.Xml.domToText(s);e&&e.call(this),this.updateShape_(),i instanceof n.BlockSvg&&i.initSvg();const r=n.Events.getGroup(),a=i.mutationToDom(),l=a&&n.Xml.domToText(a);o!=l&&(n.Events.fire(new n.Events.BlockChange(i,"mutation",null,o,l)),setTimeout((function(){n.Events.setGroup(r),i.bumpNeighbours(),n.Events.setGroup(!1)}),n.config.bumpDelay)),i.rendered&&i instanceof n.BlockSvg&&i.render(),this.restoreConnections_(),n.Events.setGroup(!1)},updateShape_:function(){this.getInput("ELSE")&&(this.removeInput("ELSE"),this.removeInput("ELSETITLE"),this.removeInput("ELSEBUTTONS"));let e=1;for(;this.getInput("IF"+e);)this.removeInput("IF"+e),this.removeInput("IFTITLE"+e),this.removeInput("IFBUTTONS"+e),this.removeInput("DO"+e),e++;for(let e=1;e<=this.elseifCount_;e++){const i=function(e){return function(){t.removeElseIf_(e)}}(e);this.appendValueInput("IF"+e).setCheck("Boolean").appendField(n.Msg.CONTROLS_IF_MSG_ELSEIF).setShadowDom(o()),this.appendDummyInput("IFTITLE"+e).appendField(n.Msg.CONTROLS_IF_MSG_THEN),this.appendDummyInput("IFBUTTONS"+e).appendField(new n.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",i,!1)).setAlign(n.inputs.Align.RIGHT),this.appendStatementInput("DO"+e)}this.elseCount_&&(this.appendDummyInput("ELSETITLE").appendField(n.Msg.CONTROLS_IF_MSG_ELSE),this.appendDummyInput("ELSEBUTTONS").setAlign(n.inputs.Align.RIGHT).appendField(new n.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",this.removeElse_.bind(this),!1)),this.appendStatementInput("ELSE")),this.getInput("ADDBUTTON")&&this.removeInput("ADDBUTTON");const t=this;this.appendDummyInput("ADDBUTTON").appendField(new n.FieldImage(this.ADD_IMAGE_DATAURI,24,24,"*",(function(){0==t.elseCount_?t.addElse_():(t.elseifCount_||(t.elseifCount_=0),t.addElseIf_())}),!1))},rebuildShape_:function(){const e=[null],t=[null];let i=null;this.getInput("ELSE")&&(i=this.getInput("ELSE").connection.targetConnection);let n=1;for(;this.getInput("IF"+n);){const i=this.getInput("IF"+n),s=this.getInput("DO"+n);e.push(i.connection.targetConnection),t.push(s.connection.targetConnection),n++}this.updateShape_(),this.reconnectChildBlocks_(e,t,i)},reconnectChildBlocks_:function(e,t,i){var n;for(let i=1;i<=this.elseifCount_;i++)this.reconnectValueConnection_(i,e),null===(n=t[i])||void 0===n||n.reconnect(this,"DO"+i);null==i||i.reconnect(this,"ELSE")},reconnectValueConnection_:function(e,t){var i;const n=null===(i=this.getInput("IF"+e))||void 0===i?void 0:i.connection.targetBlock();t[e]&&(t[e].reconnect(this,"IF"+e),n&&!n.getParent()&&n.dispose())}};function o(){const e=document.createElement("shadow");e.setAttribute("type","logic_boolean");const t=document.createElement("field");return t.setAttribute("name","BOOL"),t.textContent="FALSE",e.appendChild(t),e}n.Blocks.controls_if=Object.assign(Object.assign({},s),{init(){if(n.Extensions.apply("inline-svgs",this,!1),this.elseifCount_=0,this.elseCount_=0,this.setHelpUrl(n.Msg.CONTROLS_IF_HELPURL),this.appendValueInput("IF0").setCheck("Boolean").appendField(n.Msg.CONTROLS_IF_MSG_IF),this.appendDummyInput("THEN0").appendField(n.Msg.CONTROLS_IF_MSG_THEN),this.appendStatementInput("DO0"),this.workspace instanceof n.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(e.getConstants().SHAPES.HEXAGONAL)}this.updateShape_(),this.setInputsInline(!0),this.setColour(n.Msg.LOGIC_HUE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip((()=>this.elseifCount_||this.elseCount_?!this.elseifCount_&&this.elseCount_?n.Msg.CONTROLS_IF_TOOLTIP_2:this.elseifCount_&&!this.elseCount_?n.Msg.CONTROLS_IF_TOOLTIP_3:this.elseifCount_&&this.elseCount_?n.Msg.CONTROLS_IF_TOOLTIP_4:"":n.Msg.CONTROLS_IF_TOOLTIP_1))}})},{blockly:207}],105:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),s(e("./extensions"),i),s(e("./ifElse"),i)},{"./extensions":103,"./ifElse":104}],106:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSlider=void 0;const n=e("blockly");class s extends n.FieldNumber{constructor(e,t,i,n,s,o,r,a){super(e,t,i,n,r,a),"string"==typeof s?this.step_=parseFloat(s):"number"==typeof s&&(this.step_=s),this.labelText_=o}hasMin(){return this.getMin()>-1/0}hasMax(){return this.getMax()<1/0}getStep(){return this.step_}getLabel(){return this.labelText_}setLabel(e){this.labelText_=e}setOptions(e,t,i,n){this.setConstraints(e,t,n),this.step_=parseFloat(i)||void 0}doClassValidation_(e){if(null===e)return null;e=(e=(e=(e=`${e}`).replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity");let t=Number(e||0);if(isNaN(t))return null;this.precision_&&isFinite(t)&&(t=Math.round(t/this.precision_)*this.precision_);let i=String(this.precision_);-1!==i.indexOf("e")&&(i=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const n=i.indexOf(".");let s;return null!==(s=-1===n?this.precision_?0:null:i.length-n-1)&&(t=Number(t.toFixed(s))),t}showEditor_(e,t){super.showEditor_(e,t),n.DropDownDiv.hideWithoutAnimation(),n.DropDownDiv.clearContent();const i=n.DropDownDiv.getContentDiv();i.setAttribute("role","menu"),i.setAttribute("aria-haspopup","true"),this.addSlider_(i),n.DropDownDiv.setColour("#ffffff","#dddddd"),n.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_)}addSlider_(e){if(this.labelText_){let t=this.createLabelDom_(this.labelText_);e.appendChild(t[0]),this.readout_=t[1],this.setReadout(this.value_)}this.slider_=this.createSlider(),e.appendChild(this.slider_);const t=()=>{pxt.BrowserUtils.isFirefox()||this.htmlInput_.focus()};n.browserEvents.bind(this.slider_,"input",this,(e=>{const i=parseFloat(this.slider_.value)||0;if(null!==i){this.setValue(i);const e=this.htmlInput_;e&&(e.value=i+"",t())}})),n.browserEvents.bind(this.slider_,"focus",this,(e=>{t()}))}setValue(e,t){super.setValue(e,t),this.updateDom(),this.slider_&&(this.slider_.value=this.getValue()+"")}createSlider(){const e=document.createElement("input");let t;return e.type="range",e.min=this.getMin()+"",e.max=this.getMax()+"",e.value=this.getValue()+"",this.sourceBlock_ instanceof n.BlockSvg&&("#ffffff"===this.sourceBlock_.getColour()?this.sourceBlock_.getParent()&&(t=this.sourceBlock_.getParent().getColourTertiary()):t=this.sourceBlock_.getColourTertiary()),t&&e.setAttribute("style",`--blocklyFieldSliderBackgroundColor: ${t}`),Number.isNaN(this.step_)||(e.step=this.step_+""),e}updateDom(){this.setReadout(this.getValue())}setReadout(e){this.readout_&&(this.readout_.innerText=e+"")}createLabelDom_(e){const t=document.createElement("div");t.setAttribute("class","blocklyFieldSliderLabel");const i=document.createElement("span");i.setAttribute("class","blocklyFieldSliderReadout");const n=document.createElement("span");return n.setAttribute("class","blocklyFieldSliderLabelText"),n.innerText=e,t.appendChild(n),t.appendChild(i),[t,i]}}i.FieldSlider=s,n.fieldRegistry.register("field_slider",s),n.Css.register('\n:root {\n    --blocklyFieldSliderBackgroundColor: #547AB2;\n}\n.blocklyFieldSliderLabel {\n    font-family: "Helvetica Neue", "Segoe UI", Helvetica, sans-serif;\n    font-size: 0.65rem;\n    color: $colour_toolboxText;\n    margin: 8px;\n}\n.blocklyFieldSliderLabelText {\n    font-weight: bold;\n}\n.blocklyFieldSliderReadout {\n    margin-left: 10px;\n}\n\ninput[type=range] {\n    -webkit-appearance: none;\n    width: 100%;\n}\ninput[type=range]:focus {\n    outline: none;\n}\ninput[type=range]::-webkit-slider-runnable-track {\n    -webkit-appearance: none;\n    margin: 8px;\n    height: 22px;\n    width: 150px;\n    outline: none;\n    border-radius: 11px;\n    margin-bottom: 20px;\n    background: var(--blocklyFieldSliderBackgroundColor);\n}\ninput[type=range]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    width: 26px;\n    height: 26px;\n    margin-top: -1px;\n    background-color: white;\n    border-radius: 100%;\n    -webkit-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    -moz-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    cursor: pointer;\n}\ninput[type=range]::-moz-range-track {\n    margin: 8px;\n    height: 22px;\n    width: 95%;\n    outline: none;\n    border-radius: 11px;\n    margin-bottom: 20px;\n    background: #547AB2;\n}\ninput[type=range]::-moz-range-thumb {\n    width: 26px;\n    height: 26px;\n    margin-top: -1px;\n    background-color: white;\n    border-radius: 100%;\n    -webkit-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    -moz-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    cursor: pointer;\n}\n')},{blockly:207}],107:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),s(e("./fieldSlider"),i),s(e("./numberBlocks"),i)},{"./fieldSlider":106,"./numberBlocks":108}],108:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly"),s=new n.zelos.ConstantProvider;n.defineBlocksWithJsonArray([{type:"math_integer",message0:"%1",args0:[{type:"field_number",name:"NUM",precision:1}],output:"Number",outputShape:s.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_whole_number",message0:"%1",args0:[{type:"field_number",name:"NUM",min:0,precision:1}],output:"Number",outputShape:s.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_positive_number",message0:"%1",args0:[{type:"field_number",name:"NUM",min:0}],output:"Number",outputShape:s.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_number_minmax",message0:"%1",args0:[{type:"field_slider",name:"SLIDER",value:0,step:1,labelText:"Number"}],output:"Number",outputShape:s.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",mutator:"math_number_minmax_mutator",extensions:["parent_tooltip_when_inline"]}]);const o={mutationToDom:function(){const e=this.inputList[0].fieldRow[0];let t=n.utils.xml.createElement("mutation");return e.hasMin()&&t.setAttribute("min",e.getMin()+""),e.hasMax()&&t.setAttribute("max",e.getMax()+""),null!=e.getLabel()&&t.setAttribute("label",e.getLabel()),null!=e.getStep()&&t.setAttribute("step",e.getStep()+""),null!=e.getPrecision()&&t.setAttribute("precision",e.getPrecision()+""),t},domToMutation:function(e){const t=this.inputList[0].fieldRow[0],i=e.getAttribute("min"),n=e.getAttribute("max"),s=e.getAttribute("step"),o=e.getAttribute("label"),r=e.getAttribute("precision");t.setLabel(o),t.setOptions(i,n,s,r)}};n.Extensions.registerMutator("math_number_minmax_mutator",o)},{blockly:207}],109:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.showEditorMixin=void 0;const n=e("blockly");i.showEditorMixin=function(e){const t=this.getSourceBlock();if(!t)throw new n.UnattachedFieldError;const i=new n.Menu;i.setRole(n.utils.aria.Role.LISTBOX),this.menu_=i;const o=this.getOptions(!1);let r=null;const a=e=>{n.DropDownDiv.hideIfOwner(this,!0),this.onItemSelected_(this.menu_,e)};for(let e=0;e<o.length;e++){const[l,c]=o[e];if("SEPARATOR"===c){const e=new s("");i.addChild(e);continue}const u=(()=>{if("object"==typeof l){const e=new Image(l.width,l.height);return e.src=l.src,e.alt=l.alt||"",e}return l})(),h=new n.MenuItem(u,c);h.setRole(n.utils.aria.Role.OPTION),h.setRightToLeft(t.RTL),h.setCheckable(!0),i.addChild(h),h.setChecked(c===this.value_),h.onAction(a,this),c===this.value_&&(r=h)}e&&"number"==typeof e.clientX?this.menu_.openingCoords=new n.utils.Coordinate(e.clientX,e.clientY):this.menu_.openingCoords=null,n.DropDownDiv.clearContent();const l=this.menu_.render(n.DropDownDiv.getContentDiv());if(n.utils.dom.addClass(l,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV){const e=t.getColour(),i=this.sourceBlock_.style.colourTertiary;n.DropDownDiv.setColour(e,i)}n.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.menu_.focus(),r&&(this.menu_.setHighlighted(r),n.utils.style.scrollIntoContainerView(r.getElement(),n.DropDownDiv.getContentDiv(),!0)),this.applyColour()};class s extends n.MenuItem{createDom(){const e=document.createElement("div");return e.id=n.utils.idGenerator.getNextUniqueId(),this.element_=e,e.className="blockly-menuseparator",e.setAttribute("role","separator"),e}getElement(){return this.element_}getId(){return this.element_.id}}n.Css.register("\n.blockly-menuseparator {\n    border-top: 1px solid rgba(0, 0, 0, 0.2);\n    margin: 4px 0;\n    padding: 0;\n}\n")},{blockly:207}],110:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldVariable=void 0;const n=e("blockly"),s=e("./fieldDropdownMixin");class o extends n.FieldVariable{constructor(e,t,i,n,s){super(e,t,i,n,s),this.svgRootBinding=null,this.fieldRootBinding=null,this.menuGenerator_=o.dropdownCreate}static dropdownCreate(){const e=n.FieldVariable.dropdownCreate.call(this),t=e.findIndex((e=>"RENAME_VARIABLE_ID"===e[1]));return e.splice(t,0,[n.Msg.NEW_VARIABLE_DROPDOWN,o.CREATE_VARIABLE_ID],[void 0,"SEPARATOR"]),e}onItemSelected_(e,t){!this.sourceBlock_||this.sourceBlock_.isDeadOrDying()||t.getValue()!==o.CREATE_VARIABLE_ID?super.onItemSelected_(e,t):n.Variables.createVariableButtonHandler(this.sourceBlock_.workspace,(e=>{const t=this.sourceBlock_.workspace.getVariable(e);t&&this.setValue(t.getId())}))}initView(){super.initView(),this.shouldAddBorderRect_()||(this.createBorderRect_(),this.clickTargetRect=this.borderRect_,this.clickTargetRect.setAttribute("stroke-opacity","0"),this.clickTargetRect.setAttribute("fill-opacity","0"),this.borderRect_=void 0)}shouldAddBorderRect_(){if("variables_get"===this.sourceBlock_.type)return!1;for(const e of this.sourceBlock_.inputList)for(const t of e.fieldRow)if(t!==this&&t.EDITABLE)return!0;return!this.sourceBlock_.getInputsInline()||super.shouldAddBorderRect_()}bindEvents_(){this.shouldAddBorderRect_()?super.bindEvents_():(this.svgRootBinding=n.browserEvents.conditionalBind(this.sourceBlock_.getSvgRoot(),"pointerdown",this,(e=>{this.sourceBlock_.icons.length||this.onMouseDown_(e)}),!1),this.fieldRootBinding=n.browserEvents.conditionalBind(this.getSvgRoot(),"pointerdown",this,(e=>{this.sourceBlock_.icons.length&&this.onMouseDown_(e)}),!1))}dispose(){super.dispose(),this.svgRootBinding&&(n.browserEvents.unbind(this.svgRootBinding),n.browserEvents.unbind(this.fieldRootBinding))}positionBorderRect_(){super.positionBorderRect_(),this.clickTargetRect&&(this.clickTargetRect.setAttribute("width",String(this.size_.width)),this.clickTargetRect.setAttribute("height",String(this.size_.height)),this.clickTargetRect.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.clickTargetRect.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}showEditor_(e){s.showEditorMixin.call(this,e)}}i.FieldVariable=o,o.CREATE_VARIABLE_ID="CREATE_VARIABLE",n.fieldRegistry.unregister("field_variable"),n.fieldRegistry.register("field_variable",o)},{"./fieldDropdownMixin":109,blockly:207}],111:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),s(e("./fieldVariable"),i)},{"./fieldVariable":110}],112:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isCollapsedInputRow=i.CollapsedInputRow=void 0;const n=e("blockly");class s extends n.blockRendering.InputRow{constructor(e){super(e),this.type|=n.blockRendering.Types.INPUT_ROW|n.blockRendering.Types.getType("COLLAPSED_INPUT_ROW")}measure(){this.width=this.minWidth,this.height=this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT}}i.CollapsedInputRow=s,i.isCollapsedInputRow=function(e){return!!(e.type&n.blockRendering.Types.getType("COLLAPSED_INPUT_ROW"))}},{blockly:207}],113:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ConnectionPreviewer=void 0;const n=e("blockly");class s extends n.InsertionMarkerPreviewer{previewReplacement(e,t,i){super.previewReplacement(e,t,i),this.connectionLine||(this.connectionLine=n.utils.dom.createSvgElement("line",{class:"blocklyConnectionLine",x1:0,y1:0,x2:0,y2:0},e.sourceBlock_.getSvgRoot()),this.draggedConnectionIndicator=this.createConnectionIndicator(e));const o=s.CONNECTION_INDICATOR_RADIUS,r=e.getOffsetInBlock(),a=n.utils.Coordinate.sum(e.sourceBlock_.getRelativeToSurfaceXY(),r),l=n.utils.Coordinate.sum(t.sourceBlock_.getRelativeToSurfaceXY(),t.getOffsetInBlock()),c=l.x-a.x,u=l.y-a.y,h=Math.atan2(u,c);Math.sqrt(c*c+u*u)<2*o+1?n.utils.dom.addClass(this.connectionLine,"hidden"):(n.utils.dom.removeClass(this.connectionLine,"hidden"),this.connectionLine.setAttribute("x1",String(r.x+Math.cos(h)*o)),this.connectionLine.setAttribute("y1",String(r.y+Math.sin(h)*o)),this.connectionLine.setAttribute("x2",String(r.x+c-Math.cos(h)*o)),this.connectionLine.setAttribute("y2",String(r.y+u-Math.sin(h)*o)))}hidePreview(){super.hidePreview(),this.connectionLine&&(this.connectionLine.remove(),this.connectionLine=null,this.draggedConnectionIndicator.remove(),this.draggedConnectionIndicator=null,this.staticConnection=null)}createConnectionIndicator(e){const t=n.utils.dom.createSvgElement("g",{class:"blocklyInputConnectionIndicator"},e.sourceBlock_.getSvgRoot());n.utils.dom.createSvgElement("circle",{r:s.CONNECTION_INDICATOR_RADIUS},t);const i=e.getOffsetInBlock();return t.setAttribute("transform","translate("+i.x+","+i.y+")"),t}}i.ConnectionPreviewer=s,s.CONNECTION_INDICATOR_RADIUS=9},{blockly:207}],114:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ConstantProvider=void 0;const n=e("blockly");class s extends n.zelos.ConstantProvider{constructor(){super(...arguments),this.FIELD_TEXT_FONTFAMILY='"Monaco", "Menlo", "Ubuntu Mono", "Consolas", "source-code-pro", monospace',this.FIELD_TEXT_FONTWEIGHT="600",this.HIGHLIGHT_GLOW_COLOUR="#FFF200",this.ERROR_HIGHLIGHT_GLOW_COLOR="#FF0000",this.HIGHLIGHT_GLOW_SIZE=1.1,this.ELLIPSES_RADIUS=6,this.ELLIPSES_SPACING=8,this.ellipses=this.makeEllipses()}createDom(e,t,i){super.createDom(e,t,i);const s=n.utils.dom.createSvgElement(n.utils.Svg.DEFS,{},e);this.highlightOutlineFilter=this.createHighlight(s,"blocklyHighlightedGlowFilter",this.HIGHLIGHT_GLOW_COLOUR),this.highlightOutlineFilterId=this.highlightOutlineFilter.id,this.errorOutlineFilter=this.createHighlight(s,"blocklyErrorHighlightedGlowFilter",this.ERROR_HIGHLIGHT_GLOW_COLOR),this.errorOutlineFilterId=this.errorOutlineFilter.id,this.embossFilterOverride=this.createOutline(s,"blocklyBubbleEmbossGlowFilter"),this.embossFilterId=this.embossFilterOverride.id}dispose(){super.dispose(),this.highlightOutlineFilter&&n.utils.dom.removeNode(this.highlightOutlineFilter)}makeEllipses(){const e=this.ELLIPSES_RADIUS,t=this.ELLIPSES_SPACING;let i="";for(let s=0;s<3;s++)i+=n.utils.svgPaths.moveBy(t,0)+n.utils.svgPaths.arc("a","180 1,1",e,n.utils.svgPaths.point(2*e,0));for(let s=0;s<3;s++)i+=n.utils.svgPaths.arc("a","180 1,1",e,n.utils.svgPaths.point(2*-e,0))+n.utils.svgPaths.moveBy(-t,0);return i}getCSS_(e){return super.getCSS_(e).concat([e+" .blocklyConnectionIndicator, "+e+" .blocklyInputConnectionIndicator {","fill: #ff0000;","stroke: #ffff00;","stroke-width: 3px;","}",e+" .blocklyConnectionIndicator {","display: none;","}",e+" .blocklyBlockDragSurface > g > .blocklyDraggable > .blocklyConnectionIndicator {","display: block;","}",e+" .blocklyConnectionLine {","stroke: #ffff00;","stroke-width: 4px;","}",e+" .blocklyConnectionLine.hidden {","display: none;","}",e+" .blocklyFlyoutHeading .blocklyFlyoutLabelText {font-size: 1.5rem;","}"])}createHighlight(e,t,i){const s=n.utils.dom.createSvgElement(n.utils.Svg.FILTER,{id:t+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e);n.utils.dom.createSvgElement(n.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.HIGHLIGHT_GLOW_SIZE},s);const o=n.utils.dom.createSvgElement(n.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},s);return n.utils.dom.createSvgElement(n.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},o),n.utils.dom.createSvgElement(n.utils.Svg.FEFLOOD,{"flood-color":i,"flood-opacity":1,result:"outColor"},s),n.utils.dom.createSvgElement(n.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},s),s}createOutline(e,t){const i=n.utils.dom.createSvgElement(n.utils.Svg.FILTER,{id:t+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e);n.utils.dom.createSvgElement(n.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:.92},i);const s=n.utils.dom.createSvgElement(n.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},i);n.utils.dom.createSvgElement(n.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},s),n.utils.dom.createSvgElement(n.utils.Svg.FEFLOOD,{"flood-color":"#000000","flood-opacity":.5,result:"outColor"},i),n.utils.dom.createSvgElement(n.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},i);const o=n.utils.dom.createSvgElement("feMerge",{},i);return n.utils.dom.createSvgElement("feMergeNode",{in:"outBlur"},o),n.utils.dom.createSvgElement("feMergeNode",{in:"outGlow"},o),n.utils.dom.createSvgElement("feMergeNode",{in:"SourceGraphic"},o),i}shapeFor(e){let t=e.getCheck();switch(!t&&e.targetConnection&&(t=e.targetConnection.getCheck()),e.type){case n.ConnectionType.INPUT_VALUE:case n.ConnectionType.OUTPUT_VALUE:return t&&t.includes("Boolean")?this.HEXAGONAL:(t&&t.includes("Number")||t&&t.includes("String"),this.ROUNDED);case n.ConnectionType.PREVIOUS_STATEMENT:case n.ConnectionType.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}}}i.ConstantProvider=s,s.COLLAPSE_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.354)'%3E%3Cpath d='m1611 367.42q0 53-37 90l-651 651q-38 38-91 38-54 0-90-38l-651-651q-38-36-38-90 0-53 38-91l74-75q39-37 91-37 53 0 90 37l486 486 486-486q37-37 90-37 52 0 91 37l75 75q37 39 37 91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A",s.EXPAND_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.654)'%3E%3Cpath d='m1611 832q0-53-37-90l-651-651q-38-38-91-38-54 0-90 38l-651 651q-38 36-38 90 0 53 38 91l74 75q39 37 91 37 53 0 90-37l486-486 486 486q37 37 90 37 52 0 91-37l75-75q37-39 37-91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A"},{blockly:207}],115:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});e("blockly").Css.register("\n.blocklyDropdownMenu .blocklyMenuItemCheckbox.goog-menuitem-checkbox {\n    filter: contrast(0) brightness(100);\n}\n")},{blockly:207}],116:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Drawer=void 0;const n=e("blockly"),s=e("./collapsedInputRow");class o extends n.zelos.Drawer{drawCollapsedStack_(e){const t=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.constants_.INSIDE_CORNERS.width,i=this.constants_.STATEMENT_INPUT_PADDING_LEFT+2*this.constants_.INSIDE_CORNERS.width+n.utils.svgPaths.lineOnAxis("h",-this.constants_.INSIDE_CORNERS.width)+this.constants_.INSIDE_CORNERS.pathTop,s=e.height-2*this.constants_.INSIDE_CORNERS.height,o=this.constants_.INSIDE_CORNERS.pathBottom+n.utils.svgPaths.lineOnAxis("h",this.constants_.INSIDE_CORNERS.width),r=this.constants_.ellipses;this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.bottomRight+n.utils.svgPaths.lineOnAxis("H",t)+i+n.utils.svgPaths.lineOnAxis("v",s/2)+r+n.utils.svgPaths.lineOnAxis("v",s/2)+o+n.utils.svgPaths.lineOnAxis("H",e.xPos+e.width-this.constants_.OUTSIDE_CORNERS.rightHeight)+this.constants_.OUTSIDE_CORNERS.topRight}drawOutline_(){if(this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection)this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_();else{this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){const t=this.info_.rows[e];t.hasJaggedEdge?this.drawJaggedEdge_(t):(0,s.isCollapsedInputRow)(t)?this.drawCollapsedStack_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_(),this.drawLeft_()}}drawLeft_(){if(super.drawLeft_(),this.info_.rows.find((function(e){return(0,s.isCollapsedInputRow)(e)}))){let e=this.info_.startY;n.blockRendering.Types.isLeftRoundedCorner(this.info_.topRow.elements[0])&&(e+=this.constants_.OUTSIDE_CORNERS.rightHeight),this.outlinePath_=this.outlinePath_.slice(0,-1),this.outlinePath_+=n.utils.svgPaths.lineOnAxis("V",e)}}}i.Drawer=o},{"./collapsedInputRow":112,blockly:207}],117:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),s(e("./renderer"),i),s(e("./connectionPreviewer"),i),s(e("./css"),i)},{"./connectionPreviewer":113,"./css":115,"./renderer":120}],118:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.RenderInfo=void 0;const n=e("blockly"),s=e("./collapsedInputRow");class o extends n.zelos.RenderInfo{measure(){if(this.block_)for(const e of this.block_.inputList)e.init();super.measure()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let e=new n.blockRendering.InputRow(this.constants_);this.inputRows.push(e);const t=this.block_.getIcons();for(let i,s=0;i=t[s];s++){const t=new n.blockRendering.Icon(this.constants_,i);this.isCollapsed&&!i.isShownWhenCollapsed()||e.elements.push(t)}let i;for(let t,s=0;t=this.block_.inputList[s];s++)if(t.isVisible()){this.shouldStartNewRow_(t,i)&&(this.rows.push(e),e=new n.blockRendering.InputRow(this.constants_),this.inputRows.push(e));for(let i,s=0;i=t.fieldRow[s];s++)e.elements.push(new n.blockRendering.Field(this.constants_,i,t));this.addInput_(t,e),i=t}this.isCollapsed&&(this.block_.inputList.find((function(e){return e.type==n.inputs.inputTypes.STATEMENT}))?e=this.addCollapsedRow_(e):(e.hasJaggedEdge=!0,e.elements.push(new n.blockRendering.JaggedEdge(this.constants_)))),(e.elements.length||e.hasDummyInput)&&this.rows.push(e),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection;const e=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof n.inputs.StatementInput||this.rows.some((e=>(0,s.isCollapsedInputRow)(e)));this.bottomRow.minHeight=e?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new n.blockRendering.SquareCorner(this.constants_)):this.bottomRow.elements.push(new n.blockRendering.RoundCorner(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new n.blockRendering.NextConnection(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new n.blockRendering.SquareCorner(this.constants_,"right")):this.bottomRow.elements.push(new n.blockRendering.RoundCorner(this.constants_,"right"))}addCollapsedRow_(e){this.rows.push(e);const t=new s.CollapsedInputRow(this.constants_);return t.hasDummyInput=!0,t}}i.RenderInfo=o},{"./collapsedInputRow":112,blockly:207}],119:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PathObject=void 0;const n=e("blockly"),s="blockly-dotted-outline-on-hover",o="hover";class r extends n.zelos.PathObject{constructor(){super(...arguments),this.connectionPointIndicators=new WeakMap}updateHighlighted(e){if(e){if(!this.svgPathHighlighted){const e=this.constants,t=this.hasError?e.errorOutlineFilterId:e.highlightOutlineFilterId;this.svgPathHighlighted=this.svgPath.cloneNode(!0),this.svgPathHighlighted.setAttribute("fill","none"),this.svgPathHighlighted.setAttribute("filter","url(#"+t+")"),this.svgRoot.appendChild(this.svgPathHighlighted)}}else this.svgPathHighlighted&&(this.svgRoot.removeChild(this.svgPathHighlighted),this.svgPathHighlighted=null)}updateSelected(e){e&&this.svgPath.classList.remove(o),super.updateSelected(e)}addConnectionHighlight(e,t,i,s){if(super.addConnectionHighlight(e,t,i,s),e.type===n.INPUT_VALUE||e.type===n.OUTPUT_VALUE){const t=n.utils.dom.createSvgElement("g",{class:"blocklyInputConnectionIndicator"});n.utils.dom.createSvgElement("circle",{r:r.CONNECTION_INDICATOR_RADIUS},t);const i=e.getOffsetInBlock();t.setAttribute("transform","translate("+i.x+","+i.y+")"),this.connectionPointIndicators.set(e,t),this.svgRoot.appendChild(t)}}removeConnectionHighlight(e){super.removeConnectionHighlight(e),this.connectionPointIndicators.has(e)&&(this.connectionPointIndicators.get(e).remove(),this.connectionPointIndicators.delete(e))}applyColour(e){if(super.applyColour(e),e.outputConnection){let t=!1;const i=e.getParent();if(i)if(e.isShadow()){const e=i.style.colourTertiary;(function(e){return(.2126*e[0]+.7152*e[1]+.0722*e[2])/255})(n.utils.colour.hexToRgb(e))<.15&&(this.svgPath.setAttribute("stroke",n.utils.colour.blend("#ffffff",e,.3)),t=!0)}else{const s=i.style.colourPrimary,o=e.style.colourPrimary;if(s===o){const e=.6,i=n.utils.colour.blend("#0000000",o,e),r=n.utils.colour.blend("#ffffff",o,e);pxt.contrastRatio(i,s)>pxt.contrastRatio(r,s)?this.svgPath.setAttribute("stroke",i):this.svgPath.setAttribute("stroke",r),t=!0}}t||this.svgPath.setAttribute("stroke",e.style.colourTertiary)}}setHasDottedOutlineOnHover(e){this.hasDottedOutlineOnHover=e,e?(this.svgPath.classList.add(s),this.mouseOverData||(this.mouseOverData=n.browserEvents.bind(this.svgRoot,"mouseover",this,(()=>{this.svgPath.classList.add(o)})),this.mouseLeaveData=n.browserEvents.bind(this.svgRoot,"mouseleave",this,(()=>{this.svgPath.classList.remove(o)})))):(this.svgPath.classList.remove(s),this.mouseOverData&&(n.browserEvents.unbind(this.mouseOverData),n.browserEvents.unbind(this.mouseLeaveData),this.mouseOverData=void 0,this.mouseLeaveData=void 0),this.svgPath.classList.remove(s))}setHasError(e){this.hasError=e}isHighlighted(){return!!this.svgPathHighlighted}resizeHighlight(){this.svgPathHighlighted&&(this.updateHighlighted(!1),this.updateHighlighted(!0))}}i.PathObject=r,r.CONNECTION_INDICATOR_RADIUS=9,n.Css.register("\n.blockly-dotted-outline-on-hover {\n    transition: stroke .4s;\n}\n.blockly-dotted-outline-on-hover.hover {\n    stroke-dasharray: 2;\n    stroke: white;\n    stroke-width: 2;\n}\n")},{blockly:207}],120:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Renderer=void 0;const n=e("blockly"),s=e("./pathObject"),o=e("./constants"),r=e("./info"),a=e("./drawer");class l extends n.zelos.Renderer{makePathObject(e,t){return new s.PathObject(e,t,this.getConstants())}makeConstants_(){return new o.ConstantProvider}makeRenderInfo_(e){return new r.RenderInfo(this,e)}makeDrawer_(e,t){return new a.Drawer(e,t)}render(e){e.updateBeforeRender&&e.updateBeforeRender(),super.render(e)}}i.Renderer=l,n.blockRendering.register("pxt",l)},{"./constants":114,"./drawer":116,"./info":118,"./pathObject":119,blockly:207}],121:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldString=void 0;const n=e("blockly");class s extends n.FieldTextInput{initView(){this.quoteSize_=16,this.quoteWidth_=8,this.quoteLeftX_=0,this.quoteRightX_=0,this.quoteY_=10,this.quoteLeft_&&this.quoteLeft_.parentNode.removeChild(this.quoteLeft_),this.quoteLeft_=n.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),super.initView(),this.quoteRight_&&this.quoteRight_.parentNode.removeChild(this.quoteRight_),this.quoteRight_=n.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),this.quoteLeft_.appendChild(document.createTextNode('"')),this.quoteRight_.appendChild(document.createTextNode('"'))}updateSize_(e){super.updateSize_(e);const t=this.value_?this.size_.width:1;let i=this.positionLeft(t+3);this.textElement_.setAttribute("x",i+""),i+=this.positionRight(i+t+3),this.size_.width=t+i}positionLeft(e){if(!this.quoteLeft_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteLeftX_=e+this.quoteWidth_+2*s.quotePadding,t=this.quoteWidth_+s.quotePadding):(this.quoteLeftX_=0,t=this.quoteWidth_+s.quotePadding),this.quoteLeft_.setAttribute("transform","translate("+this.quoteLeftX_+","+this.quoteY_+")"),t}positionRight(e){if(!this.quoteRight_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteRightX_=s.quotePadding,t=this.quoteWidth_+s.quotePadding):(this.quoteRightX_=e+s.quotePadding,t=this.quoteWidth_+s.quotePadding),this.quoteRight_.setAttribute("transform","translate("+this.quoteRightX_+","+this.quoteY_+")"),t}}i.FieldString=s,s.quotePadding=0,n.Css.register("\n.field-text-quote {\n    fill: #a31515 !important;\n}\n"),n.fieldRegistry.register("field_string",s)},{blockly:207}],122:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),s(e("./fieldString"),i),s(e("./text"),i),s(e("./join"),i)},{"./fieldString":121,"./join":123,"./text":124}],123:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly"),s={itemCount_:0,valueConnections_:[],mutationToDom:function(){const e=n.utils.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_+""),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},storeValueConnections_:function(){this.valueConnections_=[];for(let e=0;e<this.itemCount_;e++)this.valueConnections_.push(this.getInput("ADD"+e).connection.targetConnection)},restoreValueConnections_:function(){var e;for(let t=0;t<this.itemCount_;t++)null===(e=this.valueConnections_[t])||void 0===e||e.reconnect(this,"ADD"+t)},addItem_:function(){if(this.storeValueConnections_(),this.update_((()=>{this.itemCount_++})),this.restoreValueConnections_(),this.itemCount_>1){const e=this.getInput("ADD0");if(e&&e.connection.targetConnection){const t=this.getInput("ADD"+(this.itemCount_-1)),i=e.connection.getShadowDom();if(i){const e=n.utils.xml.createElement("shadow"),s=i.getAttribute("type");e.setAttribute("type",s),e&&(e.setAttribute("id",n.utils.idGenerator.genUid()),t.connection.setShadowDom(e))}}}},removeItem_:function(){this.storeValueConnections_(),this.update_((()=>{this.itemCount_--})),this.restoreValueConnections_()},update_:function(e){n.Events.setGroup(!0);const t=this,i=t.mutationToDom(),s=i&&n.Xml.domToText(i);e&&e.call(this),this.updateShape_(),t instanceof n.BlockSvg&&t.initSvg();const o=n.Events.getGroup(),r=t.mutationToDom(),a=r&&n.Xml.domToText(r);s!=a&&(n.Events.fire(new n.Events.BlockChange(t,"mutation",null,s,a)),setTimeout((function(){n.Events.setGroup(o),t.bumpNeighbours(),n.Events.setGroup(!1)}),n.config.bumpDelay)),t.rendered&&t instanceof n.BlockSvg&&t.render(),n.Events.setGroup(!1)},updateShape_:function(){const e=this;let t;for(this.getInput("EMPTY")&&this.removeInput("EMPTY"),this.getInput("TITLE")||this.appendDummyInput("TITLE").appendField(n.Msg.TEXT_JOIN_TITLE_CREATEWITH),t=0;t<this.itemCount_;t++)this.getInput("ADD"+t)||this.appendValueInput("ADD"+t).setAlign(n.inputs.Align.LEFT);for(;this.getInput("ADD"+t);)this.removeInput("ADD"+t),t++;this.getInput("BUTTONS")&&this.removeInput("BUTTONS");const i=this.appendDummyInput("BUTTONS");this.itemCount_>1&&i.appendField(new n.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",(function(){e.removeItem_()}),!1)),i.appendField(new n.FieldImage(this.ADD_IMAGE_DATAURI,24,24,"*",(function(){e.addItem_()}),!1));const s=this.itemCount_<=4;if(this.setInputsInline(s),this.workspace instanceof n.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(s?e.getConstants().SHAPES.ROUND:e.getConstants().SHAPES.SQUARE)}}};n.Extensions.registerMutator("pxt_text_join_mutator",s,(function(){n.Extensions.apply("inline-svgs",this,!1),this.itemCount_=2,this.updateShape_()})),n.defineBlocksWithJsonArray([{type:"text_join",message0:"",output:"String",outputShape:(new n.zelos.ConstantProvider).SHAPES.ROUND,style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"pxt_text_join_mutator"}])},{blockly:207}],124:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("blockly");n.defineBlocksWithJsonArray([{type:"text",message0:"%1",args0:[{type:"field_string",name:"TEXT",text:""}],output:"String",outputShape:(new n.zelos.ConstantProvider).SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["parent_tooltip_when_inline"]}])},{blockly:207}],125:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.blocksMetrics=i.render=i.renderWorkspace=i.cleanRenderingWorkspace=i.initRenderingWorkspace=void 0;const n=e("blockly"),s=e("./layout"),o=e("./importer");let r,a;function l(){return r||((a=document.createElement("div")).style.position="absolute",a.style.top="0",a.style.left="0",a.style.width="1px",a.style.height="1px",document.body.appendChild(a),r=n.inject(a,{move:{scrollbars:!1},readOnly:!0,sounds:!1,media:pxt.webConfig.commitCdnUrl+"blockly/media/",rtl:pxt.Util.isUserLanguageRtl(),renderer:"pxt"})),(0,o.clearWithoutEvents)(r),r}function c(){r&&r.dispose(),r=void 0}function u(e={emPixels:18,layout:1}){switch(e.splitSvg?1:e.layout||4){case 1:(0,s.verticalAlign)(r,e.emPixels||18);break;case 4:(0,s.flow)(r,{ratio:e.aspectRatio,useViewWidth:e.useViewWidth});break;case 3:r.cleanUp_&&r.cleanUp_()}let t=r.getMetrics();const i=a.querySelectorAll("svg")[0].cloneNode(!0);return(0,s.cleanUpBlocklySvg)(i),pxt.U.toArray(i.querySelectorAll(".blocklyBlockCanvas,.blocklyBubbleCanvas")).forEach((e=>e.setAttribute("transform",`translate(${-t.contentLeft}, ${-t.contentTop}) scale(1)`))),i.setAttribute("viewBox",`0 0 ${t.contentWidth} ${t.contentHeight}`),e.emPixels&&(i.style.width=t.contentWidth/e.emPixels+"em",i.style.height=t.contentHeight/e.emPixels+"em"),e.splitSvg?(0,s.splitSvg)(i,r,e.emPixels):i}i.initRenderingWorkspace=l,i.cleanRenderingWorkspace=c,i.renderWorkspace=u,i.render=function(e,t={emPixels:18,layout:1}){l();try{let i=e||'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>',s=n.utils.xml.textToDom(i);return(0,o.domToWorkspaceNoEvents)(s,r,{applyHideMetaComment:!0}),u(t)}catch(e){return void pxt.reportException(e)}finally{c()}},i.blocksMetrics=function(e){const t=e.getTopBlocks(!1);if(!t.length)return{width:0,height:0};let i;return t.forEach((e=>{const t=e.getBoundingRectangle();i?(i.l=Math.min(i.l,t.left),i.r=Math.max(i.r,t.right),i.t=Math.min(i.t,t.top),i.b=Math.min(i.b,t.bottom)):i={l:t.left,r:t.right,t:t.top,b:t.bottom}})),{width:i.r-i.l,height:i.b-i.t}}},{"./importer":67,"./layout":69,blockly:207}],126:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.findBlockIdByLine=i.findBlockIdByPosition=void 0,i.findBlockIdByPosition=function(e,t){if(!t)return;let i,n;for(let s=0;s<e.length;++s){let o=e[s];o.startPos<=t.start&&o.endPos>=t.start+t.length&&(!i||n>o.endPos-o.startPos)&&(i=o,n=o.endPos-o.startPos)}return i?i.id:void 0},i.findBlockIdByLine=function(e,t){if(!t)return;let i,n;for(let s=0;s<e.length;++s){let o=e[s];o.startLine<=t.start&&o.endLine>t.start+t.length&&(!i||n>o.endLine-o.startLine)&&(i=o,n=o.endLine-o.startLine)}return i?i.id:void 0}},{}],127:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.createFunctionsFlyoutCategory=i.mkReturnStatementBlock=i.mkVariableFieldBlock=i.mkFieldBlock=i.mkPredicateBlock=i.createToolboxBlock=i.createFlyoutGap=i.createFlyoutButton=i.createFlyoutGroupLabel=i.createFlyoutHeadingLabel=i.createShadowValue=i.isArrayType=void 0;const n=e("blockly"),s=e("./plugins/functions"),o=e("./plugins/duplicateOnDrag"),r=/^(string|number|boolean)$/,a={string:{field:"TEXT",block:"text",defaultValue:""},number:{field:"NUM",block:"math_number",defaultValue:"0"},boolean:{field:"BOOL",block:"logic_boolean",defaultValue:"false"},Array:{field:"VAR",block:"variables_get",defaultValue:"list"}};function l(e){let t=/^(?:Array<(.+)>)|(?:(.+)\[\])|(?:\[.+\])$/.exec(e);return t?t[1]?t[1]:t[2]:void 0}function c(e,t,i,n,s,o=0){let r;if(n=n||t.defaultValue,!(i=i||t.shadowBlockId)&&t.range&&(i="math_number_minmax"),r=n&&'"'==n.slice(0,1)?JSON.parse(n):n,"number"==t.type&&"value"==i){const e=document.createElement("field");return e.setAttribute("name",t.definitionName),e.appendChild(document.createTextNode("0")),e}if(t.fieldEditor){if(t.defaultValue){const e=document.createElement("field");return e.setAttribute("name",t.definitionName),e.appendChild(document.createTextNode(t.defaultValue)),e}return}let c=pxt.Util.lookup(e.apis.byQName,t.type),h=6==(null==c?void 0:c.kind),d=c&&!!c.attributes.fixedInstances&&!t.shadowBlockId,p="@combined@"==t.type;if(!i&&(h||d||p)){if(n){const e=document.createElement("field");return e.setAttribute("name",t.definitionName),e.appendChild(document.createTextNode(n)),e}return}const m="variables_get"==i,f="text"==i,_=document.createElement("value");_.setAttribute("name",t.definitionName);const T=l(t.type),E=document.createElement(!m&&!T||s?"shadow":"block");_.appendChild(E);const b=a[T||t.type];if(E.setAttribute("type",i||(T?"lists_create_with":b&&b.block||t.type)),E.setAttribute("colour","#fff"),T){if(b&&!i){let e;switch(T){case"number":e=["0","1"];break;case"string":e=["a","b","c"];break;case"boolean":e=["FALSE","FALSE","FALSE"]}return u(E,b.block,b.field,e),_}if(i&&r)return u(E,r),_}if(!b||i&&b.block!==i&&"math_number_minmax"!==i){if(r){const n=document.createElement("field");if(n.textContent=r,m)n.setAttribute("name","VAR"),E.appendChild(n);else if(f)n.setAttribute("name","TEXT"),E.appendChild(n);else if(i){const t=e.blocksById[i];if(t&&t.attributes._def&&t.attributes._def.parameters.length){const e=t.attributes._def.parameters[0];n.setAttribute("name",e.name),E.appendChild(n)}}else n.setAttribute("name",t.definitionName),E.appendChild(n)}}else{const e=document.createElement("field");let n,s;switch(E.appendChild(e),i){case"variables_get":n="VAR";break;case"math_number_minmax":n="SLIDER";break;default:n=b.field}e.setAttribute("name",n),s="boolean"==t.type?document.createTextNode((r||b.defaultValue).toUpperCase()):document.createTextNode(r||b.defaultValue),e.appendChild(s)}let I;if(t.range&&((I=document.createElement("mutation")).setAttribute("min",t.range.min.toString()),I.setAttribute("max",t.range.max.toString()),I.setAttribute("label",t.actualName.charAt(0).toUpperCase()+t.actualName.slice(1)),t.fieldOptions&&(t.fieldOptions.step&&I.setAttribute("step",t.fieldOptions.step),t.fieldOptions.color&&I.setAttribute("color",t.fieldOptions.color),t.fieldOptions.precision&&I.setAttribute("precision",t.fieldOptions.precision))),t.fieldOptions&&(I||(I=document.createElement("mutation")),I.setAttribute("customfield",JSON.stringify(t.fieldOptions))),I&&E.appendChild(I),o){const t=pxt.Util.toArray(_.getElementsByTagName("shadow"));for(const i of t)if(!i.innerHTML){const t=e.blocks.find((e=>e.attributes.blockId===i.getAttribute("type")));if(t){const n=g(e,t,pxt.blocks.compileInfo(t),!0,o-1);for(;n.firstChild;)i.appendChild(n.firstChild.cloneNode(!0)),n.firstChild.remove()}}}return _}function u(e,t,i,n){const s=n?n.length:2,o=document.createElement("mutation");o.setAttribute("items",""+s),o.setAttribute("horizontalafter",""+s),e.appendChild(o);for(let o=0;o<s;o++){const s=document.createElement("value");s.setAttribute("name","ADD"+o);const r=document.createElement("shadow");if(r.setAttribute("type",t),i){const e=document.createElement("field");e.setAttribute("name",i),n&&e.appendChild(document.createTextNode(n[o])),r.appendChild(e)}s.appendChild(r),e.appendChild(s)}}function h(e,t,i,n){const s=p(e,pxt.toolbox.convertColor(t),i,n);return s.setAttribute("web-class","blocklyFlyoutHeading"),s}function d(e,t,i,n){const s=p(e,void 0,t);return s.setAttribute("web-class","blocklyFlyoutGroup"),s.setAttribute("web-line","1.5"),i&&s.setAttribute("web-line-width",i),n&&(s.setAttribute("web-help-button","true"),s.setAttribute("callbackKey",n)),s}function p(e,t,i,s){let o=n.utils.xml.createElement("label");return o.setAttribute("text",e),t&&o.setAttribute("web-icon-color",pxt.toolbox.convertColor(t)),i&&(1===i.length?(o.setAttribute("web-icon",i),s&&o.setAttribute("web-icon-class",s)):o.setAttribute("web-icon-class",`blocklyFlyoutIcon${e}`)),o}function g(e,t,i,n=!1,s=0){var a,u;let h,d;if(t.attributes.toolboxParent){const i=e.blocksById[t.attributes.toolboxParent];if(i){const s=pxt.blocks.compileInfo(i);if(h=g(e,i,s,n),t.attributes.toolboxParentArgument)!(d=h.querySelector(`value[name=${t.attributes.toolboxParentArgument}]`))&&s.parameters.some((e=>e.definitionName===t.attributes.toolboxParentArgument))&&((d=document.createElement("value")).setAttribute("name",t.attributes.toolboxParentArgument),h.appendChild(d));else if(!(d=h.querySelector("value")))for(const e of s.parameters)if(!h.querySelector(`field[name=${e.definitionName}]`)){(d=document.createElement("value")).setAttribute("name",e.definitionName),h.appendChild(d);break}if(d)for(;d.firstChild;)d.removeChild(d.firstChild);else h=void 0}}let p=document.createElement(h||n?"shadow":"block");if(p.setAttribute("type",t.attributes.blockId),t.attributes.blockGap?p.setAttribute("gap",t.attributes.blockGap):pxt.appTarget.appTheme&&pxt.appTarget.appTheme.defaultBlockGap&&p.setAttribute("gap",pxt.appTarget.appTheme.defaultBlockGap.toString()),i.thisParameter){const t=i.thisParameter,o=!!(null===(a=e.apis.byQName[t.type])||void 0===a?void 0:a.attributes.fixedInstances);let r=t.shadowBlockId,l=t.defaultValue;o||r&&"variables_get"!==r||(r="variables_get",l=l||t.definitionName);const u=c(e,t,r,l,n,s);u&&p.appendChild(u)}if("ENUM_GET"===t.attributes.shim||"KIND_GET"===t.attributes.shim){if(null===(u=t.parameters)||void 0===u?void 0:u.length){const e=t.parameters[0].default;if(e){const t=document.createElement("field");t.setAttribute("name","MEMBER"),t.textContent=e,p.appendChild(t)}}}else t.parameters&&(i.parameters.filter((e=>r.test(e.type)||r.test(l(e.type))||e.shadowBlockId||e.defaultValue)).forEach((t=>{const i=c(e,t,void 0,void 0,n,s);i&&p.appendChild(i)})),t.attributes.draggableParameters?i.handlerArgs.forEach((e=>{const i="reporter"===t.attributes.draggableParameters,n=document.createElement("value");n.setAttribute("name","HANDLER_DRAG_PARAM_"+e.name);const s=i?pxt.blocks.reporterTypeForArgType(e.type):"variables_get_reporter",r=document.createElement("block");r.setAttribute("type",s);const a=document.createElement("mutation");r.appendChild(a),a.setAttribute(o.DUPLICATE_ON_DRAG_MUTATION_KEY,"true"),i&&"argument_reporter_custom"===s&&a.setAttribute("typename",e.type);const l=document.createElement("field");l.setAttribute("name",i?"VALUE":"VAR"),l.textContent=pxt.Util.htmlEscape(e.name),r.appendChild(l),n.appendChild(r),p.appendChild(n)})):i.handlerArgs.forEach((e=>{const t=document.createElement("field");t.setAttribute("name","HANDLER_"+e.name),t.textContent=e.name,p.appendChild(t)})));return h?(d.appendChild(p),h):p}function m(e,t,i,n){const s=document.createElement(n?"shadow":"block");s.setAttribute("type",pxt.Util.htmlEscape(e));const o=document.createElement("field");return o.setAttribute("name",pxt.Util.htmlEscape(t)),o.textContent=pxt.Util.htmlEscape(i),s.appendChild(o),s}function f(){const e=document.createElement("block");e.setAttribute("type","function_return");const t=document.createElement("value");t.setAttribute("name","RETURN_VALUE"),e.appendChild(t);const i=m("math_number","NUM","0",!0);return t.appendChild(i),e}i.isArrayType=l,i.createShadowValue=c,i.createFlyoutHeadingLabel=h,i.createFlyoutGroupLabel=d,i.createFlyoutButton=function(e,t){let i=n.utils.xml.createElement("button");return i.setAttribute("text",t),i.setAttribute("callbackKey",e),i},i.createFlyoutGap=function(e){const t=n.utils.xml.createElement("sep");return t.setAttribute("gap",e+""),t},i.createToolboxBlock=g,i.mkPredicateBlock=function(e){const t=document.createElement("block");t.setAttribute("type",e);const i=document.createElement("value");i.setAttribute("name","PREDICATE"),t.appendChild(i);const n=m("logic_boolean","BOOL","TRUE",!0);return i.appendChild(n),t},i.mkFieldBlock=m,i.mkVariableFieldBlock=function(e,t,i,n,s){const o=document.createElement(s?"shadow":"block");o.setAttribute("type",pxt.Util.htmlEscape(e));const r=document.createElement("field");return r.setAttribute("name","VAR"),r.id=t,r.setAttribute("variabletype",pxt.Util.htmlEscape(i)),r.textContent=pxt.Util.htmlEscape(n),o.appendChild(r),o},i.mkReturnStatementBlock=f,i.createFunctionsFlyoutCategory=function(e){const t=(0,s.flyoutCategory)(e);if(t.length>1){let e=f();t.splice(1,0,d(lf("Your Functions"))),t.splice(1,0,e)}const i=(0,s.getAllFunctionDefinitionBlocks)(e).filter((e=>e.getDescendants(!1).some((e=>"function_return"===e.type&&e.getInputTargetBlock("RETURN_VALUE"))))).map((e=>e.getField("function_name").getText())),n=h(lf("Functions"),pxt.toolbox.getNamespaceColor("functions"),pxt.toolbox.getNamespaceIcon("functions"),"blocklyFlyoutIconfunctions");t.unshift(n);const o=[];for(const e of t)if(o.push(e),"function_call"===e.getAttribute("type")){const t=e.children.item(0);if(t){const n=t.getAttribute("name");if(i.some((e=>e===n))){const t=e.cloneNode(!0);t.setAttribute("type","function_call_output"),o.push(t)}}}return o}},{"./plugins/duplicateOnDrag":84,"./plugins/functions":99,blockly:207}],128:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PxtWorkspaceSearch=void 0;const n=e("blockly"),s=e("@blockly/plugin-workspace-search");class o extends s.WorkspaceSearch{constructor(e){super(e),this.injectionDiv=e.getInjectionDiv()}highlightSearchGroup(e){e.forEach((e=>{const t=e.pathObject.svgPath;n.utils.dom.addClass(t,"blockly-ws-search-highlight-pxt")}))}unhighlightSearchGroup(e){e.forEach((e=>{const t=e.pathObject.svgPath;n.utils.dom.removeClass(t,"blockly-ws-search-highlight-pxt")}))}open(){super.open(),n.utils.dom.addClass(this.injectionDiv,"blockly-ws-searching")}close(){super.close(),n.utils.dom.removeClass(this.injectionDiv,"blockly-ws-searching")}}i.PxtWorkspaceSearch=o,n.Css.register("\n.blockly-ws-search button {\n    padding-left: 6px;\n    padding-right: 6px;\n}")},{"@blockly/plugin-workspace-search":200,blockly:207}],129:[function(e,t,i){"use strict";function n(e,t,i,n){return pxt.Util.toArray(e.getElementsByTagName(t)).filter((e=>e.getAttribute(i)===n))}Object.defineProperty(i,"__esModule",{value:!0}),i.cleanOuterHTML=i.getDirectChildren=i.getFirstChildWithAttr=i.getChildrenWithAttr=i.getBlocksWithType=void 0,i.getBlocksWithType=function(e,t){return n(e,"block","type",t).concat(n(e,"shadow","type",t))},i.getChildrenWithAttr=n,i.getFirstChildWithAttr=function(e,t,i,s){const o=n(e,t,i,s);return o.length?o[0]:void 0},i.getDirectChildren=function(e,t){const i=[];for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes.item(n);s.tagName===t&&i.push(s)}return i},i.cleanOuterHTML=function(e){return e.outerHTML.replace(/^<\?[^>]*>/,"")}},{}],130:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.IFrameEmbeddedClient=void 0;i.IFrameEmbeddedClient=class{constructor(e){this.messageHandler=e,this.onMessageReceived=e=>{const t=e.data;if(t){if("iframeclientsetmessageport"===t.type)return this.port=e.ports[0],this.port.onmessage=this.onMessageReceived,void this.postMessage({type:"iframeclientsetmessageport"});if("iframeclientready"===t.type)return void this.sendReadyMessage()}this.messageHandler(e)},this.frameId=function(){const e=/frameid=([a-zA-Z0-9\-]+)/i.exec(window.location.href);if(e)return e[1]}(),window.addEventListener("message",this.onMessageReceived),this.sendReadyMessage()}dispose(){window.removeEventListener("message",this.onMessageReceived),this.port&&this.port.close()}postMessage(e){this.postMessageCore(e)}postMessageCore(e){this.frameId&&(e.frameId=this.frameId),this.port?this.port.postMessage(e):window.acquireVsCodeApi?window.acquireVsCodeApi().postMessage(e):window.parent&&window.parent!==window&&window.parent.postMessage(e,"*")}sendReadyMessage(){this.postMessage({type:"iframeclientready"})}}},{}],131:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Button=void 0;const n=e("react/jsx-runtime"),s=e("../util");i.Button=e=>{const{id:t,className:i,style:o,ariaLabel:r,ariaHidden:a,ariaDescribedBy:l,ariaControls:c,ariaExpanded:u,ariaHasPopup:h,ariaPosInSet:d,ariaSetSize:p,ariaSelected:g,ariaPressed:m,role:f,onClick:_,onKeydown:T,onBlur:E,buttonRef:b,title:I,label:y,labelClassName:v,leftIcon:C,rightIcon:k,hardDisabled:O,href:N,target:A,tabIndex:S,children:R}=e;let{disabled:w}=e;w=w||O;const L=(0,s.classList)("common-button",i,w&&"disabled");return(0,n.jsxs)("button",Object.assign({id:t,className:L,style:o,title:I,ref:b,onClick:w?void 0:e=>{_&&_(),N&&window.open(N,A||"_blank","noopener,noreferrer"),e.stopPropagation(),e.preventDefault()},onKeyDown:T||s.fireClickOnEnter,onBlur:E,role:f||"button",tabIndex:S||(w?-1:0),disabled:O,"aria-label":r,"aria-hidden":a,"aria-controls":c,"aria-expanded":u,"aria-haspopup":h,"aria-posinset":d,"aria-setsize":p,"aria-describedby":l,"aria-selected":g,"aria-pressed":m},{children:[(C||k||y)&&(0,n.jsxs)("span",Object.assign({className:"common-button-flex"},{children:[C&&(0,n.jsx)("i",{className:C,"aria-hidden":!0}),(0,n.jsx)("span",Object.assign({className:(0,s.classList)("common-button-label",v)},{children:y})),k&&(0,n.jsx)("i",{className:"right "+k,"aria-hidden":!0})]})),R]}))}},{"../util":139,"react/jsx-runtime":256}],132:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Checkbox=void 0;const n=e("react/jsx-runtime"),s=e("../util");i.Checkbox=e=>{const{id:t,className:i,ariaHidden:o,ariaLabel:r,role:a,isChecked:l,onChange:c,label:u}=e;return(0,n.jsxs)("div",Object.assign({className:(0,s.classList)("common-checkbox",i)},{children:[(0,n.jsx)("input",{id:t,tabIndex:0,type:"checkbox",checked:l,onChange:()=>{c(!l)},onKeyDown:s.fireClickOnEnter,role:a,"aria-hidden":o,"aria-label":r}),u&&(0,n.jsx)("label",Object.assign({htmlFor:t},{children:u}))]}))}},{"../util":139,"react/jsx-runtime":256}],133:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Dropdown=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("../util"),r=e("./Button"),a=e("./FocusList");i.Dropdown=e=>{const{id:t,className:i,ariaHidden:l,ariaLabel:c,role:u,items:h,tabIndex:d,selectedId:p,onItemSelected:g}=e,[m,f]=s.useState(!1);let _;const T=(0,o.classList)("common-dropdown",i),E=h.find((e=>e.id===p))||h[0];return(0,n.jsxs)("div",Object.assign({className:T,ref:e=>{e&&(_=e)},onBlur:e=>{_&&m&&!_.contains(e.relatedTarget)&&f(!1)}},{children:[(0,n.jsx)(r.Button,Object.assign({},E,{id:t,tabIndex:d,rightIcon:m?"fas fa-chevron-up":"fas fa-chevron-down",role:u,className:(0,o.classList)("common-dropdown-button",m&&"expanded",E.className),onClick:()=>{f(!m)},onKeydown:e=>{const t=h.indexOf(E);"ArrowDown"===e.key?t<h.length-1&&(g(h[t+1].id),e.preventDefault(),e.stopPropagation()):"ArrowUp"===e.key?t>0&&(g(h[t-1].id),e.preventDefault(),e.stopPropagation()):"Enter"===e.key&&(f(!0),e.preventDefault(),e.stopPropagation())},ariaHasPopup:"listbox",ariaExpanded:m,ariaLabel:c,ariaHidden:l})),m&&(0,n.jsx)(a.FocusList,Object.assign({role:"listbox",className:"common-menu-dropdown-pane common-dropdown-shadow",childTabStopId:p,"aria-labelledby":t,useUpAndDownArrowKeys:!0,onItemReceivedFocus:e=>{e.id&&h.some((t=>t.id===e.id))&&g(e.id)}},{children:(0,n.jsx)("ul",Object.assign({role:"presentation"},{children:h.map((e=>(0,n.jsx)("li",Object.assign({role:"presentation"},{children:(0,n.jsx)(r.Button,Object.assign({},e,{className:(0,o.classList)("common-dropdown-item",e.className),onClick:()=>{f(!1),g(e.id)},ariaSelected:e.id===p,role:"option"}))}),e.id)))}))}))]}))}},{"../util":139,"./Button":131,"./FocusList":135,react:255,"react/jsx-runtime":256}],134:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EditorToggle=void 0;const n=e("react/jsx-runtime"),s=e("../util"),o=e("./Button"),r=e("./FocusList"),a=e("./MenuDropdown");i.EditorToggle=e=>{const{id:t,className:i,ariaHidden:o,ariaLabel:r,role:h,items:d,selected:p}=e,g=d.some((e=>u(e))),m=e=>{};return(0,n.jsxs)("div",Object.assign({className:"common-editor-toggle-outer"},{children:[(0,n.jsx)(c,Object.assign({},e)),(0,n.jsxs)("div",Object.assign({id:t,className:(0,s.classList)("common-editor-toggle",g&&"has-dropdown",i),role:h||"tablist","aria-hidden":!0,"aria-label":r},{children:[d.map(((e,t)=>{const i=p===t;return(0,n.jsxs)("div",Object.assign({className:(0,s.classList)("common-editor-toggle-item",i&&"selected",u(e)&&"common-editor-toggle-item-dropdown")},{children:[(0,n.jsx)(l,{item:e,isSelected:i,onKeydown:m}),u(e)&&(0,n.jsx)(a.MenuDropdown,{id:"toggle-dropdown",className:"toggle-dropdown",icon:"fas fa-chevron-down",title:lf("More options"),tabIndex:-1,ariaHidden:!0,items:e.items.map((e=>({title:e.title,label:e.label,onClick:e.onClick,leftIcon:e.icon})))})]}),t)})),(0,n.jsx)("div",{className:"common-editor-toggle-handle","aria-hidden":!0})]}))]}))};const l=e=>{const{item:t,isSelected:i,onKeydown:s}=e,{label:r,title:a,onClick:l,icon:c,focusable:u}=t;return(0,n.jsx)(o.Button,{className:c?void 0:"no-icon",role:u?"tab":void 0,tabIndex:-1,onKeydown:s,label:r,title:a,onClick:l,leftIcon:c,ariaHidden:!0})},c=e=>{const{items:t,id:i,selected:s,ariaHidden:a}=e,l=t.reduce(((e,t,i)=>{const n=[...e];return n.push(Object.assign({},t)),n[n.length-1].selected=s===i,u(t)&&n.push(...t.items.filter((e=>e.focusable))),n}),[]);return(0,n.jsx)(r.FocusList,Object.assign({id:i,role:"tablist",className:"common-toggle-accessibility",childTabStopId:i+"-selected"},{children:l.map(((e,t)=>(0,n.jsx)(o.Button,{className:e.selected?"selected":void 0,id:e.selected?i+"-selected":void 0,role:"tab",title:e.title,label:e.label,onClick:e.onClick,ariaSelected:e.selected,ariaHidden:a},t)))}))};function u(e){var t;return!!(null===(t=e.items)||void 0===t?void 0:t.length)}},{"../util":139,"./Button":131,"./FocusList":135,"./MenuDropdown":138,"react/jsx-runtime":256}],135:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FocusList=void 0;const n=e("react/jsx-runtime"),s=e("../util");i.FocusList=e=>{const{id:t,className:i,role:o,ariaHidden:r,ariaLabel:a,childTabStopId:l,children:c,onItemReceivedFocus:u,useUpAndDownArrowKeys:h}=e;let d,p;const g=e=>"true"===e.getAttribute("data-isfocusable")&&"none"!==getComputedStyle(e).display;return(0,n.jsx)("div",Object.assign({id:t,className:i,role:o,tabIndex:l?void 0:0,onKeyDown:e=>{if(!(null==d?void 0:d.length))return;const t=document.activeElement,i=d.indexOf(t),n=e=>{e.focus(),u&&u(e)};-1===i&&t!==p||("Enter"===e.key||" "===e.key?(e.preventDefault(),e.stopPropagation(),t.click?t.click():t.dispatchEvent(new Event("click"))):e.key===(h?"ArrowDown":"ArrowRight")?(i===d.length-1||t===p?n((0,s.findNextFocusableElement)(d,i,0,!0,g)):n((0,s.findNextFocusableElement)(d,i,i+1,!0,g)),e.preventDefault(),e.stopPropagation()):e.key===(h?"ArrowUp":"ArrowLeft")?(n(0===i||t===p?(0,s.findNextFocusableElement)(d,i,d.length-1,!1,g):(0,s.findNextFocusableElement)(d,i,i-1,!1,g)),e.preventDefault(),e.stopPropagation()):"Home"===e.key?(n((0,s.findNextFocusableElement)(d,i,0,!0,g)),e.preventDefault(),e.stopPropagation()):"End"===e.key&&(n((0,s.findNextFocusableElement)(d,i,d.length-1,!0,g)),e.preventDefault(),e.stopPropagation()))},ref:e=>{if(!e||p)return;p=e;const t=e.querySelectorAll('[tabindex]:not([tabindex="-1"]),[data-isfocusable]');d=[];for(const e of t.values())d.push(e),e.setAttribute("tabindex","-1"),e.setAttribute("data-isfocusable","true");if(l){const e=p.querySelector("#"+l);e&&e.setAttribute("tabindex","0")}},"aria-hidden":r,"aria-label":a},{children:c}))}},{"../util":139,"react/jsx-runtime":256}],136:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FocusTrap=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("../util");i.FocusTrap=e=>{const{children:t,id:i,className:r,onEscape:a,arrowKeyNavigation:l,dontStealFocus:c,includeOutsideTabOrder:u,dontRestoreFocus:h}=e;let d;const p=s.useRef(document.activeElement),[g,m]=s.useState(!1);s.useEffect((()=>()=>{!h&&p.current&&(0,o.focusLastActive)(p.current)}),[]);const f=()=>(0,o.nodeListToArray)(u?d.querySelectorAll("[tabindex]"):d.querySelectorAll('[tabindex]:not([tabindex="-1"])'));return(0,n.jsx)("div",Object.assign({id:i,className:(0,o.classList)("common-focus-trap",r),ref:e=>{e&&(d=e,c||g||e.contains(document.activeElement)||!f().length||(d.focus(),m(!0)))},onKeyDown:e=>{if(!d)return;const t=(t,i)=>{const n=f();if(!n.length)return;const s=n.indexOf(e.target);t?i?(0,o.findNextFocusableElement)(n,s,n.length-1,t).focus():s===n.length-1?(0,o.findNextFocusableElement)(n,s,0,t).focus():(0,o.findNextFocusableElement)(n,s,s+1,t).focus():i?(0,o.findNextFocusableElement)(n,s,0,t).focus():0===s?(0,o.findNextFocusableElement)(n,s,n.length-1,t).focus():(0,o.findNextFocusableElement)(n,s,Math.max(s-1,0),t).focus(),e.preventDefault(),e.stopPropagation()};"Escape"===e.key?(a(),e.preventDefault(),e.stopPropagation()):"Tab"===e.key?e.shiftKey?t(!1,!1):t(!0,!1):l&&("ArrowDown"===e.key?t(!0,!1):"ArrowUp"===e.key?t(!1,!1):"Home"===e.key?t(!1,!0):"End"===e.key&&t(!0,!0))},tabIndex:-1},{children:t}))}},{"../util":139,react:255,"react/jsx-runtime":256}],137:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Input=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("../util"),r=e("./Button"),a=e("./FocusList");i.Input=e=>{var t;const{id:i,className:l,inputClassName:c,groupClassName:u,role:h,ariaHidden:d,ariaLabel:p,initialValue:g,label:m,title:f,placeholder:_,icon:T,iconTitle:E,disabled:b,type:I,readOnly:y,autoComplete:v,selectOnClick:C,onChange:k,onEnterKey:O,onIconClick:N,onFocus:A,onBlur:S,onOptionSelected:R,handleInputRef:w,preserveValueOnBlur:L,options:x}=e,[$,D]=s.useState(g||""),[M,P]=s.useState(!1),[B]=s.useState(e.filter?new RegExp(e.filter):void 0);let F;const U=e=>e&&-1!=Object.values(x).indexOf(e)?`dropdown-item-${e}`:void 0;return(0,n.jsxs)("div",Object.assign({className:(0,o.classList)("common-input-wrapper",b&&"disabled",l),onBlur:e=>{M&&!F.contains(e.relatedTarget)&&P(!1)},ref:e=>{e&&(F=e)}},{children:[m&&(0,n.jsx)("label",Object.assign({className:"common-input-label",htmlFor:i},{children:m})),(0,n.jsxs)("div",Object.assign({className:(0,o.classList)("common-input-group",u)},{children:[(0,n.jsx)("input",{id:i,className:(0,o.classList)("common-input",T&&"has-icon",c),title:f,role:h||"textbox",tabIndex:b?-1:0,"aria-label":p,"aria-hidden":d,type:I||"text",placeholder:_,value:$,readOnly:!!y,onClick:e=>{C&&e.target.select(),x&&!M&&P(!0)},onChange:e=>{var t;let i=e.target.value;i&&B&&(i=(null===(t=i.match(B))||void 0===t?void 0:t.join(""))||""),y||$===i||D(i),k&&k(i)},onKeyDown:t=>{var i,n;const s="number"==typeof t.which?t.which:t.keyCode;if(13===s||e.treatSpaceAsEnter&&32===s)O&&(t.preventDefault(),O($));else if(x&&M&&"ArrowDown"===t.key)null===(i=document.getElementById(U(Object.values(x)[0])))||void 0===i||i.focus(),t.preventDefault(),t.stopPropagation();else if(x&&M&&"ArrowUp"===t.key){const e=Object.values(x);null===(n=document.getElementById(U(e[e.length-1])))||void 0===n||n.focus(),t.preventDefault(),t.stopPropagation()}},onBlur:()=>{S&&S($),L||D(void 0)},onFocus:()=>{A&&A($)},autoComplete:v?"":"off",autoCorrect:v?"":"off",autoCapitalize:v?"":"off",spellCheck:v,disabled:b,ref:w}),T&&(N?(0,n.jsx)(r.Button,{leftIcon:T,title:E,disabled:b,onClick:()=>{N&&N($)}}):(0,n.jsx)("i",{className:T,"aria-hidden":!0})),x&&(0,n.jsx)(r.Button,{leftIcon:M?"fas fa-chevron-up":"fas fa-chevron-down",title:E,disabled:b,ariaHasPopup:"listbox",ariaExpanded:M,ariaLabel:p,onClick:()=>{x&&P(!M)}})]})),M&&(0,n.jsx)(a.FocusList,Object.assign({role:"listbox",className:"common-menu-dropdown-pane common-dropdown-shadow",childTabStopId:null!==(t=U($))&&void 0!==t?t:U(Object.values(x)[0]),"aria-labelledby":i,useUpAndDownArrowKeys:!0},{children:(0,n.jsx)("ul",Object.assign({role:"presentation"},{children:Object.keys(x).map((e=>(0,n.jsx)("li",Object.assign({role:"presentation"},{children:(0,n.jsx)(r.Button,{title:e,label:e,id:U(x[e]),className:(0,o.classList)("common-dropdown-item"),onClick:()=>(e=>{var t;P(!1);const n=x[e];D(n),R&&R(n),null===(t=document.getElementById(i))||void 0===t||t.focus()})(e),ariaSelected:U(x[e])===U(null!=$?$:g),role:"option"})}),e)))}))}))]}))}},{"../util":139,"./Button":131,"./FocusList":135,react:255,"react/jsx-runtime":256}],138:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MenuDropdown=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("../util"),r=e("./Button"),a=e("./FocusTrap");i.MenuDropdown=e=>{const{id:t,className:i,ariaHidden:l,ariaLabel:c,role:u,items:h,label:d,title:p,icon:g,tabIndex:m,disabled:f}=e,[_,T]=s.useState(!1);let E,b;const I=(0,o.classList)("common-menu-dropdown",i),y=t+"-menu";return(0,n.jsxs)("div",Object.assign({className:I,ref:e=>{e&&(E=e)},onBlur:e=>{E&&_&&!E.contains(e.relatedTarget)&&T(!1)}},{children:[(0,n.jsx)(r.Button,{id:t,label:d,tabIndex:m,buttonRef:e=>{e&&(b=e)},title:p,leftIcon:g,role:u||"menuitem",className:(0,o.classList)("menu-button",_&&"expanded"),onClick:()=>{T(!_)},ariaHasPopup:"true",ariaExpanded:_,ariaControls:_?y:void 0,ariaLabel:c,ariaHidden:l,disabled:f}),_&&(0,n.jsx)("div",Object.assign({role:"menu",className:"common-menu-dropdown-pane",tabIndex:0,id:y,"aria-labelledby":t},{children:(0,n.jsx)(a.FocusTrap,Object.assign({arrowKeyNavigation:!0,onEscape:()=>{T(!1),b&&b.focus()}},{children:(0,n.jsx)("ul",Object.assign({role:"presentation"},{children:h.map(((e,t)=>(0,n.jsx)("li",Object.assign({role:"presentation"},{children:(0,n.jsx)(r.Button,Object.assign({},e,{className:(0,o.classList)("common-menu-dropdown-item",e.className),onClick:()=>{T(!1),e.onClick()},role:"menuitem",ariaPosInSet:t+1,ariaSetSize:h.length}))}),t)))}))}))}))]}))}},{"../util":139,"./Button":131,"./FocusTrap":136,react:255,"react/jsx-runtime":256}],139:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.focusLastActive=i.isFocusable=i.findNextFocusableElement=i.screenToSVGCoord=i.clientCoord=i.CheckboxStatus=i.nodeListToArray=i.classList=i.fireClickOnEnter=i.jsxLF=void 0;const n=e("react/jsx-runtime");var s;function o(e){return!!e&&("true"===e.getAttribute("data-isfocusable")||-1!==e.tabIndex)&&"none"!==getComputedStyle(e).display}i.jsxLF=function(e,...t){const i=[];e.replace(/\{\d\}/g,(e=>(i.push(parseInt(e.substr(1,1))),e)));const s=[];let o,r=0;for(const a of i)o=e.split(`{${a}}`),pxt.U.assert(2===o.length),s.push((0,n.jsx)("span",{children:o[0]},r++)),s.push((0,n.jsx)("span",{children:t[a]},r++)),e=o[1];return s.push((0,n.jsx)("span",{children:e},r++)),s},i.fireClickOnEnter=function(e){const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())},i.classList=function(...e){return e.filter((e=>"string"==typeof e)).reduce(((e,t)=>e.concat(t.split(" "))),[]).map((e=>e.trim())).filter((e=>!!e)).join(" ")},i.nodeListToArray=function(e){const t=[];for(const i of e)t.push(i);return t},(s=i.CheckboxStatus||(i.CheckboxStatus={}))[s.Selected=0]="Selected",s[s.Unselected=1]="Unselected",s[s.Waiting=2]="Waiting",i.clientCoord=function(e){if(e.touches){const t=e;return t.touches.length?t.touches[0]:t.changedTouches[0]}return e},i.screenToSVGCoord=function(e,t){const i=e.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i.matrixTransform(e.getScreenCTM().inverse())},i.findNextFocusableElement=function e(t,i,n,s,o){const r=s?1:-1,a=t[n];return i===n||(o?o(a):"none"!==getComputedStyle(a).display)?a:(n+r>=t.length?n=0:n+r<0?n=t.length-1:n+=r,e(t,i,n,s))},i.isFocusable=o,i.focusLastActive=function(e){for(;e&&!o(e);){const t=e.parentElement;if(!t)break;e=t}e.focus()}},{"react/jsx-runtime":256}],140:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetEditor=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-dom"),r=e("./components/ImageFieldEditor"),a=e("./components/ImageEditor/store/imageReducer"),l=e("../../pxtservices/iframeEmbeddedClient");document.addEventListener("DOMContentLoaded",(()=>{!function(){const e=document.getElementById("asset-editor-field-div");o.render((0,n.jsx)(c,{}),e)}()}));class c extends s.Component{constructor(e){super(e),this.handleMessage=e=>{const t=e.data;switch(t.type){case"create":this.setPalette(t.palette),this.initTilemapProject(t.files);const e=this.getEmptyAsset(t.assetType,t.displayName);this.setState({editing:e,isEmptyAsset:!0}),this.sendResponse({id:t.id,type:t.type});break;case"open":this.setPalette(t.palette),this.initTilemapProject(t.files);const i=this.lookupAsset(t.assetType,t.assetId);"tilemap"===i.type&&pxt.sprite.addMissingTilemapTilesAndReferences(this.editorProject,i),this.setState({editing:i}),this.sendResponse({id:t.id,type:t.type});break;case"duplicate":this.setPalette(t.palette),this.initTilemapProject(t.files);const n=this.lookupAsset(t.assetType,t.assetId);this.setState({editing:this.editorProject.duplicateAsset(n)}),this.sendResponse({id:t.id,type:t.type});break;case"save":this.sendResponse({id:t.id,type:t.type,files:this.saveProjectFiles()})}},this.refHandler=e=>{e&&(this.editor=e,this.editor.init(this.state.editing,(()=>{}),{galleryTiles:this.galleryTiles,hideMyAssets:!0,hideCloseButton:!0}))},this.handleKeydown=e=>{!e.ctrlKey||"s"!==e.key&&"S"!==e.key||this.sendSaveRequest()},this.pollForUpdates=()=>{this.state.editing&&this.updateAsset()},this.sendSaveRequest=()=>{this.sendEvent({type:"event",kind:"done-clicked"})},this.state={},pxt.react.getTilemapProject=()=>this.editorProject,(0,a.setTelemetryFunction)(u)}componentDidMount(){this.iframeClient=new l.IFrameEmbeddedClient(this.handleMessage),window.addEventListener("keydown",this.handleKeydown,null),this.sendEvent({type:"event",kind:"ready"}),u("asset-editor-shown"),this.pollingInterval=setInterval(this.pollForUpdates,200)}componentWillUnmount(){window.removeEventListener("message",this.handleMessage,null),window.removeEventListener("keydown",this.handleKeydown,null),window.clearInterval(this.pollingInterval)}componentDidUpdate(e,t,i){var n;(null==t?void 0:t.editing)&&t.editing!==this.state.editing&&this.saveProject.removeChangeListener(t.editing.type,this.sendSaveRequest),(null===(n=this.state)||void 0===n?void 0:n.editing)&&this.saveProject.addChangeListener(this.state.editing,this.sendSaveRequest)}render(){return this.state.editing?(0,n.jsx)(r.ImageFieldEditor,{ref:this.refHandler,singleFrame:"animation"!==this.state.editing.type,isMusicEditor:"song"===this.state.editing.type,doneButtonCallback:this.sendSaveRequest,hideDoneButton:!0,includeSpecialTagsInFilter:!0}):(0,n.jsx)("div",{})}sendResponse(e){this.postMessage(e)}sendEvent(e){this.postMessage(e)}postMessage(e){this.iframeClient.postMessage(e)}updateAsset(){var e,t,i,n,s;const o=this.editor.getValue(),r=pxt.cloneAsset(o);if(!this.lastValue||!pxt.assetEquals(this.lastValue,r)){if(this.lastValue=pxt.cloneAsset(o),"tilemap"===r.type&&o.type===r.type&&(r.data.deletedTiles=null===(e=o.data.deletedTiles)||void 0===e?void 0:e.slice(),r.data.editedTiles=null===(t=o.data.editedTiles)||void 0===t?void 0:t.slice(),r.data.projectReferences=null===(i=o.data.projectReferences)||void 0===i?void 0:i.slice(),r.data.tileOrder=null===(n=o.data.tileOrder)||void 0===n?void 0:n.slice()),this.saveProject=this.editorProject.clone(),this.state.isEmptyAsset){const e=null===(s=r.meta)||void 0===s?void 0:s.displayName;let t;switch(r.type){case"image":t=this.saveProject.createNewProjectImage(r.bitmap,e);break;case"tile":t=this.saveProject.createNewTile(r.bitmap,null,e);break;case"tilemap":pxt.sprite.updateTilemapReferencesFromResult(this.saveProject,r);const[i,n]=this.saveProject.createNewTilemapFromData(r.data,e);t=this.saveProject.lookupAssetByName("tilemap",i);break;case"animation":t=this.saveProject.createNewAnimationFromData(r.frames,r.interval,e);break;case"song":t=this.saveProject.createNewSong(r.song,e)}}else"tilemap"===r.type&&pxt.sprite.updateTilemapReferencesFromResult(this.saveProject,r),this.saveProject.updateAsset(r);this.sendSaveRequest()}}saveProjectFiles(){this.updateAsset();const e=pxt.inflateJRes(this.saveProject.getProjectAssetsJRes()),t=pxt.inflateJRes(this.saveProject.getProjectTilesetJRes()),i={};for(const t of Object.keys(e)){const n=this.locateFileForAsset(t)||pxt.IMAGES_JRES;i[n]||(i[n]={}),i[n][t]=e[t]}for(const e of Object.keys(t)){const n=this.locateFileForAsset(e)||pxt.TILEMAP_JRES;i[n]||(i[n]={}),i[n][e]=t[e]}const n=Object.assign({},this.files);for(const e of Object.keys(i)){n[e]=JSON.stringify(i[e],null,4);const t=e.substring(0,e.length-"jres".length)+"ts";(n[t]||e===pxt.IMAGES_JRES||e===pxt.TILEMAP_JRES)&&(n[t]=pxt.emitProjectImages(i[e])+"\n"+pxt.emitTilemapsFromJRes(i[e]))}return n}setPalette(e){e&&Array.isArray(e)&&e.length&&(pxt.appTarget.runtime.palette=e.slice())}initTilemapProject(e){var t;const i={},n={},s={},o={};this.editorProject=new pxt.TilemapProject,this.inflatedJres={},this.commentAttrs={};for(const t of Object.keys(e).filter((e=>!e.endsWith(".jres")))){const i=h(e[t]);for(const e of Object.keys(i))this.commentAttrs[e]=i[e]}for(const r of Object.keys(e).filter((e=>e.endsWith(".jres")))){const a=-1!==r.indexOf("pxt_modules")||-1!==r.indexOf("node_modules"),l=pxt.inflateJRes(JSON.parse(e[r]));this.inflatedJres[r]=l;for(const e of Object.keys(l)){if(null===(t=this.commentAttrs[e])||void 0===t?void 0:t.tags){const t=this.commentAttrs[e].tags.split(" ").filter((e=>!!e));t.length&&(l[e].tags=t)}l[e].mimeType===pxt.TILEMAP_MIME_TYPE||l[e].tilemapTile?a?n[e]=l[e]:i[e]=l[e]:a?o[e]=l[e]:s[e]=l[e]}}this.editorProject.loadAssetsJRes(o,!0),this.editorProject.loadAssetsJRes(s),this.editorProject.loadTilemapJRes(n,!1,!0),this.editorProject.loadTilemapJRes(i),this.galleryTiles=this.editorProject.getGalleryAssets("tile").map((e=>{var t;if(!this.commentAttrs[e.id])return;const i=null===(t=e.meta.tags)||void 0===t?void 0:t.map((e=>pxt.Util.startsWith(e,"category-")?e:e.toLowerCase()));return i&&-1!==i.indexOf("tile")?{qName:e.id,bitmap:e.bitmap,alt:e.id,tags:i}:void 0})).filter((e=>!!e)),this.saveProject=this.editorProject.clone()}locateFileForAsset(e){for(const t of Object.keys(this.inflatedJres))if(this.inflatedJres[t][e])return t}getEmptyAsset(e,t){const i=pxt.react.getTilemapProject(),n=t||pxt.getDefaultAssetDisplayName(e);let s=n,o=0;for(;i.isNameTaken(e,s);)s=n+o++;const r={type:e,id:"",internalID:0,meta:{displayName:s}};switch(e){case"image":case"tile":r.bitmap=new pxt.sprite.Bitmap(16,16).data();break;case"tilemap":const e=r;e.data=i.blankTilemap(16,16,16),pxt.sprite.addMissingTilemapTilesAndReferences(i,e);break;case"animation":const t=r;t.frames=[new pxt.sprite.Bitmap(16,16).data()],t.interval=200;break;case"song":r.song=pxt.assets.music.getEmptySong(2)}return r}lookupAsset(e,t){const i=this.saveProject.lookupAsset(e,t);if(i)return i;const n=t.split(".");return this.saveProject.lookupAsset(e,n[n.length-1])}}function u(e){pxt.tickEvent("asset.editor",{action:e})}function h(e){const t=e.split("\n"),i={};let n,s="";for(const e of t){const t=/^namespace\s+([^\}]+)\s+\{$/.exec(e);if(t){n=t[1],s="";continue}if(/^\s+\/\/%\s/.test(e)){s+=e+"\n";continue}const o=/^\s*export\s+const\s+([^\s]+)\s*=/.exec(e);o&&(i[n+"."+o[1]]=pxtc.parseCommentString(s),s="")}return i}i.AssetEditor=c},{"../../pxtservices/iframeEmbeddedClient":130,"./components/ImageEditor/store/imageReducer":160,"./components/ImageFieldEditor":166,react:255,"react-dom":223,"react/jsx-runtime":256}],141:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.assetToGalleryItem=i.getAssets=i.getNewInternalID=i.lookupAsset=i.createTile=i.createProjectImage=i.createNewImageAsset=i.isNameTaken=void 0;const n=e("../../pxtblocks");function s(e,t=new pxt.ImageConverter){var i;switch(e.type){case"image":case"tile":return e.previewURI=t.convert("data:image/x-mkcd-f,"+e.jresData),e;case"tilemap":let s=e.data.tilemap;return e.previewURI=n.tilemapToImageURI(e.data,Math.max(s.width,s.height),!1),e;case"animation":return(null===(i=e.frames)||void 0===i?void 0:i.length)<=0?null:(e.framePreviewURIs=e.frames.map((e=>t.convert("data:image/x-mkcd-f,"+pxt.sprite.base64EncodeBitmap(e)))),e.previewURI=e.framePreviewURIs[0],e);case"song":return e.previewURI=n.songToDataURI(e.song,32,32,!1,1),e}}function o(e){return function(t,i){const n=-1===e.indexOf(t.meta.package)?0:1,s=-1===e.indexOf(i.meta.package)?0:1;return n===s?function(e,t){return e.internalID-t.internalID}(t,i):n-s}}i.isNameTaken=function(e){return pxt.react.getTilemapProject().isNameTaken("image",e)},i.createNewImageAsset=function(e,t,i,n){const s=pxt.react.getTilemapProject();switch(e){case"tile":return s.createNewTile(new pxt.sprite.Bitmap(t,i).data(),null,n);case"image":return s.createNewImage(t,i)}return null},i.createProjectImage=function(e){return pxt.react.getTilemapProject().createNewProjectImage(e)},i.createTile=function(e,t,i){return pxt.react.getTilemapProject().createNewTile(e,t,i)},i.lookupAsset=function(e,t){return pxt.react.getTilemapProject().lookupAsset(e,t)},i.getNewInternalID=function(){return pxt.react.getTilemapProject().getNewInternalId()},i.getAssets=function(e=!1,t="image",i=[]){const n=pxt.react.getTilemapProject(),r=new pxt.ImageConverter,a=e=>s(e,r),l=e?n.getGalleryAssets.bind(n):n.getAssets.bind(n),c=function(){var e;const t=null===(e=pxt.appTarget.blocksprj)||void 0===e?void 0:e.config;if(t)return Object.keys(t.dependencies);return[]}(),u=l("image").map(a).sort(o(c)),h=l("tile").map(a).filter((e=>!e.id.match(/^myTiles.transparency(8|16|32)$/gi))).sort(o(c)),d=l("tilemap").map(a).sort(o(c)),p=l("animation").map(a).sort(o(c)),g=l("song").map(a).sort(o(c));for(const e of i)switch(e.type){case"image":u.push(a(e));break;case"tile":h.push(a(e));break;case"animation":p.push(a(e));break;case"tilemap":d.push(a(e));break;case"song":g.push(a(e))}let m=[];switch(t){case"image":m=u.concat(h).concat(p).concat(d).concat(g);break;case"tile":m=h.concat(u).concat(p).concat(d).concat(g);break;case"animation":m=p.concat(u).concat(h).concat(d).concat(g);break;case"tilemap":m=d.concat(h).concat(u).concat(p).concat(g);break;case"song":m=g.concat(u).concat(h).concat(p).concat(d)}return pxt.tickEvent(e?"assets.gallery":"assets.update",{count:m.length}),m},i.assetToGalleryItem=s},{"../../pxtblocks":68}],142:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FilterPanel=i.FilterPanelSubheading=i.FilterTag=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("../util");class r extends s.Component{constructor(e){super(e),this.clickHandler=this.clickHandler.bind(this)}render(){return(0,n.jsxs)("div",Object.assign({className:"filter-tag"},{children:[(0,n.jsx)("div",Object.assign({className:"filter-tag-box",role:"checkbox",onClick:this.clickHandler,onKeyDown:o.fireClickOnEnter,"aria-checked":this.props.selected},{children:(0,n.jsx)("i",{className:"icon square outline "+(this.props.selected?"check":"")})})),(0,n.jsx)("div",Object.assign({className:"filter-tag-name",role:"button",onClick:this.clickHandler,onKeyDown:o.fireClickOnEnter},{children:pxtc.U.rlf(this.props.tag)}))]}))}clickHandler(){this.props.onClickHandler(this.props.tag)}}i.FilterTag=r;class a extends s.Component{render(){return(0,n.jsxs)("div",Object.assign({className:"filter-subheading-row"},{children:[(0,n.jsx)("div",Object.assign({className:"filter-subheading-title"},{children:`${this.props.subheading}:`})),this.props.buttonText&&(0,n.jsx)("div",Object.assign({className:"filter-subheading-button",role:"button",style:this.props.buttonStyle,onClick:this.props.buttonAction,onKeyDown:o.fireClickOnEnter},{children:this.props.buttonText}))]}))}}i.FilterPanelSubheading=a;class l extends s.Component{isTagSelected(e){return this.props.enabledTags.indexOf(e.toLowerCase())>=0}render(){const e=this.props.tagOptions;return(0,n.jsxs)("div",Object.assign({className:"filter-panel"},{children:[(0,n.jsx)("div",Object.assign({className:"filter-title"},{children:lf("Filter")})),(0,n.jsx)(a,{subheading:lf("Categories"),buttonText:lf("Clear"),buttonAction:this.props.clearTags,buttonStyle:this.props.enabledTags.length>0?{color:"white"}:{}}),(0,n.jsx)("div",Object.assign({className:"filter-tag-list"},{children:e.map((e=>(0,n.jsx)(r,{tag:e,selected:this.isTagSelected(e),onClickHandler:this.props.tagClickHandler},e)))}))]}))}}i.FilterPanel=l},{"../util":189,react:255,"react/jsx-runtime":256}],143:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Alert=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-redux"),r=e("./actions/dispatch");class a extends s.Component{constructor(e){super(e)}render(){const{title:e,text:t,options:i,dispatchHideAlert:s}=this.props;return(0,n.jsx)("div",Object.assign({className:"image-editor-alert-container",role:"region",onClick:s},{children:(0,n.jsxs)("div",Object.assign({className:"image-editor-alert",role:"dialog"},{children:[(0,n.jsxs)("div",Object.assign({className:"title"},{children:[(0,n.jsx)("span",{className:"ms-Icon ms-Icon--Warning"}),(0,n.jsx)("span",{children:e}),(0,n.jsx)("span",{className:"ms-Icon ms-Icon--Cancel",role:"button",onClick:s})]})),(0,n.jsx)("div",Object.assign({className:"text"},{children:t})),i&&(0,n.jsx)("div",Object.assign({className:"options"},{children:i.map(((e,t)=>(0,n.jsx)("div",Object.assign({className:"button",role:"button",onClick:e.onClick},{children:e.label}),t)))}))]}))}))}}const l={dispatchHideAlert:r.dispatchHideAlert};i.Alert=(0,o.connect)((function({editor:e},t){return e?t:{}}),l)(a)},{"./actions/dispatch":156,react:255,"react-redux":241,"react/jsx-runtime":256}],144:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BottomBar=i.BottomBarImpl=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-redux"),r=e("./actions/dispatch"),a=e("./Button"),l=e("./util"),c=e("../../assets"),u=e("./keyboardShortcuts"),h=e("../../../../react-common/components/util");class d extends s.Component{constructor(e){super(e),this.disableShortcutsOnFocus=()=>{this.setShortcutsEnabled(!1)},this.handleWidthChange=e=>{const t=e.target.value,i=parseInt(t),{aspectRatioLocked:n,imageDimensions:s}=this.props;!isNaN(i)&&n?this.setState({width:i+"",height:Math.floor(i*(s[1]/s[0]))+""}):this.setState({width:t})},this.handleHeightChange=e=>{const t=e.target.value,i=parseInt(t),{aspectRatioLocked:n,imageDimensions:s}=this.props;!isNaN(i)&&n?this.setState({height:i+"",width:Math.floor(i*(s[0]/s[1]))+""}):this.setState({height:t})},this.handleDimensionalBlur=()=>{const{imageDimensions:e,isTilemap:t,dispatchChangeImageDimensions:i}=this.props,n=parseInt(this.state.width),s=parseInt(this.state.height),o=t?255:512,r=isNaN(n)?e[0]:Math.min(Math.max(n,1),o),a=isNaN(s)?e[1]:Math.min(Math.max(s,1),o);r===e[0]&&a===e[1]||i([r,a]),this.setState({width:null,height:null}),this.setShortcutsEnabled(!0)},this.handleDimensionalKeydown=e=>{13===("number"==typeof e.which?e.which:e.keyCode)&&e.currentTarget.blur()},this.handleAssetNameChange=e=>{let t=null;const i=e.target.value||"",n=i.trim();pxt.validateAssetName(n)?(0,c.isNameTaken)(n)&&n!==this.props.assetName&&(t=lf("This name is already used elsewhere in your project")):t=lf("Names may only contain letters, numbers, '-', '_', and space"),this.setState({assetName:i,assetNameMessage:t})},this.handleAssetNameBlur=()=>{const{dispatchChangeAssetName:e,assetName:t}=this.props;if(this.state.assetName){let i=this.state.assetName.trim();i!==t&&pxt.validateAssetName(i)&&!(0,c.isNameTaken)(i)&&e(i)}this.setState({assetName:null,assetNameMessage:null}),this.setShortcutsEnabled(!0)},this.zoomIn=()=>{this.props.dispatchChangeZoom(1)},this.zoomOut=()=>{this.props.dispatchChangeZoom(-1)},this.state={}}render(){const{imageDimensions:e,cursorLocation:t,hasUndo:i,hasRedo:s,dispatchUndoImageEdit:o,dispatchRedoImageEdit:r,aspectRatioLocked:c,onionSkinEnabled:u,dispatchToggleAspectRatioLocked:d,dispatchToggleOnionSkinEnabled:p,resizeDisabled:g,singleFrame:m,onDoneClick:f,assetName:_,hideDoneButton:T,hideAssetName:E}=this.props,{assetNameMessage:b}=this.state,I=null==this.state.width?e[0]:this.state.width,y=null==this.state.height?e[1]:this.state.height,v=null==this.state.assetName?_||"":this.state.assetName;return(0,n.jsxs)("div",Object.assign({className:"image-editor-bottombar"},{children:[!g&&(0,n.jsxs)("div",Object.assign({className:"image-editor-resize"},{children:[(0,n.jsx)("input",{className:"image-editor-input",title:lf("Image Width"),value:I,tabIndex:0,onChange:this.handleWidthChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown}),(0,n.jsx)(a.IconButton,{onClick:d,iconClass:c?"ms-Icon ms-Icon--Lock":"ms-Icon ms-Icon--Unlock",title:c?lf("Unlock Aspect Ratio"):lf("Lock Aspect Ratio"),toggle:!c,noTab:!0}),(0,n.jsx)("input",{className:"image-editor-input",title:lf("Image Height"),value:y,tabIndex:0,onChange:this.handleHeightChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown})]})),!m&&(0,n.jsx)("div",{className:"image-editor-seperator"}),!m&&(0,n.jsx)("div",{children:(0,n.jsx)(a.IconButton,{onClick:p,iconClass:"ms-Icon ms-Icon--MapLayers",title:u?lf("Hide Previous Frame"):lf("Show Previous Frame"),toggle:!u})}),!g&&(0,n.jsx)("div",{className:(0,h.classList)("image-editor-seperator",!t&&"transparent")}),(0,n.jsx)("div",Object.assign({className:"image-editor-coordinate-preview"},{children:t&&`${t[0]}, ${t[1]}`})),(0,n.jsx)("div",Object.assign({className:"image-editor-change-name"},{children:!E&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("input",{className:"image-editor-input",title:lf("Asset Name"),value:v,placeholder:lf("Asset Name"),tabIndex:0,onChange:this.handleAssetNameChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleAssetNameBlur,onKeyDown:this.handleDimensionalKeydown}),b&&(0,n.jsx)("div",Object.assign({className:"ui pointing below red basic label"},{children:b}))]})})),(0,n.jsxs)("div",Object.assign({className:"image-editor-undo-redo"},{children:[(0,n.jsx)(a.IconButton,{title:lf("Undo"),iconClass:"ms-Icon ms-Icon--Undo",onClick:i?o:null,disabled:!i}),(0,n.jsx)(a.IconButton,{title:lf("Redo"),iconClass:"ms-Icon ms-Icon--Redo",onClick:s?r:null,disabled:!s})]})),(0,n.jsx)("div",{className:"image-editor-seperator"}),(0,n.jsxs)("div",Object.assign({className:"image-editor-zoom-controls"},{children:[(0,n.jsx)(a.IconButton,{onClick:this.zoomOut,iconClass:"ms-Icon ms-Icon--ZoomOut",title:lf("Zoom Out"),toggle:!0}),(0,n.jsx)(a.IconButton,{onClick:this.zoomIn,iconClass:"ms-Icon ms-Icon--ZoomIn",title:lf("Zoom In"),toggle:!0})]})),!T&&(0,n.jsx)("div",Object.assign({role:"button",className:"image-editor-confirm",title:lf("Done"),tabIndex:0,onClick:f,onKeyDown:l.fireClickOnlyOnEnter},{children:lf("Done")}))]}))}setShortcutsEnabled(e){e&&this.shortcutLock?((0,u.releaseShortcutLock)(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=(0,u.obtainShortcutLock)())}}i.BottomBarImpl=d;const p={dispatchChangeImageDimensions:r.dispatchChangeImageDimensions,dispatchUndoImageEdit:r.dispatchUndoImageEdit,dispatchRedoImageEdit:r.dispatchRedoImageEdit,dispatchToggleAspectRatioLocked:r.dispatchToggleAspectRatioLocked,dispatchToggleOnionSkinEnabled:r.dispatchToggleOnionSkinEnabled,dispatchChangeZoom:r.dispatchChangeZoom,dispatchChangeAssetName:r.dispatchChangeAssetName};i.BottomBar=(0,o.connect)((function({store:{present:e,past:t,future:i},editor:n},s){var o,r,a;if(!e)return{};const l=n.isTilemap?e.tilemap.bitmap:e.frames[e.currentFrame].bitmap;return{imageDimensions:[l.width,l.height],aspectRatioLocked:e.aspectRatioLocked,onionSkinEnabled:n.onionSkinEnabled,cursorLocation:n.cursorLocation,resizeDisabled:"tile"===(null===(o=e.asset)||void 0===o?void 0:o.type),assetName:null===(a=null===(r=e.asset)||void 0===r?void 0:r.meta)||void 0===a?void 0:a.displayName,hasUndo:!!t.length,hasRedo:!!i.length,isTilemap:n.isTilemap}}),p)(d)},{"../../../../react-common/components/util":139,"../../assets":141,"./Button":145,"./actions/dispatch":156,"./keyboardShortcuts":158,"./util":165,react:255,"react-redux":241,"react/jsx-runtime":256}],145:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.IconButton=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("./util");class r extends s.Component{render(){const{title:e,iconClass:t,onClick:i,toggle:s,disabled:r,noTab:a}=this.props;return(0,n.jsx)("div",Object.assign({role:"button",className:`image-editor-button ${s?"toggle":""} ${r?"disabled":""}`,title:e,tabIndex:a||r?-1:0,onClick:i,onKeyDown:o.fireClickOnlyOnEnter},{children:(0,n.jsx)("span",{className:t})}))}}i.IconButton=r},{"./util":165,react:255,"react/jsx-runtime":256}],146:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CursorSizes=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("./actions/dispatch"),r=e("react-redux");class a extends s.Component{constructor(){super(...arguments),this.handlers=[]}render(){const{selected:e}=this.props;return(0,n.jsxs)("div",Object.assign({className:"cursor-buttons"},{children:[(0,n.jsx)("div",Object.assign({className:"cursor-button-outer "+(1===e?"selected":""),title:lf("Small Cursor (1px)"),role:"button",onClick:this.clickHandler(1)},{children:(0,n.jsx)("div",{className:"cursor-button small"})})),(0,n.jsx)("div",Object.assign({className:"cursor-button-outer "+(3===e?"selected":""),title:lf("Medium Cursor (3px)"),role:"button",onClick:this.clickHandler(3)},{children:(0,n.jsx)("div",{className:"cursor-button medium"})})),(0,n.jsx)("div",Object.assign({className:"cursor-button-outer "+(5===e?"selected":""),title:lf("Large Cursor (5px)"),role:"button",onClick:this.clickHandler(5)},{children:(0,n.jsx)("div",{className:"cursor-button large"})}))]}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>{const{dispatchChangeCursorSize:t}=this.props;t(e)}),this.handlers[e]}}const l={dispatchChangeCursorSize:o.dispatchChangeCursorSize};i.CursorSizes=(0,r.connect)((function({editor:e},t){return e?{selected:e.cursorSize}:{}}),l)(a)},{"./actions/dispatch":156,react:255,"react-redux":241,"react/jsx-runtime":256}],147:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Dropdown=void 0;const n=e("react/jsx-runtime"),s=e("react");class o extends s.Component{constructor(e){super(e),this.handlers=[],this.handleDropdownClick=()=>{this.setState({open:!this.state.open})},this.state={open:!1}}componentDidUpdate(){this.handlers=[]}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:t}=this.props,{open:i}=this.state,s=e[t];return(0,n.jsxs)("div",Object.assign({className:"image-editor-dropdown-outer"},{children:[(0,n.jsxs)("button",Object.assign({className:"image-editor-dropdown","aria-haspopup":"listbox",onClick:this.handleDropdownClick,tabIndex:-1},{children:[(null==s?void 0:s.text)||"",(0,n.jsx)("span",{className:"image-editor-dropdown-chevron ms-Icon ms-Icon--ChevronDown"})]})),(0,n.jsx)("ul",Object.assign({tabIndex:-1,role:"listbox","aria-activedescendant":null==s?void 0:s.id,className:i&&e.length?"":"hidden"},{children:e.map(((e,i)=>(0,n.jsx)("li",Object.assign({role:"option","aria-selected":i===t,className:i===t?"selected":"",onClick:this.clickHandler(i)},{children:e.text}),e.id)))}))]}))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:i}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(i[e],e)}}return this.handlers[e]}}i.Dropdown=o},{react:255,"react/jsx-runtime":256}],148:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageCanvas=i.ImageCanvasImpl=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-redux"),r=e("./store/imageReducer"),a=e("./actions/dispatch"),l=e("./util"),c=e("./toolDefinitions"),u=e("../../assets"),h=e("./keyboardShortcuts"),d=e("./ImageEditor"),p=[r.TileDrawingMode.Wall];class g extends s.Component{constructor(){super(...arguments),this.cursor=c.ToolCursor.Crosshair,this.zoom=2.5,this.panX=0,this.panY=0,this.hasInteracted=!1,this.tileCache={},this.onKeyDown=e=>{var t,i,n,s,o,a;if((0,h.areShortcutsEnabled)()){if(this.hasInteracted=!0,this.shouldHandleCanvasShortcut()&&(null===(i=null===(t=this.editState)||void 0===t?void 0:t.floating)||void 0===i?void 0:i.image)){let t=!1;switch(e.key){case"ArrowLeft":this.editState.layerOffsetX=Math.max(this.editState.layerOffsetX-1,-this.editState.floating.image.width),t=!0;break;case"ArrowUp":this.editState.layerOffsetY=Math.max(this.editState.layerOffsetY-1,-this.editState.floating.image.height),t=!0;break;case"ArrowRight":this.editState.layerOffsetX=Math.min(this.editState.layerOffsetX+1,this.editState.width),t=!0;break;case"ArrowDown":this.editState.layerOffsetY=Math.min(this.editState.layerOffsetY+1,this.editState.height),t=!0}t&&(this.props.dispatchImageEdit(this.editState.toImageState()),e.preventDefault())}if(!e.repeat){switch(!e.ctrlKey&&!e.metaKey||"c"!==e.key&&"v"!==e.key||e.stopPropagation(),(e.ctrlKey||e.metaKey)&&"a"===e.key&&this.shouldHandleCanvasShortcut()&&(this.selectAll(),e.preventDefault()),"Escape"==e.key&&(null===(s=null===(n=this.editState)||void 0===n?void 0:n.floating)||void 0===s?void 0:s.image)&&this.shouldHandleCanvasShortcut()&&(this.cancelSelection(),e.preventDefault()),("Backspace"===e.key||"Delete"===e.key)&&(null===(a=null===(o=this.editState)||void 0===o?void 0:o.floating)||void 0===a?void 0:a.image)&&this.shouldHandleCanvasShortcut()&&(this.deleteSelection(),e.preventDefault()),this.lastTool=this.props.tool,e.keyCode){case 18:this.props.dispatchChangeImageTool(r.ImageEditorTool.ColorSelect),e.preventDefault();break;case 32:this.props.dispatchChangeImageTool(r.ImageEditorTool.Pan);break;default:this.lastTool=null}this.updateCursor(!1,!1)}}},this.onKeyUp=e=>{null!=this.lastTool&&(this.props.dispatchChangeImageTool(this.lastTool),this.lastTool=null,this.updateCursor(!1,!1))},this.onCopy=e=>{var t,i;if(this.props.tool===r.ImageEditorTool.Marquee&&(null===(i=null===(t=this.editState)||void 0===t?void 0:t.floating)||void 0===i?void 0:i.image))if(e.preventDefault(),this.props.isTilemap)e.clipboardData.setData("application/makecode-tilemap",JSON.stringify((0,l.createTilemapPatchFromFloatingLayer)(this.editState,this.props.tilemapState.tileset)));else{const t=pxt.sprite.bitmapToImageLiteral(this.editState.floating.image,"typescript");e.clipboardData.setData("application/makecode-image",t),e.clipboardData.setData("text/plain",t)}},this.onPaste=e=>{if(this.props.isTilemap){const t=e.clipboardData.getData("application/makecode-tilemap");let i;try{i=JSON.parse(t)}catch(e){}if(!(i&&i.map&&i.layers&&i.tiles))return;return e.preventDefault(),void this.applyTilemapPatch(i)}let t=e.clipboardData.getData("application/makecode-image");if(!t){const i=e.clipboardData.getData("text/plain"),n=/img(`|\(""")[\s\da-f.#tngrpoyw]+(`|"""\))/im.exec(i);n&&(t=n[0])}const i=t&&pxt.sprite.imageLiteralToBitmap(t);i&&i.width&&i.height&&(e.preventDefault(),this.props.tool!==r.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(r.ImageEditorTool.Marquee),this.editState.mergeFloatingLayer(),this.editState.setFloatingLayer(i),this.props.dispatchImageEdit(this.editState.toImageState()))},this.preventContextMenu=e=>e.preventDefault()}render(){const e=this.getImageState(),t=!e||e.bitmap.height>e.bitmap.width,i=!this.props.isTilemap&&this.props.tool==r.ImageEditorTool.Marquee;return(0,n.jsx)("div",Object.assign({ref:"canvas-bounds",className:"image-editor-canvas "+(t?"portrait":"landscape"),onContextMenu:this.preventContextMenu,tabIndex:0},{children:(0,n.jsxs)("div",Object.assign({className:"paint-container"},{children:[!this.props.lightMode&&(0,n.jsx)("canvas",{ref:"paint-surface-bg",className:"paint-surface"}),(0,n.jsx)("canvas",{ref:"paint-surface",className:"paint-surface main"}),p.map(((e,t)=>(0,n.jsx)("canvas",{ref:`paint-surface-${e.toString()}`,className:"paint-surface overlay "+(this.props.overlayEnabled?"":"hide")},t))),(0,n.jsx)("div",{ref:"floating-layer-border",className:"image-editor-floating-layer"}),i&&(0,n.jsx)("div",{ref:"floating-layer-nw-corner",className:"image-editor-floating-layer-corner"}),i&&(0,n.jsx)("div",{ref:"floating-layer-ne-corner",className:"image-editor-floating-layer-corner"}),i&&(0,n.jsx)("div",{ref:"floating-layer-se-corner",className:"image-editor-floating-layer-corner"}),i&&(0,n.jsx)("div",{ref:"floating-layer-sw-corner",className:"image-editor-floating-layer-corner"})]}))}))}componentDidMount(){document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.tileCache={},this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.canvas=this.refs["paint-surface"],this.background=this.refs["paint-surface-bg"],this.floatingLayer=this.refs["floating-layer-border"],this.canvasLayers=p.map((e=>this.refs[`paint-surface-${e.toString()}`])),(0,l.bindGestureEvents)(this.refs["canvas-bounds"],this);const e=this.refs["canvas-bounds"];e.addEventListener("wheel",(e=>{this.hasInteracted=!0,this.updateZoom(e.deltaY/30,e.clientX,e.clientY),e.preventDefault()})),e.addEventListener("mousemove",(e=>{e.button||(this.hasHover=!0),this.edit||this.updateCursorLocation(e)})),e.addEventListener("mouseout",(e=>{this.edit||this.updateCursorLocation(null)})),document.addEventListener("keydown",this.onKeyDown,!0),document.addEventListener("keyup",this.onKeyUp),document.addEventListener("copy",this.onCopy),document.addEventListener("paste",this.onPaste);const t=this.getImageState();this.editState=(0,c.getEditState)(t,this.props.isTilemap,this.props.drawingMode),this.redraw(),this.updateBackground()}componentDidUpdate(){if(!this.edit||!this.editState){const e=this.getImageState();this.editState=(0,c.getEditState)(e,this.props.isTilemap,this.props.drawingMode)}if(this.props.isTilemap||(this.tileCache={}),this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.props.zoomDelta||0===this.props.zoomDelta)return 0===this.props.zoomDelta?this.hasInteracted||this.zoomToCanvas():(this.hasInteracted=!0,this.updateZoom(this.props.zoomDelta)),void this.props.dispatchChangeZoom(null);this.redraw(),this.updateBackground()}componentWillUnmount(){this.tileCache={},document.removeEventListener("keydown",this.onKeyDown,!0),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("copy",this.onCopy),document.removeEventListener("paste",this.onPaste)}onClick(e,t){var i,n;this.hasInteracted=!0,this.isPanning()||(document.activeElement instanceof HTMLElement&&document.activeElement!==this.refs["canvas-bounds"]&&document.activeElement.blur(),this.refs["canvas-bounds"].focus(),this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.inBounds(this.cursorLocation[0],this.cursorLocation[1])?(this.touchesResize(e.clientX,e.clientY)&&(this.isResizing=!0),this.startEdit(!!t),this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()):(null===(n=null===(i=this.editState)||void 0===i?void 0:i.floating)||void 0===n?void 0:n.image)&&(this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState()))))}onDragStart(e,t){this.hasInteracted=!0,this.touchesResize(e.clientX,e.clientY)&&(this.isResizing=!0),this.isPanning()?(this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1)):this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.startEdit(!!t))}onDragMove(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1);else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1])}}onDragEnd(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=void 0,this.lastPanY=void 0,this.updateCursor(!1,!1);else if(this.isResizing){if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit(!1),this.updateCursor(!1,!1)}else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()}this.isResizing=!1}updateCursorLocation(e){if(!e)return this.cursorLocation&&(this.cursorLocation=null,this.props.dispatchChangeCursorLocation(null),this.edit||this.redraw()),!1;if(this.canvas){const t=this.canvas.getBoundingClientRect(),i=Math.floor((e.clientX-t.left)/t.width*this.imageWidth),n=Math.floor((e.clientY-t.top)/t.height*this.imageHeight);return!(this.cursorLocation&&i===this.cursorLocation[0]&&n===this.cursorLocation[1]||(this.cursorLocation=[i,n,e.clientX,e.clientY],this.hasHover&&this.props.dispatchChangeCursorLocation(this.cursorLocation),this.edit||this.redraw(),this.updateCursor(!!this.edit,this.editState.inFloatingLayer(i,n)),0))}return this.cursorLocation=[0,0,e.clientX,e.clientY],!1}updateCursor(e,t){const{tool:i}=this.props,n=c.tools.find((e=>e.tool===i));n?t?e?this.updateCursorCore(n.downLayerCursor||n.hoverLayerCursor||n.downCursor||n.hoverCursor):this.updateCursorCore(n.hoverLayerCursor||n.hoverCursor):e?this.updateCursorCore(n.downCursor||n.hoverCursor):this.updateCursorCore(n.hoverCursor):this.updateCursorCore(c.ToolCursor.Default)}updateCursorCore(e){this.cursor=e||c.ToolCursor.Default,this.updateBackground()}startEdit(e){const{tool:t,toolWidth:i,selectedColor:n,backgroundColor:s,drawingMode:o}=this.props,[a,l]=this.cursorLocation;if(this.inBounds(a,l)||this.isResizing){let a=o==r.TileDrawingMode.Wall?2:e?s:n;this.edit=(0,c.getEdit)(t,this.editState,a,i),this.edit.originalImage=this.originalImage,this.edit.start(this.cursorLocation[0],this.cursorLocation[1],this.cursorLocation[2],this.cursorLocation[3],this.editState)}}updateEdit(e,t){this.edit&&(this.edit.inBounds(e,t)||this.isResizing)&&(this.edit.update(e,t),this.redraw())}commitEdit(e=!0){const{dispatchImageEdit:t}=this.props,i=this.getImageState();this.edit&&(this.editState=(0,c.getEditState)(i,this.props.isTilemap,this.props.drawingMode),this.edit.doEdit(this.editState),this.originalImage=e?void 0:this.edit.originalImage,this.edit=void 0,t(this.editState.toImageState()))}redraw(){const{prevFrame:e,onionSkinEnabled:t,selectedColor:i,toolWidth:n,drawingMode:s,tool:o}=this.props,a=this.getImageState(),l=s==r.TileDrawingMode.Wall?2:i;let u=!1;if(this.canvas){if(this.imageWidth=a.bitmap.width,this.imageHeight=a.bitmap.height,u=this.canvas.width!=a.bitmap.width*this.cellWidth||this.canvas.height!=a.bitmap.height*this.cellWidth,this.canvas.width=a.bitmap.width*this.cellWidth,this.canvas.height=a.bitmap.height*this.cellWidth,this.canvasLayers.forEach((e=>{e.width=this.canvas.width/this.cellWidth,e.height=this.canvas.height/this.cellWidth})),t&&e){const t=(0,c.getEditState)(e,this.props.isTilemap,s),i=this.canvas.getContext("2d");i.globalAlpha=.5,this.drawImage(t.image),t.floating&&t.floating.image&&this.drawImage(t.floating.image,t.layerOffsetX,t.layerOffsetY,!0),i.globalAlpha=1}if(this.edit){const i=this.editState.copy();i.setActiveLayer(s),this.edit.doEdit(i),this.drawImage(i.image,0,0,!(!t||!e)),this.drawOverlayLayers(i.overlayLayers),this.redrawFloatingLayer(i)}else if(this.drawImage(this.editState.image,0,0,!(!t||!e)),this.drawOverlayLayers(this.editState.overlayLayers),this.redrawFloatingLayer(this.editState),this.cursorLocation&&this.shouldDrawCursor()){const e=o===r.ImageEditorTool.Erase?0:l;this.drawCursor(this.cursorLocation[0]-(n>>1),this.cursorLocation[1]-(n>>1),n,e)}if(this.background&&(this.background.width!=this.canvas.width<<1||this.background.height!=this.canvas.height<<1)){this.background.width=this.canvas.width<<1,this.background.height=this.canvas.height<<1;const e=this.background.getContext("2d");e.imageSmoothingEnabled=!1,e.fillStyle="#aeaeae",e.fillRect(0,0,this.background.width,this.background.height),e.fillStyle="#dedede";const t=this.imageHeight<<1,i=this.imageWidth<<1;for(let n=0;n<i;n++)for(let i=0;i<t;i++)n+i&1&&e.fillRect(n*this.cellWidth,i*this.cellWidth,this.cellWidth,this.cellWidth)}}u&&this.zoomToCanvas()}drawImage(e,t=0,i=0,n=!1,s=!this.props.lightMode){this.props.isTilemap?this.drawTilemap(e,t,i,n,s):this.drawBitmap(e,t,i,n,s)}redrawFloatingLayer(e,t=!1){const i=this.refs["floating-layer-border"],n=this.refs["floating-layer-nw-corner"],s=this.refs["floating-layer-ne-corner"],o=this.refs["floating-layer-se-corner"],r=this.refs["floating-layer-sw-corner"],a=[n,s,o,r];if(e.floating&&e.floating.image){t||(this.drawImage(e.floating.image,e.layerOffsetX,e.layerOffsetY,!0),e.floating.overlayLayers&&this.drawOverlayLayers(e.floating.overlayLayers,e.layerOffsetX,e.layerOffsetY));const l=this.canvas.getBoundingClientRect(),c=Math.max(e.layerOffsetX,0),u=Math.max(e.layerOffsetY,0),h=Math.min(e.layerOffsetX+e.floating.image.width,e.width),d=Math.min(e.layerOffsetY+e.floating.image.height,e.height),p=l.width/e.width,g=l.height/e.height;i.style.display="",(h-c<1||d-u<1)&&(i.style.display="none");const m=-this.panX+p*c,f=-this.panY+g*u,_=p*(h-c),T=g*(d-u);if(i.style.left=m+"px",i.style.top=f+"px",i.style.width=_+"px",i.style.height=T+"px",i.style.borderLeft=e.layerOffsetX>=0?"":"none",i.style.borderTop=e.layerOffsetY>=0?"":"none",i.style.borderRight=e.layerOffsetX+e.floating.image.width<=e.width?"":"none",i.style.borderBottom=e.layerOffsetY+e.floating.image.height<=e.height?"":"none",null!=n){const e=16,t=3;this.props.isTilemap||(a.forEach((i=>{i.style.display="",i.style.width=e+"px",i.style.height=e+"px",i.style.border=t+"px solid black",i.style.position="absolute",i.style.backgroundColor="white"})),n.style.left=m-e+"px",n.style.top=f-e+"px",n.style.cursor="nw-resize",s.style.left=m+_+"px",s.style.top=f-e+"px",s.style.cursor="ne-resize",o.style.left=m+_+"px",o.style.top=f+T+"px",o.style.cursor="se-resize",r.style.left=m-e+"px",r.style.top=f+T+"px",r.style.cursor="sw-resize")}}else i.style.display="none",a.forEach((e=>{e&&(e.style.display="none")}))}drawOverlayLayers(e,t=0,i=0,n=!this.props.lightMode){e&&e.forEach(((e,s)=>{this.drawBitmap(e,t,i,!0,n,this.canvasLayers[s])}))}drawBitmap(e,t=0,i=0,n=!1,s=!this.props.lightMode,o=this.canvas){const{colors:r}=this.props,a=o.getContext("2d");a.imageSmoothingEnabled=!1;for(let s=0;s<e.width;s++)for(let o=0;o<e.height;o++){const l=e.get(s,o);l?(a.fillStyle=r[l],a.fillRect(s+t,o+i,1,1)):n||a.clearRect(s+t,o+i,1,1)}}generateTile(e,t){if(!t.tiles[e])return null;const i=document.createElement("canvas");return i.width=t.tileWidth,i.height=t.tileWidth,this.drawBitmap(pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap),0,0,!1,!this.props.lightMode,i),this.tileCache[t.tiles[e].id]=i,i}drawTilemap(e,t=0,i=0,n=!1,s=!this.props.lightMode,o=this.canvas){const{tilemapState:{tileset:r}}=this.props,a=o.getContext("2d");let l,c;this.tileCacheRevision!==this.props.tilesetRevision&&(this.tileCache={},this.tileCacheRevision=this.props.tilesetRevision),a.imageSmoothingEnabled=!1,a.fillStyle=d.LIGHT_MODE_TRANSPARENT;for(let o=0;o<e.width;o++)for(let u=0;u<e.height;u++)if((l=e.get(o,u))&&l<r.tiles.length){if((c=this.tileCache[r.tiles[l].id])||(c=this.generateTile(l,r)),!c)continue;a.drawImage(c,(o+t)*this.cellWidth,(u+i)*this.cellWidth)}else n||(s?a.clearRect((o+t)*this.cellWidth,(u+i)*this.cellWidth,this.cellWidth,this.cellWidth):a.fillRect((o+t)*this.cellWidth,(u+i)*this.cellWidth,this.cellWidth,this.cellWidth))}drawCursor(e,t,i,n){const s=this.props.isTilemap&&this.props.drawingMode===r.TileDrawingMode.Wall,o=(s?this.canvasLayers[0]:this.canvas).getContext("2d");if(o.imageSmoothingEnabled=!1,n&&-1!==n)if(this.props.isTilemap&&!s){if(n>=this.props.tilemapState.tileset.tiles.length)return;let s=this.tileCache[this.props.tilemapState.tileset.tiles[n].id];if(s||(s=this.generateTile(n,this.props.tilemapState.tileset)),!s)return;for(let n=0;n<i;n++)for(let r=0;r<i;r++)o.drawImage(s,(e+n)*this.cellWidth,(t+r)*this.cellWidth)}else s?(o.fillStyle=this.props.colors[n],o.fillRect(e,t,1,1)):(o.fillStyle=this.props.colors[n],o.fillRect(e*this.cellWidth,t*this.cellWidth,i*this.cellWidth,i*this.cellWidth));else this.props.lightMode?(o.fillStyle=d.LIGHT_MODE_TRANSPARENT,o.fillRect(e*this.cellWidth,t*this.cellWidth,i*this.cellWidth,i*this.cellWidth)):o.clearRect(e*this.cellWidth,t*this.cellWidth,i*this.cellWidth,i*this.cellWidth)}updateBackground(){this.refs["canvas-bounds"].style.cursor=this.cursor,this.canvas.style.cursor=this.cursor,this.updateZoom(0)}updateZoom(e,t,i){const n=this.refs["canvas-bounds"];if(this.canvas&&n){const s=n.getBoundingClientRect();t=void 0===t?s.left+(s.width>>1):t,i=void 0===i?s.top+(s.height>>1):i;const{canvasX:o,canvasY:r}=this.clientToCanvas(t,i,s);this.zoom=Math.max(this.zoom+e,2.5);const a=this.getCanvasUnit(s);if(a){const{canvasX:e,canvasY:n}=this.clientToCanvas(t,i,s);if(isNaN(e)||isNaN(n)||isNaN(o)||isNaN(r))return;this.panX+=(o-e)*a,this.panY+=(r-n)*a}this.applyZoom()}}getCenteredPan(){let[e,t]=[0,0];const i=this.refs["canvas-bounds"].getBoundingClientRect(),n=this.canvas.getBoundingClientRect();return n.width<i.width&&(e=-((i.width>>1)-(n.width>>1))),n.height<i.height&&(t=-((i.height>>1)-(n.height>>1))),[e,t]}zoomToCanvas(){this.zoom=10;const e=this.refs["canvas-bounds"];this.applyZoom(),this.canvas&&e&&([this.panX,this.panY]=this.getCenteredPan()),this.applyZoom()}applyZoom(e){const t=this.refs["canvas-bounds"];if(this.canvas&&t){e=e||t.getBoundingClientRect();const i=this.getCanvasUnit(e);if(0===i){if(this.waitingToZoom)return;return this.waitingToZoom=!0,void requestAnimationFrame((()=>{this.waitingToZoom&&(this.waitingToZoom=!1,this.applyZoom())}))}this.waitingToZoom=!1;const n=i*this.imageWidth,s=i*this.imageHeight,o=this.imageWidth>1&&this.imageHeight>1?2*i:i>>1;this.hasInteracted||([this.panX,this.panY]=this.getCenteredPan()),this.panX=Math.max(Math.min(this.panX,n-o),-(e.width-o)),this.panY=Math.max(Math.min(this.panY,s-o),-(e.height-o)),this.canvas.style.position="fixed",this.canvas.style.width=`${n}px`,this.canvas.style.height=`${s}px`,this.canvas.style.left=-this.panX+"px",this.canvas.style.top=-this.panY+"px",this.canvas.style.clipPath=`polygon(${this.panX}px ${this.panY}px, ${this.panX+e.width}px ${this.panY}px, ${this.panX+e.width}px ${this.panY+e.height}px, ${this.panX}px ${this.panY+e.height}px)`,this.background&&this.cloneCanvasStyle(this.canvas,this.background),this.canvasLayers.forEach((e=>this.cloneCanvasStyle(this.canvas,e))),this.redrawFloatingLayer(this.editState,!0)}}selectCanvasColor(e,t){const i=this.refs["canvas-bounds"].getBoundingClientRect();let n,{canvasX:s,canvasY:o}=this.clientToCanvas(e.clientX,e.clientY,i);s=Math.floor(s),o=Math.floor(o),this.editState.inFloatingLayer(s,o)&&(n=this.editState.floating.image.get(s-this.editState.layerOffsetX,o-this.editState.layerOffsetY)),n||(n=this.editState.image.get(s,o)),t?this.props.dispatchChangeBackgroundColor(n):this.props.dispatchChangeSelectedColor(n)}selectAll(){this.props.tool!==r.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(r.ImageEditorTool.Marquee),this.editState.mergeFloatingLayer(),this.editState.copyToLayer(0,0,this.imageWidth,this.imageHeight,!0),this.props.dispatchImageEdit(this.editState.toImageState())}cancelSelection(){this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState())}deleteSelection(){this.editState.floating=null,this.props.dispatchImageEdit(this.editState.toImageState())}cloneCanvasStyle(e,t){t.style.position=e.style.position,t.style.width=e.style.width,t.style.height=e.style.height,t.style.left=e.style.left,t.style.top=e.style.top,t.style.clipPath=e.style.clipPath}clientToCanvas(e,t,i){const n=this.getCanvasUnit(i);return{canvasX:(e-i.left+this.panX)/n,canvasY:(t-i.top+this.panY)/n}}getCanvasUnit(e){const t=e.width/e.height,i=this.imageWidth/this.imageHeight,n=Math.pow(this.zoom/10,2);return t>i?n*(e.height/this.imageHeight):n*(e.width/this.imageWidth)}inBounds(e,t){return e>=0&&e<this.imageWidth&&t>=0&&t<this.imageHeight}isPanning(){return this.props.tool===r.ImageEditorTool.Pan}touchesResize(e,t){const i=document.querySelectorAll(":hover");for(let e=0;e<i.length;e++)if("image-editor-floating-layer-corner"==i[e].className)return!0;return!1}isColorSelect(){return this.props.tool===r.ImageEditorTool.ColorSelect}shouldHandleCanvasShortcut(){return!(this.props.suppressShortcuts||document.activeElement instanceof HTMLInputElement)}shouldDrawCursor(){if(!this.hasHover)return!1;switch(this.props.tool){case r.ImageEditorTool.Fill:case r.ImageEditorTool.Marquee:case r.ImageEditorTool.Pan:case r.ImageEditorTool.ColorSelect:return!1;default:return!0}}getImageState(){return this.props.isTilemap?this.props.tilemapState.tilemap:this.props.imageState}applyTilemapPatch(e){const{tilemapState:t,dispatchCreateNewTile:i,gallery:n,backgroundColor:s}=this.props,{tileset:o}=t,r=pxt.sprite.tilemapLiteralToTilemap(e.map);if(!r||!r.width||!r.height)return;const a=e.tiles.map((e=>pxt.sprite.getBitmapFromJResURL(`data:image/x-mkcd-f4;base64,${e}`))),l=e.layers.map((e=>pxt.sprite.getBitmapFromJResURL(`data:image/x-mkcd-f4;base64,${e}`))),c=[];let h=o.tiles.length;for(const e of a){const t=o.tiles.findIndex((t=>e.equals(pxt.sprite.Bitmap.fromData(t.bitmap))));if(t>=0)c.push(t);else{if(n){const t=n.find((t=>e.equals(pxt.sprite.Bitmap.fromData(t.bitmap))));if(t){i(null,o.tiles.length,s,t.qualifiedName),c.push(h),h++;continue}}i((0,u.createTile)(e.data()),o.tiles.length,s),c.push(h),h++}}this.editState.mergeFloatingLayer();const d=new pxt.sprite.Tilemap(r.width,r.height);for(let e=0;e<d.width;e++)for(let t=0;t<d.height;t++)d.set(e,t,c[r.get(e,t)]);this.editState.floating={image:d,overlayLayers:l},this.editState.layerOffsetX=0,this.editState.layerOffsetY=0,this.props.dispatchImageEdit(this.editState.toImageState())}}i.ImageCanvasImpl=g;const m={dispatchImageEdit:a.dispatchImageEdit,dispatchChangeCursorLocation:a.dispatchChangeCursorLocation,dispatchChangeZoom:a.dispatchChangeZoom,dispatchChangeImageTool:a.dispatchChangeImageTool,dispatchChangeSelectedColor:a.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:a.dispatchChangeBackgroundColor,dispatchCreateNewTile:a.dispatchCreateNewTile};i.ImageCanvas=(0,o.connect)((function({store:{present:e},editor:t},i){if(t.isTilemap){let i=e;return i?{selectedColor:t.selectedColor,tilemapState:i,tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:!1,overlayEnabled:t.overlayEnabled,backgroundColor:t.backgroundColor,colors:i.colors,isTilemap:t.isTilemap,drawingMode:t.drawingMode,gallery:t.tileGallery,tilesetRevision:t.tilesetRevision}:{}}let n=e;return n?{selectedColor:t.selectedColor,colors:n.colors,imageState:n.frames[n.currentFrame],tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:t.onionSkinEnabled,backgroundColor:t.backgroundColor,prevFrame:n.frames[n.currentFrame-1],isTilemap:t.isTilemap,tilesetRevision:t.tilesetRevision}:{}}),m)(g)},{"../../assets":141,"./ImageEditor":149,"./actions/dispatch":156,"./keyboardShortcuts":158,"./store/imageReducer":160,"./toolDefinitions":164,"./util":165,react:255,"react-redux":241,"react/jsx-runtime":256}],149:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageEditor=i.LIGHT_MODE_TRANSPARENT=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-redux"),r=e("./store/imageStore"),a=e("./SideBar"),l=e("./BottomBar"),c=e("./TopBar"),u=e("./ImageCanvas"),h=e("./Alert"),d=e("./Timeline"),p=e("./keyboardShortcuts"),g=e("./actions/dispatch"),m=e("./util"),f=e("../../assets"),_=e("../../../../react-common/components/util");i.LIGHT_MODE_TRANSPARENT="#dedede";class T extends s.Component{constructor(e){super(e),this.onStoreChange=()=>{this.props.onChange&&this.props.onChange(this.props.singleFrame?pxt.sprite.bitmapToImageLiteral(this.getCurrentFrame(),"typescript"):"");const e=this.getStore(),t=e.getState();if((0,p.setStore)(e),t.editor&&this.setState({alert:t.editor.alert}),!!t.editor.editingTile!=!!this.state.editingTile)if(t.editor.editingTile){const e=t.editor.editingTile.tilesetIndex;if(e){const i=t.store.present.tileset.tiles[e];this.setState({editingTile:!0,tileToEdit:i})}else{const e=t.store.present.tileset.tileWidth,i=(0,f.createNewImageAsset)("tile",e,e,lf("myTile"));this.setState({editingTile:!0,tileToEdit:i})}this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!0)}else this.setState({editingTile:!1}),this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!1)},this.onDoneClick=()=>{this.props.onDoneClicked&&this.props.onDoneClicked(this.getAsset())},this.onTileEditorFinished=e=>{const t=this.getStore().getState().editor.editingTile;e.isProjectTile=!0,this.dispatchOnStore((0,g.dispatchCloseTileEditor)(e,t.tilesetIndex))},this.state={editingTile:!1}}componentDidMount(){(0,p.addKeyListener)(),this.props.asset&&this.openAsset(this.props.asset),this.unsubscribeChangeListener=this.getStore().subscribe(this.onStoreChange),this.onResize()}componentWillUnmount(){this.props.nested||(0,p.removeKeyListener)(),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()}render(){const{singleFrame:e,lightMode:t,hideDoneButton:i,hideAssetName:s}=this.props,p=this.getStore(),{tileToEdit:g,editingTile:m,alert:f}=this.state,E="Animation"===p.getState().store.present.kind;return(0,n.jsxs)("div",Object.assign({className:"image-editor-outer"},{children:[(0,n.jsx)(o.Provider,Object.assign({store:p},{children:(0,n.jsxs)("div",Object.assign({className:(0,_.classList)("image-editor",m&&"editing-tile",i&&"hide-done-button")},{children:[(0,n.jsx)(c.TopBar,{singleFrame:e}),(0,n.jsxs)("div",Object.assign({className:"image-editor-content"},{children:[(0,n.jsx)(a.SideBar,{lightMode:t}),(0,n.jsx)(u.ImageCanvas,{suppressShortcuts:m,lightMode:t}),E&&!e?(0,n.jsx)(d.Timeline,{}):void 0]})),(0,n.jsx)(l.BottomBar,{singleFrame:e,onDoneClick:this.onDoneClick,hideDoneButton:!!i,hideAssetName:!!s}),f&&f.title&&(0,n.jsx)(h.Alert,{title:f.title,text:f.text,options:f.options})]}))})),m&&(0,n.jsx)(T,{store:r.tileEditorStore,ref:"nested-image-editor",onDoneClicked:this.onTileEditorFinished,asset:g,singleFrame:!0,nested:!0,hideAssetName:s})]}))}openAsset(e,t,i=!1){this.dispatchOnStore((0,g.dispatchOpenAsset)(e,i,t)),e.meta.displayName?this.dispatchOnStore((0,g.dispatchChangeAssetName)(e.meta.displayName)):i&&this.dispatchOnStore((0,g.dispatchChangeAssetName)(""))}openGalleryAsset(e){const t=this.getAsset(),i=this.getStore().getState().store.present.frames;switch(t.type){case"animation":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),1===i.length);break;case"animation":this.dispatchOnStore((0,g.dispatchSetFrames)(e.frames.map((e=>({bitmap:e})))))}break;case"image":case"tile":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),!0);break;case"animation":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.frames[0]),!0)}}}onResize(){this.dispatchOnStore((0,g.dispatchChangeZoom)(0))}getCurrentFrame(){const e=this.getStore().getState().store.present,t=e.frames[e.currentFrame];return(0,m.imageStateToBitmap)(t)}getAsset(){switch(this.getStore().getState().store.present.asset.type){case"tile":return this.getTile();case"animation":return this.getAnimation();case"tilemap":return this.getTilemap();default:return this.getImage()}}getImage(){var e;const t=this.getStore().getState().store.present,i=this.getCurrentFrame().data(),n=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,f.getNewInternalID)(),type:"image",bitmap:i,jresData:pxt.sprite.base64EncodeBitmap(i),meta:n}}getTile(){var e;const t=this.getStore().getState().store.present,i=this.getCurrentFrame().data(),n=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,f.getNewInternalID)(),isProjectTile:!0,type:"tile",bitmap:i,jresData:pxt.sprite.base64EncodeBitmap(i),meta:n}}getAnimation(){var e;const t=this.getStore().getState().store.present,i=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,f.getNewInternalID)(),type:"animation",interval:t.interval,frames:t.frames.map((e=>(0,m.imageStateToBitmap)(e).data())),meta:i}}getTilemap(){var e;const t=this.getStore().getState(),i=t.store.present,{floating:n,overlayLayers:s,layerOffsetX:o,layerOffsetY:r}=i.tilemap,a=(0,m.applyBitmapData)(pxt.sprite.Bitmap.fromData(s[0]).copy().data(),n&&n.overlayLayers&&n.overlayLayers[0],o,r),l=new pxt.sprite.TilemapData((0,m.imageStateToTilemap)(i.tilemap),i.tileset,a);l.deletedTiles=t.editor.deletedTiles,l.editedTiles=t.editor.editedTiles;const c=i.asset?Object.assign({},i.asset.meta):{};return{id:null===(e=i.asset)||void 0===e?void 0:e.id,internalID:i.asset?i.asset.internalID:(0,f.getNewInternalID)(),type:"tilemap",data:l,meta:c}}getPersistentData(){const e=this.getStore().getState();return{editor:e.editor,past:e.store.past}}restorePersistentData(e){e&&this.dispatchOnStore((0,g.dispatchSetInitialState)(e.editor,e.past))}setCurrentFrame(e,t){if(!t){const t=this.getStore().getState().store.present.frames[0];if(e.width!==t.bitmap.width||e.height!==t.bitmap.height){const i=[Math.max(e.width,t.bitmap.width),Math.max(e.height,t.bitmap.height)];t.bitmap.width===i[0]&&t.bitmap.height===i[1]||this.dispatchOnStore((0,g.dispatchChangeImageDimensions)(i)),e=(e=e.copy()).resize(i[0],i[1])}}this.dispatchOnStore((0,g.dispatchImageEdit)({bitmap:e.data()}))}openInTileEditor(e){this.refs["nested-image-editor"].setCurrentFrame(e,!1)}disableResize(){this.dispatchOnStore((0,g.dispatchDisableResize)())}closeNestedEditor(){var e;this.state.editingTile&&(null===(e=this.refs["nested-image-editor"])||void 0===e||e.onDoneClick())}getJres(){if(this.props.singleFrame){const e=this.getCurrentFrame().data();return pxt.sprite.base64EncodeBitmap(e)}return""}loadJres(e){if(e)try{this.setCurrentFrame(pxt.sprite.getBitmapFromJResURL(e),!0)}catch(e){}}getStore(){return this.props.store||r.mainStore}dispatchOnStore(e){this.getStore().dispatch(e)}}i.ImageEditor=T},{"../../../../react-common/components/util":139,"../../assets":141,"./Alert":143,"./BottomBar":144,"./ImageCanvas":148,"./SideBar":151,"./Timeline":152,"./TopBar":155,"./actions/dispatch":156,"./keyboardShortcuts":158,"./store/imageStore":161,"./util":165,react:255,"react-redux":241,"react/jsx-runtime":256}],150:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Pivot=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("./util");class r extends s.Component{constructor(e){super(e),this.handlers=[],this.state={open:!1}}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:t}=this.props,i=e[t];return(0,n.jsx)("div",Object.assign({className:"image-editor-pivot-outer"},{children:e.map(((e,t)=>(0,n.jsx)("div",Object.assign({role:"tab",className:"image-editor-pivot-option "+(e===i?"selected":""),tabIndex:0,onClick:this.clickHandler(t),onKeyDown:o.fireClickOnlyOnEnter},{children:e.text}),e.id)))}))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:i}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(i[e],e)}}return this.handlers[e]}}i.Pivot=r},{"./util":165,react:255,"react/jsx-runtime":256}],151:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SideBar=i.SideBarImpl=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-redux"),r=e("./toolDefinitions"),a=e("./Button"),l=e("./actions/dispatch"),c=e("./sprite/Palette"),u=e("./tilemap/TilePalette"),h=e("./tilemap/Minimap");class d extends s.Component{constructor(){super(...arguments),this.handlers=[]}render(){const{selectedTool:e,isTilemap:t,lightMode:i}=this.props;return(0,n.jsxs)("div",Object.assign({className:"image-editor-sidebar "+(t?"tilemap":"")},{children:[t&&(0,n.jsx)("div",Object.assign({className:"image-editor-tilemap-minimap"},{children:(0,n.jsx)(h.Minimap,{lightMode:i})})),(0,n.jsx)("div",Object.assign({className:"image-editor-tool-buttons"},{children:r.tools.filter((e=>!e.hiddenTool)).map((t=>(0,n.jsx)(a.IconButton,{iconClass:t.iconClass,toggle:e!=t.tool,title:t.title,onClick:this.clickHandler(t.tool)},t.tool)))})),(0,n.jsx)("div",Object.assign({className:"image-editor-palette"},{children:t?(0,n.jsx)(u.TilePalette,{}):(0,n.jsx)(c.Palette,{})}))]}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>this.props.dispatchChangeImageTool(e)),this.handlers[e]}}i.SideBarImpl=d;const p={dispatchChangeImageTool:l.dispatchChangeImageTool};i.SideBar=(0,o.connect)((function({editor:e},t){return e?{isTilemap:e.isTilemap,selectedTool:e.tool}:{}}),p)(d)},{"./Button":145,"./actions/dispatch":156,"./sprite/Palette":159,"./tilemap/Minimap":162,"./tilemap/TilePalette":163,"./toolDefinitions":164,react:255,"react-redux":241,"react/jsx-runtime":256}],152:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Timeline=i.TimelineImpl=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-redux"),r=e("./actions/dispatch"),a=e("./TimelineFrame"),l=e("./util");class c extends s.Component{constructor(e){super(e),this.handlers=[],this.scrollOffset=0,this.dragEnd=!1,this.duplicateFrame=()=>{const{currentFrame:e,dispatchDuplicateFrame:t}=this.props;t(e)},this.deleteFrame=()=>{const{currentFrame:e,dispatchDeleteFrame:t}=this.props;t(e)},this.newFrame=()=>{const{dispatchNewFrame:e}=this.props;this.dragEnd?this.dragEnd=!1:e()},this.state={}}render(){const{frames:e,colors:t,currentFrame:i,interval:s,previewAnimating:o}=this.props,{isMovingFrame:r,dropPreviewIndex:l}=this.state;let c,u=e.slice();return r&&(c=e[i],u.splice(i,1),u.splice(l,0,null)),(0,n.jsxs)("div",Object.assign({className:"image-editor-timeline "+(pxt.BrowserUtils.isEdge()?"edge":"")},{children:[(0,n.jsx)("div",Object.assign({className:"image-editor-timeline-preview"},{children:(0,n.jsx)(a.TimelineFrame,{frames:o?e:[e[i]],colors:t,interval:s,animating:!0})})),(0,n.jsx)("div",Object.assign({className:"image-editor-timeline-frames-outer"},{children:(0,n.jsxs)("div",Object.assign({className:"image-editor-timeline-frames",ref:"frame-scroller-ref"},{children:[u.map(((e,s)=>{const o=!r&&s===i;return e?(0,n.jsx)("div",Object.assign({className:"image-editor-timeline-frame "+(o?"active":""),role:"button",onClick:this.clickHandler(s)},{children:(0,n.jsx)(a.TimelineFrame,{frames:[e],colors:t,showActions:o,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})}),s):(0,n.jsx)("div",{className:"image-editor-timeline-frame drop-marker"},s)})),c&&(0,n.jsx)("div",Object.assign({ref:"floating-frame",className:"image-editor-timeline-frame dragging"},{children:(0,n.jsx)(a.TimelineFrame,{frames:[c],colors:t,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})})),(0,n.jsx)("div",Object.assign({className:"image-editor-timeline-frame collapsed",role:"button",onClick:this.newFrame},{children:(0,n.jsx)("span",{className:"ms-Icon ms-Icon--Add"})}))]}))}))]}))}componentDidMount(){let e;this.frameScroller=this.refs["frame-scroller-ref"];let t=!1;(0,l.bindGestureEvents)(this.frameScroller,{onClick:e=>{this.dragEnd=!1},onDragStart:i=>{e=i.clientY,pxt.BrowserUtils.addClass(this.frameScroller,"scrolling");const n=this.frameScroller.getBoundingClientRect(),s=i.clientY-n.top,o=this.frameScroller.firstElementChild.getBoundingClientRect().height,r=Math.floor(s/o);t=r!==this.props.currentFrame},onDragMove:i=>{if(t){this.scrollOffset-=e-i.clientY,e=i.clientY;try{const e=this.frameScroller.getBoundingClientRect(),t=this.frameScroller.parentElement.getBoundingClientRect();e.height>t.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),t.height-e.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}}else this.updateDragDrop(i)},onDragEnd:()=>{if(e=null,pxt.BrowserUtils.removeClass(this.frameScroller,"scrolling"),this.dragEnd=!0,this.state.isMovingFrame){const{dispatchMoveFrame:e,currentFrame:t}=this.props;e(t,this.state.dropPreviewIndex),this.setState({isMovingFrame:!1})}}}),this.frameScroller.addEventListener("wheel",(e=>{this.scrollOffset-=e.deltaY;try{const e=this.frameScroller.getBoundingClientRect(),t=this.frameScroller.parentElement.getBoundingClientRect();e.height>t.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),t.height-e.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>{const{currentFrame:t,dispatchChangeCurrentFrame:i}=this.props;this.dragEnd?this.dragEnd=!1:e!=t&&i(e)}),this.handlers[e]}updateDragDrop(e){const t=this.frameScroller.getBoundingClientRect(),i=e.clientY-t.top,n=this.frameScroller.firstElementChild.getBoundingClientRect().height,s=Math.floor(i/n);this.state.isMovingFrame?this.refs["floating-frame"]&&(this.refs["floating-frame"].style.top=i+"px",this.setState({dropPreviewIndex:s})):this.setState({isMovingFrame:!0,dropPreviewIndex:this.props.currentFrame})}}i.TimelineImpl=c;const u={dispatchDuplicateFrame:r.dispatchDuplicateFrame,dispatchDeleteFrame:r.dispatchDeleteFrame,dispatchChangeCurrentFrame:r.dispatchChangeCurrentFrame,dispatchNewFrame:r.dispatchNewFrame,dispatchMoveFrame:r.dispatchMoveFrame};i.Timeline=(0,o.connect)((function({store:{present:e},editor:t},i){let n=e;return n?{frames:n.frames,currentFrame:n.currentFrame,colors:n.colors,interval:n.interval,previewAnimating:t.previewAnimating}:{}}),u)(c)},{"./TimelineFrame":153,"./actions/dispatch":156,"./util":165,react:255,"react-redux":241,"react/jsx-runtime":256}],153:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TimelineFrame=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("./Button"),r=pxt.BrowserUtils.isEdge()?25:1;class a extends s.Component{constructor(e){super(e),this.state={index:0}}render(){const{frames:e,animating:t,showActions:i,duplicateFrame:s,deleteFrame:r}=this.props,a=e[t?Math.min(Math.max(0,this.state.index),e.length-1):0],l=a.bitmap.height>a.bitmap.width;return(0,n.jsxs)("div",Object.assign({className:"timeline-frame-outer "+(l?"portrait":"landscape")},{children:[(0,n.jsx)("div",{className:"timeline-frame-spacer"}),(0,n.jsx)("canvas",{ref:"preview-canvas"}),(0,n.jsx)("div",{className:"timeline-frame-spacer"}),i&&(0,n.jsxs)("div",Object.assign({className:"timeline-frame-actions"},{children:[(0,n.jsx)(o.IconButton,{iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate Current Frame"),onClick:s}),(0,n.jsx)(o.IconButton,{iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete Current Frame"),onClick:r})]}))]}))}componentDidMount(){this.canvas=this.refs["preview-canvas"],this.redraw(),this.updateAnimation()}componentDidUpdate(){this.redraw(),this.updateAnimation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=void 0}redraw(){if(!this.canvas)return;const{animating:e,frames:t}=this.props,i=t[e?Math.min(Math.max(0,this.state.index),t.length-1):0];this.canvas.height=i.bitmap.height*r,this.canvas.width=i.bitmap.width*r;const n=pxt.sprite.Bitmap.fromData(i.bitmap);if(this.drawBitmap(n),i.floating&&i.floating.bitmap){const e=pxt.sprite.Bitmap.fromData(i.floating.bitmap);this.drawBitmap(e,i.layerOffsetX,i.layerOffsetY,!0)}}updateAnimation(){const{animating:e,interval:t,frames:i}=this.props,n=e&&t>5&&i.length>1;n&&t!==this.intervalcurrent?(this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval((()=>this.setState({index:(this.state.index+1)%this.props.frames.length})),t),this.intervalcurrent=t):!n&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0,this.intervalcurrent=void 0)}drawBitmap(e,t=0,i=0,n=!1){const{colors:s}=this.props,o=this.canvas.getContext("2d");for(let a=0;a<e.width;a++)for(let l=0;l<e.height;l++){const c=e.get(a,l);c?(o.fillStyle=s[c],o.fillRect((a+t)*r,(l+i)*r,r,r)):n||o.clearRect((a+t)*r,(l+i)*r,r,r)}}}i.TimelineFrame=a},{"./Button":145,react:255,"react/jsx-runtime":256}],154:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Toggle=void 0;const n=e("react/jsx-runtime"),s=e("react");class o extends s.Component{constructor(e){super(e),this.checked=!1,this.handleToggleClick=e=>{this.checked=!this.checked,this.props.onChange&&this.props.onChange(e.target.checked)},this.checked=e.initialValue}render(){const{initialValue:e,label:t}=this.props;return(0,n.jsxs)("div",Object.assign({className:"image-editor-toggle-container"},{children:[t&&(0,n.jsx)("span",{children:t}),(0,n.jsxs)("label",Object.assign({className:"image-editor-toggle"},{children:[(0,n.jsx)("input",{type:"checkbox",onClick:this.handleToggleClick,defaultChecked:e,"aria-checked":this.checked}),(0,n.jsx)("span",{className:"image-editor-toggle-switch"})]}))]}))}}i.Toggle=o},{react:255,"react/jsx-runtime":256}],155:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TopBar=i.TopBarImpl=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-redux"),r=e("./actions/dispatch"),a=e("./Button"),l=e("./CursorSizes"),c=e("./Toggle"),u=e("./keyboardShortcuts");class h extends s.Component{constructor(e){super(e),this.togglePreviewAnimating=()=>this.props.dispatchChangePreviewAnimating(!this.props.previewAnimating),this.flipVertical=()=>(0,u.flip)(!0),this.flipHorizontal=()=>(0,u.flip)(!1),this.rotateClockwise=()=>(0,u.rotate)(!0),this.rotateCounterclockwise=()=>(0,u.rotate)(!1),this.handleIntervalChange=e=>{this.setState({interval:e.target.value})},this.handleIntervalBlur=()=>{const{dispatchChangeInterval:e}=this.props,t=parseInt(this.state.interval);isNaN(t)||e(Math.min(Math.max(t,50),1e6)),this.setState({interval:null})},this.state={}}render(){const{interval:e,previewAnimating:t,singleFrame:i,isTilemap:s,dispatchChangeOverlayEnabled:o}=this.props,r=null==this.state.interval?e:this.state.interval;return(0,n.jsxs)("div",Object.assign({className:"image-editor-topbar"},{children:[(0,n.jsx)("div",Object.assign({className:"cursor-group"},{children:(0,n.jsx)(l.CursorSizes,{})})),(0,n.jsx)("div",{className:"image-editor-seperator"}),(0,n.jsxs)("div",Object.assign({className:"image-transform-group"},{children:[(0,n.jsx)(a.IconButton,{iconClass:"xicon flipvertical",title:lf("Flip vertical"),onClick:this.flipVertical},"flipv"),(0,n.jsx)(a.IconButton,{iconClass:"xicon fliphorizontal",title:lf("Flip horizontal"),onClick:this.flipHorizontal},"fliph"),(0,n.jsx)(a.IconButton,{iconClass:"xicon rotateright",title:lf("Rotate clockwise"),onClick:this.rotateClockwise},"rotatec"),(0,n.jsx)(a.IconButton,{iconClass:"xicon rotateleft",title:lf("Rotate counterclockwise"),onClick:this.rotateCounterclockwise},"rotatecc")]})),(0,n.jsx)("div",{className:"spacer"}),!i&&(0,n.jsx)("div",{className:"image-editor-seperator"}),!i&&(0,n.jsxs)("div",Object.assign({className:"timeline-controls"},{children:[(0,n.jsx)(a.IconButton,{onClick:this.togglePreviewAnimating,iconClass:t?"ms-Icon ms-Icon--Stop":"ms-Icon ms-Icon--Play",title:t?lf("Stop Animation Preview"):lf("Play Animation Preview"),toggle:!0}),(0,n.jsx)("div",Object.assign({className:"image-editor-interval-label image-editor-label"},{children:(0,n.jsx)("span",{className:"ms-Icon ms-Icon--Clock"})})),(0,n.jsx)("div",Object.assign({className:"image-editor-interval"},{children:(0,n.jsx)("input",{className:"image-editor-input",title:lf("Interval Between Frames (ms)"),value:r,onChange:this.handleIntervalChange,onBlur:this.handleIntervalBlur})}))]})),s&&(0,n.jsx)(c.Toggle,{initialValue:!0,label:lf("Show walls"),onChange:o})]}))}}i.TopBarImpl=h;const d={dispatchChangeInterval:r.dispatchChangeInterval,dispatchChangePreviewAnimating:r.dispatchChangePreviewAnimating,dispatchChangeOverlayEnabled:r.dispatchChangeOverlayEnabled};i.TopBar=(0,o.connect)((function({store:{present:e},editor:t},i){return e?{interval:e.interval,previewAnimating:t.previewAnimating,isTilemap:t.isTilemap}:{}}),d)(h)},{"./Button":145,"./CursorSizes":146,"./Toggle":154,"./actions/dispatch":156,"./keyboardShortcuts":158,react:255,"react-redux":241,"react/jsx-runtime":256}],156:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dispatchSetFrames=i.dispatchOpenAsset=i.dispatchChangeAssetName=i.dispatchDisableResize=i.dispatchDeleteTile=i.dispatchCloseTileEditor=i.dispatchOpenTileEditor=i.dispatchSetGalleryOpen=i.dispatchCreateNewTile=i.dispatchChangeDrawingMode=i.dispatchChangeTilePalettePage=i.dispatchChangeTilePaletteCategory=i.dispatchSetInitialState=i.dispatchChangeBackgroundColor=i.dispatchSwapBackgroundForeground=i.dispatchHideAlert=i.dispatchShowAlert=i.dispatchChangeZoom=i.dispatchChangeOverlayEnabled=i.dispatchToggleOnionSkinEnabled=i.dispatchChangePreviewAnimating=i.dispatchChangeInterval=i.dispatchMoveFrame=i.dispatchChangeCurrentFrame=i.dispatchDuplicateFrame=i.dispatchDeleteFrame=i.dispatchNewFrame=i.dispatchToggleAspectRatioLocked=i.dispatchRedoImageEdit=i.dispatchUndoImageEdit=i.dispatchImageEdit=i.dispatchChangeCursorLocation=i.dispatchChangeKeyModifiers=i.dispatchChangeImageDimensions=i.dispatchChangeSelectedColor=i.dispatchChangeCursorSize=i.dispatchChangeImageTool=void 0;const n=e("./types");i.dispatchChangeImageTool=e=>({type:n.CHANGE_IMAGE_TOOL,tool:e});i.dispatchChangeCursorSize=e=>({type:n.CHANGE_CURSOR_SIZE,cursorSize:e});i.dispatchChangeSelectedColor=e=>({type:n.CHANGE_SELECTED_COLOR,selectedColor:e});i.dispatchChangeImageDimensions=e=>({type:n.CHANGE_IMAGE_DIMENSIONS,imageDimensions:e});i.dispatchChangeKeyModifiers=e=>({type:n.CHANGE_KEY_MODIFIERS,keyModifiers:e});i.dispatchChangeCursorLocation=e=>({type:n.CHANGE_CURSOR_LOCATION,cursorLocation:e});i.dispatchImageEdit=e=>({type:n.IMAGE_EDIT,newState:e});i.dispatchUndoImageEdit=()=>({type:n.UNDO_IMAGE_EDIT});i.dispatchRedoImageEdit=()=>({type:n.REDO_IMAGE_EDIT});i.dispatchToggleAspectRatioLocked=()=>({type:n.TOGGLE_ASPECT_RATIO});i.dispatchNewFrame=e=>({type:n.NEW_FRAME,index:e});i.dispatchDeleteFrame=e=>({type:n.DELETE_FRAME,index:e});i.dispatchDuplicateFrame=e=>({type:n.DUPLICATE_FRAME,index:e});i.dispatchChangeCurrentFrame=e=>({type:n.CHANGE_CURRENT_FRAME,index:e});i.dispatchMoveFrame=(e,t)=>({type:n.MOVE_FRAME,oldIndex:e,newIndex:t});i.dispatchChangeInterval=e=>({type:n.CHANGE_INTERVAL,newInterval:e});i.dispatchChangePreviewAnimating=e=>({type:n.CHANGE_PREVIEW_ANIMATING,animating:e});i.dispatchToggleOnionSkinEnabled=()=>({type:n.TOGGLE_ONION_SKIN_ENABLED});i.dispatchChangeOverlayEnabled=e=>({type:n.CHANGE_OVERLAY_ENABLED,enabled:e});i.dispatchChangeZoom=e=>({type:n.CHANGE_CANVAS_ZOOM,zoom:e});i.dispatchShowAlert=(e,t,i)=>({type:n.SHOW_ALERT,title:e,text:t,options:i});i.dispatchHideAlert=()=>({type:n.HIDE_ALERT});i.dispatchSwapBackgroundForeground=()=>({type:n.SWAP_FOREGROUND_BACKGROUND});i.dispatchChangeBackgroundColor=e=>({type:n.CHANGE_BACKGROUND_COLOR,backgroundColor:e});i.dispatchSetInitialState=(e,t)=>({type:n.SET_INITIAL_STATE,state:e,past:t});i.dispatchChangeTilePaletteCategory=e=>({type:n.CHANGE_TILE_PALETTE_CATEGORY,category:e});i.dispatchChangeTilePalettePage=e=>({type:n.CHANGE_TILE_PALETTE_PAGE,page:e});i.dispatchChangeDrawingMode=e=>({type:n.CHANGE_DRAWING_MODE,drawingMode:e});i.dispatchCreateNewTile=(e,t,i,s)=>({type:n.CREATE_NEW_TILE,tile:e,foreground:t,background:i,qualifiedName:s});i.dispatchSetGalleryOpen=e=>({type:n.SET_GALLERY_OPEN,open:e});i.dispatchOpenTileEditor=(e,t)=>({type:n.OPEN_TILE_EDITOR,index:e,id:t});i.dispatchCloseTileEditor=(e,t)=>({type:n.CLOSE_TILE_EDITOR,result:e,index:t});i.dispatchDeleteTile=(e,t)=>({type:n.DELETE_TILE,id:t,index:e});i.dispatchDisableResize=()=>({type:n.DISABLE_RESIZE});i.dispatchChangeAssetName=e=>({type:n.CHANGE_ASSET_NAME,name:e});i.dispatchOpenAsset=(e,t,i)=>({type:n.OPEN_ASSET,asset:e,keepPast:t,gallery:i});i.dispatchSetFrames=e=>({type:n.SET_FRAMES,frames:e})},{"./types":157}],157:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.OPEN_ASSET=i.CHANGE_ASSET_NAME=i.DISABLE_RESIZE=i.DELETE_TILE=i.CLOSE_TILE_EDITOR=i.OPEN_TILE_EDITOR=i.CREATE_NEW_TILE=i.CHANGE_DRAWING_MODE=i.CHANGE_TILE_PALETTE_CATEGORY=i.CHANGE_TILE_PALETTE_PAGE=i.CHANGE_BACKGROUND_COLOR=i.SWAP_FOREGROUND_BACKGROUND=i.HIDE_ALERT=i.SHOW_ALERT=i.CHANGE_CANVAS_ZOOM=i.CHANGE_OVERLAY_ENABLED=i.TOGGLE_ONION_SKIN_ENABLED=i.CHANGE_PREVIEW_ANIMATING=i.CHANGE_INTERVAL=i.CHANGE_CURRENT_FRAME=i.MOVE_FRAME=i.DUPLICATE_FRAME=i.DELETE_FRAME=i.NEW_FRAME=i.SET_GALLERY_OPEN=i.TOGGLE_ASPECT_RATIO=i.REDO_IMAGE_EDIT=i.UNDO_IMAGE_EDIT=i.IMAGE_EDIT=i.CHANGE_CURSOR_LOCATION=i.CHANGE_KEY_MODIFIERS=i.CHANGE_IMAGE_DIMENSIONS=i.CHANGE_SELECTED_COLOR=i.CHANGE_CURSOR_SIZE=i.CHANGE_IMAGE_TOOL=i.SET_FRAMES=i.SET_INITIAL_STATE=void 0,i.SET_INITIAL_STATE="SET_INITIAL_STATE",i.SET_FRAMES="SET_FRAMES",i.CHANGE_IMAGE_TOOL="CHANGE_IMAGE_TOOL",i.CHANGE_CURSOR_SIZE="CHANGE_CURSOR_SIZE",i.CHANGE_SELECTED_COLOR="CHANGE_SELECTED_COLOR",i.CHANGE_IMAGE_DIMENSIONS="CHANGE_IMAGE_DIMENSIONS",i.CHANGE_KEY_MODIFIERS="CHANGE_KEY_MODIFIERS",i.CHANGE_CURSOR_LOCATION="CHANGE_CURSOR_LOCATION",i.IMAGE_EDIT="IMAGE_EDIT",i.UNDO_IMAGE_EDIT="UNDO_IMAGE_EDIT",i.REDO_IMAGE_EDIT="REDO_IMAGE_EDIT",i.TOGGLE_ASPECT_RATIO="TOGGLE_ASPECT_RATIO",i.SET_GALLERY_OPEN="SET_GALLERY_OPEN",i.NEW_FRAME="NEW_FRAME",i.DELETE_FRAME="DELETE_FRAME",i.DUPLICATE_FRAME="DUPLICATE_FRAME",i.MOVE_FRAME="MOVE_FRAME",i.CHANGE_CURRENT_FRAME="CHANGE_CURRENT_FRAME",i.CHANGE_INTERVAL="CHANGE_INTERVAL",i.CHANGE_PREVIEW_ANIMATING="CHANGE_PREVIEW_ANIMATING",i.TOGGLE_ONION_SKIN_ENABLED="TOGGLE_ONION_SKIN_ENABLED",i.CHANGE_OVERLAY_ENABLED="CHANGE_OVERLAY_ENABLED",i.CHANGE_CANVAS_ZOOM="CHANGE_CANVAS_ZOOM",i.SHOW_ALERT="SHOW_ALERT",i.HIDE_ALERT="HIDE_ALERT",i.SWAP_FOREGROUND_BACKGROUND="SWAP_FOREGROUND_BACKGROUND",i.CHANGE_BACKGROUND_COLOR="CHANGE_BACKGROUND_COLOR",i.CHANGE_TILE_PALETTE_PAGE="CHANGE_TILE_PALETTE_PAGE",i.CHANGE_TILE_PALETTE_CATEGORY="CHANGE_TILE_PALETTE_CATEGORY",i.CHANGE_DRAWING_MODE="CHANGE_DRAWING_MODE",i.CREATE_NEW_TILE="CREATE_NEW_TILE",i.OPEN_TILE_EDITOR="OPEN_TILE_EDITOR",i.CLOSE_TILE_EDITOR="CLOSE_TILE_EDITOR",i.DELETE_TILE="DELETE_TILE",i.DISABLE_RESIZE="DISABLE_RESIZE",i.CHANGE_ASSET_NAME="CHANGE_ASSET_NAME",i.OPEN_ASSET="OPEN_ASSET"},{}],158:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.replaceColor=i.outline=i.rotate=i.flip=i.setStore=i.areShortcutsEnabled=i.releaseShortcutLock=i.obtainShortcutLock=i.removeKeyListener=i.addKeyListener=void 0;const n=e("./store/imageReducer"),s=e("./actions/dispatch"),o=e("./store/imageStore"),r=e("./toolDefinitions");let a=o.mainStore,l=[];function c(){return!l.length}function u(e){const t=e.ctrlKey||e.metaKey;"Undo"===e.key||t&&"z"===e.key&&!e.shiftKey?(f((0,s.dispatchUndoImageEdit)()),e.preventDefault(),e.stopPropagation()):("Redo"===e.key||t&&"y"===e.key||t&&"Z"===e.key&&e.shiftKey)&&(f((0,s.dispatchRedoImageEdit)()),e.preventDefault(),e.stopPropagation())}function h(e){"Backspace"!==e.key&&"Delete"!==e.key||e.stopPropagation()}function d(e){if(!c())return;if(e.shiftKey&&/^(?:Digit[1-9])|(?:Key[A-F])$/.test(e.code))return void(0==e.code.indexOf("Digit")?b(parseInt(e.code.substring(5))):b(parseInt(e.code.substring(3),16)));switch(e.key){case"e":g(n.ImageEditorTool.Erase);break;case"h":g(n.ImageEditorTool.Pan);break;case"b":case"p":g(n.ImageEditorTool.Paint);break;case"g":g(n.ImageEditorTool.Fill);break;case"m":g(n.ImageEditorTool.Marquee);break;case"u":g(n.ImageEditorTool.Rect);break;case"l":g(n.ImageEditorTool.Line);break;case"c":g(n.ImageEditorTool.Circle);break;case"-":case"_":m(-1);break;case"=":case"+":m(1);break;case"x":f((0,s.dispatchSwapBackgroundForeground)());break;case"H":T(!1);break;case"V":T(!0);break;case"[":E(!1);break;case"]":E(!0);break;case">":_(!0);break;case"<":_(!1)}const t=a.getState().editor;if(e.shiftKey&&"KeyR"===e.code)I(t.backgroundColor,t.selectedColor);else if(!t.isTilemap&&/^Digit\d$/.test(e.code)){const t=+e.code.slice(-1)+(e.shiftKey?9:0);t>=0&&t<16&&function(e){f((0,s.dispatchChangeSelectedColor)(e))}(t)}}function p(){const e=a.getState();if(e.editor.isTilemap){const t=e.store.present;return[(0,r.getEditState)(t.tilemap,!0,e.editor.drawingMode),"tilemap"]}{const t=e.store.present;return[(0,r.getEditState)(t.frames[t.currentFrame],!1,e.editor.drawingMode),t.frames.length>1?"animation":"image"]}}function g(e){f((0,s.dispatchChangeImageTool)(e))}function m(e){f((0,s.dispatchChangeZoom)(e))}function f(e){a.dispatch(e)}function _(e){let t;const i=a.getState().editor.cursorSize;switch(i){case 1:t=e?3:1;break;case 3:t=e?5:1;break;case 5:t=e?5:3}i!==t&&f((0,s.dispatchChangeCursorSize)(t))}function T(e){const[t,i]=p(),n=(0,r.flipEdit)(t,e,"tilemap"===i);f((0,s.dispatchImageEdit)(n.toImageState()))}function E(e){const[t,i]=p(),n=(0,r.rotateEdit)(t,e,"tilemap"===i,"animation"===i);f((0,s.dispatchImageEdit)(n.toImageState()))}function b(e){const[t,i]=p();if("tilemap"===i)return;const n=(0,r.outlineEdit)(t,e);f((0,s.dispatchImageEdit)(n.toImageState()))}function I(e,t){const[i,n]=p(),o=(0,r.replaceColorEdit)(i,e,t);f((0,s.dispatchImageEdit)(o.toImageState()))}i.addKeyListener=function(){l=[],document.addEventListener("keydown",d),document.addEventListener("keydown",u,!0),document.addEventListener("keydown",h,!0)},i.removeKeyListener=function(){document.removeEventListener("keydown",d),document.removeEventListener("keydown",u,!0),document.removeEventListener("keydown",h,!0)},i.obtainShortcutLock=function(){let e=0;for(;!e;)e=Math.random()*Number.MAX_SAFE_INTEGER;return l.push(e),e},i.releaseShortcutLock=function(e){const t=l.indexOf(e);-1!==t&&l.splice(t,1)},i.areShortcutsEnabled=c,i.setStore=function(e){a=e||o.mainStore},i.flip=T,i.rotate=E,i.outline=b,i.replaceColor=I},{"./actions/dispatch":156,"./store/imageReducer":160,"./store/imageStore":161,"./toolDefinitions":164}],159:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Palette=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-redux"),r=e("../actions/dispatch");class a extends s.Component{constructor(){super(...arguments),this.handlers=[],this.preventContextMenu=e=>e.preventDefault()}render(){const{colors:e,selected:t,backgroundColor:i,dispatchSwapBackgroundForeground:s}=this.props;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:"image-editor-colors",viewBox:"0 0 23 15",onClick:s},{children:[(0,n.jsx)("defs",{children:(0,n.jsxs)("pattern",Object.assign({id:"alpha-background",width:"6",height:"6",patternUnits:"userSpaceOnUse"},{children:[(0,n.jsx)("rect",{x:"0",y:"0",width:"6px",height:"6px",fill:"#aeaeae"}),(0,n.jsx)("rect",{x:"0",y:"0",width:"3px",height:"3px",fill:"#dedede"}),(0,n.jsx)("rect",{x:"3",y:"3",width:"3px",height:"3px",fill:"#dedede"})]}))}),(0,n.jsxs)("g",{children:[(0,n.jsx)("rect",Object.assign({fill:i?e[i]:"url(#alpha-background)",x:6,y:4,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},{children:(0,n.jsx)("title",{children:l(i,e[i])})})),(0,n.jsx)("rect",Object.assign({fill:t?e[t]:"url(#alpha-background)",x:2,y:1,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},{children:(0,n.jsx)("title",{children:l(t,e[t])})}))]})]})),(0,n.jsx)("div",Object.assign({className:"image-editor-color-buttons",onContextMenu:this.preventContextMenu},{children:this.props.colors.map(((e,t)=>(0,n.jsx)("div",{className:"image-editor-button "+(0===t?"checkerboard":""),role:"button",title:l(t,e),onMouseDown:this.clickHandler(t),style:0===t?null:{backgroundColor:e}},t)))}))]})}clickHandler(e){return this.handlers[e]||(this.handlers[e]=t=>{0===t.button?this.props.dispatchChangeSelectedColor(e):(this.props.dispatchChangeBackgroundColor(e),t.preventDefault(),t.stopPropagation())}),this.handlers[e]}}function l(e,t){const i=0===e?lf("transparency"):function(e){switch(null==e?void 0:e.toLowerCase()){case"#ffffff":return lf("white");case"#ff2121":return lf("red");case"#ff93c4":return lf("pink");case"#ff8135":return lf("orange");case"#fff609":return lf("yellow");case"#249ca3":return lf("teal");case"#78dc52":return lf("green");case"#003fad":return lf("blue");case"#87f2ff":return lf("light blue");case"#8e2ec4":return lf("purple");case"#a4839f":return lf("light purple");case"#5c406c":return lf("dark purple");case"#e5cdc4":return lf("tan");case"#91463d":return lf("brown");case"#000000":return lf("black");default:return}}(t);return i?lf("Color {0} ({1})",e,i):lf("Color {0}",e)}const c={dispatchChangeSelectedColor:r.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:r.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:r.dispatchSwapBackgroundForeground};i.Palette=(0,o.connect)((function({store:{present:e},editor:t},i){let n=e;return n?{selected:t.selectedColor,backgroundColor:t.backgroundColor,colors:n.colors}:{}}),c)(a)},{"../actions/dispatch":156,react:255,"react-redux":241,"react/jsx-runtime":256}],160:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setTelemetryFunction=i.TileDrawingMode=i.TileCategory=i.KeyModifiers=i.CursorSize=i.ImageEditorTool=void 0;const n=e("../../../assets"),s=e("../actions/types");var o,r,a,l;(l=o=i.ImageEditorTool||(i.ImageEditorTool={}))[l.Paint=0]="Paint",l[l.Fill=1]="Fill",l[l.Line=2]="Line",l[l.Erase=3]="Erase",l[l.Circle=4]="Circle",l[l.Rect=5]="Rect",l[l.ColorSelect=6]="ColorSelect",l[l.Marquee=7]="Marquee",l[l.Pan=8]="Pan",function(e){e[e.One=1]="One",e[e.Three=3]="Three",e[e.Five=5]="Five"}(i.CursorSize||(i.CursorSize={})),function(e){e[e.Alt=1]="Alt",e[e.Shift=2]="Shift"}(i.KeyModifiers||(i.KeyModifiers={})),function(e){e[e.Forest=0]="Forest",e[e.Aquatic=1]="Aquatic",e[e.Dungeon=2]="Dungeon",e[e.Misc=3]="Misc"}(r=i.TileCategory||(i.TileCategory={})),function(e){e.Default="default",e.Wall="wall"}(a=i.TileDrawingMode||(i.TileDrawingMode={}));const c={store:{present:{kind:"Animation",visible:!0,colors:["#000000","#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"],aspectRatioLocked:!1,currentFrame:0,frames:[g(16,16)],interval:200},past:[],future:[]},editor:{selectedColor:3,tool:o.Paint,cursorSize:1,backgroundColor:1,previewAnimating:!1,onionSkinEnabled:!1,overlayEnabled:!0,tilesetRevision:0,isTilemap:!1}},u=(e,t)=>{switch(t.type){case s.TOGGLE_ASPECT_RATIO:return f("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},e),{aspectRatioLocked:!e.aspectRatioLocked});case s.CHANGE_CURRENT_FRAME:return f("change-frame"),Object.assign(Object.assign({},e),{currentFrame:t.index});case s.CHANGE_INTERVAL:return f("change-interval"),Object.assign(Object.assign({},e),{interval:t.newInterval});case s.CHANGE_IMAGE_DIMENSIONS:f("change-dimensions");const[i,n]=t.imageDimensions;return Object.assign(Object.assign({},e),{frames:e.frames.map(((e,t)=>Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).resize(i,n).data()})))});case s.IMAGE_EDIT:return f("image-edit"),Object.assign(Object.assign({},e),{frames:e.frames.map(((i,n)=>n===e.currentFrame?t.newState:i))});case s.DELETE_FRAME:if(1===e.frames.length)return e;f("delete-frame");const o=e.frames.slice();o.splice(t.index,1);let r=e.currentFrame;return e.currentFrame>=t.index&&e.currentFrame>0&&r--,Object.assign(Object.assign({},e),{currentFrame:r,frames:o});case s.DUPLICATE_FRAME:f("duplicate-frame");const a=e.frames.slice();return a.splice(t.index,0,function(e){let t,i,n;return e.floating&&(e.floating.bitmap&&(i=pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy().data()),e.floating.overlayLayers&&(n=e.floating.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy().data()))),t={bitmap:i,overlayLayers:n}),Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).copy().data(),overlayLayers:e.overlayLayers&&e.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy().data())),floating:t})}(e.frames[t.index])),Object.assign(Object.assign({},e),{frames:a,currentFrame:t.index+1});case s.NEW_FRAME:return f("new-frame"),Object.assign(Object.assign({},e),{frames:[...e.frames,g(e.frames[0].bitmap.width,e.frames[0].bitmap.height)],currentFrame:e.frames.length});case s.MOVE_FRAME:if(t.newIndex<0||t.newIndex>=e.frames.length||t.newIndex<0||t.newIndex>=e.frames.length)return e;f("move-frame");const l=e.frames.slice(),c=l.splice(t.oldIndex,1)[0];return l.splice(t.newIndex,0,c),Object.assign(Object.assign({},e),{frames:l,currentFrame:t.oldIndex===e.currentFrame?t.newIndex:e.currentFrame});case s.SET_FRAMES:return f("set-frames"),Object.assign(Object.assign({},e),{frames:t.frames,currentFrame:0});default:return e}},h=(e,t,i)=>{let n;switch(t.type){case s.CHANGE_PREVIEW_ANIMATING:return f("preview-animate-"+(t.animating?"on":"off")),Object.assign(Object.assign({},e),{previewAnimating:t.animating});case s.CHANGE_CANVAS_ZOOM:return(t.zoom>0||t.zoom<0)&&f("zoom-"+(t.zoom>0?"in":"out")),Object.assign(Object.assign({},e),{zoomDelta:t.zoom});case s.CHANGE_IMAGE_TOOL:return f(`change-tool-${o[t.tool]}`),Object.assign(Object.assign({},e),{tool:t.tool});case s.CHANGE_CURSOR_SIZE:return f(`change-cursor-size-${t.cursorSize}`),Object.assign(Object.assign({},e),{cursorSize:t.cursorSize});case s.CHANGE_SELECTED_COLOR:return f(`foreground-color-${t.selectedColor}`),Object.assign(Object.assign({},e),{selectedColor:t.selectedColor,tool:e.tool===o.Erase?o.Paint:e.tool});case s.CHANGE_CURSOR_LOCATION:return Object.assign(Object.assign({},e),{cursorLocation:t.cursorLocation});case s.CHANGE_BACKGROUND_COLOR:return f(`background-color-${t.backgroundColor}`),Object.assign(Object.assign({},e),{backgroundColor:t.backgroundColor});case s.SWAP_FOREGROUND_BACKGROUND:return f("swap-foreground-background"),Object.assign(Object.assign({},e),{backgroundColor:e.selectedColor,selectedColor:e.backgroundColor});case s.TOGGLE_ONION_SKIN_ENABLED:return f("toggle-onion-skin"),Object.assign(Object.assign({},e),{onionSkinEnabled:!e.onionSkinEnabled});case s.CHANGE_TILE_PALETTE_CATEGORY:return f(`change-tile-category-${r[t.category]}`),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{category:t.category,page:0})});case s.CHANGE_TILE_PALETTE_PAGE:return f("change-tile-page"),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:t.page})});case s.CHANGE_DRAWING_MODE:return f("change-drawing-mode"),Object.assign(Object.assign({},e),{drawingMode:t.drawingMode||a.Default});case s.CHANGE_OVERLAY_ENABLED:return f("change-overlay-enabled"),Object.assign(Object.assign({},e),{overlayEnabled:t.enabled});case s.CREATE_NEW_TILE:return n=e.editedTiles,!t.tile||n&&-1!==n.indexOf(t.tile.id)||(n=(n||[]).concat([t.tile.id])),Object.assign(Object.assign({},e),{editedTiles:n,selectedColor:t.foreground,backgroundColor:t.background});case s.SET_GALLERY_OPEN:return f(`set-gallery-open-${t.open}`),Object.assign(Object.assign({},e),{tileGalleryOpen:t.open,tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:0})});case s.DELETE_TILE:return Object.assign(Object.assign({},e),{deletedTiles:(e.deletedTiles||[]).concat([t.id]),selectedColor:t.index===e.selectedColor?0:e.selectedColor,backgroundColor:t.index===e.backgroundColor?0:e.backgroundColor,tilesetRevision:e.tilesetRevision+1});case s.OPEN_TILE_EDITOR:const l=t.index?"edit":"new";return f(`open-tile-editor-${l}`),Object.assign(Object.assign({},e),{editingTile:{type:l,tilesetIndex:t.index}});case s.CLOSE_TILE_EDITOR:return n=e.editedTiles,!t.result||n&&-1!==n.indexOf(t.result.id)||(n=(n||[]).concat([t.result.id])),Object.assign(Object.assign({},e),{editedTiles:n,selectedColor:t.index||i.present.tileset.tiles.length,editingTile:void 0,tilesetRevision:e.tilesetRevision+1});case s.SHOW_ALERT:return f("show-alert"),Object.assign(Object.assign({},e),{alert:{title:t.title,text:t.text,options:t.options}});case s.HIDE_ALERT:return f("hide-alert"),Object.assign(Object.assign({},e),{alert:null});case s.DISABLE_RESIZE:return Object.assign(Object.assign({},e),{resizeDisabled:!0})}return e},d=(e,t)=>{switch(t.type){case s.TOGGLE_ASPECT_RATIO:return f("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},e),{aspectRatioLocked:!e.aspectRatioLocked});case s.CHANGE_IMAGE_DIMENSIONS:f("change-dimensions");const[i,o]=t.imageDimensions;return Object.assign(Object.assign({},e),{tilemap:Object.assign(Object.assign({},e.tilemap),{bitmap:E(e.tilemap.bitmap,i,o),overlayLayers:e.tilemap.overlayLayers&&e.tilemap.overlayLayers.map((e=>function(e,t,i){return pxt.sprite.Bitmap.fromData(e).resize(t,i).data()}(e,i,o)))})});case s.CREATE_NEW_TILE:const r=!t.qualifiedName;let a;return f(r?"new-tile":`used-tile-${t.qualifiedName}`),r?(a=t.tile).isProjectTile=!0:a=(0,n.lookupAsset)("tile",t.qualifiedName),Object.assign(Object.assign({},e),{tileset:Object.assign(Object.assign({},e.tileset),{tiles:e.tileset.tiles.concat([a])}),nextId:r?e.nextId+1:e.nextId});case s.CLOSE_TILE_EDITOR:return f("close-tile-editor"),t.result?t.index?Object.assign(Object.assign({},e),{tileset:p(e.tileset,t.index,t.result)}):Object.assign(Object.assign({},e),{tileset:Object.assign(Object.assign({},e.tileset),{tiles:e.tileset.tiles.concat([t.result])}),nextId:e.nextId+1}):e;case s.DELETE_TILE:f("delete-tile");const l=e.tileset.tiles.slice();return l.splice(t.index,1),Object.assign(Object.assign({},e),{tilemap:Object.assign(Object.assign({},e.tilemap),{bitmap:T(t.index,pxt.sprite.Tilemap.fromData(e.tilemap.bitmap)).data()}),tileset:Object.assign(Object.assign({},e.tileset),{tiles:l})});case s.IMAGE_EDIT:return f("image-edit"),Object.assign(Object.assign({},e),{tilemap:t.newState});default:return e}};function p(e,t,i){return Object.assign(Object.assign({},e),{tiles:e.tiles.map(((e,n)=>n===t?i:e))})}function g(e,t){return{bitmap:new pxt.sprite.Bitmap(e,t).data()}}let m;function f(e){m&&m(e)}function _(e,t){for(const i of e.tiles)if(!i.jresData&&!i.isProjectTile)for(const e of t)if(e.qualifiedName===i.id){i.bitmap=e.bitmap;break}return e}function T(e,t){const i=t.copy();for(let t=0;t<i.width;t++)for(let n=0;n<i.height;n++){const s=i.get(t,n);s===e?i.set(t,n,0):s>e&&i.set(t,n,s-1)}return i}function E(e,t,i){return pxt.sprite.Tilemap.fromData(e).resize(t,i).data()}function b(e,t){return"tilemap"===e.type?function(e,t){return{kind:"Tilemap",asset:e,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:!1,tilemap:{bitmap:e.data.tilemap.data(),overlayLayers:[e.data.layers]},tileset:_(e.data.tileset,t),nextId:e.data.nextId}}(e,t):function(e){return{kind:"Animation",asset:e,visible:!0,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:"tile"===e.type,currentFrame:0,frames:"animation"===e.type?e.frames.map((e=>({bitmap:e}))):[{bitmap:e.bitmap}],interval:"animation"===e.type?e.interval:100}}(e)}i.setTelemetryFunction=function(e){m=e},i.default=(e=c,t)=>{var i;switch(t.type){case s.OPEN_TILE_EDITOR:case s.CHANGE_PREVIEW_ANIMATING:case s.CHANGE_CANVAS_ZOOM:case s.CHANGE_IMAGE_TOOL:case s.CHANGE_CURSOR_SIZE:case s.CHANGE_SELECTED_COLOR:case s.CHANGE_CURSOR_LOCATION:case s.CHANGE_BACKGROUND_COLOR:case s.SWAP_FOREGROUND_BACKGROUND:case s.TOGGLE_ONION_SKIN_ENABLED:case s.CHANGE_OVERLAY_ENABLED:case s.CHANGE_TILE_PALETTE_PAGE:case s.CHANGE_TILE_PALETTE_CATEGORY:case s.CHANGE_DRAWING_MODE:case s.SET_GALLERY_OPEN:case s.SHOW_ALERT:case s.HIDE_ALERT:case s.DISABLE_RESIZE:return Object.assign(Object.assign({},e),{editor:h(e.editor,t,e.store)});case s.SET_INITIAL_STATE:const o=t.state;return Object.assign(Object.assign({},e),{editor:Object.assign(Object.assign({},c.editor),{selectedColor:o.selectedColor,backgroundColor:o.backgroundColor,tilemapPalette:o.tilemapPalette,tileGalleryOpen:o.tileGalleryOpen,tileGallery:o.tileGallery,isTilemap:o.isTilemap,referencedTiles:e.editor.referencedTiles}),store:Object.assign(Object.assign({},e.store),{past:t.past||e.store.past,future:t.past?[]:e.store.future})});case s.OPEN_ASSET:const l=t.asset,p=t.gallery||(t.keepPast?e.editor.tileGallery:[]);let g=-1;if("tilemap"===l.type){const e=t.asset.data;if(pxt.sprite.isEmptyTilemap(e)){const t=e.tileset.tiles||[],s=null===(i=p.find((e=>-1!==e.tags.indexOf("forest"))))||void 0===i?void 0:i.qualifiedName,o=(0,n.lookupAsset)("tile",s);o&&!t.find((e=>e.id===s))&&t.push(o),g=t.indexOf(o)}}return Object.assign(Object.assign({},e),{editor:"tilemap"===l.type?{selectedColor:g,backgroundColor:-1,isTilemap:!0,tilemapPalette:{category:r.Forest,page:0},drawingMode:a.Default,overlayEnabled:!0,tileGallery:p,tileGalleryOpen:!!p,referencedTiles:l.data.projectReferences,previewAnimating:!1,onionSkinEnabled:!1,tilesetRevision:0,tool:t.keepPast?e.editor.tool:c.editor.tool,cursorSize:t.keepPast?e.editor.cursorSize:c.editor.cursorSize,editedTiles:t.keepPast?e.editor.editedTiles:void 0,deletedTiles:t.keepPast?e.editor.deletedTiles:void 0}:{isTilemap:!1,tilesetRevision:0,selectedColor:t.keepPast?e.editor.selectedColor:c.editor.selectedColor,backgroundColor:t.keepPast?e.editor.backgroundColor:c.editor.backgroundColor,previewAnimating:t.keepPast?e.editor.previewAnimating:c.editor.previewAnimating,tool:t.keepPast?e.editor.tool:c.editor.tool,onionSkinEnabled:t.keepPast?e.editor.onionSkinEnabled:c.editor.onionSkinEnabled,cursorSize:t.keepPast?e.editor.cursorSize:c.editor.cursorSize,resizeDisabled:t.keepPast?e.editor.resizeDisabled:c.editor.resizeDisabled},store:Object.assign(Object.assign({},e.store),{past:t.keepPast?e.store.past:[],present:b(t.asset,p),future:[]})});case s.CHANGE_ASSET_NAME:return f("change-asset-name"),Object.assign(Object.assign({},e),{store:{past:[...e.store.past,e.store.present],present:Object.assign(Object.assign({},e.store.present),{asset:Object.assign(Object.assign({},e.store.present.asset),{meta:Object.assign(Object.assign({},e.store.present.asset.meta||{}),{displayName:t.name})})}),future:[]}});case s.UNDO_IMAGE_EDIT:return e.store.past.length?(f("undo"),Object.assign(Object.assign({},e),{store:Object.assign(Object.assign({},e.store),{past:e.store.past.slice(0,e.store.past.length-1),present:e.store.past[e.store.past.length-1],future:[...e.store.future,e.store.present]}),editor:Object.assign(Object.assign({},e.editor),{tilesetRevision:e.editor.tilesetRevision+1})})):e;case s.REDO_IMAGE_EDIT:return e.store.future.length?(f("redo"),Object.assign(Object.assign({},e),{store:Object.assign(Object.assign({},e.store),{past:[...e.store.past,e.store.present],present:e.store.future[e.store.future.length-1],future:e.store.future.slice(0,e.store.future.length-1)}),editor:Object.assign(Object.assign({},e.editor),{tilesetRevision:e.editor.tilesetRevision+1})})):e;default:return Object.assign(Object.assign({},e),{editor:h(e.editor,t,e.store),store:Object.assign(Object.assign({},e.store),{past:[...e.store.past,e.store.present],present:e.editor.isTilemap?d(e.store.present,t):u(e.store.present,t),future:[]})})}}},{"../../../assets":141,"../actions/types":157}],161:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.mainStore=i.tileEditorStore=void 0;const n=e("redux"),s=e("./imageReducer"),o=(0,n.createStore)(s.default);i.default=o,i.tileEditorStore=(0,n.createStore)(s.default),i.mainStore=o},{"./imageReducer":160,redux:257}],162:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Minimap=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-redux"),r=e("../ImageEditor"),a=pxt.BrowserUtils.isEdge()?25:1;class l extends s.Component{constructor(){super(...arguments),this.tileColors=[]}componentDidMount(){this.canvas=this.refs["minimap-canvas"],this.redrawCanvas()}componentDidUpdate(){this.redrawCanvas()}render(){return(0,n.jsx)("div",Object.assign({className:"minimap-outer"},{children:(0,n.jsx)("canvas",{ref:"minimap-canvas",className:"paint-surface"})}))}redrawCanvas(){const{tilemap:e,lightMode:t}=this.props;let{bitmap:i,floating:n,layerOffsetX:s,layerOffsetY:o}=e;const l=this.canvas.getContext("2d"),c=pxt.sprite.Tilemap.fromData(i),u=n&&n.bitmap?pxt.sprite.Tilemap.fromData(n.bitmap):null;this.canvas.width=c.width*a,this.canvas.height=c.height*a,this.tileColors=[];for(let e=0;e<c.width;e++)for(let i=0;i<c.height;i++){const n=u?u.get(e-s,i-o):null,h=c.get(e,i);n?(l.fillStyle=this.getColor(n),l.fillRect(e*a,i*a,a,a)):h?(l.fillStyle=this.getColor(h),l.fillRect(e*a,i*a,a,a)):t?(l.fillStyle=r.LIGHT_MODE_TRANSPARENT,l.fillRect(e*a,i*a,a,a)):l.clearRect(e*a,i*a,a,a)}}getColor(e){if(!this.tileColors[e]){const{tileset:t,colors:i}=this.props;if(e>=t.tiles.length)return"#ffffff";const n=pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap);this.tileColors[e]=pxt.sprite.computeAverageColor(n,i)}return this.tileColors[e]}}i.Minimap=(0,o.connect)((function({store:{present:e},editor:t},i){let n=e;return n?{tilemap:n.tilemap,tileset:n.tileset,colors:n.colors}:{}}),{})(l)},{"../ImageEditor":149,react:255,"react-redux":241,"react/jsx-runtime":256}],163:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TilePalette=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-redux"),r=e("../store/imageReducer"),a=e("../actions/dispatch"),l=e("../TimelineFrame"),c=e("../Dropdown"),u=e("../Pivot"),h=e("../Button"),d=e("../../../assets"),p=pxt.BrowserUtils.isEdge()?25:1,g=[{id:"forest",text:lf("Forest"),tiles:[]},{id:"aquatic",text:lf("Aquatic"),tiles:[]},{id:"dungeon",text:lf("Dungeon"),tiles:[]},{id:"misc",text:lf("Miscellaneous"),tiles:[]}],m=[{id:"custom",text:lf("My Tiles")},{id:"gallery",text:lf("Gallery")}],f=new pxt.sprite.Bitmap(16,16);class _ extends s.Component{constructor(e){super(e),this.dropdownHandler=(e,t)=>{this.props.dispatchChangeTilePaletteCategory(t)},this.pivotHandler=(e,t)=>{this.props.dispatchSetGalleryOpen(1===t)},this.pageHandler=e=>{this.props.dispatchChangeTilePalettePage(e)},this.tileCreateHandler=()=>{this.props.dispatchOpenTileEditor()},this.tileEditHandler=()=>{const{tileset:e,selected:t,dispatchOpenTileEditor:i}=this.props,n=e.tiles[t];(null==n?void 0:n.isProjectTile)&&0!==t&&i(t,n.id)},this.tileDuplicateHandler=()=>{var e;const{tileset:t,selected:i,backgroundColor:n,dispatchCreateNewTile:s}=this.props;if(!t.tiles[i]||!t.tiles[i].isProjectTile||0===i)return;const o=t.tiles[i];s((0,d.createTile)(o.bitmap,null,null===(e=o.meta)||void 0===e?void 0:e.displayName),t.tiles.length,n)},this.tileDeleteAlertHandler=()=>{const{tileset:e,selected:t,dispatchShowAlert:i,dispatchHideAlert:n,referencedTiles:s}=this.props,o=e.tiles[t];t&&o&&o.isProjectTile&&(s&&-1!==s.indexOf(o.id)?i(lf("Unable to delete"),lf("This tile is used in your game. Remove all blocks using the tile before deleting."),[{label:lf("Cancel"),onClick:n}]):i(lf("Are you sure?"),lf("Deleting this tile will remove it from all other tile maps in your game."),[{label:lf("Yes"),onClick:this.deleteTile},{label:lf("No"),onClick:n}]))},this.deleteTile=()=>{const e=this.props.tileset.tiles[this.props.selected];e&&this.props.dispatchDeleteTile(this.props.selected,e.id)},this.canvasClickHandler=e=>{this.handleCanvasClickCore(e.clientX,e.clientY,e.button>0)},this.canvasTouchHandler=e=>{this.handleCanvasClickCore(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!1)},this.foregroundBackgroundClickHandler=()=>{this.props.drawingMode!=r.TileDrawingMode.Default?this.props.dispatchChangeDrawingMode(r.TileDrawingMode.Default):this.props.dispatchSwapBackgroundForeground()},this.wallClickHandler=()=>{this.props.drawingMode===r.TileDrawingMode.Wall?this.props.dispatchChangeDrawingMode(r.TileDrawingMode.Default):this.props.dispatchChangeDrawingMode(r.TileDrawingMode.Wall)},this.preventContextMenu=e=>e.preventDefault();const{gallery:t}=e;if(this.refreshGallery(e),t){const e={};for(const i of t){const t=i.tags.find((e=>pxt.Util.startsWith(e,"category-")));t&&(e[t]||(e[t]={id:t,text:pxt.Util.rlf(`{id:tilecategory}${t.substr(9)}`),tiles:[]}),e[t].tiles.push(i))}this.categories=g.concat(Object.keys(e).map((t=>e[t])))}else this.categories=[]}componentDidMount(){this.canvas=this.refs["tile-canvas-surface"],this.updateGalleryTiles(),this.redrawCanvas()}UNSAFE_componentWillReceiveProps(e){this.props.selected!=e.selected?this.jumpToPageContaining(e.selected):this.props.backgroundColor!=e.backgroundColor&&this.jumpToPageContaining(e.backgroundColor),this.refreshGallery(e)}componentDidUpdate(){this.updateGalleryTiles(),this.redrawCanvas()}render(){const{colors:e,selected:t,backgroundColor:i,tileset:s,category:o,page:a,drawingMode:d,galleryOpen:p}=this.props,g=s.tiles[t]?s.tiles[t].bitmap:f.data(),_=s.tiles[i]?s.tiles[i].bitmap:f.data();f.data(),this.updateGalleryTiles();let b=Math.ceil(this.categoryTiles.length/16);p||this.categoryTiles.length%16!=0||b++;const I=!p&&(1===b||a===b-1),y=p||!this.renderedTiles.some((e=>!E(e)&&e.index===t));return(0,n.jsxs)("div",Object.assign({className:"tile-palette"},{children:[(0,n.jsxs)("div",Object.assign({className:"tile-palette-fg-bg"},{children:[(0,n.jsx)("div",Object.assign({className:"tile-palette-swatch fg "+(d==r.TileDrawingMode.Default?"selected":""),onClick:this.foregroundBackgroundClickHandler,role:"button"},{children:(0,n.jsx)(l.TimelineFrame,{frames:[{bitmap:g}],colors:e})})),(0,n.jsxs)("div",Object.assign({className:"tile-palette-swatch bg",onClick:this.foregroundBackgroundClickHandler,role:"button"},{children:[(0,n.jsx)(l.TimelineFrame,{frames:[{bitmap:_}],colors:e}),(0,n.jsx)(h.IconButton,{iconClass:"ms-Icon ms-Icon--ReturnKey",title:lf("Swap the background and foreground colors."),toggle:!0})]})),(0,n.jsx)("div",Object.assign({className:"tile-palette-swatch wall "+(d==r.TileDrawingMode.Wall?"selected":""),onClick:this.wallClickHandler,title:lf("Draw walls"),role:"button"},{children:(0,n.jsx)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1000 1000",width:"1000",height:"1000"},{children:(0,n.jsx)("path",{d:"M 968.49289,108.05443 771.30518,3.7581533 183.65231,166.0694 l 2.58963,202.62638 -156.247366,54.4148 0.872799,492.65563 179.544267,81.08212 758.08125,-222.4989 z M 765.6275,42.836761 916.79721,122.02922 412.26526,262.35026 250.08966,187.43643 Z M 934.62189,739.077 234.56171,946.92199 233.81426,554.79578 422.38222,493.25053 423.42046,300.4059 934.62189,157.54989 Z M 204.96854,402.33519 361.49056,473.98651 222.88861,518.46222 75.008408,444.5191 Z"})}))}))]})),(0,n.jsx)(u.Pivot,{options:m,selected:p?1:0,onChange:this.pivotHandler}),(0,n.jsxs)("div",Object.assign({className:"tile-palette-controls-outer"},{children:[p&&(0,n.jsx)(c.Dropdown,{onChange:this.dropdownHandler,options:this.categories.filter((e=>!!e.tiles.length)),selected:o}),!p&&(0,n.jsxs)("div",Object.assign({className:"tile-palette-controls"},{children:[(0,n.jsx)(h.IconButton,{onClick:this.tileEditHandler,iconClass:"ms-Icon ms-Icon--SingleColumnEdit",title:lf("Edit the selected tile"),disabled:y,toggle:!y}),(0,n.jsx)(h.IconButton,{onClick:this.tileDuplicateHandler,iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate the selected tile"),disabled:y,toggle:!y}),(0,n.jsx)(h.IconButton,{onClick:this.tileDeleteAlertHandler,iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete the selected tile"),disabled:y,toggle:!y})]}))]})),(0,n.jsxs)("div",Object.assign({className:"tile-canvas-outer",onContextMenu:this.preventContextMenu},{children:[(0,n.jsxs)("div",Object.assign({className:"tile-canvas"},{children:[(0,n.jsx)("canvas",{ref:"tile-canvas-surface",className:"paint-surface",onMouseDown:this.canvasClickHandler,onTouchStart:this.canvasTouchHandler,role:"complementary"}),I&&(0,n.jsx)("div",Object.assign({ref:"create-tile-ref"},{children:(0,n.jsx)(h.IconButton,{onClick:this.tileCreateHandler,iconClass:"ms-Icon ms-Icon--Add",title:lf("Create a new tile"),toggle:!0})}))]})),(0,n.jsx)("div",Object.assign({className:"tile-canvas-controls"},{children:T(b,a,this.pageHandler)}))]}))]}))}updateGalleryTiles(){const{page:e,category:t,galleryOpen:i}=this.props;this.categoryTiles=i?this.categories[t].tiles:this.getCustomTiles().map((([e,t])=>({index:t,bitmap:e.bitmap})));const n=16*e;this.renderedTiles=this.categoryTiles.slice(n,n+16)}jumpToPageContaining(e){const{tileset:t,dispatchSetGalleryOpen:i,dispatchChangeTilePaletteCategory:n,dispatchChangeTilePalettePage:s}=this.props;if(!e||e<0||e>=t.tiles.length)return;const o=t.tiles[e];if(o.isProjectTile){const e=this.getCustomTiles().map((([e,t])=>e));if(!e)return;const t=Math.max(Math.floor(e.findIndex((e=>e.id==o.id))/16),0);i(!1),s(t)}else{const e=this.categories.find((e=>-1!==e.tiles.findIndex((e=>e.qualifiedName==o.id))));if(!e||!e.tiles)return;const t=Math.max(Math.floor(e.tiles.findIndex((e=>e.qualifiedName==o.id))/16),0);i(!0),n(this.categories.indexOf(e)),s(t)}}redrawCanvas(){const{tileset:e,page:t,selected:i}=this.props,n=4*t*4,s=e.tileWidth+1;this.canvas.width=(4*s+1)*p,this.canvas.height=(4*s+1)*p;const o=this.canvas.getContext("2d");for(let e=0;e<4;e++)for(let t=0;t<4;t++){const r=this.categoryTiles[n+4*e+t];r&&(E(r)||r.index!==i||(o.fillStyle="#ff0000",o.fillRect(t*s,e*s,s+1,s+1)),o.fillStyle="#333333",o.fillRect(t*s+1,e*s+1,s-1,s-1),this.drawBitmap(pxt.sprite.Bitmap.fromData(r.bitmap),1+t*s,1+e*s))}this.positionCreateTileButton()}drawBitmap(e,t=0,i=0,n=!0,s=p,o=this.canvas){const{colors:r}=this.props,a=o.getContext("2d");a.imageSmoothingEnabled=!1;for(let o=0;o<e.width;o++)for(let l=0;l<e.height;l++){const c=e.get(o,l);c?(a.fillStyle=r[c],a.fillRect((o+t)*s,(l+i)*s,s,s)):n||a.clearRect((o+t)*s,(l+i)*s,s,s)}}handleCanvasClickCore(e,t,i){const n=this.canvas.getBoundingClientRect(),s=(e-n.left)/(n.width/4)|0,o=(t-n.top)/(n.height/4)|0,a=this.renderedTiles[4*o+s];if(a){let e,t;if(E(a)?(e=this.getTileIndex(a),t=a.qualifiedName):e=a.index,e>=0)i?this.props.dispatchChangeBackgroundColor(e):this.props.dispatchChangeSelectedColor(e);else{const{selected:e,backgroundColor:n,tileset:s}=this.props,o=s.tiles.length||1;this.props.dispatchCreateNewTile(null,i?e:o,i?o:n,t)}this.props.dispatchChangeDrawingMode(r.TileDrawingMode.Default)}}refreshGallery(e){const{gallery:t,tileset:i}=e;t&&g.forEach((e=>{e.tiles=t.filter((t=>-1!==t.tags.indexOf(e.id)&&t.tileWidth===i.tileWidth))}))}positionCreateTileButton(){const e=this.refs["create-tile-ref"];if(e){const t=this.categoryTiles.length%4,i=Math.floor(this.categoryTiles.length/4)%4;e.style.position="absolute",e.style.left="calc("+t/4+" * (100% - 0.5rem) + 0.25rem)",e.style.top="calc("+i/4+" * (100% - 0.5rem) + 0.25rem)"}}getCustomTiles(){return this.props.tileset.tiles.map(((e,t)=>[e,t])).filter((([e])=>e.isProjectTile)).sort((([e],[t])=>{const i="myTiles.transparency"+this.props.tileset.tileWidth;return e.id==i?-1:t.id==i?1:e.internalID-t.internalID}))}getTileIndex(e){const{tileset:t}=this.props;for(let i=0;i<t.tiles.length;i++)if(t.tiles[i].id===e.qualifiedName)return i;return-1}}function T(e,t,i){const s=16+5*(e-1),o=[];for(let i=0;i<e;i++)o[i]=i===t;return(0,n.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${s} 10`,className:"tile-palette-pages "+(e<2?"disabled":"")},{children:[(0,n.jsx)("polygon",{className:"tile-palette-page-arrow",points:"1,5 4,3 4,7",onClick:t?()=>i(t-1):void 0}),o.map(((e,t)=>(0,n.jsx)("circle",{className:"tile-palette-page-dot",cx:8+5*t,cy:"5",r:e?2:1,onClick:e?void 0:()=>i(t)},t))),(0,n.jsx)("polygon",{className:"tile-palette-page-arrow",points:`${s-1},5 ${s-4},3 ${s-4},7`,onClick:t<e-1?()=>i(t+1):void 0})]}))}function E(e){return!!e.qualifiedName}const b={dispatchChangeSelectedColor:a.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:a.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:a.dispatchSwapBackgroundForeground,dispatchChangeTilePalettePage:a.dispatchChangeTilePalettePage,dispatchChangeTilePaletteCategory:a.dispatchChangeTilePaletteCategory,dispatchChangeDrawingMode:a.dispatchChangeDrawingMode,dispatchCreateNewTile:a.dispatchCreateNewTile,dispatchSetGalleryOpen:a.dispatchSetGalleryOpen,dispatchOpenTileEditor:a.dispatchOpenTileEditor,dispatchDeleteTile:a.dispatchDeleteTile,dispatchShowAlert:a.dispatchShowAlert,dispatchHideAlert:a.dispatchHideAlert};i.TilePalette=(0,o.connect)((function({store:{present:e},editor:t},i){let n=e;return n?{selected:t.selectedColor,tileset:n.tileset,backgroundColor:t.backgroundColor,category:t.tilemapPalette.category,page:t.tilemapPalette.page,colors:n.colors,drawingMode:t.drawingMode,gallery:t.tileGallery,galleryOpen:t.tileGalleryOpen,referencedTiles:t.referencedTiles}:{}}),b)(_)},{"../../../assets":141,"../Button":145,"../Dropdown":147,"../Pivot":150,"../TimelineFrame":153,"../actions/dispatch":156,"../store/imageReducer":160,react:255,"react-redux":241,"react/jsx-runtime":256}],164:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.replaceColorEdit=i.outlineEdit=i.flipEdit=i.rotateEdit=i.MarqueeEdit=i.FillEdit=i.CircleEdit=i.LineEdit=i.OutlineEdit=i.RectangleEdit=i.PaintEdit=i.SelectionEdit=i.Edit=i.EditState=i.getEditState=i.getEdit=i.tools=i.ToolCursor=void 0;const n=e("./store/imageReducer");var s,o;(o=s=i.ToolCursor||(i.ToolCursor={})).None="none",o.Default="default",o.Pointer="pointer",o.Crosshair="crosshair",o.Grab="grab",o.Grabbing="grabbing",o.EyeDropper="var(--eyedropper)",i.tools=[{tool:n.ImageEditorTool.Paint,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Paint Tool"),hoverCursor:s.Crosshair},{tool:n.ImageEditorTool.Erase,iconClass:"ms-Icon ms-Icon--EraseTool",title:lf("Erase Tool"),hoverCursor:s.Crosshair},{tool:n.ImageEditorTool.Rect,iconClass:"ms-Icon ms-Icon--RectangleShape",title:lf("Rectangle Tool"),hoverCursor:s.Crosshair},{tool:n.ImageEditorTool.Fill,iconClass:"ms-Icon ms-Icon--BucketColor",title:lf("Fill Tool"),hoverCursor:s.Crosshair},{tool:n.ImageEditorTool.Circle,iconClass:"ms-Icon ms-Icon--CircleRing",title:lf("Circle Tool"),hoverCursor:s.Crosshair},{tool:n.ImageEditorTool.Line,iconClass:"ms-Icon ms-Icon--Line",title:lf("Line Tool"),hoverCursor:s.Crosshair},{tool:n.ImageEditorTool.Marquee,iconClass:"ms-Icon ms-Icon--SelectAll",title:lf("Marquee Tool"),hoverCursor:s.Crosshair,hoverLayerCursor:s.Grab,downLayerCursor:s.Grabbing},{tool:n.ImageEditorTool.Pan,iconClass:"ms-Icon ms-Icon--HandsFree",title:lf("Canvas Pan Tool"),hoverCursor:s.Grab,downCursor:s.Grabbing},{tool:n.ImageEditorTool.ColorSelect,hiddenTool:!0,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Color Select Tool"),hoverCursor:s.EyeDropper}],i.getEdit=function(e,t,i,s){switch(e){case n.ImageEditorTool.Paint:return new c(t.width,t.height,i,s);case n.ImageEditorTool.Rect:return new u(t.width,t.height,i,s);case n.ImageEditorTool.Fill:return new p(t.width,t.height,i,s);case n.ImageEditorTool.Line:return new h(t.width,t.height,i,s);case n.ImageEditorTool.Marquee:return new g(t.width,t.height,i,s);case n.ImageEditorTool.Circle:return new d(t.width,t.height,i,s);case n.ImageEditorTool.Erase:return new c(t.width,t.height,0,s);case n.ImageEditorTool.ColorSelect:default:return}},i.getEditState=function(e,t,i=n.TileDrawingMode.Default){const s=new r(t?pxt.sprite.Tilemap.fromData(e.bitmap).copy():pxt.sprite.Bitmap.fromData(e.bitmap).copy());let o,a,l;return e.overlayLayers&&(s.overlayLayers=e.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy()))),s.layerOffsetX=e.layerOffsetX,s.layerOffsetY=e.layerOffsetY,e.floating&&(e.floating.bitmap&&(a=t?pxt.sprite.Tilemap.fromData(e.floating.bitmap).copy():pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy()),e.floating.overlayLayers&&(l=e.floating.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy()))),o={image:a,overlayLayers:l}),s.floating=o,s.setActiveLayer(i),s};class r{constructor(e){this.activeLayerIndex=-1,this.image=e,this.layerOffsetX=0,this.layerOffsetY=0}get width(){return this.image.width}get height(){return this.image.height}get activeLayer(){return this.activeLayerIndex<0?this.image:this.overlayLayers[this.activeLayerIndex]}setActiveLayer(e){switch(e){case n.TileDrawingMode.Wall:this.activeLayerIndex=0;break;default:this.activeLayerIndex=-1}}copy(){const e=new r;if(e.image=this.image.copy(),e.overlayLayers=this.overlayLayers&&this.overlayLayers.map((e=>e.copy())),this.floating){let t,i;this.floating.image&&(t=this.floating.image.copy()),this.floating.overlayLayers&&(i=this.floating.overlayLayers.map((e=>e.copy()))),e.floating={image:t,overlayLayers:i}}return e.layerOffsetX=this.layerOffsetX,e.layerOffsetY=this.layerOffsetY,e}equals(e){return!(!this.image.equals(e.image)||this.floating&&!e.floating||!this.floating&&e.floating)&&(!this.floating||!this.floating.image||this.floating.image.equals(e.floating.image)&&this.layerOffsetX===e.layerOffsetX&&this.layerOffsetY===e.layerOffsetY)}mergeFloatingLayer(){this.floating&&(this.floating.image||this.floating.overlayLayers)&&(this.floating.image&&(this.floating.image.x0=this.layerOffsetX,this.floating.image.y0=this.layerOffsetY,this.image.apply(this.floating.image,!0),this.floating.image=void 0),this.floating.overlayLayers&&(this.floating.overlayLayers.forEach(((e,t)=>{e.x0=this.layerOffsetX,e.y0=this.layerOffsetY,this.overlayLayers[t].apply(e,!0)})),this.floating.overlayLayers=void 0))}copyToLayer(e,t,i,n,s=!1){if(0===i||0===n)return;i<0&&(e+=i,i=-i),n<0&&(t+=n,n=-n);let o,r=this.image.copy(e,t,i,n);if(this.layerOffsetX=r.x0,this.layerOffsetY=r.y0,r.x0=void 0,r.y0=void 0,this.overlayLayers&&(o=this.overlayLayers.map((s=>s.copy(e,t,i,n)))),s)for(let s=0;s<i;s++)for(let i=0;i<n;i++)this.image.set(e+s,t+i,0),this.overlayLayers&&this.overlayLayers.forEach((n=>n.set(e+s,t+i,0)));this.floating={image:r,overlayLayers:o}}inFloatingLayer(e,t){return!(!this.floating||!this.floating.image)&&(e-=this.layerOffsetX,t-=this.layerOffsetY,e>=0&&e<this.floating.image.width&&t>=0&&t<this.floating.image.height)}setFloatingLayer(e,t,i){var n,s;i&&this.mergeFloatingLayer(),this.floating={image:e},this.layerOffsetX=null!==(n=null==t?void 0:t.layerOffsetX)&&void 0!==n?n:0,this.layerOffsetY=null!==(s=null==t?void 0:t.layerOffsetY)&&void 0!==s?s:0}toImageState(){return{bitmap:this.image.data(),layerOffsetX:this.layerOffsetX,layerOffsetY:this.layerOffsetY,floating:this.floating&&{bitmap:this.floating.image?this.floating.image.data():void 0,overlayLayers:this.floating.overlayLayers?this.floating.overlayLayers.map((e=>e.data())):void 0},overlayLayers:this.overlayLayers?this.overlayLayers.map((e=>e.data())):void 0}}}i.EditState=r;class a{constructor(e,t,i,n){this.canvasWidth=e,this.canvasHeight=t,this.color=i,this.toolWidth=n}doEdit(e){this.isStarted&&this.doEditCore(e)}inBounds(e,t){return e>=0&&e<this.canvasWidth&&t>=0&&t<this.canvasHeight}start(e,t,i,n,s){this.isStarted=!0,this.startCol=e,this.startRow=t,this.startX=i,this.startY=n}drawCursor(e,t,i){i(e,t)}}i.Edit=a;class l extends a{update(e,t){this.endCol=e,this.endRow=t,this.isDragged||e==this.startCol&&t==this.startRow||(this.isDragged=!0)}topLeft(){return{x:Math.min(this.startCol,this.endCol),y:Math.min(this.startRow,this.endRow)}}bottomRight(){return{x:Math.max(this.startCol,this.endCol),y:Math.max(this.startRow,this.endRow)}}}i.SelectionEdit=l;class c extends a{constructor(e,t,i,n){super(e,t,i,n),this.showPreview=!0,this.mask=new pxt.sprite.Bitmask(e,t)}update(e,t){this.interpolate(this.startCol,this.startRow,e,t),this.startCol=e,this.startRow=t}interpolate(e,t,i,n){const s=i-e,o=n-t,r=(e,t)=>this.mask.set(e,t);if(0===s){const i=o>=0?n:t;for(let s=o>=0?t:n;s<=i;s++)this.drawCore(e,s,r);return}const a=s>0?1:-1,l=o>0?1:-1,c=Math.abs(o/s);let u=0,h=t;for(let t=e;a>0?t<=i:t>=i;t+=a)for(this.drawCore(t,h,r),u+=c;u>=.5;)(l>0?h<=n:h>=n)&&this.drawCore(t,h,r),h+=l,u-=1}doEditCore(e){e.mergeFloatingLayer();for(let t=0;t<e.width;t++)for(let i=0;i<e.height;i++)this.mask.get(t,i)&&e.activeLayer.set(t,i,this.color)}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(e,t,i){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let n=0;n<this.toolWidth;n++)for(let s=0;s<this.toolWidth;s++){const o=e+n,r=t+s;o>=0&&o<this.canvasWidth&&r>=0&&r<this.canvasHeight&&i(e+n,t+s)}}}i.PaintEdit=c;i.RectangleEdit=class extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();const t=this.topLeft(),i=this.bottomRight();for(let n=t.x;n<=i.x;n++)for(let s=t.y;s<=i.y;s++)e.activeLayer.set(n,s,this.color)}};class u extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();let t=this.topLeft();t.x-=this.toolWidth>>1,t.y-=this.toolWidth>>1;let i=this.bottomRight();i.x+=this.toolWidth>>1,i.y+=this.toolWidth>>1;for(let n=0;n<this.toolWidth;n++)this.drawRectangle(e,{x:t.x+n,y:t.y+n},{x:i.x-n,y:i.y-n})}drawRectangle(e,t,i){if(!(t.x>i.x||t.y>i.y)){for(let n=t.x;n<=i.x;n++)e.activeLayer.set(n,t.y,this.color),e.activeLayer.set(n,i.y,this.color);for(let n=t.y;n<=i.y;n++)e.activeLayer.set(t.x,n,this.color),e.activeLayer.set(i.x,n,this.color)}}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(e,t,i){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let n=0;n<this.toolWidth;n++)for(let s=0;s<this.toolWidth;s++){const o=e+n,r=t+s;o>=0&&o<this.canvasWidth&&r>=0&&r<this.canvasHeight&&i(e+n,t+s)}}}i.OutlineEdit=u;class h extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer(),this.bresenham(this.startCol,this.startRow,this.endCol,this.endRow,e)}bresenham(e,t,i,n,s){const o=i-e,r=n-t,a=(e,t)=>s.activeLayer.set(e,t,this.color);if(0===o){const i=r>=0?n:t;for(let s=r>=0?t:n;s<=i;s++)this.drawCore(e,s,a);return}const l=o>0?1:-1,c=r>0?1:-1,u=Math.abs(r/o);let h=0,d=t;for(let t=e;l>0?t<=i:t>=i;t+=l)for(this.drawCore(t,d,a),h+=u;h>=.5;)(c>0?d<=n:d>=n)&&this.drawCore(t,d,a),d+=c,h-=1}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(e,t,i){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let n=0;n<this.toolWidth;n++)for(let s=0;s<this.toolWidth;s++)i(e+n,t+s)}}i.LineEdit=h;class d extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();const t=this.topLeft(),i=this.bottomRight(),n=i.x-t.x,s=i.y-t.y,o=Math.floor(Math.hypot(n,s)),r=this.startCol,a=this.startRow;this.midpoint(r,a,o,e)}midpoint(e,t,i,n){let s=i-1,o=0,r=1,a=1,l=r-2*i;for(;s>=o;)n.activeLayer.set(e+s,t+o,this.color),n.activeLayer.set(e+s,t-o,this.color),n.activeLayer.set(e+o,t+s,this.color),n.activeLayer.set(e+o,t-s,this.color),n.activeLayer.set(e-o,t+s,this.color),n.activeLayer.set(e-o,t-s,this.color),n.activeLayer.set(e-s,t+o,this.color),n.activeLayer.set(e-s,t-o,this.color),l<=0&&(o++,l+=a,a+=2),l>0&&(s--,l+=(r+=2)-2*i)}}i.CircleEdit=d;class p extends a{constructor(){super(...arguments),this.showPreview=!0}start(e,t,i,n,s){this.isStarted=!0,this.col=e,this.row=t}update(e,t){this.col=e,this.row=t}doEditCore(e){const t=e.activeLayer!==e.image,i=(i,n)=>(t?e.activeLayer.get(i,n)+1<<8:0)+e.image.get(i,n),n=i(this.col,this.row);if(n===this.color)return;e.mergeFloatingLayer();const s=new pxt.sprite.Bitmask(e.width,e.height);s.set(this.col,this.row);const o=[{x:this.col,y:this.row}];for(;o.length;){const t=o.pop();i(t.x,t.y)===n&&(e.activeLayer.set(t.x,t.y,this.color),r(t.x+1,t.y),r(t.x-1,t.y),r(t.x,t.y+1),r(t.x,t.y-1))}function r(e,t){e>=0&&e<s.width&&t>=0&&t<s.height&&!s.get(e,t)&&(s.set(e,t),o.push({x:e,y:t}))}}}i.FillEdit=p;class g extends l{constructor(){super(...arguments),this.isMove=!1,this.isResize=!1,this.showPreview=!1}start(e,t,i,n,s){this.isStarted=!0,this.startCol=e,this.startRow=t;const o=document.elementFromPoint(i,n);if(s.floating&&s.floating.image)if(o&&"image-editor-floating-layer-corner"==o.className){this.isResize=!0,this.startOffsetX=s.layerOffsetX,this.startOffsetY=s.layerOffsetY;let e,t=0;const o=document.getElementsByClassName("image-editor-floating-layer-corner");for(let s=0;s<o.length;s++){let r=Math.sqrt(Math.pow(o[s].getBoundingClientRect().x-i,2)+Math.pow(o[s].getBoundingClientRect().y-n,2));r>t&&(t=r,e=o[s])}const r=document.getElementsByClassName("paint-surface");let a;for(let e=0;e<r.length;e++)r[e].className.includes("main")&&(a=r[e]);const l=a.getBoundingClientRect().left,c=a.getBoundingClientRect().top,u=a.getBoundingClientRect().width,h=a.getBoundingClientRect().height;this.anchorCol=(e.getBoundingClientRect().x-l)/u*this.canvasWidth,this.anchorRow=(e.getBoundingClientRect().y-c)/h*this.canvasHeight,this.originalImage||(this.originalImage=s.floating.image.copy())}else s.inFloatingLayer(e,t)&&(this.isMove=!0,this.startOffsetX=s.layerOffsetX,this.startOffsetY=s.layerOffsetY)}inBounds(e,t){return this.isMove||super.inBounds(e,t)}doEditCore(e){const t=this.topLeft(),i=this.bottomRight();if(this.isDragged)if(this.isMove)e.layerOffsetX=this.startOffsetX+this.endCol-this.startCol,e.layerOffsetY=this.startOffsetY+this.endRow-this.startRow;else if(this.isResize){const t=Math.round(Math.abs(this.anchorCol-this.endCol)),i=Math.round(Math.abs(this.anchorRow-this.endRow)),n=function(e,t,i){const n=new pxt.sprite.Bitmap(t,i,0,0);for(let s=0;s<t;s++)for(let o=0;o<i;o++){const r=Math.floor(s/t*e.width),a=Math.floor(o/i*e.height),l=e.get(r,a);n.set(s,o,l)}return n}(this.originalImage,t,i);e.setFloatingLayer(n,{layerOffsetX:Math.round(Math.min(this.anchorCol,this.endCol)),layerOffsetY:Math.round(Math.min(this.anchorRow,this.endRow))},!1)}else e.mergeFloatingLayer(),e.copyToLayer(t.x,t.y,i.x-t.x+1,i.y-t.y+1,!0);else this.isMove||e.mergeFloatingLayer()}}i.MarqueeEdit=g,i.rotateEdit=function(e,t,i,n){var s;const o=!!(null===(s=e.floating)||void 0===s?void 0:s.image),a=o?e.floating:e,l=i?new pxt.sprite.Tilemap(a.image.height,a.image.width):new pxt.sprite.Bitmap(a.image.height,a.image.width),c=a.overlayLayers?a.overlayLayers.map((e=>new pxt.sprite.Bitmap(e.height,e.width))):void 0;for(let e=0;e<a.image.width;e++)for(let t=0;t<a.image.height;t++)h(a.image,l,e,t),c&&c.forEach(((i,n)=>h(a.overlayLayers[n],i,e,t)));const u=l.width===l.height&&l.width===e.image.width&&e.image.width===e.image.height;if(!n&&!o||u){const e=new r(l);return e.overlayLayers=c,e}if(!o)for(let t=0;t<e.width;t++)for(let i=0;i<e.height;i++)e.image.set(t,i,0),e.overlayLayers&&e.overlayLayers.forEach((e=>null==e?void 0:e.set(t,i,0)));return(l.width===e.image.height&&l.height===e.image.width||l.width===e.image.width&&l.height===e.image.height)&&(e.layerOffsetX=(e.width>>1)-(l.width>>1),e.layerOffsetY=(e.height>>1)-(l.height>>1)),e.floating={image:l,overlayLayers:c},e;function h(e,i,n,s){t?i.set(s,n,e.get(n,e.height-s-1)):i.set(s,n,e.get(e.width-n-1,s))}},i.flipEdit=function(e,t,i){var n,s;const o=(null===(n=e.floating)||void 0===n?void 0:n.image)?e.floating:e,a=i?new pxt.sprite.Tilemap(o.image.width,o.image.height):new pxt.sprite.Bitmap(o.image.width,o.image.height),l=o.overlayLayers?o.overlayLayers.map((e=>new pxt.sprite.Bitmap(e.width,e.height))):void 0;for(let e=0;e<o.image.width;e++)for(let t=0;t<o.image.height;t++)c(o.image,a,e,t),l&&l.forEach(((i,n)=>c(o.overlayLayers[n],i,e,t)));if(null===(s=e.floating)||void 0===s?void 0:s.image)return e.floating={image:a,overlayLayers:l},e;{const e=new r(a);return e.overlayLayers=l,e}function c(e,i,n,s){t?i.set(n,s,e.get(n,e.height-s-1)):i.set(n,s,e.get(e.width-n-1,s))}},i.outlineEdit=function(e,t){var i,n;const s=(null===(i=e.floating)||void 0===i?void 0:i.image)?e.floating:e,o=e.copy(),r=(null===(n=null==e?void 0:e.floating)||void 0===n?void 0:n.image)?o.floating.image:o.image;for(let e=0;e<s.image.width;e++)for(let i=0;i<s.image.height;i++)0===s.image.get(e,i)&&(0===s.image.get(e-1,i)&&0===s.image.get(e,i-1)&&0===s.image.get(e+1,i)&&0===s.image.get(e,i+1)||r.set(e,i,t));return o},i.replaceColorEdit=function(e,t,i){var n,s;const o=(null===(n=e.floating)||void 0===n?void 0:n.image)?e.floating:e,r=e.copy(),a=(null===(s=null==e?void 0:e.floating)||void 0===s?void 0:s.image)?r.floating.image:r.image;for(let e=0;e<o.image.width;e++)for(let n=0;n<o.image.height;n++)o.image.get(e,n)===t&&a.set(e,n,i);return r}},{"./store/imageReducer":160}],165:[function(e,t,i){"use strict";function n(){return"undefined"!=typeof window&&!!window.PointerEvent}function s(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0)}var o;Object.defineProperty(i,"__esModule",{value:!0}),i.createTilemapPatchFromFloatingLayer=i.applyBitmapData=i.imageStateToTilemap=i.imageStateToBitmap=i.bindGestureEvents=i.GestureState=i.fireClickOnlyOnEnter=i.clientCoord=i.pointerEvents=i.Bitmask=i.MapTools=i.isBitmapSupported=i.isTouchEnabled=i.hasPointerEvents=i.DRAG_RADIUS=void 0,i.DRAG_RADIUS=3,i.hasPointerEvents=n,i.isTouchEnabled=s,i.isBitmapSupported=function(){return!!window.createImageBitmap},(o=i.MapTools||(i.MapTools={}))[o.Pan=0]="Pan",o[o.Stamp=1]="Stamp",o[o.Object=2]="Object",o[o.Erase=3]="Erase";function r(e){if(e.touches){const t=e;return t.touches.length?t.touches[0]:t.changedTouches[0]}return e}i.Bitmask=class{constructor(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}set(e,t){const i=e+this.width*t,n=i>>3,s=7&i;this.mask[n]|=1<<s}get(e,t){const i=e+this.width*t,n=i>>3,s=7&i;return this.mask[n]>>s&1}},i.pointerEvents=n()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:s()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},i.clientCoord=r,i.fireClickOnlyOnEnter=function(e){13===("number"==typeof e.which?e.which:e.keyCode)&&(e.preventDefault(),e.currentTarget.click())};class a{constructor(e,t,i){this.target=e,this.isRightClick=i,this.startX=t.clientX,this.startY=t.clientY,this.currentX=t.clientX,this.currentY=t.clientY}update(e){this.currentX=e.clientX,this.currentY=e.clientY,!this.isDrag&&this.distance()>i.DRAG_RADIUS?(this.isDrag=!0,this.target.onDragStart(e,this.isRightClick)):this.isDrag&&this.target.onDragMove(e)}end(e){e&&this.update(e),e=e||{clientX:this.currentX,clientY:this.currentY},this.isDrag?this.target.onDragEnd(e):this.target.onClick(e,this.isRightClick)}distance(){return Math.sqrt(Math.pow(this.currentX-this.startX,2)+Math.pow(this.currentY-this.startY,2))}}function l(e,t){for(let i=0;i<e.changedTouches.length;i++)if(e.changedTouches[i].identifier===t)return e.changedTouches[i]}function c(e){return e.button>0}i.GestureState=a,i.bindGestureEvents=function(e,t){n()?function(e,t){let i;e.addEventListener("pointerup",(e=>{i&&(i.end(r(e)),e.preventDefault()),i=void 0})),e.addEventListener("pointerdown",(e=>{i&&i.end(),i=new a(t,r(e),c(e)),e.preventDefault()})),e.addEventListener("pointermove",(e=>{i&&(i.update(r(e)),e.preventDefault())})),e.addEventListener("pointerleave",(e=>{i&&(i.end(r(e)),e.preventDefault()),i=void 0}))}(e,t):s()?function(e,t){let i,n;e.addEventListener("touchend",(e=>{if(i&&n){const t=l(e,n);t&&(i.end(t),i=void 0,e.preventDefault())}})),e.addEventListener("touchstart",(e=>{i&&i.end(),n=e.changedTouches[0].identifier,i=new a(t,e.changedTouches[0],c(e))})),e.addEventListener("touchmove",(e=>{if(i&&n){const t=l(e,n);t&&(i.update(t),e.preventDefault())}})),e.addEventListener("touchcancel",(e=>{if(i&&n){const t=l(e,n);t&&(i.end(t),i=void 0,e.preventDefault())}}))}(e,t):function(e,t){let i;e.addEventListener("mouseup",(e=>{i&&i.end(r(e)),i=void 0})),e.addEventListener("mousedown",(e=>{i&&i.end(),i=new a(t,r(e),c(e))})),e.addEventListener("mousemove",(e=>{i&&i.update(r(e))})),e.addEventListener("mouseleave",(e=>{i&&i.end(r(e)),i=void 0}))}(e,t)},i.imageStateToBitmap=function(e){const t=pxt.sprite.Bitmap.fromData(e.bitmap).copy();if(e.floating&&e.floating.bitmap){const i=pxt.sprite.Bitmap.fromData(e.floating.bitmap);i.x0=e.layerOffsetX||0,i.y0=e.layerOffsetY||0,t.apply(i,!0)}return t},i.imageStateToTilemap=function(e){const t=pxt.sprite.Tilemap.fromData(e.bitmap).copy();if(e.floating&&e.floating.bitmap){const i=pxt.sprite.Tilemap.fromData(e.floating.bitmap);i.x0=e.layerOffsetX||0,i.y0=e.layerOffsetY||0,t.apply(i,!0)}return t},i.applyBitmapData=function(e,t,i=0,n=0){if(!e||!t)return e;const s=pxt.sprite.Bitmap.fromData(e),o=pxt.sprite.Bitmap.fromData(t);return o.x0=i,o.y0=n,s.apply(o,!0),s.data()},i.createTilemapPatchFromFloatingLayer=function(e,t){if(!e.floating)return;const i=pxt.sprite.Tilemap.fromData(e.floating.image.data()),n=new pxt.sprite.Tilemap(i.width,i.height),s=e.floating.overlayLayers?e.floating.overlayLayers.map((e=>pxt.sprite.base64EncodeBitmap(e.data()))):[];let o=[];for(let e=0;e<i.width;e++)for(let s=0;s<i.height;s++){const r=t.tiles[i.get(e,s)],a=o.indexOf(r);-1===a?(n.set(e,s,o.length),o.push(r)):n.set(e,s,a)}return{map:pxt.sprite.hexEncodeTilemap(n),layers:s,tiles:o.map((e=>pxt.sprite.base64EncodeBitmap(e.bitmap)))}}},{}],166:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageFieldEditor=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("./assetEditor/assetCard"),r=e("../assets"),a=e("./ImageEditor/ImageEditor"),l=e("./ImageEditor/keyboardShortcuts"),c=e("./ImageEditor/store/imageReducer"),u=e("./FilterPanel"),h=e("../util"),d=e("../../../react-common/components/controls/EditorToggle"),p=e("./MusicFieldEditor"),g=e("../../../react-common/components/util");class m extends s.Component{constructor(e){super(e),this.tagClickHandler=e=>{let t=this.state.gallerySelectedTags;const i=e.toLowerCase(),n=t.indexOf(i);n<0?t.push(i):t.splice(n,1),this.setState({gallerySelectedTags:t})},this.clearFilterTags=()=>{this.setState({gallerySelectedTags:[]})},this.toggleFilter=()=>{this.setState({filterOpen:!this.state.filterOpen})},this.showEditor=()=>{this.setImageEditorShortcutsEnabled(!0),_("gallery-editor"),this.setState({currentView:"editor",tileGalleryVisible:!1})},this.showGallery=()=>{this.setImageEditorShortcutsEnabled(!1),_("gallery-builtin"),this.setState({currentView:"gallery",tileGalleryVisible:!1})},this.showMyAssets=()=>{this.setImageEditorShortcutsEnabled(!1),_("gallery-my-assets"),this.userAssets=(0,r.getAssets)(void 0,void 0,this.options.temporaryAssets),this.setState({currentView:"my-assets",tileGalleryVisible:!1})},this.toggleTileGallery=()=>{this.state.tileGalleryVisible?this.setState({tileGalleryVisible:!1}):this.setState({tileGalleryVisible:!0,currentView:"editor"})},this.onAssetSelected=e=>{var t,i;if(this.ref&&e.id!==(null===(t=this.asset)||void 0===t?void 0:t.id))if(this.state.editingTile)this.ref.openInTileEditor(pxt.sprite.Bitmap.fromData(e.bitmap));else if("gallery"===this.state.currentView)this.ref.openGalleryAsset(e);else{const t=pxt.react.getTilemapProject();"tilemap"===(null===(i=this.asset)||void 0===i?void 0:i.type)&&pxt.sprite.updateTilemapReferencesFromResult(t,this.asset),this.asset.meta.displayName?t.updateAsset(this.asset):e.meta.displayName||(e=Object.assign(Object.assign({},pxt.cloneAsset(e)),{id:this.asset.id,meta:this.asset.meta})),"tilemap"===e.type&&pxt.sprite.addMissingTilemapTilesAndReferences(t,e),this.ref.openAsset(e,void 0,!0)}_("gallery-selection"),this.setState({currentView:"editor",tileGalleryVisible:!1}),this.setImageEditorShortcutsEnabled(!0)},this.onTileEditorOpenClose=e=>{this.setState({editingTile:e})},this.onDoneClick=()=>{this.closeEditor&&this.closeEditor(),this.props.doneButtonCallback&&this.props.doneButtonCallback()},this.state={currentView:"editor",headerVisible:!0,filterOpen:!1,gallerySelectedTags:[],galleryFilter:""},(0,c.setTelemetryFunction)(_)}get asset(){var e;return null===(e=this.ref)||void 0===e?void 0:e.getAsset()}render(){var e,t,i,s,o;const{currentView:r,headerVisible:l,editingTile:c,hideMyAssets:m,filterOpen:_,hideCloseButton:T}=this.state,E="gallery"===this.state.currentView&&_;let b=l,I=!this.props.isMusicEditor&&(!this.asset||c||"tilemap"!==this.asset.type);const y=!m&&!c;this.asset&&!this.galleryAssets&&I&&this.updateGalleryAssets(),(null===(e=this.galleryAssets)||void 0===e?void 0:e.length)||(I=!1);const v=this.props.includeSpecialTagsInFilter?[]:["tile","dialog","background"];let C=[],k=[];switch(r){case"my-assets":k=this.filterAssetsByType(this.userAssets,c?"tile":null===(t=this.asset)||void 0===t?void 0:t.type),C=this.getAvailableTags(k,v);break;case"gallery":k=this.filterAssetsByType(this.galleryAssets,c?"tile":null===(i=this.asset)||void 0===i?void 0:i.type,!0,!0),C=this.getAvailableTags(k,v),k=this.filterAssetsByTag(k)}const O=[{label:lf("Editor"),title:lf("Editor"),focusable:!0,icon:"fas fa-paint-brush",onClick:this.showEditor,view:"editor"},{label:lf("Gallery"),title:lf("Gallery"),focusable:!0,icon:"fas fa-image",onClick:this.showGallery,view:"gallery"},{label:lf("My Assets"),title:lf("My Assets"),focusable:!0,icon:"fas fa-folder",onClick:this.showMyAssets,view:"my-assets"}];return I||y?I?y||O.splice(2,1):O.splice(1,1):b=!1,(0,n.jsxs)("div",Object.assign({className:(0,g.classList)("image-editor-wrapper",this.props.isMusicEditor&&"music-asset-editor")},{children:[b&&(0,n.jsxs)("div",Object.assign({className:"gallery-editor-header"},{children:[(0,n.jsx)("div",{className:"image-editor-header-left"}),(0,n.jsx)("div",Object.assign({className:"image-editor-header-center"},{children:(0,n.jsx)(d.EditorToggle,{id:"image-editor-toggle",className:"slim tablet-compact",items:O,selected:O.findIndex((e=>e.view===r))})})),(0,n.jsxs)("div",Object.assign({className:"image-editor-header-right"},{children:[(0,n.jsxs)("div",Object.assign({className:"gallery-filter-button "+("gallery"===this.state.currentView?"":"hidden"),role:"button",onClick:this.toggleFilter,onKeyDown:h.fireClickOnEnter},{children:[(0,n.jsx)("div",Object.assign({className:"gallery-filter-button-icon"},{children:(0,n.jsx)("i",{className:"icon filter"})})),(0,n.jsx)("div",Object.assign({className:"gallery-filter-button-label"},{children:lf("Filter")}))]})),!c&&!T&&(0,n.jsx)("div",Object.assign({className:"image-editor-close-button",role:"button",onClick:this.onDoneClick},{children:(0,n.jsx)("i",{className:"ui icon close"})}))]}))]})),(0,n.jsxs)("div",Object.assign({className:"image-editor-gallery-window"},{children:[(0,n.jsxs)("div",Object.assign({className:"image-editor-gallery-content"},{children:[this.props.isMusicEditor?(0,n.jsx)(p.MusicFieldEditor,{ref:"image-editor",onDoneClicked:this.onDoneClick,hideDoneButton:this.props.hideDoneButton}):(0,n.jsx)(a.ImageEditor,{ref:"image-editor",singleFrame:this.props.singleFrame,onDoneClicked:this.onDoneClick,onTileEditorOpenClose:this.onTileEditorOpenClose,lightMode:this.lightMode,hideDoneButton:this.props.hideDoneButton,hideAssetName:!(null===(o=null===(s=pxt.appTarget)||void 0===s?void 0:s.appTheme)||void 0===o?void 0:o.assetEditor)}),(0,n.jsx)(f,{items:k,hidden:"editor"===r,onAssetSelected:this.onAssetSelected})]})),(0,n.jsx)("div",Object.assign({className:"filter-panel-gutter "+(E?"":"hidden")},{children:(0,n.jsx)("div",Object.assign({className:"filter-panel-container"},{children:(0,n.jsx)(u.FilterPanel,{enabledTags:this.state.gallerySelectedTags,tagClickHandler:this.tagClickHandler,clearTags:this.clearFilterTags,tagOptions:C})}))}))]}))]}))}componentDidMount(){this.ref=this.refs["image-editor"],_("image-editor-shown")}componentWillUnmount(){_("image-editor-hidden"),this.galleryAssets=void 0,this.userAssets=void 0}init(e,t,i){switch(this.closeEditor=t,this.options=i,this.lightMode=i.lightMode,e.type){case"image":this.initSingleFrame(e,i);break;case"tile":i.disableResize=!0,this.initSingleFrame(e,i);break;case"animation":this.initAnimation(e,i);break;case"tilemap":this.initTilemap(e,i);break;case"song":this.ref.openAsset(e)}this.editID=e.id;let n=!1;i&&(this.blocksInfo=i.blocksInfo,i.filter&&(this.setState({galleryFilter:i.filter}),n=!0),null!=i.headerVisible&&(this.setState({headerVisible:i.headerVisible}),n=!0),null!=i.hideMyAssets&&(this.setState({hideMyAssets:i.hideMyAssets}),n=!0),null!=i.hideCloseButton&&(this.setState({hideCloseButton:i.hideCloseButton}),n=!0)),n||this.forceUpdate()}getValue(){return this.ref?this.ref.getAsset():null}getJres(){return this.ref?this.ref.getJres():""}getPersistentData(){return this.ref?this.ref.getPersistentData():null}restorePersistentData(e){this.ref&&(this.ref.restorePersistentData(e),this.options&&this.options.disableResize&&this.ref.disableResize())}onResize(){this.ref&&this.ref.onResize()}updateGalleryAssets(){this.galleryAssets=(0,r.getAssets)(!0,this.asset.type)}getAvailableTags(e,t){let i=[];return this.galleryAssets?(e.forEach((e=>{var n;null===(n=e.meta.tags)||void 0===n||n.forEach((e=>{const n=function(e){let t=0===e.indexOf("?")&&e.length>1?e.substring(1):e;return t.toLowerCase()}(e);t.indexOf(n)<0&&i.indexOf(n)<0&&i.push(n)}))})),i):[]}filterAssetsByTag(e){return this.state.gallerySelectedTags.length>0&&this.state.filterOpen&&(e=e.filter((e=>{var t;return!!(null===(t=e.meta.tags)||void 0===t?void 0:t.find((e=>this.state.gallerySelectedTags.indexOf(e)>=0)))}))),e}filterAssetsByType(e,t,i=!1,n){var s;if(void 0===t&&(t=null===(s=this.asset)||void 0===s?void 0:s.type),void 0===t)return e;if(this.asset&&!i&&(e=e.map((e=>e.type!==this.asset.type||e.id!==this.asset.id?e:(0,r.assetToGalleryItem)(this.getValue()))),this.state.editingTile)){const t=this.ref.getAsset();e=e.map((e=>{var i;return(null===(i=t.data.editedTiles)||void 0===i?void 0:i.indexOf(e.id))>=0?(0,r.assetToGalleryItem)(t.data.tileset.tiles.find((t=>t.id===e.id))):e}))}if(n){e.forEach((e=>{var t,i,n;!e.meta.tags&&this.options&&(e.meta.tags=(null===(n=null===(i=null===(t=this.blocksInfo)||void 0===t?void 0:t.apis.byQName[e.id])||void 0===i?void 0:i.attributes.tags)||void 0===n?void 0:n.split(" "))||[])}));const t=this.state.galleryFilter.split(" ").filter((e=>!!e)).map((e=>e.toLowerCase())),i=t.filter((e=>0!==e.indexOf("!"))),n=t.filter((e=>0===e.indexOf("!")&&e.length>1)).map((e=>e.substring(1)));e=e.filter((e=>function(e,t){const i=e.meta.tags?e.meta.tags:[];return t.every((e=>{const t=`?${e}`;return i.some((i=>i===e||i===t))}))}(e,i)&&function(e,t){const i=e.meta.tags?e.meta.tags:[];return t.every((e=>!i.some((t=>t===e))))}(e,n)))}if(i)switch(t){case"animation":return e.filter((e=>"animation"===e.type||"tile"===e.type||"image"===e.type));case"image":return e.filter((e=>"tile"===e.type||"image"===e.type));case"tile":return e.filter((e=>"tile"===e.type));case"tilemap":return e.filter((e=>"tilemap"===e.type));case"song":return e.filter((e=>"song"===e.type))}else switch(t){case"animation":return e.filter((e=>"animation"===e.type));case"image":return e.filter((e=>"image"===e.type));case"tile":return e.filter((e=>"tile"===e.type));case"tilemap":return e.filter((e=>"tilemap"===e.type));case"song":return e.filter((e=>"song"===e.type))}}initSingleFrame(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initAnimation(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initTilemap(e,t){let i;(null==t?void 0:t.blocksInfo)&&(this.blocksInfo=t.blocksInfo,i=pxt.sprite.filterItems(pxt.sprite.getGalleryItems(this.blocksInfo,"Image"),["tile"]).map((e=>({bitmap:pxt.sprite.getBitmap(this.blocksInfo,e.qName).data(),tags:e.tags,qualifiedName:e.qName,tileWidth:16})))),(null==t?void 0:t.galleryTiles)&&(i=t.galleryTiles.map((e=>({bitmap:e.bitmap,tags:e.tags,qualifiedName:e.qName,tileWidth:16})))),this.ref.openAsset(e,i)}loadJres(e){this.ref&&this.ref.loadJres(e)}setImageEditorShortcutsEnabled(e){e&&this.shortcutLock?((0,l.releaseShortcutLock)(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=(0,l.obtainShortcutLock)())}}i.ImageFieldEditor=m;class f extends s.Component{constructor(){super(...arguments),this.clickHandler=e=>{this.props.onAssetSelected(e)}}render(){let{items:e,hidden:t}=this.props;return(0,n.jsx)("div",Object.assign({className:"image-editor-gallery "+(e&&!t?"visible":"")},{children:!t&&e&&e.map(((e,t)=>(0,n.jsx)(o.AssetCardView,{asset:e,selected:!1,onClick:this.clickHandler},t)))}))}}s.Component;function _(e){pxt.tickEvent("image.editor",{action:e})}},{"../../../react-common/components/controls/EditorToggle":134,"../../../react-common/components/util":139,"../assets":141,"../util":189,"./FilterPanel":142,"./ImageEditor/ImageEditor":149,"./ImageEditor/keyboardShortcuts":158,"./ImageEditor/store/imageReducer":160,"./MusicFieldEditor":167,"./assetEditor/assetCard":170,react:255,"react/jsx-runtime":256}],167:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MusicFieldEditor=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("./musicEditor/MusicEditor");class r extends s.Component{constructor(e){super(e),this.onSongChanged=e=>{this.mostRecentValue=e},this.onAssetNameChanged=e=>{this.setState({editingSong:Object.assign(Object.assign({},this.state.editingSong),{meta:Object.assign(Object.assign({},this.state.editingSong.meta),{displayName:e})})})},this.state={editRef:0}}render(){const{onDoneClicked:e}=this.props,{editingSong:t}=this.state;return(0,n.jsx)("div",Object.assign({className:"music-field-editor"},{children:t&&(0,n.jsx)(o.MusicEditor,{asset:t,onSongChanged:this.onSongChanged,onAssetNameChanged:this.onAssetNameChanged,editRef:this.state.editRef,onDoneClicked:e,hideDoneButton:this.props.hideDoneButton})}))}getAsset(){if(this.state.editingSong)return Object.assign(Object.assign({},this.state.editingSong),{song:this.mostRecentValue||this.state.editingSong.song})}openAsset(e){pxt.assets.music.inflateSong(e.song),this.setState({editingSong:e,editRef:this.state.editRef+1})}openGalleryAsset(e){}getJres(){return""}loadJres(e){}disableResize(){}onResize(){}getPersistentData(){}restorePersistentData(e){}}i.MusicFieldEditor=r},{"./musicEditor/MusicEditor":175,react:255,"react/jsx-runtime":256}],168:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dispatchUpdateGalleryAssets=i.dispatchUpdateUserAssets=i.dispatchChangeGalleryView=i.dispatchChangeSelectedAsset=void 0;const n=e("./types");i.dispatchChangeSelectedAsset=(e,t)=>({type:n.CHANGE_SELECTED_ASSET,assetType:e,assetId:t});i.dispatchChangeGalleryView=(e,t,i)=>({type:n.CHANGE_GALLERY_VIEW,view:e,assetType:t,assetId:i});i.dispatchUpdateUserAssets=()=>({type:n.UPDATE_USER_ASSETS});i.dispatchUpdateGalleryAssets=()=>({type:n.UPDATE_GALLERY_ASSETS})},{"./types":169}],169:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.UPDATE_GALLERY_ASSETS=i.UPDATE_USER_ASSETS=i.CHANGE_GALLERY_VIEW=i.CHANGE_SELECTED_ASSET=void 0,i.CHANGE_SELECTED_ASSET="CHANGE_SELECTED_ASSET",i.CHANGE_GALLERY_VIEW="CHANGE_GALLERY_VIEW",i.UPDATE_USER_ASSETS="UPDATE_USER_ASSETS",i.UPDATE_GALLERY_ASSETS="UPDATE_GALLERY_ASSETS"},{}],170:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetCard=i.AssetCardView=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("react-redux"),r=e("./store/assetEditorReducerState"),a=e("./actions/dispatch"),l=e("./assetPreview");class c extends s.Component{constructor(){super(...arguments),this.clickHandler=()=>{const{type:e,id:t}=this.props.asset;this.props.dispatchChangeSelectedAsset(e,t)}}render(){const{asset:e,selected:t}=this.props;return(0,n.jsx)(u,{asset:e,selected:t,onClick:this.clickHandler})}}class u extends s.Component{constructor(){super(...arguments),this.clickHandler=()=>{this.props.onClick(this.props.asset)}}getDisplayIconForAsset(e){switch(e){case"tile":return"clone";case"animation":return"video";case"tilemap":return"map";case"song":return"music";case"image":default:return null}}render(){var e,t;const{asset:i,selected:s}=this.props,o=(0,r.isGalleryAsset)(i),a=this.getDisplayIconForAsset(i.type),c=a||!(null===(e=i.meta)||void 0===e?void 0:e.displayName);return(0,n.jsxs)("div",Object.assign({className:"asset-editor-card "+(s?"selected":""),onClick:this.clickHandler,role:"listitem"},{children:[(0,n.jsx)(l.AssetPreview,{asset:i}),c&&(0,n.jsxs)("div",Object.assign({className:"asset-editor-card-label"},{children:[a&&(0,n.jsx)("div",Object.assign({className:"asset-editor-card-icon"},{children:(0,n.jsx)("i",{className:`icon ${a}`})})),!(null===(t=i.meta)||void 0===t?void 0:t.displayName)&&!o&&(0,n.jsx)("div",Object.assign({className:"asset-editor-card-icon warning"},{children:(0,n.jsx)("i",{className:"icon exclamation triangle"})}))]}))]}))}}i.AssetCardView=u;const h={dispatchChangeSelectedAsset:a.dispatchChangeSelectedAsset};i.AssetCard=(0,o.connect)((function(e,t){return e?{selected:e.selectedAsset&&t.asset.id==e.selectedAsset.id}:{}}),h)(c)},{"./actions/dispatch":168,"./assetPreview":171,"./store/assetEditorReducerState":172,react:255,"react-redux":241,"react/jsx-runtime":256}],171:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetPreview=void 0;const n=e("react/jsx-runtime"),s=e("react");class o extends s.Component{constructor(){super(...arguments),this.onMouseEnter=()=>{this.restartAnimation()},this.onMouseLeave=()=>{this.endAnimation()},this.restartAnimation=()=>{var e;this.endAnimation();const t=this.props.asset;"animation"===t.type&&(null===(e=t.framePreviewURIs)||void 0===e?void 0:e.length)>1&&(this.currentFrame=0,this.animationIntervalRef=setInterval((()=>{this.ref&&(this.ref.src=t.framePreviewURIs[this.currentFrame]),this.currentFrame=(this.currentFrame+1)%t.framePreviewURIs.length}),Math.max(t.interval,100)))},this.handleRef=e=>{e&&(this.ref=e)}}render(){var e;const{asset:t}=this.props,i="animation"===t.type&&(null===(e=t.framePreviewURIs)||void 0===e?void 0:e.length)>1,s=t.meta.displayName||(t.meta.temporaryInfo?lf("Temporary Asset"):t.id);return(0,n.jsx)("div",Object.assign({className:"asset-editor-preview",title:s},{children:(0,n.jsx)("img",{src:t.previewURI,alt:lf("A preview of your asset (eg image, tile, animation)"),onMouseEnter:i?this.onMouseEnter:void 0,onMouseLeave:i?this.onMouseLeave:void 0,ref:i?this.handleRef:void 0,loading:"lazy"})}))}componentDidUpdate(){this.animationIntervalRef&&this.restartAnimation()}componentWillUnmount(){this.endAnimation()}endAnimation(){this.animationIntervalRef&&(clearInterval(this.animationIntervalRef),this.animationIntervalRef=void 0,this.ref.src=this.props.asset.previewURI)}}i.AssetPreview=o},{react:255,"react/jsx-runtime":256}],172:[function(e,t,i){"use strict";var n;Object.defineProperty(i,"__esModule",{value:!0}),i.isGalleryAsset=i.GalleryView=void 0,(n=i.GalleryView||(i.GalleryView={}))[n.User=0]="User",n[n.Gallery=1]="Gallery",i.isGalleryAsset=function(e){return null==e?void 0:e.id.startsWith("sprites.")}},{}],173:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EditControls=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("../../../../react-common/components/controls/Button"),r=e("../../../../react-common/components/controls/Input"),a=e("../../assets");i.EditControls=e=>{const{onAssetNameChanged:t,onDoneClicked:i,assetName:l,hideDoneButton:c}=e,[u,h]=s.useState(),[d,p]=s.useState(),g=e=>{let i=null;const n=e.trim();if(!n)return h(void 0),void p(void 0);pxt.validateAssetName(n)?(0,a.isNameTaken)(n)&&n!==l&&(i=lf("This name is already used elsewhere in your project")):i=lf("Names may only contain letters, numbers, '-', '_', and space"),i?(h(n),p(i)):(t(n),h(void 0),p(void 0))};return(0,n.jsxs)("div",Object.assign({className:"music-editor-edit-controls"},{children:[d&&(0,n.jsx)("div",Object.assign({className:"music-editor-name-error"},{children:d})),(0,n.jsx)(r.Input,{placeholder:lf("Asset Name"),initialValue:l||u,onBlur:g,onEnterKey:g}),!c&&(0,n.jsx)(o.Button,{className:"green",title:lf("Done"),label:lf("Done"),onClick:i})]}))}},{"../../../../react-common/components/controls/Button":131,"../../../../react-common/components/controls/Input":137,"../../assets":141,react:255,"react/jsx-runtime":256}],174:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GridHighlight=void 0;const n=e("react/jsx-runtime"),s=e("./svgConstants");i.GridHighlight=e=>{const{start:t,end:i,ticksPerBeat:o}=e,r=null!=t&&null!=i,a=Math.min(t,i),l=Math.max(t,i);return r?(0,n.jsxs)("g",{children:[(0,n.jsx)("rect",{fill:"#03adfc",x:(0,s.tickToX)(o,a),y:s.STAFF_HEADER_HEIGHT-s.STAFF_GRID_TICK_HEIGHT,width:(0,s.tickToX)(o,l)-(0,s.tickToX)(o,a),height:s.STAFF_GRID_TICK_HEIGHT}),(0,n.jsx)("rect",{fill:"#03adfc",x:(0,s.tickToX)(o,a),y:s.BASS_STAFF_TOP+s.STAFF_HEADER_HEIGHT-s.STAFF_GRID_TICK_HEIGHT,width:(0,s.tickToX)(o,l)-(0,s.tickToX)(o,a),height:s.STAFF_GRID_TICK_HEIGHT})]}):(0,n.jsx)("g",{})}},{"./svgConstants":187,"react/jsx-runtime":256}],175:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MusicEditor=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("./EditControls"),r=e("./keyboardNavigation"),a=e("./playback"),l=e("./PlaybackControls"),c=e("./ScrollableWorkspace"),u=e("./TrackSelector"),h=e("./utils");i.MusicEditor=e=>{const{asset:t,onSongChanged:i,savedUndoStack:d,onAssetNameChanged:p,editRef:g,onDoneClicked:m,hideDoneButton:f}=e,[_,T]=s.useState(0),[E,b]=s.useState("1/8"),[I,y]=s.useState(t.song),[v,C]=s.useState(!1),[k,O]=s.useState(!1),[N,A]=s.useState(d||[]),[S,R]=s.useState([]),[w,L]=s.useState(g),[x,$]=s.useState(),[D,M]=s.useState(),[P,B]=s.useState(!1),[F,U]=s.useState((0,h.doesSongUseBassClef)(t.song));s.useEffect((()=>()=>{(0,a.stopPlayback)()}),[]),s.useEffect((()=>{const e=e=>{x&&(e.preventDefault(),e.stopPropagation(),e.clipboardData.setData("application/makecode-song",JSON.stringify(x)))},t=e=>{if(x){e.preventDefault(),e.stopPropagation(),e.clipboardData.setData("application/makecode-song",JSON.stringify(x));const t=(0,h.applySelection)(x,k?_:void 0);j((0,h.deleteSelectedNotes)(t),!0)}},i=e=>{const t=e.clipboardData.getData("application/makecode-song");if(t){const e=JSON.parse(t);let i;i=x?{originalSong:(0,h.unselectAllNotes)((0,h.applySelection)(x,k?_:void 0)),pastedContent:e,startTick:x.startTick,endTick:x.startTick+(e.endTick-e.startTick),deltaTick:0,transpose:0}:{originalSong:I,pastedContent:e,startTick:0,endTick:e.endTick-e.startTick,deltaTick:0,transpose:0},j((0,h.applySelection)(i,k?_:void 0),!1),$(i)}};return document.addEventListener("copy",e),document.addEventListener("cut",t),document.addEventListener("paste",i),()=>{document.removeEventListener("copy",e),document.removeEventListener("cut",t),document.removeEventListener("paste",i)}}),[x,k,I]),w!==g&&(L(g),y(t.song));const H=s.useRef(),G=v?1:function(e,t){switch(e){case"1/4":return t;case"1/8":return t/2;case"1/16":return t/4;case"1/32":return t/8}}(E,I.ticksPerBeat),V=!!I.tracks[_].drums,j=(e,t)=>{var n;(0,a.isPlaying)()&&(0,a.updatePlaybackSongAsync)(e);let s=N.slice();t&&(s.push(pxt.assets.music.cloneSong((null==x?void 0:x.originalSong)||(null===(n=H.current)||void 0===n?void 0:n.original)||I)),A(s),R([])),y(e),i&&i(e),H.current&&(H.current.editing=e)},W=()=>{var e,t;let i;return $(void 0),"move"===(null===(e=null==H?void 0:H.current)||void 0===e?void 0:e.dragType)?i=(0,h.unselectAllNotes)(H.current.editing):(0,h.findSelectedRange)(I)&&(i=(0,h.unselectAllNotes)(I)),i&&(j(i,!0),"move"===(null===(t=null==H?void 0:H.current)||void 0===t?void 0:t.dragType)&&(H.current=void 0)),i},X=e=>{M(D?Object.assign(Object.assign({},D),{tick:e}):{tick:e,gridTicks:G,track:_,bassClef:!1,hideTracksActive:k,selection:x})};return(0,n.jsxs)("div",Object.assign({className:"music-editor"},{children:[(0,n.jsx)(u.TrackSelector,{song:I,selected:_,onTrackSelected:e=>{W(),B(!1);const t=I.tracks[e];t.drums?pxsim.music.playDrumAsync(t.drums[0]):pxsim.music.playNoteAsync((0,h.rowToNote)(t.instrument.octave,6,!1,!!t.drums).note,t.instrument,pxsim.music.tickToMs(I.beatsPerMinute,I.ticksPerBeat,I.ticksPerBeat/2)),T(e),D&&M(Object.assign(Object.assign({},D),{track:e})),v&&C(!1)},eraserActive:v,onEraserClick:()=>{W(),B(!1),C(!v)},hideTracksActive:k,onHideTracksClick:()=>{W(),B(!1),O(!k)},selectedResolution:E,onResolutionSelected:b}),(0,n.jsx)(c.ScrollableWorkspace,{song:I,selectedTrack:_,eraserActive:v,onWorkspaceClick:(e,t)=>{B(!1);const i=I.tracks[_],n=i.instrument,s=(0,h.findPreviousNoteEvent)(I,_,e.tick),o=(0,h.findPreviousNoteEvent)(I,_,e.exactTick);W(),X(e.tick);const r=t=>(0,h.isBassClefNote)(n.octave,t,V)===e.isBassClef&&(0,h.noteToRow)(n.octave,t,V)===e.row;let a,l;if((null==o?void 0:o.startTick)===e.exactTick&&o.notes.some(r)?(a=e.exactTick,l=o):(null==s?void 0:s.startTick)===e.tick&&s.notes.some(r)&&(a=e.tick,l=s),l){const i=(0,h.unselectAllNotes)(I);if(t&&!V){const t=l.notes.find(r),s=12*n.octave-20,o=12*n.octave+20,c=(0,h.removeNoteAtRowFromTrack)(i,_,e.row,e.isBassClef,a);let u;u="normal"===t.enharmonicSpelling&&t.note<o?"sharp":"sharp"===t.enharmonicSpelling&&t.note>s||t.note===o?"flat":"normal";const d=(0,h.rowToNote)(n.octave,e.row,e.isBassClef,V,u);j((0,h.addNoteToTrack)(c,_,d,l.startTick,l.endTick),!0),pxsim.music.playNoteAsync(d.note,n,pxsim.music.tickToMs(I.beatsPerMinute,I.ticksPerBeat,l.endTick-l.startTick))}else j((0,h.removeNoteAtRowFromTrack)(i,_,e.row,e.isBassClef,a),!0)}else{if(v){for(let t=0;t<I.tracks.length;t++){if(k&&t!==_)continue;const i=(0,h.findPreviousNoteEvent)(I,t,e.tick),n=(0,h.findPreviousNoteEvent)(I,t,e.exactTick);let s,o;(null==n?void 0:n.startTick)===e.exactTick&&n.notes.some(r)?(s=e.exactTick,o=n):(null==i?void 0:i.startTick)===e.tick&&i.notes.some(r)&&(s=e.tick,o=i),((null==o?void 0:o.startTick)===s||(null==o?void 0:o.endTick)>s)&&o.notes.some(r)&&j((0,h.removeNoteAtRowFromTrack)(I,t,e.row,e.isBassClef,o.startTick),!1)}return}{const t=(0,h.rowToNote)(n.octave,e.row,e.isBassClef,V),s=I.beatsPerMeasure*I.ticksPerBeat*I.measures;if(e.tick===s)return;const o=V?1:G;j((0,h.unselectAllNotes)((0,h.addNoteToTrack)(I,_,t,e.tick,e.tick+o)),!0),V?pxsim.music.playDrumAsync(i.drums[t.note]):pxsim.music.playNoteAsync(t.note,n,pxsim.music.tickToMs(I.beatsPerMinute,I.ticksPerBeat,G))}}},onWorkspaceDragStart:()=>{if(B(!1),H.current)return H.current.editing=I,H.current.original=I,void(H.current.selectionAtDragStart=x&&Object.assign({},x));H.current={editing:I,original:I,selectionAtDragStart:x&&Object.assign({},x)}},onWorkspaceDragEnd:()=>{if("move"===H.current.dragType){const e=H.current.dragEnd.tick-H.current.dragStart.tick,t=H.current.dragEnd.row-(H.current.dragEnd.isBassClef?12:0)-(H.current.dragStart.row-(H.current.dragStart.isBassClef?12:0));return $(Object.assign(Object.assign({},H.current.selectionAtDragStart),{deltaTick:H.current.selectionAtDragStart.deltaTick+e,transpose:H.current.selectionAtDragStart.transpose+t})),H.current.dragStart=void 0,H.current.dragEnd=void 0,void(H.current.selectionAtDragStart=void 0)}if("note-length"===H.current.dragType&&W(),pxt.assets.music.songEquals(H.current.editing,H.current.original)||j(H.current.editing,!0),"marquee"===H.current.dragType){const e=(0,h.findSelectedRange)(H.current.editing,G);$(e?{startTick:e.start,endTick:e.end,deltaTick:0,transpose:0,originalSong:H.current.editing}:void 0)}H.current=void 0},onWorkspaceDrag:(e,t)=>{if(X(t.tick),v){for(let e=0;e<I.tracks.length;e++){if(k&&e!==_)continue;const i=I.tracks[e].instrument,n=(0,h.findPreviousNoteEvent)(I,e,t.exactTick),s=e=>(0,h.isBassClefNote)(i.octave,e,V)===t.isBassClef&&(0,h.noteToRow)(i.octave,e,V)===t.row;((null==n?void 0:n.startTick)===t.exactTick||(null==n?void 0:n.endTick)>t.exactTick)&&n.notes.some(s)&&j((0,h.removeNoteAtRowFromTrack)(I,e,t.row,t.isBassClef,n.startTick),!1)}return}if(H.current.dragType=void 0,H.current.dragStart=e,H.current.dragEnd=t,H.current.original.tracks[_].drums)return void j((0,h.fillDrums)(H.current.original,_,e.row,e.tick,t.tick,G),!1);if(H.current.selectionAtDragStart){const i=(0,h.findNoteEventAtPosition)(H.current.original,e,k?_:void 0);if(null==i?void 0:i.selected){H.current.dragType="move";const i=t.tick-e.tick,n=t.row-(t.isBassClef?12:0)-(e.row-(e.isBassClef?12:0)),s=Object.assign(Object.assign({},H.current.selectionAtDragStart),{deltaTick:i+H.current.selectionAtDragStart.deltaTick,transpose:n+H.current.selectionAtDragStart.transpose}),o=(0,h.applySelection)(s,k?_:void 0);return j(o,!1),void $(s)}}const i=(0,h.findPreviousNoteEvent)(H.current.original,_,e.exactTick);if(!V&&i&&e.exactTick>=i.startTick&&e.exactTick<i.endTick){let n=!1;for(const t of i.notes)if((0,h.noteToRow)(I.tracks[_].instrument.octave,t,!1)===e.row){n=!0;break}if(n){if(t.tick<i.startTick+1)return;return $(void 0),H.current.dragType="note-length",void j((0,h.editNoteEventLength)(H.current.original,_,i.startTick,t.tick),!1)}}$({startTick:e.tick,endTick:t.tick,deltaTick:0,transpose:0,originalSong:H.current.editing}),j((0,h.selectNoteEventsInRange)(H.current.original,e.tick,t.tick,k?_:void 0),!1),H.current.dragType="marquee"},gridTicks:G,hideUnselectedTracks:k,showBassClef:F,selection:x,cursor:P?D:void 0,onKeydown:e=>{B(!0);let t=D;t||(t={tick:0,gridTicks:G,track:_,bassClef:!1,hideTracksActive:k,selection:x}),t.gridTicks=G,t.track=_,t.selection=x,t.hideTracksActive=k;const[i,n]=(0,r.handleKeyboardEvent)(I,t,e);pxt.assets.music.songEquals(i,I)||j(i,!n.selection),n.selection?$(n.selection):$(void 0),M(n)}}),(0,n.jsx)(l.PlaybackControls,{song:I,onTempoChange:e=>{W(),B(!1),j(Object.assign(Object.assign({},I),{beatsPerMinute:e}),!0)},onMeasuresChanged:e=>{W(),B(!1),j((0,h.changeSongLength)(I,e),!0)},onUndoClick:()=>{if(!N.length)return;R(S.concat([I]));const e=N.pop();A(N.slice()),j(e,!1)},onRedoClick:()=>{if(!S.length)return;A(N.concat([I]));const e=S.pop();R(S.slice()),j(e,!1)},showBassClef:F,onBassClefCheckboxClick:U,hasUndo:!!N.length,hasRedo:!!S.length}),(0,n.jsx)(o.EditControls,{assetName:t.meta.displayName,onAssetNameChanged:p,onDoneClicked:m,hideDoneButton:f})]}))}},{"./EditControls":173,"./PlaybackControls":178,"./ScrollableWorkspace":179,"./TrackSelector":182,"./keyboardNavigation":185,"./playback":186,"./utils":188,react:255,"react/jsx-runtime":256}],176:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Note=void 0;const n=e("react/jsx-runtime"),s=e("../../../../react-common/components/util"),o=e("./svgConstants"),r=e("./utils");i.Note=e=>{const{row:t,iconURI:i,length:a,opacity:l,enharmonicSpelling:c,isBassClef:u,selected:h,cursorHighlighted:d}=e;return(0,n.jsxs)("g",Object.assign({className:(0,s.classList)("music-staff-note",h&&"selected",d&&"cursor-highlighted"),transform:`translate(${-o.NOTE_ICON_WIDTH/2}, ${(0,o.rowY)(t,u)-o.NOTE_ICON_WIDTH/2})`},{children:[0===t&&(0,n.jsx)("line",{className:"music-staff-row",x1:-o.NOTE_ICON_WIDTH/2,y1:o.NOTE_ICON_WIDTH/2,x2:3*o.NOTE_ICON_WIDTH/2,y2:o.NOTE_ICON_WIDTH/2,opacity:l}),!!a&&(0,n.jsx)("rect",{x:o.NOTE_ICON_WIDTH/2,y:o.NOTE_ICON_WIDTH/2-o.NOTE_DURATION_HEIGHT/2,width:a,height:o.NOTE_DURATION_HEIGHT}),(0,n.jsx)("image",Object.assign({x:0,y:0,width:o.NOTE_ICON_WIDTH,height:o.NOTE_ICON_WIDTH,href:(0,r.resolveImageURL)(i),opacity:l},{children:(0,n.jsx)("animate",{attributeName:"y",values:"0;-7;-10;-7;0",dur:"0.25s",repeatCount:"1",begin:"indefinite"})})),c&&"normal"!==c&&(0,n.jsx)("text",Object.assign({x:o.NOTE_ICON_WIDTH,y:0,fontSize:o.NOTE_ICON_WIDTH/2},{children:"sharp"===c?"":""}))]}))}},{"../../../../react-common/components/util":139,"./svgConstants":187,"./utils":188,"react/jsx-runtime":256}],177:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.NoteGroup=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("./Note"),r=e("./playback"),a=e("./svgConstants"),l=e("./utils");i.NoteGroup=e=>{const{song:t,noteEvent:i,octave:c,iconURI:u,isDrumTrack:h,cursor:d}=e;let p;s.useEffect((()=>{let e=!1;const t=t=>{if(t>=i.startTick&&t<i.endTick){if(!e){e=!0,p.classList.add("music-note-playing");const t=p.querySelectorAll("animate");for(let e=0;e<t.length;e++)t.item(e).beginElement()}}else e&&(e=!1,p.classList.remove("music-note-playing"))},n=()=>{e&&(e=!1,p.classList.remove("music-note-playing"))};return(0,r.addTickListener)(t),(0,r.addPlaybackStateListener)(n),()=>{(0,r.removeTickListener)(t),(0,r.removePlaybackStateListener)(n),p.classList.remove("music-note-playing")}}),[i]);const g=(0,a.tickToX)(t.ticksPerBeat,i.startTick),m=h?0:(0,a.tickToX)(t.ticksPerBeat,i.endTick)-g,f=(null==d?void 0:d.tick)===i.startTick;return(0,n.jsx)("g",Object.assign({className:"music-staff-note-group",transform:`translate(${g}, 0)`,ref:e=>{e&&(p=e)}},{children:i.notes.map(((e,t)=>{const s=(0,l.isBassClefNote)(c,e,h),r=(0,l.noteToRow)(c,e,h);return(0,n.jsx)(o.Note,{isBassClef:s,row:r,enharmonicSpelling:e.enharmonicSpelling,iconURI:u,length:m,selected:i.selected,cursorHighlighted:f&&d.noteGroupIndex===t},t)}))}))}},{"./Note":176,"./playback":186,"./svgConstants":187,"./utils":188,react:255,"react/jsx-runtime":256}],178:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PlaybackControls=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("../../../../react-common/components/controls/Button"),r=e("../../../../react-common/components/controls/Checkbox"),a=e("../../../../react-common/components/controls/Input"),l=e("../../../../react-common/components/util"),c=e("./playback");i.PlaybackControls=e=>{const{song:t,onTempoChange:i,onMeasuresChanged:u,onUndoClick:h,onRedoClick:d,hasUndo:p,hasRedo:g,showBassClef:m,onBassClefCheckboxClick:f}=e,[_,T]=s.useState("stop");s.useEffect((()=>{const e=e=>{T(e)};return(0,c.addPlaybackStateListener)(e),()=>(0,c.removePlaybackStateListener)(e)}),[]);const E=e=>{let t=parseFloat(e);Number.isNaN(t)||(t=Math.min(500,Math.max(20,Math.floor(t))),i(t))},b=e=>{let t=parseInt(e);isNaN(t)||t<1||t>50||u(t)};return(0,n.jsxs)("div",Object.assign({className:"music-playback-controls"},{children:[(0,n.jsxs)("div",Object.assign({className:"music-playback-buttons"},{children:[(0,n.jsx)(o.Button,{className:"square-button",title:lf("Stop"),leftIcon:"fas fa-stop",onClick:()=>{(0,c.stopPlayback)(),T("stop")}}),(0,n.jsx)(o.Button,{className:(0,l.classList)("square-button","play"===_&&"green"),title:lf("Play"),leftIcon:"fas fa-play",onClick:()=>{(0,c.startPlaybackAsync)(t,!1,0),T("play")}}),(0,n.jsx)(o.Button,{className:(0,l.classList)("square-button","loop"===_&&"green"),title:lf("Loop"),leftIcon:"fas fa-retweet",onClick:()=>{(0,c.isLooping)()||((0,c.isPlaying)()?(0,c.setLooping)(!0):(0,c.startPlaybackAsync)(t,!0,0),T("loop"))}})]})),(0,n.jsx)(a.Input,{id:"music-playback-tempo-input music-editor-label",label:lf("Tempo:"),initialValue:t.beatsPerMinute.toString(),onBlur:E,onEnterKey:E}),(0,n.jsx)("div",{className:"spacer"}),(0,n.jsx)(r.Checkbox,{className:"music-editor-label",id:"show-bass-clef",label:lf("Show bass clef"),isChecked:m,onChange:f}),(0,n.jsxs)("div",Object.assign({className:"music-undo-redo common-button-group"},{children:[(0,n.jsx)(o.Button,{className:"square-button purple",title:lf("Undo"),leftIcon:"xicon undo",disabled:!p,onClick:h}),(0,n.jsx)(o.Button,{className:"square-button purple",title:lf("Redo"),leftIcon:"xicon redo",disabled:!g,onClick:d})]})),(0,n.jsxs)("div",Object.assign({className:"music-playback-measures"},{children:[(0,n.jsx)("div",Object.assign({className:"music-editor-label"},{children:lf("Measures:")})),(0,n.jsx)(o.Button,{className:"menu-button",title:lf("Remove measure"),leftIcon:"fas fa-minus-circle",onClick:()=>{t.measures>1&&u(t.measures-1)}}),(0,n.jsx)(a.Input,{id:"music-playback-measures-input",initialValue:t.measures.toString(),onBlur:b,onEnterKey:b}),(0,n.jsx)(o.Button,{className:"menu-button",title:lf("Add measure"),leftIcon:"fas fa-plus-circle",onClick:()=>{t.measures<50&&u(t.measures+1)}})]}))]}))}},{"../../../../react-common/components/controls/Button":131,"../../../../react-common/components/controls/Checkbox":132,"../../../../react-common/components/controls/Input":137,"../../../../react-common/components/util":139,"./playback":186,react:255,"react/jsx-runtime":256}],179:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ScrollableWorkspace=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("./svgConstants"),r=e("./utils"),a=e("./Workspace");i.ScrollableWorkspace=e=>{const{cursor:t,song:i}=e,l=s.useRef(null);return s.useEffect((()=>{if(!t)return;const e=(0,o.tickToX)(i.ticksPerBeat,t.tick),n=l.current.querySelector("svg"),s=e=>{const t=n.createSVGPoint();return t.x=e,t.y=0,t.matrixTransform(n.getScreenCTM()).x},a=s(e),c=(0,r.findNoteEventAtTick)(i,t.track,t.tick),u=s(e+o.BEAT_WIDTH)-a;let h;h=c?s((0,o.tickToX)(i.ticksPerBeat,c.endTick+i.ticksPerBeat/2))-a:u;const d=l.current.getBoundingClientRect(),p=a-d.x,g=p+h;p<u?l.current.scrollLeft+=p-u:h<d.width&&g>d.width&&(l.current.scrollLeft+=g-d.width)}),[null==t?void 0:t.tick,i.ticksPerBeat]),(0,n.jsx)("div",Object.assign({ref:l,className:"music-scrollable-workspace"},{children:(0,n.jsx)("div",Object.assign({className:"music-scroller"},{children:(0,n.jsx)(a.Workspace,Object.assign({},e))}))}))}},{"./Workspace":183,"./svgConstants":187,"./utils":188,react:255,"react/jsx-runtime":256}],180:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Staff=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("../../../../react-common/components/util"),r=e("./playback"),a=e("./svgConstants"),l=e("./utils");i.Staff=e=>{const{top:t,isBassClef:i,gridTicks:c,ticksPerBeat:u,beatsPerMeasure:h,beatsPerMinute:d,measures:p}=e;let g;s.useEffect((()=>{const e=pxsim.music.tickToMs(d,u,1),t=(0,a.tickToX)(u,2)-(0,a.tickToX)(u,1);let i,n,s=0,o=!1;const l=e=>{s=(0,a.tickToX)(u,e),n=Date.now(),o||(o=!0,g.style.display="unset",i=requestAnimationFrame(h))},c=()=>{o=!1,g.style.display="none",i&&cancelAnimationFrame(i)},h=()=>{const r=s+t*(Date.now()-n)/e;g.setAttribute("transform",`translate(${r}, 0)`),o&&(i=requestAnimationFrame(h))};return(0,r.addTickListener)(l),(0,r.addPlaybackStateListener)(c),()=>{(0,r.removeTickListener)(l),(0,r.removePlaybackStateListener)(c),i&&cancelAnimationFrame(i)}}),[u,d]);const m=(0,a.workspaceWidth)(p,h),f=[];for(let e=0;e<5;e++)f.push((0,n.jsx)("line",{className:"music-staff-row",x1:0,y1:(0,a.rowY)(2*e+2,!1),x2:m,y2:(0,a.rowY)(2*e+2,!1)},e));const _=[],T=c;for(let e=0;e<p*h*u;e+=T){const t=e%u==0,s=e%(h*u)==0,r=!t&&!s;_.push((0,n.jsxs)("g",{children:[s&&!i&&(0,n.jsx)("text",Object.assign({x:(0,a.tickToX)(u,e),y:a.STAFF_HEADER_HEIGHT-a.STAFF_HEADER_OFFSET,textAnchor:"middle",fontSize:a.STAFF_HEADER_FONT_SIZE},{children:Math.floor(e/(h*u))+1})),(0,n.jsx)("line",{className:"music-staff-column",x1:(0,a.tickToX)(u,e),y1:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,x2:(0,a.tickToX)(u,e),y2:a.STAFF_HEADER_HEIGHT}),!r&&(0,n.jsx)("line",{className:(0,o.classList)("music-staff-column",t&&"beat-start",s&&"measure-start"),x1:(0,a.tickToX)(u,e),y1:i&&s?0:a.STAFF_HEADER_HEIGHT,x2:(0,a.tickToX)(u,e),y2:a.WORKSPACE_HEIGHT})]},e))}return(0,n.jsxs)("g",Object.assign({className:"music-staff",transform:`translate(0 ${t})`},{children:[(0,n.jsx)("rect",{className:"music-staff-background",x:0,y:a.STAFF_HEADER_HEIGHT,width:m,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT}),(0,n.jsx)("image",{className:"music-staff-clef",href:(0,l.resolveImageURL)(i?"music-editor/bass-clef.svg":"music-editor/treble-clef.svg"),height:i?a.BASS_CLEF_HEIGHT:a.CLEF_HEIGHT,x:0,y:i?a.BASS_CLEF_TOP:a.STAFF_HEADER_HEIGHT}),(0,n.jsx)("rect",{fill:"#000",x:0,y:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,width:m,height:a.STAFF_GRID_TICK_HEIGHT}),(0,n.jsx)("rect",{fill:"#dedede",x:a.CLEF_WIDTH,y:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,width:m-a.CLEF_WIDTH-a.STAFF_END_WIDTH,height:a.STAFF_GRID_TICK_HEIGHT}),(0,n.jsx)("g",Object.assign({className:"music-staff-rows"},{children:f})),(0,n.jsx)("g",Object.assign({className:"music-staff-beats"},{children:_})),(0,n.jsxs)("g",Object.assign({className:"music-staff-end"},{children:[(0,n.jsx)("rect",{x:m-a.STAFF_END_WIDTH,y:a.STAFF_HEADER_HEIGHT,width:3,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT}),(0,n.jsx)("rect",{x:m-12,y:a.STAFF_HEADER_HEIGHT,width:12,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT})]})),(0,n.jsx)("g",Object.assign({className:"music-playback-head",ref:e=>{e&&(g=e)}},{children:(0,n.jsx)("line",{className:"music-playback-line",x1:0,y1:a.STAFF_HEADER_HEIGHT,x2:0,y2:a.WORKSPACE_HEIGHT})}))]}))}},{"../../../../react-common/components/util":139,"./playback":186,"./svgConstants":187,"./utils":188,react:255,"react/jsx-runtime":256}],181:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Track=void 0;const n=e("react/jsx-runtime"),s=e("./Note"),o=e("./NoteGroup"),r=e("./svgConstants");i.Track=e=>{const{song:t,track:i,cursorLocation:a,keyboardCursor:l}=e;let c;return a&&(c=(0,n.jsx)("g",Object.assign({transform:`translate(${(0,r.tickToX)(t.ticksPerBeat,a.tick)}, 0)`},{children:(0,n.jsx)(s.Note,{isBassClef:a.isBassClef,row:a.row,iconURI:i.iconURI,opacity:.5})}))),(0,n.jsxs)("g",Object.assign({className:"music-staff-track"},{children:[l&&(0,n.jsx)("g",{children:(0,n.jsx)("rect",{x:(0,r.tickToX)(t.ticksPerBeat,l.tick),y:l.bassClef?r.BASS_STAFF_TOP+r.STAFF_HEADER_HEIGHT:r.STAFF_HEADER_HEIGHT,width:5,height:r.WORKSPACE_HEIGHT-r.STAFF_HEADER_HEIGHT,fill:"purple"})}),i.notes.map((e=>(0,n.jsx)(o.NoteGroup,{noteEvent:e,octave:i.instrument.octave,song:t,iconURI:i.iconURI,isDrumTrack:!!i.drums,cursor:l},e.startTick))),c]}))}},{"./Note":176,"./NoteGroup":177,"./svgConstants":187,"react/jsx-runtime":256}],182:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TrackSelector=void 0;const n=e("react/jsx-runtime"),s=e("../../../../react-common/components/controls/Button"),o=e("../../../../react-common/components/controls/Checkbox"),r=e("../../../../react-common/components/controls/Dropdown"),a=e("../../../../react-common/components/controls/FocusList"),l=e("../../../../react-common/components/util"),c=e("./utils"),u={four:"1/4",eight:"1/8",sixteen:"1/16",thirtytwo:"1/32"};i.TrackSelector=e=>{const{song:t,selected:i,onTrackSelected:h,selectedResolution:d,onResolutionSelected:p,eraserActive:g,onEraserClick:m,hideTracksActive:f,onHideTracksClick:_}=e,T=[{title:lf("1/4 Note"),label:lf("1/4"),id:"four"},{title:lf("1/8 Note"),label:lf("1/8"),id:"eight"},{title:lf("1/16 Note"),label:lf("1/16"),id:"sixteen"},{title:lf("1/32 Note"),label:lf("1/32"),id:"thirtytwo"}];return(0,n.jsxs)("div",Object.assign({className:"music-track-selector"},{children:[(0,n.jsxs)(a.FocusList,Object.assign({role:"radiogroup",ariaLabel:lf("Track selection")},{children:[t.tracks.map(((e,o)=>(0,n.jsx)(s.Button,{role:"radio",ariaSelected:i===o&&!g,ariaPosInSet:o+1,ariaSetSize:t.tracks.length+1,title:e.name,className:(0,l.classList)("music-track-button square-button pixellated",i===o&&!g&&"selected"),label:(0,n.jsx)("img",{src:(0,c.resolveImageURL)(e.iconURI),alt:e.name}),onClick:()=>(e=>{h(e)})(o)},e.name))),(0,n.jsx)(s.Button,{className:(0,l.classList)("music-track-button square-button",g&&"selected"),title:g?lf("Turn off eraser tool"):lf("Turn on eraser tool"),leftIcon:"fas fa-eraser",ariaSelected:g,ariaPosInSet:t.tracks.length,ariaSetSize:t.tracks.length+1,onClick:m})]})),(0,n.jsx)(o.Checkbox,{className:"music-editor-label",id:"hide-tracks",label:lf("Only show selected instrument"),isChecked:f,onChange:_}),(0,n.jsxs)("div",Object.assign({className:"music-track-grid"},{children:[(0,n.jsx)("div",Object.assign({className:"music-editor-label"},{children:lf("Grid:")})),(0,n.jsx)(r.Dropdown,{id:"grid-resolution",ariaLabel:lf("Staff grid resolution"),items:T,selectedId:Object.keys(u).find((e=>u[e]===d)),onItemSelected:e=>{p(u[e])}})]}))]}))}},{"../../../../react-common/components/controls/Button":131,"../../../../react-common/components/controls/Checkbox":132,"../../../../react-common/components/controls/Dropdown":133,"../../../../react-common/components/controls/FocusList":135,"../../../../react-common/components/util":139,"./utils":188,"react/jsx-runtime":256}],183:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Workspace=void 0;const n=e("react/jsx-runtime"),s=e("react"),o=e("../../../../react-common/components/util"),r=e("./GridHighlight"),a=e("./Staff"),l=e("./svgConstants"),c=e("./Track"),u=e("./utils"),h=e("./WorkspaceSelection");function d(e,t,i,n){const s=(0,o.screenToSVGCoord)(t,(0,o.clientCoord)(e)),r=s.y>l.BASS_STAFF_TOP,a=(0,l.closestTick)(i.ticksPerBeat,s.x+l.BEAT_WIDTH/i.ticksPerBeat,n);return{isBassClef:r,row:(0,l.closestRow)(s.y),tick:a,exactTick:(0,l.closestTick)(i.ticksPerBeat,s.x,1)}}i.Workspace=e=>{const{song:t,onWorkspaceClick:i,gridTicks:p,selectedTrack:g,onWorkspaceDrag:m,onWorkspaceDragStart:f,onWorkspaceDragEnd:_,onKeydown:T,cursor:E,hideUnselectedTracks:b,eraserActive:I,showBassClef:y,selection:v}=e,[C,k]=s.useState(null),[O,N]=s.useState(null),[A,S]=s.useState(!1);let R;s.useEffect((()=>{R.onpointerdown=e=>{e.preventDefault(),R.focus();const i=d(e,R,t,p);i.tick>=0&&i.row>=0&&i.row<12&&N(i)},R.onpointermove=e=>{const i=d(e,R,t,p);if(C&&C.exactTick===i.exactTick&&C.row===i.row)return;const n=t.beatsPerMeasure*t.ticksPerBeat*t.measures;i.tick>=0&&i.row>=0&&i.row<12&&i.tick<=n?(O&&(A||(S(!0),f()),m(O,i)),i.tick<n?k(i):k(null)):k(null)},R.onpointerleave=e=>{k(null),A&&(_(),S(!1))},R.onpointerup=e=>{if(N(null),A)_(),S(!1);else{const n=d(e,R,t,p);n.tick>=0&&n.row>=0&&n.row<12&&i(n,e.ctrlKey)}}}),[C,O,A,m,_,f]);let w,L,x=A||I?void 0:C;const $=C&&(0,u.findNoteEventAtTick)(t,g,C.tick),D=O&&(0,u.findNoteEventAtTick)(t,g,O.tick);v?(w=v.startTick+v.deltaTick,L=v.endTick+v.deltaTick):!I&&D&&(null==C?void 0:C.tick)>=D.startTick?(w=D.startTick,L=D.endTick):!I&&A&&C&&O?(w=Math.min(C.tick,O.tick),L=Math.max(C.tick,O.tick)):$?(w=$.startTick,L=$.endTick):C&&(w=C.tick,L=C.tick+p),$&&x&&(x=Object.assign(Object.assign({},x),{tick:$.startTick}));const M=t.tracks.filter(((e,t)=>t!==g)),P=y?2*l.WORKSPACE_HEIGHT:l.WORKSPACE_HEIGHT,B=pxt.assets.music.getSongInfo(t);return(0,n.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:(0,o.classList)("music-workspace",I&&"erasing"),viewBox:`0 0 ${(0,l.workspaceWidth)(t.measures,t.beatsPerMeasure)+20} ${P}`,"aria-label":lf("Music Workspace"),tabIndex:0,onKeyDown:T,ref:e=>{e&&(R=e)}},{children:[(0,n.jsxs)("filter",Object.assign({id:"selection-outline"},{children:[(0,n.jsx)("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"4"}),(0,n.jsx)("feFlood",{floodColor:"yellow",floodOpacity:"1",result:"FLOODED"}),(0,n.jsx)("feComposite",{in:"FLOODED",in2:"DILATED",operator:"in",result:"OUTLINE"}),(0,n.jsxs)("feMerge",{children:[(0,n.jsx)("feMergeNode",{in:"OUTLINE"}),(0,n.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})),(0,n.jsxs)("filter",Object.assign({id:"cursor-outline"},{children:[(0,n.jsx)("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"4"}),(0,n.jsx)("feFlood",{floodColor:"purple",floodOpacity:"1",result:"FLOODED"}),(0,n.jsx)("feComposite",{in:"FLOODED",in2:"DILATED",operator:"in",result:"OUTLINE"}),(0,n.jsxs)("feMerge",{children:[(0,n.jsx)("feMergeNode",{in:"OUTLINE"}),(0,n.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})),(0,n.jsx)(a.Staff,Object.assign({},B,{top:0,gridTicks:p})),y&&(0,n.jsx)(a.Staff,Object.assign({},B,{top:l.BASS_STAFF_TOP,isBassClef:!0,gridTicks:p})),(0,n.jsx)(r.GridHighlight,Object.assign({},B,{start:w,end:L})),v&&(0,n.jsx)(h.WorkspaceSelection,Object.assign({},B,{range:v})),!b&&M.map(((e,i)=>(0,n.jsx)(c.Track,{track:e,song:t},i))),(0,n.jsx)(c.Track,{track:t.tracks[g],song:t,cursorLocation:x,keyboardCursor:E})]}))}},{"../../../../react-common/components/util":139,"./GridHighlight":174,"./Staff":180,"./Track":181,"./WorkspaceSelection":184,"./svgConstants":187,"./utils":188,react:255,"react/jsx-runtime":256}],184:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WorkspaceSelection=void 0;const n=e("react/jsx-runtime"),s=e("./svgConstants");i.WorkspaceSelection=e=>{const{range:t,ticksPerBeat:i}=e,o=(0,s.tickToX)(i,t.startTick+t.deltaTick),r=(0,s.tickToX)(i,t.endTick+t.deltaTick);return(0,n.jsxs)("g",{children:[(0,n.jsx)("rect",{className:"music-workspace-selection",fill:"#03adfc",opacity:.5,x:Math.min(o,r),y:s.STAFF_HEADER_HEIGHT,width:Math.max(o,r)-Math.min(o,r),height:s.WORKSPACE_HEIGHT-s.STAFF_HEADER_HEIGHT}),(0,n.jsx)("rect",{className:"music-workspace-selection",fill:"#03adfc",opacity:.5,x:Math.min(o,r),y:s.BASS_STAFF_TOP+s.STAFF_HEADER_HEIGHT,width:Math.max(o,r)-Math.min(o,r),height:s.WORKSPACE_HEIGHT-s.STAFF_HEADER_HEIGHT})]})}},{"./svgConstants":187,"react/jsx-runtime":256}],185:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.handleKeyboardEvent=void 0;const n=e("./playback"),s=e("./utils");i.handleKeyboardEvent=function(e,t,i){const o=i.ctrlKey||i.metaKey,r=i.shiftKey,a=i.altKey,l=t.selection?void 0:(0,s.findNoteEventAtTick)(e,t.track,t.tick);(null==l?void 0:l.startTick)===t.tick&&void 0===t.noteGroupIndex&&(t.noteGroupIndex=0);let c=e,u=Object.assign(Object.assign({},t),{selection:t.selection&&Object.assign({},t.selection)});const h=e.tracks[t.track].instrument,d=h.octave,p=e.ticksPerBeat*e.beatsPerMeasure,g=p*e.measures,m=!!t.selection,f=!!e.tracks[t.track].drums,_=e=>{u.selection&&(c=(0,s.applySelection)(u.selection,t.hideTracksActive?t.track:void 0),e&&(c=(0,s.unselectAllNotes)(c)),delete u.selection)},T=t=>{for(const i of t.notes)pxsim.music.playNoteAsync(i.note,h,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,t.endTick-t.startTick))};switch(i.key){case"ArrowUp":case"Up":if(i.preventDefault(),r){u.bassClef=!1;break}if(u.selection){u.selection.transpose++,c=(0,s.applySelection)(u.selection);break}if(!l)break;if(a&&o)u.noteGroupIndex=l.notes.length-1;else if(a)u.noteGroupIndex=Math.min(t.noteGroupIndex+1,l.notes.length-1);else{let i=l.notes[t.noteGroupIndex],n=(0,s.isBassClefNote)(d,i,f);const r=(0,s.noteToRow)(d,i,f);let a=r;const p=o?12:1;for(;l.notes.some((e=>(0,s.isBassClefNote)(d,e,f)===n&&a===(0,s.noteToRow)(d,e,f)));)if((a+=p)>=12){if(!n)break;n=!1,a-=12}if(a>=12||a<0)break;const g=(0,s.rowToNote)(d,a,n,f,i.enharmonicSpelling);c=(0,s.removeNoteAtRowFromTrack)(c,t.track,r,(0,s.isBassClefNote)(d,i,f),l.startTick),c=(0,s.addNoteToTrack)(c,t.track,g,l.startTick,l.endTick);const m=(0,s.findNoteEventAtTick)(c,t.track,t.tick);u.noteGroupIndex=m.notes.findIndex((e=>e.note===g.note)),pxsim.music.playNoteAsync(g.note,h,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,m.endTick-m.startTick))}break;case"ArrowDown":case"Down":if(i.preventDefault(),r){u.bassClef=!0;break}if(u.selection){u.selection.transpose--,c=(0,s.applySelection)(u.selection);break}if(!l)break;if(a&&o)u.noteGroupIndex=0;else if(a)u.noteGroupIndex=Math.max(t.noteGroupIndex-1,0);else{let i=l.notes[t.noteGroupIndex];const n=c.tracks[t.track];let r=(0,s.isBassClefNote)(d,i,!!n.drums);const a=(0,s.noteToRow)(d,i,!!n.drums);let p=a;const g=o?-12:-1;for(;l.notes.some((e=>(0,s.isBassClefNote)(d,e,!!n.drums)===r&&p===(0,s.noteToRow)(d,e,!!n.drums)));)if((p+=g)<0){if(r)break;r=!0,p+=12}if(p>=12||p<0)break;const m=(0,s.rowToNote)(d,p,r,!!n.drums,i.enharmonicSpelling);c=(0,s.removeNoteAtRowFromTrack)(c,t.track,a,(0,s.isBassClefNote)(d,i,!!n.drums),l.startTick),c=(0,s.addNoteToTrack)(c,t.track,m,l.startTick,l.endTick);const f=(0,s.findNoteEventAtTick)(c,t.track,t.tick);u.noteGroupIndex=f.notes.findIndex((e=>e.note===m.note)),pxsim.music.playNoteAsync(m.note,h,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,f.endTick-f.startTick))}break;case"ArrowLeft":case"Left":if(i.preventDefault(),r&&m&&(u.selection.deltaTick||u.selection.transpose)&&_(!0),o){u.tick%p==0?u.tick=Math.max(u.tick-p,0):u.tick=Math.floor(u.tick/p)*p;const e=(0,s.findNoteEventAtTick)(c,t.track,u.tick);(null==e?void 0:e.startTick)===u.tick?(u.noteGroupIndex=0,T(e)):u.noteGroupIndex=void 0;break}const E=t.tick%t.gridTicks!=0?Math.floor(u.tick/t.gridTicks)*t.gridTicks:t.tick-t.gridTicks,b=(0,s.findPreviousNoteEvent)(c,t.track,t.tick-1);if((null==b?void 0:b.endTick)>E){u.tick=b.startTick,u.noteGroupIndex=0;break}u.tick=Math.max(E,0),u.noteGroupIndex=void 0;break;case"ArrowRight":case"Right":if(i.preventDefault(),r&&m&&(u.selection.deltaTick||u.selection.transpose)&&_(!0),o){u.tick%p==0?u.tick=Math.min(u.tick+p,g-p):(u.tick=Math.min(Math.ceil(u.tick/p)*p,g-p),u.tick>=g&&(u.tick-=p));const e=(0,s.findNoteEventAtTick)(c,t.track,u.tick);(null==e?void 0:e.startTick)===u.tick?(u.noteGroupIndex=0,T(e)):u.noteGroupIndex=void 0;break}const I=l?Math.ceil(l.endTick/t.gridTicks)*t.gridTicks:t.tick+t.gridTicks,y=(0,s.findNextNoteEvent)(c,t.track,t.tick);if((null==y?void 0:y.startTick)<=I){u.tick=y.startTick,u.noteGroupIndex=0;break}u.tick=Math.min(Math.ceil(I/t.gridTicks)*t.gridTicks,g-t.gridTicks),u.noteGroupIndex=void 0;break;case"End":if(i.preventDefault(),o){u.tick=g-t.gridTicks;const e=(0,s.findNoteEventAtTick)(c,t.track,u.tick);e?(u.tick=e.startTick,u.noteGroupIndex=0,T(e)):u.noteGroupIndex=void 0}break;case"Home":if(i.preventDefault(),o){u.tick=0;const e=(0,s.findNoteEventAtTick)(c,t.track,u.tick);e?(u.noteGroupIndex=0,T(e)):u.noteGroupIndex=void 0}break;case"Backspace":if(i.preventDefault(),t.selection)_(),c=(0,s.deleteSelectedNotes)(c);else if(void 0!==t.noteGroupIndex){if(o){c=(0,s.removeNoteEventFromTrack)(c,t.track,t.tick),u.noteGroupIndex=void 0;break}c=(0,s.removeNoteFromTrack)(c,t.track,l.notes[t.noteGroupIndex],l.startTick),1===l.notes.length?u.noteGroupIndex=void 0:u.noteGroupIndex=Math.min(u.noteGroupIndex,l.notes.length-2)}break;case"Enter":m&&_(!0);break;case"Spacebar":case" ":i.preventDefault(),(0,n.isPlaying)()?(0,n.stopPlayback)():r?(0,n.startPlaybackAsync)(e,o,null==t?void 0:t.tick):(0,n.startPlaybackAsync)(e,o,0);break;case"j":case"J":if(e.tracks[t.track].drums)break;if(l){i.preventDefault();const e=l.notes[u.noteGroupIndex],n=12*h.octave-20,o=12*h.octave+20,r=(0,s.noteToRow)(d,e,!1),a=l.startTick,p=(0,s.isBassClefNote)(d,e,!1);let g;c=(0,s.removeNoteAtRowFromTrack)(c,u.track,r,p,a),g="normal"===e.enharmonicSpelling&&e.note<o?"sharp":"sharp"===e.enharmonicSpelling&&e.note>n||e.note===o?"flat":"normal";const m=(0,s.rowToNote)(h.octave,r,p,!1,g);c=(0,s.addNoteToTrack)(c,u.track,m,l.startTick,l.endTick),pxsim.music.playNoteAsync(m.note,h,pxsim.music.tickToMs(c.beatsPerMinute,c.ticksPerBeat,t.gridTicks))}break;default:if(o&&"a"===i.key||"A"===i.key){i.preventDefault(),u.selection&&_(!0),u.selection={startTick:0,endTick:g,originalSong:c,transpose:0,deltaTick:0};break}if(/^[a-g]$/i.test(i.key)){if(o)break;let e;i.preventDefault(),_(!0),e=t.bassClef?(0,s.rowToNote)(d,3+"abcdefg".indexOf(i.key.toLowerCase()),!0,f):(0,s.rowToNote)(d,5+"abcdefg".indexOf(i.key.toLowerCase()),!1,f),l?-1===l.notes.indexOf(e)&&(c=(0,s.addNoteToTrack)(c,t.track,e,l.startTick,l.endTick),T((0,s.findNoteEventAtTick)(c,t.track,l.startTick))):(c=(0,s.addNoteToTrack)(c,t.track,e,t.tick,t.tick+t.gridTicks),u.noteGroupIndex=0,T((0,s.findNoteEventAtTick)(c,t.track,t.tick)));break}if(/^[1-9]$/.test(i.key)){i.preventDefault(),_(!0),l&&(c=(0,s.editNoteEventLength)(c,t.track,l.startTick,l.startTick+parseInt(i.key)*t.gridTicks),T((0,s.findNoteEventAtTick)(c,t.track,l.startTick)));break}}if(u.tick!==t.tick)if(r)u.selection?u.selection.endTick=u.tick:u.selection={originalSong:e,startTick:t.tick,endTick:u.tick,transpose:0,deltaTick:0},c=(0,s.applySelection)(u.selection,u.hideTracksActive?u.track:void 0);else if(u.selection){const e=(0,s.selectNoteEventsInRange)(u.selection.originalSong,u.selection.startTick,u.selection.endTick,u.hideTracksActive?u.track:void 0),i=(0,s.findSelectedRange)(e,u.gridTicks);i&&(u.selection.startTick=i.start,u.selection.endTick=i.end),u.selection.deltaTick+=u.tick-t.tick,c=(0,s.applySelection)(u.selection,u.hideTracksActive?u.track:void 0),u.selection.startTick+u.selection.deltaTick>0&&(u.tick=u.selection.startTick+u.selection.deltaTick)}return[c,u]}},{"./playback":186,"./utils":188}],186:[function(e,t,i){"use strict";let n;Object.defineProperty(i,"__esModule",{value:!0}),i.removePlaybackStateListener=i.addPlaybackStateListener=i.removeTickListener=i.addTickListener=i.stopPlayback=i.updatePlaybackSongAsync=i.setLooping=i.isLooping=i.isPlaying=i.startPlaybackAsync=void 0;let s=[],o=[];function r(){return!!n&&"stop"!==n.state()}i.startPlaybackAsync=async function(e,t,i){n||(n=new pxsim.music.Sequencer,await n.initAsync(),n.addEventListener("state-change",(()=>{for(const e of s)e(n.state())})),n.addEventListener("tick",(()=>{for(const e of o)e(n.currentTick())})),n.setVolume(100)),n.startFrom(e,t,i)},i.isPlaying=r,i.isLooping=function(){return r()&&"loop"===n.state()},i.setLooping=function(e){n&&n.setLooping(e)},i.updatePlaybackSongAsync=async function(e){n&&n.updateSong(e)},i.stopPlayback=function(){n&&n.stop()},i.addTickListener=function(e){o.push(e)},i.removeTickListener=function(e){o=o.filter((t=>e!==t))},i.addPlaybackStateListener=function(e){s.push(e)},i.removePlaybackStateListener=function(e){s=s.filter((t=>e!==t))}},{}],187:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.rowY=i.closestRow=i.closestTick=i.beatToX=i.tickToX=i.workspaceWidth=i.BASS_CLEF_HEIGHT=i.BASS_CLEF_TOP=i.BASS_STAFF_HEADER_HEIGHT=i.BASS_STAFF_TOP=i.NOTE_DURATION_HEIGHT=i.NOTE_ICON_WIDTH=i.WORKSPACE_HEIGHT=i.STAFF_GRID_TICK_HEIGHT=i.STAFF_END_WIDTH=i.STAFF_HEADER_OFFSET=i.STAFF_HEADER_FONT_SIZE=i.STAFF_HEADER_HEIGHT=i.CLEF_HEIGHT=i.CLEF_WIDTH=i.STAFF_ROW_HEIGHT=i.BEAT_WIDTH=void 0,i.BEAT_WIDTH=150,i.STAFF_ROW_HEIGHT=50,i.CLEF_WIDTH=250,i.CLEF_HEIGHT=320,i.STAFF_HEADER_HEIGHT=i.STAFF_ROW_HEIGHT,i.STAFF_HEADER_FONT_SIZE=40,i.STAFF_HEADER_OFFSET=11,i.STAFF_END_WIDTH=25,i.STAFF_GRID_TICK_HEIGHT=7,i.WORKSPACE_HEIGHT=i.STAFF_HEADER_HEIGHT+7*i.STAFF_ROW_HEIGHT,i.NOTE_ICON_WIDTH=45,i.NOTE_DURATION_HEIGHT=i.NOTE_ICON_WIDTH/3,i.BASS_STAFF_TOP=i.WORKSPACE_HEIGHT,i.BASS_STAFF_HEADER_HEIGHT=i.STAFF_ROW_HEIGHT/2,i.BASS_CLEF_TOP=90,i.BASS_CLEF_HEIGHT=230,i.workspaceWidth=function(e,t){return i.CLEF_WIDTH+e*t*i.BEAT_WIDTH+i.STAFF_END_WIDTH},i.tickToX=function(e,t){return i.CLEF_WIDTH+i.BEAT_WIDTH/e*t},i.beatToX=function(e){return i.CLEF_WIDTH+i.BEAT_WIDTH*e},i.closestTick=function(e,t,n){const s=Math.floor((t-i.CLEF_WIDTH)*(e/i.BEAT_WIDTH));return Math.floor(s/n)*n},i.closestRow=function(e){const t=e>i.BASS_STAFF_TOP;return 12-Math.round((e-i.STAFF_HEADER_HEIGHT-(t?i.BASS_STAFF_TOP:0))/(i.STAFF_ROW_HEIGHT/2))},i.rowY=function(e,t){return t?i.BASS_STAFF_TOP+i.STAFF_HEADER_HEIGHT+(12-e%12)*i.STAFF_ROW_HEIGHT/2:i.STAFF_HEADER_HEIGHT+(12-e%12)*i.STAFF_ROW_HEIGHT/2}},{}],188:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.doesSongUseBassClef=i.applySelection=i.moveSelectedNotes=i.deleteSelectedNotes=i.unselectAllNotes=i.selectNoteEventsInRange=i.findSelectedRange=i.changeSongLength=i.findNoteEventAtPosition=i.findNextNoteEvent=i.findPreviousNoteEvent=i.findNoteEventAtTick=i.fillDrums=i.editNoteEventLength=i.removeNoteEventFromTrack=i.removeNoteAtRowFromTrack=i.removeNoteFromTrack=i.addNoteToTrack=i.isBassClefNote=i.noteToRow=i.resolveImageURL=i.rowToNote=void 0;const n=[0,2,4,5,7,9,11,12,14,16,17,19],s=[0,1,3,5,7,8,10,12,13,15,17,19];function o(e,t,i,o,r){if(o)return{note:t+(i?12:0),enharmonicSpelling:"normal"};let a;return a=i?s[t]+12*e-19:n[t]+12*e+1,r&&"normal"!==r?"sharp"===r?{note:a+1,enharmonicSpelling:r}:{note:a-1,enharmonicSpelling:r}:{note:a,enharmonicSpelling:"normal"}}function r(e,t,i){if(i)return t.note>=12?t.note-12:t.note;const o=a(e,t,!1),r=t.note-1-12*e+(o?20:0),l=o?s:n;for(let e=0;e<l.length;e++){if(l[e]===r)return"normal"===t.enharmonicSpelling?e:"sharp"===t.enharmonicSpelling?e-1:e+1;if(l[e]>r){if("sharp"===t.enharmonicSpelling)return e-1;if("flat"===t.enharmonicSpelling)return e}}return"sharp"===t.enharmonicSpelling&&r===l[l.length-1]+1?l.length-1:-1}function a(e,t,i){return i?t.note>=12:"flat"===t.enharmonicSpelling?t.note<12*e:"sharp"===t.enharmonicSpelling?t.note<=12*e+1:t.note<12*e+1}function l(e,t,i,n,s){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:c(e.notes,i,n,s,e.instrument.octave,!!e.drums).filter((e=>(e.startTick<=n||e.startTick>=s)&&(e.endTick>=s||e.endTick<=n)))})))})}function c(e,t,i,n,s,o){const l={notes:[t],startTick:i,endTick:n};for(let n=0;n<e.length;n++){if(e[n].startTick>i)return e.slice(0,n).concat([l]).concat(e.slice(n));if(e[n].endTick>i)return e[n].notes.some((e=>e.note===t.note&&e.enharmonicSpelling===t.enharmonicSpelling))?e.slice():e.map(((e,i)=>i!==n?e:Object.assign(Object.assign({},e),{notes:e.notes.concat([t]).sort(((e,t)=>{const i=a(s,e,o);return i===a(s,t,o)?r(s,e,o)-r(s,t,o):i?-1:1}))})))}return e.slice().concat([l])}function u(e,t,i){const n=e.slice();for(let e=0;e<n.length;e++)if(n[e].startTick==i){n[e]=Object.assign(Object.assign({},n[e]),{notes:n[e].notes.filter((e=>e.note!==t.note))});break}return n.filter((e=>e.notes.length))}function h(e,t,i,n,s,o){const l=e.slice();for(let e=0;e<l.length;e++)if(l[e].startTick==s){l[e]=Object.assign(Object.assign({},l[e]),{notes:l[e].notes.filter((e=>a(n,e,o)!==i||r(n,e,o)!==t))});break}return l.filter((e=>e.notes.length))}function d(e,t,i){const n=e.slice();if(t>=i)return n;let s;for(let e=0;e<n.length;e++)n[e].startTick===t?(s=Object.assign(Object.assign({},n[e]),{endTick:i}),n[e]=s):s&&n[e].startTick<s.endTick&&(n[e]=void 0);return n.filter((e=>!!e))}function p(e,t,i){const n=e.tracks[t];for(const e of n.notes)if(e.startTick<=i&&e.endTick>i)return e}function g(e,t){let i=e.measures*e.beatsPerMeasure*e.ticksPerBeat+1,n=-1;for(const t of e.tracks)for(const e of t.notes)e.selected&&(i=Math.min(e.startTick,i),n=Math.max(e.endTick,n));if(-1!==n)return void 0!==t&&(i=Math.floor(i/t)*t,n=Math.ceil(n/t)*t),{start:i,end:n}}function m(e,t,i,n){return void 0!==n?Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,s)=>s!==n?e:f(e,Math.min(t,i),Math.max(t,i))))}):Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>f(e,Math.min(t,i),Math.max(t,i))))})}function f(e,t,i){return Object.assign(Object.assign({},e),{notes:e.notes.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.slice(),selected:!(e.startTick>=i||e.endTick<=t)})))})}function _(e){return Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.map((e=>Object.assign(Object.assign({},e),{selected:!1})))})))})}function T(e,t,i,n){const s=g(e);if(!s)return e;const{start:o,end:r}=s,a=o+t,l=r+t,c=e.beatsPerMeasure*e.ticksPerBeat*e.measures;return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,s)=>void 0!==n&&n!=s?e:Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>e.selected||e.endTick<=a||e.startTick>=l)).map((n=>n.selected?b(n,e.instrument.octave,t,i,!!e.drums):n)).map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,c)}))).filter((e=>e.notes.length>0&&e.startTick>=0&&e.startTick<c)).sort(((e,t)=>e.startTick-t.startTick))})))})}function E(e,t){return e.pastedContent?function(e,t){const i=E(e.pastedContent,t),n=g(i,t),s=e.startTick+e.deltaTick,o=s+(n.end-n.start),r=_(e.originalSong),a=r.beatsPerMeasure*r.ticksPerBeat*r.measures;return Object.assign(Object.assign({},r),{tracks:r.tracks.map(((r,l)=>void 0!==t&&t!=l?r:Object.assign(Object.assign({},r),{notes:r.notes.filter((e=>e.endTick<=s||e.startTick>=o)).concat(i.tracks[l].notes.filter((e=>e.selected)).map((t=>Object.assign(Object.assign({},t),{startTick:t.startTick-n.start+e.startTick,endTick:t.endTick-n.start+e.startTick})))).map((t=>t.selected?b(t,r.instrument.octave,e.deltaTick,e.transpose,!!r.drums):t)).map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,a)}))).filter((e=>e.notes.length>0&&e.startTick>=0&&e.startTick<a)).sort(((e,t)=>e.startTick-t.startTick))})))})}(e,t):T(m(e.originalSong,e.startTick,e.endTick,t),e.deltaTick,e.transpose,t)}function b(e,t,i,s,l){const c=Object.assign(Object.assign({},e),{startTick:e.startTick+i,endTick:e.endTick+i,notes:[]});if(l)c.notes=e.notes.slice();else for(const i of e.notes){let e=a(t,i,l),u=r(t,i,l);u+s>=n.length?e&&(u-=12,e=!1):u+s<0&&(e||(u+=12,e=!0));const h=u+s;h<0||h>=n.length||c.notes.push(o(t,h,e,l,i.enharmonicSpelling))}return c}i.rowToNote=o,i.resolveImageURL=function(e){return window.MonacoPaths&&window.MonacoPaths[e]||e},i.noteToRow=r,i.isBassClefNote=a,i.addNoteToTrack=l,i.removeNoteFromTrack=function(e,t,i,n){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,s)=>s!==t?e:Object.assign(Object.assign({},e),{notes:u(e.notes,i,n)})))})},i.removeNoteAtRowFromTrack=function(e,t,i,n,s){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:h(e.notes,i,n,e.instrument.octave,s,!!e.drums)})))})},i.removeNoteEventFromTrack=function(e,t,i){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,n)=>n!==t?e:Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>e.startTick!==i))})))})},i.editNoteEventLength=function(e,t,i,n){const s=e.beatsPerMeasure*e.ticksPerBeat*e.measures;return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:d(e.notes,i,Math.min(n,s))})))})},i.fillDrums=function(e,t,i,n,s,o){for(let r=n;r<s;r+=o)e=l(e,t,{note:i,enharmonicSpelling:"normal"},r,r+1);return e},i.findNoteEventAtTick=p,i.findPreviousNoteEvent=function(e,t,i){const n=e.tracks[t];let s;for(const e of n.notes){if(e.startTick>i)return s;s=e}return s},i.findNextNoteEvent=function(e,t,i){const n=e.tracks[t];for(const e of n.notes)if(e.startTick>i)return e},i.findNoteEventAtPosition=function(e,t,i){if(void 0!==i){const n=p(e,i,t.tick),s=e.tracks[i];return(null==n?void 0:n.notes.some((e=>r(s.instrument.octave,e,!!s.drums)===t.row)))?n:void 0}for(let i=0;i<e.tracks.length;i++){const n=p(e,i,t.tick),s=e.tracks[i];if(null==n?void 0:n.notes.some((e=>r(s.instrument.octave,e,!!s.drums)===t.row)))return n}},i.changeSongLength=function(e,t){const i=t*e.beatsPerMeasure*e.ticksPerBeat;return Object.assign(Object.assign({},e),{measures:t,tracks:e.tracks.map((e=>{const t=Object.assign(Object.assign({},e),{notes:e.notes.slice()});return t.notes=t.notes.filter((e=>e.startTick<i)),t.notes=t.notes.map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,i)}))),t}))})},i.findSelectedRange=g,i.selectNoteEventsInRange=m,i.unselectAllNotes=_,i.deleteSelectedNotes=function(e){return Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>!e.selected))})))})},i.moveSelectedNotes=T,i.applySelection=E,i.doesSongUseBassClef=function(e){return e.tracks.some((e=>e.notes.some((t=>t.notes.some((t=>a(e.instrument.octave,t,!!e.drums)))))))}},{}],189:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.fireClickOnEnter=void 0,i.fireClickOnEnter=function(e){const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())}},{}],190:[function(e,t,i){var n=e("./toPropertyKey.js");t.exports=function(e,t,i){return(t=n(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPropertyKey.js":197}],191:[function(e,t,i){function n(){return t.exports=n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},t.exports.__esModule=!0,t.exports.default=t.exports,n.apply(null,arguments)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],192:[function(e,t,i){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],193:[function(e,t,i){var n=e("./typeof.js").default;function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(s=function(e){return e?i:t})(e)}t.exports=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=n(e)&&"function"!=typeof e)return{default:e};var i=s(t);if(i&&i.has(e))return i.get(e);var o={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var l=r?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(o,a,l):o[a]=e[a]}return o.default=e,i&&i.set(e,o),o},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":198}],194:[function(e,t,i){var n=e("./defineProperty.js");function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}t.exports=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./defineProperty.js":190}],195:[function(e,t,i){t.exports=function(e,t){if(null==e)return{};var i={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.includes(n))continue;i[n]=e[n]}return i},t.exports.__esModule=!0,t.exports.default=t.exports},{}],196:[function(e,t,i){var n=e("./typeof.js").default;t.exports=function(e,t){if("object"!=n(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":198}],197:[function(e,t,i){var n=e("./typeof.js").default,s=e("./toPrimitive.js");t.exports=function(e){var t=s(e,"string");return"symbol"==n(t)?t:t+""},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPrimitive.js":196,"./typeof.js":198}],198:[function(e,t,i){function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],199:[function(e,t,i){
/*! For license information please see index.js.LICENSE.txt */
!function(n,s){if("object"==typeof i&&"object"==typeof t)t.exports=s(e("blockly/core"),e("blockly/javascript"),e("blockly/dart"),e("blockly/lua"),e("blockly/php"),e("blockly/python"));else if("function"==typeof define&&define.amd)define(["blockly/core","blockly/javascript","blockly/dart","blockly/lua","blockly/php","blockly/python"],s);else{var o="object"==typeof i?s(e("blockly/core"),e("blockly/javascript"),e("blockly/dart"),e("blockly/lua"),e("blockly/php"),e("blockly/python")):s(n.Blockly,n["Blockly.JavaScript"],n["Blockly.Dart"],n["Blockly.Lua"],n["Blockly.PHP"],n["Blockly.Python"]);for(var r in o)("object"==typeof i?i:n)[r]=o[r]}}(this,((e,t,i,n,s,o)=>(()=>{"use strict";var r={370:t=>{t.exports=e},379:e=>{e.exports=i},127:e=>{e.exports=t},157:e=>{e.exports=n},537:e=>{e.exports=s},557:e=>{e.exports=o}},a={};function l(e){var t=a[e];if(void 0!==t)return t.exports;var i=a[e]={exports:{}};return r[e](i,i.exports,l),i.exports}l.d=(e,t)=>{for(var i in t)l.o(t,i)&&!l.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};return(()=>{l.r(c),l.d(c,{FieldColour:()=>o,colourBlend:()=>n,colourPicker:()=>e,colourRandom:()=>t,colourRgb:()=>i,installAllBlocks:()=>ee,registerFieldColour:()=>r});var e={};l.r(e),l.d(e,{BLOCK_NAME:()=>g,blockDefinition:()=>y,installBlock:()=>v,toDart:()=>_,toJavascript:()=>f,toLua:()=>T,toPhp:()=>E,toPython:()=>b});var t={};l.r(t),l.d(t,{BLOCK_NAME:()=>C,blockDefinition:()=>L,installBlock:()=>x,toDart:()=>N,toJavascript:()=>O,toLua:()=>A,toPhp:()=>S,toPython:()=>R});var i={};l.r(i),l.d(i,{BLOCK_NAME:()=>$,blockDefinition:()=>G,installBlock:()=>V,toDart:()=>P,toJavascript:()=>M,toLua:()=>B,toPhp:()=>F,toPython:()=>U});var n={};l.r(n),l.d(n,{BLOCK_NAME:()=>j,blockDefinition:()=>Z,installBlock:()=>Q,toDart:()=>Y,toJavascript:()=>X,toLua:()=>z,toPhp:()=>K,toPython:()=>q});var s=l(370);class o extends s.Field{constructor(e,t,i){super(s.Field.SKIP_SETUP),this.picker=null,this.highlightedIndex=null,this.boundEvents=[],this.SERIALIZABLE=!0,this.CURSOR="default",this.isDirty_=!1,this.colours=["#ffffff","#cccccc","#c0c0c0","#999999","#666666","#333333","#000000","#ffcccc","#ff6666","#ff0000","#cc0000","#990000","#660000","#330000","#ffcc99","#ff9966","#ff9900","#ff6600","#cc6600","#993300","#663300","#ffff99","#ffff66","#ffcc66","#ffcc33","#cc9933","#996633","#663333","#ffffcc","#ffff33","#ffff00","#ffcc00","#999900","#666600","#333300","#99ff99","#66ff99","#33ff33","#33cc00","#009900","#006600","#003300","#99ffff","#33ffff","#66cccc","#00cccc","#339999","#336666","#003333","#ccffff","#66ffff","#33ccff","#3366ff","#3333ff","#000099","#000066","#ccccff","#9999ff","#6666cc","#6633ff","#6600cc","#333399","#330099","#ffccff","#ff99ff","#cc66cc","#cc33cc","#993399","#663366","#330033"],this.titles=[],this.columns=7,e!==s.Field.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),e.colourOptions&&(this.colours=e.colourOptions),e.colourTitles&&(this.titles=e.colourTitles),e.columns&&(this.columns=e.columns)}initView(){const e=this.getConstants();if(!e)throw Error("Constants not found");this.size_=new s.utils.Size(e.FIELD_COLOUR_DEFAULT_WIDTH,e.FIELD_COLOUR_DEFAULT_HEIGHT),this.createBorderRect_(),this.getBorderRect().style.fillOpacity="1",this.getBorderRect().setAttribute("stroke","#fff"),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot())}isFullBlockField(){if(!this.getSourceBlock())throw new s.UnattachedFieldError;const e=this.getConstants();return this.blockIsSimpleReporter()&&Boolean(null==e?void 0:e.FIELD_COLOUR_FULL_BLOCK)}blockIsSimpleReporter(){const e=this.getSourceBlock();if(!e)throw new s.UnattachedFieldError;if(!e.outputConnection)return!1;for(const t of e.inputList)if(t.connection||t.fieldRow.length>1)return!1;return!0}applyColour(){const e=this.getSourceBlock();if(!e)throw new s.UnattachedFieldError;if(!this.fieldGroup_)return;const t=this.borderRect_;if(!t)throw new Error("The border rect has not been initialized");this.isFullBlockField()?(t.style.display="none",e.pathObject.svgPath.setAttribute("fill",this.getValue()),e.pathObject.svgPath.setAttribute("stroke","#fff")):(t.style.display="block",t.style.fill=this.getValue())}getSize(){var e;return(null===(e=this.getConstants())||void 0===e?void 0:e.FIELD_COLOUR_FULL_BLOCK)&&(this.render_(),this.isDirty_=!1),super.getSize()}render_(){super.render_();const e=this.getSourceBlock();if(!e)throw new s.UnattachedFieldError;e.applyColour()}updateSize_(e){const t=this.getConstants();if(!t)return;let i,n;this.isFullBlockField()?(i=2*(null!=e?e:0),n=t.FIELD_TEXT_HEIGHT):(i=t.FIELD_COLOUR_DEFAULT_WIDTH,n=t.FIELD_COLOUR_DEFAULT_HEIGHT),this.size_.height=n,this.size_.width=i,this.positionBorderRect_()}doClassValidation_(e){return"string"!=typeof e?null:s.utils.colour.parse(e)}getText(){let e=this.value_;return/^#(.)\1(.)\2(.)\3$/.test(e)&&(e="#"+e[1]+e[3]+e[5]),e}setColours(e,t){return this.colours=e,t&&(this.titles=t),this}setColumns(e){return this.columns=e,this}showEditor_(){if(this.dropdownCreate(),!this.picker)throw Error("Picker not found");s.DropDownDiv.getContentDiv().appendChild(this.picker),s.DropDownDiv.showPositionedByField(this,this.dropdownDispose.bind(this)),this.picker.focus({preventScroll:!0})}onClick(e){const t=e.target,i=t&&t.getAttribute("data-colour");null!==i&&(this.setValue(i),s.DropDownDiv.hideIfOwner(this))}onKeyDown(e){let t,i=!0;switch(e.key){case"ArrowUp":this.moveHighlightBy(0,-1);break;case"ArrowDown":this.moveHighlightBy(0,1);break;case"ArrowLeft":this.moveHighlightBy(-1,0);break;case"ArrowRight":this.moveHighlightBy(1,0);break;case"Enter":if(t=this.getHighlighted(),t){const e=t.getAttribute("data-colour");null!==e&&this.setValue(e)}s.DropDownDiv.hideWithoutAnimation();break;default:i=!1}i&&e.stopPropagation()}moveHighlightBy(e,t){if(!this.highlightedIndex)return;const i=this.colours,n=this.columns;let s=this.highlightedIndex%n,o=Math.floor(this.highlightedIndex/n);s+=e,o+=t,e<0?s<0&&o>0?(s=n-1,o--):s<0&&(s=0):e>0?s>n-1&&o<Math.floor(i.length/n)-1?(s=0,o++):s>n-1&&s--:t<0?o<0&&(o=0):t>0&&o>Math.floor(i.length/n)-1&&(o=Math.floor(i.length/n)-1);const r=this.picker.childNodes[o].childNodes[s],a=o*n+s;this.setHighlightedCell(r,a)}onMouseMove(e){const t=e.target,i=t&&Number(t.getAttribute("data-index"));null!==i&&i!==this.highlightedIndex&&this.setHighlightedCell(t,i)}onMouseEnter(){var e;null===(e=this.picker)||void 0===e||e.focus({preventScroll:!0})}onMouseLeave(){var e;null===(e=this.picker)||void 0===e||e.blur();const t=this.getHighlighted();t&&s.utils.dom.removeClass(t,"blocklyColourHighlighted")}getHighlighted(){var e;if(!this.highlightedIndex)return null;const t=this.highlightedIndex%this.columns,i=Math.floor(this.highlightedIndex/this.columns),n=null===(e=this.picker)||void 0===e?void 0:e.childNodes[i];return n?n.childNodes[t]:null}setHighlightedCell(e,t){const i=this.getHighlighted();i&&s.utils.dom.removeClass(i,"blocklyColourHighlighted"),s.utils.dom.addClass(e,"blocklyColourHighlighted"),this.highlightedIndex=t;const n=e.getAttribute("id");n&&this.picker&&s.utils.aria.setState(this.picker,s.utils.aria.State.ACTIVEDESCENDANT,n)}dropdownCreate(){const e=this.columns,t=this.colours,i=this.getValue(),n=document.createElement("table");n.className="blocklyColourTable",n.tabIndex=0,n.dir="ltr",s.utils.aria.setRole(n,s.utils.aria.Role.GRID),s.utils.aria.setState(n,s.utils.aria.State.EXPANDED,!0),s.utils.aria.setState(n,s.utils.aria.State.ROWCOUNT,Math.floor(t.length/e)),s.utils.aria.setState(n,s.utils.aria.State.COLCOUNT,e);let o=null;for(let r=0;r<t.length;r++){r%e==0&&(o=document.createElement("tr"),s.utils.aria.setRole(o,s.utils.aria.Role.ROW),n.appendChild(o));const a=document.createElement("td");o.appendChild(a),a.setAttribute("data-colour",t[r]),a.title=this.titles[r]||t[r],a.id=s.utils.idGenerator.getNextUniqueId(),a.setAttribute("data-index",`${r}`),s.utils.aria.setRole(a,s.utils.aria.Role.GRIDCELL),s.utils.aria.setState(a,s.utils.aria.State.LABEL,t[r]),s.utils.aria.setState(a,s.utils.aria.State.SELECTED,t[r]===i),a.style.backgroundColor=t[r],t[r]===i&&(a.className="blocklyColourSelected",this.highlightedIndex=r)}this.boundEvents.push(s.browserEvents.conditionalBind(n,"pointerdown",this,this.onClick,!0)),this.boundEvents.push(s.browserEvents.conditionalBind(n,"pointermove",this,this.onMouseMove,!0)),this.boundEvents.push(s.browserEvents.conditionalBind(n,"pointerenter",this,this.onMouseEnter,!0)),this.boundEvents.push(s.browserEvents.conditionalBind(n,"pointerleave",this,this.onMouseLeave,!0)),this.boundEvents.push(s.browserEvents.conditionalBind(n,"keydown",this,this.onKeyDown,!1)),this.picker=n}dropdownDispose(){for(const e of this.boundEvents)s.browserEvents.unbind(e);this.boundEvents.length=0,this.picker=null,this.highlightedIndex=null}static fromJson(e){return new this(e.colour,void 0,e)}}function r(){s.fieldRegistry.unregister("field_colour"),s.fieldRegistry.register("field_colour",o)}o.prototype.DEFAULT_VALUE="#ffffff",s.Css.register("\n.blocklyColourTable {\n  border-collapse: collapse;\n  display: block;\n  outline: none;\n  padding: 1px;\n}\n\n.blocklyColourTable>tr>td {\n  border: 0.5px solid #888;\n  box-sizing: border-box;\n  cursor: pointer;\n  display: inline-block;\n  height: 20px;\n  padding: 0;\n  width: 20px;\n}\n\n.blocklyColourTable>tr>td.blocklyColourHighlighted {\n  border-color: #eee;\n  box-shadow: 2px 2px 7px 2px rgba(0, 0, 0, 0.3);\n  position: relative;\n}\n\n.blocklyColourSelected, .blocklyColourSelected:hover {\n  border-color: #eee !important;\n  outline: 1px solid #333;\n  position: relative;\n}\n");var a=l(127),u=l(379),h=l(157),d=l(537),p=l(557);const g="colour_picker",m={type:g,message0:"%1",args0:[{type:"field_colour",name:"COLOUR",colour:"#ff0000"}],output:"Colour",helpUrl:"%{BKY_COLOUR_PICKER_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_PICKER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]};function f(e,t){return[t.quote_(e.getFieldValue("COLOUR")),a.Order.ATOMIC]}function _(e,t){return[t.quote_(e.getFieldValue("COLOUR")),u.Order.ATOMIC]}function T(e,t){return[t.quote_(e.getFieldValue("COLOUR")),h.Order.ATOMIC]}function E(e,t){return[t.quote_(e.getFieldValue("COLOUR")),d.Order.ATOMIC]}function b(e,t){return[t.quote_(e.getFieldValue("COLOUR")),p.Order.ATOMIC]}const I=s.common.createBlockDefinitionsFromJsonArray([m]),y=I[g];function v(e={}){r(),s.common.defineBlocks(I),e.javascript&&(e.javascript.forBlock[g]=f),e.dart&&(e.dart.forBlock[g]=_),e.lua&&(e.lua.forBlock[g]=T),e.php&&(e.php.forBlock[g]=E),e.python&&(e.python.forBlock[g]=b)}const C="colour_random",k={type:C,message0:"%{BKY_COLOUR_RANDOM_TITLE}",output:"Colour",helpUrl:"%{BKY_COLOUR_RANDOM_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_RANDOM_TOOLTIP}"};function O(e,t){return[t.provideFunction_("colourRandom",`\nfunction ${t.FUNCTION_NAME_PLACEHOLDER_}() {\n  var num = Math.floor(Math.random() * 0x1000000);\n  return '#' + ('00000' + num.toString(16)).substr(-6);\n}\n`)+"()",a.Order.FUNCTION_CALL]}function N(e,t){return t.definitions_.import_dart_math="import 'dart:math' as Math;",[t.provideFunction_("colour_random",`\nString ${t.FUNCTION_NAME_PLACEHOLDER_}() {\n  String hex = '0123456789abcdef';\n  var rnd = new Math.Random();\n  return '#\${hex[rnd.nextInt(16)]}\${hex[rnd.nextInt(16)]}'\n      '\${hex[rnd.nextInt(16)]}\${hex[rnd.nextInt(16)]}'\n      '\${hex[rnd.nextInt(16)]}\${hex[rnd.nextInt(16)]}';\n}\n`)+"()",u.Order.UNARY_POSTFIX]}function A(e,t){return['string.format("#%06x", math.random(0, 2^24 - 1))',h.Order.HIGH]}function S(e,t){return[t.provideFunction_("colour_random",`\nfunction ${t.FUNCTION_NAME_PLACEHOLDER_}() {\n  return '#' . str_pad(dechex(mt_rand(0, 0xFFFFFF)), 6, '0', STR_PAD_LEFT);\n}\n`)+"()",d.Order.FUNCTION_CALL]}function R(e,t){return t.definitions_.import_random="import random",["'#%06x' % random.randint(0, 2**24 - 1)",p.Order.FUNCTION_CALL]}const w=s.common.createBlockDefinitionsFromJsonArray([k]),L=w[C];function x(e={}){r(),s.common.defineBlocks(w),e.javascript&&(e.javascript.forBlock[C]=O),e.dart&&(e.dart.forBlock[C]=N),e.lua&&(e.lua.forBlock[C]=A),e.php&&(e.php.forBlock[C]=S),e.python&&(e.python.forBlock[C]=R)}const $="colour_rgb",D={type:$,message0:"%{BKY_COLOUR_RGB_TITLE} %{BKY_COLOUR_RGB_RED} %1 %{BKY_COLOUR_RGB_GREEN} %2 %{BKY_COLOUR_RGB_BLUE} %3",args0:[{type:"input_value",name:"RED",check:"Number",align:"RIGHT"},{type:"input_value",name:"GREEN",check:"Number",align:"RIGHT"},{type:"input_value",name:"BLUE",check:"Number",align:"RIGHT"}],output:"Colour",helpUrl:"%{BKY_COLOUR_RGB_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_RGB_TOOLTIP}"};function M(e,t){const i=t.valueToCode(e,"RED",a.Order.NONE)||0,n=t.valueToCode(e,"GREEN",a.Order.NONE)||0,s=t.valueToCode(e,"BLUE",a.Order.NONE)||0;return[`${t.provideFunction_("colourRgb",`\nfunction ${t.FUNCTION_NAME_PLACEHOLDER_}(r, g, b) {\n  r = Math.max(Math.min(Number(r), 100), 0) * 2.55;\n  g = Math.max(Math.min(Number(g), 100), 0) * 2.55;\n  b = Math.max(Math.min(Number(b), 100), 0) * 2.55;\n  r = ('0' + (Math.round(r) || 0).toString(16)).slice(-2);\n  g = ('0' + (Math.round(g) || 0).toString(16)).slice(-2);\n  b = ('0' + (Math.round(b) || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`)}(${i}, ${n}, ${s})`,a.Order.FUNCTION_CALL]}function P(e,t){const i=t.valueToCode(e,"RED",u.Order.NONE)||0,n=t.valueToCode(e,"GREEN",u.Order.NONE)||0,s=t.valueToCode(e,"BLUE",u.Order.NONE)||0;return t.definitions_.import_dart_math="import 'dart:math' as Math;",[`${t.provideFunction_("colour_rgb",`\nString ${t.FUNCTION_NAME_PLACEHOLDER_}(num r, num g, num b) {\n  num rn = (Math.max(Math.min(r, 100), 0) * 2.55).round();\n  String rs = rn.toInt().toRadixString(16);\n  rs = '0$rs';\n  rs = rs.substring(rs.length - 2);\n  num gn = (Math.max(Math.min(g, 100), 0) * 2.55).round();\n  String gs = gn.toInt().toRadixString(16);\n  gs = '0$gs';\n  gs = gs.substring(gs.length - 2);\n  num bn = (Math.max(Math.min(b, 100), 0) * 2.55).round();\n  String bs = bn.toInt().toRadixString(16);\n  bs = '0$bs';\n  bs = bs.substring(bs.length - 2);\n  return '#$rs$gs$bs';\n}\n`)}(${i}, ${n}, ${s})`,u.Order.UNARY_POSTFIX]}function B(e,t){return[`${t.provideFunction_("colour_rgb",`\nfunction ${t.FUNCTION_NAME_PLACEHOLDER_}(r, g, b)\n  r = math.floor(math.min(100, math.max(0, r)) * 2.55 + .5)\n  g = math.floor(math.min(100, math.max(0, g)) * 2.55 + .5)\n  b = math.floor(math.min(100, math.max(0, b)) * 2.55 + .5)\n  return string.format("#%02x%02x%02x", r, g, b)\nend\n`)}(${t.valueToCode(e,"RED",h.Order.NONE)||0}, ${t.valueToCode(e,"GREEN",h.Order.NONE)||0}, ${t.valueToCode(e,"BLUE",h.Order.NONE)||0})`,h.Order.HIGH]}function F(e,t){const i=t.valueToCode(e,"RED",d.Order.NONE)||0,n=t.valueToCode(e,"GREEN",d.Order.NONE)||0,s=t.valueToCode(e,"BLUE",d.Order.NONE)||0;return[`${t.provideFunction_("colour_rgb",`\nfunction ${t.FUNCTION_NAME_PLACEHOLDER_}($r, $g, $b) {\n  $r = round(max(min($r, 100), 0) * 2.55);\n  $g = round(max(min($g, 100), 0) * 2.55);\n  $b = round(max(min($b, 100), 0) * 2.55);\n  $hex = '#';\n  $hex .= str_pad(dechex($r), 2, '0', STR_PAD_LEFT);\n  $hex .= str_pad(dechex($g), 2, '0', STR_PAD_LEFT);\n  $hex .= str_pad(dechex($b), 2, '0', STR_PAD_LEFT);\n  return $hex;\n}\n`)}(${i}, ${n}, ${s})`,d.Order.FUNCTION_CALL]}function U(e,t){return[t.provideFunction_("colour_rgb",`\ndef ${t.FUNCTION_NAME_PLACEHOLDER_}(r, g, b):\n  r = round(min(100, max(0, r)) * 2.55)\n  g = round(min(100, max(0, g)) * 2.55)\n  b = round(min(100, max(0, b)) * 2.55)\n  return '#%02x%02x%02x' % (r, g, b)\n`)+"("+(t.valueToCode(e,"RED",p.Order.NONE)||0)+", "+(t.valueToCode(e,"GREEN",p.Order.NONE)||0)+", "+(t.valueToCode(e,"BLUE",p.Order.NONE)||0)+")",p.Order.FUNCTION_CALL]}const H=s.common.createBlockDefinitionsFromJsonArray([D]),G=H[$];function V(e={}){r(),s.common.defineBlocks(H),e.javascript&&(e.javascript.forBlock[$]=M),e.dart&&(e.dart.forBlock[$]=P,e.dart.addReservedWords("Math")),e.lua&&(e.lua.forBlock[$]=B),e.php&&(e.php.forBlock[$]=F),e.python&&(e.python.forBlock[$]=U)}const j="colour_blend",W={type:j,message0:"%{BKY_COLOUR_BLEND_TITLE} %{BKY_COLOUR_BLEND_COLOUR1} %1 %{BKY_COLOUR_BLEND_COLOUR2} %2 %{BKY_COLOUR_BLEND_RATIO} %3",args0:[{type:"input_value",name:"COLOUR1",check:"Colour",align:"RIGHT"},{type:"input_value",name:"COLOUR2",check:"Colour",align:"RIGHT"},{type:"input_value",name:"RATIO",check:"Number",align:"RIGHT"}],output:"Colour",helpUrl:"%{BKY_COLOUR_BLEND_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_BLEND_TOOLTIP}"};function X(e,t){const i=t.valueToCode(e,"COLOUR1",a.Order.NONE)||"'#000000'",n=t.valueToCode(e,"COLOUR2",a.Order.NONE)||"'#000000'",s=t.valueToCode(e,"RATIO",a.Order.NONE)||.5;return[`${t.provideFunction_("colourBlend",`\nfunction ${t.FUNCTION_NAME_PLACEHOLDER_}(c1, c2, ratio) {\n  ratio = Math.max(Math.min(Number(ratio), 1), 0);\n  var r1 = parseInt(c1.substring(1, 3), 16);\n  var g1 = parseInt(c1.substring(3, 5), 16);\n  var b1 = parseInt(c1.substring(5, 7), 16);\n  var r2 = parseInt(c2.substring(1, 3), 16);\n  var g2 = parseInt(c2.substring(3, 5), 16);\n  var b2 = parseInt(c2.substring(5, 7), 16);\n  var r = Math.round(r1 * (1 - ratio) + r2 * ratio);\n  var g = Math.round(g1 * (1 - ratio) + g2 * ratio);\n  var b = Math.round(b1 * (1 - ratio) + b2 * ratio);\n  r = ('0' + (r || 0).toString(16)).slice(-2);\n  g = ('0' + (g || 0).toString(16)).slice(-2);\n  b = ('0' + (b || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`)}(${i}, ${n}, ${s})`,a.Order.FUNCTION_CALL]}function Y(e,t){const i=t.valueToCode(e,"COLOUR1",u.Order.NONE)||"'#000000'",n=t.valueToCode(e,"COLOUR2",u.Order.NONE)||"'#000000'",s=t.valueToCode(e,"RATIO",u.Order.NONE)||.5;return t.definitions_.import_dart_math="import 'dart:math' as Math;",[`${t.provideFunction_("colour_blend",`\nString ${t.FUNCTION_NAME_PLACEHOLDER_}(String c1, String c2, num ratio) {\n  ratio = Math.max(Math.min(ratio, 1), 0);\n  int r1 = int.parse('0x\${c1.substring(1, 3)}');\n  int g1 = int.parse('0x\${c1.substring(3, 5)}');\n  int b1 = int.parse('0x\${c1.substring(5, 7)}');\n  int r2 = int.parse('0x\${c2.substring(1, 3)}');\n  int g2 = int.parse('0x\${c2.substring(3, 5)}');\n  int b2 = int.parse('0x\${c2.substring(5, 7)}');\n  num rn = (r1 * (1 - ratio) + r2 * ratio).round();\n  String rs = rn.toInt().toRadixString(16);\n  num gn = (g1 * (1 - ratio) + g2 * ratio).round();\n  String gs = gn.toInt().toRadixString(16);\n  num bn = (b1 * (1 - ratio) + b2 * ratio).round();\n  String bs = bn.toInt().toRadixString(16);\n  rs = '0$rs';\n  rs = rs.substring(rs.length - 2);\n  gs = '0$gs';\n  gs = gs.substring(gs.length - 2);\n  bs = '0$bs';\n  bs = bs.substring(bs.length - 2);\n  return '#$rs$gs$bs';\n}\n`)}(${i}, ${n}, ${s})`,u.Order.UNARY_POSTFIX]}function z(e,t){return[`${t.provideFunction_("colour_blend",`\nfunction ${t.FUNCTION_NAME_PLACEHOLDER_}(colour1, colour2, ratio)\n  local r1 = tonumber(string.sub(colour1, 2, 3), 16)\n  local r2 = tonumber(string.sub(colour2, 2, 3), 16)\n  local g1 = tonumber(string.sub(colour1, 4, 5), 16)\n  local g2 = tonumber(string.sub(colour2, 4, 5), 16)\n  local b1 = tonumber(string.sub(colour1, 6, 7), 16)\n  local b2 = tonumber(string.sub(colour2, 6, 7), 16)\n  local ratio = math.min(1, math.max(0, ratio))\n  local r = math.floor(r1 * (1 - ratio) + r2 * ratio + .5)\n  local g = math.floor(g1 * (1 - ratio) + g2 * ratio + .5)\n  local b = math.floor(b1 * (1 - ratio) + b2 * ratio + .5)\n  return string.format("#%02x%02x%02x", r, g, b)\nend\n`)}(${t.valueToCode(e,"COLOUR1",h.Order.NONE)||"'#000000'"}, ${t.valueToCode(e,"COLOUR2",h.Order.NONE)||"'#000000'"}, ${t.valueToCode(e,"RATIO",h.Order.NONE)||0})`,h.Order.HIGH]}function K(e,t){const i=t.valueToCode(e,"COLOUR1",d.Order.NONE)||"'#000000'",n=t.valueToCode(e,"COLOUR2",d.Order.NONE)||"'#000000'",s=t.valueToCode(e,"RATIO",d.Order.NONE)||.5;return[`${t.provideFunction_("colour_blend",`\nfunction ${t.FUNCTION_NAME_PLACEHOLDER_}($c1, $c2, $ratio) {\n  $ratio = max(min($ratio, 1), 0);\n  $r1 = hexdec(substr($c1, 1, 2));\n  $g1 = hexdec(substr($c1, 3, 2));\n  $b1 = hexdec(substr($c1, 5, 2));\n  $r2 = hexdec(substr($c2, 1, 2));\n  $g2 = hexdec(substr($c2, 3, 2));\n  $b2 = hexdec(substr($c2, 5, 2));\n  $r = round($r1 * (1 - $ratio) + $r2 * $ratio);\n  $g = round($g1 * (1 - $ratio) + $g2 * $ratio);\n  $b = round($b1 * (1 - $ratio) + $b2 * $ratio);\n  $hex = '#';\n  $hex .= str_pad(dechex($r), 2, '0', STR_PAD_LEFT);\n  $hex .= str_pad(dechex($g), 2, '0', STR_PAD_LEFT);\n  $hex .= str_pad(dechex($b), 2, '0', STR_PAD_LEFT);\n  return $hex;\n}\n`)}(${i}, ${n}, ${s})`,d.Order.FUNCTION_CALL]}function q(e,t){return[`${t.provideFunction_("colour_blend",`\ndef ${t.FUNCTION_NAME_PLACEHOLDER_}(colour1, colour2, ratio):\n  r1, r2 = int(colour1[1:3], 16), int(colour2[1:3], 16)\n  g1, g2 = int(colour1[3:5], 16), int(colour2[3:5], 16)\n  b1, b2 = int(colour1[5:7], 16), int(colour2[5:7], 16)\n  ratio = min(1, max(0, ratio))\n  r = round(r1 * (1 - ratio) + r2 * ratio)\n  g = round(g1 * (1 - ratio) + g2 * ratio)\n  b = round(b1 * (1 - ratio) + b2 * ratio)\n  return '#%02x%02x%02x' % (r, g, b)\n`)}(${t.valueToCode(e,"COLOUR1",p.Order.NONE)||"'#000000'"}, ${t.valueToCode(e,"COLOUR2",p.Order.NONE)||"'#000000'"}, ${t.valueToCode(e,"RATIO",p.Order.NONE)||0})`,p.Order.FUNCTION_CALL]}const J=s.common.createBlockDefinitionsFromJsonArray([W]),Z=J[j];function Q(e={}){r(),s.common.defineBlocks(J),e.javascript&&(e.javascript.forBlock[j]=X),e.dart&&(e.dart.forBlock[j]=Y,e.dart.addReservedWords("Math")),e.lua&&(e.lua.forBlock[j]=z),e.php&&(e.php.forBlock[j]=K),e.python&&(e.python.forBlock[j]=q)}function ee(e={}){v(e),V(e),x(e),Q(e)}})(),c})()))},{"blockly/core":204,"blockly/dart":205,"blockly/javascript":208,"blockly/lua":210,"blockly/php":213,"blockly/python":215}],200:[function(e,t,i){
/*! For license information please see index.js.LICENSE.txt */
!function(n,s){if("object"==typeof i&&"object"==typeof t)t.exports=s(e("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],s);else{var o=s("object"==typeof i?e("blockly/core"):n.Blockly);for(var r in o)("object"==typeof i?i:n)[r]=o[r]}}(this,(e=>(()=>{"use strict";var t={370:t=>{t.exports=e}},i={};function n(e){var s=i[e];if(void 0!==s)return s.exports;var o=i[e]={exports:{}};return t[e](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};n.r(s),n.d(s,{WorkspaceSearch:()=>a});var o=n(370);const r=function(){let e=!1;return function(){if(e)return;e=!0;const t=document.createElement("style");t.id="blockly-ws-search-style";const i=document.createTextNode("path.blocklyPath.blockly-ws-search-highlight {\n    fill: #000;\n  }\n  path.blocklyPath.blockly-ws-search-highlight.blockly-ws-search-current {\n    fill: grey;\n  }\n  .blockly-ws-search-close-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=) no-repeat top left;\n  }\n  .blockly-ws-search-next-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSA4LjU5TDEyIDEzLjE3bDQuNTktNC41OEwxOCAxMGwtNiA2LTYtNiAxLjQxLTEuNDF6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PC9zdmc+) no-repeat top left;\n  }\n  .blockly-ws-search-previous-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSAxNS40MUwxMiAxMC44M2w0LjU5IDQuNThMMTggMTRsLTYtNi02IDZ6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==) no-repeat top left;\n  }\n  .blockly-ws-search {\n    background: #fff;\n    border: solid lightgrey 0.5px;\n    box-shadow: 0px 10px 20px grey;\n    justify-content: center;\n    padding: 0.25em;\n    position: absolute;\n    z-index: 70;\n  }\n  .blockly-ws-search-input input {\n    border: none;\n  }\n  .blockly-ws-search button {\n    border: none;\n  }\n  .blockly-ws-search-actions {\n    display: flex;\n  }\n  .blockly-ws-search-container {\n    display: flex;\n  }\n  .blockly-ws-search-content {\n    display: flex;\n  }");t.appendChild(i),document.head.insertBefore(t,document.head.firstChild)}}();class a{constructor(e){this.workspace=e,this.id="workspaceSearch",this.htmlDiv=null,this.actionDiv=null,this.inputElement=null,this.textInputPlaceholder="Search",this.blocks=[],this.currentBlockIndex=-1,this.searchText="",this.searchOnInput=!0,this.caseSensitive=!1,this.preserveSelected=!0,this.boundEvents=[]}init(){this.workspace.getComponentManager().addComponent({component:this,weight:0,capabilities:[o.ComponentManager.Capability.POSITIONABLE]}),r(),this.createDom(),this.setVisible(!1),this.workspace.resize()}dispose(){for(const e of this.boundEvents)o.browserEvents.unbind(e);this.boundEvents.length=0,this.htmlDiv&&(this.htmlDiv.remove(),this.htmlDiv=null),this.actionDiv=null,this.inputElement=null}createDom(){const e=this.workspace.getInjectionDiv();this.addEvent(e,"keydown",this,(e=>this.onWorkspaceKeyDown(e))),this.htmlDiv=document.createElement("div"),o.utils.dom.addClass(this.htmlDiv,"blockly-ws-search");const t=document.createElement("div");o.utils.dom.addClass(t,"blockly-ws-search-container");const i=document.createElement("div");o.utils.dom.addClass(i,"blockly-ws-search-content"),t.appendChild(i);const n=document.createElement("div");o.utils.dom.addClass(n,"blockly-ws-search-input"),this.inputElement=this.createTextInput(),this.addEvent(this.inputElement,"keydown",this,(e=>this.onKeyDown(e))),this.addEvent(this.inputElement,"input",this,(()=>this.onInput())),this.addEvent(this.inputElement,"click",this,(()=>{var e;this.searchAndHighlight(this.searchText,this.preserveSelected),null===(e=this.inputElement)||void 0===e||e.select()})),n.appendChild(this.inputElement),i.appendChild(n),this.actionDiv=document.createElement("div"),o.utils.dom.addClass(this.actionDiv,"blockly-ws-search-actions"),i.appendChild(this.actionDiv);const s=this.createNextBtn();s&&this.addActionBtn(s,(()=>this.next()));const r=this.createPreviousBtn();r&&this.addActionBtn(r,(()=>this.previous()));const a=this.createCloseBtn();a&&(this.addBtnListener(a,(()=>this.close())),t.appendChild(a)),this.htmlDiv.appendChild(t),e.insertBefore(this.htmlDiv,this.workspace.getParentSvg())}addEvent(e,t,i,n){const s=o.browserEvents.conditionalBind(e,t,i,n);this.boundEvents.push(s)}addActionBtn(e,t){var i;this.addBtnListener(e,t),null===(i=this.actionDiv)||void 0===i||i.appendChild(e)}createTextInput(){const e=document.createElement("input");return e.type="text",e.setAttribute("placeholder",this.textInputPlaceholder),e}createNextBtn(){return this.createBtn("blockly-ws-search-next-btn","Find next")}createPreviousBtn(){return this.createBtn("blockly-ws-search-previous-btn","Find previous")}createCloseBtn(){return this.createBtn("blockly-ws-search-close-btn","Close search bar")}createBtn(e,t){const i=document.createElement("button");return o.utils.dom.addClass(i,e),i.setAttribute("aria-label",t),i}addBtnListener(e,t){this.addEvent(e,"click",this,t),this.addEvent(e,"keydown",this,(e=>{"Enter"===e.key?(t(e),e.preventDefault()):"Escape"===e.key&&this.close(),e.stopPropagation()}))}getBoundingRectangle(){return null}position(e,t){this.htmlDiv&&(this.workspace.RTL?this.htmlDiv.style.left=e.absoluteMetrics.left+"px":e.toolboxMetrics.position===o.TOOLBOX_AT_RIGHT?this.htmlDiv.style.right=e.toolboxMetrics.width+"px":this.htmlDiv.style.right="0",this.htmlDiv.style.top=e.absoluteMetrics.top+"px")}onInput(){if(this.searchOnInput&&this.inputElement){const e=this.inputElement.value.trim();e!==this.searchText&&this.searchAndHighlight(e,this.preserveSelected)}}onKeyDown(e){if("Escape"===e.key)this.close();else if("Enter"===e.key)if(this.searchOnInput)e.shiftKey?this.previous():this.next();else{if(!this.inputElement)return;const e=this.inputElement.value.trim();e!==this.searchText&&this.searchAndHighlight(e,this.preserveSelected)}}onWorkspaceKeyDown(e){(e.ctrlKey||e.metaKey)&&"f"===e.key&&(this.open(),e.preventDefault(),e.stopPropagation())}previous(){this.setCurrentBlock(this.currentBlockIndex-1)}next(){this.setCurrentBlock(this.currentBlockIndex+1)}setSearchPlaceholder(e){this.textInputPlaceholder=e,this.inputElement&&this.inputElement.setAttribute("placeholder",this.textInputPlaceholder)}setCurrentBlock(e){if(!this.blocks.length)return;let t=this.blocks[this.currentBlockIndex];t&&this.unhighlightCurrentSelection(t),this.currentBlockIndex=(e%this.blocks.length+this.blocks.length)%this.blocks.length,t=this.blocks[this.currentBlockIndex],this.highlightCurrentSelection(t),this.workspace.centerOnBlock(t.id,!1)}open(){var e,t;this.setVisible(!0),null===(e=this.inputElement)||void 0===e||e.focus(),null===(t=this.inputElement)||void 0===t||t.select(),this.searchText&&this.searchAndHighlight(this.searchText)}close(){this.setVisible(!1),this.workspace.markFocused(),this.clearBlocks()}setVisible(e){this.htmlDiv&&(this.htmlDiv.style.display=e?"flex":"none")}searchAndHighlight(e,t){const i=this.blocks[this.currentBlockIndex];this.searchText=e.trim(),this.clearBlocks(),this.blocks=this.getMatchingBlocks(this.workspace,this.searchText,this.caseSensitive),this.highlightSearchGroup(this.blocks);let n=0;t&&(n=this.blocks.indexOf(i),n=n>-1?n:0),this.setCurrentBlock(n)}getSearchPool(e){return e.getAllBlocks(!0).filter((e=>{const t=e.getSurroundParent();return!t||!t.isCollapsed()}))}isBlockMatch(e,t,i){let n="";if(e.isCollapsed())n=e.toString();else{const t=[];e.inputList.forEach((e=>{e.fieldRow.forEach((e=>{t.push(e.getText())}))})),n=t.join(" ").trim()}return i||(n=n.toLowerCase()),n.indexOf(t)>-1}getMatchingBlocks(e,t,i){return t?(this.caseSensitive||(t=t.toLowerCase()),this.getSearchPool(e).filter((e=>this.isBlockMatch(e,t,i)))):[]}clearBlocks(){this.unhighlightSearchGroup(this.blocks);const e=this.blocks[this.currentBlockIndex];e&&this.unhighlightCurrentSelection(e),this.currentBlockIndex=-1,this.blocks=[]}highlightCurrentSelection(e){const t=e.pathObject.svgPath;o.utils.dom.addClass(t,"blockly-ws-search-current")}unhighlightCurrentSelection(e){const t=e.pathObject.svgPath;o.utils.dom.removeClass(t,"blockly-ws-search-current")}highlightSearchGroup(e){e.forEach((e=>{const t=e.pathObject.svgPath;o.utils.dom.addClass(t,"blockly-ws-search-highlight")}))}unhighlightSearchGroup(e){e.forEach((e=>{const t=e.pathObject.svgPath;o.utils.dom.removeClass(t,"blockly-ws-search-highlight")}))}}return s})()))},{"blockly/core":204}],201:[function(e,t,i){(function(e){(function(){var n,s;n=this,s=function(){var t,i,n,s,o,r,a,l,c,u,h,d,p,g,m,f,_,T,E,b,I,y,v,C,k,O,N,A,S,R,w,L,x,$,D,M,P,B,F,U,H,G,V,j,W,X,Y,z,K,q,J,Z,Q,ee,te,ie,ne,se,oe,re,ae,le,ce,ue,he,de,pe,ge,me,fe,_e,Te,Ee,be,Ie,ye,ve,Ce,ke,Oe,Ne,Ae,Se,Re,we,Le,xe,$e,De,Me,Pe,Be,Fe,Ue,He,Ge,Ve,je,We,Xe,Ye,ze,Ke,qe,Je,Ze,Qe,et,tt,it,nt,st,ot,rt,at,lt,ct,ut,ht,dt,pt,gt,mt,ft,_t,Tt,Et,bt,It,yt,vt,Ct,kt,Ot,Nt,At,St,Rt,wt,Lt,xt,$t,Dt,Mt,Pt,Bt,Ft,Ut,Ht,Gt,Vt,jt,Wt,Xt,Yt,zt,Kt,qt,Jt,Zt,Qt,ei,ti,ii,ni,si,oi,ri,ai,li,ci,ui,hi,di,pi,gi,mi,fi,_i,Ti,Ei,bi,Ii,yi,vi,Ci,ki,Oi,Ni,Ai,Si,Ri,wi,Li,xi,$i,Di,Mi,Pi,Bi,Fi,Ui,Hi,Gi,Vi,ji,Wi,Xi,Yi,zi,Ki,qi,Ji,Zi,Qi,en,tn,nn,sn,on,rn,an,ln,cn,un,hn,dn,pn,gn,mn,fn,_n,Tn,En,bn,In,yn,vn,Cn,kn,On,Nn,An,Sn,Rn,wn,Ln,xn,$n,Dn,Mn,Pn,Bn,Fn,Un,Hn,Gn,Vn,jn,Wn,Xn,Yn,zn,Kn,qn,Jn,Zn,Qn,es,ts,is,ns,ss,os,rs,as,ls,cs,us,hs,ds,ps,gs,ms,fs,_s,Ts,Es,bs,Is,ys,vs,Cs,ks,Os,Ns,As,Ss,Rs,ws,Ls,xs,$s,Ds,Ms,Ps,Bs,Fs,Us,Hs,Gs,Vs,js,Ws,Xs,Ys,zs,Ks,qs,Js,Zs,Qs,eo,to,io,no,so,oo,ro,ao,lo,co,uo,ho,po,go,mo,fo,_o,To,Eo,bo,Io,yo,vo,Co,ko,Oo,No,Ao,So,Ro,wo,Lo,xo,$o,Do,Mo,Po,Bo,Fo,Uo,Ho,Go,Vo,jo,Wo,Xo,Yo,zo,Ko,qo,Jo,Zo,Qo,er,tr,ir,nr,sr,or,rr,ar,lr,cr,ur,hr,dr,pr,gr,mr,fr,_r,Tr,Er,br,Ir,yr,vr,Cr,kr,Or,Nr,Ar,Sr,Rr,wr,Lr,xr,$r,Dr,Mr,Pr,Br,Fr,Ur,Hr={};t=function(e,t,n,s){if(!(e instanceof Xr)&&"string"!=typeof e||""===`${e}`.trim())throw Error('Invalid type "'+e+'". The type must be a non-empty string or a Blockly.registry.Type.');if(e=`${e}`.toLowerCase(),"string"!=typeof t||""===t.trim())throw Error('Invalid name "'+t+'". The name must be a non-empty string.');const o=t.toLowerCase();if(!n)throw Error("Can not register a null value");let r=Gr[e],a=jr[e];if(r||(r=Gr[e]=Object.create(null),a=jr[e]=Object.create(null)),i(e,n),!s&&r[o]&&r[o]!==n)throw Error('Name "'+o+'" with type "'+e+'" already registered.');r[o]=n,a[o]=t},i=function(e,t){switch(e){case String(Xr.FIELD):if("function"!=typeof t.fromJson)throw Error('Type "'+e+'" must have a fromJson function')}},n=function(e,t){e=`${e}`.toLowerCase(),t=t.toLowerCase();const i=Gr[e];i&&i[t]?(delete Gr[e][t],delete jr[e][t]):console.warn("Unable to unregister ["+t+"]["+e+"] from the registry.")},s=function(e,t,i){e=`${e}`.toLowerCase(),t=t.toLowerCase();const n=Gr[e];if(!n||!n[t]){if(t="Unable to find ["+t+"]["+e+"] in the registry.",i)throw Error(t+" You must require or register a "+e+" plugin.");return console.warn(t),null}return n[t]},o=function(e,t){return e=`${e}`.toLowerCase(),t=t.toLowerCase(),!!(e=Gr[e])&&!!e[t]},r=function(e,t,i){return s(e,t,i)},a=function(e,t,i){return s(e,t,i)},l=function(e,t,i){e=`${e}`.toLowerCase();var n=Gr[e];if(!n){if(n=`Unable to find [${e}] in the registry.`,i)throw Error(`${n} You must require or register a ${e} plugin.`);return console.warn(n),null}if(!t)return n;e=jr[e],i=Object.create(null);for(const t of Object.keys(n))i[e[t]]=n[t];return i},c=function(e,t,i){return"function"==typeof(t=t.plugins[String(e)]||Wr)?t:r(e,t,i)},u=function(){return"blockly-"+(ga++).toString(36)},h=function(){return pa.genUid()},Hr.setRecordUndo$$module$build$src$core$events$utils=function(e){Kr=e},d=function(){return Kr},p=function(e){ua.fireInternal(e)},g=function(e){if(T()){if(!ca.length)try{requestAnimationFrame((()=>{setTimeout(m,0)}))}catch(e){setTimeout(m,0)}ca.push(e)}},m=function(){var e=f(ca,!0);ca.length=0;for(let i,n=0;i=e[n];n++)if(i.workspaceId){var t=C(i.workspaceId);t&&t.fireChangeListener(i)}e=new Set(e.map((e=>e.workspaceId)));for(const i of e){if(!i)continue;if(!(e=C(i)))continue;let n;for(t=(e=e.getUndoStack()).length;0<t;t--){const i=e[t-1];if(""===i.group)break;if(void 0===n)n=i.group;else if(i.group!==n)break}n&&t!=e.length-1&&(t=e.splice(t,e.length-t),t=f(t,!0),e.push(...t))}},f=function(e,t){e=e.slice(),t||e.reverse();const i=[],n=Object.create(null);for(let t,r=0;t=e[r];r++)if(!t.isNull()){var s=[t.isUiEvent?Qr:t.type,t.blockId,t.workspaceId].join(" "),o=n[s];const e=o?o.event:null;o?t.type===Hr.MOVE$$module$build$src$core$events$utils&&o.index===r-1?(s=t,e.newParentId=s.newParentId,e.newInputName=s.newInputName,e.newCoordinate=s.newCoordinate,s.reason&&(e.reason?(s=new Set(s.reason.concat(e.reason)),e.reason=Array.from(s)):e.reason=s.reason),o.index=r):t.type===Hr.CHANGE$$module$build$src$core$events$utils&&t.element===e.element&&t.name===e.name?e.newValue=t.newValue:t.type===na?(o=t,e.viewTop=o.viewTop,e.viewLeft=o.viewLeft,e.scale=o.scale,e.oldScale=o.oldScale):t.type===ta&&e.type===ia||(n[s]={event:t,index:r},i.push(t)):(n[s]={event:t,index:r},i.push(t))}e=i.filter((function(e){return!e.isNull()})),t||e.reverse();for(let t,i=1;t=e[i];i++)t.type===Hr.CHANGE$$module$build$src$core$events$utils&&"mutation"===t.element&&e.unshift(e.splice(i,1)[0]);return e},_=function(){for(let e,t=0;e=ca[t];t++)e.recordUndo=!1},Hr.disable$$module$build$src$core$events$utils=function(){qr++},Hr.enable$$module$build$src$core$events$utils=function(){qr--},T=function(){return 0===qr},Hr.getGroup$$module$build$src$core$events$utils=function(){return zr},Hr.setGroup$$module$build$src$core$events$utils=function(e){ua.setGroupInternal(e)},E=function(e){zr="boolean"==typeof e?e?h():"":e},b=function(e){const t=[];e=e.getDescendants(!1);for(let i,n=0;i=e[n];n++)t[n]=i.id;return t},I=function(e,t){const i=y(e.type);if(!i)throw Error("Unknown event type.");return i.fromJson(e,t)},y=function(e){const t=r(Xr.EVENT,e);if(!t)throw Error(`Event type ${e} not found in registry.`);return t},v=function(e){if((e.type===Hr.MOVE$$module$build$src$core$events$utils||e.type===Hr.CREATE$$module$build$src$core$events$utils)&&e.workspaceId){var t=C(e.workspaceId);if(!e.blockId)throw Error("Encountered a blockEvent without a proper blockId");if(e=t.getBlockById(e.blockId)){const i=Kr;try{Kr=!1;const n=e.getParent();if(n&&!n.hasDisabledReason(aa)){const t=e.getDescendants(!1);for(let e,i=0;e=t[i];i++)e.setDisabledReason(!1,aa)}else if((e.outputConnection||e.previousConnection)&&!t.isDragging())do{e.setDisabledReason(!0,aa),e=e.getNextBlock()}while(e)}finally{Kr=i}}}},C=function(e){return Ta[e]||null},k=function(){const e=[];for(const t in Ta)e.push(Ta[t]);return e},O=function(e){Ta[e.id]=e},N=function(e){delete Ta[e.id]},A=function(){return fa},S=function(e){fa=e},R=function(){return Ea},Hr.setSelected$$module$build$src$core$common=function(e){if(Ea!==e){var t,i,n,s,o,r,a,l,c=new(y(ea))(null!=(n=null==(t=Ea)?void 0:t.id)?n:null,null!=(s=null==e?void 0:e.id)?s:null,null!=(r=null!=(o=null==e?void 0:e.workspace.id)?o:null==(i=Ea)?void 0:i.workspace.id)?r:"");p(c),null==(a=Ea)||a.unselect(),null==(l=Ea=e)||l.select()}},w=function(){return _a},L=function(e){_a=e},x=function(e){for(;e.options.parentWorkspace;)e=e.options.parentWorkspace;const t=e.getParentSvg(),i=e.getCachedParentSvgSize();var n=t.parentElement;if(n instanceof HTMLElement){var s=n.offsetWidth;n=n.offsetHeight,i.width!==s&&(t.setAttribute("width",s+"px"),e.setCachedParentSvgSize(s,null)),i.height!==n&&(t.setAttribute("height",n+"px"),e.setCachedParentSvgSize(null,n)),e.resize()}},$=function(e,t){const i=Object.create(null),n=e.getDescendants(!0);t&&(e=e.getNextBlock())&&(e=n.indexOf(e),n.splice(e,n.length-e));for(let e,t=0;e=n[t];t++)i[e.type]?i[e.type]++:i[e.type]=1;return i},D=function(e){return function(){this.jsonInit(e)}},M=function(e){Ia.defineBlocksWithJsonArrayInternal(e)},P=function(e){Hr.defineBlocks$$module$build$src$core$common(Hr.createBlockDefinitionsFromJsonArray$$module$build$src$core$common(e))},Hr.createBlockDefinitionsFromJsonArray$$module$build$src$core$common=function(e){const t={};for(let i=0;i<e.length;i++){const n=e[i];if(!n){console.warn(`Block definition #${i} in JSON array is ${n}. Skipping`);continue}const s=n.type;s?t[s]={init:D(n)}:console.warn(`Block definition #${i} in JSON array is missing a type attribute. Skipping.`)}return t},Hr.defineBlocks$$module$build$src$core$common=function(e){for(const t of Object.keys(e)){const i=e[t];t in da&&console.warn(`Block definition "${t}" overwrites previous definition.`),da[t]=i}},B=function(e,t){F(),Va=setTimeout((function(){t&&t.handleRightClick(e)}),Fa)},F=function(){Va&&(clearTimeout(Va),Va=0)},U=function(){Ha=null},H=function(e){return!e.type.startsWith("pointer")||e instanceof PointerEvent&&V(e)},G=function(e){return`${e.pointerId}`},V=function(e){const t=G(e);return Ha?Ha===t:"pointerdown"===e.type&&(Ha=t,!0)},j=function(e,t,i,n,s){function o(e){(s||H(e))&&(i?n.call(i,e):n(e))}const r=[];if(t in Ga)for(let i=0;i<Ga[t].length;i++){const n=Ga[t][i];e.addEventListener(n,o,!1),r.push([e,n,o])}else e.addEventListener(t,o,!1),r.push([e,t,o]);return r},W=function(e,t,i,n){function s(e){i?n.call(i,e):n(e)}const o=[];if(t in Ga)for(let i=0;i<Ga[t].length;i++){const n=Ga[t][i];e.addEventListener(n,s,!1),o.push([e,n,s])}else e.addEventListener(t,s,!1),o.push([e,t,s]);return o},X=function(e){const t=e[e.length-1][2];for(;e.length;){const[t,i,n]=e.pop();t.removeEventListener(i,n,!1)}return t},Y=function(e){if(e.target instanceof HTMLElement){if(e.target.isContentEditable||"true"===e.target.getAttribute("data-is-text-input"))return!0;if(e.target instanceof HTMLInputElement)return"text"===(e=e.target).type||"number"===e.type||"email"===e.type||"password"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type;if(e.target instanceof HTMLTextAreaElement)return!0}return!1},z=function(e){return!(!e.ctrlKey||!qa)||2===e.button},K=function(e,t,i){const n=t.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,i||(i=t.getScreenCTM().inverse()),n.matrixTransform(i)},q=function(e){switch(e.deltaMode){default:return{x:e.deltaX,y:e.deltaY};case 1:return{x:e.deltaX*Qa,y:e.deltaY*Qa};case 2:return{x:e.deltaX*el,y:e.deltaY*el}}},J=function(e,t){return-1!==(t=e.indexOf(t))&&(e.splice(t,1),!0)},Z=function(e){if(ol)throw Error("CSS already injected");rl+="\n"+e},Q=function(e,t){ol||(ol=!0,e&&(e=t.replace(/[\\/]$/,""),t=rl.replace(/<<<PATH>>>/g,e),rl="",(e=document.createElement("style")).id="blockly-common-style",t=document.createTextNode(t),e.appendChild(t),document.head.insertBefore(e,document.head.firstChild)))},ee=function(e,t,i){e=document.createElementNS(ul,`${e}`);for(const i in t)e.setAttribute(i,`${t[i]}`);return i&&i.appendChild(e),e},te=function(e,t){return!(t=t.split(" ")).every((t=>e.classList.contains(t)))&&(e.classList.add(...t),!0)},ie=function(e,t){e.classList.remove(...t.split(" "))},ne=function(e,t){return!(t=t.split(" ")).every((t=>!e.classList.contains(t)))&&(e.classList.remove(...t),!0)},se=function(e,t){return e.classList.contains(t)},oe=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null},re=function(e,t){const i=t.nextSibling;if(!(t=t.parentNode))throw Error("Reference node has no parent.");i?t.insertBefore(e,i):t.appendChild(e)},ae=function(e,t){e.style.transform=t,e.style["-webkit-transform"]=t},le=function(){gl++,pl||(pl=Object.create(null))},ce=function(){--gl||(pl=null)},ue=function(e){const t=e.textContent+"\n"+e.className.baseVal;let i;if(pl&&(i=pl[t]))return i;try{i=e.getComputedTextLength()}catch(t){return 8*e.textContent.length}return pl&&(pl[t]=i),i},he=function(e,t,i,n){return de(e,t+"pt",i,n)},de=function(e,t,i,n){const s=e.textContent;var o;return e=s+"\n"+e.className.baseVal,pl&&(o=pl[e])||(ml||((o=document.createElement("canvas")).className="blocklyComputeCanvas",document.body.appendChild(o),ml=o.getContext("2d")),ml.font=i+" "+t+" "+n,o=s?ml.measureText(s).width:0,pl&&(pl[e]=o)),o},pe=function(e,t,i,n){const s=document.createElement("span");s.style.font=i+" "+t+" "+n,s.textContent=e,(e=document.createElement("div")).style.width="1px",e.style.height="0",(t=document.createElement("div")).style.display="flex",t.style.position="fixed",t.style.top="0",t.style.left="0",t.appendChild(s),t.appendChild(e),document.body.appendChild(t),i={height:0,baseline:0};try{t.style.alignItems="baseline",i.baseline=e.offsetTop-s.offsetTop,t.style.alignItems="flex-end",i.height=e.offsetTop-s.offsetTop}finally{document.body.removeChild(t)}return i},ge=function(e){return bl.getSizeInternal(e)},me=function(e){if("none"!==_e(e,"display"))return fe(e);const t=e.style,i=t.display,n=t.visibility,s=t.position;t.visibility="hidden",t.position="absolute",t.display="inline";const o=e.offsetWidth;return e=e.offsetHeight,t.display=i,t.position=s,t.visibility=n,new El(o,e)},fe=function(e){return new El(e.offsetWidth,e.offsetHeight)},_e=function(e,t){return(e=window.getComputedStyle(e))[t]||e.getPropertyValue(t)},Te=function(e){const t=new cl(0,0);e=e.getBoundingClientRect();var i=document.documentElement;return i=new cl(window.pageXOffset||i.scrollLeft,window.pageYOffset||i.scrollTop),t.x=e.left+i.x,t.y=e.top+i.y,t},Ee=function(){const e=document.body,t=document.documentElement;return new cl(e.scrollLeft||t.scrollLeft,e.scrollTop||t.scrollTop)},be=function(e){const t=parseFloat(_e(e,"borderLeftWidth")),i=parseFloat(_e(e,"borderRightWidth")),n=parseFloat(_e(e,"borderTopWidth"));return e=parseFloat(_e(e,"borderBottomWidth")),new Tl(n,e,t,i)},Ie=function(e,t,i){e=ye(e,t,i),t.scrollLeft=e.x,t.scrollTop=e.y},ye=function(e,t,i){var n=Te(e),s=Te(t),o=be(t);const r=n.x-s.x-o.left;return n=n.y-s.y-o.top,s=fe(e),e=t.clientWidth-s.width,s=t.clientHeight-s.height,o=t.scrollLeft,t=t.scrollTop,i?(o+=r-e/2,t+=n-s/2):(o+=Math.min(r,Math.max(r-e,0)),t+=Math.min(n,Math.max(n-s,0))),new cl(o,t)},ve=function(e){const t=new cl(0,0);var i=e.x&&e.getAttribute("x");const n=e.y&&e.getAttribute("y");return i&&(t.x=parseInt(i)),n&&(t.y=parseInt(n)),(i=(i=e.getAttribute("transform"))&&i.match(yl))&&(t.x+=Number(i[1]),i[3]&&(t.y+=Number(i[3]))),(e=e.getAttribute("style"))&&e.includes("translate")&&(e=e.match(vl))&&(t.x+=Number(e[1]),e[3]&&(t.y+=Number(e[3]))),t},Ce=function(e){let t=0,i=0;for(;e;){const n=ve(e);if(t+=n.x,i+=n.y,(" "+(e.getAttribute("class")||"")+" ").includes(" injectionDiv "))break;e=e.parentNode}return new cl(t,i)},ke=function(){const e=Ee();return new Tl(e.y,document.documentElement.clientHeight+e.y,e.x,document.documentElement.clientWidth+e.x)},Oe=function(){const e=document.documentElement,t=window;return new cl(t.pageXOffset||e.scrollLeft,t.pageYOffset||e.scrollTop)},Ne=function(e,t){var i=t.x;t=t.y;const n=e.getInjectionDiv().getBoundingClientRect();return i=new cl(i-n.left,t-n.top),t=e.getOriginOffsetInPixels(),cl.difference(i,t).scale(1/e.scale)},Ae=function(e,t){var i=t.scale(e.scale);t=i.x,i=i.y;const n=e.getInjectionDiv().getBoundingClientRect();return e=e.getOriginOffsetInPixels(),new cl(t+n.left+e.x,i+n.top+e.y)},Se=function(e){({document:Al=Al,DOMParser:Sl=Sl,XMLSerializer:Rl=Rl}=e),Ol=new Sl,Nl=new Rl},Hr.createElement$$module$build$src$core$utils$xml=function(e){return Al.createElementNS(wl,e)},Hr.createTextNode$$module$build$src$core$utils$xml=function(e){return Al.createTextNode(e)},Hr.textToDom$$module$build$src$core$utils$xml=function(e){let t=Ol.parseFromString(e,"text/xml");if(t&&t.documentElement&&!t.getElementsByTagName("parsererror").length)return t.documentElement;if((t=Ol.parseFromString(e,"text/html"))&&t.body.firstChild&&"xml"===t.body.firstChild.nodeName.toLowerCase())return t.body.firstChild;throw Error(`DOMParser was unable to parse: ${e}`)},Re=function(e){return we(Nl.serializeToString(e))},we=function(e){return e.replace(Ll,(e=>`&#${e.charCodeAt(0)};`))},Le=function(e){return e?((e instanceof Element||"string"==typeof e)&&(e=He(e),e=Be(e)),xe(e),e):null},xe=function(e){const t=e.kind;if(e=e.contents,t&&t!==Ml&&t!==Dl)throw Error("Invalid toolbox kind "+t+". Please supply either "+Ml+" or "+Dl);if(!e)throw Error("Toolbox must have a contents attribute.")},$e=function(e){return e?e.contents?e.contents:Array.isArray(e)&&0<e.length&&!e[0].nodeType?e:Fe(e):[]},De=function(e){return Ul.hasCategoriesInternal(e)},Me=function(e){if(!e)return!1;const t=e.kind;return t?t===Dl:!!e.contents.filter((function(e){return"CATEGORY"===e.kind.toUpperCase()})).length},Pe=function(e){return!(!e||!e.contents||!e.contents.filter((function(e){return"CATEGORY"===e.kind.toUpperCase()})).length)},Be=function(e){const t={contents:Fe(e)};return e instanceof Node&&Ue(e,t),t},Fe=function(e){const t=[];let i=e.childNodes;i||(i=e);for(let n,s=0;n=i[s];s++){if(!n.tagName)continue;e={};const i=n.tagName.toUpperCase();e.kind=i,"BLOCK"===i?e.blockxml=n:n.childNodes&&0<n.childNodes.length&&(e.contents=Fe(n)),Ue(n,e),t.push(e)}return t},Ue=function(e,t){for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i];n.nodeName.includes("css-")?(t.cssconfig=t.cssconfig||{},t.cssconfig[n.nodeName.replace("css-","")]=n.value):t[n.nodeName]=n.value}},He=function(e){let t=null;if(e)if("string"==typeof e){if("xml"!==(t=Hr.textToDom$$module$build$src$core$utils$xml(e)).nodeName.toLowerCase())throw TypeError("Toolbox should be an <xml> document.")}else e instanceof Element&&(t=e);return t},Ge=function(e,t,i,n,s,o){const r=o.scrollbar&&o.scrollbar.canScrollVertically();return e.horizontal===Bl.LEFT?(i=s.absoluteMetrics.left+i,r&&o.RTL&&(i+=kl.scrollbarThickness)):(i=s.absoluteMetrics.left+s.viewMetrics.width-t.width-i,r&&!o.RTL&&(i-=kl.scrollbarThickness)),e.vertical===Pl.TOP?e=s.absoluteMetrics.top+n:(e=s.absoluteMetrics.top+s.viewMetrics.height-t.height-n,o.scrollbar&&o.scrollbar.canScrollHorizontally()&&(e-=kl.scrollbarThickness)),new Tl(e,e+t.height,i,i+t.width)},Ve=function(e,t){return{horizontal:t.toolboxMetrics.position===$l.LEFT||e.horizontalLayout&&!e.RTL?Bl.RIGHT:Bl.LEFT,vertical:t.toolboxMetrics.position===$l.BOTTOM?Pl.TOP:Pl.BOTTOM}},je=function(e,t,i,n){const s=e.left,o=e.right-e.left,r=e.bottom-e.top;for(let a=0;a<n.length;a++){const l=n[a];e.intersects(l)&&(e=i===Fl.UP?l.top-r-t:l.bottom+t,e=new Tl(e,e+r,s,s+o),a=-1)}return e},We=function(e,t){Zl(e,t)},Xe=function(e){Zl=e},Ye=function(e,t){tc.confirmInternal(e,t)},ze=function(e,t){Ql(e,t)},Ke=function(e){Ql=e},qe=function(e,t,i){ec(e,t,i)},Je=function(e){ec=e},Ze=function(e){return void 0!==e.getVariableModel},Qe=function(e){return void 0!==e.getProcedureDef},et=function(e){return void 0!==e.getProcedureCall&&void 0!==e.renameProcedure},Hr.allUsedVarModels$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const t=new Set;for(let i=0;i<e.length;i++){const n=e[i].getVarModels();if(n)for(let e=0;e<n.length;e++){const i=n[e];i.getId()&&t.add(i)}}return Array.from(t.values())},Hr.allDeveloperVariables$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const t=new Set;for(let n,s=0;n=e[s];s++){var i=n.getDeveloperVariables;if(i){i=i();for(let e=0;e<i.length;e++)t.add(i[e])}}return Array.from(t.values())},tt=function(e){let t=[];const i=document.createElement("button");return i.setAttribute("text","%{BKY_NEW_VARIABLE}"),i.setAttribute("callbackKey","CREATE_VARIABLE"),e.registerButtonCallback("CREATE_VARIABLE",(function(e){rt(e.getTargetWorkspace())})),t.push(i),e=it(e),t.concat(e)},it=function(e){const t=[];if(0<(e=e.getVariablesOfType("")).length){var i=e[e.length-1];if(da.variables_set){var n=Hr.createElement$$module$build$src$core$utils$xml("block");n.setAttribute("type","variables_set"),n.setAttribute("gap",da.math_change?"8":"24"),n.appendChild(pt(i)),t.push(n)}if(da.math_change&&((n=Hr.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","math_change"),n.setAttribute("gap",da.variables_get?"20":"8"),n.appendChild(pt(i)),i=Hr.textToDom$$module$build$src$core$utils$xml('<value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow></value>'),n.appendChild(i),t.push(n)),da.variables_get){e.sort(rc.compareByName);for(let n,s=0;n=e[s];s++)(i=Hr.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_get"),i.setAttribute("gap","8"),i.appendChild(pt(n)),t.push(i)}}return t},nt=function(e){return lc.generateUniqueNameInternal(e)},st=function(e){return ot(ac.charAt(0),e.getAllVariableNames())},ot=function(e,t){if(!t.length)return e;const i=ac;let n="",s=i.indexOf(e);for(;;){let o=!1;for(let i=0;i<t.length;i++)if(t[i].toLowerCase()===e){o=!0;break}if(!o)break;++s===i.length&&(s=0,n=`${Number(n)+1}`),e=i.charAt(s)+n}return e},rt=function(e,t,i){const n=i||"";!function i(s){at(Hr.Msg$$module$build$src$core$msg.NEW_VARIABLE_TITLE,s,(function(s){if(s){var o=ct(s,e);if(o){if(o.type===n)var r=Hr.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS.replace("%1",o.name);else r=(r=Hr.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE).replace("%1",o.name).replace("%2",o.type);We(r,(function(){i(s)}))}else e.createVariable(s,n),t&&t(s)}else t&&t(null)}))}("")},Hr.renameVariable$$module$build$src$core$variables=function(e,t,i){!function n(s){const o=Hr.Msg$$module$build$src$core$msg.RENAME_VARIABLE_TITLE.replace("%1",t.name);at(o,s,(function(s){if(s){var o=lt(s,t.type,e),r=ut(t.name,s,e);if(o||r){var a="";o?a=Hr.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace("%1",o.name).replace("%2",o.type):r&&(a=Hr.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER.replace("%1",s).replace("%2",r)),We(a,(function(){n(s)}))}else e.renameVariableById(t.getId(),s),i&&i(s)}else i&&i(null)}))}("")},at=function(e,t,i){qe(e,t,(function(e){e&&((e=e.replace(/[\s\xa0]+/g," ").trim())===Hr.Msg$$module$build$src$core$msg.RENAME_VARIABLE||e===Hr.Msg$$module$build$src$core$msg.NEW_VARIABLE)&&(e=null),i(e)}))},lt=function(e,t,i){i=i.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let n,s=0;n=i[s];s++)if(n.name.toLowerCase()===e&&n.type!==t)return n;return null},ct=function(e,t){t=t.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let i,n=0;i=t[n];n++)if(i.name.toLowerCase()===e)return i;return null},ut=function(e,t,i){return i.getProcedureMap().getProcedures().length?ht(e,t,i):dt(e,t,i)},ht=function(e,t,i){e=e.toLowerCase(),t=t.toLowerCase(),i=i.getProcedureMap().getProcedures();for(const s of i){var n=s.getParameters().filter(Ze).map((e=>e.getVariableModel().name));if(n&&(i=n.some((t=>t.toLowerCase()===e)),n=n.some((e=>e.toLowerCase()===t)),i&&n))return s.getName()}return null},dt=function(e,t,i){e=e.toLowerCase(),t=t.toLowerCase(),i=i.getAllBlocks(!1);for(const s of i){if(!Qe(s))continue;var n=(i=s.getProcedureDef())[1];const o=n.some((t=>t.toLowerCase()===e));if(n=n.some((e=>e.toLowerCase()===t)),o&&n)return i[0]}return null},pt=function(e){const t=Hr.createElement$$module$build$src$core$utils$xml("field");return t.setAttribute("name","VAR"),t.setAttribute("id",e.getId()),t.setAttribute("variabletype",e.type),e=Hr.createTextNode$$module$build$src$core$utils$xml(e.name),t.appendChild(e),t},Hr.getOrCreateVariablePackage$$module$build$src$core$variables=function(e,t,i,n){let s=Hr.getVariable$$module$build$src$core$variables(e,t,i,n);return s||(s=gt(e,t,i,n)),s},Hr.getVariable$$module$build$src$core$variables=function(e,t,i,n){const s=e.getPotentialVariableMap();let o=null;if(t&&(!(o=e.getVariableById(t))&&s&&(o=s.getVariableById(t)),o))return o;if(i){if(void 0===n)throw Error("Tried to look up a variable by name without a type");!(o=e.getVariable(i,n))&&s&&(o=s.getVariable(i,n))}return o},gt=function(e,t,i,n){const s=e.getPotentialVariableMap();return i||(i=nt(e.isFlyout?e.targetWorkspace:e)),s?s.createVariable(i,n,t):e.createVariable(i,n,t)},mt=function(e,t){e=e.getAllVariables();const i=[];if(t.length!==e.length)for(let n=0;n<e.length;n++){const s=e[n];t.includes(s)||i.push(s)}return i},ft=function(e){return bt(e),Et()?(It(),Promise.resolve()):(pc||(pc=new Promise((e=>{gc=e,mc=window.requestAnimationFrame((()=>{It(),e()}))}))),pc)},_t=function(){return pc||Promise.resolve()},Tt=function(e){e||window.cancelAnimationFrame(mc),It(e),!e&&gc&&gc()},Et=function(){return Wa},bt=function(e){hc.add(e),dc.set(e,Hr.getGroup$$module$build$src$core$events$utils());const t=e.getParent();t?bt(t):uc.add(e)},It=function(e){const t=e?new Set([e]):new Set([...uc].map((e=>e.workspace))),i=[...uc].filter(vt).filter((e=>t.has(e.workspace)));for(var n of i)Ct(n);for(const e of t)e.resizeContents();for(var s of i)n=s.getRelativeToSurfaceXY(),s.updateComponentLocations(n);for(const e of i)s=Hr.getGroup$$module$build$src$core$events$utils(),(n=dc.get(e))&&Hr.setGroup$$module$build$src$core$events$utils(n),e.bumpNeighbours(),Hr.setGroup$$module$build$src$core$events$utils(s);for(const e of i)yt(e);e||(pc=null)},yt=function(e){uc.delete(e),hc.delete(e),dc.delete(e);for(const t of e.getChildren(!1))yt(t)},vt=function(e){return!e.isDisposed()&&!e.getParent()},Ct=function(e){if(hc.has(e)&&e.initialized){for(const t of e.getChildren(!1))Ct(t);e.renderEfficiently()}},kt=function(e,i){t(Xr.SERIALIZER,e,i)},Ot=function(e){n(Xr.SERIALIZER,e)},Nt=function(e,{addCoordinates:t=!1,saveIds:i=!0}={}){const n=e.workspace,s=Object.create(null);return s.height=e.getSize().height,s.width=e.getSize().width,i&&(s.id=e.id),t&&(t=e.getRelativeToSurfaceXY(),s.x=n.RTL?n.getWidth()-t.x:t.x,s.y=t.y),e.getText()&&(s.text=e.getText()),e.isCollapsed()&&(s.collapsed=!0),e.isOwnEditable()||(s.editable=!1),e.isOwnMovable()||(s.movable=!1),e.isOwnDeletable()||(s.deletable=!1),s},At=function(e,t,{recordUndo:i=!1}={}){const n=d();if(Hr.setRecordUndo$$module$build$src$core$events$utils(i),i=t.newComment(e.id),void 0!==e.text&&i.setText(e.text),void 0!==e.x||void 0!==e.y){const n=i.getRelativeToSurfaceXY();let o,r=null!=(o=e.x)?o:n.x;var s;r=t.RTL?t.getWidth()-r:r,t=null!=(s=e.y)?s:n.y,i.moveTo(new cl(r,t))}if(void 0!==e.width||e.height){let t,n;s=i.getSize(),i.setSize(new El(null!=(t=e.width)?t:s.width,null!=(n=e.height)?n:s.height))}return void 0!==e.collapsed&&i.setCollapsed(e.collapsed),void 0!==e.editable&&i.setEditable(e.editable),void 0!==e.movable&&i.setMovable(e.movable),void 0!==e.deletable&&i.setDeletable(e.deletable),Hr.setRecordUndo$$module$build$src$core$events$utils(n),i},St=function(e,i){t(Xr.PASTER,e,i)},Rt=function(e){n(Xr.PASTER,e)},wt=function(e){const t=e.workspace,i=e.getRelativeToSurfaceXY(),n=new cl(0,0),s=t.getTopComments(!1).filter((t=>t.id!==e.id)).map((e=>e.getRelativeToSurfaceXY()));for(;Lt(cl.sum(i,n),s);)n.translate(t.RTL?-30:30,30);e.moveTo(cl.sum(i,n))},Lt=function(e,t){return t.some((t=>1>=Math.abs(t.x-e.x)&&1>=Math.abs(t.y-e.y)))},xt=function(e,t){e.setAttribute(Ac,t)},$t=function(e,t,i){Array.isArray(i)&&(i=i.join(" ")),e.setAttribute(Nc+t,`${i}`)},Dt=function(e){return void 0!==e.saveState&&void 0!==e.loadState},Mt=function(e,{addCoordinates:t=!1,addInputBlocks:i=!0,addNextBlocks:n=!0,doFullSerialization:s=!0,saveIds:o=!0}={}){if(e.isInsertionMarker())return null;const r={type:e.type,id:o?e.id:void 0};return t&&Bt(e,r),Pt(e,r),Ft(e,r,s),Ut(e,r,s),Ht(e,r,s),i&&Gt(e,r,s,o),n&&Vt(e,r,s,o),r},Pt=function(e,t){e.isCollapsed()&&(t.collapsed=!0),e.isEnabled()||(t.disabledReasons=Array.from(e.getDisabledReasons())),e.isOwnDeletable()||(t.deletable=!1),e.isOwnMovable()||(t.movable=!1),e.isOwnEditable()||(t.editable=!1),void 0!==e.inputsInline&&e.inputsInline!==e.inputsInlineDefault&&(t.inline=e.inputsInline),e.data&&(t.data=e.data)},Bt=function(e,t){const i=e.workspace;e=e.getRelativeToSurfaceXY(),t.x=Math.round(i.RTL?i.getWidth()-e.x:e.x),t.y=Math.round(e.y)},Ft=function(e,t,i){e.saveExtraState?null!==(e=e.saveExtraState(i))&&(t.extraState=e):e.mutationToDom&&null!==(e=e.mutationToDom())&&(t.extraState=Jn(e).replace(' xmlns="https://developers.google.com/blockly/xml"',""))},Ut=function(e,t,i){const n=Object.create(null);for(const t of e.getIcons())Dt(t)&&(e=t.saveState(i))&&(n[t.getType().toString()]=e);Object.keys(n).length&&(t.icons=n)},Ht=function(e,t,i){const n=Object.create(null);for(let t=0;t<e.inputList.length;t++){const s=e.inputList[t];for(let e=0;e<s.fieldRow.length;e++){const t=s.fieldRow[e];t.isSerializable()&&(n[t.name]=t.saveState(i))}}Object.keys(n).length&&(t.fields=n)},Gt=function(e,t,i,n){const s=Object.create(null);for(let t=0;t<e.inputList.length;t++){const o=e.inputList[t];if(!o.connection)continue;const r=jt(o.connection,i,n);r&&(s[o.name]=r)}Object.keys(s).length&&(t.inputs=s)},Vt=function(e,t,i,n){e.nextConnection&&(e=jt(e.nextConnection,i,n))&&(t.next=e)},jt=function(e,t,i){const n=e.getShadowState(!0);if(e=e.targetBlock(),!n&&!e)return null;const s=Object.create(null);return n&&(s.shadow=n),e&&!e.isShadow()&&(s.block=Mt(e,{doFullSerialization:t,saveIds:i})),s},Wt=function(e,t,{recordUndo:i=!1}={}){return e=Xt(e,t,{recordUndo:i}),t.rendered&&Tt(),e},Xt=function(e,t,{parentConnection:i,isShadow:n=!1,recordUndo:s=!1}={}){const o=d();Hr.setRecordUndo$$module$build$src$core$events$utils(s),(s=Hr.getGroup$$module$build$src$core$events$utils())||Hr.setGroup$$module$build$src$core$events$utils(!0),Hr.disable$$module$build$src$core$events$utils();const r=t.getAllVariables();let a;try{a=Yt(e,t,{parentConnection:i,isShadow:n})}finally{Hr.enable$$module$build$src$core$events$utils()}if(zt(t,r),T()&&p(new(y(Hr.CREATE$$module$build$src$core$events$utils))(a)),Hr.setGroup$$module$build$src$core$events$utils(s),Hr.setRecordUndo$$module$build$src$core$events$utils(o),t.rendered){const e=a;setTimeout((()=>{e.disposed||e.setConnectionTracking(!0)}),1)}return a},Yt=function(e,t,{parentConnection:i,isShadow:n=!1}={}){if(!e.type)throw new xc(e);const s=t.newBlock(e.type,e.id);return s.setShadow(n),Kt(s,e),qt(s,e),Jt(s,e),Zt(i,s,e),Qt(s,e),ei(s,e),ti(s,e),ii(s,e),si(s,t.rendered),s},zt=function(e,t){if(T())for(e=mt(e,t),t=0;t<e.length;t++){const i=e[t];p(new(y(Zr))(i))}},Kt=function(e,t){let i=void 0===t.x?0:t.x;t=void 0===t.y?0:t.y;const n=e.workspace;i=n.RTL?n.getWidth()-i:i,e.moveBy(i,t)},qt=function(e,t){if(t.collapsed&&e.setCollapsed(!0),!1===t.deletable&&e.setDeletable(!1),!1===t.movable&&e.setMovable(!1),!1===t.editable&&e.setEditable(!1),!1===t.enabled&&e.setDisabledReason(!0,Yl),Array.isArray(t.disabledReasons))for(const i of t.disabledReasons)e.setDisabledReason(!0,i);void 0!==t.inline&&e.setInputsInline(t.inline),void 0!==t.data&&(e.data=t.data)},Jt=function(e,t){t.extraState&&(e.loadExtraState?e.loadExtraState(t.extraState):e.domToMutation&&e.domToMutation(Hr.textToDom$$module$build$src$core$utils$xml(t.extraState)))},Zt=function(e,t,i){if(e){if(e.getSourceBlock().isShadow()&&!t.isShadow())throw new Mc(i);if(e.type===Hr.inputTypes$$module$build$src$core$inputs$input_types.VALUE){var n=t.outputConnection;if(!n)throw new $c("output",t,i)}else if(!(n=t.previousConnection))throw new $c("previous",t,i);if(!e.connect(n)){const s=t.workspace.connectionChecker;throw new Dc(s.getErrorMessage(s.canConnectWithReason(n,e,!1),n,e),e.type===Hr.inputTypes$$module$build$src$core$inputs$input_types.VALUE?"output connection":"previous connection",t,i)}}},Qt=function(e,t){if(t.icons){var i=Object.keys(t.icons);for(const s of i){i=t.icons[s];var n=e.getIcon(s);if(!n){if(!(n=r(Xr.ICON,s,!1)))throw new Pc(s,e,t);n=new n(e),e.addIcon(n)}Dt(n)&&n.loadState(i)}}},ei=function(e,t){if(t.fields){var i=Object.keys(t.fields);for(let n=0;n<i.length;n++){const s=i[n],o=t.fields[s],r=e.getField(s);r?r.loadState(o):console.warn(`Ignoring non-existant field ${s} in block ${e.type}`)}}},ti=function(e,t){if(t.inputs){var i=Object.keys(t.inputs);for(let n=0;n<i.length;n++){const s=i[n],o=e.getInput(s);if(!o||!o.connection)throw new $c(s,e,t);ni(o.connection,t.inputs[s])}}},ii=function(e,t){if(t.next){if(!e.nextConnection)throw new $c("next",e,t);ni(e.nextConnection,t.next)}},ni=function(e,t){t.shadow&&e.setShadowState(t.shadow),t.block&&Yt(t.block,e.getSourceBlock().workspace,{parentConnection:e})},si=function(e,t){if(t){e.setConnectionTracking(!1),e.initSvg(),e.queueRender();for(const t of e.getIcons())t.onLocationChange(e.getRelativeToSurfaceXY())}else e.initModel()},oi=function(e){return void 0!==e.bubbleIsVisible&&void 0!==e.setBubbleVisible},ri=function(e){return e*Math.PI/180},ai=function(e){return 180*e/Math.PI},li=function(e,t,i){if(i<e){const t=i;i=e,e=t}return Math.max(e,Math.min(t,i))},ci=function(){document.querySelector(".blocklyDropDownDiv")||((jc=document.createElement("div")).className="blocklyDropDownDiv",(w()||document.body).appendChild(jc),(Wc=document.createElement("div")).className="blocklyDropDownContent",jc.appendChild(Wc),(Xc=document.createElement("div")).className="blocklyDropDownArrow",jc.appendChild(Xc),jc.style.opacity="0",jc.style.transition="transform "+Jc+"s, opacity "+Jc+"s",jc.addEventListener("focusin",(function(){te(jc,"blocklyFocused")})),jc.addEventListener("focusout",(function(){ne(jc,"blocklyFocused")})))},ui=function(e){iu=e},hi=function(){return nu},di=function(){return Wc},pi=function(){Wc.textContent="",Wc.style.width=""},gi=function(e,t){jc.style.backgroundColor=e,jc.style.borderColor=t},mi=function(e,t,i,n){return Ei(_i(t),e,i,n)},fi=function(e,t,i){return su=!0,Ei(Ti(e),e,t,i)},_i=function(e){var t=e.getSvgRoot();const i=e.workspace.scale,n=e.height*i;return e=e.width*i,t=Te(t),new Tl(t.y,t.y+n,t.x,t.x+e)},Ti=function(e){return e=e.getScaledBBox(),new Tl(e.top,e.bottom,e.left,e.right)},Ei=function(e,t,i,n){const s=e.left+(e.right-e.left)/2,o=e.bottom;e=e.top,n&&(e+=n);let r=(n=t.getSourceBlock()).workspace;for(;r.options.parentWorkspace;)r=r.options.parentWorkspace;return ui(r.getParentSvg().parentNode),bi(t,n.RTL,s,o,s,e,i)},bi=function(e,t,i,n,s,o,r){return nu=e,Qc=r||null,jc.style.direction=t?"rtl":"ltr",e=A(),eu=e.getRenderer().getClassName(),tu=e.getTheme().getClassName(),eu&&te(jc,eu),tu&&te(jc,tu),Si(i,n,s,o)},Ii=function(e,t,i,n){return{initialX:(e=Ci(e,i.left,i.right,n.width)).divX,initialY:t,finalX:e.divX,finalY:t+qc,arrowX:e.arrowX,arrowY:-(Yc/2+zc),arrowAtTop:!0,arrowVisible:!0}},yi=function(e,t,i,n){return{initialX:(e=Ci(e,i.left,i.right,n.width)).divX,initialY:t-n.height,finalX:e.divX,finalY:t-n.height-qc,arrowX:e.arrowX,arrowY:n.height-2*zc-Yc/2,arrowAtTop:!1,arrowVisible:!0}},vi=function(e,t,i){return{initialX:(e=Ci(e,t.left,t.right,i.width)).divX,initialY:0,finalX:e.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}},Ci=function(e,t,i,n){return t=li(t,e-n/2,i-n),{arrowX:e=li(i=Kc,e=e-Yc/2-t,n-i-Yc),divX:t}},ki=function(){return!!nu},Oi=function(e,t){return nu===e&&(t?Ai():Ni(),!0)},Ni=function(){jc.style.transform="translate(0, 0)",jc.style.opacity="0",Zc=setTimeout((function(){Ai()}),1e3*Jc),Qc&&(Qc(),Qc=null)},Ai=function(){ki()&&(Zc&&clearTimeout(Zc),jc.style.transform="",jc.style.left="",jc.style.top="",jc.style.opacity="0",jc.style.display="none",jc.style.backgroundColor="",jc.style.borderColor="",Qc&&(Qc(),Qc=null),pi(),nu=null,eu&&(ne(jc,eu),eu=""),tu&&(ne(jc,tu),tu=""),A().markFocused())},Si=function(e,t,i,n){(e=ou.getPositionMetrics(e,t,i,n)).arrowVisible?(Xc.style.display="",Xc.style.transform="translate("+e.arrowX+"px,"+e.arrowY+"px) rotate(45deg)",Xc.setAttribute("class",e.arrowAtTop?"blocklyDropDownArrow blocklyArrowTop":"blocklyDropDownArrow blocklyArrowBottom")):Xc.style.display="none",t=Math.floor(e.initialX),i=Math.floor(e.initialY),n=Math.floor(e.finalX);const s=Math.floor(e.finalY);return jc.style.left=t+"px",jc.style.top=i+"px",jc.style.display="block",jc.style.opacity="1",jc.style.transform="translate("+(n-t)+"px,"+(s-i)+"px)",!!e.arrowAtTop},Ri=function(){if(nu){var e=nu.getSourceBlock();const t=(e=su?Ti(nu):_i(e)).left+(e.right-e.left)/2;Si(t,e.bottom,t,e.top)}else Ni()},wi=function(e){return e.length?e.reduce((function(e,t){return e.length<t.length?e:t})).length:0},Li=function(e,t){if(!e.length)return 0;if(1===e.length)return e[0].length;let i,n=0;for(t=t||wi(e),i=0;i<t;i++){for(var s=e[0][i],o=1;o<e.length;o++)if(s!==e[o][i])return n;" "===s&&(n=i+1)}for(s=1;s<e.length;s++)if((o=e[s][i])&&" "!==o)return n;return t},xi=function(e,t){if(!e.length)return 0;if(1===e.length)return e[0].length;let i,n=0;for(t=t||wi(e),i=0;i<t;i++){for(var s=e[0].substr(-i-1,1),o=1;o<e.length;o++)if(s!==e[o].substr(-i-1,1))return n;" "===s&&(n=i+1)}for(s=1;s<e.length;s++)if((o=e[s].charAt(e[s].length-i-1))&&" "!==o)return n;return t},Hr.wrap$$module$build$src$core$utils$string=function(e,t){e=e.split("\n");for(let i=0;i<e.length;i++)e[i]=$i(e[i],t);return e.join("\n")},$i=function(e,t){if(e.length<=t)return e;const i=e.trim().split(/\s+/);for(var n=0;n<i.length;n++)i[n].length>t&&(t=i[n].length);var s=-1/0;let o,r=1;do{n=s,o=e,e=[],s=i.length/r;let a=1;for(let t=0;t<i.length-1;t++)a<(t+1.5)/s?(a++,e[t]=!0):e[t]=!1;e=Mi(i,e,t),s=Di(i,e,t),e=Pi(i,e),r++}while(s>n);return o},Di=function(e,t,i){const n=[0],s=[];for(var o=0;o<e.length;o++)n[n.length-1]+=e[o].length,!0===t[o]?(n.push(0),s.push(e[o].charAt(e[o].length-1))):!1===t[o]&&n[n.length-1]++;for(e=Math.max(...n),t=0,o=0;o<n.length;o++)t-=2*Math.pow(Math.abs(i-n[o]),1.5),t-=Math.pow(e-n[o],1.5),".?!".includes(s[o])?t+=i/3:",;)]}".includes(s[o])&&(t+=i/4);return 1<n.length&&n[n.length-1]<=n[n.length-2]&&(t+=.5),t},Mi=function(e,t,i){let n,s=Di(e,t,i);for(let o=0;o<t.length-1;o++){if(t[o]===t[o+1])continue;const r=[].concat(t);r[o]=!r[o],r[o+1]=!r[o+1];const a=Di(e,r,i);a>s&&(s=a,n=r)}return n?Mi(e,n,i):t},Pi=function(e,t){const i=[];for(let n=0;n<e.length;n++)i.push(e[n]),void 0!==t[n]&&i.push(t[n]?"\n":" ");return i.join("")},Hr.isNumber$$module$build$src$core$utils$string=function(e){return/^\s*-?\d+(\.\d+)?\s*$/.test(e)},Bi=function(e){cu=e},Fi=function(){return cu},Ui=function(){return uu},Hi=function(){return Cu},Gi=function(e){if(e=Vi(e)){for(e=e.tooltip;"function"==typeof e;)e=e();if("string"!=typeof e)throw Error("Tooltip function must return a string.");return e}return""},Vi=function(e){for(;e&&e.tooltip;){if("string"==typeof e.tooltip||"function"==typeof e.tooltip)return e;e=e.tooltip}return null},ji=function(){document.querySelector(".blocklyTooltipDiv")||((Cu=document.createElement("div")).className="blocklyTooltipDiv",(w()||document.body).appendChild(Cu))},Wi=function(e){e.mouseOverWrapper_=W(e,"pointerover",null,Yi),e.mouseOutWrapper_=W(e,"pointerout",null,zi),e.addEventListener("pointermove",Ki,!1)},Xi=function(e){e&&(X(e.mouseOverWrapper_),X(e.mouseOutWrapper_),e.removeEventListener("pointermove",Ki))},Yi=function(e){hu||(e=Vi(e.currentTarget),_u!==e&&(Ji(),Tu=null,_u=e),clearTimeout(pu))},zi=function(e){hu||(pu=setTimeout((function(){Tu=_u=null,Ji()}),1),clearTimeout(gu),gu=0)},Ki=function(e){if(_u&&_u.tooltip&&!hu)if(uu){const t=mu-e.pageX;e=fu-e.pageY,Math.sqrt(t*t+e*e)>Iu&&Ji()}else Tu!==_u&&(clearTimeout(gu),mu=e.pageX,fu=e.pageY,gu=setTimeout(sn,yu))},qi=function(){Tu=_u=null,Ji()},Ji=function(){uu&&(uu=!1,Cu&&(Cu.style.display="none")),gu&&(clearTimeout(gu),gu=0)},Zi=function(){Ji(),hu=!0},Qi=function(){hu=!1},en=function(){Cu&&_u&&("function"==typeof cu?cu(Cu,_u):tn())},tn=function(){var e=Gi(_u);e=(e=Hr.wrap$$module$build$src$core$utils$string(e,du)).split("\n");for(let t=0;t<e.length;t++){const i=document.createElement("div");i.appendChild(document.createTextNode(e[t])),Cu.appendChild(i)}},nn=function(e){const t=document.documentElement.clientWidth,i=document.documentElement.clientHeight;let n=mu;n=e?n-(Eu+Cu.offsetWidth):n+Eu;let s=fu+bu;return s+Cu.offsetHeight>i+window.scrollY&&(s-=Cu.offsetHeight+2*bu),e?n=Math.max(vu-window.scrollX,n):n+Cu.offsetWidth>t+window.scrollX-2*vu&&(n=t-Cu.offsetWidth-2*vu),{x:n,y:s}},sn=function(){if(!hu&&(Tu=_u,Cu)){Cu.textContent="",en();var e=_u.RTL;Cu.style.direction=e?"rtl":"ltr",Cu.style.display="block",uu=!0;var{x:t,y:i}=nn(e);Cu.style.left=t+"px",Cu.style.top=i+"px"}},on=function(){return Ou},rn=function(e){Ou=e},an=function(){return Nu},ln=function(e){Nu=e},cn=function(e){e=`${e}`.toLowerCase().trim();var t=Au[e];if(t)return t;if(t="#"===(t="0x"===e.substring(0,2)?"#"+e.substring(2):e)[0]?t:"#"+t,/^#[0-9a-f]{6}$/.test(t))return t;if(/^#[0-9a-f]{3}$/.test(t))return["#",t[1],t[1],t[2],t[2],t[3],t[3]].join("");var i=e.match(/^(?:rgb)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);return i&&(e=Number(i[1]),t=Number(i[2]),i=Number(i[3]),0<=e&&256>e&&0<=t&&256>t&&0<=i&&256>i)?un(e,t,i):null},un=function(e,t,i){return t=e<<16|t<<8|i,16>e?"#"+(16777216|t).toString(16).substr(1):"#"+t.toString(16)},hn=function(e){return(e=cn(e))?[(e=parseInt(e.substr(1),16))>>16,e>>8&255,255&e]:[0,0,0]},dn=function(e,t,i){let n=0,s=0,o=0;if(0===t)o=s=n=i;else{const r=Math.floor(e/60),a=e/60-r;e=i*(1-t);const l=i*(1-t*a);switch(t=i*(1-t*(1-a)),r){case 1:n=l,s=i,o=e;break;case 2:n=e,s=i,o=t;break;case 3:n=e,s=l,o=i;break;case 4:n=t,s=e,o=i;break;case 5:n=i,s=e,o=l;break;case 6:case 0:n=i,s=t,o=e}}return un(Math.floor(n),Math.floor(s),Math.floor(o))},pn=function(e,t,i){return(e=cn(e))&&(t=cn(t))?(e=hn(e),t=hn(t),un(Math.round(t[0]+i*(e[0]-t[0])),Math.round(t[1]+i*(e[1]-t[1])),Math.round(t[2]+i*(e[2]-t[2])))):null},gn=function(e){return dn(e,Ou,255*Nu)},mn=function(e,t,i){const n=[];var s=e.split("");s.push("");var o=0;e=[];let r=null;for(let c=0;c<s.length;c++){var a=s[c];if(0===o)if("%"===a)(o=e.join(""))&&n.push(o),e.length=0,o=1;else if(i&&"\n"===a){const t=e.join("");t&&n.push(t),e.length=0,n.push(a)}else e.push(a);else if(1===o)"%"===a?(e.push(a),o=0):t&&"0"<=a&&"9">=a?(o=2,r=a,(a=e.join(""))&&n.push(a),e.length=0):"{"===a?o=3:(e.push("%",a),o=0);else if(2===o)if("0"<=a&&"9">=a)r+=a;else{var l=void 0;n.push(parseInt(null!=(l=r)?l:"",10)),c--,o=0}else 3===o&&(""===a?(e.splice(0,0,"%{"),c--,o=0):"}"!==a?e.push(a):(o=e.join(""),/[A-Z]\w*/i.test(o)&&(a=(a=o.toUpperCase()).startsWith("BKY_")?a.substring(4):null)&&a in Hr.Msg$$module$build$src$core$msg?"string"==typeof(o=Hr.Msg$$module$build$src$core$msg[a])?Array.prototype.push.apply(n,mn(o,t,i)):t?n.push(`${o}`):n.push(o):n.push("%{"+o+"}"),o=e.length=0))}for((t=e.join(""))&&n.push(t),l=[],e.length=0,s=0;s<n.length;s++)"string"!=typeof n[s]||i&&"\n"===n[s]?((t=e.join(""))&&l.push(t),e.length=0,l.push(n[s])):e.push(n[s]);return(t=e.join(""))&&l.push(t),e.length=0,l},fn=function(e){return mn(e,!0,!0)},_n=function(e){return"string"!=typeof e?e:(e=mn(e,!1,!1)).length?String(e[0]):""},Tn=function(e){let t=!0;const i=Hr.Msg$$module$build$src$core$msg,n=e.match(/%{BKY_[A-Z]\w*}/gi);if(n)for(let s=0;s<n.length;s++)void 0===i[n[s].toUpperCase().slice(6,-1)]&&(console.warn("No message string for "+n[s]+" in "+e),t=!1);return t},En=function(e){const t="string"==typeof e?_n(e):e;var i=Number(t);if(!isNaN(i)&&0<=i&&360>=i)return{hue:i,hex:dn(i,on(),255*an())};if(i=cn(t))return{hue:null,hex:i};throw i='Invalid colour: "'+t+'"',e!==t&&(i+=' (from "'+e+'")'),Error(i)},bn=function(){return $u},In=function(e){if($u=e,null===e){let e;null==(e=document.querySelector("."+Bu))||e.remove()}},yn=function(){const e=w()||document.body;document.querySelector("."+Bu)?$u=document.querySelector("."+Bu):($u=document.createElement("div")).className=Bu,e.appendChild($u)},vn=function(e,t,i,n){if(Cn(),Du=e,Pu=i,i=$u){if(i.style.direction=t?"rtl":"ltr",i.style.display="block",!n&&e instanceof wu){let t;n=null==(t=e.getSourceBlock())?void 0:t.workspace}var s,o;Mu=null!=(s=n)?s:null,e=null!=(o=n)?o:A(),Fu=e.getRenderer().getClassName(),Uu=e.getTheme().getClassName(),Fu&&te(i,Fu),Uu&&te(i,Uu)}},Cn=function(){if(kn()){Du=null;var e=$u;e&&(e.style.display="none",e.style.left="",e.style.top="",Pu&&Pu(),Pu=null,e.textContent="",Fu&&(ne(e,Fu),Fu=""),Uu&&(ne(e,Uu),Uu=""),A().markFocused())}},kn=function(){return!!Du},On=function(e){Du===e&&Cn()},Nn=function(e){null!==Mu&&Mu!==e||Cn()},An=function(e,t,i){$u.style.left=e+"px",$u.style.top=t+"px",$u.style.height=i+"px"},Sn=function(e,t,i,n){const s=wn(e,t,i);e=Rn(e,t,i,n),0>s?An(e,0,i.height+s):An(e,s,i.height)},Rn=function(e,t,i,n){return n?Math.min(Math.max(t.right-i.width,e.left),e.right-i.width):Math.max(Math.min(t.left,e.right-i.width),e.left)},wn=function(e,t,i){return t.bottom+i.height>=e.bottom?t.top-i.height:t.bottom},Ln=function(e){return!(null==e||!e.repositionForWindowResize)},xn=function(){Ln(Du)&&Du.repositionForWindowResize()||Cn()},$n=function(){return Gu},Dn=function(e){Gu=e},Mn=function(e,t,i,n){if(vn(Vu,i,Gn,n),t.length){var s=Pn(t,i,e);ju=s,Bn(s,e,i),setTimeout((function(){s.focus()}),1),Gu=null}else Hn()},Pn=function(e,t,i){const n=new Rc;n.setRole(kc.MENU);for(let s=0;s<e.length;s++){const o=e[s],r=new wc(o.text);r.setRightToLeft(t),r.setRole(kc.MENUITEM),n.addChild(r),r.setEnabled(o.enabled),o.enabled&&r.onAction((function(){Hn(),requestAnimationFrame((()=>{setTimeout((()=>{o.callback(o.scope,i)}),0)}))}),{})}return n},Bn=function(e,t,i){const n=ke();t=new Tl(t.clientY+n.top,t.clientY+n.top,t.clientX+n.left,t.clientX+n.left),Fn(e);const s=e.getSize();i&&(t.left+=s.width,t.right+=s.width,n.left+=s.width,n.right+=s.width),Sn(n,t,s,i),e.focus()},Fn=function(e){var t=bn();if(!t)throw Error("Attempting to create a context menu when widget div is null");t=e.render(t),te(t,"blocklyContextMenu"),j(t,"contextmenu",null,Un),e.focus()},Un=function(e){e.preventDefault(),e.stopPropagation()},Hn=function(){On(Vu),Gu=null},Gn=function(){ju&&(ju.dispose(),ju=null)},Hr.callbackFactory$$module$build$src$core$contextmenu=function(e,t){return()=>{let i;Hr.disable$$module$build$src$core$events$utils();try{i=t instanceof Element?is(t,e.workspace):Xt(t,e.workspace);const n=e.getRelativeToSurfaceXY();n.x=e.RTL?n.x-Hr.config$$module$build$src$core$config.snapRadius:n.x+Hr.config$$module$build$src$core$config.snapRadius,n.y+=2*Hr.config$$module$build$src$core$config.snapRadius,i.moveBy(n.x,n.y)}finally{Hr.enable$$module$build$src$core$events$utils()}return T()&&!i.isShadow()&&p(new(y(Hr.CREATE$$module$build$src$core$events$utils))(i)),Hr.setSelected$$module$build$src$core$common(i),i}},Vn=function(e,t=!1){const i=Hr.createElement$$module$build$src$core$utils$xml("xml");var n=Wn(Hr.allUsedVarModels$$module$build$src$core$variables(e));n.hasChildNodes()&&i.appendChild(n);for(const n of e.getTopComments())i.appendChild(jn(n,t));for(e=e.getTopBlocks(!0),n=0;n<e.length;n++)i.appendChild(Xn(e[n],t));return i},jn=function(e,t=!1){const i=Hr.createElement$$module$build$src$core$utils$xml("comment");t||i.setAttribute("id",e.id),t=e.workspace;const n=e.getRelativeToSurfaceXY();return n.x=t.RTL?t.getWidth()-n.x:n.x,i.setAttribute("x",`${n.x}`),i.setAttribute("y",`${n.y}`),i.setAttribute("w",`${e.getSize().width}`),i.setAttribute("h",`${e.getSize().height}`),e.getText()&&(i.textContent=e.getText()),e.isCollapsed()&&i.setAttribute("collapsed","true"),e.isOwnEditable()||i.setAttribute("editable","false"),e.isOwnMovable()||i.setAttribute("movable","false"),e.isOwnDeletable()||i.setAttribute("deletable","false"),i},Wn=function(e){const t=Hr.createElement$$module$build$src$core$utils$xml("variables");for(let i=0;i<e.length;i++){const n=e[i],s=Hr.createElement$$module$build$src$core$utils$xml("variable");s.appendChild(Hr.createTextNode$$module$build$src$core$utils$xml(n.name)),n.type&&s.setAttribute("type",n.type),s.id=n.getId(),t.appendChild(s)}return t},Xn=function(e,t){if(e.isInsertionMarker()&&!(e=e.getChildren(!1)[0]))return new DocumentFragment;let i=0;if(e.workspace.RTL&&(i=e.workspace.getWidth()),t=Kn(e,t),ms(t)){const n=e.getRelativeToSurfaceXY();t.setAttribute("x",String(Math.round(e.workspace.RTL?i-n.x:n.x))),t.setAttribute("y",String(Math.round(n.y)))}return t},Yn=function(e){if(e.isSerializable()){const t=Hr.createElement$$module$build$src$core$utils$xml("field");return t.setAttribute("name",e.name||""),e.toXml(t)}return null},zn=function(e,t){for(let i=0;i<e.inputList.length;i++){const n=e.inputList[i];for(let e=0;e<n.fieldRow.length;e++){const i=Yn(n.fieldRow[e]);i&&t.appendChild(i)}}},Kn=function(e,t){if(e.isInsertionMarker())return(t=e.getChildren(!1)[0])?Kn(t):new DocumentFragment;const i=Hr.createElement$$module$build$src$core$utils$xml(e.isShadow()?"shadow":"block");if(i.setAttribute("type",e.type),t||(i.id=e.id),e.mutationToDom){var n=e.mutationToDom();n&&(n.hasChildNodes()||n.hasAttributes())&&i.appendChild(n)}if(zn(e,i),n=e.getCommentText()){var s=e.getIcon(Kl.COMMENT),o=s.getBubbleSize();s=s.bubbleIsVisible();var r=Hr.createElement$$module$build$src$core$utils$xml("comment");r.appendChild(Hr.createTextNode$$module$build$src$core$utils$xml(n)),r.setAttribute("pinned",`${s}`),r.setAttribute("h",String(o.height)),r.setAttribute("w",String(o.width)),i.appendChild(r)}for(e.data&&((n=Hr.createElement$$module$build$src$core$utils$xml("data")).appendChild(Hr.createTextNode$$module$build$src$core$utils$xml(e.data)),i.appendChild(n)),n=0;n<e.inputList.length;n++){var a=void 0;if(s=!0,(o=e.inputList[n]).type!==Hr.inputTypes$$module$build$src$core$inputs$input_types.DUMMY&&o.type!==Hr.inputTypes$$module$build$src$core$inputs$input_types.END_ROW){r=o.connection.targetBlock(),o.type===Hr.inputTypes$$module$build$src$core$inputs$input_types.VALUE?a=Hr.createElement$$module$build$src$core$utils$xml("value"):o.type===Hr.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT&&(a=Hr.createElement$$module$build$src$core$utils$xml("statement"));const e=o.connection.getShadowDom();!e||r&&r.isShadow()||a.appendChild(qn(e,t)),r&&(r=Kn(r,t)).nodeType===ll.ELEMENT_NODE&&(a.appendChild(r),s=!1),a.setAttribute("name",o.name),s||i.appendChild(a)}}let l;return void 0!==e.inputsInline&&e.inputsInline!==e.inputsInlineDefault&&i.setAttribute("inline",String(e.inputsInline)),e.isCollapsed()&&i.setAttribute("collapsed","true"),e.isEnabled()||i.setAttribute("disabled-reasons",Array.from(e.getDisabledReasons()).map(encodeURIComponent).join(",")),e.isOwnDeletable()||i.setAttribute("deletable","false"),e.isOwnMovable()||i.setAttribute("movable","false"),e.isOwnEditable()||i.setAttribute("editable","false"),(a=e.getNextBlock())&&(n=Kn(a,t)).nodeType===ll.ELEMENT_NODE&&((l=Hr.createElement$$module$build$src$core$utils$xml("next")).appendChild(n),i.appendChild(l)),!(e=e.nextConnection&&e.nextConnection.getShadowDom())||a&&a.isShadow()||l.appendChild(qn(e,t)),i},qn=function(e,t){let i,n=e=e.cloneNode(!0);for(;n;)if(t&&"shadow"===n.nodeName&&n.removeAttribute("id"),n.firstChild)n=n.firstChild;else{for(;n&&!n.nextSibling;){let e;i=n,n=n.parentNode,i.nodeType===ll.TEXT_NODE&&""===i.data.trim()&&(null==(e=n)?void 0:e.firstChild)!==i&&oe(i)}n&&(i=n,n=n.nextSibling,i.nodeType===ll.TEXT_NODE&&""===i.data.trim()&&oe(i))}return e},Jn=function(e){return Re(e).replace(/<(\w+)([^<]*)\/>/g,"<$1$2></$1>")},Zn=function(e){e=Jn(e).split("<");let t="";for(let i=1;i<e.length;i++){const n=e[i];"/"===n[0]&&(t=t.substring(2)),e[i]=t+"<"+n,"/"!==n[0]&&"/>"!==n.slice(-2)&&(t+="  ")}return(e=(e=e.join("\n")).replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>")).replace(/^\n/,"")},Qn=function(e,t){return t.setResizesEnabled(!1),t.clear(),e=Hr.domToWorkspace$$module$build$src$core$xml(e,t),t.setResizesEnabled(!0),e},Hr.domToWorkspace$$module$build$src$core$xml=function(e,t){let i=0;t.RTL&&(i=t.getWidth());const n=[];le();const s=Hr.getGroup$$module$build$src$core$events$utils();s||Hr.setGroup$$module$build$src$core$events$utils(!0),t.setResizesEnabled&&t.setResizesEnabled(!1);let o=!0;try{for(let s,r=0;s=e.childNodes[r];r++){const e=s.nodeName.toLowerCase(),r=s;if("block"===e||"shadow"===e&&!d()){const e=is(r,t);let s;n.push(e.id);const a=parseInt(null!=(s=r.getAttribute("x"))?s:"10",10);let l;const c=parseInt(null!=(l=r.getAttribute("y"))?l:"10",10);isNaN(a)||isNaN(c)||e.moveBy(t.RTL?i-a:a,c,["create"]),o=!1}else{if("shadow"===e)throw TypeError("Shadow block cannot be a top-level block.");if("comment"===e)es(r,t);else if("variables"===e){if(!o)throw Error("'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.");ns(r,t),o=!1}}}}finally{Hr.setGroup$$module$build$src$core$events$utils(s),t.setResizesEnabled&&t.setResizesEnabled(!0),t.rendered&&Tt(),ce()}return p(new(y(ra))(t)),n},es=function(e,t){var i;const n=null!=(i=e.getAttribute("id"))?i:void 0;var s,o;let r;var a;let l;return(i=t.rendered?new Ku(t,n):new _c(t,n)).setText(null!=(s=e.textContent)?s:""),s=parseInt(null!=(o=e.getAttribute("x"))?o:"",10),o=parseInt(null!=(r=e.getAttribute("y"))?r:"",10),isNaN(s)||isNaN(o)||(s=t.RTL?t.getWidth()-s:s,i.moveTo(new cl(s,o))),t=parseInt(null!=(a=e.getAttribute("w"))?a:"",10),a=parseInt(null!=(l=e.getAttribute("h"))?l:"",10),isNaN(t)||isNaN(a)||i.setSize(new El(t,a)),"true"===e.getAttribute("collapsed")&&i.setCollapsed(!0),"false"===e.getAttribute("editable")&&i.setEditable(!1),"false"===e.getAttribute("movable")&&i.setMovable(!1),"false"===e.getAttribute("deletable")&&i.setDeletable(!1),i},ts=function(e,t){if(!t.getBlocksBoundingBox)return Hr.domToWorkspace$$module$build$src$core$xml(e,t);var i=t.getBlocksBoundingBox();if(e=Hr.domToWorkspace$$module$build$src$core$xml(e,t),i&&i.top!==i.bottom){var n=i.bottom;i=t.RTL?i.right:i.left;var s=1/0;let o=-1/0,r=1/0;for(let i=0;i<e.length;i++){const n=t.getBlockById(e[i]).getRelativeToSurfaceXY();n.y<r&&(r=n.y),n.x<s&&(s=n.x),n.x>o&&(o=n.x)}for(n=n-r+10,i=t.RTL?i-o:i-s,s=0;s<e.length;s++)t.getBlockById(e[s]).moveBy(i,n,["create"])}return e},Hr.domToBlock$$module$build$src$core$xml=function(e,t){return e=is(e,t),t.rendered&&Tt(),e},is=function(e,t){Hr.disable$$module$build$src$core$events$utils();var i=t.getAllVariables();let n;try{if(n=ds(e,t),t.rendered){const e=n,i=n.getDescendants(!1);e.setConnectionTracking(!1);for(let e=i.length-1;0<=e;e--)i[e].initSvg();for(let e=i.length-1;0<=e;e--)i[e].queueRender();setTimeout((function(){e.disposed||e.setConnectionTracking(!0)}),1),t.resizeContents()}else{const e=n.getDescendants(!1);for(let t=e.length-1;0<=t;t--)e[t].initModel()}}finally{Hr.enable$$module$build$src$core$events$utils()}if(T()){for(e=mt(t,i),t=0;t<e.length;t++)i=e[t],p(new(y(Zr))(i));p(new(y(Hr.CREATE$$module$build$src$core$events$utils))(n))}return n},ns=function(e,t){for(let n=0;n<e.children.length;n++){var i=e.children[n];const s=i.getAttribute("type"),o=i.getAttribute("id");if(!(i=i.textContent))break;t.createVariable(i,s,o)}},ss=function(e){const t={mutation:[],comment:[],data:[],field:[],input:[],next:[]};for(let i=0;i<e.children.length;i++){const n=e.children[i];if(n.nodeType!==ll.TEXT_NODE)switch(n.nodeName.toLowerCase()){case"mutation":t.mutation.push(n);break;case"comment":t.comment.push(n);break;case"data":t.data.push(n);break;case"title":case"field":t.field.push(n);break;case"value":case"statement":t.input.push(n);break;case"next":t.next.push(n);break;default:console.warn("Ignoring unknown tag: "+n.nodeName)}}return t},os=function(e,t){let i=!1;for(let n=0;n<e.length;n++){const s=e[n];t.domToMutation&&(t.domToMutation(s),t.initSvg&&(i=!0))}return i},rs=function(e,t){for(let n=0;n<e.length;n++){var i=e[n];const s=i.textContent,o="true"===i.getAttribute("pinned");let r;const a=parseInt(null!=(r=i.getAttribute("w"))?r:"50",10);let l;i=parseInt(null!=(l=i.getAttribute("h"))?l:"50",10),t.setCommentText(s);const c=t.getIcon(Kl.COMMENT);isNaN(a)||isNaN(i)||c.setBubbleSize(new El(a,i)),c.setBubbleVisible(o),setTimeout((()=>c.setBubbleVisible(o)),1)}},as=function(e,t){for(let i=0;i<e.length;i++)t.data=e[i].textContent},ls=function(e,t){for(let i=0;i<e.length;i++){const n=e[i],s=n.getAttribute("name");s?ps(t,s,n):console.warn(`Ignoring unnamed field in block ${t.type}`)}},cs=function(e){let t=null,i=null;for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];ms(s)&&("block"===s.nodeName.toLowerCase()?t=s:"shadow"===s.nodeName.toLowerCase()&&(i=s))}return{childBlockElement:t,childShadowElement:i}},us=function(e,t,i,n){for(let o=0;o<e.length;o++){var s=e[o];const r=s.getAttribute("name"),a=r?i.getInput(r):null;if(!a){console.warn("Ignoring non-existent input "+r+" in block "+n);break}if((s=cs(s)).childBlockElement){if(!a.connection)throw TypeError("Input connection does not exist.");ds(s.childBlockElement,t,a.connection,!1)}if(s.childShadowElement){let e;null==(e=a.connection)||e.setShadowDom(s.childShadowElement)}}},hs=function(e,t,i){for(let n=0;n<e.length;n++){const s=cs(e[n]);if(s.childBlockElement){if(!i.nextConnection)throw TypeError("Next statement does not exist.");if(i.nextConnection.isConnected())throw TypeError("Next statement is already connected.");ds(s.childBlockElement,t,i.nextConnection,!0)}s.childShadowElement&&i.nextConnection&&i.nextConnection.setShadowDom(s.childShadowElement)}},ds=function(e,t,i,n){var s;const o=e.getAttribute("type");if(!o)throw TypeError("Block type unspecified: "+e.outerHTML);var r=null!=(s=e.getAttribute("id"))?s:void 0;s=t.newBlock(o,r),r=ss(e);const a=os(r.mutation,s);if(rs(r.comment,s),as(r.data,s),i)if(n){if(!s.previousConnection)throw TypeError("Next block does not have previous statement.");i.connect(s.previousConnection)}else if(s.outputConnection)i.connect(s.outputConnection);else{if(!s.previousConnection)throw TypeError("Child block does not have output or previous statement.");i.connect(s.previousConnection)}if(ls(r.field,s),us(r.input,t,s,o),hs(r.next,t,s),a&&s.initSvg(),(t=e.getAttribute("inline"))&&s.setInputsInline("true"===t),(t=e.getAttribute("disabled"))&&s.setDisabledReason("true"===t||"disabled"===t,Yl),null!==(t=e.getAttribute("disabled-reasons")))for(var l of t.split(","))s.setDisabledReason(!0,decodeURIComponent(l));if((l=e.getAttribute("deletable"))&&s.setDeletable("true"===l),(l=e.getAttribute("movable"))&&s.setMovable("true"===l),(l=e.getAttribute("editable"))&&s.setEditable("true"===l),(l=e.getAttribute("collapsed"))&&s.setCollapsed("true"===l),"shadow"===e.nodeName.toLowerCase()){for(e=s.getChildren(!1),l=0;l<e.length;l++)if(!e[l].isShadow())throw TypeError("Shadow block not allowed non-shadow child.");s.setShadow(!0)}return s},ps=function(e,t,i){const n=e.getField(t);n?n.fromXml(i):console.warn("Ignoring non-existent field "+t+" in block "+e.type)},gs=function(e){for(let t=0;t<e.childNodes.length;t++){const i=e.childNodes[t];if("next"===i.nodeName.toLowerCase()){e.removeChild(i);break}}},ms=function(e){return e.nodeType===ll.ELEMENT_NODE},fs=function(e){if(!(100<e.getDescendants(!1).length)){var t=e.workspace,i=e.getSvgRoot();t.getAudioManager().play("delete");var n,s=e.getRelativeToSurfaceXY(),o=i.cloneNode(!0);o.setAttribute("transform","translate("+s.x+","+s.y+")"),null==(n=t.getLayerManager())||n.appendToAnimationLayer({getSvgRoot:()=>o}),_s(o,{x:s.x,y:s.y,width:e.width,height:e.height},t.RTL,new Date)}},_s=function(e,t,i,n){const s=((new Date).getTime()-n.getTime())/150;1<s?oe(e):(e.setAttribute("transform","translate("+(t.x+(i?-1:1)*t.width/2*s)+","+(t.y+t.height/2*s)+") scale("+(1-s)+")"),setTimeout(_s,10,e,t,i,n))},Ts=function(e){var t=e.workspace;const i=t.scale;if(t.getAudioManager().play("click"),!(1>i)){var n=t.getSvgXY(e.getSvgRoot());e.outputConnection?(n.x+=(e.RTL?3:-3)*i,n.y+=13*i):e.previousConnection&&(n.x+=(e.RTL?-23:23)*i,n.y+=3*i);var s=ee(_l.CIRCLE,{cx:n.x,cy:n.y,r:0,fill:"none",stroke:"#888","stroke-width":10},t.getParentSvg());e=ee(_l.ANIMATE,{id:"animationCircle",begin:"indefinite",attributeName:"r",dur:"150ms",from:0,to:25*i},s),t=ee(_l.ANIMATE,{id:"animationOpacity",begin:"indefinite",attributeName:"opacity",dur:"150ms",from:1,to:0},s),e.beginElement(),t.beginElement(),setTimeout((()=>{oe(s)}),150)}},Es=function(e){if(Is(),e.workspace.getAudioManager().play("disconnect"),!(1>e.workspace.scale)){var t=e.getHeightWidth().height;t=Math.atan(10/t)/Math.PI*180,e.RTL||(t*=-1),sh=e,bs(e,t,new Date)}},bs=function(e,t,i){const n=((new Date).getTime()-i.getTime())/200;let s="";1>=n&&(s=`skewX(${Math.round(Math.sin(n*Math.PI*3)*(1-n)*t)})`,nh=setTimeout(bs,10,e,t,i)),e.getSvgRoot().setAttribute("transform",`${e.getTranslation()} ${s}`)},Is=function(){sh&&(nh&&(clearTimeout(nh),nh=null),sh.getSvgRoot().setAttribute("transform",sh.getTranslation()),sh=null)},ys=function(e){return void 0!==e.getRelativeToSurfaceXY&&void 0!==e.isMovable&&void 0!==e.startDrag&&void 0!==e.drag&&void 0!==e.endDrag&&void 0!==e.revertDrag},vs=function(e,t){for(const i in t)e[i]=null!==t[i]&&"object"==typeof t[i]?vs(e[i]||Object.create(null),t[i]):t[i];return e},Cs=function(e){return void 0!==e.getProcedureModel&&void 0!==e.doProcedureUpdate&&void 0!==e.isProcedureDef},ks=function(e){return void 0!==e.startPublishing&&void 0!==e.stopPublishing},Os=function(e,i){t(Xr.FIELD,e,i)},Ns=function(e){n(Xr.FIELD,e)},Hr.fromJson$$module$build$src$core$field_registry=function(e){return mh.fromJsonInternal(e)},As=function(e){const t=a(Xr.FIELD,e.type);return t?t.fromJson(e):(console.warn("Blockly could not create a field of type "+e.type+". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached."),null)},Ss=function(e){let t=!1;const i=e.map((([e,i])=>"string"==typeof e?[_n(e),i]:(t=!0,[null!==e.alt?Object.assign({},e,{alt:_n(e.alt)}):Object.assign({},e),i])));if(t||2>e.length)return{options:i};var n=i.map((([e])=>e)),s=wi(n);e=Li(n,s);const o=xi(n,s);return!e&&!o||s<=e+o?{options:i}:(s=e?n[0].substring(0,e-1):void 0,n=o?n[0].substr(1-o):void 0,{options:Rs(i,e,o),prefix:s,suffix:n})},Rs=function(e,t,i){return e.map((([e,n])=>[e.substring(t,e.length-i),n]))},ws=function(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");let t=!1;for(let i=0;i<e.length;i++){const n=e[i];Array.isArray(n)?"string"!=typeof n[1]?(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option id must be a string. Found "+n[1]+" in: ",n)):n[0]&&"string"!=typeof n[0]&&"string"!=typeof n[0].src&&(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option must have a string label or image description. Found"+n[0]+" in: ",n)):(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option must be an array. Found: ",n))}if(t)throw TypeError("Found invalid FieldDropdown options.")},Hr.register$$module$build$src$core$extensions=function(e,t){if("string"!=typeof e||""===e.trim())throw Error('Error: Invalid extension name "'+e+'"');if(vh[e])throw Error('Error: Extension "'+e+'" is already registered.');if("function"!=typeof t)throw Error('Error: Extension "'+e+'" must be a function');vh[e]=t},Hr.registerMixin$$module$build$src$core$extensions=function(e,t){if(!t||"object"!=typeof t)throw Error('Error: Mixin "'+e+'" must be a object');Hr.register$$module$build$src$core$extensions(e,(function(){this.mixin(t)}))},Hr.registerMutator$$module$build$src$core$extensions=function(e,t,i,n){const s='Error when registering mutator "'+e+'": ';Us(s,t);const o=Bs(t,s);if(i&&"function"!=typeof i)throw Error(s+'Extension "'+e+'" is not a function');Hr.register$$module$build$src$core$extensions(e,(function(){o&&this.setMutator(new Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon(n||[],this)),this.mixin(t),i&&i.apply(this)}))},Ls=function(e){xs(e)?delete vh[e]:console.warn('No extension mapping for name "'+e+'" found to unregister')},xs=function(e){return!!vh[e]},$s=function(e,t,i){const n=vh[e];if("function"!=typeof n)throw Error('Error: Extension "'+e+'" not found.');let s;if(i?Ds(e,t):s=Hs(t),n.apply(t),i)Us('Error after applying mutator "'+e+'": ',t);else if(!Gs(s,t))throw Error('Error when applying extension "'+e+'": mutation properties changed when applying a non-mutator extension.')},Ds=function(e,t){if(Hs(t).length)throw Error('Error: tried to apply mutation "'+e+'" to a block that already has mutator functions.  Block id: '+t.id)},Ms=function(e,t){return Fs(e.mutationToDom,e.domToMutation,t+" mutationToDom/domToMutation")},Ps=function(e,t){return Fs(e.saveExtraState,e.loadExtraState,t+" saveExtraState/loadExtraState")},Bs=function(e,t){return Fs(e.compose,e.decompose,t+" compose/decompose")},Fs=function(e,t,i){if(e&&t){if("function"!=typeof e||"function"!=typeof t)throw Error(i+" must be a function");return!0}if(!e&&!t)return!1;throw Error(i+"Must have both or neither functions")},Us=function(e,t){const i=Ms(t,e),n=Ps(t,e);if(!i&&!n)throw Error(e+"Mutations must contain either XML hooks, or JSON hooks, or both");Bs(t,e)},Hs=function(e){const t=[];return void 0!==e.domToMutation&&t.push(e.domToMutation),void 0!==e.mutationToDom&&t.push(e.mutationToDom),void 0!==e.saveExtraState&&t.push(e.saveExtraState),void 0!==e.loadExtraState&&t.push(e.loadExtraState),void 0!==e.compose&&t.push(e.compose),void 0!==e.decompose&&t.push(e.decompose),t},Gs=function(e,t){if((t=Hs(t)).length!==e.length)return!1;for(let i=0;i<t.length;i++)if(e[i]!==t[i])return!1;return!0},Vs=function(e){if("object"!=typeof document)throw Error("runAfterPageLoad() requires browser document.");if("complete"===document.readyState)e();else{const t=setInterval((function(){"complete"===document.readyState&&(clearInterval(t),e())}),10)}},Hr.buildTooltipForDropdown$$module$build$src$core$extensions=function(e,t){const i=[];return function(){i.includes(this.type)||(js(this,e,t),i.push(this.type)),this.setTooltip(function(){const i=String(this.getFieldValue(e));return _n(t[i])}.bind(this))}},js=function(e,t,i){var n=e.getField(t);if(n instanceof _h&&!n.isOptionListDynamic()){n=n.getOptions();for(const[,s]of n)void 0===i[s]&&console.warn(`No tooltip mapping for value ${s} of field ${t} of block type ${e.type}.`)}},Hr.buildTooltipWithFieldText$$module$build$src$core$extensions=function(e,t){return function(){this.setTooltip(function(){const i=this.getField(t);return _n(e).replace("%1",i?i.getText():"")}.bind(this))}},Ws=function(){const e=this.tooltip;this.setTooltip(function(){const t=this.getParent();return t&&t.getInputsInline()&&t.tooltip||e}.bind(this))},Xs=function(e,t,i,n){e=e+" was deprecated in "+t+" and will be deleted in "+i+".",n&&(e+="\nUse "+n+" instead."),Nh.has(e)||(Nh.add(e),console.warn(e))},Ys=function(e,t){return" "+e+","+t+" "},zs=function(e,t){return" "+e+t.join("")},Ks=function(e,t){return" M "+e+","+t+" "},qs=function(e,t){return" m "+e+","+t+" "},Js=function(e,t){return" l "+e+","+t+" "},Zs=function(e){return" l"+e.join("")},Qs=function(e,t){return" "+e+" "+t+" "},eo=function(e,t,i,n){return e+" "+i+" "+i+" "+t+n},to=function(e,i){t(Xr.ICON,e.toString(),i)},io=function(e){n(Xr.ICON,e)},no=function(e){const t=e.getProcedureMap().getProcedures().filter((e=>!e.getReturnTypes())).map((e=>[e.getName(),e.getParameters().map((e=>e.getName())),!1]));e.getBlocksByType("procedures_defnoreturn",!1).forEach((e=>{!Cs(e)&&Qe(e)&&t.push(e.getProcedureDef())}));const i=e.getProcedureMap().getProcedures().filter((e=>!!e.getReturnTypes())).map((e=>[e.getName(),e.getParameters().map((e=>e.getName())),!0]));return e.getBlocksByType("procedures_defreturn",!1).forEach((e=>{!Cs(e)&&Qe(e)&&i.push(e.getProcedureDef())})),t.sort(so),i.sort(so),[t,i]},so=function(e,t){return e[0].localeCompare(t[0],void 0,{sensitivity:"base"})},Hr.findLegalName$$module$build$src$core$procedures=function(e,t){if(t.isInFlyout)return e;for(e=e||Hr.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed";!oo(e,t.workspace,t);){const t=e.match(/^(.*?)(\d+)$/);e=t?t[1]+(parseInt(t[2])+1):e+"2"}return e},oo=function(e,t,i){return!ro(e,t,i)},ro=function(e,t,i){for(const n of t.getAllBlocks(!1))if(n!==i&&Qe(n)&&Hr.Names$$module$build$src$core$names.equals(n.getProcedureDef()[0],e))return!0;i=i&&Cs(i)?null==i?void 0:i.getProcedureModel():void 0;for(const n of t.getProcedureMap().getProcedures())if(n!==i&&Hr.Names$$module$build$src$core$names.equals(n.getName(),e))return!0;return!1},Hr.rename$$module$build$src$core$procedures=function(e){var t=this.getSourceBlock();if(!t)throw new Lu;e=e.trim();const i=Hr.findLegalName$$module$build$src$core$procedures(e,t);Cs(t)&&!t.isInsertionMarker()&&t.getProcedureModel().setName(i);const n=this.getValue();if(n!==e&&n!==i)for(e=t.workspace.getAllBlocks(!1),t=0;t<e.length;t++){const s=e[t];s.renameProcedure&&s.renameProcedure(n,i)}return i},ao=function(e){function t(e,t){for(let s=0;s<e.length;s++){var n=e[s][0];const o=e[s][1],r=Hr.createElement$$module$build$src$core$utils$xml("block");r.setAttribute("type",t),r.setAttribute("gap","16");const a=Hr.createElement$$module$build$src$core$utils$xml("mutation");for(a.setAttribute("name",n),r.appendChild(a),n=0;n<o.length;n++){const e=Hr.createElement$$module$build$src$core$utils$xml("arg");e.setAttribute("name",o[n]),a.appendChild(e)}i.push(r)}}const i=[];if(da.procedures_defnoreturn){var n=Hr.createElement$$module$build$src$core$utils$xml("block");n.setAttribute("type","procedures_defnoreturn"),n.setAttribute("gap","16");var s=Hr.createElement$$module$build$src$core$utils$xml("field");s.setAttribute("name","NAME"),s.appendChild(Hr.createTextNode$$module$build$src$core$utils$xml(Hr.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_PROCEDURE)),n.appendChild(s),i.push(n)}return da.procedures_defreturn&&((n=Hr.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","procedures_defreturn"),n.setAttribute("gap","16"),(s=Hr.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name","NAME"),s.appendChild(Hr.createTextNode$$module$build$src$core$utils$xml(Hr.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_PROCEDURE)),n.appendChild(s),i.push(n)),da.procedures_ifreturn&&((n=Hr.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","procedures_ifreturn"),n.setAttribute("gap","16"),i.push(n)),i.length&&i[i.length-1].setAttribute("gap","24"),t((e=no(e))[0],"procedures_callnoreturn"),t(e[1],"procedures_callreturn"),i},lo=function(e){var t=[],i=e.getBlocksByType("procedures_mutatorarg",!1);for(let e,n=0;e=i[n];n++)t.push(e.getFieldValue("NAME"));i=Hr.createElement$$module$build$src$core$utils$xml("xml");const n=Hr.createElement$$module$build$src$core$utils$xml("block");n.setAttribute("type","procedures_mutatorarg");const s=Hr.createElement$$module$build$src$core$utils$xml("field");s.setAttribute("name","NAME"),t=ot(Hr.DEFAULT_ARG$$module$build$src$core$procedures,t),t=Hr.createTextNode$$module$build$src$core$utils$xml(t),s.appendChild(t),n.appendChild(s),i.appendChild(n),e.updateToolbox(i)},co=function(e){if(e.type===ia&&"mutator"===e.bubbleType&&e.isOpen&&e.blockId){var t=(e=C(e.workspaceId).getBlockById(e.blockId)).type;"procedures_defnoreturn"!==t&&"procedures_defreturn"!==t||(e=e.getIcon(Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE).getWorkspace(),lo(e),e.addChangeListener(uo))}},uo=function(e){e.type!==Hr.CREATE$$module$build$src$core$events$utils&&e.type!==Hr.DELETE$$module$build$src$core$events$utils&&e.type!==Hr.CHANGE$$module$build$src$core$events$utils&&e.type!==Jr||(e=C(e.workspaceId),lo(e))},ho=function(e,t){return t.getAllBlocks(!1).filter((t=>po(t,e)||et(t)&&Hr.Names$$module$build$src$core$names.equals(t.getProcedureCall(),e)))},po=function(e,t){return Cs(e)&&!e.isProcedureDef()&&e.getProcedureModel()&&Hr.Names$$module$build$src$core$names.equals(e.getProcedureModel().getName(),t)},Hr.mutateCallers$$module$build$src$core$procedures=function(e){const t=d();var i=e.getProcedureDef()[0];const n=e.mutationToDom(!0);e=ho(i,e.workspace);for(let o,r=0;o=e[r];r++){i=(i=o.mutationToDom())&&Re(i),o.domToMutation&&o.domToMutation(n);var s=o.mutationToDom();i!==(s=s&&Re(s))&&(Hr.setRecordUndo$$module$build$src$core$events$utils(!1),p(new(y(Hr.CHANGE$$module$build$src$core$events$utils))(o,"mutation",null,i,s)),Hr.setRecordUndo$$module$build$src$core$events$utils(t))}},Hr.getDefinition$$module$build$src$core$procedures=function(e,t){for(const i of t.getAllBlocks(!1))if(Cs(i)&&i.isProcedureDef()&&Hr.Names$$module$build$src$core$names.equals(i.getProcedureModel().getName(),e)||Qe(i)&&Hr.Names$$module$build$src$core$names.equals(i.getProcedureDef()[0],e))return i;return null},go=function(e){return e.isDynamic},mo=function(e){return void 0!==e.pathDown&&void 0!==e.pathUp},fo=function(e){return void 0!==e.pathLeft&&void 0!==e.pathRight},_o=function(e,t){if(!e||!t)throw Error("Cannot connect null connections.");e.targetConnection=t,t.targetConnection=e},To=function(e,t){let i=null;const n=null==(t=t.outputConnection)?void 0:t.getConnectionChecker();for(let s,o=0;s=e.inputList[o];o++){const e=s.connection;let o;if(e&&null!=(o=n)&&o.canConnect(t,e,!1)){if(i)return null;i=e}}return i},Eo=function(e,t){let i;for(;i=To(e,t);)if(!(e=i.targetBlock())||e.isShadow())return i;return null},bo=function(e){return void 0!==e.getType&&void 0!==e.initView&&void 0!==e.dispose&&void 0!==e.getWeight&&void 0!==e.getSize&&void 0!==e.applyColour&&void 0!==e.hideForInsertionMarker&&void 0!==e.updateEditable&&void 0!==e.updateCollapsed&&void 0!==e.isShownWhenCollapsed&&void 0!==e.setOffsetInBlock&&void 0!==e.onLocationChange&&void 0!==e.onClick},Io=function(e){return bo(e)&&oi(e)&&Dt(e)&&void 0!==e.setText&&void 0!==e.getText&&void 0!==e.setBubbleSize&&void 0!==e.getBubbleSize&&e.getType()===Kl.COMMENT},yo=function(e){let t=e.outputConnection;return(!t||e.previousConnection&&e.previousConnection.isConnected())&&(t=e.previousConnection),t},vo=function(e,i){t(Xr.RENDERER,e,i)},Co=function(e){n(Xr.RENDERER,e)},ko=function(e,t,i){return(e=new(r(Xr.RENDERER,e))(e)).init(t,i),e},Oo=function(e){rt(e.getTargetWorkspace(),void 0,"String")},No=function(e){rt(e.getTargetWorkspace(),void 0,"Number")},Ao=function(e){rt(e.getTargetWorkspace(),void 0,"Colour")},So=function(e){let t=[],i=document.createElement("button");return i.setAttribute("text",Hr.Msg$$module$build$src$core$msg.NEW_STRING_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_STRING"),t.push(i),(i=document.createElement("button")).setAttribute("text",Hr.Msg$$module$build$src$core$msg.NEW_NUMBER_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_NUMBER"),t.push(i),(i=document.createElement("button")).setAttribute("text",Hr.Msg$$module$build$src$core$msg.NEW_COLOUR_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_COLOUR"),t.push(i),e.registerButtonCallback("CREATE_VARIABLE_STRING",Oo),e.registerButtonCallback("CREATE_VARIABLE_NUMBER",No),e.registerButtonCallback("CREATE_VARIABLE_COLOUR",Ao),e=Ro(e),t.concat(e)},Ro=function(e){const t=[];if(0<(e=e.getAllVariables()).length){if(da.variables_set_dynamic){var i=e[e.length-1];const n=Hr.createElement$$module$build$src$core$utils$xml("block");n.setAttribute("type","variables_set_dynamic"),n.setAttribute("gap","24"),n.appendChild(pt(i)),t.push(n)}if(da.variables_get_dynamic){e.sort(rc.compareByName);for(let n,s=0;n=e[s];s++)(i=Hr.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_get_dynamic"),i.setAttribute("gap","8"),i.appendChild(pt(n)),t.push(i)}}return t},wo=function(e){e.resizeContents()},Lo=function(e,t){const i=e.workspace,n=Hr.config$$module$build$src$core$config.snapRadius,s=cl.difference(t,e.getRelativeToSurfaceXY()),o=new cl(0,0),r=i.getAllBlocks(!1).filter((t=>t.id!=e.id)).map((e=>e.getRelativeToSurfaceXY()));for(;xo(cl.sum(t,o),r)||$o(e,cl.sum(s,o),n);)i.RTL?o.translate(-n,2*n):o.translate(n,2*n);e.moveTo(cl.sum(t,o))},xo=function(e,t){return t.some((t=>1>=Math.abs(t.x-e.x)&&1>=Math.abs(t.y-e.y)))},$o=function(e,t,i){return e.getConnections_(!1).some((e=>!!e.closest(i,t).connection))},Do=function(e,t,i){const n=i.getBoundingRectangle(),s=n.right-n.left,o=li(t.top,n.top,t.top+t.height-(n.bottom-n.top))-n.top;let r=t.left;return t=t.left+t.width-s,e.RTL?r=Math.min(t,r):t=Math.max(r,t),!(!(e=li(r,n.left,t)-n.left)&&!o||(i.moveBy(e,o,["inbounds"]),0))},Mo=function(e){return t=>{var i,n=e.getMetricsManager();if(n.hasFixedEdges()&&!e.isDragging())if(la.includes(null!=(i=t.type)?i:"")){i=n.getScrollMetrics(!0);const s=Po(e,t);s&&(n=Hr.getGroup$$module$build$src$core$events$utils()||!1,Hr.setGroup$$module$build$src$core$events$utils(t.group),Do(e,i,s)&&!t.group&&console.warn("Moved object in bounds but there was no event group. This may break undo."),Hr.setGroup$$module$build$src$core$events$utils(n))}else t.type===na&&t.scale&&t.oldScale&&t.scale>t.oldScale&&Bo(e)}},Po=function(e,t){let i=null;switch(t.type){case Hr.CREATE$$module$build$src$core$events$utils:case Hr.MOVE$$module$build$src$core$events$utils:(i=e.getBlockById(t.blockId))&&(i=i.getRootBlock());break;case sa:case oa:i=e.getCommentById(t.commentId)}return i},Bo=function(e){var t=e.getMetricsManager();if(t.hasFixedEdges()&&!e.isDragging()){t=t.getScrollMetrics(!0);var i=e.getTopBoundedElements();for(let n,s=0;n=i[s];s++)Do(e,t,n)}},Fo=function(e){return void 0!==e.isDeletable&&void 0!==e.dispose&&void 0!==e.setDeleteStyle},Uo=function(e){const t=e.toCopyData();let i;return bp=t,Ip=null!=(i=e.workspace)?i:null,t},Ho=function(e,t,i){return e&&t?Go(e,t,i):bp&&Ip?Go(bp,Ip):null},Go=function(e,t,i){let n,s,o;return t=null!=(n=t.getRootWorkspace())?n:t,null!=(o=null==(s=a(Xr.PASTER,e.paster,!1))?void 0:s.paste(e,t,i))?o:null},Vo=function(e){const t=e.toCopyData();return t?Ho(t,e.workspace):null},jo=function(e){return void 0!==e.toCopyData},Wo=function(){Tp.registry.register({name:Ep.ESCAPE,preconditionFn:e=>!e.options.readOnly,callback:e=>(e.hideChaff(),!0),keyCodes:[Oh.ESC]})},Xo=function(){Tp.registry.register({name:Ep.DELETE,preconditionFn(e){const t=R();return!e.options.readOnly&&null!=t&&Fo(t)&&t.isDeletable()&&!ah.inProgress()},callback:(e,t)=>(t.preventDefault(),(e=R())instanceof ep?e.checkAndDelete():Fo(e)&&e.isDeletable()&&(Hr.setGroup$$module$build$src$core$events$utils(!0),e.dispose(),Hr.setGroup$$module$build$src$core$events$utils(!1)),!0),keyCodes:[Oh.DELETE,Oh.BACKSPACE]})},Yo=function(){const e=Tp.registry.createSerializedKey(Oh.C,[Oh.CTRL]),t=Tp.registry.createSerializedKey(Oh.C,[Oh.ALT]),i=Tp.registry.createSerializedKey(Oh.C,[Oh.META]);Tp.registry.register({name:Ep.COPY,preconditionFn(e){const t=R();return!e.options.readOnly&&!ah.inProgress()&&null!=t&&Fo(t)&&t.isDeletable()&&ys(t)&&t.isMovable()&&jo(t)},callback:(e,t)=>(t.preventDefault(),e.hideChaff(),!(!(t=R())||!jo(t)||(Cp=t.toCopyData(),kp=e,Op=ys(t)?t.getRelativeToSurfaceXY():null,!Cp))),keyCodes:[e,t,i]})},zo=function(){const e=Tp.registry.createSerializedKey(Oh.X,[Oh.CTRL]),t=Tp.registry.createSerializedKey(Oh.X,[Oh.ALT]),i=Tp.registry.createSerializedKey(Oh.X,[Oh.META]);Tp.registry.register({name:Ep.CUT,preconditionFn(e){const t=R();return!e.options.readOnly&&!ah.inProgress()&&null!=t&&Fo(t)&&t.isDeletable()&&ys(t)&&t.isMovable()&&!t.workspace.isFlyout},callback(e){const t=R();return t instanceof ep?(Cp=t.toCopyData(),kp=e,Op=t.getRelativeToSurfaceXY(),t.checkAndDelete(),!0):!!(Fo(t)&&t.isDeletable()&&jo(t))&&(Cp=t.toCopyData(),kp=e,Op=ys(t)?t.getRelativeToSurfaceXY():null,t.dispose(),!0)},keyCodes:[e,t,i]})},Ko=function(){const e=Tp.registry.createSerializedKey(Oh.V,[Oh.CTRL]),t=Tp.registry.createSerializedKey(Oh.V,[Oh.ALT]),i=Tp.registry.createSerializedKey(Oh.V,[Oh.META]);Tp.registry.register({name:Ep.PASTE,preconditionFn:e=>!e.options.readOnly&&!ah.inProgress(),callback(){if(!Cp||!kp)return!1;if(!Op)return!!Ho(Cp,kp);const{left:e,top:t,width:i,height:n}=kp.getMetricsManager().getViewMetrics(!0);if(new Tl(t,t+n,e,e+i).contains(Op.x,Op.y))return!!Ho(Cp,kp);const s=new cl(e+i/2,t+n/2);return!!Ho(Cp,kp,s)},keyCodes:[e,t,i]})},qo=function(){const e=Tp.registry.createSerializedKey(Oh.Z,[Oh.CTRL]),t=Tp.registry.createSerializedKey(Oh.Z,[Oh.ALT]),i=Tp.registry.createSerializedKey(Oh.Z,[Oh.META]);Tp.registry.register({name:Ep.UNDO,preconditionFn:e=>!e.options.readOnly&&!ah.inProgress(),callback:(e,t)=>(e.hideChaff(),e.undo(!1),t.preventDefault(),!0),keyCodes:[e,t,i]})},Jo=function(){const e=Tp.registry.createSerializedKey(Oh.Z,[Oh.SHIFT,Oh.CTRL]),t=Tp.registry.createSerializedKey(Oh.Z,[Oh.SHIFT,Oh.ALT]),i=Tp.registry.createSerializedKey(Oh.Z,[Oh.SHIFT,Oh.META]),n=Tp.registry.createSerializedKey(Oh.Y,[Oh.CTRL]);Tp.registry.register({name:Ep.REDO,preconditionFn:e=>!ah.inProgress()&&!e.options.readOnly,callback:(e,t)=>(e.hideChaff(),e.undo(!0),t.preventDefault(),!0),keyCodes:[e,t,i,n]})},Zo=function(){Wo(),Xo(),Yo(),zo(),Ko(),qo(),Jo()},Qo=function(e){const t=e.saveState();return e.getParameters().length?(t.parameters=e.getParameters().map((e=>e.saveState())),t):t},er=function(e,t,i,n){if(e=e.loadState(i,n),!i.parameters)return e;for(const[s,o]of i.parameters.entries())e.insertParameter(t.loadState(o,n),s);return e},tr=function(e){const t=Object.create(null),i=l(Xr.SERIALIZER,!0);for(const n in i){let s;const o=null==(s=i[n])?void 0:s.save(e);o&&(t[n]=o)}return t},ir=function(e,t,{recordUndo:i=!1}={}){var n=l(Xr.SERIALIZER,!0);if(n){n=Object.entries(n).sort(((e,t)=>t[1].priority-e[1].priority));var s=d();Hr.setRecordUndo$$module$build$src$core$events$utils(i),(i=Hr.getGroup$$module$build$src$core$events$utils())||Hr.setGroup$$module$build$src$core$events$utils(!0),le(),t instanceof Fd&&t.setResizesEnabled(!1);for(const[,e]of n.reverse()){let i;null==(i=e)||i.clear(t)}for(const[i,s]of n.reverse())if(e[i]){let n;null==(n=s)||n.load(e[i],t)}t instanceof Fd&&t.setResizesEnabled(!0),ce(),p(new(y(ra))(t)),Hr.setGroup$$module$build$src$core$events$utils(i),Hr.setRecordUndo$$module$build$src$core$events$utils(s)}},nr=function(e,t){let i=null;var n;if(i="string"==typeof e?document.getElementById(e)||document.querySelector(e):e,!document.contains(i)&&document!==(null==(n=i)?void 0:n.ownerDocument))throw Error("Error: container is not in current document");e=new dh(t||{}),n=document.createElement("div"),te(n,"injectionDiv"),null!=t&&t.rtl&&te(n,"blocklyRTL"),n.tabIndex=0,$t(n,Oc.LABEL,Hr.Msg$$module$build$src$core$msg.WORKSPACE_ARIA_LABEL),i.appendChild(n),t=sr(n,e);const s=or(n,t,e);return rr(s),S(s),x(s),n.addEventListener("focusin",(function(){S(s)})),s},sr=function(e,t){e.setAttribute("dir","LTR"),Q(t.hasCss,t.pathToMedia),e=ee(_l.SVG,{xmlns:ul,"xmlns:html":hl,"xmlns:xlink":dl,version:"1.1",class:"blocklySvg",tabindex:"0"},e);const i=ee(_l.DEFS,{},e),n=String(Math.random()).substring(2);return t.gridPattern=lh.createDom(n,t.gridOptions,i),e},or=function(e,t,i){i.parentWorkspace=null;const n=(i=new Fd(i)).options;i.scale=n.zoomOptions.startScale,t.appendChild(i.createDom("blocklyMainBackground",e));var s=i.getRenderer().getClassName();return s&&te(e,s),(s=i.getTheme().getClassName())&&te(e,s),!n.hasCategories&&n.languageTree&&(e=i.addFlyout(_l.SVG),re(e,t)),n.hasTrashcan&&i.addTrashcan(),n.zoomOptions&&n.zoomOptions.controls&&i.addZoomControls(),i.getThemeManager().subscribe(t,"workspaceBackgroundColour","background-color"),i.translate(0,0),i.addChangeListener(Mo(i)),x(i),yn(),ci(),ji(),i},rr=function(e){const t=e.options;var i=e.getParentSvg();if(j(i.parentNode,"contextmenu",null,(function(e){Y(e)||e.preventDefault()})),i=j(window,"resize",null,(function(){Ji(),e.hideComponents(!0),Ri(),xn(),x(e),Bo(e)})),e.setResizeHandlerWrapper(i),lr(),t.languageTree){i=e.getToolbox();const n=e.getFlyout(!0);i?i.init():n&&(n.init(e),n.show(t.languageTree),"function"==typeof n.scrollToStart&&n.scrollToStart())}t.hasTrashcan&&e.trashcan.init(),t.zoomOptions&&t.zoomOptions.controls&&e.zoomControls_.init(),t.moveOptions&&t.moveOptions.scrollbars?(e.scrollbar=new xp(e,!0===t.moveOptions.scrollbars||!!t.moveOptions.scrollbars.horizontal,!0===t.moveOptions.scrollbars||!!t.moveOptions.scrollbars.vertical,"blocklyMainWorkspaceScrollbar"),e.scrollbar.resize()):e.setMetrics({x:.5,y:.5}),t.hasSounds&&cr(t.pathToMedia,e)},ar=function(e){const t=A();t&&!(Y(e)||t.rendered&&!t.isVisible())&&Tp.registry.onKeyDown(t,e)},lr=function(){qp||(j(document,"scroll",null,(function(){const e=k();for(let t,i=0;t=e[i];i++)t instanceof Fd&&t.updateInverseScreenCTM()})),j(document,"keydown",null,ar),W(document,"touchend",null,F),W(document,"touchcancel",null,F),za&&j(window,"orientationchange",document,(function(){x(A())}))),qp=!0},cr=function(e,t){function i(){for(;s.length;){const e=s.pop();e&&X(e)}n.preload()}const n=t.getAudioManager();n.load([e+"click.mp3",e+"click.wav",e+"click.ogg"],"click"),n.load([e+"disconnect.wav",e+"disconnect.mp3",e+"disconnect.ogg"],"disconnect"),n.load([e+"delete.mp3",e+"delete.ogg",e+"delete.wav"],"delete");const s=[];s.push(j(document,"pointermove",null,i,!0)),s.push(j(document,"touchstart",null,i,!0))},ur=function(){Xu.registry.register({displayText:()=>Hr.Msg$$module$build$src$core$msg.UNDO,preconditionFn:e=>0<e.workspace.getUndoStack().length?"enabled":"disabled",callback(e){e.workspace.undo(!1)},scopeType:Xu.ScopeType.WORKSPACE,id:"undoWorkspace",weight:1})},hr=function(){Xu.registry.register({displayText:()=>Hr.Msg$$module$build$src$core$msg.REDO,preconditionFn:e=>0<e.workspace.getRedoStack().length?"enabled":"disabled",callback(e){e.workspace.undo(!0)},scopeType:Xu.ScopeType.WORKSPACE,id:"redoWorkspace",weight:2})},dr=function(){Xu.registry.register({displayText:()=>Hr.Msg$$module$build$src$core$msg.CLEAN_UP,preconditionFn:e=>e.workspace.isMovable()?1<e.workspace.getTopBlocks(!1).length?"enabled":"disabled":"hidden",callback(e){e.workspace.cleanUp()},scopeType:Xu.ScopeType.WORKSPACE,id:"cleanWorkspace",weight:3})},pr=function(e,t){function i(t){s--,t.setCollapsed(e),0===s&&Hr.setGroup$$module$build$src$core$events$utils(!1)}let n=0,s=0;Hr.setGroup$$module$build$src$core$events$utils(!0);for(let e=0;e<t.length;e++){let o=t[e];for(;o;)s++,setTimeout(i.bind(null,o),n),o=o.getNextBlock(),n+=10}},gr=function(){Xu.registry.register({displayText:()=>Hr.Msg$$module$build$src$core$msg.COLLAPSE_ALL,preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let t=0;t<e.length;t++){let i=e[t];for(;i;){if(!i.isCollapsed())return"enabled";i=i.getNextBlock()}}return"disabled"}return"hidden"},callback(e){pr(!0,e.workspace.getTopBlocks(!0))},scopeType:Xu.ScopeType.WORKSPACE,id:"collapseWorkspace",weight:4})},mr=function(){Xu.registry.register({displayText:()=>Hr.Msg$$module$build$src$core$msg.EXPAND_ALL,preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let t=0;t<e.length;t++){let i=e[t];for(;i;){if(i.isCollapsed())return"enabled";i=i.getNextBlock()}}return"disabled"}return"hidden"},callback(e){pr(!1,e.workspace.getTopBlocks(!0))},scopeType:Xu.ScopeType.WORKSPACE,id:"expandWorkspace",weight:5})},fr=function(e,t){if(e.isDeletable())Array.prototype.push.apply(t,e.getDescendants(!1));else{e=e.getChildren(!1);for(let i=0;i<e.length;i++)fr(e[i],t)}},_r=function(e){const t=[];e=e.getTopBlocks(!0);for(let i=0;i<e.length;i++)fr(e[i],t);return t},Tr=function(e,t){t?Hr.setGroup$$module$build$src$core$events$utils(t):(Hr.setGroup$$module$build$src$core$events$utils(!0),t=Hr.getGroup$$module$build$src$core$events$utils());const i=e.shift();i&&(i.isDeadOrDying()?Tr(e,t):(i.dispose(!1,!0),setTimeout(Tr,10,e,t))),Hr.setGroup$$module$build$src$core$events$utils(!1)},Er=function(){Xu.registry.register({displayText:e=>e.workspace?1===(e=_r(e.workspace).length)?Hr.Msg$$module$build$src$core$msg.DELETE_BLOCK:Hr.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`):"",preconditionFn:e=>e.workspace&&0<_r(e.workspace).length?"enabled":"disabled",callback(e){if(e.workspace){e.workspace.cancelCurrentGesture();var t=_r(e.workspace);2>t.length?Tr(t):Ye(Hr.Msg$$module$build$src$core$msg.DELETE_ALL_BLOCKS.replace("%1",String(t.length)),(function(e){e&&Tr(t)}))}},scopeType:Xu.ScopeType.WORKSPACE,id:"workspaceDelete",weight:6})},br=function(){ur(),hr(),dr(),gr(),mr(),Er()},Ir=function(){Xu.registry.register({displayText:()=>Hr.Msg$$module$build$src$core$msg.DUPLICATE_BLOCK,preconditionFn:e=>!(e=e.block).isInFlyout&&e.isDeletable()&&e.isMovable()?e.isDuplicatable()?"enabled":"disabled":"hidden",callback(e){if(e.block){var t=e.block.toCopyData();t&&Ho(t,e.block.workspace)}},scopeType:Xu.ScopeType.BLOCK,id:"blockDuplicate",weight:1})},yr=function(){Xu.registry.register({displayText:e=>e.block.hasIcon($h.TYPE)?Hr.Msg$$module$build$src$core$msg.REMOVE_COMMENT:Hr.Msg$$module$build$src$core$msg.ADD_COMMENT,preconditionFn:e=>!(e=e.block).isInFlyout&&e.workspace.options.comments&&!e.isCollapsed()&&e.isEditable()?"enabled":"hidden",callback(e){(e=e.block).hasIcon($h.TYPE)?e.setCommentText(null):e.setCommentText("")},scopeType:Xu.ScopeType.BLOCK,id:"blockComment",weight:2})},vr=function(){Xu.registry.register({displayText:e=>e.block.getInputsInline()?Hr.Msg$$module$build$src$core$msg.EXTERNAL_INPUTS:Hr.Msg$$module$build$src$core$msg.INLINE_INPUTS,preconditionFn(e){if(!(e=e.block).isInFlyout&&e.isMovable()&&!e.isCollapsed())for(let t=1;t<e.inputList.length;t++)if(!(e.inputList[t-1]instanceof Hp||e.inputList[t]instanceof Hp))return"enabled";return"hidden"},callback(e){e.block.setInputsInline(!e.block.getInputsInline())},scopeType:Xu.ScopeType.BLOCK,id:"blockInline",weight:3})},Cr=function(){Xu.registry.register({displayText:e=>e.block.isCollapsed()?Hr.Msg$$module$build$src$core$msg.EXPAND_BLOCK:Hr.Msg$$module$build$src$core$msg.COLLAPSE_BLOCK,preconditionFn:e=>!(e=e.block).isInFlyout&&e.isMovable()&&e.workspace.options.collapse?"enabled":"hidden",callback(e){e.block.setCollapsed(!e.block.isCollapsed())},scopeType:Xu.ScopeType.BLOCK,id:"blockCollapseExpand",weight:4})},kr=function(){Xu.registry.register({displayText:e=>e.block.hasDisabledReason(Yl)?Hr.Msg$$module$build$src$core$msg.ENABLE_BLOCK:Hr.Msg$$module$build$src$core$msg.DISABLE_BLOCK,preconditionFn(e){if(!(e=e.block).isInFlyout&&e.workspace.options.disable&&e.isEditable()){var t=e.getDisabledReasons();return t=t.size>(t.has(Yl)?1:0),e.getInheritedDisabled()||t?"disabled":"enabled"}return"hidden"},callback(e){e=e.block;const t=Hr.getGroup$$module$build$src$core$events$utils();t||Hr.setGroup$$module$build$src$core$events$utils(!0),e.setDisabledReason(!e.hasDisabledReason(Yl),Yl),Hr.setGroup$$module$build$src$core$events$utils(t)},scopeType:Xu.ScopeType.BLOCK,id:"blockDisable",weight:5})},Or=function(){Xu.registry.register({displayText(e){var t=e.block;return e=t.getDescendants(!1).length,(t=t.getNextBlock())&&(e-=t.getDescendants(!1).length),1===e?Hr.Msg$$module$build$src$core$msg.DELETE_BLOCK:Hr.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`)},preconditionFn:e=>!e.block.isInFlyout&&e.block.isDeletable()?"enabled":"hidden",callback(e){e.block&&e.block.checkAndDelete()},scopeType:Xu.ScopeType.BLOCK,id:"blockDelete",weight:6})},Nr=function(){Xu.registry.register({displayText:()=>Hr.Msg$$module$build$src$core$msg.HELP,preconditionFn:e=>("function"==typeof(e=e.block).helpUrl?e.helpUrl():e.helpUrl)?"enabled":"hidden",callback(e){e.block.showHelp()},scopeType:Xu.ScopeType.BLOCK,id:"blockHelp",weight:7})},Ar=function(){Xu.registry.register({displayText:()=>Hr.Msg$$module$build$src$core$msg.REMOVE_COMMENT,preconditionFn(e){let t;return null!=(t=e.comment)&&t.isDeletable()?"enabled":"hidden"},callback(e){let t;Hr.setGroup$$module$build$src$core$events$utils(!0),null==(t=e.comment)||t.dispose(),Hr.setGroup$$module$build$src$core$events$utils(!1)},scopeType:Xu.ScopeType.COMMENT,id:"commentDelete",weight:6})},Sr=function(){Xu.registry.register({displayText:()=>Hr.Msg$$module$build$src$core$msg.DUPLICATE_COMMENT,preconditionFn(e){let t;return null!=(t=e.comment)&&t.isMovable()?"enabled":"hidden"},callback(e){if(e.comment){var t=e.comment.toCopyData();t&&Ho(t,e.comment.workspace)}},scopeType:Xu.ScopeType.COMMENT,id:"commentDuplicate",weight:1})},Rr=function(){Xu.registry.register({displayText:()=>Hr.Msg$$module$build$src$core$msg.ADD_COMMENT,preconditionFn:()=>"enabled",callback:(e,t)=>{if(e=e.workspace){Hr.setGroup$$module$build$src$core$events$utils(!0);var i=new Ku(e);i.setText(Hr.Msg$$module$build$src$core$msg.WORKSPACE_COMMENT_DEFAULT_TEXT),i.moveTo(wr(new cl(t.clientX,t.clientY),e)),Hr.setSelected$$module$build$src$core$common(i),Hr.setGroup$$module$build$src$core$events$utils(!1)}},scopeType:Xu.ScopeType.WORKSPACE,id:"commentCreate",weight:8})},wr=function(e,t){var i=t.getInjectionDiv().getBoundingClientRect();return e=new cl(e.x-i.left,e.y-i.top),i=t.getOriginOffsetInPixels(),(e=cl.difference(e,i)).scale(1/t.scale),e},Lr=function(){Ir(),yr(),vr(),Cr(),kr(),Or(),Nr()},xr=function(){Sr(),Ar(),Rr()},$r=function(){br(),Lr()},Dr=function(e){return void 0!==e.paste},Mr=function(e){return void 0!==e.getSvgRoot},Pr=function(e){return"string"==typeof e.id&&void 0!==e.workspace&&void 0!==e.select&&void 0!==e.unselect},Br=function(e){return e.isSelectable()},Fr=function(e){A().hideChaff(e)},(Ur=Ur||{}).scope={},Ur.ASSUME_ES5=!1,Ur.ASSUME_NO_NATIVE_MAP=!1,Ur.ASSUME_NO_NATIVE_SET=!1,Ur.SIMPLE_FROUND_POLYFILL=!1,Ur.ISOLATE_POLYFILLS=!1,Ur.FORCE_POLYFILL_PROMISE=!1,Ur.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,Ur.defineProperty=Ur.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){return e==Array.prototype||e==Object.prototype||(e[t]=i.value),e},Ur.getGlobal=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof e&&e];for(var i=0;i<t.length;++i){var n=t[i];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")},Ur.global=Ur.getGlobal(this),Ur.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),Ur.TRUST_ES6_POLYFILLS=!Ur.ISOLATE_POLYFILLS||Ur.IS_SYMBOL_NATIVE,Ur.polyfills={},Ur.propertyToPolyfillSymbol={},Ur.POLYFILL_PREFIX="$jscp$",Ur.polyfill=function(e,t,i,n){t&&(Ur.ISOLATE_POLYFILLS?Ur.polyfillIsolated(e,t,i,n):Ur.polyfillUnisolated(e,t,i,n))},Ur.polyfillUnisolated=function(e,t,i,n){for(i=Ur.global,e=e.split("."),n=0;n<e.length-1;n++){var s=e[n];if(!(s in i))return;i=i[s]}(t=t(n=i[e=e[e.length-1]]))!=n&&null!=t&&Ur.defineProperty(i,e,{configurable:!0,writable:!0,value:t})},Ur.polyfillIsolated=function(e,t,i,n){var s=e.split(".");e=1===s.length,n=s[0],n=!e&&n in Ur.polyfills?Ur.polyfills:Ur.global;for(var o=0;o<s.length-1;o++){var r=s[o];if(!(r in n))return;n=n[r]}s=s[s.length-1],null!=(t=t(i=Ur.IS_SYMBOL_NATIVE&&"es6"===i?n[s]:null))&&(e?Ur.defineProperty(Ur.polyfills,s,{configurable:!0,writable:!0,value:t}):t!==i&&(void 0===Ur.propertyToPolyfillSymbol[s]&&(i=1e9*Math.random()>>>0,Ur.propertyToPolyfillSymbol[s]=Ur.IS_SYMBOL_NATIVE?Ur.global.Symbol(s):Ur.POLYFILL_PREFIX+i+"$"+s),Ur.defineProperty(n,Ur.propertyToPolyfillSymbol[s],{configurable:!0,writable:!0,value:t})))},Ur.underscoreProtoCanBeSet=function(){var e={};try{return e.__proto__={a:!0},e.a}catch(e){}return!1},Ur.setPrototypeOf=Ur.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:Ur.underscoreProtoCanBeSet()?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null,Ur.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},Ur.arrayIterator=function(e){return{next:Ur.arrayIteratorImpl(e)}},Ur.makeIterator=function(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];if(t)return t.call(e);if("number"==typeof e.length)return Ur.arrayIterator(e);throw Error(String(e)+" is not an iterable or ArrayLike")},Ur.generator={},Ur.generator.ensureIteratorResultIsObject_=function(e){if(!(e instanceof Object))throw new TypeError("Iterator result "+e+" is not an object")},Ur.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},Ur.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},Ur.generator.Context.prototype.stop_=function(){this.isRunning_=!1},Ur.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},Ur.generator.Context.prototype.next_=function(e){this.yieldResult=e},Ur.generator.Context.prototype.throw_=function(e){this.abruptCompletion_={exception:e,isException:!0},this.jumpToErrorHandler_()},Ur.generator.Context.prototype.return=function(e){this.abruptCompletion_={return:e},this.nextAddress=this.finallyAddress_},Ur.generator.Context.prototype.jumpThroughFinallyBlocks=function(e){this.abruptCompletion_={jumpTo:e},this.nextAddress=this.finallyAddress_},Ur.generator.Context.prototype.yield=function(e,t){return this.nextAddress=t,{value:e}},Ur.generator.Context.prototype.yieldAll=function(e,t){var i=(e=Ur.makeIterator(e)).next();if(Ur.generator.ensureIteratorResultIsObject_(i),!i.done)return this.yieldAllIterator_=e,this.yield(i.value,t);this.yieldResult=i.value,this.nextAddress=t},Ur.generator.Context.prototype.jumpTo=function(e){this.nextAddress=e},Ur.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},Ur.generator.Context.prototype.setCatchFinallyBlocks=function(e,t){this.catchAddress_=e,null!=t&&(this.finallyAddress_=t)},Ur.generator.Context.prototype.setFinallyBlock=function(e){this.catchAddress_=0,this.finallyAddress_=e||0},Ur.generator.Context.prototype.leaveTryBlock=function(e,t){this.nextAddress=e,this.catchAddress_=t||0},Ur.generator.Context.prototype.enterCatchBlock=function(e){return this.catchAddress_=e||0,e=this.abruptCompletion_.exception,this.abruptCompletion_=null,e},Ur.generator.Context.prototype.enterFinallyBlock=function(e,t,i){i?this.finallyContexts_[i]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=e||0,this.finallyAddress_=t||0},Ur.generator.Context.prototype.leaveFinallyBlock=function(e,t){if(t=this.finallyContexts_.splice(t||0)[0],t=this.abruptCompletion_=this.abruptCompletion_||t){if(t.isException)return this.jumpToErrorHandler_();null!=t.jumpTo&&this.finallyAddress_<t.jumpTo?(this.nextAddress=t.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=e},Ur.generator.Context.prototype.forIn=function(e){return new Ur.generator.Context.PropertyIterator(e)},Ur.generator.Context.PropertyIterator=function(e){for(var t in this.object_=e,this.properties_=[],e)this.properties_.push(t);this.properties_.reverse()},Ur.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var e=this.properties_.pop();if(e in this.object_)return e}return null},Ur.generator.Engine_=function(e){this.context_=new Ur.generator.Context,this.program_=e},Ur.generator.Engine_.prototype.next_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,e,this.context_.next_):(this.context_.next_(e),this.nextStep_())},Ur.generator.Engine_.prototype.return_=function(e){this.context_.start_();var t=this.context_.yieldAllIterator_;return t?this.yieldAllStep_("return"in t?t.return:function(e){return{value:e,done:!0}},e,this.context_.return):(this.context_.return(e),this.nextStep_())},Ur.generator.Engine_.prototype.throw_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.throw,e,this.context_.next_):(this.context_.throw_(e),this.nextStep_())},Ur.generator.Engine_.prototype.yieldAllStep_=function(e,t,i){try{var n=e.call(this.context_.yieldAllIterator_,t);if(Ur.generator.ensureIteratorResultIsObject_(n),!n.done)return this.context_.stop_(),n;var s=n.value}catch(e){return this.context_.yieldAllIterator_=null,this.context_.throw_(e),this.nextStep_()}return this.context_.yieldAllIterator_=null,i.call(this.context_,s),this.nextStep_()},Ur.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var e=this.program_(this.context_);if(e)return this.context_.stop_(),{value:e.value,done:!1}}catch(e){this.context_.yieldResult=void 0,this.context_.throw_(e)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(e=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,e.isException)throw e.exception;return{value:e.return,done:!0}}return{value:void 0,done:!0}},Ur.generator.Generator_=function(e){this.next=function(t){return e.next_(t)},this.throw=function(t){return e.throw_(t)},this.return=function(t){return e.return_(t)},this[Symbol.iterator]=function(){return this}},Ur.generator.createGenerator=function(e,t){return t=new Ur.generator.Generator_(new Ur.generator.Engine_(t)),Ur.setPrototypeOf&&e.prototype&&Ur.setPrototypeOf(t,e.prototype),t},Ur.asyncExecutePromiseGenerator=function(e){function t(t){return e.next(t)}function i(t){return e.throw(t)}return new Promise((function(n,s){!function e(o){o.done?n(o.value):Promise.resolve(o.value).then(t,i).then(e,s)}(e.next())}))},Ur.asyncExecutePromiseGeneratorFunction=function(e){return Ur.asyncExecutePromiseGenerator(e())},Ur.asyncExecutePromiseGeneratorProgram=function(e){return Ur.asyncExecutePromiseGenerator(new Ur.generator.Generator_(new Ur.generator.Engine_(e)))},Ur.polyfill("globalThis",(function(e){return e||Ur.global}),"es_2020","es3"),Ur.polyfill("Array.prototype.includes",(function(e){return e||function(e,t){var i=this;i instanceof String&&(i=String(i));var n=i.length;for(0>(t=t||0)&&(t=Math.max(t+n,0));t<n;t++){var s=i[t];if(s===e||Object.is(s,e))return!0}return!1}}),"es7","es3"),Ur.initSymbol=function(){},Ur.iteratorPrototype=function(e){return(e={next:e})[Symbol.iterator]=function(){return this},e},Ur.iteratorFromArray=function(e,t){e instanceof String&&(e+="");var i=0,n=!1,s={next:function(){if(!n&&i<e.length){var s=i++;return{value:t(s,e[s]),done:!1}}return n=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s},Ur.polyfill("Array.prototype.values",(function(e){return e||function(){return Ur.iteratorFromArray(this,(function(e,t){return t}))}}),"es8","es3"),Ur.polyfill("Array.prototype.flat",(function(e){return e||function(e){e=void 0===e?1:e;var t=[];return Array.prototype.forEach.call(this,(function(i){Array.isArray(i)&&0<e?(i=Array.prototype.flat.call(i,e-1),t.push.apply(t,i)):t.push(i)})),t}}),"es9","es5"),Ur.polyfill("Array.prototype.flatMap",(function(e){return e||function(e,t){var i=[];return Array.prototype.forEach.call(this,(function(n,s){n=e.call(t,n,s,this),Array.isArray(n)?i.push.apply(i,n):i.push(n)})),i}}),"es9","es5"),Ur.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},Ur.polyfill("Object.entries",(function(e){return e||function(e){var t,i=[];for(t in e)Ur.owns(e,t)&&i.push([t,e[t]]);return i}}),"es8","es3"),Ur.polyfill("Object.values",(function(e){return e||function(e){var t,i=[];for(t in e)Ur.owns(e,t)&&i.push(e[t]);return i}}),"es8","es3");var Gr=Object.create(null),Vr={typeMap:Gr},jr=Object.create(null),Wr="default",Xr=class{constructor(e){this.name=e}toString(){return this.name}};Xr.CONNECTION_CHECKER=new Xr("connectionChecker"),Xr.CONNECTION_PREVIEWER=new Xr("connectionPreviewer"),Xr.CURSOR=new Xr("cursor"),Xr.EVENT=new Xr("event"),Xr.FIELD=new Xr("field"),Xr.INPUT=new Xr("input"),Xr.RENDERER=new Xr("renderer"),Xr.TOOLBOX=new Xr("toolbox"),Xr.THEME=new Xr("theme"),Xr.TOOLBOX_ITEM=new Xr("toolboxItem"),Xr.FLYOUTS_VERTICAL_TOOLBOX=new Xr("flyoutsVerticalToolbox"),Xr.FLYOUTS_HORIZONTAL_TOOLBOX=new Xr("flyoutsHorizontalToolbox"),Xr.METRICS_MANAGER=new Xr("metricsManager"),Xr.BLOCK_DRAGGER=new Xr("blockDragger"),Xr.SERIALIZER=new Xr("serializer"),Xr.ICON=new Xr("icon"),Xr.PASTER=new Xr("paster");var Yr={DEFAULT:Wr,TEST_ONLY:Vr};Yr.Type=Xr,Yr.getAllItems=l,Yr.getClass=r,Yr.getClassFromOptions=c,Yr.getObject=a,Yr.hasItem=o,Yr.register=t,Yr.unregister=n;var zr,Kr,qr,Jr,Zr,Qr,ea,ta,ia,na,sa,oa,ra,aa,la,ca,ua,ha,da=Object.create(null),pa={genUid:()=>{const e="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".length,t=[];for(let i=0;20>i;i++)t[i]="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.random()*e);return t.join("")}},ga=0,ma={TEST_ONLY:pa};ma.genUid=h,ma.getNextUniqueId=u,zr="",Kr=!0,qr=0,Hr.CREATE$$module$build$src$core$events$utils="create",Hr.CREATE$$module$build$src$core$events$utils,Hr.DELETE$$module$build$src$core$events$utils="delete",Hr.DELETE$$module$build$src$core$events$utils,Hr.CHANGE$$module$build$src$core$events$utils="change",Hr.CHANGE$$module$build$src$core$events$utils,Jr="block_field_intermediate_change",Hr.MOVE$$module$build$src$core$events$utils="move",Hr.MOVE$$module$build$src$core$events$utils,Zr="var_create",Qr="ui",ea="selected",ta="click",ia="bubble_open",na="viewport_change",sa="comment_create",oa="comment_move",ra="finished_loading",aa="ORPHANED_BLOCK",la=[Hr.CREATE$$module$build$src$core$events$utils,Hr.MOVE$$module$build$src$core$events$utils,sa,oa],ua={FIRE_QUEUE:ca=[],fireNow:m,fireInternal:g,setGroupInternal:E},(ha={BLOCK_CHANGE:Hr.CHANGE$$module$build$src$core$events$utils,BLOCK_CREATE:Hr.CREATE$$module$build$src$core$events$utils,BLOCK_DELETE:Hr.DELETE$$module$build$src$core$events$utils,BLOCK_DRAG:"drag",BLOCK_FIELD_INTERMEDIATE_CHANGE:Jr,BLOCK_MOVE:Hr.MOVE$$module$build$src$core$events$utils,BUBBLE_OPEN:ia,BUMP_EVENTS:la,CHANGE:Hr.CHANGE$$module$build$src$core$events$utils,CLICK:ta,COMMENT_CHANGE:"comment_change",COMMENT_COLLAPSE:"comment_collapse",COMMENT_CREATE:sa,COMMENT_DELETE:"comment_delete",COMMENT_MOVE:oa,CREATE:Hr.CREATE$$module$build$src$core$events$utils,DELETE:Hr.DELETE$$module$build$src$core$events$utils,FINISHED_LOADING:ra,MARKER_MOVE:"marker_move",MOVE:Hr.MOVE$$module$build$src$core$events$utils,SELECTED:ea,TEST_ONLY:ua,THEME_CHANGE:"theme_change",TOOLBOX_ITEM_SELECT:"toolbox_item_select",TRASHCAN_OPEN:"trashcan_open",UI:Qr,VAR_CREATE:Zr,VAR_DELETE:"var_delete",VAR_RENAME:"var_rename",VIEWPORT_CHANGE:na}).clearPendingUndo=_,ha.disable=Hr.disable$$module$build$src$core$events$utils,ha.disableOrphans=v,ha.enable=Hr.enable$$module$build$src$core$events$utils,ha.filter=f,ha.fire=p,ha.fromJson=I,ha.get=y,ha.getDescendantIds=b,ha.getGroup=Hr.getGroup$$module$build$src$core$events$utils,ha.getRecordUndo=d,ha.isEnabled=T,ha.setGroup=Hr.setGroup$$module$build$src$core$events$utils,ha.setRecordUndo=Hr.setRecordUndo$$module$build$src$core$events$utils;var fa,_a,Ta=Object.create(null),Ea=null,ba=[],Ia={defineBlocksWithJsonArrayInternal:P},ya={TEST_ONLY:Ia};ya.createBlockDefinitionsFromJsonArray=Hr.createBlockDefinitionsFromJsonArray$$module$build$src$core$common,ya.defineBlocks=Hr.defineBlocks$$module$build$src$core$common,ya.defineBlocksWithJsonArray=M,ya.draggingConnections=ba,ya.getAllWorkspaces=k,ya.getBlockTypeCounts=$,ya.getMainWorkspace=A,ya.getParentContainer=w,ya.getSelected=R,ya.getWorkspaceById=C,ya.registerWorkspace=O,ya.setMainWorkspace=S,ya.setParentContainer=L,ya.setSelected=Hr.setSelected$$module$build$src$core$common,ya.svgResize=x,ya.unregisterWorkpace=N;var va,Ca,ka=class{constructor(){this.workspaceId=void 0,this.isUiEvent=!1,this.type="",this.group=Hr.getGroup$$module$build$src$core$events$utils(),this.recordUndo=d()}toJson(){return{type:this.type,group:this.group}}static fromJson(e,t,i){return i.isBlank=!1,i.group=e.group||"",i.workspaceId=t.id,i}isNull(){return!1}run(e){}getEventWorkspace_(){let e;if(this.workspaceId&&(e=C(this.workspaceId)),!e)throw Error("Workspace is null. Event must have been generated from real Blockly events.");return e}},Oa=class extends ka{constructor(e){super(),this.recordUndo=!1,this.isUiEvent=!0,this.isBlank=void 0===e,this.workspaceId=e||""}},Na=class extends Oa{constructor(e,t,i){null===(t=e?e.workspace.id:t)&&(t=void 0),super(t),this.type=ta,this.blockId=e?e.id:void 0,this.targetType=i}toJson(){const e=super.toJson();if(!this.targetType)throw Error("The click target type is undefined. Either pass a block to the constructor, or call fromJson");return e.targetType=this.targetType,e.blockId=this.blockId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Na)).targetType=e.targetType,t.blockId=e.blockId,t}};(Ca=va||(va={})).BLOCK="block",Ca.WORKSPACE="workspace",Ca.ZOOM_CONTROLS="zoom_controls",t(Xr.EVENT,ta,Na);var Aa={};Aa.Click=Na,Aa.ClickTarget=va;var Sa,Ra,wa,La,xa,$a,Da,Ma,Pa,Ba,Fa=750,Ua="ontouchstart"in globalThis||!!(globalThis.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!globalThis.navigator||!globalThis.navigator.maxTouchPoints&&!globalThis.navigator.msMaxTouchPoints),Ha=null,Ga={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]},Va=0,ja={TOUCH_ENABLED:Ua,TOUCH_MAP:Ga};ja.checkTouchIdentifier=V,ja.clearTouchIdentifier=U,ja.getTouchIdentifierFromEvent=G,ja.longStart=B,ja.longStop=F,ja.shouldHandleEvent=H,function(e){function t(e){return i.includes(e.toUpperCase())}const i=(Sa=e).toUpperCase();Ra=t("JavaFX"),wa=t("WebKit"),La=t("Gecko")&&!wa,xa=t("Android"),e=globalThis.navigator&&globalThis.navigator.maxTouchPoints,$a=t("iPad")||t("Macintosh")&&0<e,Da=t("iPhone")&&!$a,Ma=t("Macintosh"),Pa=$a||xa&&!t("Mobile")||t("Silk"),Ba=!Pa&&(Da||xa)}(globalThis.navigator&&globalThis.navigator.userAgent||"");var Wa=Ra,Xa=La,Ya=xa,za=$a,Ka=Da,qa=Ma,Ja=Ba,Za={ANDROID:Ya,GECKO:Xa,IPAD:za,IPHONE:Ka,JavaFx:Wa,MAC:qa,MOBILE:Ja,raw:Sa},Qa=40,el=125,tl={};tl.bind=W,tl.conditionalBind=j,tl.getScrollDeltaPixels=q,tl.isRightButton=z,tl.isTargetInput=Y,tl.mouseToSvg=K,tl.unbind=X;var il={};il.removeElem=J;var nl=class{constructor(e){this.name_=e}toString(){return this.name_}};nl.POSITIONABLE=new nl("positionable"),nl.DRAG_TARGET=new nl("drag_target"),nl.DELETE_AREA=new nl("delete_area"),nl.AUTOHIDEABLE=new nl("autohideable");var sl=class{constructor(){this.componentData=new Map,this.capabilityToComponentIds=new Map}addComponent(e,t){const i=e.component.id;var n;if(!t&&this.componentData.has(i))throw Error('Plugin "'+i+'" with capabilities "'+(null==(n=this.componentData.get(i))?void 0:n.capabilities)+'" already added.');for(this.componentData.set(i,e),t=[],n=0;n<e.capabilities.length;n++){const s=String(e.capabilities[n]).toLowerCase();if(t.push(s),this.capabilityToComponentIds.has(s)){let e;null==(e=this.capabilityToComponentIds.get(s))||e.push(i)}else this.capabilityToComponentIds.set(s,[i])}this.componentData.get(i).capabilities=t}removeComponent(e){const t=this.componentData.get(e);if(t){for(let i=0;i<t.capabilities.length;i++){const n=String(t.capabilities[i]).toLowerCase();J(this.capabilityToComponentIds.get(n),e)}this.componentData.delete(e)}}addCapability(e,t){if(!this.getComponent(e))throw Error('Cannot add capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');var i,n;this.hasCapability(e,t)?console.warn('Plugin "'+e+'already has capability "'+t+'"'):(t=`${t}`.toLowerCase(),null==(i=this.componentData.get(e))||i.capabilities.push(t),null==(n=this.capabilityToComponentIds.get(t))||n.push(e))}removeCapability(e,t){if(!this.getComponent(e))throw Error('Cannot remove capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');this.hasCapability(e,t)?(t=`${t}`.toLowerCase(),J(this.componentData.get(e).capabilities,t),J(this.capabilityToComponentIds.get(t),e)):console.warn('Plugin "'+e+"doesn't have capability \""+t+'" to remove')}hasCapability(e,t){return t=`${t}`.toLowerCase(),this.componentData.has(e)&&this.componentData.get(e).capabilities.includes(t)}getComponent(e){let t;return null==(t=this.componentData.get(e))?void 0:t.component}getComponents(e,t){if(e=`${e}`.toLowerCase(),!(e=this.capabilityToComponentIds.get(e)))return[];const i=[];if(t){const t=[];e.forEach((e=>{t.push(this.componentData.get(e))})),t.sort((function(e,t){return e.weight-t.weight})),t.forEach((function(e){i.push(e.component)}))}else e.forEach((e=>{i.push(this.componentData.get(e).component)}));return i}};sl.Capability=nl;var ol=!1,rl='\n.blocklySvg {\n  background-color: #fff;\n  outline: none;\n  overflow: hidden;  /* IE overflows by default. */\n  position: absolute;\n  display: block;\n}\n\n.blocklyWidgetDiv {\n  display: none;\n  position: absolute;\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\n}\n\n.injectionDiv {\n  height: 100%;\n  position: relative;\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\n  touch-action: none;\n}\n\n.blocklyNonSelectable {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n}\n\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\n  transition: transform .5s;\n}\n\n.blocklyTooltipDiv {\n  background-color: #ffffc7;\n  border: 1px solid #ddc;\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\n  color: #000;\n  display: none;\n  font: 9pt sans-serif;\n  opacity: .9;\n  padding: 2px;\n  position: absolute;\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\n}\n\n.blocklyDropDownDiv {\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1000;\n  display: none;\n  border: 1px solid;\n  border-color: #dadce0;\n  background-color: #fff;\n  border-radius: 2px;\n  padding: 4px;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownContent {\n  max-height: 300px;  /* @todo: spec for maximum height. */\n  overflow: auto;\n  overflow-x: hidden;\n  position: relative;\n}\n\n.blocklyDropDownArrow {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 16px;\n  height: 16px;\n  z-index: -1;\n  background-color: inherit;\n  border-color: inherit;\n}\n\n.blocklyDropDownButton {\n  display: inline-block;\n  float: left;\n  padding: 0;\n  margin: 4px;\n  border-radius: 4px;\n  outline: none;\n  border: 1px solid;\n  transition: box-shadow .1s;\n  cursor: pointer;\n}\n\n.blocklyArrowTop {\n  border-top: 1px solid;\n  border-left: 1px solid;\n  border-top-left-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyArrowBottom {\n  border-bottom: 1px solid;\n  border-right: 1px solid;\n  border-bottom-right-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyResizeSE {\n  cursor: se-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeSW {\n  cursor: sw-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeLine {\n  stroke: #515A5A;\n  stroke-width: 1;\n}\n\n.blocklyHighlightedConnectionPath {\n  fill: none;\n  stroke: #fc3;\n  stroke-width: 4px;\n}\n\n.blocklyPathLight {\n  fill: none;\n  stroke-linecap: round;\n  stroke-width: 1;\n}\n\n.blocklySelected>.blocklyPathLight {\n  display: none;\n}\n\n.blocklyDraggable {\n  cursor: grab;\n  cursor: -webkit-grab;\n}\n\n.blocklyDragging {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n  /* Drag surface disables events to not block the toolbox, so we have to\n   * reenable them here for the cursor values to work. */\n  pointer-events: auto;\n}\n\n  /* Changes cursor on mouse down. Not effective in Firefox because of\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\n.blocklyDraggable:active {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n.blocklyDragging.blocklyDraggingDelete {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyDragging>.blocklyPath,\n.blocklyDragging>.blocklyPathLight {\n  fill-opacity: .8;\n  stroke-opacity: .8;\n}\n\n.blocklyDragging>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyDisabled>.blocklyPath {\n  fill-opacity: .5;\n  stroke-opacity: .5;\n}\n\n.blocklyDisabled>.blocklyPathLight,\n.blocklyDisabled>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyInsertionMarker>.blocklyPath,\n.blocklyInsertionMarker>.blocklyPathLight,\n.blocklyInsertionMarker>.blocklyPathDark {\n  fill-opacity: .2;\n  stroke: none;\n}\n\n.blocklyMultilineText {\n  font-family: monospace;\n}\n\n.blocklyNonEditableText>text {\n  pointer-events: none;\n}\n\n.blocklyFlyout {\n  position: absolute;\n  z-index: 20;\n}\n\n.blocklyText text {\n  cursor: default;\n}\n\n/*\n  Don\'t allow users to select text.  It gets annoying when trying to\n  drag a block and selected text moves instead.\n*/\n.blocklySvg text {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  cursor: inherit;\n}\n\n.blocklyHidden {\n  display: none;\n}\n\n.blocklyFieldDropdown:not(.blocklyHidden) {\n  display: block;\n}\n\n.blocklyIconGroup {\n  cursor: default;\n}\n\n.blocklyIconGroup:not(:hover),\n.blocklyIconGroupReadonly {\n  opacity: .6;\n}\n\n.blocklyIconShape {\n  fill: #00f;\n  stroke: #fff;\n  stroke-width: 1px;\n}\n\n.blocklyIconSymbol {\n  fill: #fff;\n}\n\n.blocklyMinimalBody {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n}\n\n.blocklyHtmlInput {\n  border: none;\n  border-radius: 4px;\n  height: 100%;\n  margin: 0;\n  outline: none;\n  padding: 0;\n  width: 100%;\n  text-align: center;\n  display: block;\n  box-sizing: border-box;\n}\n\n/* Remove the increase and decrease arrows on the field number editor */\ninput.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,\ninput.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\ninput[type=number] {\n  -moz-appearance: textfield;\n}\n\n.blocklyMainBackground {\n  stroke-width: 1;\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\n}\n\n.blocklyMutatorBackground {\n  fill: #fff;\n  stroke: #ddd;\n  stroke-width: 1;\n}\n\n.blocklyFlyoutBackground {\n  fill: #ddd;\n  fill-opacity: .8;\n}\n\n.blocklyMainWorkspaceScrollbar {\n  z-index: 20;\n}\n\n.blocklyFlyoutScrollbar {\n  z-index: 30;\n}\n\n.blocklyScrollbarHorizontal,\n.blocklyScrollbarVertical {\n  position: absolute;\n  outline: none;\n}\n\n.blocklyScrollbarBackground {\n  opacity: 0;\n}\n\n.blocklyScrollbarHandle {\n  fill: #ccc;\n}\n\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyScrollbarHandle:hover {\n  fill: #bbb;\n}\n\n/* Darken flyout scrollbars due to being on a grey background. */\n/* By contrast, workspace scrollbars are on a white background. */\n.blocklyFlyout .blocklyScrollbarHandle {\n  fill: #bbb;\n}\n\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyFlyout .blocklyScrollbarHandle:hover {\n  fill: #aaa;\n}\n\n.blocklyInvalidInput {\n  background: #faa;\n}\n\n.blocklyVerticalMarker {\n  stroke-width: 3px;\n  fill: rgba(255,255,255,.5);\n  pointer-events: none;\n}\n\n.blocklyComputeCanvas {\n  position: absolute;\n  width: 0;\n  height: 0;\n}\n\n.blocklyNoPointerEvents {\n  pointer-events: none;\n}\n\n.blocklyContextMenu {\n  border-radius: 4px;\n  max-height: 100%;\n}\n\n.blocklyDropdownMenu {\n  border-radius: 2px;\n  padding: 0 !important;\n}\n\n.blocklyDropdownMenu .blocklyMenuItem {\n  /* 28px on the left for icon or checkbox. */\n  padding-left: 28px;\n}\n\n/* BiDi override for the resting state. */\n.blocklyDropdownMenu .blocklyMenuItemRtl {\n  /* Flip left/right padding for BiDi. */\n  padding-left: 5px;\n  padding-right: 28px;\n}\n\n.blocklyWidgetDiv .blocklyMenu {\n  background: #fff;\n  border: 1px solid transparent;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n  font: normal 13px Arial, sans-serif;\n  margin: 0;\n  outline: none;\n  padding: 4px 0;\n  position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n.blocklyWidgetDiv .blocklyMenu.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv .blocklyMenu {\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  font: normal 13px "Helvetica Neue", Helvetica, sans-serif;\n  outline: none;\n  position: relative;  /* Compatibility with gapi, reset from goog-menu */\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n/* State: resting. */\n.blocklyMenuItem {\n  border: none;\n  color: #000;\n  cursor: pointer;\n  list-style: none;\n  margin: 0;\n  /* 7em on the right for shortcut. */\n  min-width: 7em;\n  padding: 6px 15px;\n  white-space: nowrap;\n}\n\n/* State: disabled. */\n.blocklyMenuItemDisabled {\n  color: #ccc;\n  cursor: inherit;\n}\n\n/* State: hover. */\n.blocklyMenuItemHighlight {\n  background-color: rgba(0,0,0,.1);\n}\n\n/* State: selected/checked. */\n.blocklyMenuItemCheckbox {\n  height: 16px;\n  position: absolute;\n  width: 16px;\n}\n\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\n  float: left;\n  margin-left: -24px;\n  position: static;  /* Scroll with the menu. */\n}\n\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\n  float: right;\n  margin-right: -24px;\n}\n\n.blocklyBlockDragSurface, .blocklyAnimationLayer {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: visible !important;\n  z-index: 80;\n  pointer-events: none;\n}\n',al={};al.inject=Q,al.register=Z;var ll,cl=class{constructor(e,t){this.x=e,this.y=t}clone(){return new cl(this.x,this.y)}scale(e){return this.x*=e,this.y*=e,this}translate(e,t){return this.x+=e,this.y+=t,this}static equals(e,t){return e===t||!(!e||!t)&&e.x===t.x&&e.y===t.y}static distance(e,t){const i=e.x-t.x;return e=e.y-t.y,Math.sqrt(i*i+e*e)}static magnitude(e){return Math.sqrt(e.x*e.x+e.y*e.y)}static difference(e,t){return new cl(e.x-t.x,e.y-t.y)}static sum(e,t){return new cl(e.x+t.x,e.y+t.y)}},ul="http://www.w3.org/2000/svg",hl="http://www.w3.org/1999/xhtml",dl="http://www.w3.org/1999/xlink";!function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE"}(ll||(ll={}));var pl=null,gl=0,ml=null,fl={HTML_NS:hl};fl.NodeType=ll,fl.SVG_NS=ul,fl.XLINK_NS=dl,fl.addClass=te,fl.createSvgElement=ee,fl.getFastTextWidth=he,fl.getFastTextWidthWithSizeString=de,fl.getTextWidth=ue,fl.hasClass=se,fl.insertAfter=re,fl.measureFontMetrics=pe,fl.removeClass=ne,fl.removeClasses=ie,fl.removeNode=oe,fl.setCssTransform=ae,fl.startTextWidthCache=le,fl.stopTextWidthCache=ce;var _l=class{constructor(e){this.tagName=e}toString(){return this.tagName}};_l.ANIMATE=new _l("animate"),_l.CIRCLE=new _l("circle"),_l.CLIPPATH=new _l("clipPath"),_l.DEFS=new _l("defs"),_l.FECOMPOSITE=new _l("feComposite"),_l.FECOMPONENTTRANSFER=new _l("feComponentTransfer"),_l.FEFLOOD=new _l("feFlood"),_l.FEFUNCA=new _l("feFuncA"),_l.FEGAUSSIANBLUR=new _l("feGaussianBlur"),_l.FEPOINTLIGHT=new _l("fePointLight"),_l.FESPECULARLIGHTING=new _l("feSpecularLighting"),_l.FILTER=new _l("filter"),_l.FOREIGNOBJECT=new _l("foreignObject"),_l.G=new _l("g"),_l.IMAGE=new _l("image"),_l.LINE=new _l("line"),_l.PATH=new _l("path"),_l.PATTERN=new _l("pattern"),_l.POLYGON=new _l("polygon"),_l.RECT=new _l("rect"),_l.SVG=new _l("svg"),_l.TEXT=new _l("text"),_l.TSPAN=new _l("tspan");var Tl=class{constructor(e,t,i,n){this.top=e,this.bottom=t,this.left=i,this.right=n}getHeight(){return this.bottom-this.top}getWidth(){return this.right-this.left}contains(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom}intersects(e){return!(this.left>e.right||this.right<e.left||this.top>e.bottom||this.bottom<e.top)}},El=class{constructor(e,t){this.width=e,this.height=t}static equals(e,t){return e===t||!(!e||!t)&&e.width===t.width&&e.height===t.height}static max(e,t){return new El(Math.max(e.width,t.width),Math.max(e.height,t.height))}static min(e,t){return new El(Math.min(e.width,t.width),Math.min(e.height,t.height))}},bl={getSizeInternal:me},Il={TEST_ONLY:bl};Il.getBorderBox=be,Il.getComputedStyle=_e,Il.getContainerOffsetToScrollInto=ye,Il.getPageOffset=Te,Il.getSize=ge,Il.getViewportPageOffset=Ee,Il.scrollIntoContainerView=Ie;var yl=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*)?/,vl=/transform:\s*translate(?:3d)?\(\s*([-+\d.e]+)\s*px([ ,]\s*([-+\d.e]+)\s*px)?/,Cl={TEST_ONLY:{XY_REGEX:yl,XY_STYLE_REGEX:vl}};Cl.getDocumentScroll=Oe,Cl.getInjectionDivXY=Ce,Cl.getRelativeXY=ve,Cl.getViewportBBox=ke,Cl.screenToWsCoordinates=Ne,Cl.wsToScreenCoordinates=Ae;var kl=class{constructor(e,t,i,n,s){this.workspace=e,this.horizontal=t,this.oldHostMetrics=null,this.ratio=1,this.origin=new cl(0,0),this.startDragHandle=this.handlePosition=this.handleLength=this.scrollbarLength=this.startDragMouse=0,this.containerVisible=this.isHandleVisible=!0,this.position=new cl(0,0),this.onMouseMoveWrapper_=this.onMouseUpWrapper_=null,this.pair=i||!1,this.margin=void 0!==s?s:kl.DEFAULT_SCROLLBAR_MARGIN,e="blocklyScrollbar"+(this.horizontal?"Horizontal":"Vertical"),n&&(e+=" "+n),this.outerSvg=ee(_l.SVG,{class:e}),n=ee(_l.G,{},this.outerSvg),this.svgBackground=ee(_l.RECT,{class:"blocklyScrollbarBackground"},n),e=Math.floor((kl.scrollbarThickness-5)/2),this.svgHandle=ee(_l.RECT,{class:"blocklyScrollbarHandle",rx:e,ry:e},n),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarColour","fill"),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarOpacity","fill-opacity"),re(this.outerSvg,this.workspace.getParentSvg()),this.setInitialThickness(),t?(this.lengthAttribute_="width",this.positionAttribute_="x"):(this.lengthAttribute_="height",this.positionAttribute_="y"),this.onMouseDownBarWrapper_=j(this.svgBackground,"pointerdown",this,this.onMouseDownBar),this.onMouseDownHandleWrapper_=j(this.svgHandle,"pointerdown",this,this.onMouseDownHandle)}setInitialThickness(){const e=kl.scrollbarThickness;this.horizontal?(this.svgBackground.setAttribute("height",String(e)),this.outerSvg.setAttribute("height",String(e)),this.svgHandle.setAttribute("height",String(e-5)),this.svgHandle.setAttribute("y","2.5")):(this.svgBackground.setAttribute("width",String(e)),this.outerSvg.setAttribute("width",String(e)),this.svgHandle.setAttribute("width",String(e-5)),this.svgHandle.setAttribute("x","2.5"))}dispose(){this.cleanUp(),X(this.onMouseDownBarWrapper_),X(this.onMouseDownHandleWrapper_),oe(this.outerSvg),this.workspace.getThemeManager().unsubscribe(this.svgHandle)}constrainHandleLength(e){return 0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength)}setHandleLength(e){this.handleLength=e,this.svgHandle.setAttribute(this.lengthAttribute_,String(this.handleLength))}constrainHandlePosition(e){return 0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength-this.handleLength)}setHandlePosition(e){this.handlePosition=e,this.svgHandle.setAttribute(this.positionAttribute_,String(this.handlePosition))}setScrollbarLength(e){this.scrollbarLength=e,this.outerSvg.setAttribute(this.lengthAttribute_,String(this.scrollbarLength)),this.svgBackground.setAttribute(this.lengthAttribute_,String(this.scrollbarLength))}setPosition(e,t){this.position.x=e,this.position.y=t,ae(this.outerSvg,"translate("+(this.position.x+this.origin.x)+"px,"+(this.position.y+this.origin.y)+"px)")}resize(e){(e||(e=this.workspace.getMetrics()))&&(this.oldHostMetrics&&kl.metricsAreEquivalent(e,this.oldHostMetrics)||(this.horizontal?this.resizeHorizontal(e):this.resizeVertical(e),this.oldHostMetrics=e,this.updateMetrics()))}requiresViewResize(e){return!this.oldHostMetrics||this.oldHostMetrics.viewWidth!==e.viewWidth||this.oldHostMetrics.viewHeight!==e.viewHeight||this.oldHostMetrics.absoluteLeft!==e.absoluteLeft||this.oldHostMetrics.absoluteTop!==e.absoluteTop}resizeHorizontal(e){this.requiresViewResize(e)?this.resizeViewHorizontal(e):this.resizeContentHorizontal(e)}resizeViewHorizontal(e){var t=e.viewWidth-2*this.margin;this.pair&&(t-=kl.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),t=e.absoluteLeft+this.margin,this.pair&&this.workspace.RTL&&(t+=kl.scrollbarThickness),this.setPosition(t,e.absoluteTop+e.viewHeight-kl.scrollbarThickness-this.margin),this.resizeContentHorizontal(e)}resizeContentHorizontal(e){if(e.viewWidth>=e.scrollWidth)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var t=this.scrollbarLength*e.viewWidth/e.scrollWidth;t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollWidth-e.viewWidth;var i=this.scrollbarLength-this.handleLength;e=(e.viewLeft-e.scrollLeft)/t*i,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=i/t}}resizeVertical(e){this.requiresViewResize(e)?this.resizeViewVertical(e):this.resizeContentVertical(e)}resizeViewVertical(e){let t=e.viewHeight-2*this.margin;this.pair&&(t-=kl.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),this.setPosition(this.workspace.RTL?e.absoluteLeft+this.margin:e.absoluteLeft+e.viewWidth-kl.scrollbarThickness-this.margin,e.absoluteTop+this.margin),this.resizeContentVertical(e)}resizeContentVertical(e){if(e.viewHeight>=e.scrollHeight)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var t=this.scrollbarLength*e.viewHeight/e.scrollHeight;t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollHeight-e.viewHeight;var i=this.scrollbarLength-this.handleLength;e=(e.viewTop-e.scrollTop)/t*i,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=i/t}}isVisible(){return this.isHandleVisible}setContainerVisible(e){const t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay_()}setVisible(e){if(this.pair)throw Error("Unable to toggle visibility of paired scrollbars.");this.setVisibleInternal(e)}setVisibleInternal(e){const t=e!==this.isVisible();this.isHandleVisible=e,t&&this.updateDisplay_()}updateDisplay_(){this.containerVisible&&this.isVisible()?this.outerSvg.setAttribute("display","block"):this.outerSvg.setAttribute("display","none")}onMouseDownBar(e){if(this.workspace.markFocused(),U(),this.cleanUp(),z(e))e.stopPropagation();else{var t=K(e,this.workspace.getParentSvg(),this.workspace.getInverseScreenCTM());t=this.horizontal?t.x:t.y;var i=Ce(this.svgHandle);i=this.horizontal?i.x:i.y;var n=this.handlePosition,s=.95*this.handleLength;t<=i?n-=s:t>=i+this.handleLength&&(n+=s),this.setHandlePosition(this.constrainHandlePosition(n)),this.updateMetrics(),e.stopPropagation(),e.preventDefault()}}onMouseDownHandle(e){this.workspace.markFocused(),this.cleanUp(),z(e)?e.stopPropagation():(this.startDragHandle=this.handlePosition,this.startDragMouse=this.horizontal?e.clientX:e.clientY,this.onMouseUpWrapper_=j(document,"pointerup",this,this.onMouseUpHandle),this.onMouseMoveWrapper_=j(document,"pointermove",this,this.onMouseMoveHandle),e.stopPropagation(),e.preventDefault())}onMouseMoveHandle(e){this.setHandlePosition(this.constrainHandlePosition(this.startDragHandle+((this.horizontal?e.clientX:e.clientY)-this.startDragMouse))),this.updateMetrics()}onMouseUpHandle(){U(),this.cleanUp()}cleanUp(){this.workspace.hideChaff(!0),this.onMouseUpWrapper_&&(X(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null),this.onMouseMoveWrapper_&&(X(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null)}getRatio_(){let e=this.handlePosition/(this.scrollbarLength-this.handleLength);return isNaN(e)&&(e=0),e}updateMetrics(){const e=this.getRatio_();this.horizontal?this.workspace.setMetrics({x:e}):this.workspace.setMetrics({y:e})}set(e,t){this.setHandlePosition(this.constrainHandlePosition(e*this.ratio)),(t||void 0===t)&&this.updateMetrics()}setOrigin(e,t){this.origin=new cl(e,t)}static metricsAreEquivalent(e,t){return e.viewWidth===t.viewWidth&&e.viewHeight===t.viewHeight&&e.viewLeft===t.viewLeft&&e.viewTop===t.viewTop&&e.absoluteTop===t.absoluteTop&&e.absoluteLeft===t.absoluteLeft&&e.scrollWidth===t.scrollWidth&&e.scrollHeight===t.scrollHeight&&e.scrollLeft===t.scrollLeft&&e.scrollTop===t.scrollTop}};kl.scrollbarThickness=Ua?25:15,kl.DEFAULT_SCROLLBAR_MARGIN=.5;var Ol={parseFromString:function(){throw Error("DOMParser was not found in the global scope and was not properly injected using injectDependencies")}},Nl={serializeToString:function(){throw Error("XMLSerializer was not foundin the global scope and was not properly injected using injectDependencies")}},{document:Al,DOMParser:Sl,XMLSerializer:Rl}=globalThis;Sl&&(Ol=new Sl),Rl&&(Nl=new Rl);var wl="https://developers.google.com/blockly/xml",Ll=/[\x00-\x09\x0B\x0C\x0E-\x1F]/g,xl={NAME_SPACE:wl};xl.createElement=Hr.createElement$$module$build$src$core$utils$xml,xl.createTextNode=Hr.createTextNode$$module$build$src$core$utils$xml,xl.domToText=Re,xl.injectDependencies=Se,xl.textToDom=Hr.textToDom$$module$build$src$core$utils$xml;var $l,Dl="categoryToolbox",Ml="flyoutToolbox";!function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"}($l||($l={}));var Pl,Bl,Fl,Ul={hasCategoriesInternal:Me},Hl={};Hl.Position=$l,Hl.TEST_ONLY=Ul,Hl.convertFlyoutDefToJsonArray=$e,Hl.convertToolboxDefToJson=Le,Hl.hasCategories=De,Hl.isCategoryCollapsible=Pe,Hl.parseToolboxTree=He,function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM"}(Pl||(Pl={})),function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT"}(Bl||(Bl={})),function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(Fl||(Fl={}));var Gl={};Gl.bumpDirection=Fl,Gl.bumpPositionRect=je,Gl.getCornerOppositeToolbox=Ve,Gl.getStartPositionRect=Ge,Gl.horizontalPosition=Bl,Gl.verticalPosition=Pl;var Vl=96,jl=124,Wl="sprites.png",Xl=class{constructor(e){this.workspace=e,this.id="zoomControls",this.boundEvents=[],this.zoomResetGroup=this.zoomOutGroup=this.zoomInGroup=null,this.HEIGHT=this.WIDTH=32,this.SMALL_SPACING=2,this.LARGE_SPACING=11,this.MARGIN_HORIZONTAL=this.MARGIN_VERTICAL=20,this.svgGroup=null,this.top=this.left=0,this.initialized=!1}createDom(){this.svgGroup=ee(_l.G,{});const e=String(Math.random()).substring(2);return this.createZoomOutSvg(e),this.createZoomInSvg(e),this.workspace.isMovable()&&this.createZoomResetSvg(e),this.svgGroup}init(){this.workspace.getComponentManager().addComponent({component:this,weight:2,capabilities:[sl.Capability.POSITIONABLE]}),this.initialized=!0}dispose(){this.workspace.getComponentManager().removeComponent("zoomControls"),this.svgGroup&&oe(this.svgGroup);for(const e of this.boundEvents)X(e);this.boundEvents.length=0}getBoundingRectangle(){let e=this.SMALL_SPACING+2*this.HEIGHT;return this.zoomResetGroup&&(e+=this.LARGE_SPACING+this.HEIGHT),new Tl(this.top,this.top+e,this.left,this.left+this.WIDTH)}position(e,t){if(this.initialized){var i,n=Ve(this.workspace,e),s=this.SMALL_SPACING+2*this.HEIGHT;if(this.zoomResetGroup&&(s+=this.LARGE_SPACING+this.HEIGHT),e=Ge(n,new El(this.WIDTH,s),this.MARGIN_HORIZONTAL,this.MARGIN_VERTICAL,e,this.workspace),n=n.vertical,t=je(e,this.MARGIN_VERTICAL,n===Pl.TOP?Fl.DOWN:Fl.UP,t),n===Pl.TOP){var o,r=this.SMALL_SPACING+this.HEIGHT;null==(o=this.zoomInGroup)||o.setAttribute("transform","translate(0, "+r+")"),this.zoomResetGroup&&this.zoomResetGroup.setAttribute("transform","translate(0, "+(r+this.LARGE_SPACING+this.HEIGHT)+")")}else{let e;o=this.zoomResetGroup?this.LARGE_SPACING+this.HEIGHT:0,null==(e=this.zoomInGroup)||e.setAttribute("transform","translate(0, "+o+")"),o=o+this.SMALL_SPACING+this.HEIGHT,null==(r=this.zoomOutGroup)||r.setAttribute("transform","translate(0, "+o+")")}this.top=t.top,this.left=t.left,null==(i=this.svgGroup)||i.setAttribute("transform","translate("+this.left+","+this.top+")")}}createZoomOutSvg(e){this.zoomOutGroup=ee(_l.G,{class:"blocklyZoom blocklyZoomOut"},this.svgGroup);const t=ee(_l.CLIPPATH,{id:"blocklyZoomoutClipPath"+e},this.zoomOutGroup);ee(_l.RECT,{width:32,height:32},t),ee(_l.IMAGE,{width:Vl,height:jl,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+e+")"},this.zoomOutGroup).setAttributeNS(dl,"xlink:href",this.workspace.options.pathToMedia+Wl),this.boundEvents.push(j(this.zoomOutGroup,"pointerdown",null,this.zoom.bind(this,-1)))}createZoomInSvg(e){this.zoomInGroup=ee(_l.G,{class:"blocklyZoom blocklyZoomIn"},this.svgGroup);const t=ee(_l.CLIPPATH,{id:"blocklyZoominClipPath"+e},this.zoomInGroup);ee(_l.RECT,{width:32,height:32},t),ee(_l.IMAGE,{width:Vl,height:jl,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+e+")"},this.zoomInGroup).setAttributeNS(dl,"xlink:href",this.workspace.options.pathToMedia+Wl),this.boundEvents.push(j(this.zoomInGroup,"pointerdown",null,this.zoom.bind(this,1)))}zoom(e,t){this.workspace.markFocused(),this.workspace.zoomCenter(e),this.fireZoomEvent(),U(),t.stopPropagation(),t.preventDefault()}createZoomResetSvg(e){this.zoomResetGroup=ee(_l.G,{class:"blocklyZoom blocklyZoomReset"},this.svgGroup);const t=ee(_l.CLIPPATH,{id:"blocklyZoomresetClipPath"+e},this.zoomResetGroup);ee(_l.RECT,{width:32,height:32},t),ee(_l.IMAGE,{width:Vl,height:jl,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+e+")"},this.zoomResetGroup).setAttributeNS(dl,"xlink:href",this.workspace.options.pathToMedia+Wl),this.boundEvents.push(j(this.zoomResetGroup,"pointerdown",null,this.resetZoom.bind(this)))}resetZoom(e){this.workspace.markFocused();const t=Math.log(this.workspace.options.zoomOptions.startScale/this.workspace.scale)/Math.log(this.workspace.options.zoomOptions.scaleSpeed);this.workspace.beginCanvasTransition(),this.workspace.zoomCenter(t),this.workspace.scrollCenter(),setTimeout(this.workspace.endCanvasTransition.bind(this.workspace),500),this.fireZoomEvent(),U(),e.stopPropagation(),e.preventDefault()}fireZoomEvent(){const e=new(y(ta))(null,this.workspace.id,"zoom_controls");p(e)}};Z("\n.blocklyZoom>image, .blocklyZoom>svg>image {\n  opacity: .4;\n}\n\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\n  opacity: .6;\n}\n\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\n  opacity: .8;\n}\n");var Yl="MANUALLY_DISABLED",zl={COLLAPSED_FIELD_NAME:"_TEMP_COLLAPSED_FIELD",COLLAPSED_INPUT_NAME:"_TEMP_COLLAPSED_INPUT",MANUALLY_DISABLED:Yl},Kl=class{constructor(e){this.name=e}toString(){return this.name}equals(e){return this.name===e.toString()}};Kl.MUTATOR=new Kl("mutator"),Kl.WARNING=new Kl("warning"),Kl.COMMENT=new Kl("comment"),function(e){e[e.VALUE=1]="VALUE",e[e.STATEMENT=3]="STATEMENT",e[e.DUMMY=5]="DUMMY",e[e.CUSTOM=6]="CUSTOM",e[e.END_ROW=7]="END_ROW"}(Hr.inputTypes$$module$build$src$core$inputs$input_types||(Hr.inputTypes$$module$build$src$core$inputs$input_types={})),Hr.inputTypes$$module$build$src$core$inputs$input_types;var ql,Jl,Zl=function(e,t){window.alert(e),t&&t()},Ql=function(e,t){t(window.confirm(e))},ec=function(e,t,i){i(window.prompt(e,t))},tc={confirmInternal:ze},ic={TEST_ONLY:tc};ic.alert=We,ic.confirm=Ye,ic.prompt=qe,ic.setAlert=Xe,ic.setConfirm=Ke,ic.setPrompt=Je,Hr.Msg$$module$build$src$core$msg=Object.create(null),ql=function(e){Object.keys(e).forEach((function(t){Hr.Msg$$module$build$src$core$msg[t]=e[t]}))},Jl={Msg:Hr.Msg$$module$build$src$core$msg,setLocale:ql};var nc={};nc.isLegacyProcedureCallBlock=et,nc.isLegacyProcedureDefBlock=Qe;var sc=class extends ka{constructor(e){super(),this.isBlank=void 0===e,e&&(this.varId=e.getId(),this.workspaceId=e.workspace.id)}toJson(){const e=super.toJson();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");return e.varId=this.varId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new sc)).varId=e.varId,t}},oc=class extends sc{constructor(e){super(e),this.type=Zr,e&&(this.varType=e.type,this.varName=e.name)}toJson(){const e=super.toJson();if(void 0===this.varType)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new oc)).varType=e.varType,t.varName=e.varName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");e?t.createVariable(this.varName,this.varType,this.varId):t.deleteVariableById(this.varId)}};t(Xr.EVENT,Zr,oc);var rc=class{constructor(e,t,i,n){this.workspace=e,this.name=t,this.type=i||"",this.id_=n||h()}getId(){return this.id_}static compareByName(e,t){return e.name.localeCompare(t.name,void 0,{sensitivity:"base"})}},ac="ijkmnopqrstuvwxyzabcdefgh",lc={generateUniqueNameInternal:st},cc={CATEGORY_NAME:"VARIABLE",TEST_ONLY:lc,VAR_LETTER_OPTIONS:ac};cc.allDeveloperVariables=Hr.allDeveloperVariables$$module$build$src$core$variables,cc.allUsedVarModels=Hr.allUsedVarModels$$module$build$src$core$variables,cc.createVariableButtonHandler=rt,cc.flyoutCategory=tt,cc.flyoutCategoryBlocks=it,cc.generateUniqueName=nt,cc.generateUniqueNameFromOptions=ot,cc.generateVariableFieldDom=pt,cc.getAddedVariables=mt,cc.getOrCreateVariablePackage=Hr.getOrCreateVariablePackage$$module$build$src$core$variables,cc.getVariable=Hr.getVariable$$module$build$src$core$variables,cc.nameUsedWithAnyType=ct,cc.nameUsedWithConflictingParam=ut,cc.promptName=at,cc.renameVariable=Hr.renameVariable$$module$build$src$core$variables;var uc=new Set,hc=new WeakSet,dc=new WeakMap,pc=null,gc=null,mc=0,fc={};fc.finishQueuedRenders=_t,fc.queueRender=ft,fc.triggerQueuedRenders=Tt;var _c=class{constructor(e,t){this.workspace=e,this.text="",this.size=new El(120,100),this.collapsed=!1,this.deletable=this.movable=this.editable=!0,this.location=new cl(0,0),this.disposing=this.disposed=!1,this.id=t&&!e.getCommentById(t)?t:h(),e.addTopComment(this),this.fireCreateEvent()}fireCreateEvent(){T()&&p(new(y(sa))(this))}fireDeleteEvent(){T()&&p(new(y("comment_delete"))(this))}fireChangeEvent(e,t){T()&&p(new(y("comment_change"))(this,e,t))}fireCollapseEvent(e){T()&&p(new(y("comment_collapse"))(this,e))}setText(e){const t=this.text;this.text=e,this.fireChangeEvent(t,e)}getText(){return this.text}setSize(e){this.size=e}getSize(){return this.size}setCollapsed(e){this.collapsed=e,this.fireCollapseEvent(e)}isCollapsed(){return this.collapsed}setEditable(e){this.editable=e}isEditable(){return this.isOwnEditable()&&!this.workspace.options.readOnly}isOwnEditable(){return this.editable}setMovable(e){this.movable=e}isMovable(){return this.isOwnMovable()&&!this.workspace.options.readOnly}isOwnMovable(){return this.movable}setDeletable(e){this.deletable=e}isDeletable(){return this.isOwnDeletable()&&!this.workspace.options.readOnly}isOwnDeletable(){return this.deletable}moveTo(e,t){const i=new(y(oa))(this);t&&i.setReason(t),this.location=e,i.recordNew(),T()&&p(i)}getRelativeToSurfaceXY(){return this.location}dispose(){this.disposing=!0,this.fireDeleteEvent(),this.workspace.removeTopComment(this),this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}},Tc=class{constructor(e){let t;this.workspace=e,this.size=new El(120,100),this.collapsed=!1,this.editable=!0,this.location=new cl(0,0),this.text="",this.textChangeListeners=[],this.sizeChangeListeners=[],this.disposeListeners=[],this.collapseChangeListeners=[],this.resizePointerMoveListener=this.resizePointerUpListener=null,this.disposed=this.disposing=!1,this.svgRoot=ee(_l.G,{class:"blocklyComment blocklyEditable"}),this.highlightRect=this.createHighlightRect(this.svgRoot),({topBarGroup:this.topBarGroup,topBarBackground:this.topBarBackground,deleteIcon:this.deleteIcon,foldoutIcon:this.foldoutIcon,textPreview:this.textPreview,textPreviewNode:this.textPreviewNode}=this.createTopBar(this.svgRoot,e)),({foreignObject:this.foreignObject,textArea:this.textArea}=this.createTextArea(this.svgRoot)),this.resizeHandle=this.createResizeHandle(this.svgRoot,e),null==(t=e.getLayerManager())||t.append(this,50),this.setSize(this.size),this.moveTo(new cl(0,0))}createHighlightRect(e){return ee(_l.RECT,{class:"blocklyCommentHighlight"},e)}createTopBar(e,t){e=ee(_l.G,{class:"blocklyCommentTopbar"},e);const i=ee(_l.RECT,{class:"blocklyCommentTopbarBackground"},e),n=ee(_l.IMAGE,{class:"blocklyDeleteIcon",href:`${t.options.pathToMedia}delete-icon.svg`},e);t=ee(_l.IMAGE,{class:"blocklyFoldoutIcon",href:`${t.options.pathToMedia}foldout-icon.svg`},e);const s=ee(_l.TEXT,{class:"blocklyCommentPreview blocklyCommentText blocklyText"},e),o=document.createTextNode("");return s.appendChild(o),j(t,"pointerdown",this,this.onFoldoutDown),j(n,"pointerdown",this,this.onDeleteDown),{topBarGroup:e,topBarBackground:i,deleteIcon:n,foldoutIcon:t,textPreview:s,textPreviewNode:o}}createTextArea(e){e=ee(_l.FOREIGNOBJECT,{class:"blocklyCommentForeignObject"},e);const t=document.createElementNS(hl,"body");t.setAttribute("xmlns",hl),t.className="blocklyMinimalBody";const i=document.createElementNS(hl,"textarea");return te(i,"blocklyCommentText"),te(i,"blocklyTextarea"),te(i,"blocklyText"),t.appendChild(i),e.appendChild(t),j(i,"change",this,this.onTextChange),{foreignObject:e,textArea:i}}createResizeHandle(e,t){return e=ee(_l.IMAGE,{class:"blocklyResizeHandle",href:`${t.options.pathToMedia}resize-handle.svg`},e),j(e,"pointerdown",this,this.onResizePointerDown),e}getSvgRoot(){return this.svgRoot}getSize(){return this.collapsed?this.topBarBackground.getBBox():this.size}setSize(e){const t=this.topBarBackground.getBBox(),i=this.deleteIcon.getBBox(),n=this.foldoutIcon.getBBox(),s=this.textPreview.getBBox(),o=this.resizeHandle.getBBox();e=El.max(e,this.calcMinSize(t,n,i));const r=this.size;this.size=e,this.svgRoot.setAttribute("height",`${e.height}`),this.svgRoot.setAttribute("width",`${e.width}`),this.updateHighlightRect(e),this.updateTopBarSize(e),this.updateTextAreaSize(e,t),this.updateDeleteIconPosition(e,t,i),this.updateFoldoutIconPosition(t,n),this.updateTextPreviewSize(e,t,s,i,o),this.updateResizeHandlePosition(e,o),this.onSizeChange(r,this.size)}calcMinSize(e,t,i){var n;this.updateTextPreview(null!=(n=this.textArea.value)?n:""),n=ue(this.textPreview);const s=this.calcFoldoutMargin(e,t),o=this.calcDeleteMargin(e,i);let r=n;return this.foldoutIcon.checkVisibility()?r+=t.width+2*s:n&&(r+=4),this.deleteIcon.checkVisibility()?r+=i.width+2*o:n&&(r+=4),new El(r,e.height+20)}calcDeleteMargin(e,t){return(e.height-t.height)/2}calcFoldoutMargin(e,t){return(e.height-t.height)/2}updateHighlightRect(e){this.highlightRect.setAttribute("height",`${e.height}`),this.highlightRect.setAttribute("width",`${e.width}`),this.workspace.RTL&&this.highlightRect.setAttribute("x",""+-e.width)}updateTopBarSize(e){this.topBarBackground.setAttribute("width",`${e.width}`)}updateTextAreaSize(e,t){this.foreignObject.setAttribute("height",""+(e.height-t.height)),this.foreignObject.setAttribute("width",`${e.width}`),this.foreignObject.setAttribute("y",`${t.height}`),this.workspace.RTL&&this.foreignObject.setAttribute("x",""+-e.width)}updateDeleteIconPosition(e,t,i){t=this.calcDeleteMargin(t,i),this.deleteIcon.setAttribute("y",`${t}`),this.deleteIcon.setAttribute("x",""+(e.width-i.width-t))}updateFoldoutIconPosition(e,t){e=this.calcFoldoutMargin(e,t),this.foldoutIcon.setAttribute("y",`${e}`),this.foldoutIcon.setAttribute("x",`${e}`)}updateTextPreviewSize(e,t,i,n,s){const o=(t.height-i.height)/2,r=this.calcDeleteMargin(t,n);t=this.calcFoldoutMargin(t,s),e=e.width-s.width-2*t-n.width-2*r,this.textPreview.setAttribute("x",`${s.width+2*t*(this.workspace.RTL?-1:1)}`),this.textPreview.setAttribute("y",`${o+i.height/2}`),this.textPreview.setAttribute("width",`${e}`)}updateResizeHandlePosition(e,t){this.resizeHandle.setAttribute("y",""+(e.height-t.height)),this.resizeHandle.setAttribute("x",""+(e.width-t.width))}onSizeChange(e,t){for(let i=this.sizeChangeListeners.length-1;0<=i;i--)this.sizeChangeListeners[i](e,t)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}removeSizeChangeListener(e){this.sizeChangeListeners.splice(this.sizeChangeListeners.indexOf(e),1)}onResizePointerDown(e){this.isEditable()&&(this.bringToFront(),z(e)||(this.workspace.startDrag(e,new cl(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=j(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=j(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation())}onResizePointerUp(e){U(),this.resizePointerUpListener&&(X(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(X(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(e){e=this.workspace.moveDrag(e),this.setSize(new El(this.workspace.RTL?-e.x:e.x,e.y))}isCollapsed(){return this.collapsed}setCollapsed(e){(this.collapsed=e)?te(this.svgRoot,"blocklyCollapsed"):ne(this.svgRoot,"blocklyCollapsed"),this.setSize(this.size),this.onCollapse()}onCollapse(){for(let e=this.collapseChangeListeners.length-1;0<=e;e--)this.collapseChangeListeners[e](this.collapsed)}addOnCollapseListener(e){this.collapseChangeListeners.push(e)}removeOnCollapseListener(e){this.collapseChangeListeners.splice(this.collapseChangeListeners.indexOf(e),1)}onFoldoutDown(e){this.bringToFront(),z(e)||(this.setCollapsed(!this.collapsed),this.workspace.hideChaff()),e.stopPropagation()}isEditable(){return this.editable}setEditable(e){(this.editable=e)?(te(this.svgRoot,"blocklyEditable"),ne(this.svgRoot,"blocklyReadonly"),this.textArea.removeAttribute("readonly")):(ne(this.svgRoot,"blocklyEditable"),te(this.svgRoot,"blocklyReadonly"),this.textArea.setAttribute("readonly","true"))}getRelativeToSurfaceXY(){return this.location}moveTo(e){this.location=e,this.svgRoot.setAttribute("transform",`translate(${e.x}, ${e.y})`)}getText(){return this.text}setText(e){this.textArea.value=e,this.onTextChange()}addTextChangeListener(e){this.textChangeListeners.push(e)}removeTextChangeListener(e){this.textChangeListeners.splice(this.textChangeListeners.indexOf(e),1)}onTextChange(){const e=this.text;this.text=this.textArea.value,this.updateTextPreview(this.text),this.setSize(this.size);for(let t=this.textChangeListeners.length-1;0<=t;t--)this.textChangeListeners[t](e,this.text)}updateTextPreview(e){this.textPreviewNode.textContent=this.truncateText(e)}truncateText(e){return 12<=e.length?`${e.substring(0,9)}...`:e}bringToFront(){const e=this.svgRoot.parentNode,t=e.childNodes;t[t.length-1]!==this.svgRoot&&e.appendChild(this.svgRoot)}onDeleteDown(e){z(e)||this.dispose(),e.stopPropagation()}dispose(){this.disposing=!0,oe(this.svgRoot);for(let e=this.disposeListeners.length-1;0<=e;e--)this.disposeListeners[e]();this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}addDisposeListener(e){this.disposeListeners.push(e)}removeDisposeListener(e){this.disposeListeners.splice(this.disposeListeners.indexOf(e),1)}};Z("\n.injectionDiv {\n  --commentFillColour: #FFFCC7;\n  --commentBorderColour: #F2E49B;\n}\n\n.blocklyComment .blocklyTextarea {\n  background-color: var(--commentFillColour);\n  border: 1px solid var(--commentBorderColour);\n  box-sizing: border-box;\n  display: block;\n  outline: 0;\n  padding: 5px;\n  resize: none;\n  width: 100%;\n  height: 100%;\n}\n\n.blocklyReadonly.blocklyComment .blocklyTextarea {\n  cursor: inherit;\n}\n\n.blocklyDeleteIcon {\n  width: 20px;\n  height: 20px;\n  display: none;\n  cursor: pointer;\n}\n\n.blocklyFoldoutIcon {\n  width: 20px;\n  height: 20px;\n  transform-origin: 12px 12px;\n  cursor: pointer;\n}\n.blocklyResizeHandle {\n  width: 12px;\n  height: 12px;\n  cursor: se-resize;\n}\n.blocklyReadonly.blocklyComment .blocklyResizeHandle {\n  cursor: inherit;\n}\n\n.blocklyCommentTopbarBackground {\n  cursor: grab;\n  fill: var(--commentBorderColour);\n  height: 24px;\n}\n\n.blocklyComment .blocklyCommentPreview.blocklyText {\n  fill: #000;\n  dominant-baseline: middle;\n  visibility: hidden;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyCommentPreview {\n  visibility: visible;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyCommentForeignObject,\n.blocklyCollapsed.blocklyComment .blocklyResizeHandle {\n  display: none;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyFoldoutIcon {\n  transform: rotate(-90deg);\n}\n\n.blocklyRTL .blocklyCommentTopbar {\n  transform: scale(-1, 1);\n}\n\n.blocklyRTL .blocklyCommentForeignObject {\n  direction: rtl;\n}\n\n.blocklyRTL .blocklyCommentPreview {\n  /* Revert the scale and control RTL using direction instead. */\n  transform: scale(-1, 1);\n  direction: rtl;\n}\n\n.blocklyRTL .blocklyResizeHandle {\n  transform: scale(-1, 1);\n  cursor: sw-resize;\n}\n\n.blocklyCommentHighlight {\n  fill: none;\n}\n\n.blocklySelected .blocklyCommentHighlight {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n\n.blocklyCollapsed.blocklySelected .blocklyCommentHighlight {\n  stroke: none;\n}\n\n.blocklyCollapsed.blocklySelected .blocklyCommentTopbarBackground {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n");var Ec=class{constructor(e){this.comment=e,this.startLoc=null,this.workspace=e.workspace}isMovable(){return this.comment.isOwnMovable()&&!this.workspace.options.readOnly}startDrag(){let e;Hr.getGroup$$module$build$src$core$events$utils()||Hr.setGroup$$module$build$src$core$events$utils(!0),this.startLoc=this.comment.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1),null==(e=this.workspace.getLayerManager())||e.moveToDragLayer(this.comment),this.comment.setDragging(!0)}drag(e){this.comment.moveDuringDrag(e)}endDrag(){let e;this.fireMoveEvent(),null==(e=this.workspace.getLayerManager())||e.moveOffDragLayer(this.comment,50),this.comment.setDragging(!1),this.comment.snapToGrid(),this.workspace.setResizesEnabled(!0),Hr.setGroup$$module$build$src$core$events$utils(!1)}fireMoveEvent(){if(!this.comment.isDeadOrDying()){var e=new(y(oa))(this.comment);e.setReason(["drag"]),e.oldCoordinate_=this.startLoc,e.recordNew(),p(e)}}revertDrag(){this.startLoc&&this.comment.moveDuringDrag(this.startLoc)}},bc={};bc.register=kt,bc.unregister=Ot;var Ic=class{constructor(){this.priority=25}save(e){const t=[];for(const i of e.getTopComments())(e=Nt(i,{addCoordinates:!0,saveIds:!0}))&&t.push(e);return t.length?t:null}load(e,t){for(const i of e)At(i,t,{recordUndo:d()})}clear(e){for(const t of e.getTopComments())t.dispose()}};kt("workspaceComments",new Ic);var yc={};yc.WorkspaceCommentSerializer=Ic,yc.append=At,yc.save=Nt;var vc={};vc.register=St,vc.unregister=Rt;var Cc=class{paste(e,t,i){let n;e=e.commentState,i&&(e.x=i.x,e.y=i.y),Hr.disable$$module$build$src$core$events$utils();try{n=At(e,t),wt(n)}finally{Hr.enable$$module$build$src$core$events$utils()}return n?(T()&&p(new(y(sa))(n)),Hr.setSelected$$module$build$src$core$common(n),n):null}};Cc.TYPE="workspace-comment",St(Cc.TYPE,new Cc),Hr.config$$module$build$src$core$config={dragRadius:5,flyoutDragRadius:10,snapRadius:28,connectingSnapRadius:28,currentConnectionPreference:8,bumpDelay:250},Hr.config$$module$build$src$core$config;var kc,Oc,Nc="aria-",Ac="role";!function(e){e.GRID="grid",e.GRIDCELL="gridcell",e.GROUP="group",e.LISTBOX="listbox",e.MENU="menu",e.MENUITEM="menuitem",e.MENUITEMCHECKBOX="menuitemcheckbox",e.OPTION="option",e.PRESENTATION="presentation",e.ROW="row",e.TREE="tree",e.TREEITEM="treeitem"}(kc||(kc={})),function(e){e.ACTIVEDESCENDANT="activedescendant",e.COLCOUNT="colcount",e.DISABLED="disabled",e.EXPANDED="expanded",e.INVALID="invalid",e.LABEL="label",e.LABELLEDBY="labelledby",e.LEVEL="level",e.ORIENTATION="orientation",e.POSINSET="posinset",e.ROWCOUNT="rowcount",e.SELECTED="selected",e.SETSIZE="setsize",e.VALUEMAX="valuemax",e.VALUEMIN="valuemin"}(Oc||(Oc={}));var Sc={};Sc.Role=kc,Sc.State=Oc,Sc.setRole=xt,Sc.setState=$t;var Rc=class{constructor(){this.menuItems=[],this.roleName=this.element=this.onKeyDownHandler=this.mouseLeaveHandler=this.mouseEnterHandler=this.clickHandler=this.mouseOverHandler=this.highlightedItem=this.openingCoords=null}addChild(e){this.menuItems.push(e)}render(e){const t=document.createElement("div");t.className="blocklyMenu goog-menu blocklyNonSelectable",t.tabIndex=0,this.roleName&&xt(t,this.roleName),this.element=t;for(let e,i=0;e=this.menuItems[i];i++)t.appendChild(e.createDom());return this.mouseOverHandler=j(t,"pointerover",this,this.handleMouseOver,!0),this.clickHandler=j(t,"pointerup",this,this.handleClick,!0),this.mouseEnterHandler=j(t,"pointerenter",this,this.handleMouseEnter,!0),this.mouseLeaveHandler=j(t,"pointerleave",this,this.handleMouseLeave,!0),this.onKeyDownHandler=j(t,"keydown",this,this.handleKeyEvent),e.appendChild(t),t}getElement(){return this.element}focus(){const e=this.getElement();e&&(e.focus({preventScroll:!0}),te(e,"blocklyFocused"))}blur(){const e=this.getElement();e&&(e.blur(),ne(e,"blocklyFocused"))}setRole(e){this.roleName=e}dispose(){this.mouseOverHandler&&(X(this.mouseOverHandler),this.mouseOverHandler=null),this.clickHandler&&(X(this.clickHandler),this.clickHandler=null),this.mouseEnterHandler&&(X(this.mouseEnterHandler),this.mouseEnterHandler=null),this.mouseLeaveHandler&&(X(this.mouseLeaveHandler),this.mouseLeaveHandler=null),this.onKeyDownHandler&&(X(this.onKeyDownHandler),this.onKeyDownHandler=null);for(let e,t=0;e=this.menuItems[t];t++)e.dispose();this.element=null}getMenuItem(e){const t=this.getElement();for(;e&&e!==t;){if(e.classList.contains("blocklyMenuItem"))for(let t,i=0;t=this.menuItems[i];i++)if(t.getElement()===e)return t;e=e.parentElement}return null}setHighlighted(e){var t=this.highlightedItem;t&&(t.setHighlighted(!1),this.highlightedItem=null),e&&(e.setHighlighted(!0),this.highlightedItem=e,t=this.getElement(),Ie(e.getElement(),t),$t(t,Oc.ACTIVEDESCENDANT,e.getId()))}highlightNext(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(e,1)}highlightPrevious(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(0>e?this.menuItems.length:e,-1)}highlightFirst(){this.highlightHelper(-1,1)}highlightLast(){this.highlightHelper(this.menuItems.length,-1)}highlightHelper(e,t){let i;for(e+=t;i=this.menuItems[e];){if(i.isEnabled()){this.setHighlighted(i);break}e+=t}}handleMouseOver(e){(e=this.getMenuItem(e.target))&&(e.isEnabled()?this.highlightedItem!==e&&this.setHighlighted(e):this.setHighlighted(null))}handleClick(e){const t=this.openingCoords;if(this.openingCoords=null,t&&"number"==typeof e.clientX){const i=new cl(e.clientX,e.clientY);if(1>cl.distance(t,i))return}(e=this.getMenuItem(e.target))&&e.performAction()}handleMouseEnter(e){this.focus()}handleMouseLeave(e){this.getElement()&&(this.blur(),this.setHighlighted(null))}handleKeyEvent(e){if(this.menuItems.length&&!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var t=this.highlightedItem;switch(e.key){case"Enter":case" ":t&&t.performAction();break;case"ArrowUp":this.highlightPrevious();break;case"ArrowDown":this.highlightNext();break;case"PageUp":case"Home":this.highlightFirst();break;case"PageDown":case"End":this.highlightLast();break;default:return}e.preventDefault(),e.stopPropagation()}}getSize(){const e=this.getElement(),t=ge(e);return t.height=e.scrollHeight,t}},wc=class{constructor(e,t){this.content=e,this.opt_value=t,this.enabled=!0,this.element=null,this.rightToLeft=!1,this.roleName=null,this.highlight=this.checked=this.checkable=!1,this.actionHandler=null}createDom(){const e=document.createElement("div");e.id=u(),this.element=e,e.className="blocklyMenuItem goog-menuitem "+(this.enabled?"":"blocklyMenuItemDisabled goog-menuitem-disabled ")+(this.checked?"blocklyMenuItemSelected goog-option-selected ":"")+(this.highlight?"blocklyMenuItemHighlight goog-menuitem-highlight ":"")+(this.rightToLeft?"blocklyMenuItemRtl goog-menuitem-rtl ":"");const t=document.createElement("div");if(t.className="blocklyMenuItemContent goog-menuitem-content",this.checkable){var i=document.createElement("div");i.className="blocklyMenuItemCheckbox goog-menuitem-checkbox",t.appendChild(i)}return i=this.content,"string"==typeof this.content&&(i=document.createTextNode(this.content)),t.appendChild(i),e.appendChild(t),this.roleName&&xt(e,this.roleName),$t(e,Oc.SELECTED,this.checkable&&this.checked||!1),$t(e,Oc.DISABLED,!this.enabled),e}dispose(){this.element=null}getElement(){return this.element}getId(){return this.element.id}getValue(){let e;return null!=(e=this.opt_value)?e:null}setRightToLeft(e){this.rightToLeft=e}setRole(e){this.roleName=e}setCheckable(e){this.checkable=e}setChecked(e){this.checked=e}setHighlighted(e){this.highlight=e;const t=this.getElement();t&&this.isEnabled()&&(e?(te(t,"blocklyMenuItemHighlight"),te(t,"goog-menuitem-highlight")):(ne(t,"blocklyMenuItemHighlight"),ne(t,"goog-menuitem-highlight")))}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}performAction(){this.isEnabled()&&this.actionHandler&&this.actionHandler(this)}onAction(e,t){this.actionHandler=e.bind(t)}},Lc=class extends Error{},xc=class extends Lc{constructor(e){super("Expected to find a 'type' property, defining the block type"),this.state=e}},$c=class extends Lc{constructor(e,t,i){super(`The block ${t.toDevString()} is missing a(n) ${e}\nconnection`),this.block=t,this.state=i}},Dc=class extends Lc{constructor(e,t,i,n){super(`The block ${i.toDevString()} could not connect its\n${t} to its parent, because: ${e}`),this.childBlock=i,this.childState=n}},Mc=class extends Lc{constructor(e){super("Encountered a real block which is defined as a child of a shadow\nblock. It is an invariant of Blockly that shadow blocks only have shadow\nchildren"),this.state=e}},Pc=class extends Lc{constructor(e,t,i){super(`Cannot add an icon of type '${e}' to the block ${t.toDevString()}, because there is no icon registered with type '${e}'. Make sure that all of your icons have been registered.`),this.block=t,this.state=i}},Bc={};Bc.BadConnectionCheck=Dc,Bc.DeserializationError=Lc,Bc.MissingBlockType=xc,Bc.MissingConnection=$c,Bc.RealChildOfShadow=Mc,Bc.UnregisteredIcon=Pc;var Fc=class{constructor(){this.priority=50}save(e){const t=[];for(const i of e.getTopBlocks(!1))(e=Mt(i,{addCoordinates:!0,doFullSerialization:!1}))&&t.push(e);return t.length?{languageVersion:0,blocks:t}:null}load(e,t){e=e.blocks;for(const i of e)Wt(i,t,{recordUndo:d()})}clear(e){for(const t of e.getTopBlocks(!1))t.dispose(!1)}};kt("blocks",new Fc);var Uc={};Uc.BlockSerializer=Fc,Uc.append=Wt,Uc.appendInternal=Xt,Uc.save=Mt;var Hc=class extends ka{constructor(e){super(),this.isBlank=!e,e&&(this.blockId=e.id,this.workspaceId=e.workspace.id)}toJson(){const e=super.toJson();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.blockId=this.blockId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Hc)).blockId=e.blockId,t}},Gc=class extends Hc{constructor(e,t,i,n,s){super(e),this.type=Hr.CHANGE$$module$build$src$core$events$utils,e&&(this.element=t,this.name=i||void 0,this.oldValue=n,this.newValue=s)}toJson(){const e=super.toJson();if(!this.element)throw Error("The changed element is undefined. Either pass an element to the constructor, or call fromJson");return e.element=this.element,e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,this.disabledReason&&(e.disabledReason=this.disabledReason),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Gc)).element=e.element,t.name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,void 0!==e.disabledReason&&(t.disabledReason=e.disabledReason),t}setDisabledReason(e){if("disabled"!==this.element)throw Error('Cannot set the disabled reason for a BlockChange event if the element is not "disabled".');this.disabledReason=e}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(!(t=t.getBlockById(this.blockId)))throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");const i=t.getIcon(Kl.MUTATOR);switch(i&&oi(i)&&i.bubbleIsVisible()&&i.setBubbleVisible(!1),e=e?this.newValue:this.oldValue,this.element){case"field":(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name);break;case"comment":t.setCommentText(e||null);break;case"collapsed":t.setCollapsed(!!e);break;case"disabled":var n;t.setDisabledReason(!!e,null!=(n=this.disabledReason)?n:Yl);break;case"inline":t.setInputsInline(!!e);break;case"mutation":n=Gc.getExtraBlockState_(t),t.loadExtraState?t.loadExtraState(JSON.parse(e||"{}")):t.domToMutation&&t.domToMutation(Hr.textToDom$$module$build$src$core$utils$xml(e||"<mutation/>")),p(new Gc(t,"mutation",null,n,e));break;default:console.warn("Unknown change type: "+this.element)}}static getExtraBlockState_(e){return e.saveExtraState?(e=e.saveExtraState(!0))?JSON.stringify(e):"":e.mutationToDom&&(e=e.mutationToDom())?Jn(e):""}};t(Xr.EVENT,Hr.CHANGE$$module$build$src$core$events$utils,Gc);var Vc={};Vc.clamp=li,Vc.toDegrees=ai,Vc.toRadians=ri;var jc,Wc,Xc,Yc=16,zc=1,Kc=12,qc=16,Jc=.25,Zc=null,Qc=null,eu="",tu="",iu=null,nu=null,su=null,ou={getBoundsInfo:function(){const e=Te(iu),t=ge(iu);return{left:e.x,right:e.x+t.width,top:e.y,bottom:e.y+t.height,width:t.width,height:t.height}},getPositionMetrics:function(e,t,i,n){const s=ou.getBoundsInfo(),o=ge(jc);return t+o.height<s.bottom?Ii(e,t,s,o):n-o.height>s.top?yi(i,n,s,o):t+o.height<document.documentElement.clientHeight?Ii(e,t,s,o):n-o.height>document.documentElement.clientTop?yi(i,n,s,o):vi(e,s,o)}},ru={ANIMATION_TIME:Jc,ARROW_HORIZONTAL_PADDING:Kc,ARROW_SIZE:Yc,BORDER_SIZE:zc,PADDING_Y:qc,TEST_ONLY:ou};ru.clearContent=pi,ru.createDom=ci,ru.getContentDiv=di,ru.getOwner=hi,ru.getPositionX=Ci,ru.hide=Ni,ru.hideIfOwner=Oi,ru.hideWithoutAnimation=Ai,ru.isVisible=ki,ru.repositionForWindowResize=Ri,ru.setBoundsElement=ui,ru.setColour=gi,ru.show=bi,ru.showPositionedByBlock=mi,ru.showPositionedByField=fi;var au=class{constructor(e){this.workspace=e,this.cursorSvg_=this.cursor_=null,this.markers=new Map,this.markerSvg_=null}registerMarker(e,t){this.markers.has(e)&&this.unregisterMarker(e),t.setDrawer(this.workspace.getRenderer().makeMarkerDrawer(this.workspace,t)),this.setMarkerSvg(t.getDrawer().createDom()),this.markers.set(e,t)}unregisterMarker(e){const t=this.markers.get(e);if(!t)throw Error("Marker with ID "+e+" does not exist. Can only unregister markers that exist.");t.dispose(),this.markers.delete(e)}getCursor(){return this.cursor_}getMarker(e){return this.markers.get(e)||null}setCursor(e){this.cursor_&&this.cursor_.getDrawer()&&this.cursor_.getDrawer().dispose(),(this.cursor_=e)&&(e=this.workspace.getRenderer().makeMarkerDrawer(this.workspace,this.cursor_),this.cursor_.setDrawer(e),this.setCursorSvg(this.cursor_.getDrawer().createDom()))}setCursorSvg(e){e?(this.workspace.getBlockCanvas().appendChild(e),this.cursorSvg_=e):this.cursorSvg_=null}setMarkerSvg(e){e?this.workspace.getBlockCanvas()&&(this.cursorSvg_?this.workspace.getBlockCanvas().insertBefore(e,this.cursorSvg_):this.workspace.getBlockCanvas().appendChild(e)):this.markerSvg_=null}updateMarkers(){this.workspace.keyboardAccessibilityMode&&this.cursorSvg_&&this.workspace.getCursor().draw()}dispose(){const e=Object.keys(this.markers);for(let t,i=0;t=e[i];i++)this.unregisterMarker(t);this.markers.clear(),this.cursor_&&(this.cursor_.dispose(),this.cursor_=null)}};au.LOCAL_MARKER="local_marker_1";var lu={};lu.commonWordPrefix=Li,lu.commonWordSuffix=xi,lu.isNumber=Hr.isNumber$$module$build$src$core$utils$string,lu.shortestStringLength=wi,lu.wrap=Hr.wrap$$module$build$src$core$utils$string;var cu=void 0,uu=!1,hu=!1,du=50,pu=0,gu=0,mu=0,fu=0,_u=null,Tu=null,Eu=0,bu=10,Iu=10,yu=750,vu=5,Cu=null,ku={HOVER_MS:yu,LIMIT:du,MARGINS:vu,OFFSET_X:Eu,OFFSET_Y:bu,RADIUS_OK:Iu};ku.bindMouseEvents=Wi,ku.block=Zi,ku.createDom=ji,ku.dispose=qi,ku.getCustomTooltip=Fi,ku.getDiv=Hi,ku.getTooltipOfObject=Gi,ku.hide=Ji,ku.isVisible=Ui,ku.setCustomTooltip=Bi,ku.unbindMouseEvents=Xi,ku.unblock=Qi;var Ou=.45,Nu=.65,Au={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},Su={};Su.blend=pn,Su.getHsvSaturation=on,Su.getHsvValue=an,Su.hexToRgb=hn,Su.hsvToHex=dn,Su.hueToHex=gn,Su.names=Au,Su.parse=cn,Su.rgbToHex=un,Su.setHsvSaturation=rn,Su.setHsvValue=ln;var Ru={};Ru.checkMessageReferences=Tn,Ru.parseBlockColour=En,Ru.replaceMessageReferences=_n,Ru.tokenizeInterpolation=fn;var wu=class{constructor(e,t,i){this.DEFAULT_VALUE=null,this.name=void 0,this.constants_=this.mouseDownWrapper_=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=this.markerSvg_=this.cursorSvg_=this.tooltip_=this.validator_=null,this.disposed=!1,this.maxDisplayLength=50,this.sourceBlock_=null,this.enabled_=this.visible_=this.isDirty_=!0,this.suffixField=this.prefixField=this.clickTarget_=null,this.EDITABLE=!0,this.SERIALIZABLE=!1,this.CURSOR="",this.value_="DEFAULT_VALUE"in new.target.prototype?new.target.prototype.DEFAULT_VALUE:this.DEFAULT_VALUE,this.size_=new El(0,0),e!==wu.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){e.tooltip&&this.setTooltip(_n(e.tooltip))}setSourceBlock(e){if(this.sourceBlock_)throw Error("Field already bound to a block");this.sourceBlock_=e}getConstants(){return!this.constants_&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&this.sourceBlock_.workspace.rendered&&(this.constants_=this.sourceBlock_.workspace.getRenderer().getConstants()),this.constants_}getSourceBlock(){return this.sourceBlock_}init(){this.fieldGroup_||(this.fieldGroup_=ee(_l.G,{}),this.isVisible()||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),this.updateEditable(),this.setTooltip(this.tooltip_),this.bindEvents_(),this.initModel(),this.applyColour())}initView(){this.createBorderRect_(),this.createTextElement_()}initModel(){}isFullBlockField(){return!this.borderRect_}createBorderRect_(){this.borderRect_=ee(_l.RECT,{rx:this.getConstants().FIELD_BORDER_RECT_RADIUS,ry:this.getConstants().FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,class:"blocklyFieldRect"},this.fieldGroup_)}createTextElement_(){this.textElement_=ee(_l.TEXT,{class:"blocklyText"},this.fieldGroup_),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.textElement_.setAttribute("dominant-baseline","central"),this.textContent_=document.createTextNode(""),this.textElement_.appendChild(this.textContent_)}bindEvents_(){const e=this.getClickTarget_();if(!e)throw Error("A click target has not been set.");Wi(e),this.mouseDownWrapper_=j(e,"pointerdown",this,this.onMouseDown_)}fromXml(e){this.setValue(e.textContent)}toXml(e){return e.textContent=this.getValue(),e}saveState(e){return null!==(e=this.saveLegacyState(wu))?e:this.getValue()}loadState(e){this.loadLegacyState(wu,e)||this.setValue(e)}saveLegacyState(e){return e.prototype.saveState===this.saveState&&e.prototype.toXml!==this.toXml?((e=Hr.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name",this.name||""),Re(this.toXml(e)).replace(' xmlns="https://developers.google.com/blockly/xml"',"")):null}loadLegacyState(e,t){return e.prototype.loadState===this.loadState&&e.prototype.fromXml!==this.fromXml&&(this.fromXml(Hr.textToDom$$module$build$src$core$utils$xml(t)),!0)}dispose(){let e;Oi(this),On(this),null!=(e=this.getSourceBlock())&&e.isDeadOrDying()||oe(this.fieldGroup_),this.disposed=!0}updateEditable(){const e=this.fieldGroup_,t=this.getSourceBlock();this.EDITABLE&&e&&t&&(this.enabled_&&t.isEditable()?(te(e,"blocklyEditableText"),ne(e,"blocklyNonEditableText"),e.style.cursor=this.CURSOR):(te(e,"blocklyNonEditableText"),ne(e,"blocklyEditableText"),e.style.cursor=""))}setEnabled(e){this.enabled_=e,this.updateEditable()}isEnabled(){return this.enabled_}isClickable(){return this.enabled_&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&this.showEditor_!==wu.prototype.showEditor_}isClickableInFlyout(e){return!e}isCurrentlyEditable(){return this.enabled_&&this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()}isSerializable(){let e=!1;return this.name&&(this.SERIALIZABLE?e=!0:this.EDITABLE&&(console.warn("Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization."),e=!0)),e}isVisible(){return this.visible_}setVisible(e){if(this.visible_!==e){this.visible_=e;var t=this.fieldGroup_;t&&(t.style.display=e?"block":"none")}}setValidator(e){this.validator_=e}getValidator(){return this.validator_}getSvgRoot(){return this.fieldGroup_}getBorderRect(){if(!this.borderRect_)throw Error(`The border rectangle is ${this.borderRect_}.`);return this.borderRect_}getTextElement(){if(!this.textElement_)throw Error(`The text element is ${this.textElement_}.`);return this.textElement_}getTextContent(){if(!this.textContent_)throw Error(`The text content is ${this.textContent_}.`);return this.textContent_}applyColour(){}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_()}showEditor(e){this.isClickable()&&this.showEditor_(e)}showEditor_(e){}repositionForWindowResize(){return!1}updateSize_(e){const t=this.getConstants();let i=2*(e=void 0!==e?e:this.isFullBlockField()?0:this.getConstants().FIELD_BORDER_RECT_X_PADDING),n=t.FIELD_TEXT_HEIGHT,s=0;this.textElement_&&(i+=s=he(this.textElement_,t.FIELD_TEXT_FONTSIZE,t.FIELD_TEXT_FONTWEIGHT,t.FIELD_TEXT_FONTFAMILY)),this.isFullBlockField()||(n=Math.max(n,t.FIELD_BORDER_RECT_HEIGHT)),this.size_.height=n,this.size_.width=i,this.positionTextElement_(e,s),this.positionBorderRect_()}positionTextElement_(e,t){if(this.textElement_){var i,n=this.getConstants(),s=this.size_.height/2;this.textElement_.setAttribute("x",String(null!=(i=this.getSourceBlock())&&i.RTL?this.size_.width-t-e:e)),this.textElement_.setAttribute("y",String(n.FIELD_TEXT_BASELINE_CENTER?s:s-n.FIELD_TEXT_HEIGHT/2+n.FIELD_TEXT_BASELINE))}}positionBorderRect_(){this.borderRect_&&(this.borderRect_.setAttribute("width",String(this.size_.width)),this.borderRect_.setAttribute("height",String(this.size_.height)),this.borderRect_.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.borderRect_.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}getSize(){return this.isVisible()?(this.isDirty_?(this.render_(),this.isDirty_=!1):this.visible_&&0===this.size_.width&&(this.render_(),0!==this.size_.width&&console.warn("Deprecated use of setting size_.width to 0 to rerender a field. Set field.isDirty_ to true instead.")),this.size_):new El(0,0)}getScaledBBox(){let e;var t=this.getSourceBlock();if(!t)throw new Lu;if(this.isFullBlockField()){var i=this.sourceBlock_.getHeightWidth();const n=t.workspace.scale;e=this.getAbsoluteXY_(),t=(i.width+1)*n,i=(i.height+1)*n,Xa?(e.x+=1.5*n,e.y+=1.5*n):(e.x-=.5*n,e.y-=.5*n)}else i=this.borderRect_.getBoundingClientRect(),e=Te(this.borderRect_),t=i.width,i=i.height;return new Tl(e.y,e.y+i,e.x,e.x+t)}onLocationChange(e){}getDisplayText_(){let e=this.getText();return e?(e.length>this.maxDisplayLength&&(e=e.substring(0,this.maxDisplayLength-2)+""),e=e.replace(/\s/g,wu.NBSP),this.sourceBlock_&&this.sourceBlock_.RTL&&(e+=""),e):wu.NBSP}getText(){const e=this.getText_();return String(null!==e?e:this.getValue())}getText_(){return null}markDirty(){this.isDirty_=!0,this.constants_=null}forceRerender(){this.isDirty_=!0,this.sourceBlock_&&this.sourceBlock_.rendered&&this.sourceBlock_.queueRender()}setValue(e,t=!0){if(null!==e){var i,n=this.doClassValidation_(e);(e=this.processValidation_(e,n,t))instanceof Error||(n=null==(i=this.getValidator())?void 0:i.call(this,e),(i=this.processValidation_(e,n,t))instanceof Error||(e=this.sourceBlock_)&&e.disposed||((n=this.getValue())===i?this.doValueUpdate_(i):(this.doValueUpdate_(i),t&&e&&T()&&p(new(y(Hr.CHANGE$$module$build$src$core$events$utils))(e,"field",this.name||null,n,i)),this.isDirty_&&this.forceRerender())))}}processValidation_(e,t,i){return null===t?(this.doValueInvalid_(e,i),this.isDirty_&&this.forceRerender(),Error()):void 0===t?e:t}getValue(){return this.value_}doClassValidation_(e){return null==e?null:e}doValueUpdate_(e){this.value_=e,this.isDirty_=!0}doValueInvalid_(e,t){}onMouseDown_(e){this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&(e=this.sourceBlock_.workspace.getGesture(e))&&e.setStartField(this)}setTooltip(e){e||""===e||(e=this.sourceBlock_);const t=this.getClickTarget_();t?t.tooltip=e:this.tooltip_=e}getTooltip(){const e=this.getClickTarget_();return Gi(e||{tooltip:this.tooltip_})}getClickTarget_(){return this.clickTarget_||this.getSvgRoot()}getAbsoluteXY_(){return Te(this.getClickTarget_())}referencesVariables(){return!1}refreshVariableName(){}getParentInput(){let e=null;const t=this.getSourceBlock();if(!t)throw new Lu;const i=t.inputList;for(let n=0;n<t.inputList.length;n++){const t=i[n],s=t.fieldRow;for(let i=0;i<s.length;i++)if(s[i]===this){e=t;break}}return e}getFlipRtl(){return!1}isTabNavigable(){return!1}onShortcut(e){return!1}setCursorSvg(e){if(e){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(e),this.cursorSvg_=e}else this.cursorSvg_=null}setMarkerSvg(e){if(e){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(e),this.markerSvg_=e}else this.markerSvg_=null}updateMarkers_(){var e=this.getSourceBlock();if(!e)throw new Lu;(e=e.workspace).keyboardAccessibilityMode&&this.cursorSvg_&&e.getCursor().draw(),e.keyboardAccessibilityMode&&this.markerSvg_&&e.getMarker(au.LOCAL_MARKER).draw()}static fromJson(e){throw Error("Attempted to instantiate a field from the registry that hasn't defined a 'fromJson' method.")}};wu.NBSP="",wu.SKIP_SETUP=Symbol("SKIP_SETUP");var Lu=class extends Error{constructor(){super("The field has not yet been attached to its input. Call appendField to attach it.")}},xu={};xu.Field=wu,xu.UnattachedFieldError=Lu;var $u,Du=null,Mu=null,Pu=null,Bu="blocklyWidgetDiv",Fu="",Uu="",Hu={};Hu.createDom=yn,Hu.getDiv=bn,Hu.hide=Cn,Hu.hideIfOwner=On,Hu.hideIfOwnerIsInWorkspace=Nn,Hu.isVisible=kn,Hu.positionWithAnchor=Sn,Hu.repositionForWindowResize=xn,Hu.show=vn,Hu.testOnly_setDiv=In;var Gu=null,Vu={},ju=null,Wu={};Wu.callbackFactory=Hr.callbackFactory$$module$build$src$core$contextmenu,Wu.dispose=Gn,Wu.getCurrentBlock=$n,Wu.hide=Hn,Wu.setCurrentBlock=Dn,Wu.show=Mn;var Xu=class{constructor(){this.registry_=new Map,this.reset()}reset(){this.registry_.clear()}register(e){if(this.registry_.has(e.id))throw Error('Menu item with ID "'+e.id+'" is already registered.');this.registry_.set(e.id,e)}unregister(e){if(!this.registry_.has(e))throw Error('Menu item with ID "'+e+'" not found.');this.registry_.delete(e)}getItem(e){let t;return null!=(t=this.registry_.get(e))?t:null}getContextMenuOptions(e,t){const i=[];for(const s of this.registry_.values())if(e===s.scopeType){var n=s.preconditionFn(t);"hidden"!==n&&(n={text:"function"==typeof s.displayText?s.displayText(t):s.displayText,enabled:"enabled"===n,callback:s.callback,scope:t,weight:s.weight},i.push(n))}return i.sort((function(e,t){return e.weight-t.weight})),i}};!function(e){var t=e.ScopeType||(e.ScopeType={});t.BLOCK="block",t.WORKSPACE="workspace",t.COMMENT="comment",e.registry=new e}(Xu||(Xu={}));var Yu=Xu.ScopeType,zu={};zu.ContextMenuRegistry=Xu,zu.ScopeType=Yu;var Ku=class extends _c{constructor(e,t){super(e,t),this.dragStrategy=new Ec(this),this.workspace=e,this.view=new Tc(e),this.view.setSize(this.getSize()),this.view.setEditable(this.isEditable()),this.addModelUpdateBindings(),j(this.view.getSvgRoot(),"pointerdown",this,this.startGesture),j(this.view.getSvgRoot(),"wheel",this,(e=>{e.stopPropagation()}))}addModelUpdateBindings(){this.view.addTextChangeListener(((e,t)=>{super.setText(t)})),this.view.addSizeChangeListener(((e,t)=>{super.setSize(t)})),this.view.addOnCollapseListener((()=>{super.setCollapsed(this.view.isCollapsed())})),this.view.addDisposeListener((()=>{this.isDeadOrDying()||this.dispose()}))}setText(e){this.view.setText(e)}setSize(e){this.view.setSize(e)}setCollapsed(e){this.view.setCollapsed(e)}setEditable(e){super.setEditable(e),this.view.setEditable(this.isEditable())}getSvgRoot(){return this.view.getSvgRoot()}getSize(){return super.getSize()}getBoundingRectangle(){const e=this.getRelativeToSurfaceXY();var t,i;const n=null!=(i=null==(t=this.view)?void 0:t.getSize())?i:this.getSize();return this.workspace.RTL?(t=e.x-n.width,i=e.x):(t=e.x,i=e.x+n.width),new Tl(e.y,e.y+n.height,t,i)}moveBy(e,t,i){const n=this.getRelativeToSurfaceXY();e=new cl(n.x+e,n.y+t),this.moveTo(e,i)}moveTo(e,t){super.moveTo(e,t),this.view.moveTo(e)}moveDuringDrag(e){this.location=e,this.view.moveTo(e)}setDragging(e){e?te(this.getSvgRoot(),"blocklyDragging"):ne(this.getSvgRoot(),"blocklyDragging")}dispose(){this.disposing=!0,this.view.isDeadOrDying()||this.view.dispose(),super.dispose()}startGesture(e){const t=this.workspace.getGesture(e);t&&(t.handleCommentStart(e,this),Hr.setSelected$$module$build$src$core$common(this))}setDeleteStyle(e){e?te(this.getSvgRoot(),"blocklyDraggingDelete"):ne(this.getSvgRoot(),"blocklyDraggingDelete")}isMovable(){return this.dragStrategy.isMovable()}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){te(this.getSvgRoot(),"blocklySelected")}unselect(){ne(this.getSvgRoot(),"blocklySelected")}toCopyData(){return{paster:Cc.TYPE,commentState:Nt(this,{addCoordinates:!0})}}showContextMenu(e){const t=Xu.registry.getContextMenuOptions(Xu.ScopeType.COMMENT,{comment:this});Mn(e,t,this.workspace.RTL,this.workspace)}snapToGrid(){if(!this.isDeadOrDying()){var e=this.workspace.getGrid();if(null!=e&&e.shouldSnap()){var t=this.getRelativeToSurfaceXY();(e=e.alignXY(t))!==t&&this.moveTo(e,["snap"])}}}},qu={};qu.appendDomToWorkspace=ts,qu.blockToDom=Kn,qu.blockToDomWithXY=Xn,qu.clearWorkspaceAndLoadFromXml=Qn,qu.deleteNext=gs,qu.domToBlock=Hr.domToBlock$$module$build$src$core$xml,qu.domToBlockInternal=is,qu.domToPrettyText=Zn,qu.domToText=Jn,qu.domToVariables=ns,qu.domToWorkspace=Hr.domToWorkspace$$module$build$src$core$xml,qu.loadWorkspaceComment=es,qu.saveWorkspaceComment=jn,qu.variablesToDom=Wn,qu.workspaceToDom=Vn;var Ju=class extends Hc{constructor(e){super(e),this.type=Hr.CREATE$$module$build$src$core$events$utils,e&&(e.isShadow()&&(this.recordUndo=!1),this.xml=Xn(e),this.ids=b(e),this.json=Mt(e,{addCoordinates:!0}))}toJson(){const e=super.toJson();if(!this.xml)throw Error("The block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=Jn(this.xml),e.ids=this.ids,e.json=this.json,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Ju)).xml=Hr.textToDom$$module$build$src$core$utils$xml(e.xml),t.ids=e.ids,t.json=e.json,void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}run(e){const t=this.getEventWorkspace_();if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!Zu(t,this.ids))if(e)Wt(this.json,t);else for(e=0;e<this.ids.length;e++){const i=this.ids[e],n=t.getBlockById(i);n?n.dispose(!1):i===this.blockId&&console.warn("Can't uncreate non-existent block: "+i)}}},Zu=function(e,t){return t.map((t=>e.getBlockById(t))).filter((e=>e&&e.isShadow())).length===t.length};t(Xr.EVENT,Hr.CREATE$$module$build$src$core$events$utils,Ju);var Qu=class extends Oa{constructor(e,t){super(t),this.type="theme_change",this.themeName=e}toJson(){const e=super.toJson();if(!this.themeName)throw Error("The theme name is undefined. Either pass a theme name to the constructor, or call fromJson");return e.themeName=this.themeName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Qu)).themeName=e.themeName,t}};t(Xr.EVENT,"theme_change",Qu);var eh,th=class extends Oa{constructor(e,t,i,n,s){super(n),this.type=na,this.viewTop=e,this.viewLeft=t,this.scale=i,this.oldScale=s}toJson(){const e=super.toJson();if(void 0===this.viewTop)throw Error("The view top is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.viewLeft)throw Error("The view left is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.scale)throw Error("The scale is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.oldScale)throw Error("The old scale is undefined. Either pass a value to the constructor, or call fromJson");return e.viewTop=this.viewTop,e.viewLeft=this.viewLeft,e.scale=this.scale,e.oldScale=this.oldScale,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new th)).viewTop=e.viewTop,t.viewLeft=e.viewLeft,t.scale=e.scale,t.oldScale=e.oldScale,t}};t(Xr.EVENT,na,th),function(e){e[e.INPUT_VALUE=1]="INPUT_VALUE",e[e.OUTPUT_VALUE=2]="OUTPUT_VALUE",e[e.NEXT_STATEMENT=3]="NEXT_STATEMENT",e[e.PREVIOUS_STATEMENT=4]="PREVIOUS_STATEMENT"}(eh||(eh={}));var ih=class{constructor(e){this.connectionChecker=e,this.connections=[]}addConnection(e,t){t=this.calculateIndexForYPos(t),this.connections.splice(t,0,e)}findIndexOfConnection(e,t){if(!this.connections.length)return-1;const i=this.calculateIndexForYPos(t);if(i>=this.connections.length)return-1;t=e.y;let n=i;for(;0<=n&&this.connections[n].y===t;){if(this.connections[n]===e)return n;n--}for(n=i;n<this.connections.length&&this.connections[n].y===t;){if(this.connections[n]===e)return n;n++}return-1}calculateIndexForYPos(e){if(!this.connections.length)return 0;let t=0,i=this.connections.length;for(;t<i;){const n=Math.floor((t+i)/2);if(this.connections[n].y<e)t=n+1;else{if(!(this.connections[n].y>e)){t=n;break}i=n}}return t}removeConnection(e,t){if(-1===(e=this.findIndexOfConnection(e,t)))throw Error("Unable to find connection in connectionDB.");this.connections.splice(e,1)}getNeighbours(e,t){function i(e){const i=s-n[e].x,r=o-n[e].y;return Math.sqrt(i*i+r*r)<=t&&l.push(n[e]),r<t}const n=this.connections,s=e.x,o=e.y;e=0;let r=n.length-2,a=r;for(;e<a;)n[a].y<o?e=a:r=a,a=Math.floor((e+r)/2);const l=[];if(r=e=a,n.length){for(;0<=e&&i(e);)e--;do{r++}while(r<n.length&&i(r))}return l}isInYRange(e,t,i){return Math.abs(this.connections[e].y-t)<=i}searchForClosest(e,t,i){if(!this.connections.length)return{connection:null,radius:t};const n=e.y,s=e.x;e.x=s+i.x,e.y=n+i.y;var o=this.calculateIndexForYPos(e.y);i=null;let r,a=t,l=o-1;for(;0<=l&&this.isInYRange(l,e.y,t);)r=this.connections[l],this.connectionChecker.canConnect(e,r,!0,a)&&(i=r,a=r.distanceFrom(e)),l--;for(;o<this.connections.length&&this.isInYRange(o,e.y,t);)r=this.connections[o],this.connectionChecker.canConnect(e,r,!0,a)&&(i=r,a=r.distanceFrom(e)),o++;return e.x=s,e.y=n,{connection:i,radius:a}}static init(e){const t=[];return t[eh.INPUT_VALUE]=new ih(e),t[eh.OUTPUT_VALUE]=new ih(e),t[eh.NEXT_STATEMENT]=new ih(e),t[eh.PREVIOUS_STATEMENT]=new ih(e),t}},nh=null,sh=null,oh={};oh.connectionUiEffect=Ts,oh.disconnectUiEffect=Es,oh.disconnectUiStop=Is,oh.disposeUiEffect=fs;var rh=class{constructor(e){this.workspace=e,this.horizontalScrollEnabled_=this.workspace.isMovableHorizontally(),this.verticalScrollEnabled_=this.workspace.isMovableVertically(),this.startScrollXY_=new cl(e.scrollX,e.scrollY)}dispose(){this.workspace=null}startDrag(){R()&&R().unselect()}endDrag(e){this.drag(e)}drag(e){if(e=cl.sum(this.startScrollXY_,e),this.horizontalScrollEnabled_&&this.verticalScrollEnabled_)this.workspace.scroll(e.x,e.y);else if(this.horizontalScrollEnabled_)this.workspace.scroll(e.x,this.workspace.scrollY);else{if(!this.verticalScrollEnabled_)throw new TypeError("Invalid state.");this.workspace.scroll(this.workspace.scrollX,e.y)}}},ah=class{constructor(e,t){this.creatorWorkspace=t,this.mouseDownXY=new cl(0,0),this.startWorkspace_=this.targetBlock=this.startComment=this.startBlock=this.startIcon=this.startField=this.startBubble=null,this.hasExceededDragRadius=!1,this.boundEvents=[],this.workspaceDragger=this.dragger=null,this.dragging=!1,this.flyout=null,this.isMultiTouch_=this.isEnding_=this.gestureHasStarted=this.calledUpdateIsDragging=!1,this.cachedPoints=new Map,this.startDistance=this.previousScale=0,this.currentDropdownOwner=this.isPinchZoomEnabled=null,this.mostRecentEvent=e,this.currentDragDeltaXY=new cl(0,0)}dispose(){U(),Qi(),this.creatorWorkspace.clearGesture();for(const e of this.boundEvents)X(e);this.boundEvents.length=0,this.workspaceDragger&&this.workspaceDragger.dispose()}updateFromEvent(e){const t=new cl(e.clientX,e.clientY);this.updateDragDelta(t)&&(this.updateIsDragging(e),F()),this.mostRecentEvent=e}updateDragDelta(e){return this.currentDragDeltaXY=cl.difference(e,this.mouseDownXY),!this.hasExceededDragRadius&&(this.hasExceededDragRadius=cl.magnitude(this.currentDragDeltaXY)>(this.flyout?Hr.config$$module$build$src$core$config.flyoutDragRadius:Hr.config$$module$build$src$core$config.dragRadius))}updateIsDraggingFromFlyout(){let e;if(!this.targetBlock||null==(e=this.flyout)||!e.isBlockCreatable(this.targetBlock))return!1;if(!this.flyout.targetWorkspace)throw Error("Cannot update dragging from the flyout because the ' +\n          'flyout's target workspace is undefined");return!(this.flyout.isScrollable()&&!this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)||(this.startWorkspace_=this.flyout.targetWorkspace,this.startWorkspace_.updateScreenCalculationsIfScrolled(),Hr.getGroup$$module$build$src$core$events$utils()||Hr.setGroup$$module$build$src$core$events$utils(!0),this.startBlock=null,this.targetBlock=this.flyout.createBlock(this.targetBlock),Hr.setSelected$$module$build$src$core$common(this.targetBlock),0))}updateIsDraggingWorkspace(){if(!this.startWorkspace_)throw Error("Cannot update dragging the workspace because the start workspace is undefined");(this.flyout?this.flyout.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())&&(this.dragging=!0,this.workspaceDragger=new rh(this.startWorkspace_),this.workspaceDragger.startDrag())}updateIsDragging(e){if(!this.startWorkspace_)throw Error("Cannot update dragging because the start workspace is undefined");if(this.calledUpdateIsDragging)throw Error("updateIsDragging_ should only be called once per gesture.");this.calledUpdateIsDragging=!0,this.flyout&&this.updateIsDraggingFromFlyout();const t=R();t&&ys(t)&&t.isMovable()?(this.dragging=!0,this.dragger=this.createDragger(t,this.startWorkspace_),this.dragger.onDragStart(e),this.dragger.onDrag(e,this.currentDragDeltaXY)):this.updateIsDraggingWorkspace()}createDragger(e,t){return new(c(Xr.BLOCK_DRAGGER,this.creatorWorkspace.options,!0))(e,t)}doStart(e){if(!this.startWorkspace_)throw Error("Cannot start the touch gesture becauase the start workspace is undefined");this.isPinchZoomEnabled=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch,Y(e)?this.cancel():(this.gestureHasStarted=!0,Is(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),this.currentDropdownOwner=hi(),this.startWorkspace_.hideChaff(!!this.flyout),this.startWorkspace_.markFocused(),this.mostRecentEvent=e,Zi(),z(e)?this.handleRightClick(e):("pointerdown"===e.type.toLowerCase()&&"mouse"!==e.pointerType&&B(e,this),this.mouseDownXY=new cl(e.clientX,e.clientY),this.bindMouseEvents(e),this.isEnding_||this.handleTouchStart(e)))}bindMouseEvents(e){this.boundEvents.push(j(document,"pointerdown",null,this.handleStart.bind(this),!0)),this.boundEvents.push(j(document,"pointermove",null,this.handleMove.bind(this),!0)),this.boundEvents.push(j(document,"pointerup",null,this.handleUp.bind(this),!0)),e.preventDefault(),e.stopPropagation()}handleStart(e){this.isDragging()||(this.handleTouchStart(e),this.isMultiTouch()&&F())}handleMove(e){this.isDragging()&&H(e)||!this.isMultiTouch()?(this.updateFromEvent(e),this.workspaceDragger?this.workspaceDragger.drag(this.currentDragDeltaXY):this.dragger&&this.dragger.onDrag(this.mostRecentEvent,this.currentDragDeltaXY),e.preventDefault(),e.stopPropagation()):this.isMultiTouch()&&(this.handleTouchMove(e),F())}handleUp(e){if(this.isDragging()||this.handleTouchEnd(e),!this.isMultiTouch()||this.isDragging()){if(!H(e))return;if(this.updateFromEvent(e),F(),this.isEnding_)return void console.log("Trying to end a gesture recursively.");this.isEnding_=!0,this.dragger?this.dragger.onDragEnd(e,this.currentDragDeltaXY):this.workspaceDragger?this.workspaceDragger.endDrag(this.currentDragDeltaXY):this.isBubbleClick()||this.isCommentClick()||(this.isFieldClick()?this.doFieldClick():this.isIconClick()?this.doIconClick():this.isBlockClick()?this.doBlockClick():this.isWorkspaceClick()&&this.doWorkspaceClick(e))}e.preventDefault(),e.stopPropagation(),this.dispose()}handleTouchStart(e){var t=G(e);this.cachedPoints.set(t,this.getTouchPoint(e));var i=Array.from(this.cachedPoints.keys());2===i.length&&(t=this.cachedPoints.get(i[0]),i=this.cachedPoints.get(i[1]),this.startDistance=cl.distance(t,i),this.isMultiTouch_=!0,e.preventDefault())}handleTouchMove(e){const t=G(e);this.cachedPoints.set(t,this.getTouchPoint(e)),this.isPinchZoomEnabled&&2===this.cachedPoints.size?this.handlePinch(e):this.handleMove(e)}handlePinch(e){var t=Array.from(this.cachedPoints.keys()),i=this.cachedPoints.get(t[0]);if(t=this.cachedPoints.get(t[1]),i=cl.distance(i,t)/this.startDistance,0<this.previousScale&&1/0>this.previousScale){if(t=0<(t=i-this.previousScale)?5*t:6*t,!this.startWorkspace_)throw Error("Cannot handle a pinch because the start workspace is undefined");const n=this.startWorkspace_,s=K(e,n.getParentSvg(),n.getInverseScreenCTM());n.zoom(s.x,s.y,t)}this.previousScale=i,e.preventDefault()}handleTouchEnd(e){e=G(e),this.cachedPoints.has(e)&&this.cachedPoints.delete(e),2>this.cachedPoints.size&&(this.cachedPoints.clear(),this.previousScale=0)}getTouchPoint(e){return this.startWorkspace_?new cl(e.pageX,e.pageY):null}isMultiTouch(){return this.isMultiTouch_}cancel(){this.isEnding_||(F(),this.dragger?this.dragger.onDragEnd(this.mostRecentEvent,this.currentDragDeltaXY):this.workspaceDragger&&this.workspaceDragger.endDrag(this.currentDragDeltaXY),this.dispose())}handleRightClick(e){this.targetBlock?(this.bringBlockToFront(),this.targetBlock.workspace.hideChaff(!!this.flyout),this.targetBlock.showContextMenu(e)):this.startBubble?this.startBubble.showContextMenu(e):this.startComment?(this.startComment.workspace.hideChaff(),this.startComment.showContextMenu(e)):this.startWorkspace_&&!this.flyout&&(this.startWorkspace_.hideChaff(),this.startWorkspace_.showContextMenu(e)),e.preventDefault(),e.stopPropagation(),this.dispose()}handleWsStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleWsStart, but the gesture had already been started.");this.setStartWorkspace(t),this.mostRecentEvent=e,this.startBlock||this.startBubble||this.startComment||Hr.setSelected$$module$build$src$core$common(null),this.doStart(e)}fireWorkspaceClick(e){p(new(y(ta))(null,e.id,"workspace"))}handleFlyoutStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleFlyoutStart, but the gesture had already been started.");this.setStartFlyout(t),this.handleWsStart(e,t.getWorkspace())}handleBlockStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBlockStart, but the gesture had already been started.");this.setStartBlock(t),this.mostRecentEvent=e}handleBubbleStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBubbleStart, but the gesture had already been started.");this.setStartBubble(t),this.mostRecentEvent=e}handleCommentStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleCommentStart, but the gesture had already been started.");this.setStartComment(t),this.mostRecentEvent=e}doFieldClick(){if(!this.startField)throw Error("Cannot do a field click because the start field is undefined");this.currentDropdownOwner!==this.startField&&this.startField.showEditor(this.mostRecentEvent),this.bringBlockToFront()}doIconClick(){if(!this.startIcon)throw Error("Cannot do an icon click because the start icon is undefined");this.bringBlockToFront(),this.startIcon.onClick()}doBlockClick(){if(this.flyout&&this.flyout.autoClose){if(!this.targetBlock)throw Error("Cannot do a block click because the target block is undefined");if(this.targetBlock.isEnabled()){Hr.getGroup$$module$build$src$core$events$utils()||Hr.setGroup$$module$build$src$core$events$utils(!0);var e=this.flyout.createBlock(this.targetBlock);e.snapToGrid(),e.bumpNeighbours()}}else{if(!this.startWorkspace_)throw Error("Cannot do a block click because the start workspace is undefined");e=new(y(ta))(this.startBlock,this.startWorkspace_.id,"block"),p(e)}this.bringBlockToFront(),Hr.setGroup$$module$build$src$core$events$utils(!1)}doWorkspaceClick(e){e=this.creatorWorkspace,R()&&R().unselect(),this.fireWorkspaceClick(this.startWorkspace_||e)}bringBlockToFront(){this.targetBlock&&!this.flyout&&this.targetBlock.bringToFront()}setStartField(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartField, but the gesture had already been started.");this.startField||(this.startField=e)}setStartIcon(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartIcon, but the gesture had already been started.");this.startIcon||(this.startIcon=e)}setStartBubble(e){this.startBubble||(this.startBubble=e)}setStartComment(e){this.startComment||(this.startComment=e)}setStartBlock(e){this.startBlock||this.startBubble||(this.startBlock=e,Hr.setSelected$$module$build$src$core$common(this.startBlock),e.isInFlyout&&e!==e.getRootBlock()?this.setTargetBlock(e.getRootBlock()):this.setTargetBlock(e))}setTargetBlock(e){e.isShadow()?this.setTargetBlock(e.getParent()):this.targetBlock=e}setStartWorkspace(e){this.startWorkspace_||(this.startWorkspace_=e)}setStartFlyout(e){this.flyout||(this.flyout=e)}isBubbleClick(){return!!this.startBubble&&!this.hasExceededDragRadius}isCommentClick(){return!!this.startComment&&!this.hasExceededDragRadius}isBlockClick(){return!(!this.startBlock||this.hasExceededDragRadius||this.isFieldClick()||this.isIconClick())}isFieldClick(){return!!this.startField&&this.startField.isClickable()&&!this.hasExceededDragRadius&&(!this.flyout||this.startField.isClickableInFlyout(this.flyout.autoClose))}isIconClick(){if(!this.startIcon)return!1;const e=!this.flyout||!this.startIcon.isClickableInFlyout||this.startIcon.isClickableInFlyout(this.flyout.autoClose);return!this.hasExceededDragRadius&&e}isWorkspaceClick(){return!(this.startBlock||this.startBubble||this.startField||this.hasExceededDragRadius)}getCurrentDragger(){let e,t;return null!=(t=null!=(e=this.workspaceDragger)?e:this.dragger)?t:null}isDragging(){return this.dragging}hasStarted(){return this.gestureHasStarted}static inProgress(){const e=k();for(let t,i=0;t=e[i];i++)if(t.currentGesture_)return!0;return!1}},lh=class{constructor(e,t){let i,n,s;this.pattern=e,this.scale=1,this.spacing=null!=(i=t.spacing)?i:0,this.length=null!=(n=t.length)?n:1,this.line2=(this.line1=e.firstChild)&&this.line1.nextSibling,this.snapToGrid=null!=(s=t.snap)&&s}setSpacing(e){this.spacing=e,this.update(this.scale)}getSpacing(){return this.spacing}setLength(e){this.length=e,this.update(this.scale)}getLength(){return this.length}setSnapToGrid(e){this.snapToGrid=e}shouldSnap(){return this.snapToGrid}getPatternId(){return this.pattern.id}update(e){this.scale=e;var t=this.spacing*e;this.pattern.setAttribute("width",`${t}`),this.pattern.setAttribute("height",`${t}`);let i=(t=Math.floor(this.spacing/2)+.5)-this.length/2,n=t+this.length/2;t*=e,i*=e,n*=e,this.setLineAttributes(this.line1,e,i,n,t,t),this.setLineAttributes(this.line2,e,t,t,i,n)}setLineAttributes(e,t,i,n,s,o){e&&(e.setAttribute("stroke-width",`${t}`),e.setAttribute("x1",`${i}`),e.setAttribute("y1",`${s}`),e.setAttribute("x2",`${n}`),e.setAttribute("y2",`${o}`))}moveTo(e,t){this.pattern.setAttribute("x",`${e}`),this.pattern.setAttribute("y",`${t}`)}alignXY(e){var t=this.getSpacing();const i=t/2,n=Math.round(Math.round((e.x-i)/t)*t+i);return t=Math.round(Math.round((e.y-i)/t)*t+i),n===e.x&&t===e.y?e:new cl(n,t)}static createDom(e,t,i){let n,s;if(e=ee(_l.PATTERN,{id:"blocklyGridPattern"+e,patternUnits:"userSpaceOnUse"},i),0<(null!=(n=t.length)?n:1)&&0<(null!=(s=t.spacing)?s:0)){let i;ee(_l.LINE,{stroke:t.colour},e),null!=(i=t.length)&&i&&ee(_l.LINE,{stroke:t.colour},e)}else ee(_l.LINE,{},e);return e}},ch={};ch.deepMerge=vs;var uh=class{constructor(e,i,n,s){this.name=e,this.startHats=!1,this.blockStyles=i||Object.create(null),this.categoryStyles=n||Object.create(null),this.componentStyles=s||Object.create(null),this.fontStyle=Object.create(null),t(Xr.THEME,e,this,!0)}getClassName(){return this.name+"-theme"}setBlockStyle(e,t){this.blockStyles[e]=t}setCategoryStyle(e,t){this.categoryStyles[e]=t}getComponentStyle(e){if(!(e=this.componentStyles[e]))return null;if("string"==typeof e){const t=this.getComponentStyle(e);if(t)return t}return`${e}`}setComponentStyle(e,t){this.componentStyles[e]=t}setFontStyle(e){this.fontStyle=e}setStartHats(e){this.startHats=e}static defineTheme(e,t){e=e.toLowerCase();const i=new uh(e);let n=t.base;if(n){if("string"==typeof n){let e;n=null!=(e=a(Xr.THEME,n))?e:void 0}n instanceof uh&&(vs(i,n),i.name=e)}return vs(i.blockStyles,t.blockStyles),vs(i.categoryStyles,t.categoryStyles),vs(i.componentStyles,t.componentStyles),vs(i.fontStyle,t.fontStyle),null!==t.startHats&&(i.startHats=t.startHats),i}},hh=new uh("classic",{colour_blocks:{colourPrimary:"20"},list_blocks:{colourPrimary:"260"},logic_blocks:{colourPrimary:"210"},loop_blocks:{colourPrimary:"120"},math_blocks:{colourPrimary:"230"},procedure_blocks:{colourPrimary:"290"},text_blocks:{colourPrimary:"160"},variable_blocks:{colourPrimary:"330"},variable_dynamic_blocks:{colourPrimary:"310"},hat_blocks:{colourPrimary:"330",hat:"cap"}},{colour_category:{colour:"20"},list_category:{colour:"260"},logic_category:{colour:"210"},loop_category:{colour:"120"},math_category:{colour:"230"},procedure_category:{colour:"290"},text_category:{colour:"160"},variable_category:{colour:"330"},variable_dynamic_category:{colour:"310"}}),dh=class{constructor(e){this.gridPattern=null,this.getMetrics=this.setMetrics=void 0;let t=null,i=!1;var n=!1,s=!1,o=!1,r=!1,a=!1;const l=!!e.readOnly;var c;l||(t=Le(null!=(c=e.toolbox)?c:null),i=De(t),n=void 0===(n=e.trashcan)?i:n,s=void 0===(s=e.collapse)?i:s,o=void 0===(o=e.comments)?i:o,r=void 0===(r=e.disable)?i:r,a=void 0===(a=e.sounds)||a),c=e.maxTrashcanContents,n?void 0===c&&(c=32):c=0;const u=!!e.rtl;let h=e.horizontalLayout;void 0===h&&(h=!1);var d="end"!==e.toolboxPosition;d=h?d?$l.TOP:$l.BOTTOM:d===u?$l.RIGHT:$l.LEFT;let p=e.css;void 0===p&&(p=!0);let g="https://blockly-demo.appspot.com/static/media/";e.media&&(g=e.media.endsWith("/")?e.media:e.media+"/");const m=e.oneBasedIndex,f=e.renderer||"geras",_=e.plugins||{};let T,E,b,I=e.modalInputs;void 0===I&&(I=!0),this.RTL=u,this.oneBasedIndex=void 0===m||m,this.collapse=s,this.comments=o,this.disable=r,this.readOnly=l,this.maxBlocks=e.maxBlocks||1/0,this.maxInstances=null!=(T=e.maxInstances)?T:null,this.modalInputs=I,this.pathToMedia=g,this.hasCategories=i,this.moveOptions=dh.parseMoveOptions_(e,i),this.hasScrollbars=!!this.moveOptions.scrollbars,this.hasTrashcan=n,this.maxTrashcanContents=c,this.hasSounds=a,this.hasCss=p,this.horizontalLayout=h,this.languageTree=t,this.gridOptions=dh.parseGridOptions_(e),this.zoomOptions=dh.parseZoomOptions_(e),this.toolboxPosition=d,this.theme=dh.parseThemeOptions_(e),this.renderer=f,this.rendererOverrides=null!=(E=e.rendererOverrides)?E:null,this.parentWorkspace=null!=(b=e.parentWorkspace)?b:null,this.plugins=_}static parseMoveOptions_(e,t){const i=e.move||{},n={};return void 0===i.scrollbars&&void 0===e.scrollbars?n.scrollbars=t:"object"==typeof i.scrollbars?(n.scrollbars={horizontal:!!i.scrollbars.horizontal,vertical:!!i.scrollbars.vertical},n.scrollbars.horizontal&&n.scrollbars.vertical?n.scrollbars=!0:n.scrollbars.horizontal||n.scrollbars.vertical||(n.scrollbars=!1)):n.scrollbars=!!i.scrollbars||!!e.scrollbars,n.wheel=n.scrollbars&&void 0!==i.wheel?!!i.wheel:"object"==typeof n.scrollbars,n.drag=!(!n.scrollbars||void 0!==i.drag&&!i.drag),n}static parseZoomOptions_(e){e=e.zoom||{};const t={};return t.controls=void 0!==e.controls&&!!e.controls,t.wheel=void 0!==e.wheel&&!!e.wheel,t.startScale=void 0===e.startScale?1:Number(e.startScale),t.maxScale=void 0===e.maxScale?3:Number(e.maxScale),t.minScale=void 0===e.minScale?.3:Number(e.minScale),t.scaleSpeed=void 0===e.scaleSpeed?1.2:Number(e.scaleSpeed),t.pinch=void 0===e.pinch?t.wheel||t.controls:!!e.pinch,t}static parseGridOptions_(e){e=e.grid||{};const t={};return t.spacing=Number(e.spacing)||0,t.colour=e.colour||"#888",t.length=void 0===e.length?1:Number(e.length),t.snap=0<t.spacing&&!!e.snap,t}static parseThemeOptions_(e){return"string"==typeof(e=e.theme||hh)?a(Xr.THEME,e):e instanceof uh?e:uh.defineTheme(e.name||"builtin"+u(),e)}};Hr.Names$$module$build$src$core$names=class{constructor(e,t){this.db=new Map,this.dbReverse=new Set,this.variableMap=null,this.variablePrefix=t||"",this.reservedWords=new Set(e?e.split(","):[])}reset(){this.db.clear(),this.dbReverse.clear(),this.variableMap=null}setVariableMap(e){this.variableMap=e}getNameForUserVariable(e){return this.variableMap?(e=this.variableMap.getVariableById(e))?e.name:null:(console.warn("Deprecated call to Names.prototype.getName without defining a variable map. To fix, add the following code in your generator's init() function:\nBlockly.YourGeneratorName.nameDB_.setVariableMap(workspace.getVariableMap());"),null)}populateVariables(e){e=Hr.allUsedVarModels$$module$build$src$core$variables(e);for(let t=0;t<e.length;t++)this.getName(e[t].getId(),Hr.NameType$$module$build$src$core$names.VARIABLE)}populateProcedures(e){throw Error("The implementation of populateProcedures should be monkey-patched in by blockly.ts")}getName(e,t){let i=e;t===Hr.NameType$$module$build$src$core$names.VARIABLE&&(e=this.getNameForUserVariable(e))&&(i=e),e=i.toLowerCase();const n=t===Hr.NameType$$module$build$src$core$names.VARIABLE||t===Hr.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"";this.db.has(t)||this.db.set(t,new Map);const s=this.db.get(t);return s.has(e)?n+s.get(e):(t=this.getDistinctName(i,t),s.set(e,t.substr(n.length)),t)}getUserNames(e){let t;return(e=null==(t=this.db.get(e))?void 0:t.keys())?Array.from(e):[]}getDistinctName(e,t){e=this.safeName(e);let i,n,s,o=null;for(;this.dbReverse.has(e+(null!=(i=o)?i:""))||this.reservedWords.has(e+(null!=(n=o)?n:""));)o=o?o+1:2;return e+=null!=(s=o)?s:"",this.dbReverse.add(e),(t===Hr.NameType$$module$build$src$core$names.VARIABLE||t===Hr.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"")+e}safeName(e){return e?(e=encodeURI(e.replace(/ /g,"_")).replace(/[^\w]/g,"_"),"0123456789".includes(e[0])&&(e="my_"+e)):e=Hr.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed",e}static equals(e,t){return e.toLowerCase()===t.toLowerCase()}},function(e){(e=e.NameType||(e.NameType={})).DEVELOPER_VARIABLE="DEVELOPER_VARIABLE",e.VARIABLE="VARIABLE",e.PROCEDURE="PROCEDURE"}(Hr.Names$$module$build$src$core$names||(Hr.Names$$module$build$src$core$names={})),Hr.NameType$$module$build$src$core$names=Hr.Names$$module$build$src$core$names.NameType,Hr.Names$$module$build$src$core$names.DEVELOPER_VARIABLE_TYPE=Hr.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE,{NameType:Hr.NameType$$module$build$src$core$names}.Names=Hr.Names$$module$build$src$core$names;var ph=class extends Map{constructor(){super()}set(e,t){return this.get(e)===t||(super.set(e,t),ks(t)&&t.startPublishing()),this}delete(e){const t=this.get(e);return(e=super.delete(e))?(ks(t)&&t.stopPublishing(),e):e}clear(){if(this.size)for(const e of this.keys())this.delete(e)}add(e){return this.set(e.getId(),e)}getProcedures(){return[...this.values()]}},gh=class{constructor(e){this.sourceBlock=e,this.offsetInBlock=new cl(0,0),this.workspaceLocation=new cl(0,0),this.svgRoot=null,this.tooltip=e}getType(){throw Error("Icons must implement getType")}initView(e){if(!this.svgRoot){var t=this.sourceBlock;this.svgRoot=ee(_l.G,{class:"blocklyIconGroup"}),t.getSvgRoot().appendChild(this.svgRoot),this.updateSvgRootOffset(),j(this.svgRoot,"pointerdown",this,e),this.svgRoot.tooltip=this,Wi(this.svgRoot)}}dispose(){Xi(this.svgRoot),oe(this.svgRoot)}getWeight(){return-1}getSize(){return new El(0,0)}setTooltip(e){this.tooltip=null!=e?e:this.sourceBlock}getTooltip(){return this.tooltip}applyColour(){}updateEditable(){}updateCollapsed(){this.svgRoot&&(this.sourceBlock.isCollapsed()?this.svgRoot.style.display="none":this.svgRoot.style.display="block",oi(this)&&this.setBubbleVisible(!1))}hideForInsertionMarker(){this.svgRoot&&(this.svgRoot.style.display="none")}isShownWhenCollapsed(){return!1}setOffsetInBlock(e){this.offsetInBlock=e,this.updateSvgRootOffset()}updateSvgRootOffset(){let e;null==(e=this.svgRoot)||e.setAttribute("transform",`translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`)}onLocationChange(e){this.workspaceLocation=cl.sum(e,this.offsetInBlock)}onClick(){}isClickableInFlyout(e){return!0}},mh={fromJsonInternal:As},fh={TEST_ONLY:mh};fh.fromJson=Hr.fromJson$$module$build$src$core$field_registry,fh.register=Os,fh.unregister=Ns;var _h=class extends wu{constructor(e,t,i){super(wu.SKIP_SETUP),this.svgArrow=this.arrow=this.imageElement=this.menu_=this.selectedMenuItem=null,this.SERIALIZABLE=!0,this.CURSOR="default",this.clickTarget_=this.suffixField=this.prefixField=this.generatedOptions=null,e!==wu.SKIP_SETUP&&(Array.isArray(e)?(ws(e),e=Ss(e),this.menuGenerator_=e.options,this.prefixField=e.prefix||null,this.suffixField=e.suffix||null):this.menuGenerator_=e,this.selectedOption=this.getOptions(!1)[0],i&&this.configure_(i),this.setValue(this.selectedOption[1]),t&&this.setValidator(t))}fromXml(e){this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e.textContent)}loadState(e){this.loadLegacyState(_h,e)||(this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e))}initView(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot(),this.createTextElement_(),this.imageElement=ee(_l.IMAGE,{},this.fieldGroup_),this.getConstants().FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_(),this.borderRect_&&te(this.borderRect_,"blocklyDropdownRect")}shouldAddBorderRect_(){let e;return!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!(null!=(e=this.getSourceBlock())&&e.isShadow())}createTextArrow_(){let e,t;this.arrow=ee(_l.TSPAN,{},this.textElement_),this.arrow.appendChild(document.createTextNode(null!=(e=this.getSourceBlock())&&e.RTL?_h.ARROW_CHAR+" ":" "+_h.ARROW_CHAR)),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.arrow.setAttribute("dominant-baseline","central"),null!=(t=this.getSourceBlock())&&t.RTL?this.getTextElement().insertBefore(this.arrow,this.textContent_):this.getTextElement().appendChild(this.arrow)}createSVGArrow_(){this.svgArrow=ee(_l.IMAGE,{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(dl,"xlink:href",this.getConstants().FIELD_DROPDOWN_SVG_ARROW_DATAURI)}showEditor_(e){var t=this.getSourceBlock();if(!t)throw new Lu;this.dropdownCreate(),this.menu_.openingCoords=e&&"number"==typeof e.clientX?new cl(e.clientX,e.clientY):null,pi(),e=this.menu_.render(di()),te(e,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV&&(t=t.getColour(),gi(t,this.sourceBlock_.style.colourTertiary)),fi(this,this.dropdownDispose_.bind(this)),this.menu_.focus(),this.selectedMenuItem&&(this.menu_.setHighlighted(this.selectedMenuItem),Ie(this.selectedMenuItem.getElement(),di(),!0)),this.applyColour()}dropdownCreate(){const e=this.getSourceBlock();if(!e)throw new Lu;const t=new Rc;t.setRole(kc.LISTBOX),this.menu_=t;const i=this.getOptions(!1);this.selectedMenuItem=null;for(let s=0;s<i.length;s++){const[o,r]=i[s];if("object"==typeof o){var n=new Image(o.width,o.height);n.src=o.src,n.alt=o.alt||""}else n=o;(n=new wc(n,r)).setRole(kc.OPTION),n.setRightToLeft(e.RTL),n.setCheckable(!0),t.addChild(n),n.setChecked(r===this.value_),r===this.value_&&(this.selectedMenuItem=n),n.onAction(this.handleMenuActionEvent,this)}}dropdownDispose_(){this.menu_&&this.menu_.dispose(),this.selectedMenuItem=this.menu_=null,this.applyColour()}handleMenuActionEvent(e){Oi(this,!0),this.onItemSelected_(this.menu_,e)}onItemSelected_(e,t){this.setValue(t.getValue())}isOptionListDynamic(){return"function"==typeof this.menuGenerator_}getOptions(e){if(!this.menuGenerator_)throw TypeError("A menu generator was never defined.");return Array.isArray(this.menuGenerator_)?this.menuGenerator_:(e&&this.generatedOptions||(this.generatedOptions=this.menuGenerator_(),ws(this.generatedOptions)),this.generatedOptions)}doClassValidation_(e){return this.getOptions(!0).some((t=>t[1]===e))?e:(this.sourceBlock_&&console.warn("Cannot set the dropdown's value to an unavailable option. Block type: "+this.sourceBlock_.type+", Field name: "+this.name+", Value: "+e),null)}doValueUpdate_(e){super.doValueUpdate_(e),e=this.getOptions(!0);for(let t,i=0;t=e[i];i++)t[1]===this.value_&&(this.selectedOption=t)}applyColour(){const e=this.sourceBlock_.style;this.borderRect_&&(this.borderRect_.setAttribute("stroke",e.colourTertiary),this.menu_?this.borderRect_.setAttribute("fill",e.colourTertiary):this.borderRect_.setAttribute("fill","transparent")),this.sourceBlock_&&this.arrow&&(this.sourceBlock_.isShadow()?this.arrow.style.fill=e.colourSecondary:this.arrow.style.fill=e.colourPrimary)}render_(){this.getTextContent().nodeValue="",this.imageElement.style.display="none";const e=this.selectedOption&&this.selectedOption[0];e&&"object"==typeof e?this.renderSelectedImage(e):this.renderSelectedText(),this.positionBorderRect_()}renderSelectedImage(e){const t=this.getSourceBlock();if(!t)throw new Lu;this.imageElement.style.display="",this.imageElement.setAttributeNS(dl,"xlink:href",e.src),this.imageElement.setAttribute("height",String(e.height)),this.imageElement.setAttribute("width",String(e.width));const i=Number(e.height);e=Number(e.width);var n=!!this.borderRect_;const s=Math.max(n?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,i+Th);let o;n=n?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,o=this.svgArrow?this.positionSVGArrow(e+n,s/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2):he(this.arrow,this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY),this.size_.width=e+o+2*n,this.size_.height=s;let r=0;t.RTL?this.imageElement.setAttribute("x",`${n+o}`):(r=e+o,this.getTextElement().setAttribute("text-anchor","end"),this.imageElement.setAttribute("x",`${n}`)),this.imageElement.setAttribute("y",String(s/2-i/2)),this.positionTextElement_(r+n,e+o)}renderSelectedText(){this.getTextContent().nodeValue=this.getDisplayText_();var e=this.getTextElement();te(e,"blocklyDropdownText"),e.setAttribute("text-anchor","start");var t=!!this.borderRect_;e=Math.max(t?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.getConstants().FIELD_TEXT_HEIGHT);const i=he(this.getTextElement(),this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);t=t?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let n=0;this.svgArrow&&(n=this.positionSVGArrow(i+t,e/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2)),this.size_.width=i+n+2*t,this.size_.height=e,this.positionTextElement_(t,i)}positionSVGArrow(e,t){if(!this.svgArrow)return 0;const i=this.getSourceBlock();if(!i)throw new Lu;const n=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,s=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,o=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE;return this.svgArrow.setAttribute("transform","translate("+(i.RTL?n:e+s)+","+t+")"),o+s}getText_(){if(!this.selectedOption)return null;const e=this.selectedOption[0];return"object"==typeof e?e.alt:e}static fromJson(e){if(!e.options)throw Error("options are required for the dropdown field. The options property must be assigned an array of [humanReadableValue, languageNeutralValue] tuples.");return new this(e.options,void 0,e)}};_h.CHECKMARK_OVERHANG=25,_h.MAX_MENU_HEIGHT_VH=.45,_h.ARROW_CHAR="";var Th=10;Os("field_dropdown",_h);var Eh,bh=class{constructor(e,t){this.bubble=e,this.workspace=t,this.startLoc=null}isMovable(){return!0}startDrag(){let e;Hr.getGroup$$module$build$src$core$events$utils()||Hr.setGroup$$module$build$src$core$events$utils(!0),this.startLoc=this.bubble.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1),null==(e=this.workspace.getLayerManager())||e.moveToDragLayer(this.bubble),this.bubble.setDragging&&this.bubble.setDragging(!0)}drag(e){this.bubble.moveDuringDrag(e)}endDrag(){let e;this.workspace.setResizesEnabled(!0),Hr.setGroup$$module$build$src$core$events$utils(!1),null==(e=this.workspace.getLayerManager())||e.moveOffDragLayer(this.bubble,100),this.bubble.setDragging(!1)}revertDrag(){this.startLoc&&this.bubble.moveDuringDrag(this.startLoc)}},Ih=class{constructor(e,t,i){this.workspace=e,this.anchor=t,this.ownerRect=i,this.size=new El(0,0),this.colour="#ffffff",this.disposed=!1,this.relativeLeft=this.relativeTop=0,this.dragStrategy=new bh(this,this.workspace),this.id=u(),this.svgRoot=ee(_l.G,{class:"blocklyBubble"},e.getBubbleCanvas()),e=ee(_l.G,{filter:`url(#${this.workspace.getRenderer().getConstants().embossFilterId})`},this.svgRoot),this.tail=ee(_l.PATH,{class:"blocklyBubbleTail"},e),this.background=ee(_l.RECT,{class:"blocklyDraggable",x:0,y:0,rx:Eh.BORDER_WIDTH,ry:Eh.BORDER_WIDTH},e),this.contentContainer=ee(_l.G,{},this.svgRoot),j(this.background,"pointerdown",this,this.onMouseDown)}dispose(){oe(this.svgRoot),this.disposed=!0}setAnchorLocation(e,t=!1){this.anchor=e,t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}setPositionRelativeToAnchor(e,t){this.relativeLeft=e,this.relativeTop=t,this.positionRelativeToAnchor(),this.renderTail()}getSize(){return this.size}setSize(e,t=!1){e.width=Math.max(e.width,Eh.MIN_SIZE),e.height=Math.max(e.height,Eh.MIN_SIZE),this.size=e,this.background.setAttribute("width",`${e.width}`),this.background.setAttribute("height",`${e.height}`),t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}getColour(){return this.colour}setColour(e){this.colour=e,this.tail.setAttribute("fill",e),this.background.setAttribute("fill",e)}onMouseDown(e){let t;null==(t=this.workspace.getGesture(e))||t.handleBubbleStart(e,this),Hr.setSelected$$module$build$src$core$common(this)}positionRelativeToAnchor(){let e=this.anchor.x;e=this.workspace.RTL?e-(this.relativeLeft+this.size.width):e+this.relativeLeft,this.moveTo(e,this.relativeTop+this.anchor.y)}moveTo(e,t){this.svgRoot.setAttribute("transform",`translate(${e}, ${t})`)}positionByRect(e=new Tl(0,0,0,0)){var t=this.workspace.getMetricsManager().getViewMetrics(!0),i=this.getOptimalRelativeLeft(t),n=this.getOptimalRelativeTop(t);const s={x:i,y:-this.size.height-this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT},o={x:-this.size.width-30,y:n};n={x:e.getWidth(),y:n};var r={x:i,y:e.getHeight()};i=e.getWidth()<e.getHeight()?n:r,e=e.getWidth()<e.getHeight()?r:n,n=this.getOverlap(s,t),r=this.getOverlap(o,t);const a=this.getOverlap(i,t);t=this.getOverlap(e,t),n===(t=Math.max(n,r,a,t))?(this.relativeLeft=s.x,this.relativeTop=s.y):r===t?(this.relativeLeft=o.x,this.relativeTop=o.y):a===t?(this.relativeLeft=i.x,this.relativeTop=i.y):(this.relativeLeft=e.x,this.relativeTop=e.y),this.positionRelativeToAnchor()}getOverlap(e,t){var i=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x+this.anchor.x;return e=e.y+this.anchor.y,Math.max(0,Math.min(1,(Math.min(i+this.size.width,t.left+t.width)-Math.max(i,t.left))*(Math.min(e+this.size.height,t.top+t.height)-Math.max(e,t.top))/(this.size.width*this.size.height)))}getOptimalRelativeLeft(e){let t=-this.size.width/4;if(this.size.width>e.width)return t;if(e=this.getWorkspaceViewRect(e),this.workspace.RTL){var i=this.anchor.x-t;i-this.size.width<e.left?t=-(e.left-this.anchor.x+this.size.width):i>e.right&&(t=-(e.right-this.anchor.x))}else{const n=(i=t+this.anchor.x)+this.size.width;i<e.left?t=e.left-this.anchor.x:n>e.right&&(t=e.right-this.anchor.x-this.size.width)}return t}getOptimalRelativeTop(e){let t=-this.size.height/4;if(this.size.height>e.height)return t;const i=this.anchor.y+t,n=i+this.size.height;return i<(e=this.getWorkspaceViewRect(e)).top?t=e.top-this.anchor.y:n>e.bottom&&(t=e.bottom-this.anchor.y-this.size.height),t}getWorkspaceViewRect(e){const t=e.top;let i=e.top+e.height,n=e.left;return e=e.left+e.width,i-=this.getScrollbarThickness(),this.workspace.RTL?n-=this.getScrollbarThickness():e-=this.getScrollbarThickness(),new Tl(t,i,n,e)}getScrollbarThickness(){return kl.scrollbarThickness/this.workspace.scale}renderTail(){const e=[];var t=this.size.width/2,i=this.size.height/2,n=-this.relativeLeft,s=-this.relativeTop;if(t===n&&i===s)e.push("M "+t+","+i);else{s-=i,n-=t,this.workspace.RTL&&(n*=-1);var o=Math.sqrt(s*s+n*n),r=Math.acos(n/o);0>s&&(r=2*Math.PI-r);var a=r+Math.PI/2;a>2*Math.PI&&(a-=2*Math.PI);var l=Math.sin(a);const c=Math.cos(a);let u=(this.size.width+this.size.height)/Eh.TAIL_THICKNESS;u=Math.min(u,this.size.width,this.size.height)/4,n=t+(a=1-Eh.ANCHOR_RADIUS/o)*n,s=i+a*s,a=t+u*c;const h=i+u*l;t-=u*c,i-=u*l,(l=r+(l=ri(this.workspace.RTL?-Eh.TAIL_ANGLE:Eh.TAIL_ANGLE)))>2*Math.PI&&(l-=2*Math.PI),r=Math.sin(l)*o/Eh.TAIL_BEND,o=Math.cos(l)*o/Eh.TAIL_BEND,e.push("M"+a+","+h),e.push("C"+(a+o)+","+(h+r)+" "+n+","+s+" "+n+","+s),e.push("C"+n+","+s+" "+(t+o)+","+(i+r)+" "+t+","+i)}let c;e.push("z"),null==(c=this.tail)||c.setAttribute("d",e.join(" "))}bringToFront(){let e;const t=null==(e=this.svgRoot)?void 0:e.parentNode;return!(!this.svgRoot||(null==t?void 0:t.lastChild)===this.svgRoot||(null==t||t.appendChild(this.svgRoot),0))}getRelativeToSurfaceXY(){return new cl(this.workspace.RTL?-this.relativeLeft+this.anchor.x-this.size.width:this.anchor.x+this.relativeLeft,this.anchor.y+this.relativeTop)}getSvgRoot(){return this.svgRoot}moveDuringDrag(e){this.moveTo(e.x,e.y),this.relativeLeft=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x-this.anchor.x,this.relativeTop=e.y-this.anchor.y,this.renderTail()}setDragging(e){}setDeleteStyle(e){}isDeletable(){return!1}showContextMenu(e){}isMovable(){return!0}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){}unselect(){}};Eh=Ih,Ih.BORDER_WIDTH=6,Ih.DOUBLE_BORDER=2*Eh.BORDER_WIDTH,Ih.MIN_SIZE=Eh.DOUBLE_BORDER,Ih.TAIL_THICKNESS=1,Ih.TAIL_ANGLE=20,Ih.TAIL_BEND=4,Ih.ANCHOR_RADIUS=8;var yh=class extends Ih{constructor(e,t,i,n){let s,o;super(t,i,n),this.workspace=t,this.anchor=i,this.ownerRect=n,this.autoLayout=!0,t=new dh(e),this.validateWorkspaceOptions(t),this.svgDialog=ee(_l.SVG,{x:Ih.BORDER_WIDTH,y:Ih.BORDER_WIDTH},this.contentContainer),e.parentWorkspace=this.workspace,this.miniWorkspace=this.newWorkspaceSvg(new dh(e)),this.miniWorkspace.internalIsMutator=!0,e=this.miniWorkspace.createDom("blocklyMutatorBackground"),this.svgDialog.appendChild(e),t.languageTree&&(e.insertBefore(this.miniWorkspace.addFlyout(_l.G),this.miniWorkspace.getCanvas()),null==(e=this.miniWorkspace.getFlyout())||e.init(this.miniWorkspace),null==e||e.show(t.languageTree)),this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this)),null==(s=this.miniWorkspace.getFlyout())||null==(o=s.getWorkspace())||o.addChangeListener(this.onWorkspaceChange.bind(this)),this.updateBubbleSize()}dispose(){this.miniWorkspace.dispose(),super.dispose()}getWorkspace(){return this.miniWorkspace}addWorkspaceChangeListener(e){this.miniWorkspace.addChangeListener(e)}validateWorkspaceOptions(e){if(e.hasCategories)throw Error("The miniworkspace bubble does not support toolboxes with categories");if(e.hasTrashcan)throw Error("The miniworkspace bubble does not support trashcans");if(e.zoomOptions.controls||e.zoomOptions.wheel||e.zoomOptions.pinch)throw Error("The miniworkspace bubble does not support zooming");if(e.moveOptions.scrollbars||e.moveOptions.wheel||e.moveOptions.drag)throw Error("The miniworkspace bubble does not scrolling/moving the workspace");if(e.horizontalLayout)throw Error("The miniworkspace bubble does not support horizontal layouts")}onWorkspaceChange(){this.bumpBlocksIntoBounds(),this.updateBubbleSize()}bumpBlocksIntoBounds(){if(!this.miniWorkspace.isDragging())for(const e of this.miniWorkspace.getTopBlocks(!1)){const t=e.getRelativeToSurfaceXY();if(20>t.y&&e.moveBy(0,20-t.y),e.RTL){let i=-20;const n=this.miniWorkspace.getFlyout();n&&(i-=n.getWidth()),t.x>i&&e.moveBy(i-t.x,0)}else 20>t.x&&e.moveBy(20-t.x,0)}}updateBubbleSize(){if(!this.miniWorkspace.isDragging()){var e=this.getSize(),t=this.calculateWorkspaceSize();Math.abs(e.width-t.width)<yh.MINIMUM_VIEW_CHANGE&&Math.abs(e.height-t.height)<yh.MINIMUM_VIEW_CHANGE||(this.svgDialog.setAttribute("width",`${t.width}px`),this.svgDialog.setAttribute("height",`${t.height}px`),this.miniWorkspace.setCachedParentSvgSize(t.width,t.height),this.miniWorkspace.RTL&&this.miniWorkspace.getCanvas().setAttribute("transform",`translate(${t.width}, 0)`),this.setSize(new El(t.width+Ih.DOUBLE_BORDER,t.height+Ih.DOUBLE_BORDER),this.autoLayout),this.miniWorkspace.resize(),this.miniWorkspace.recordDragTargets())}}calculateWorkspaceSize(){var e=this.miniWorkspace.getCanvas().getBBox();let t=e.width+yh.MARGIN;e=e.height+yh.MARGIN;const i=this.miniWorkspace.getFlyout();if(i){const n=i.getWorkspace().getMetricsManager().getScrollMetrics();e=Math.max(e,n.height+20),t+=i.getWidth()}return new El(t,e)}updateBlockStyles(){for(var e of this.miniWorkspace.getAllBlocks(!1))e.setStyle(e.getStyleName());let t;if(e=null==(t=this.miniWorkspace.getFlyout())?void 0:t.getWorkspace())for(const t of e.getAllBlocks(!1))t.setStyle(t.getStyleName())}moveDuringDrag(e){super.moveDuringDrag(e),this.autoLayout=!1}moveTo(e,t){super.moveTo(e,t),this.miniWorkspace.recordDragTargets()}newWorkspaceSvg(e){throw Error("The implementation of newWorkspaceSvg should be monkey-patched in by blockly.ts")}};yh.MINIMUM_VIEW_CHANGE=10,yh.MARGIN=3*Ih.DOUBLE_BORDER,Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon=class extends gh{constructor(e,t){super(t),this.flyoutBlockTypes=e,this.sourceBlock=t,this.saveConnectionsListener=this.updateWorkspacePid=this.rootBlock=this.miniWorkspaceBubble=null}getType(){return Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE}initView(e){this.svgRoot||(super.initView(e),ee(_l.RECT,{class:"blocklyIconShape",rx:"4",ry:"4",height:"16",width:"16"},this.svgRoot),ee(_l.PATH,{class:"blocklyIconSymbol",d:"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z"},this.svgRoot),ee(_l.CIRCLE,{class:"blocklyIconShape",r:"2.7",cx:"8",cy:"8"},this.svgRoot),te(this.svgRoot,"blockly-icon-mutator"))}dispose(){let e;super.dispose(),null==(e=this.miniWorkspaceBubble)||e.dispose()}getWeight(){return Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT}getSize(){return new El(17,17)}applyColour(){let e,t;super.applyColour(),null==(e=this.miniWorkspaceBubble)||e.setColour(this.sourceBlock.style.colourPrimary),null==(t=this.miniWorkspaceBubble)||t.updateBlockStyles()}updateCollapsed(){super.updateCollapsed(),this.sourceBlock.isCollapsed()&&this.setBubbleVisible(!1)}onLocationChange(e){let t;super.onLocationChange(e),null==(t=this.miniWorkspaceBubble)||t.setAnchorLocation(this.getAnchorLocation())}onClick(){super.onClick(),this.sourceBlock.isEditable()&&this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.miniWorkspaceBubble}setBubbleVisible(e){const t=this;return Ur.asyncExecutePromiseGeneratorFunction((function*(){if(t.bubbleIsVisible()!==e){if(yield _t(),e){let e;t.miniWorkspaceBubble=new yh(t.getMiniWorkspaceConfig(),t.sourceBlock.workspace,t.getAnchorLocation(),t.getBubbleOwnerRect()),t.applyColour(),t.createRootBlock(),t.addSaveConnectionsListener(),null==(e=t.miniWorkspaceBubble)||e.addWorkspaceChangeListener(t.createMiniWorkspaceChangeListener())}else{let e;null==(e=t.miniWorkspaceBubble)||e.dispose(),t.miniWorkspaceBubble=null,t.saveConnectionsListener&&t.sourceBlock.workspace.removeChangeListener(t.saveConnectionsListener),t.saveConnectionsListener=null}p(new(y(ia))(t.sourceBlock,e,"mutator"))}}))}getMiniWorkspaceConfig(){let e;const t={disable:!1,media:this.sourceBlock.workspace.options.pathToMedia,rtl:this.sourceBlock.RTL,renderer:this.sourceBlock.workspace.options.renderer,rendererOverrides:null!=(e=this.sourceBlock.workspace.options.rendererOverrides)?e:void 0};return this.flyoutBlockTypes.length&&(t.toolbox={kind:"flyoutToolbox",contents:this.flyoutBlockTypes.map((e=>({kind:"block",type:e})))}),t}getAnchorLocation(){return cl.sum(this.workspaceLocation,new cl(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new Tl(e.y,e.y+e.height,e.x,e.x+e.width)}createRootBlock(){if(!this.sourceBlock.decompose)throw Error("Blocks with mutator icons must include a decompose method");for(var e of(this.rootBlock=this.sourceBlock.decompose(this.miniWorkspaceBubble.getWorkspace()),this.rootBlock.getDescendants(!1)))e.queueRender();let t,i,n,s;this.rootBlock.setMovable(!1),this.rootBlock.setDeletable(!1),e=null!=(s=null==(t=this.miniWorkspaceBubble)||null==(i=t.getWorkspace())||null==(n=i.getFlyout())?void 0:n.getWidth())?s:0,this.rootBlock.moveBy(this.rootBlock.RTL?-(e+16):16,16)}addSaveConnectionsListener(){this.sourceBlock.saveConnections&&this.rootBlock&&(this.saveConnectionsListener=()=>{this.sourceBlock.saveConnections&&this.rootBlock&&this.sourceBlock.saveConnections(this.rootBlock)},this.saveConnectionsListener(),this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener))}createMiniWorkspaceChangeListener(){return e=>{Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon.isIgnorableMutatorEvent(e)||this.updateWorkspacePid||(this.updateWorkspacePid=setTimeout((()=>{this.updateWorkspacePid=null,this.recomposeSourceBlock()}),0))}}static isIgnorableMutatorEvent(e){return e.isUiEvent||e.type===Hr.CREATE$$module$build$src$core$events$utils||e.type===Hr.CHANGE$$module$build$src$core$events$utils&&"disabled"===e.element}recomposeSourceBlock(){if(this.rootBlock){if(!this.sourceBlock.compose)throw Error("Blocks with mutator icons must include a compose method");var e=Hr.getGroup$$module$build$src$core$events$utils();e||Hr.setGroup$$module$build$src$core$events$utils(!0);var t=Gc.getExtraBlockState_(this.sourceBlock);this.sourceBlock.compose(this.rootBlock);var i=Gc.getExtraBlockState_(this.sourceBlock);t!==i&&p(new(y(Hr.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"mutation",null,t,i)),Hr.setGroup$$module$build$src$core$events$utils(e)}}getWorkspace(){let e;return null==(e=this.miniWorkspaceBubble)?void 0:e.getWorkspace()}},Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE=Kl.MUTATOR,Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT=1,Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon;var vh=Object.create(null),Ch={allExtensions:vh};Hr.register$$module$build$src$core$extensions("parent_tooltip_when_inline",Ws);var kh={TEST_ONLY:Ch};kh.apply=$s,kh.buildTooltipForDropdown=Hr.buildTooltipForDropdown$$module$build$src$core$extensions,kh.buildTooltipWithFieldText=Hr.buildTooltipWithFieldText$$module$build$src$core$extensions,kh.isRegistered=xs,kh.register=Hr.register$$module$build$src$core$extensions,kh.registerMixin=Hr.registerMixin$$module$build$src$core$extensions,kh.registerMutator=Hr.registerMutator$$module$build$src$core$extensions,kh.runAfterPageLoad=Vs,kh.unregister=Ls;var Oh,Nh=new Set,Ah={};Ah.warn=Xs,function(e){e[e.WIN_KEY_FF_LINUX=0]="WIN_KEY_FF_LINUX",e[e.MAC_ENTER=3]="MAC_ENTER",e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.NUM_CENTER=12]="NUM_CENTER",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESC=27]="ESC",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN",e[e.PLUS_SIGN=43]="PLUS_SIGN",e[e.PRINT_SCREEN=44]="PRINT_SCREEN",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.FF_SEMICOLON=59]="FF_SEMICOLON",e[e.FF_EQUALS=61]="FF_EQUALS",e[e.FF_DASH=173]="FF_DASH",e[e.FF_HASH=163]="FF_HASH",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.AT_SIGN=64]="AT_SIGN",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.META=91]="META",e[e.WIN_KEY_RIGHT=92]="WIN_KEY_RIGHT",e[e.CONTEXT_MENU=93]="CONTEXT_MENU",e[e.NUM_ZERO=96]="NUM_ZERO",e[e.NUM_ONE=97]="NUM_ONE",e[e.NUM_TWO=98]="NUM_TWO",e[e.NUM_THREE=99]="NUM_THREE",e[e.NUM_FOUR=100]="NUM_FOUR",e[e.NUM_FIVE=101]="NUM_FIVE",e[e.NUM_SIX=102]="NUM_SIX",e[e.NUM_SEVEN=103]="NUM_SEVEN",e[e.NUM_EIGHT=104]="NUM_EIGHT",e[e.NUM_NINE=105]="NUM_NINE",e[e.NUM_MULTIPLY=106]="NUM_MULTIPLY",e[e.NUM_PLUS=107]="NUM_PLUS",e[e.NUM_MINUS=109]="NUM_MINUS",e[e.NUM_PERIOD=110]="NUM_PERIOD",e[e.NUM_DIVISION=111]="NUM_DIVISION",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NUMLOCK=144]="NUMLOCK",e[e.SCROLL_LOCK=145]="SCROLL_LOCK",e[e.FIRST_MEDIA_KEY=166]="FIRST_MEDIA_KEY",e[e.LAST_MEDIA_KEY=183]="LAST_MEDIA_KEY",e[e.SEMICOLON=186]="SEMICOLON",e[e.DASH=189]="DASH",e[e.EQUALS=187]="EQUALS",e[e.COMMA=188]="COMMA",e[e.PERIOD=190]="PERIOD",e[e.SLASH=191]="SLASH",e[e.APOSTROPHE=192]="APOSTROPHE",e[e.TILDE=192]="TILDE",e[e.SINGLE_QUOTE=222]="SINGLE_QUOTE",e[e.OPEN_SQUARE_BRACKET=219]="OPEN_SQUARE_BRACKET",e[e.BACKSLASH=220]="BACKSLASH",e[e.CLOSE_SQUARE_BRACKET=221]="CLOSE_SQUARE_BRACKET",e[e.WIN_KEY=224]="WIN_KEY",e[e.MAC_FF_META=224]="MAC_FF_META",e[e.MAC_WK_CMD_LEFT=91]="MAC_WK_CMD_LEFT",e[e.MAC_WK_CMD_RIGHT=93]="MAC_WK_CMD_RIGHT",e[e.WIN_IME=229]="WIN_IME",e[e.VK_NONAME=252]="VK_NONAME",e[e.PHANTOM=255]="PHANTOM"}(Oh||(Oh={}));var Sh={};Sh.arc=eo,Sh.curve=zs,Sh.line=Zs,Sh.lineOnAxis=Qs,Sh.lineTo=Js,Sh.moveBy=qs,Sh.moveTo=Ks,Sh.point=Ys;var Rh={};Rh.Coordinate=cl,Rh.KeyCodes=Oh,Rh.Rect=Tl,Rh.Size=El,Rh.Svg=_l,Rh.aria=Sc,Rh.array=il,Rh.browserEvents=tl,Rh.colour=Su,Rh.deprecation=Ah,Rh.dom=fl,Rh.extensions=kh,Rh.idGenerator=ma,Rh.math=Vc,Rh.object=ch,Rh.parsing=Ru,Rh.string=lu,Rh.style=Il,Rh.svgMath=Cl,Rh.svgPaths=Sh,Rh.toolbox=Hl,Rh.userAgent=Za,Rh.xml=xl;var wh={};wh.register=to,wh.unregister=io;var Lh=class extends Ih{constructor(e,t,i,n){super(t,i,n),this.text=e,this.workspace=t,this.anchor=i,this.ownerRect=n,this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}getText(){return this.text}setText(e){this.text=e,oe(this.paragraph),this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}stringToSvg(e,t){return t=this.createParagraph(t),e=this.createSpans(t,e),this.workspace.RTL&&this.rightAlignSpans(t.getBBox().width,e),t}createParagraph(e){return ee(_l.TEXT,{class:"blocklyText blocklyBubbleText blocklyNoPointerEvents",y:Ih.BORDER_WIDTH},e)}createSpans(e,t){return t.split("\n").map((t=>{const i=ee(_l.TSPAN,{dy:"1em",x:Ih.BORDER_WIDTH},e);return t=document.createTextNode(t),i.appendChild(t),i}))}rightAlignSpans(e,t){for(const i of t)i.setAttribute("text-anchor","end"),i.setAttribute("x",`${e+Ih.BORDER_WIDTH}`)}updateBubbleSize(){const e=this.paragraph.getBBox();this.setSize(new El(e.width+2*Ih.BORDER_WIDTH,e.height+2*Ih.BORDER_WIDTH),!0)}},xh=class extends Ih{constructor(e,t,i){super(e,t,i),this.workspace=e,this.anchor=t,this.ownerRect=i,this.resizePointerMoveListener=this.resizePointerUpListener=null,this.textChangeListeners=[],this.sizeChangeListeners=[],this.text="",this.DEFAULT_SIZE=new El(160+Ih.DOUBLE_BORDER,80+Ih.DOUBLE_BORDER),this.MIN_SIZE=new El(45+Ih.DOUBLE_BORDER,20+Ih.DOUBLE_BORDER),te(this.svgRoot,"blocklyTextInputBubble"),({inputRoot:this.inputRoot,textArea:this.textArea}=this.createEditor(this.contentContainer)),this.resizeGroup=this.createResizeHandle(this.svgRoot,e),this.setSize(this.DEFAULT_SIZE,!0)}getText(){return this.text}setText(e){this.text=e,this.textArea.value=e,this.onTextChange()}addTextChangeListener(e){this.textChangeListeners.push(e)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}createEditor(e){e=ee(_l.FOREIGNOBJECT,{x:Ih.BORDER_WIDTH,y:Ih.BORDER_WIDTH},e);const t=document.createElementNS(hl,"body");t.setAttribute("xmlns",hl),t.className="blocklyMinimalBody";const i=document.createElementNS(hl,"textarea");return i.className="blocklyTextarea blocklyText",i.setAttribute("dir",this.workspace.RTL?"RTL":"LTR"),t.appendChild(i),e.appendChild(t),this.bindTextAreaEvents(i),setTimeout((()=>{i.focus()}),0),{inputRoot:e,textArea:i}}bindTextAreaEvents(e){j(e,"wheel",this,(e=>{e.stopPropagation()})),j(e,"focus",this,this.onStartEdit,!0),j(e,"change",this,this.onTextChange)}createResizeHandle(e,t){return e=ee(_l.IMAGE,{class:"blocklyResizeHandle",href:`${t.options.pathToMedia}resize-handle.svg`},e),j(e,"pointerdown",this,this.onResizePointerDown),e}setSize(e,t=!1){e.width=Math.max(e.width,this.MIN_SIZE.width),e.height=Math.max(e.height,this.MIN_SIZE.height);const i=e.width-Ih.DOUBLE_BORDER,n=e.height-Ih.DOUBLE_BORDER;this.inputRoot.setAttribute("width",`${i}`),this.inputRoot.setAttribute("height",`${n}`),this.resizeGroup.setAttribute("y",`${n}`),this.workspace.RTL?this.resizeGroup.setAttribute("x",""+-Ih.DOUBLE_BORDER):this.resizeGroup.setAttribute("x",`${i}`),super.setSize(e,t),this.onSizeChange()}getSize(){return super.getSize()}onResizePointerDown(e){this.bringToFront(),z(e)||(this.workspace.startDrag(e,new cl(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=j(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=j(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation()}onResizePointerUp(e){U(),this.resizePointerUpListener&&(X(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(X(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(e){e=this.workspace.moveDrag(e),this.setSize(new El(this.workspace.RTL?-e.x:e.x,e.y),!1),this.onSizeChange()}onStartEdit(){this.bringToFront()&&this.textArea.focus()}onTextChange(){this.text=this.textArea.value;for(const e of this.textChangeListeners)e()}onSizeChange(){for(const e of this.sizeChangeListeners)e()}};Z("\n.blocklyTextInputBubble .blocklyTextarea {\n  background-color: var(--commentFillColour);\n  border: 0;\n  box-sizing: border-box;\n  display: block;\n  outline: 0;\n  padding: 5px;\n  resize: none;\n  width: 100%;\n  height: 100%;\n}\n");var $h=class extends gh{constructor(e){super(e),this.sourceBlock=e,this.textBubble=this.textInputBubble=null,this.text="",this.bubbleSize=new El(160,80),this.bubbleVisiblity=!1}getType(){return $h.TYPE}initView(e){this.svgRoot||(super.initView(e),ee(_l.CIRCLE,{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},this.svgRoot),ee(_l.PATH,{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},this.svgRoot),ee(_l.RECT,{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},this.svgRoot),te(this.svgRoot,"blockly-icon-comment"))}dispose(){let e,t;super.dispose(),null==(e=this.textInputBubble)||e.dispose(),null==(t=this.textBubble)||t.dispose()}getWeight(){return $h.WEIGHT}getSize(){return new El(17,17)}applyColour(){super.applyColour();const e=this.sourceBlock.style.colourPrimary;let t,i;null==(t=this.textInputBubble)||t.setColour(e),null==(i=this.textBubble)||i.setColour(e)}updateEditable(){const e=this,t=()=>super.updateEditable;return Ur.asyncExecutePromiseGeneratorFunction((function*(){t().call(e),e.bubbleIsVisible()&&(yield e.setBubbleVisible(!1),yield e.setBubbleVisible(!0))}))}onLocationChange(e){let t,i;super.onLocationChange(e),e=this.getAnchorLocation(),null==(t=this.textInputBubble)||t.setAnchorLocation(e),null==(i=this.textBubble)||i.setAnchorLocation(e)}setText(e){const t=this.text;let i,n;p(new(y(Hr.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"comment",null,t,e)),this.text=e,null==(i=this.textInputBubble)||i.setText(this.text),null==(n=this.textBubble)||n.setText(this.text)}getText(){return this.text}setBubbleSize(e){let t;this.bubbleSize=e,null==(t=this.textInputBubble)||t.setSize(this.bubbleSize,!0)}getBubbleSize(){return this.bubbleSize}saveState(){return this.text?{text:this.text,pinned:this.bubbleIsVisible(),height:this.bubbleSize.height,width:this.bubbleSize.width}:null}loadState(e){let t,i,n,s;this.text=null!=(t=e.text)?t:"",this.bubbleSize=new El(null!=(i=e.width)?i:160,null!=(n=e.height)?n:80),this.bubbleVisiblity=null!=(s=e.pinned)&&s,this.setBubbleVisible(this.bubbleVisiblity)}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}onTextChange(){if(this.textInputBubble){var e=this.textInputBubble.getText();this.text!==e&&(p(new(y(Hr.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"comment",null,this.text,e)),this.text=e)}}onSizeChange(){this.textInputBubble&&(this.bubbleSize=this.textInputBubble.getSize())}bubbleIsVisible(){return this.bubbleVisiblity}setBubbleVisible(e){const t=this;return Ur.asyncExecutePromiseGeneratorFunction((function*(){t.bubbleVisiblity!==e&&(t.bubbleVisiblity=e,yield _t(),!t.sourceBlock.rendered||t.sourceBlock.isInFlyout||t.sourceBlock.isInsertionMarker()||(e?(t.sourceBlock.isEditable()?t.showEditableBubble():t.showNonEditableBubble(),t.applyColour()):t.hideBubble(),p(new(y(ia))(t.sourceBlock,e,"comment"))))}))}showEditableBubble(){this.textInputBubble=new xh(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0),this.textInputBubble.addTextChangeListener((()=>this.onTextChange())),this.textInputBubble.addSizeChangeListener((()=>this.onSizeChange()))}showNonEditableBubble(){this.textBubble=new Lh(this.getText(),this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect())}hideBubble(){let e,t;null==(e=this.textInputBubble)||e.dispose(),this.textInputBubble=null,null==(t=this.textBubble)||t.dispose(),this.textBubble=null}getAnchorLocation(){return cl.sum(this.workspaceLocation,new cl(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new Tl(e.y,e.y+e.height,e.x,e.x+e.width)}};$h.TYPE=Kl.COMMENT,$h.WEIGHT=3,to($h.TYPE,$h);var Dh=class extends gh{constructor(e){super(e),this.sourceBlock=e,this.textMap=new Map,this.textBubble=null}getType(){return Dh.TYPE}initView(e){this.svgRoot||(super.initView(e),ee(_l.PATH,{class:"blocklyIconShape",d:"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z"},this.svgRoot),ee(_l.PATH,{class:"blocklyIconSymbol",d:"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z"},this.svgRoot),ee(_l.RECT,{class:"blocklyIconSymbol",x:"7",y:"11",height:"2",width:"2"},this.svgRoot),te(this.svgRoot,"blockly-icon-warning"))}dispose(){let e;super.dispose(),null==(e=this.textBubble)||e.dispose()}getWeight(){return Dh.WEIGHT}getSize(){return new El(17,17)}applyColour(){let e;super.applyColour(),null==(e=this.textBubble)||e.setColour(this.sourceBlock.style.colourPrimary)}updateCollapsed(){}isShownWhenCollapsed(){return!0}onLocationChange(e){let t;super.onLocationChange(e),null==(t=this.textBubble)||t.setAnchorLocation(this.getAnchorLocation())}addMessage(e,t){if(this.textMap.get(t)===e)return this;let i;return e?this.textMap.set(t,e):this.textMap.delete(t),null==(i=this.textBubble)||i.setText(this.getText()),this}getText(){return[...this.textMap.values()].join("\n")}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.textBubble}setBubbleVisible(e){const t=this;return Ur.asyncExecutePromiseGeneratorFunction((function*(){if(t.bubbleIsVisible()!==e){if(yield _t(),e)t.textBubble=new Lh(t.getText(),t.sourceBlock.workspace,t.getAnchorLocation(),t.getBubbleOwnerRect()),t.applyColour();else{let e;null==(e=t.textBubble)||e.dispose(),t.textBubble=null}p(new(y(ia))(t.sourceBlock,e,"warning"))}}))}getAnchorLocation(){return cl.sum(this.workspaceLocation,new cl(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new Tl(e.y,e.y+e.height,e.x,e.x+e.width)}};Dh.TYPE=Kl.WARNING,Dh.WEIGHT=2;var Mh=class extends Error{constructor(e){super(`Tried to append an icon of type ${e.getType()} when an icon of that type already exists on the block. Use getIcon to access the existing icon.`),this.icon=e}},Ph={};Ph.DuplicateIconType=Mh;var Bh,Fh={};Fh.CommentIcon=$h,Fh.Icon=gh,Fh.IconType=Kl,Fh.MutatorIcon=Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon,Fh.WarningIcon=Dh,Fh.exceptions=Ph,Fh.registry=wh,Hr.DEFAULT_ARG$$module$build$src$core$procedures="x",(Bh={CATEGORY_NAME:"PROCEDURE",DEFAULT_ARG:Hr.DEFAULT_ARG$$module$build$src$core$procedures}).ObservableProcedureMap=ph,Bh.allProcedures=no,Bh.findLegalName=Hr.findLegalName$$module$build$src$core$procedures,Bh.flyoutCategory=ao,Bh.getCallers=ho,Bh.getDefinition=Hr.getDefinition$$module$build$src$core$procedures,Bh.isNameUsed=ro,Bh.isProcedureBlock=Cs,Bh.mutateCallers=Hr.mutateCallers$$module$build$src$core$procedures,Bh.mutatorOpenListener=co,Bh.rename=Hr.rename$$module$build$src$core$procedures;var Uh=new class{constructor(){this.NONE=0,this.FIELD=1,this.HAT=2,this.ICON=4,this.SPACER=8,this.BETWEEN_ROW_SPACER=16,this.IN_ROW_SPACER=32,this.EXTERNAL_VALUE_INPUT=64,this.INPUT=128,this.INLINE_INPUT=256,this.STATEMENT_INPUT=512,this.CONNECTION=1024,this.PREVIOUS_CONNECTION=2048,this.NEXT_CONNECTION=4096,this.OUTPUT_CONNECTION=8192,this.CORNER=16384,this.LEFT_SQUARE_CORNER=32768,this.LEFT_ROUND_CORNER=65536,this.RIGHT_SQUARE_CORNER=131072,this.RIGHT_ROUND_CORNER=262144,this.JAGGED_EDGE=524288,this.ROW=1048576,this.TOP_ROW=2097152,this.BOTTOM_ROW=4194304,this.INPUT_ROW=8388608,this.LEFT_CORNER=this.LEFT_SQUARE_CORNER|this.LEFT_ROUND_CORNER,this.RIGHT_CORNER=this.RIGHT_SQUARE_CORNER|this.RIGHT_ROUND_CORNER,this.nextTypeValue_=16777216}getType(e){return Object.prototype.hasOwnProperty.call(this,e)||(this[e]=this.nextTypeValue_,this.nextTypeValue_<<=1),this[e]}isField(e){return e.type&this.FIELD}isHat(e){return e.type&this.HAT}isIcon(e){return e.type&this.ICON}isSpacer(e){return e.type&this.SPACER}isInRowSpacer(e){return e.type&this.IN_ROW_SPACER}isInput(e){return e.type&this.INPUT}isExternalInput(e){return e.type&this.EXTERNAL_VALUE_INPUT}isInlineInput(e){return e.type&this.INLINE_INPUT}isStatementInput(e){return e.type&this.STATEMENT_INPUT}isPreviousConnection(e){return e.type&this.PREVIOUS_CONNECTION}isNextConnection(e){return e.type&this.NEXT_CONNECTION}isPreviousOrNextConnection(e){return e.type&(this.PREVIOUS_CONNECTION|this.NEXT_CONNECTION)}isLeftRoundedCorner(e){return e.type&this.LEFT_ROUND_CORNER}isRightRoundedCorner(e){return e.type&this.RIGHT_ROUND_CORNER}isLeftSquareCorner(e){return e.type&this.LEFT_SQUARE_CORNER}isRightSquareCorner(e){return e.type&this.RIGHT_SQUARE_CORNER}isCorner(e){return e.type&this.CORNER}isJaggedEdge(e){return e.type&this.JAGGED_EDGE}isRow(e){return e.type&this.ROW}isBetweenRowSpacer(e){return e.type&this.BETWEEN_ROW_SPACER}isTopRow(e){return e.type&this.TOP_ROW}isBottomRow(e){return e.type&this.BOTTOM_ROW}isTopOrBottomRow(e){return e.type&(this.TOP_ROW|this.BOTTOM_ROW)}isInputRow(e){return e.type&this.INPUT_ROW}},Hh=class{constructor(e){this.centerline=this.xPos=this.height=this.width=0,this.constants_=e,this.type=Uh.NONE,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}},Gh=class{constructor(e){this.elements=[],this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0,this.hasStatement=this.hasExternalInput=!1,this.statementEdge=0,this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=!1,this.align=null,this.constants_=e,this.type=Uh.ROW,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}getLastInput(){for(let e=this.elements.length-1;0<=e;e--){const t=this.elements[e];if(Uh.isInput(t))return t}return null}measure(){throw Error("Unexpected attempt to measure a base Row.")}startsWithElemSpacer(){return!0}endsWithElemSpacer(){return!0}getFirstSpacer(){for(let e=0;e<this.elements.length;e++){const t=this.elements[e];if(Uh.isSpacer(t))return t}return null}getLastSpacer(){for(let e=this.elements.length-1;0<=e;e--){const t=this.elements[e];if(Uh.isSpacer(t))return t}return null}},Vh=class extends Gh{constructor(e){super(e),this.hasNextConnection=!1,this.connection=null,this.baseline=this.descenderHeight=0,this.type|=Uh.BOTTOM_ROW}hasLeftSquareCorner(e){return!!e.outputConnection||!!e.getNextBlock()}hasRightSquareCorner(e){return!0}measure(){let e=0,t=0,i=0;for(let n=0;n<this.elements.length;n++){const s=this.elements[n];t+=s.width,Uh.isSpacer(s)||(Uh.isNextConnection(s)?i=Math.max(i,s.height):e=Math.max(e,s.height))}this.width=Math.max(this.minWidth,t),this.height=Math.max(this.minHeight,e)+i,this.descenderHeight=i,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},jh=class extends Hh{constructor(e,t){super(e),this.connectionModel=t,this.type|=Uh.CONNECTION,this.shape=this.constants_.shapeFor(t),this.isDynamicShape="isDynamic"in this.shape&&this.shape.isDynamic,this.highlighted=t.isHighlighted()}},Wh=class extends jh{constructor(e,t){super(e,t.connection),this.input=t,this.connectionOffsetY=this.connectionOffsetX=0,this.type|=Uh.INPUT,this.align=t.align,(this.connectedBlock=t.connection&&t.connection.targetBlock()?t.connection.targetBlock():null)?(e=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=e.width,this.connectedBlockHeight=e.height):this.connectedBlockHeight=this.connectedBlockWidth=0}},Xh=class extends Wh{constructor(e,t){super(e,t),this.height=0,this.type|=Uh.EXTERNAL_VALUE_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height,this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionHeight=this.shape.height,this.connectionWidth=this.shape.width}},Yh=class extends Hh{constructor(e,t,i){super(e),this.field=t,this.parentInput=i,this.isEditable=t.EDITABLE,this.flipRtl=t.getFlipRtl(),this.type|=Uh.FIELD,e=this.field.getSize(),this.height=e.height,this.width=e.width}},zh=class extends Hh{constructor(e){super(e),this.type|=Uh.HAT,this.height=this.constants_.START_HAT.height,this.width=this.constants_.START_HAT.width,this.ascenderHeight=this.height}},Kh=class extends Hh{constructor(e,t){super(e),this.icon=t,this.flipRtl=!1,this.type|=Uh.ICON,e=t.getSize(),this.height=e.height,this.width=e.width}},qh=class extends Hh{constructor(e,t){super(e),this.type=this.type|Uh.SPACER|Uh.IN_ROW_SPACER,this.width=t,this.height=this.constants_.SPACER_DEFAULT_HEIGHT}},Jh=class extends Wh{constructor(e,t){super(e,t),this.type|=Uh.INLINE_INPUT,this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING),this.connectionHeight=this.isDynamicShape?this.shape.height(this.height):this.shape.height,this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width,this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1)),this.connectionOffsetY="connectionOffsetY"in this.shape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX="connectionOffsetX"in this.shape?this.shape.connectionOffsetX(this.connectionWidth):0}},Zh=class extends Wh{constructor(e,t){super(e,t),this.type|=Uh.STATEMENT_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT,this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width}},Qh=class extends Gh{constructor(e){super(e),this.connectedBlockWidths=0,this.type|=Uh.INPUT_ROW}measure(){this.width=this.minWidth,this.height=this.minHeight;let e=0;for(let t=0;t<this.elements.length;t++){const i=this.elements[t];this.width+=i.width,Uh.isInput(i)&&i instanceof Wh&&(Uh.isStatementInput(i)&&i instanceof Zh?e+=i.connectedBlockWidth:Uh.isExternalInput(i)&&i instanceof Xh&&0!==i.connectedBlockWidth&&(e+=i.connectedBlockWidth-i.connectionWidth)),Uh.isSpacer(i)||(this.height=Math.max(this.height,i.height))}this.connectedBlockWidths=e,this.widthWithConnectedBlocks=this.width+e}endsWithElemSpacer(){return!this.hasExternalInput&&!this.hasStatement}},ed=class extends Hh{constructor(e){super(e),this.type|=Uh.JAGGED_EDGE,this.height=this.constants_.JAGGED_TEETH.height,this.width=this.constants_.JAGGED_TEETH.width}},td=class extends jh{constructor(e,t){super(e,t),this.type|=Uh.NEXT_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},id=class extends jh{constructor(e,t){super(e,t),this.connectionOffsetX=0,this.type|=Uh.OUTPUT_CONNECTION,this.height=this.isDynamicShape?0:this.shape.height,this.startX=this.width=this.isDynamicShape?0:this.shape.width,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP}},nd=class extends jh{constructor(e,t){super(e,t),this.type|=Uh.PREVIOUS_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},sd=class extends Hh{constructor(e,t){super(e),this.type=(t&&"left"!==t?Uh.RIGHT_ROUND_CORNER:Uh.LEFT_ROUND_CORNER)|Uh.CORNER,this.width=this.constants_.CORNER_RADIUS,this.height=this.constants_.CORNER_RADIUS/2}},od=class extends Gh{constructor(e,t,i){super(e),this.height=t,this.width=i,this.precedesStatement=this.followsStatement=!1,this.widthWithConnectedBlocks=0,this.type=this.type|Uh.SPACER|Uh.BETWEEN_ROW_SPACER,this.elements=[new qh(this.constants_,i)]}measure(){}},rd=class extends Hh{constructor(e,t){super(e),this.type=(t&&"left"!==t?Uh.RIGHT_SQUARE_CORNER:Uh.LEFT_SQUARE_CORNER)|Uh.CORNER,this.width=this.height=this.constants_.NO_PADDING}},ad=class extends Gh{constructor(e){super(e),this.ascenderHeight=this.capline=0,this.hasPreviousConnection=!1,this.connection=null,this.type|=Uh.TOP_ROW}hasLeftSquareCorner(e){const t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection,i=e.getPreviousBlock();return!!e.outputConnection||t||!!i&&i.getNextBlock()===e}hasRightSquareCorner(e){return!0}measure(){let e=0,t=0,i=0;for(let n=0;n<this.elements.length;n++){const s=this.elements[n];t+=s.width,Uh.isSpacer(s)||(Uh.isHat(s)&&s instanceof zh?i=Math.max(i,s.ascenderHeight):e=Math.max(e,s.height))}this.width=Math.max(this.minWidth,t),this.height=Math.max(this.minHeight,e)+i,this.capline=this.ascenderHeight=i,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},ld=class{constructor(){this.NO_PADDING=0,this.SMALL_PADDING=3,this.MEDIUM_PADDING=5,this.MEDIUM_LARGE_PADDING=8,this.LARGE_PADDING=10,this.TAB_HEIGHT=15,this.TAB_OFFSET_FROM_TOP=5,this.TAB_VERTICAL_OVERLAP=2.5,this.TAB_WIDTH=8,this.NOTCH_WIDTH=15,this.NOTCH_HEIGHT=4,this.MIN_BLOCK_WIDTH=12,this.EMPTY_BLOCK_SPACER_HEIGHT=16,this.CORNER_RADIUS=8,this.NOTCH_OFFSET_LEFT=15,this.STATEMENT_BOTTOM_SPACER=0,this.STATEMENT_INPUT_PADDING_LEFT=20,this.BETWEEN_STATEMENT_PADDING_Y=4,this.ADD_START_HATS=!1,this.START_HAT_HEIGHT=15,this.START_HAT_WIDTH=100,this.SPACER_DEFAULT_HEIGHT=15,this.MIN_BLOCK_HEIGHT=24,this.EMPTY_INLINE_INPUT_PADDING=14.5,this.EXTERNAL_VALUE_INPUT_PADDING=2,this.JAGGED_TEETH_HEIGHT=12,this.JAGGED_TEETH_WIDTH=6,this.FIELD_TEXT_FONTSIZE=11,this.FIELD_TEXT_FONTWEIGHT="normal",this.FIELD_TEXT_FONTFAMILY="sans-serif",this.FIELD_TEXT_BASELINE=this.FIELD_TEXT_HEIGHT=-1,this.FIELD_BORDER_RECT_RADIUS=4,this.FIELD_BORDER_RECT_HEIGHT=16,this.FIELD_BORDER_RECT_X_PADDING=5,this.FIELD_BORDER_RECT_Y_PADDING=3,this.FIELD_BORDER_RECT_COLOUR="#fff",this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1,this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12,this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1,this.FIELD_COLOUR_DEFAULT_WIDTH=26,this.defs=null,this.embossFilterId="",this.embossFilter=null,this.disabledPatternId="",this.disabledPattern=null,this.debugFilterId="",this.cssNode=this.debugFilter=null,this.CURSOR_COLOUR="#cc0a0a",this.MARKER_COLOUR="#4286f4",this.CURSOR_WS_WIDTH=100,this.WS_CURSOR_HEIGHT=5,this.CURSOR_STACK_PADDING=10,this.CURSOR_BLOCK_PADDING=2,this.CURSOR_STROKE_WIDTH=4,this.FULL_BLOCK_FIELDS=!1,this.INSERTION_MARKER_COLOUR="#000000",this.INSERTION_MARKER_OPACITY=.2,this.SHAPES={PUZZLE:1,NOTCH:2},this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT,this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11,this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT,this.START_POINT=qs(0,0),this.FIELD_TEXT_BASELINE_CENTER=!0,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_DROPDOWN_SVG_ARROW_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=",this.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3,this.randomIdentifier=String(Math.random()).substring(2)}init(){this.JAGGED_TEETH=this.makeJaggedTeeth(),this.NOTCH=this.makeNotch(),this.START_HAT=this.makeStartHat(),this.PUZZLE_TAB=this.makePuzzleTab(),this.INSIDE_CORNERS=this.makeInsideCorners(),this.OUTSIDE_CORNERS=this.makeOutsideCorners()}setTheme(e){this.blockStyles=Object.create(null);const t=e.blockStyles;for(const e in t)this.blockStyles[e]=this.validatedBlockStyle_(t[e]);this.setDynamicProperties_(e)}setDynamicProperties_(e){this.setFontConstants_(e),this.setComponentConstants_(e),this.ADD_START_HATS=void 0!==e.startHats?e.startHats:this.ADD_START_HATS}setFontConstants_(e){e.fontStyle&&e.fontStyle.family&&(this.FIELD_TEXT_FONTFAMILY=e.fontStyle.family),e.fontStyle&&e.fontStyle.weight&&(this.FIELD_TEXT_FONTWEIGHT=e.fontStyle.weight),e.fontStyle&&e.fontStyle.size&&(this.FIELD_TEXT_FONTSIZE=e.fontStyle.size),e=pe("Hg",this.FIELD_TEXT_FONTSIZE+"pt",this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTFAMILY),this.FIELD_TEXT_HEIGHT=e.height,this.FIELD_TEXT_BASELINE=e.baseline}setComponentConstants_(e){this.CURSOR_COLOUR=e.getComponentStyle("cursorColour")||this.CURSOR_COLOUR,this.MARKER_COLOUR=e.getComponentStyle("markerColour")||this.MARKER_COLOUR,this.INSERTION_MARKER_COLOUR=e.getComponentStyle("insertionMarkerColour")||this.INSERTION_MARKER_COLOUR,this.INSERTION_MARKER_OPACITY=Number(e.getComponentStyle("insertionMarkerOpacity"))||this.INSERTION_MARKER_OPACITY}getBlockStyleForColour(e){const t="auto_"+e;return this.blockStyles[t]||(this.blockStyles[t]=this.createBlockStyle_(e)),{style:this.blockStyles[t],name:t}}getBlockStyle(e){return this.blockStyles[e||""]||(e&&e.startsWith("auto_")?this.getBlockStyleForColour(e.substring(5)).style:this.createBlockStyle_("#000000"))}createBlockStyle_(e){return this.validatedBlockStyle_({colourPrimary:e})}validatedBlockStyle_(e){const t={};return e&&Object.assign(t,e),e=En(t.colourPrimary||"#000"),t.colourPrimary=e.hex,t.colourSecondary=t.colourSecondary?En(t.colourSecondary).hex:this.generateSecondaryColour_(t.colourPrimary),t.colourTertiary=t.colourTertiary?En(t.colourTertiary).hex:this.generateTertiaryColour_(t.colourPrimary),t.hat=t.hat||"",t}generateSecondaryColour_(e){return pn("#fff",e,.6)||e}generateTertiaryColour_(e){return pn("#fff",e,.3)||e}dispose(){this.embossFilter&&oe(this.embossFilter),this.disabledPattern&&oe(this.disabledPattern),this.debugFilter&&oe(this.debugFilter),this.cssNode=null}makeJaggedTeeth(){const e=this.JAGGED_TEETH_HEIGHT,t=this.JAGGED_TEETH_WIDTH;return{height:e,width:t,path:Zs([Ys(t,e/4),Ys(2*-t,e/2),Ys(t,e/4)])}}makeStartHat(){const e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH;return{height:e,width:t,path:zs("c",[Ys(30,-e),Ys(70,-e),Ys(t,0)])}}makePuzzleTab(){function e(e){const n=-(e=e?-1:1);var s=i/2;const o=s+2.5,r=s+.5,a=Ys(-t,e*s);return s=Ys(t,e*s),zs("c",[Ys(0,e*o),Ys(-t,n*r),a])+zs("s",[Ys(t,2.5*n),s])}const t=this.TAB_WIDTH,i=this.TAB_HEIGHT,n=e(!0),s=e(!1);return{type:this.SHAPES.PUZZLE,width:t,height:i,pathDown:s,pathUp:n}}makeNotch(){function e(e){return Zs([Ys(e*n,i),Ys(3*e,0),Ys(e*n,-i)])}const t=this.NOTCH_WIDTH,i=this.NOTCH_HEIGHT,n=(t-3)/2,s=e(1),o=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:i,pathLeft:s,pathRight:o}}makeInsideCorners(){const e=this.CORNER_RADIUS;return{width:e,height:e,pathTop:eo("a","0 0,0",e,Ys(-e,e)),pathBottom:eo("a","0 0,0",e,Ys(e,e))}}makeOutsideCorners(){const e=this.CORNER_RADIUS,t=qs(0,e)+eo("a","0 0,1",e,Ys(e,-e)),i=eo("a","0 0,1",e,Ys(e,e)),n=eo("a","0 0,1",e,Ys(-e,-e));return{topLeft:t,topRight:i,bottomRight:eo("a","0 0,1",e,Ys(-e,e)),bottomLeft:n,rightHeight:e}}shapeFor(e){switch(e.type){case eh.INPUT_VALUE:case eh.OUTPUT_VALUE:return this.PUZZLE_TAB;case eh.PREVIOUS_STATEMENT:case eh.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown connection type")}}createDom(e,t,i){this.injectCSS_(t,i),this.defs=ee(_l.DEFS,{},e),e=ee(_l.FILTER,{id:"blocklyEmbossFilter"+this.randomIdentifier},this.defs),ee(_l.FEGAUSSIANBLUR,{in:"SourceAlpha",stdDeviation:1,result:"blur"},e),t=ee(_l.FESPECULARLIGHTING,{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},e),ee(_l.FEPOINTLIGHT,{x:-5e3,y:-1e4,z:2e4},t),ee(_l.FECOMPOSITE,{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},e),ee(_l.FECOMPOSITE,{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},e),this.embossFilterId=e.id,this.embossFilter=e,e=ee(_l.PATTERN,{id:"blocklyDisabledPattern"+this.randomIdentifier,patternUnits:"userSpaceOnUse",width:10,height:10},this.defs),ee(_l.RECT,{width:10,height:10,fill:"#aaa"},e),ee(_l.PATH,{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},e),this.disabledPatternId=e.id,this.disabledPattern=e,this.createDebugFilter()}createDebugFilter(){if(!this.debugFilter){const e=ee(_l.FILTER,{id:"blocklyDebugFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},this.defs),t=ee(_l.FECOMPONENTTRANSFER,{result:"outBlur"},e);ee(_l.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),ee(_l.FEFLOOD,{"flood-color":"#ff0000","flood-opacity":.5,result:"outColor"},e),ee(_l.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),this.debugFilterId=e.id,this.debugFilter=e}}injectCSS_(e,t){t=this.getCSS_(t),e="blockly-renderer-style-"+e,this.cssNode=document.getElementById(e);const i=t.join("\n");this.cssNode?this.cssNode.firstChild.textContent=i:((t=document.createElement("style")).id=e,e=document.createTextNode(i),t.appendChild(e),document.head.insertBefore(t,document.head.firstChild),this.cssNode=t)}getCSS_(e){return[`${e} .blocklyText, `,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableText>rect,`,`${e} .blocklyEditableText>rect {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"fill-opacity: .6;","stroke: none;","}",`${e} .blocklyNonEditableText>text,`,`${e} .blocklyEditableText>text {`,"fill: #000;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #000;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #000;","}",`${e} .blocklyEditableText:not(.editing):hover>rect {`,"stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"}",`${e} .blocklySelected>.blocklyPath {`,"stroke: #fc3;","stroke-width: 3px;","}",`${e} .blocklyHighlightedConnectionPath {`,"stroke: #fc3;","}",`${e} .blocklyReplaceable .blocklyPath {`,"fill-opacity: .5;","}",`${e} .blocklyReplaceable .blocklyPathLight,`,`${e} .blocklyReplaceable .blocklyPathDark {`,"display: none;","}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},cd={};cd.ConstantProvider=ld,cd.isDynamicShape=go,cd.isNotch=fo,cd.isPuzzleTab=mo;var ud=class{constructor(e,t){this.inlinePath_=this.outlinePath_="",this.block_=e,this.info_=t,this.topLeft_=e.getRelativeToSurfaceXY(),this.constants_=t.getRenderer().getConstants()}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),this.block_.pathObject.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&this.block_.pathObject.flipRTL(),this.recordSizeOnBlock_()}recordSizeOnBlock_(){this.block_.height=this.info_.height,this.block_.width=this.info_.widthWithChildren}drawOutline_(){this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){const t=this.info_.rows[e];t.hasJaggedEdge?this.drawJaggedEdge_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_(),this.drawLeft_()}drawTop_(){const e=this.info_.topRow,t=e.elements;this.positionPreviousConnection_(),this.outlinePath_+=qs(e.xPos,this.info_.startY);for(let e,i=0;e=t[i];i++)Uh.isLeftRoundedCorner(e)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:Uh.isRightRoundedCorner(e)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:Uh.isPreviousConnection(e)&&e instanceof jh?this.outlinePath_+=e.shape.pathLeft:Uh.isHat(e)?this.outlinePath_+=this.constants_.START_HAT.path:Uh.isSpacer(e)&&(this.outlinePath_+=Qs("h",e.width));this.outlinePath_+=Qs("v",e.height)}drawJaggedEdge_(e){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+Qs("v",e.height-this.constants_.JAGGED_TEETH.height)}drawValueInput_(e){const t=e.getLastInput();this.positionExternalValueConnection_(e);const i=go(t.shape)?t.shape.pathDown(t.height):t.shape.pathDown;this.outlinePath_+=Qs("H",t.xPos+t.width)+i+Qs("v",e.height-t.connectionHeight)}drawStatementInput_(e){var t=e.getLastInput();if(t){var i=t.xPos+t.notchOffset+t.shape.width;t=t.shape.pathRight+Qs("h",-(t.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop;var n=e.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=Qs("H",i)+t+Qs("v",n)+this.constants_.INSIDE_CORNERS.pathBottom+Qs("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}}drawRightSideRow_(e){this.outlinePath_+=Qs("V",e.yPos+e.height)}drawBottom_(){const e=this.info_.bottomRow,t=e.elements;this.positionNextConnection_();let i=0,n="";for(let s,o=t.length-1;s=t[o];o--)Uh.isNextConnection(s)&&s instanceof jh?n+=s.shape.pathRight:Uh.isLeftSquareCorner(s)?n+=Qs("H",e.xPos):Uh.isLeftRoundedCorner(s)?n+=this.constants_.OUTSIDE_CORNERS.bottomLeft:Uh.isRightRoundedCorner(s)?(n+=this.constants_.OUTSIDE_CORNERS.bottomRight,i=this.constants_.OUTSIDE_CORNERS.rightHeight):Uh.isSpacer(s)&&(n+=Qs("h",-1*s.width));this.outlinePath_+=Qs("V",e.baseline-i),this.outlinePath_+=n}drawLeft_(){var e=this.info_.outputConnection;if(this.positionOutputConnection_(),e){const t=e.connectionOffsetY+e.height;e=go(e.shape)?e.shape.pathUp(e.height):e.shape.pathUp,this.outlinePath_+=Qs("V",t)+e}this.outlinePath_+="z"}drawInternals_(){for(let e,t=0;e=this.info_.rows[t];t++)for(let t,i=0;t=e.elements[i];i++)Uh.isInlineInput(t)?this.drawInlineInput_(t):(Uh.isIcon(t)||Uh.isField(t))&&this.layoutField_(t)}layoutField_(e){const t=e.centerline-e.height/2;let i=e.xPos;var n="";this.info_.RTL&&(i=-(i+e.width),e.flipRtl&&(i+=e.width,n="scale(-1 1)")),Uh.isIcon(e)?((n=e.icon).setOffsetInBlock(new cl(i,t)),this.info_.isInsertionMarker&&n.hideForInsertionMarker()):((e=e.field.getSvgRoot()).setAttribute("transform","translate("+i+","+t+")"+n),this.info_.isInsertionMarker&&e.setAttribute("display","none"))}drawInlineInput_(e){const t=e.width,i=e.height,n=e.connectionOffsetY,s=e.connectionHeight+n;this.inlinePath_+=Ks(e.xPos+e.connectionWidth,e.centerline-i/2)+Qs("v",n)+e.shape.pathDown+Qs("v",i-s)+Qs("h",t-e.connectionWidth)+Qs("v",-i)+"z",this.positionInlineInputConnection_(e)}positionInlineInputConnection_(e){const t=e.centerline-e.height/2;if(e.connectionModel){let i=e.xPos+e.connectionWidth+e.connectionOffsetX;this.info_.RTL&&(i*=-1),e.connectionModel.setOffsetInBlock(i,t+e.connectionOffsetY)}}positionStatementInputConnection_(e){const t=e.getLastInput();if(null!=t&&t.connectionModel){let i=e.xPos+e.statementEdge+t.notchOffset;this.info_.RTL&&(i*=-1),t.connectionModel.setOffsetInBlock(i,e.yPos)}}positionExternalValueConnection_(e){const t=e.getLastInput();if(t&&t.connectionModel){let i=e.xPos+e.width;this.info_.RTL&&(i*=-1),t.connectionModel.setOffsetInBlock(i,e.yPos)}}positionPreviousConnection_(){const e=this.info_.topRow;if(e.connection){const t=e.xPos+e.notchOffset;e.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-t:t,0)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const t=e.connection,i=t.xPos;t.connectionModel.setOffsetInBlock(this.info_.RTL?-i:i,e.baseline)}}positionOutputConnection_(){if(this.info_.outputConnection){const e=this.info_.startX+this.info_.outputConnection.connectionOffsetX;this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-e:e,this.info_.outputConnection.connectionOffsetY)}}updateConnectionHighlights(){for(const e of this.info_.rows)for(const t of e.elements)if(t instanceof jh)if(t.highlighted)this.drawConnectionHighlightPath(t);else{let e,i;null==(i=(e=this.block_.pathObject).removeConnectionHighlight)||i.call(e,t.connectionModel)}}drawConnectionHighlightPath(e){const t=e.connectionModel;e=t.type===eh.INPUT_VALUE||t.type===eh.OUTPUT_VALUE?this.getExpressionConnectionHighlightPath(e):this.getStatementConnectionHighlightPath(e);const i=t.getSourceBlock();let n,s;null==(s=(n=i.pathObject).addConnectionHighlight)||s.call(n,t,e,t.getOffsetInBlock(),i.RTL)}getExpressionConnectionHighlightPath(e){let t="";return go(e.shape)?t=e.shape.pathDown(e.height):mo(e.shape)&&(t=e.shape.pathDown),e=this.constants_.TAB_OFFSET_FROM_TOP,qs(0,-e)+Qs("v",e)+t+Qs("v",e)}getStatementConnectionHighlightPath(e){if(!fo(e.shape))throw Error("Statement connections should have notch shapes");const t=this.constants_.NOTCH_OFFSET_LEFT-this.constants_.CORNER_RADIUS;return qs(-t,0)+Qs("h",t)+e.shape.pathLeft+Qs("h",t)}};!function(e){e[e.LEFT=-1]="LEFT",e[e.CENTRE=0]="CENTRE",e[e.RIGHT=1]="RIGHT"}(Hr.Align$$module$build$src$core$inputs$align||(Hr.Align$$module$build$src$core$inputs$align={})),Hr.Align$$module$build$src$core$inputs$align;var hd=class extends wu{constructor(e,t,i){super(wu.SKIP_SETUP),this.class=null,this.EDITABLE=!1,this.maxDisplayLength=1/0,e!==wu.SKIP_SETUP&&(i?this.configure_(i):this.class=t||null,this.setValue(e))}configure_(e){super.configure_(e),e.class&&(this.class=e.class)}initView(){this.createTextElement_(),this.class&&te(this.getTextElement(),this.class)}doClassValidation_(e){return null==e?null:`${e}`}setClass(e){this.textElement_&&(this.class&&ne(this.textElement_,this.class),e&&te(this.textElement_,e)),this.class=e}static fromJson(e){return new this(_n(e.text),void 0,e)}};Os("field_label",hd),hd.prototype.DEFAULT_VALUE="";var dd=class{constructor(e,t){this.name=e,this.sourceBlock=t,this.fieldRow=[],this.align=Hr.Align$$module$build$src$core$inputs$align.LEFT,this.visible=!0,this.type=Hr.inputTypes$$module$build$src$core$inputs$input_types.CUSTOM,this.connection=null}getSourceBlock(){return this.sourceBlock}appendField(e,t){return this.insertFieldAt(this.fieldRow.length,e,t),this}insertFieldAt(e,t,i){if(0>e||e>this.fieldRow.length)throw Error("index "+e+" out of bounds.");return t||""===t&&i?("string"==typeof t&&(t=Hr.fromJson$$module$build$src$core$field_registry({type:"field_label",text:t})),t.setSourceBlock(this.sourceBlock),this.sourceBlock.initialized&&this.initField(t),t.name=i,t.setVisible(this.isVisible()),t.prefixField&&(e=this.insertFieldAt(e,t.prefixField)),this.fieldRow.splice(e,0,t),e++,t.suffixField&&(e=this.insertFieldAt(e,t.suffixField)),this.sourceBlock.rendered&&this.sourceBlock.queueRender(),e):e}removeField(e,t){for(let t,i=0;t=this.fieldRow[i];i++)if(t.name===e)return t.dispose(),this.fieldRow.splice(i,1),this.sourceBlock.rendered&&this.sourceBlock.queueRender(),!0;if(t)return!1;throw Error('Field "'+e+'" not found.')}isVisible(){return this.visible}setVisible(e){let t=[];if(this.visible===e)return t;this.visible=e;for(let t,i=0;t=this.fieldRow[i];i++)t.setVisible(e);if(this.connection){var i=this.connection;e?t=i.startTrackingAll():i.stopTrackingAll(),(i=i.targetBlock())&&(i.getSvgRoot().style.display=e?"block":"none")}return t}markDirty(){for(let e,t=0;e=this.fieldRow[t];t++)e.markDirty()}setCheck(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setCheck(e),this}setAlign(e){return this.align=e,this.sourceBlock.rendered&&this.sourceBlock.queueRender(),this}setShadowDom(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setShadowDom(e),this}getShadowDom(){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.getShadowDom()}init(){for(const e of this.fieldRow)e.init()}initModel(){for(const e of this.fieldRow)e.initModel()}initField(e){this.sourceBlock.rendered?e.init():e.initModel()}dispose(){for(let e,t=0;e=this.fieldRow[t];t++)e.dispose();this.connection&&this.connection.dispose()}makeConnection(e){return this.sourceBlock.makeConnection_(e)}},pd=class extends dd{constructor(e,t){super(e,t),this.name=e,this.type=Hr.inputTypes$$module$build$src$core$inputs$input_types.DUMMY}},gd=class extends dd{constructor(e,t){super(e,t),this.name=e,this.type=Hr.inputTypes$$module$build$src$core$inputs$input_types.END_ROW}},md=class extends dd{constructor(e,t){if(!e)throw Error("Statement inputs must have a non-empty name");super(e,t),this.name=e,this.type=Hr.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT,this.connection=this.makeConnection(eh.NEXT_STATEMENT)}};Hr.ValueInput$$module$build$src$core$inputs$value_input=class extends dd{constructor(e,t){if(!e)throw Error("Value inputs must have a non-empty name");super(e,t),this.name=e,this.type=Hr.inputTypes$$module$build$src$core$inputs$input_types.VALUE,this.connection=this.makeConnection(eh.INPUT_VALUE)}},Hr.ValueInput$$module$build$src$core$inputs$value_input;var fd=class{constructor(e,t){this.statementEdge=this.width=this.widthWithChildren=this.height=0,this.rows=[],this.inputRows=[],this.startY=this.startX=0,this.renderer_=e,this.block_=t,this.constants_=this.renderer_.getConstants(),this.outputConnection=t.outputConnection?new id(this.constants_,t.outputConnection):null,this.isInline=t.getInputsInline()&&!t.isCollapsed(),this.isCollapsed=t.isCollapsed(),this.isInsertionMarker=t.isInsertionMarker(),this.RTL=t.RTL,this.topRow=new ad(this.constants_),this.bottomRow=new Vh(this.constants_)}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let e=new Qh(this.constants_);this.inputRows.push(e);var t=this.block_.getIcons();for(let i,n=0;i=t[n];n++){const t=new Kh(this.constants_,i);this.isCollapsed&&!i.isShownWhenCollapsed()||e.elements.push(t)}t=void 0;for(let i,n=0;i=this.block_.inputList[n];n++)if(i.isVisible()){this.shouldStartNewRow_(i,t)&&(this.rows.push(e),e=new Qh(this.constants_),this.inputRows.push(e));for(let t,n=0;t=i.fieldRow[n];n++)e.elements.push(new Yh(this.constants_,t,i));this.addInput_(i,e),t=i}this.isCollapsed&&(e.hasJaggedEdge=!0,e.elements.push(new ed(this.constants_))),(e.elements.length||e.hasDummyInput)&&this.rows.push(e),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateTopRow_(){var e=!!this.block_.previousConnection;const t=(this.block_.hat?"cap"===this.block_.hat:this.constants_.ADD_START_HATS)&&!this.outputConnection&&!e;let i=this.topRow.hasLeftSquareCorner(this.block_)?rd:sd;this.topRow.elements.push(new i(this.constants_)),t?(e=new zh(this.constants_),this.topRow.elements.push(e),this.topRow.capline=e.ascenderHeight):e&&(this.topRow.hasPreviousConnection=!0,this.topRow.connection=new nd(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection)),this.block_.inputList.length&&this.block_.inputList[0]instanceof md&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT,i=this.topRow.hasRightSquareCorner(this.block_)?rd:sd,this.topRow.elements.push(new i(this.constants_,"right"))}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection,this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof md?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new rd(this.constants_)):this.bottomRow.elements.push(new sd(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new td(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new rd(this.constants_,"right")):this.bottomRow.elements.push(new sd(this.constants_,"right"))}addInput_(e,t){this.isInline&&e instanceof Hr.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new Jh(this.constants_,e)),t.hasInlineInput=!0):e instanceof md?(t.elements.push(new Zh(this.constants_,e)),t.hasStatement=!0):e instanceof Hr.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new Xh(this.constants_,e)),t.hasExternalInput=!0):(e instanceof pd||e instanceof gd)&&(t.minHeight=Math.max(t.minHeight,e.getSourceBlock()&&e.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),null===t.align&&(t.align=e.align)}shouldStartNewRow_(e,t){return!!t&&(t instanceof gd||e instanceof md||t instanceof md||(e instanceof Hr.ValueInput$$module$build$src$core$inputs$value_input||e instanceof pd||t instanceof Hr.ValueInput$$module$build$src$core$inputs$value_input)&&!this.isInline)}addElemSpacing_(){for(let e,t=0;e=this.rows[t];t++){const t=e.elements;if(e.elements=[],e.startsWithElemSpacer()&&e.elements.push(new qh(this.constants_,this.getInRowSpacing_(null,t[0]))),t.length){for(let i=0;i<t.length-1;i++){e.elements.push(t[i]);const n=this.getInRowSpacing_(t[i],t[i+1]);e.elements.push(new qh(this.constants_,n))}e.elements.push(t[t.length-1]),e.endsWithElemSpacer()&&e.elements.push(new qh(this.constants_,this.getInRowSpacing_(t[t.length-1],null)))}}}getInRowSpacing_(e,t){if(!e&&t&&Uh.isStatementInput(t))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(e&&Uh.isInput(e)&&!t){if(Uh.isExternalInput(e))return this.constants_.NO_PADDING;if(Uh.isInlineInput(e))return this.constants_.LARGE_PADDING;if(Uh.isStatementInput(e))return this.constants_.NO_PADDING}return e&&Uh.isLeftSquareCorner(e)&&t&&(Uh.isPreviousConnection(t)||Uh.isNextConnection(t))?t.notchOffset:e&&Uh.isLeftRoundedCorner(e)&&t&&(Uh.isPreviousConnection(t)||Uh.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}computeBounds_(){let e=0,t=0,i=0;for(let s,o=0;s=this.rows[o];o++){if(s.measure(),t=Math.max(t,s.width),s.hasStatement){var n=s.getLastInput();let t,i;n=s.width-(null!=(i=null==(t=n)?void 0:t.width)?i:0),e=Math.max(e,n)}i=Math.max(i,s.widthWithConnectedBlocks)}this.statementEdge=e,this.width=t;for(let e,t=0;e=this.rows[t];t++)e.hasStatement&&(e.statementEdge=this.statementEdge);this.widthWithChildren=Math.max(t,i),this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)}alignRowElements_(){for(let t,i=0;t=this.rows[i];i++)if(t.hasStatement)this.alignStatementRow_(t);else{var e=t.width;0<(e=this.getDesiredRowWidth_(t)-e)&&this.addAlignmentPadding_(t,e),Uh.isTopOrBottomRow(t)&&(t.widthWithConnectedBlocks=t.width)}}getDesiredRowWidth_(e){return this.width-this.startX}addAlignmentPadding_(e,t){const i=e.getFirstSpacer(),n=e.getLastSpacer();if((e.hasExternalInput||e.hasStatement)&&(e.widthWithConnectedBlocks+=t),e.align===Hr.Align$$module$build$src$core$inputs$align.LEFT&&n)n.width+=t;else if(e.align===Hr.Align$$module$build$src$core$inputs$align.CENTRE&&i&&n)i.width+=t/2,n.width+=t/2;else if(e.align===Hr.Align$$module$build$src$core$inputs$align.RIGHT&&i)i.width+=t;else{if(!n)return;n.width+=t}e.width+=t}alignStatementRow_(e){const t=e.getLastInput();if(t){var i=e.width-t.width,n=this.statementEdge;0<(i=n-i)&&this.addAlignmentPadding_(e,i),i=e.width,n=this.getDesiredRowWidth_(e),t.width+=n-i,t.height=Math.max(t.height,e.height),e.width+=n-i,e.widthWithConnectedBlocks=Math.max(e.width,this.statementEdge+e.connectedBlockWidths)}}addRowSpacing_(){const e=this.rows;this.rows=[];for(let t=0;t<e.length;t++)this.rows.push(e[t]),t!==e.length-1&&this.rows.push(this.makeSpacerRow_(e[t],e[t+1]))}makeSpacerRow_(e,t){var i=this.getSpacerRowHeight_(e,t);const n=this.getSpacerRowWidth_(e,t);return i=new od(this.constants_,i,n),e.hasStatement&&(i.followsStatement=!0),t.hasStatement&&(i.precedesStatement=!0),i}getSpacerRowWidth_(e,t){return this.width-this.startX}getSpacerRowHeight_(e,t){return this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){return Uh.isSpacer(t)?e.yPos+t.height/2:Uh.isBottomRow(e)?(e=e.yPos+e.height-e.descenderHeight,Uh.isNextConnection(t)?e+t.height/2:e-t.height/2):Uh.isTopRow(e)?Uh.isHat(t)?e.capline-t.height/2:e.capline+t.height/2:e.yPos+e.height/2}recordElemPositions_(e){let t=e.xPos;for(let i,n=0;i=e.elements[n];n++)Uh.isSpacer(i)&&(i.height=e.height),i.xPos=t,i.centerline=this.getElemCenterline_(e,i),t+=i.width}finalize_(){let e=0,t=0;for(let i,n=0;i=this.rows[n];n++)i.yPos=t,i.xPos=this.startX,t+=i.height,e=Math.max(e,i.widthWithConnectedBlocks),this.recordElemPositions_(i);if(this.outputConnection&&this.block_.nextConnection){const t=this.block_.nextConnection.targetBlock();t&&(e=Math.max(e,t.getHeightWidth().width))}this.widthWithChildren=e+this.startX,this.height=t,this.startY=this.topRow.capline,this.bottomRow.baseline=t-this.bottomRow.descenderHeight}getMeasureableForConnection(e){let t;if((null==(t=this.outputConnection)?void 0:t.connectionModel)===e)return this.outputConnection;for(const t of this.rows)for(const i of t.elements)if(i instanceof jh&&i.connectionModel===e)return i;return null}},_d=class extends Hc{constructor(e){if(super(e),this.type=Hr.DELETE$$module$build$src$core$events$utils,e){if(e.getParent())throw Error("Connected blocks cannot be deleted.");e.isShadow()&&(this.recordUndo=!1),this.oldXml=Xn(e),this.ids=b(e),this.wasShadow=e.isShadow(),this.oldJson=Mt(e,{addCoordinates:!0})}}toJson(){const e=super.toJson();if(!this.oldXml)throw Error("The old block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(void 0===this.wasShadow)throw Error("Whether the block was a shadow is undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.oldXml=Jn(this.oldXml),e.ids=this.ids,e.wasShadow=this.wasShadow,e.oldJson=this.oldJson,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new _d)).oldXml=Hr.textToDom$$module$build$src$core$utils$xml(e.oldXml),t.ids=e.ids,t.wasShadow=e.wasShadow||"shadow"===t.oldXml.tagName.toLowerCase(),t.oldJson=e.oldJson,void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}run(e){const t=this.getEventWorkspace_();if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(e)for(e=0;e<this.ids.length;e++){const i=this.ids[e],n=t.getBlockById(i);n?n.dispose(!1):i===this.blockId&&console.warn("Can't delete non-existent block: "+i)}else Wt(this.oldJson,t)}};t(Xr.EVENT,Hr.DELETE$$module$build$src$core$events$utils,_d);var Td=class{constructor(e,t){this.type=t,this.targetConnection=null,this.disposed=!1,this.shadowDom=this.check=null,this.y=this.x=0,this.shadowState=null,this.sourceBlock_=e}connect_(e){const t=eh.INPUT_VALUE,i=this.getSourceBlock();var n=e.getSourceBlock();let s,o;if(e.isConnected()&&e.disconnectInternal(!1),this.isConnected()){const e=this.stashShadowState(),t=this.targetBlock();t.isShadow()?t.dispose(!1):(this.disconnectInternal(),s=t),this.applyShadowState(e)}T()&&(o=new(y(Hr.MOVE$$module$build$src$core$events$utils))(n)).setReason(["connect"]),_o(this,e),n.setParent(i),o&&(o.recordNew(),p(o)),s&&(e=this.type===t?s.outputConnection:s.previousConnection)&&((n=Td.getConnectionForOrphanedConnection(n,e))?e.connect(n):e.onFailedConnect(this))}dispose(){if(this.isConnected()){this.isSuperior()&&this.setShadowStateInternal();const e=this.targetBlock();e&&!e.isDeadOrDying()&&e.unplug()}this.disposed=!0}getSourceBlock(){return this.sourceBlock_}isSuperior(){return this.type===eh.INPUT_VALUE||this.type===eh.NEXT_STATEMENT}isConnected(){return!!this.targetConnection}getConnectionChecker(){return this.sourceBlock_.workspace.connectionChecker}onFailedConnect(e){}connect(e){if(this.targetConnection===e)return!0;if(this.getConnectionChecker().canConnect(this,e,!1)){const t=Hr.getGroup$$module$build$src$core$events$utils();t||Hr.setGroup$$module$build$src$core$events$utils(!0),this.isSuperior()?this.connect_(e):e.connect_(this),Hr.setGroup$$module$build$src$core$events$utils(t)}return this.isConnected()}disconnect(){this.disconnectInternal()}disconnectInternal(e=!0){const{parentConnection:t,childConnection:i}=this.getParentAndChildConnections();if(!t||!i)throw Error("Source connection not connected.");const n=Hr.getGroup$$module$build$src$core$events$utils();let s;n||Hr.setGroup$$module$build$src$core$events$utils(!0),T()&&(s=new(y(Hr.MOVE$$module$build$src$core$events$utils))(i.getSourceBlock())).setReason(["disconnect"]);const o=this.targetConnection;o&&(o.targetConnection=null),this.targetConnection=null,e&&i.getSourceBlock().setParent(null),s&&(s.recordNew(),p(s)),i.getSourceBlock().isShadow()||t.respawnShadow_(),Hr.setGroup$$module$build$src$core$events$utils(n)}getParentAndChildConnections(){return this.targetConnection?this.isSuperior()?{parentConnection:this,childConnection:this.targetConnection}:{parentConnection:this.targetConnection,childConnection:this}:{}}respawnShadow_(){this.createShadowBlock(!0)}reconnect(e,t){return!(this.getSourceBlock().isDeadOrDying()||(t=null==(i=e.getInput(t))?void 0:i.connection,(i=this.targetBlock())&&i!==e||!t||t.targetConnection===this||(t.isConnected()&&t.disconnect(),t.connect(this),0)));var i}targetBlock(){if(this.isConnected()){let e,t;return null!=(t=null==(e=this.targetConnection)?void 0:e.getSourceBlock())?t:null}return null}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return e?(Array.isArray(e)||(e=[e]),this.check=e,this.onCheckChanged_()):this.check=null,this}getCheck(){return this.check}setShadowDom(e){this.setShadowStateInternal({shadowDom:e})}getShadowDom(e){return e&&this.targetBlock().isShadow()?Kn(this.targetBlock()):this.shadowDom}setShadowState(e){this.setShadowStateInternal({shadowState:e})}getShadowState(e){return e&&this.targetBlock()&&this.targetBlock().isShadow()?Mt(this.targetBlock()):this.shadowState}neighbours(e){return[]}getParentInput(){let e=null;const t=this.sourceBlock_.inputList;for(let i=0;i<t.length;i++)if(t[i].connection===this){e=t[i];break}return e}toString(){const e=this.sourceBlock_;if(!e)return"Orphan Connection";if(e.outputConnection===this)var t="Output Connection of ";else if(e.previousConnection===this)t="Previous Connection of ";else if(e.nextConnection===this)t="Next Connection of ";else{t=null;for(let i,n=0;i=e.inputList[n];n++)if(i.connection===this){t=i;break}if(!t)return console.warn("Connection not actually connected to sourceBlock_"),"Orphan Connection";t='Input "'+t.name+'" connection on '}return t+e.toDevString()}stashShadowState(){const e=this.getShadowDom(!0),t=this.getShadowState(!0);return this.shadowState=this.shadowDom=null,{shadowDom:e,shadowState:t}}applyShadowState({shadowDom:e,shadowState:t}){this.shadowDom=e,this.shadowState=t}setShadowStateInternal({shadowDom:e=null,shadowState:t=null}={}){this.shadowDom=e,this.shadowState=t,this.getSourceBlock().isDeadOrDying()||((e=this.targetBlock())?e.isShadow()?(e.dispose(!1),this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())):(e=this.createShadowBlock(!1),this.serializeShadow(e),e&&e.dispose(!1)):(this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())))}createShadowBlock(e){var t=this.getSourceBlock();const i=this.getShadowState(),n=this.getShadowDom();if(t.isDeadOrDying()||!i&&!n)return null;if(i)return Xt(i,t.workspace,{parentConnection:e?this:void 0,isShadow:!0,recordUndo:!1});if(n){if(t=is(n,t.workspace),e)if(this.type===eh.INPUT_VALUE){if(!t.outputConnection)throw Error("Shadow block is missing an output connection");if(!this.connect(t.outputConnection))throw Error("Could not connect shadow block to connection")}else{if(this.type!==eh.NEXT_STATEMENT)throw Error("Cannot connect a shadow block to a previous/output connection");if(!t.previousConnection)throw Error("Shadow block is missing previous connection");if(!this.connect(t.previousConnection))throw Error("Could not connect shadow block to connection")}return t}return null}serializeShadow(e){e&&(this.shadowDom=Kn(e),this.shadowState=Mt(e))}static getConnectionForOrphanedConnection(e,t){if(t.type===eh.OUTPUT_VALUE)return Eo(e,t.getSourceBlock());e=e.lastConnectionInStack(!0);const i=t.getConnectionChecker();return e&&i.canConnect(t,e,!1)?e:null}};Td.CAN_CONNECT=0,Td.REASON_SELF_CONNECTION=1,Td.REASON_WRONG_TYPE=2,Td.REASON_TARGET_NULL=3,Td.REASON_CHECKS_FAILED=4,Td.REASON_DIFFERENT_WORKSPACES=5,Td.REASON_SHADOW_PARENT=6,Td.REASON_DRAG_CHECKS_FAILED=7,Td.REASON_PREVIOUS_AND_OUTPUT=8;var Ed=class{constructor(e,t,i){if(this.data=null,this.disposed=!1,this.hue_=null,this.colour_="#000000",this.styleName_="",this.suppressPrefixSuffix=!1,this.previousConnection=this.nextConnection=this.outputConnection=null,this.inputList=[],this.icons=[],this.disabledReasons=new Set,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.editable_=this.movable_=this.deletable_=!0,this.collapsed_=this.isShadow_=!1,this.outputShape_=null,this.rendered=this.isInsertionMarker_=this.initialized=this.disposing=!1,this.onchangeWrapper_=this.helpUrl=null,this.statementInputCount=0,this.workspace=e,this.id=i&&!e.getBlockById(i)?i:h(),e.setBlockById(this.id,this),this.xy_=new cl(0,0),this.isInFlyout=e.isFlyout,this.isInMutator=e.isMutator,this.RTL=e.RTL,t){if(this.type=t,!(i=da[t])||"object"!=typeof i)throw TypeError("Invalid block definition for type: "+t);Object.assign(this,i)}e.addTopBlock(this),e.addTypedBlock(this),new.target===Ed&&this.doInit_()}doInit_(){const e=Hr.getGroup$$module$build$src$core$events$utils();e||Hr.setGroup$$module$build$src$core$events$utils(!0);const t=d();try{"function"==typeof this.init&&(Hr.setRecordUndo$$module$build$src$core$events$utils(!1),this.init(),Hr.setRecordUndo$$module$build$src$core$events$utils(t)),T()&&p(new(y(Hr.CREATE$$module$build$src$core$events$utils))(this))}finally{Hr.setGroup$$module$build$src$core$events$utils(e),Hr.setRecordUndo$$module$build$src$core$events$utils(t)}this.inputsInlineDefault=this.inputsInline,"function"==typeof this.onchange&&this.setOnChange(this.onchange)}dispose(e=!1){this.disposing=!0,this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.unplug(e),T()&&p(new(y(Hr.DELETE$$module$build$src$core$events$utils))(this)),this.workspace.removeTopBlock(this),this.disposeInternal()}disposeInternal(){this.disposing=!0,this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),"function"==typeof this.destroy&&this.destroy(),this.childBlocks_.forEach((e=>e.disposeInternal())),this.inputList.forEach((e=>e.dispose())),this.inputList.length=0,this.getConnections_(!0).forEach((e=>e.dispose())),this.disposed=!0}isDeadOrDying(){return this.disposing||this.disposed}initModel(){if(!this.initialized){for(const e of this.inputList)e.initModel();this.initialized=!0}}unplug(e){this.outputConnection&&this.unplugFromRow_(e),this.previousConnection&&this.unplugFromStack_(e)}unplugFromRow_(e){let t,i=null;null!=(t=this.outputConnection)&&t.isConnected()&&(i=this.outputConnection.targetConnection,this.outputConnection.disconnect()),i&&e&&(e=this.getOnlyValueConnection_())&&e.isConnected()&&!e.targetBlock().isShadow()&&(null==(e=e.targetConnection)||e.disconnect(),this.workspace.connectionChecker.canConnect(e,i,!1)?i.connect(e):null==e||e.onFailedConnect(i))}getOnlyValueConnection_(){let e=null;for(let t=0;t<this.inputList.length;t++){const i=this.inputList[t].connection;if(i&&i.type===eh.INPUT_VALUE&&i.targetConnection){if(e)return null;e=i}}return e}unplugFromStack_(e){let t=null;var i;if(null!=(i=this.previousConnection)&&i.isConnected()&&(t=this.previousConnection.targetConnection,this.previousConnection.disconnect()),i=this.getNextBlock(),e&&i&&!i.isShadow()){let i,n;null==(e=null!=(n=null==(i=this.nextConnection)?void 0:i.targetConnection)?n:null)||e.disconnect(),t&&this.workspace.connectionChecker.canConnect(t,e,!1)&&t.connect(e)}}getConnections_(e){e=[],this.outputConnection&&e.push(this.outputConnection),this.previousConnection&&e.push(this.previousConnection),this.nextConnection&&e.push(this.nextConnection);for(let t,i=0;t=this.inputList[i];i++)t.connection&&e.push(t.connection);return e}lastConnectionInStack(e){let t=this.nextConnection;for(;t;){const i=t.targetBlock();if(!i||e&&i.isShadow())return t;t=i.nextConnection}return null}bumpNeighbours(){}getParent(){return this.parentBlock_}getInputWithBlock(e){for(let t,i=0;t=this.inputList[i];i++)if(t.connection&&t.connection.targetBlock()===e)return t;return null}getSurroundParent(){let e,t=this;do{if(e=t,!(t=t.getParent()))return null}while(t.getNextBlock()===e);return t}getNextBlock(){return this.nextConnection&&this.nextConnection.targetBlock()}getPreviousBlock(){return this.previousConnection&&this.previousConnection.targetBlock()}getRootBlock(){let e,t=this;do{t=(e=t).parentBlock_}while(t);return e}getTopStackBlock(){let e,t=this;do{e=t.getPreviousBlock()}while(e&&e.getNextBlock()===t&&(t=e));return t}getChildren(e){if(!e)return this.childBlocks_;e=[];for(let i,n=0;i=this.inputList[n];n++)if(i.connection){var t=i.connection.targetBlock();t&&e.push(t)}return(t=this.getNextBlock())&&e.push(t),e}setParent(e){if(e!==this.parentBlock_){var t=this.previousConnection&&this.previousConnection.targetBlock()||this.outputConnection&&this.outputConnection.targetBlock(),i=!!t;if(i&&e&&t!==e)throw Error("Block connected to superior one that is not new parent.");if(!i&&e)throw Error("Block not connected to new parent.");if(i&&!e)throw Error("Cannot set parent to null while block is still connected to superior block.");this.parentBlock_?J(this.parentBlock_.childBlocks_,this):this.workspace.removeTopBlock(this),(this.parentBlock_=e)?e.childBlocks_.push(this):this.workspace.addTopBlock(this)}}getDescendants(e){const t=[this],i=this.getChildren(e);for(let n,s=0;n=i[s];s++)t.push(...n.getDescendants(e));return t}isDeletable(){return this.deletable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnDeletable(){return this.deletable_}setDeletable(e){this.deletable_=e}isMovable(){return this.movable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnMovable(){return this.movable_}setMovable(e){this.movable_=e}isDuplicatable(){return!this.workspace.hasBlockLimits()||this.workspace.isCapacityAvailable($(this,!0))}isShadow(){return this.isShadow_}setShadow(e){this.isShadow_=e}isInsertionMarker(){return this.isInsertionMarker_}setInsertionMarker(e){this.isInsertionMarker_=e}isEditable(){return this.editable_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnEditable(){return this.editable_}setEditable(e){this.editable_=e;for(let e,t=0;e=this.inputList[t];t++)for(let t,i=0;t=e.fieldRow[i];i++)t.updateEditable()}isDisposed(){return this.disposed}isSimpleReporter(){if(!this.outputConnection)return!1;for(const e of this.inputList)if(e.connection||1<e.fieldRow.length)return!1;return!0}getMatchingConnection(e,t){const i=this.getConnections_(!0);if(e=e.getConnections_(!0),i.length!==e.length)throw Error("Connection lists did not match in length.");for(let n=0;n<e.length;n++)if(e[n]===t)return i[n];return null}setHelpUrl(e){this.helpUrl=e}setTooltip(e){this.tooltip=e}getTooltip(){return Gi(this)}getColour(){return this.colour_}getStyleName(){return this.styleName_}getHue(){return this.hue_}setColour(e){e=En(e),this.hue_=e.hue,this.colour_=e.hex}setStyle(e){this.styleName_=e}setOnChange(e){if(e&&"function"!=typeof e)throw Error("onchange must be a function.");this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.onchange=e,this.onchangeWrapper_=e.bind(this),this.workspace.addChangeListener(this.onchangeWrapper_)}getField(e){if("string"!=typeof e)throw TypeError("Block.prototype.getField expects a string with the field name but received "+(void 0===e?"nothing":e+" of type "+typeof e)+" instead");for(let t,i=0;t=this.inputList[i];i++)for(let i,n=0;i=t.fieldRow[n];n++)if(i.name===e)return i;return null}getVars(){const e=[];for(let t,i=0;t=this.inputList[i];i++)for(let i,n=0;i=t.fieldRow[n];n++)i.referencesVariables()&&e.push(i.getValue());return e}getVarModels(){const e=[];for(let t,i=0;t=this.inputList[i];i++)for(let i,n=0;i=t.fieldRow[n];n++)if(i.referencesVariables()){const t=this.workspace.getVariableById(i.getValue());t&&e.push(t)}return e}updateVarName(e){for(let t,i=0;t=this.inputList[i];i++)for(let i,n=0;i=t.fieldRow[n];n++)i.referencesVariables()&&e.getId()===i.getValue()&&i.refreshVariableName()}renameVarById(e,t){for(let i,n=0;i=this.inputList[n];n++)for(let n,s=0;n=i.fieldRow[s];s++)n.referencesVariables()&&e===n.getValue()&&n.setValue(t)}getFieldValue(e){return(e=this.getField(e))?e.getValue():null}setFieldValue(e,t){const i=this.getField(t);if(!i)throw Error('Field "'+t+'" not found.');i.setValue(e)}setPreviousStatement(e,t){if(e)void 0===t&&(t=null),this.previousConnection||(this.previousConnection=this.makeConnection_(eh.PREVIOUS_STATEMENT)),this.previousConnection.setCheck(t);else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose(),this.previousConnection=null}}setNextStatement(e,t){if(e)void 0===t&&(t=null),this.nextConnection||(this.nextConnection=this.makeConnection_(eh.NEXT_STATEMENT)),this.nextConnection.setCheck(t);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose(),this.nextConnection=null}}setOutput(e,t){if(e)void 0===t&&(t=null),this.outputConnection||(this.outputConnection=this.makeConnection_(eh.OUTPUT_VALUE)),this.outputConnection.setCheck(t);else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose(),this.outputConnection=null}}setInputsInline(e){this.inputsInline!==e&&(p(new(y(Hr.CHANGE$$module$build$src$core$events$utils))(this,"inline",null,this.inputsInline,e)),this.inputsInline=e)}getInputsInline(){if(void 0!==this.inputsInline)return this.inputsInline;for(var e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof pd&&this.inputList[e]instanceof pd)return!1;for(e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof Hr.ValueInput$$module$build$src$core$inputs$value_input&&this.inputList[e]instanceof pd)return!0;for(e=0;e<this.inputList.length;e++)if(this.inputList[e]instanceof gd)return!0;return!1}setOutputShape(e){this.outputShape_=e}getOutputShape(){return this.outputShape_}isEnabled(){return 0===this.disabledReasons.size}get disabled(){return Xs("disabled","v11","v12","the isEnabled or hasDisabledReason methods of Block"),this.hasDisabledReason(Yl)}set disabled(e){Xs("disabled","v11","v12","the setDisabledReason method of Block"),this.setDisabledReason(e,Yl)}setEnabled(e){Xs("setEnabled","v11","v12","the setDisabledReason method of Block"),this.setDisabledReason(!e,Yl)}setDisabledReason(e,t){this.disabledReasons.has(t)!==e&&(e?this.disabledReasons.add(t):this.disabledReasons.delete(t),(e=new(y(Hr.CHANGE$$module$build$src$core$events$utils))(this,"disabled",null,!e,e)).setDisabledReason(t),p(e))}getInheritedDisabled(){let e=this.getSurroundParent();for(;e;){if(!e.isEnabled())return!0;e=e.getSurroundParent()}return!1}hasDisabledReason(e){return this.disabledReasons.has(e)}getDisabledReasons(){return this.disabledReasons}isCollapsed(){return this.collapsed_}setCollapsed(e){this.collapsed_!==e&&(p(new(y(Hr.CHANGE$$module$build$src$core$events$utils))(this,"collapsed",null,this.collapsed_,e)),this.collapsed_=e)}toString(e,t){t=this.toTokens(t);for(let e=2;e<t.length;e++)"("===t[e-2]&&")"===t[e]&&(t[e-2]=t[e-1],t.splice(e-1,2));let i="";return t=(t=t.reduce(((e,t)=>(e=e+("("===i||")"===t?"":" ")+t,i=t[t.length-1],e)),"")).trim()||"???",e&&t.length>e&&(t=t.substring(0,e-3)+"..."),t}toTokens(e="?"){const t=[];for(const n of this.inputList)if("_TEMP_COLLAPSED_INPUT"!=n.name){for(const e of n.fieldRow)t.push(e.getText());if(n.connection){const s=n.connection.targetBlock();if(s){var i=n.connection;let o=i.getCheck();!o&&i.targetConnection&&(o=i.targetConnection.getCheck()),(i=!!o&&(o.includes("Boolean")||o.includes("Number")))&&t.push("("),t.push(...s.toTokens(e)),i&&t.push(")")}else t.push(e)}}return t}appendValueInput(e){return this.appendInput(new Hr.ValueInput$$module$build$src$core$inputs$value_input(e,this))}appendStatementInput(e){return this.statementInputCount++,this.appendInput(new md(e,this))}appendDummyInput(e=""){return this.appendInput(new pd(e,this))}appendEndRowInput(e=""){return this.appendInput(new gd(e,this))}appendInput(e){return this.inputList.push(e),e}appendInputFromRegistry(e,t){return(e=r(Xr.INPUT,e,!1))?this.appendInput(new e(t,this)):null}jsonInit(e){var t=e.type?'Block "'+e.type+'": ':"";if(e.output&&e.previousStatement)throw Error(t+"Must not have both an output and a previousStatement.");for(var i=0;e["args"+i];){if(void 0===e["message"+i])throw Error(t+`args${i} must have a corresponding message (message${i}).`);i++}if(e.style&&e.style.hat&&(this.hat=e.style.hat,e.style=null),e.style&&e.colour)throw Error(t+"Must not have both a colour and a style.");for(e.style?this.jsonInitStyle_(e,t):this.jsonInitColour_(e,t),i=0;void 0!==e["message"+i];)this.interpolate_(e["message"+i],e["args"+i]||[],e["implicitAlign"+i]||e["lastDummyAlign"+i],t),i++;if(void 0!==e.inputsInline&&(Hr.disable$$module$build$src$core$events$utils(),this.setInputsInline(e.inputsInline),Hr.enable$$module$build$src$core$events$utils()),void 0!==e.output&&this.setOutput(!0,e.output),void 0!==e.outputShape&&this.setOutputShape(e.outputShape),void 0!==e.previousStatement&&this.setPreviousStatement(!0,e.previousStatement),void 0!==e.nextStatement&&this.setNextStatement(!0,e.nextStatement),void 0!==e.tooltip&&(i=_n(e.tooltip),this.setTooltip(i)),void 0!==e.enableContextMenu&&(this.contextMenu=!!e.enableContextMenu),void 0!==e.suppressPrefixSuffix&&(this.suppressPrefixSuffix=!!e.suppressPrefixSuffix),void 0!==e.helpUrl&&(i=_n(e.helpUrl),this.setHelpUrl(i)),"string"==typeof e.extensions&&(console.warn(t+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+e.type+"' block."),e.extensions=[e.extensions]),void 0!==e.mutator&&$s(e.mutator,this,!0),e=e.extensions,Array.isArray(e))for(t=0;t<e.length;t++)$s(e[t],this,!1)}jsonInitColour_(e,t){if("colour"in e)if(void 0===e.colour)console.warn(t+"Undefined colour value.");else{e=e.colour;try{this.setColour(e)}catch(i){console.warn(t+"Illegal colour value: ",e)}}}jsonInitStyle_(e,t){e=e.style;try{this.setStyle(e)}catch(i){console.warn(t+"Style does not exist: ",e)}}mixin(e,t){if(void 0!==t&&"boolean"!=typeof t)throw Error("opt_disableCheck must be a boolean if provided");if(!t){t=[];for(const i in e)void 0!==this[i]&&t.push(i);if(t.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(t))}Object.assign(this,e)}interpolate_(e,t,i,n){e=fn(e),this.validateTokens_(e,t.length),t=this.interpolateArguments_(e,t,i),i=[];for(let s,o=0;s=t[o];o++)if(this.isInputKeyword_(s.type)){if(e=this.inputFromJson_(s,n)){for(let t,n=0;t=i[n];n++)e.appendField(t[0],t[1]);i.length=0}}else(e=this.fieldFromJson_(s))&&i.push([e,s.name])}validateTokens_(e,t){const i=[];let n=0;for(let s=0;s<e.length;s++){const o=e[s];if("number"==typeof o){if(1>o||o>t)throw Error('Block "'+this.type+'": Message index %'+o+" out of range.");if(i[o])throw Error('Block "'+this.type+'": Message index %'+o+" duplicated.");i[o]=!0,n++}}if(n!==t)throw Error('Block "'+this.type+'": Message does not reference all '+t+" arg(s).")}interpolateArguments_(e,t,i){const n=[];for(let o=0;o<e.length;o++){var s=e[o];if("number"==typeof s&&(s=t[s-1]),"string"==typeof s)if("\n"===s)s={type:"input_end_row"},i&&(s.align=i);else if(!(s=this.stringToFieldJson_(s)))continue;n.push(s)}return(e=n.length)&&!this.isInputKeyword_(n[e-1].type)&&(e={type:"input_dummy"},i&&(e.align=i),n.push(e)),n}fieldFromJson_(e){const t=Hr.fromJson$$module$build$src$core$field_registry(e);return!t&&e.alt?"string"==typeof e.alt?(e=this.stringToFieldJson_(e.alt))?this.fieldFromJson_(e):null:this.fieldFromJson_(e.alt):t}inputFromJson_(e,t){var i={LEFT:Hr.Align$$module$build$src$core$inputs$align.LEFT,RIGHT:Hr.Align$$module$build$src$core$inputs$align.RIGHT,CENTRE:Hr.Align$$module$build$src$core$inputs$align.CENTRE,CENTER:Hr.Align$$module$build$src$core$inputs$align.CENTRE};let n;switch(e.type){case"input_value":n=this.appendValueInput(e.name);break;case"input_statement":n=this.appendStatementInput(e.name);break;case"input_dummy":n=this.appendDummyInput(e.name);break;case"input_end_row":n=this.appendEndRowInput(e.name);break;default:n=this.appendInputFromRegistry(e.type,e.name)}return n?(e.check&&n.setCheck(e.check),e.align&&(void 0===(i=i[e.align.toUpperCase()])?console.warn(t+"Illegal align value: ",e.align):n.setAlign(i)),n):null}isInputKeyword_(e){return"input_value"===e||"input_statement"===e||"input_dummy"===e||"input_end_row"===e||o(Xr.INPUT,e)}stringToFieldJson_(e){return(e=e.trim())?{type:"field_label",text:e}:null}moveInputBefore(e,t){if(e!==t){var i=-1,n=t?-1:this.inputList.length;for(let s,o=0;s=this.inputList[o];o++)if(s.name===e){if(i=o,-1!==n)break}else if(t&&s.name===t&&(n=o,-1!==i))break;if(-1===i)throw Error('Named input "'+e+'" not found.');if(-1===n)throw Error('Reference input "'+t+'" not found.');this.moveNumberedInputBefore(i,n)}}moveNumberedInputBefore(e,t){if(e===t)throw Error("Can't move input to itself.");if(e>=this.inputList.length)throw RangeError("Input index "+e+" out of bounds.");if(t>this.inputList.length)throw RangeError("Reference input "+t+" out of bounds.");const i=this.inputList[e];this.inputList.splice(e,1),e<t&&t--,this.inputList.splice(t,0,i)}removeInput(e,t){for(let t,i=0;t=this.inputList[i];i++)if(t.name===e)return t instanceof md&&this.statementInputCount--,t.dispose(),this.inputList.splice(i,1),!0;if(t)return!1;throw Error("Input not found: "+e)}getInput(e){for(let t,i=0;t=this.inputList[i];i++)if(t.name===e)return t;return null}getInputTargetBlock(e){return(e=this.getInput(e))&&e.connection&&e.connection.targetBlock()}getCommentText(){let e,t;return null!=(t=null==(e=this.getIcon(Kl.COMMENT))?void 0:e.getText())?t:null}setCommentText(e){var t;let i;const n=null!=(i=null==(t=this.getIcon(Kl.COMMENT))?void 0:t.getText())?i:null;if(n!==e){if(null!==e){if(!(t=this.getIcon(Kl.COMMENT))){if(!(t=r(Xr.ICON,Kl.COMMENT.toString(),!1)))throw Error("No comment icon class is registered, so a comment cannot be set");if(t=new t(this),!Io(t))throw Error("The class registered as a comment icon does not conform to the ICommentIcon interface");t=this.addIcon(t)}Hr.disable$$module$build$src$core$events$utils(),t.setText(e),Hr.enable$$module$build$src$core$events$utils()}else this.removeIcon(Kl.COMMENT);p(new(y(Hr.CHANGE$$module$build$src$core$events$utils))(this,"comment",null,n,e))}}setWarningText(e,t){}setMutator(e){}addIcon(e){if(this.hasIcon(e.getType()))throw new Mh(e);return this.icons.push(e),this.icons.sort(((e,t)=>e.getWeight()-t.getWeight())),e}removeIcon(e){if(!this.hasIcon(e))return!1;let t;return null==(t=this.getIcon(e))||t.dispose(),this.icons=this.icons.filter((t=>!t.getType().equals(e))),!0}hasIcon(e){return this.icons.some((t=>t.getType().equals(e)))}getIcon(e){return e instanceof Kl?this.icons.find((t=>t.getType().equals(e))):this.icons.find((t=>t.getType().toString()===e))}getIcons(){return[...this.icons]}getRelativeToSurfaceXY(){return this.xy_}moveBy(e,t,i){if(this.parentBlock_)throw Error("Block has parent");const n=new(y(Hr.MOVE$$module$build$src$core$events$utils))(this);i&&n.setReason(i),this.xy_.translate(e,t),n.recordNew(),p(n)}makeConnection_(e){return new Td(this,e)}allInputsFilled(e){if(void 0===e&&(e=!0),!e&&this.isShadow())return!1;for(let i,n=0;i=this.inputList[n];n++)if(i.connection){var t=i.connection.targetBlock();if(!t||!t.allInputsFilled(e))return!1}return!(t=this.getNextBlock())||t.allInputsFilled(e)}toDevString(){let e=this.type?'"'+this.type+'" block':"Block";return this.id&&(e+=' (id="'+this.id+'")'),e}};Ed.COLLAPSED_INPUT_NAME="_TEMP_COLLAPSED_INPUT",Ed.COLLAPSED_FIELD_NAME="_TEMP_COLLAPSED_FIELD";var bd=class{constructor(e,t,i,n){this.workspace=e,this.targetWorkspace=t,this.isFlyoutLabel=n,this.onMouseUpWrapper=null,this.height=this.width=0,this.cursorSvg=this.svgText=this.svgGroup=null,this.text=i.text,this.position=new cl(0,0),this.callbackKey=i.callbackKey||i.callbackkey,this.cssClass=i["web-class"]||null,this.info=i}createDom(){var e=this.isFlyoutLabel?"blocklyFlyoutLabel":"blocklyFlyoutButton";let t;this.cssClass&&(e+=" "+this.cssClass),this.svgGroup=ee(_l.G,{class:e},this.workspace.getCanvas()),this.isFlyoutLabel||(t=ee(_l.RECT,{class:"blocklyFlyoutButtonShadow",rx:bd.BORDER_RADIUS,ry:bd.BORDER_RADIUS,x:1,y:1},this.svgGroup)),e=ee(_l.RECT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:bd.BORDER_RADIUS,ry:bd.BORDER_RADIUS},this.svgGroup);const i=ee(_l.TEXT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup);var n=_n(this.text);this.workspace.RTL&&(n+=""),i.textContent=n,this.isFlyoutLabel&&(this.svgText=i,this.workspace.getThemeManager().subscribe(this.svgText,"flyoutForegroundColour","fill"));const s=_e(i,"fontSize"),o=_e(i,"fontWeight"),r=_e(i,"fontFamily");if(this.width=de(i,s,o,r),n=pe(n,s,o,r),this.height=n.height,!this.isFlyoutLabel){let e,i;this.width+=2*bd.TEXT_MARGIN_X,this.height+=2*bd.TEXT_MARGIN_Y,null==(e=t)||e.setAttribute("width",String(this.width)),null==(i=t)||i.setAttribute("height",String(this.height))}return e.setAttribute("width",String(this.width)),e.setAttribute("height",String(this.height)),i.setAttribute("x",String(this.width/2)),i.setAttribute("y",String(this.height/2-n.height/2+n.baseline)),this.updateTransform(),this.onMouseUpWrapper=j(this.svgGroup,"pointerup",this,this.onMouseUp),this.svgGroup}show(){this.updateTransform(),this.svgGroup.setAttribute("display","block")}updateTransform(){this.svgGroup.setAttribute("transform","translate("+this.position.x+","+this.position.y+")")}moveTo(e,t){this.position.x=e,this.position.y=t,this.updateTransform()}isLabel(){return this.isFlyoutLabel}getPosition(){return this.position}getButtonText(){return this.text}getTargetWorkspace(){return this.targetWorkspace}getWorkspace(){return this.workspace}dispose(){this.onMouseUpWrapper&&X(this.onMouseUpWrapper),this.svgGroup&&oe(this.svgGroup),this.svgText&&this.workspace.getThemeManager().unsubscribe(this.svgText)}setCursorSvg(e){e?this.svgGroup&&(this.svgGroup.appendChild(e),this.cursorSvg=e):this.cursorSvg=null}setMarkerSvg(){throw Error("Attempted to set a marker on a button.")}onMouseUp(e){(e=this.targetWorkspace.getGesture(e))&&e.cancel(),this.isFlyoutLabel&&this.callbackKey?console.warn("Labels should not have callbacks. Label text: "+this.text):this.isFlyoutLabel||this.callbackKey&&this.targetWorkspace.getButtonCallback(this.callbackKey)?this.isFlyoutLabel||(e=this.targetWorkspace.getButtonCallback(this.callbackKey))&&e(this):console.warn("Buttons should have callbacks. Button text: "+this.text)}};bd.TEXT_MARGIN_X=5,bd.TEXT_MARGIN_Y=2,bd.BORDER_RADIUS=4,Z("\n.blocklyFlyoutButton {\n  fill: #888;\n  cursor: default;\n}\n\n.blocklyFlyoutButtonShadow {\n  fill: #666;\n}\n\n.blocklyFlyoutButton:hover {\n  fill: #aaa;\n}\n\n.blocklyFlyoutLabel {\n  cursor: default;\n}\n\n.blocklyFlyoutLabelBackground {\n  opacity: 0;\n}\n");var Id=class{constructor(e,t,i){if(this.wsCoordinate=null,!t)throw Error("Cannot create a node without a location.");this.type=e,this.isConnectionLocation=Id.isConnectionType(e),this.location=t,this.processParams(i||null)}processParams(e){e&&e.wsCoordinate&&(this.wsCoordinate=e.wsCoordinate)}getLocation(){return this.location}getType(){return this.type}getWsCoordinate(){return this.wsCoordinate}isConnection(){return this.isConnectionLocation}findNextForInput(){var e=this.location.getParentInput();const t=e.getSourceBlock();for(e=t.inputList.indexOf(e),e+=1;e<t.inputList.length;e++){const i=t.inputList[e],n=i.fieldRow;for(let e=0;e<n.length;e++){const t=n[e];if(t.isClickable()||Id.NAVIGATE_ALL_FIELDS)return Id.createFieldNode(t)}if(i.connection)return Id.createInputNode(i)}return null}findNextForField(){var e=this.location,t=e.getParentInput();const i=e.getSourceBlock();if(!i)throw Error("The current AST location is not associated with a block");var n=i.inputList.indexOf(t);for(e=t.fieldRow.indexOf(e)+1;n<i.inputList.length;n++){const s=(t=i.inputList[n]).fieldRow;for(;e<s.length;){if(s[e].isClickable()||Id.NAVIGATE_ALL_FIELDS)return Id.createFieldNode(s[e]);e++}if(e=0,t.connection)return Id.createInputNode(t)}return null}findPrevForInput(){const e=this.location.getParentInput(),t=e.getSourceBlock();for(var i=t.inputList.indexOf(e);0<=i;i--){var n=t.inputList[i];if(n.connection&&n!==e)return Id.createInputNode(n);for(let e=(n=n.fieldRow).length-1;0<=e;e--){const t=n[e];if(t.isClickable()||Id.NAVIGATE_ALL_FIELDS)return Id.createFieldNode(t)}}return null}findPrevForField(){var e=this.location;const t=e.getParentInput(),i=e.getSourceBlock();if(!i)throw Error("The current AST location is not associated with a block");var n=i.inputList.indexOf(t);for(e=t.fieldRow.indexOf(e)-1;0<=n;n--){var s=i.inputList[n];if(s.connection&&s!==t)return Id.createInputNode(s);for(s=s.fieldRow;-1<e;){if(s[e].isClickable()||Id.NAVIGATE_ALL_FIELDS)return Id.createFieldNode(s[e]);e--}0<=n-1&&(e=i.inputList[n-1].fieldRow.length-1)}return null}navigateBetweenStacks(e){var t=this.getLocation();if(t.getSourceBlock){var i=t.getSourceBlock();i&&(t=i)}if(!t||t.isDeadOrDying())return null;if(t.workspace.isFlyout)return this.navigateFlyoutContents(e);i=t.getRootBlock(),t=i.workspace.getTopBlocks(!0);for(let n=0;n<t.length;n++)if(i.id===t[n].id)return-1===(e=n+(e?1:-1))||e===t.length?null:Id.createStackNode(t[e]);throw Error("Couldn't find "+(e?"next":"previous")+" stack?!")}navigateFlyoutContents(e){let t;switch(this.getType()){case Id.types.STACK:var i=(t=this.getLocation()).workspace.targetWorkspace;break;case Id.types.BUTTON:i=(t=this.getLocation()).getTargetWorkspace();break;default:return null}return(i=i.getFlyout())&&(e=this.findNextLocationInFlyout(i.getContents(),t,e))?"button"===e.type&&e.button?Id.createButtonNode(e.button):"block"===e.type&&e.block?Id.createStackNode(e.block):null:null}findNextLocationInFlyout(e,t,i){const n=e.findIndex((e=>t instanceof Ed&&e.block===t||t instanceof bd&&e.button===t));return 0>n||-1===(i=i?n+1:n-1)||i===e.length?null:e[i]}findTopASTNodeForBlock(e){const t=yo(e);return t?Id.createConnectionNode(t):Id.createBlockNode(e)}getOutAstNodeForBlock(e){if(!e)return null;e=e.getTopStackBlock();const t=yo(e);return t&&t.targetConnection&&t.targetConnection.getParentInput()?Id.createInputNode(t.targetConnection.getParentInput()):Id.createStackNode(e)}findFirstFieldOrInput(e){e=e.inputList;for(let t=0;t<e.length;t++){const i=e[t],n=i.fieldRow;for(let e=0;e<n.length;e++){const t=n[e];if(t.isClickable()||Id.NAVIGATE_ALL_FIELDS)return Id.createFieldNode(t)}if(i.connection)return Id.createInputNode(i)}return null}getSourceBlock(){return this.getType()===Id.types.BLOCK||this.getType()===Id.types.STACK?this.getLocation():this.getType()===Id.types.WORKSPACE||this.getType()===Id.types.BUTTON?null:this.getLocation().getSourceBlock()}next(){switch(this.type){case Id.types.STACK:return this.navigateBetweenStacks(!0);case Id.types.OUTPUT:return Id.createBlockNode(this.location.getSourceBlock());case Id.types.FIELD:return this.findNextForField();case Id.types.INPUT:return this.findNextForInput();case Id.types.BLOCK:const e=this.location.nextConnection;if(!e)break;return Id.createConnectionNode(e);case Id.types.PREVIOUS:return Id.createBlockNode(this.location.getSourceBlock());case Id.types.NEXT:return Id.createConnectionNode(this.location.targetConnection);case Id.types.BUTTON:return this.navigateFlyoutContents(!0)}return null}in(){switch(this.type){case Id.types.WORKSPACE:const e=this.location.getTopBlocks(!0);if(0<e.length)return Id.createStackNode(e[0]);break;case Id.types.STACK:return this.findTopASTNodeForBlock(this.location);case Id.types.BLOCK:return this.findFirstFieldOrInput(this.location);case Id.types.INPUT:return Id.createConnectionNode(this.location.targetConnection)}return null}prev(){switch(this.type){case Id.types.STACK:return this.navigateBetweenStacks(!1);case Id.types.FIELD:return this.findPrevForField();case Id.types.INPUT:return this.findPrevForInput();case Id.types.BLOCK:var e=yo(this.location);if(!e)break;return Id.createConnectionNode(e);case Id.types.PREVIOUS:if((e=this.location.targetConnection)&&!e.getParentInput())return Id.createConnectionNode(e);break;case Id.types.NEXT:return Id.createBlockNode(this.location.getSourceBlock());case Id.types.BUTTON:return this.navigateFlyoutContents(!1)}return null}out(){switch(this.type){case Id.types.STACK:var e=this.location,t=e.getRelativeToSurfaceXY();return t=new cl(t.x,t.y+Id.DEFAULT_OFFSET_Y),Id.createWorkspaceNode(e.workspace,t);case Id.types.OUTPUT:return(t=(e=this.location).targetConnection)?Id.createConnectionNode(t):Id.createStackNode(e.getSourceBlock());case Id.types.FIELD:if(!(e=this.location.getSourceBlock()))throw Error("The current AST location is not associated with a block");return Id.createBlockNode(e);case Id.types.INPUT:return Id.createBlockNode(this.location.getSourceBlock());case Id.types.BLOCK:return this.getOutAstNodeForBlock(this.location);case Id.types.PREVIOUS:case Id.types.NEXT:return this.getOutAstNodeForBlock(this.location.getSourceBlock())}return null}static isConnectionType(e){switch(e){case Id.types.PREVIOUS:case Id.types.NEXT:case Id.types.INPUT:case Id.types.OUTPUT:return!0}return!1}static createFieldNode(e){return e?new Id(Id.types.FIELD,e):null}static createConnectionNode(e){if(!e)return null;const t=e.type;return t===eh.INPUT_VALUE||t===eh.NEXT_STATEMENT&&e.getParentInput()?Id.createInputNode(e.getParentInput()):t===eh.NEXT_STATEMENT?new Id(Id.types.NEXT,e):t===eh.OUTPUT_VALUE?new Id(Id.types.OUTPUT,e):t===eh.PREVIOUS_STATEMENT?new Id(Id.types.PREVIOUS,e):null}static createInputNode(e){return e&&e.connection?new Id(Id.types.INPUT,e.connection):null}static createBlockNode(e){return e?new Id(Id.types.BLOCK,e):null}static createStackNode(e){return e?new Id(Id.types.STACK,e):null}static createButtonNode(e){return e?new Id(Id.types.BUTTON,e):null}static createWorkspaceNode(e,t){return t&&e?new Id(Id.types.WORKSPACE,e,{wsCoordinate:t}):null}static createTopNode(e){const t=yo(e);return t?Id.createConnectionNode(t):Id.createBlockNode(e)}};Id.NAVIGATE_ALL_FIELDS=!1,Id.DEFAULT_OFFSET_Y=-20,function(e){(e=e.types||(e.types={})).FIELD="field",e.BLOCK="block",e.INPUT="input",e.OUTPUT="output",e.NEXT="next",e.PREVIOUS="previous",e.STACK="stack",e.WORKSPACE="workspace",e.BUTTON="button"}(Id||(Id={}));var yd=class extends Oa{constructor(e,t,i,n){let s=e?e.workspace.id:void 0;n&&n.getType()===Id.types.WORKSPACE&&(s=n.getLocation().id),super(s),this.type="marker_move",this.blockId=null==e?void 0:e.id,this.oldNode=i||void 0,this.newNode=n,this.isCursor=t}toJson(){const e=super.toJson();if(void 0===this.isCursor)throw Error("Whether this is a cursor event or not is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newNode)throw Error("The new node is undefined. Either pass a node to the constructor, or call fromJson");return e.isCursor=this.isCursor,e.blockId=this.blockId,e.oldNode=this.oldNode,e.newNode=this.newNode,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new yd)).isCursor=e.isCursor,t.blockId=e.blockId,t.oldNode=e.oldNode,t.newNode=e.newNode,t}};t(Xr.EVENT,"marker_move",yd);var vd=class{constructor(e,t,i){this.workspace=e,this.marker=i,this.markerSvgRect_=this.markerSvgLine_=this.markerInput_=this.markerBlock_=this.svgGroup_=this.markerSvg_=this.currentMarkerSvg=this.parent=null,this.constants_=t,e=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR,this.colour_=i.colour||e}getSvgRoot(){return this.svgGroup_}getMarker(){return this.marker}isCursor(){return"cursor"===this.marker.type}createDom(){const e=this.isCursor()?"blocklyCursor":"blocklyMarker";return this.svgGroup_=ee(_l.G,{class:e}),this.createDomInternal_(),this.svgGroup_}setParent_(e){this.isCursor()?(this.parent&&this.parent.setCursorSvg(null),e.setCursorSvg(this.getSvgRoot())):(this.parent&&this.parent.setMarkerSvg(null),e.setMarkerSvg(this.getSvgRoot())),this.parent=e}draw(e,t){if(t){this.constants_=this.workspace.getRenderer().getConstants();var i=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=this.marker.colour||i,this.applyColour_(t),this.showAtLocation_(t),this.fireMarkerEvent(e,t),void 0!==(e=this.currentMarkerSvg.childNodes[0])&&e.beginElement&&e.beginElement()}else this.hide()}showAtLocation_(e){const t=e.getLocation().type;e.getType()===Id.types.BLOCK?this.showWithBlock_(e):e.getType()===Id.types.OUTPUT?this.showWithOutput_(e):t===eh.INPUT_VALUE?this.showWithInput_(e):t===eh.NEXT_STATEMENT?this.showWithNext_(e):e.getType()===Id.types.PREVIOUS?this.showWithPrevious_(e):e.getType()===Id.types.FIELD?this.showWithField_(e):e.getType()===Id.types.WORKSPACE?this.showWithCoordinates_(e):e.getType()===Id.types.STACK?this.showWithStack_(e):e.getType()===Id.types.BUTTON&&this.showWithButton_(e)}showWithBlockPrevOutput(e){const t=(e=e.getSourceBlock()).width;var i=e.height,n=.75*i;const s=this.constants_.CURSOR_BLOCK_PADDING;e.previousConnection?(i=this.constants_.shapeFor(e.previousConnection),this.positionPrevious_(t,s,n,i)):e.outputConnection?(n=this.constants_.shapeFor(e.outputConnection),this.positionOutput_(t,i,n)):this.positionBlock_(t,s,n),this.setParent_(e),this.showCurrent_()}showWithBlock_(e){this.showWithBlockPrevOutput(e)}showWithPrevious_(e){this.showWithBlockPrevOutput(e)}showWithOutput_(e){this.showWithBlockPrevOutput(e)}showWithCoordinates_(e){var t=e.getWsCoordinate();e=t.x,t=t.y,this.workspace.RTL&&(e-=this.constants_.CURSOR_WS_WIDTH),this.positionLine_(e,t,this.constants_.CURSOR_WS_WIDTH),this.setParent_(this.workspace),this.showCurrent_()}showWithField_(e){const t=(e=e.getLocation()).getSize().width,i=e.getSize().height;this.positionRect_(0,0,t,i),this.setParent_(e),this.showCurrent_()}showWithInput_(e){const t=(e=e.getLocation()).getSourceBlock();this.positionInput_(e),this.setParent_(t),this.showCurrent_()}showWithNext_(e){var t=e.getLocation();e=t.getSourceBlock();let i=0;t=t.getOffsetInBlock().y;const n=e.getHeightWidth().width;this.workspace.RTL&&(i=-n),this.positionLine_(i,t,n),this.setParent_(e),this.showCurrent_()}showWithStack_(e){var t=(e=e.getLocation()).getHeightWidth();const i=t.width+this.constants_.CURSOR_STACK_PADDING;t=t.height+this.constants_.CURSOR_STACK_PADDING;const n=-this.constants_.CURSOR_STACK_PADDING/2,s=-this.constants_.CURSOR_STACK_PADDING/2;let o=n;this.workspace.RTL&&(o=-(i+n)),this.positionRect_(o,s,i,t),this.setParent_(e),this.showCurrent_()}showWithButton_(e){const t=(e=e.getLocation()).width+this.constants_.CURSOR_STACK_PADDING,i=e.height+this.constants_.CURSOR_STACK_PADDING,n=-this.constants_.CURSOR_STACK_PADDING/2,s=-this.constants_.CURSOR_STACK_PADDING/2;let o=n;this.workspace.RTL&&(o=-(t+n)),this.positionRect_(o,s,t,i),this.setParent_(e),this.showCurrent_()}showCurrent_(){this.hide(),this.currentMarkerSvg&&(this.currentMarkerSvg.style.display="")}positionBlock_(e,t,i){if(e=qs(-t,i)+Qs("V",-t)+Qs("H",e+2*t)+Qs("V",i),!this.markerBlock_)throw Error("createDom should be called before positioning the marker");this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionInput_(e){const t=e.getOffsetInBlock().x,i=e.getOffsetInBlock().y;e=Ks(0,0)+this.constants_.shapeFor(e).pathDown,this.markerInput_.setAttribute("d",e),this.markerInput_.setAttribute("transform","translate("+t+","+i+")"+(this.workspace.RTL?" scale(-1 1)":"")),this.currentMarkerSvg=this.markerInput_}positionLine_(e,t,i){if(!this.markerSvgLine_)throw Error("createDom should be called before positioning the line");this.markerSvgLine_.setAttribute("x",`${e}`),this.markerSvgLine_.setAttribute("y",`${t}`),this.markerSvgLine_.setAttribute("width",`${i}`),this.currentMarkerSvg=this.markerSvgLine_}positionOutput_(e,t,i){if(!this.markerBlock_)throw Error("createDom should be called before positioning the output");e=qs(e,0)+Qs("h",-(e-i.width))+Qs("v",this.constants_.TAB_OFFSET_FROM_TOP)+i.pathDown+Qs("V",t)+Qs("H",e),this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionPrevious_(e,t,i,n){if(!this.markerBlock_)throw Error("createDom should be called before positioning the previous connection marker");e=qs(-t,i)+Qs("V",-t)+Qs("H",this.constants_.NOTCH_OFFSET_LEFT)+n.pathLeft+Qs("H",e+2*t)+Qs("V",i),this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionRect_(e,t,i,n){if(!this.markerSvgRect_)throw Error("createDom should be called before positioning the rect");this.markerSvgRect_.setAttribute("x",`${e}`),this.markerSvgRect_.setAttribute("y",`${t}`),this.markerSvgRect_.setAttribute("width",`${i}`),this.markerSvgRect_.setAttribute("height",`${n}`),this.currentMarkerSvg=this.markerSvgRect_}flipRtl(e){e.setAttribute("transform","scale(-1 1)")}hide(){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before hiding the marker");this.markerSvgLine_.style.display="none",this.markerSvgRect_.style.display="none",this.markerInput_.style.display="none",this.markerBlock_.style.display="none"}fireMarkerEvent(e,t){const i=t.getSourceBlock();e=new(y("marker_move"))(i,this.isCursor(),e,t),p(e)}getBlinkProperties_(){return{attributeType:"XML",attributeName:"fill",dur:"1s",values:this.colour_+";transparent;transparent;",repeatCount:"indefinite"}}createDomInternal_(){if(this.markerSvg_=ee(_l.G,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.svgGroup_),this.markerSvgLine_=ee(_l.RECT,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.markerSvg_),this.markerSvgRect_=ee(_l.RECT,{class:"blocklyVerticalMarker",rx:10,ry:10},this.markerSvg_),this.markerInput_=ee(_l.PATH,{transform:""},this.markerSvg_),this.markerBlock_=ee(_l.PATH,{transform:"",fill:"none","stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const e=this.getBlinkProperties_();ee(_l.ANIMATE,e,this.markerSvgLine_),ee(_l.ANIMATE,e,this.markerInput_),ee(_l.ANIMATE,Object.assign({},e,{attributeName:"stroke"}),this.markerBlock_)}return this.markerSvg_}applyColour_(e){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before applying color to the markerj");this.markerSvgLine_.setAttribute("fill",this.colour_),this.markerSvgRect_.setAttribute("stroke",this.colour_),this.markerInput_.setAttribute("fill",this.colour_),this.markerBlock_.setAttribute("stroke",this.colour_),this.isCursor()&&(e=this.colour_+";transparent;transparent;",this.markerSvgLine_.firstElementChild.setAttribute("values",e),this.markerInput_.firstElementChild.setAttribute("values",e),this.markerBlock_.firstElementChild.setAttribute("values",e))}dispose(){this.svgGroup_&&oe(this.svgGroup_)}},Cd=class{constructor(e,t,i){this.markerSvg=this.cursorSvg=null,this.connectionHighlights=new WeakMap,this.highlightOffsets=new WeakMap,this.constants=i,this.style=t,this.svgRoot=e,this.svgPath=ee(_l.PATH,{class:"blocklyPath"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)")}setCursorSvg(e){e?(this.svgRoot.appendChild(e),this.cursorSvg=e):this.cursorSvg=null}setMarkerSvg(e){e?(this.cursorSvg?this.svgRoot.insertBefore(e,this.cursorSvg):this.svgRoot.appendChild(e),this.markerSvg=e):this.markerSvg=null}applyColour(e){this.svgPath.setAttribute("stroke",this.style.colourTertiary),this.svgPath.setAttribute("fill",this.style.colourPrimary),this.updateShadow_(e.isShadow()),this.updateDisabled_(!e.isEnabled()||e.getInheritedDisabled())}setStyle(e){this.style=e}setClass_(e,t){e&&(t?te(this.svgRoot,e):ne(this.svgRoot,e))}updateHighlighted(e){e?this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"):this.svgPath.setAttribute("filter","none")}updateShadow_(e){e&&(this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))}updateDisabled_(e){this.setClass_("blocklyDisabled",e),e&&this.svgPath.setAttribute("fill","url(#"+this.constants.disabledPatternId+")")}updateSelected(e){this.setClass_("blocklySelected",e)}updateDraggingDelete(e){this.setClass_("blocklyDraggingDelete",e)}updateInsertionMarker(e){this.setClass_("blocklyInsertionMarker",e)}updateMovable(e){this.setClass_("blocklyDraggable",e)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e)}updateShapeForInputHighlight(e,t){}addConnectionHighlight(e,t,i,n){if(this.connectionHighlights.has(e)){if(this.currentHighlightMatchesNew(e,t,i))return;this.removeConnectionHighlight(e)}t=ee(_l.PATH,{class:"blocklyHighlightedConnectionPath",d:t,transform:`translate(${i.x}, ${i.y})`+(n?" scale(-1 1)":"")},this.svgRoot),this.connectionHighlights.set(e,t)}currentHighlightMatchesNew(e,t,i){let n;const s=null==(n=this.connectionHighlights.get(e))?void 0:n.getAttribute("d");return e=this.highlightOffsets.get(e),s===t&&cl.equals(e,i)}removeConnectionHighlight(e){const t=this.connectionHighlights.get(e);t&&(oe(t),this.connectionHighlights.delete(e))}},kd=class{constructor(e){this.activeCandidate=this.lastMarker=this.lastOnStack=null,this.wouldDeleteBlock=!1,this.fadedBlock=this.highlightedBlock=this.markerConnection=null,Hr.setSelected$$module$build$src$core$common(e),this.topBlock=e,this.workspace=e.workspace,this.firstMarker=this.createMarkerBlock(this.topBlock),this.availableConnections=this.initAvailableConnections(),this.lastOnStack&&(this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock()))}dispose(){this.availableConnections.length=0,this.disposeInsertionMarker(this.firstMarker),this.disposeInsertionMarker(this.lastMarker)}updateAvailableConnections(){this.availableConnections=this.initAvailableConnections()}wouldConnectBlock(){return!!this.activeCandidate}applyConnections(){if(this.activeCandidate){Hr.disable$$module$build$src$core$events$utils(),this.hidePreview(),Hr.enable$$module$build$src$core$events$utils();var{local:e,closest:t}=this.activeCandidate;e.connect(t);var i=e.isSuperior()?t:e,n=this.topBlock.getRootBlock();_t().then((()=>{Ts(i.getSourceBlock()),setTimeout((()=>{n.bringToFront()}),0)}))}}update(e,t){const i=this.getCandidate(e);((this.wouldDeleteBlock=this.shouldDelete(!!i,t))||this.shouldUpdatePreviews(i,e))&&(Hr.disable$$module$build$src$core$events$utils(),this.maybeHidePreview(i),this.maybeShowPreview(i),Hr.enable$$module$build$src$core$events$utils())}createMarkerBlock(e){let t;Hr.disable$$module$build$src$core$events$utils();try{const i=Mt(e,{addCoordinates:!1,addInputBlocks:!1,addNextBlocks:!1,doFullSerialization:!1});if(!i)throw Error(`Failed to serialize source block. ${e.toDevString()}`);t=Wt(i,this.workspace);for(const e of t.getDescendants(!1))e.setInsertionMarker(!0);t.initSvg(),t.getSvgRoot().setAttribute("visibility","hidden")}finally{Hr.enable$$module$build$src$core$events$utils()}return t}initAvailableConnections(){const e=this.topBlock.getConnections_(!1),t=this.topBlock.lastConnectionInStack(!0);return t&&t!==this.topBlock.nextConnection&&(e.push(t),this.lastOnStack=t),e}shouldUpdatePreviews(e,t){if(!e)return!!this.activeCandidate;if(!this.activeCandidate)return!0;const{local:i,closest:n}=this.activeCandidate;if(n===e.closest&&i===e.local)return!1;const s=i.x+t.x-n.x;return t=i.y+t.y-n.y,e.radius<Math.sqrt(s*s+t*t)-Hr.config$$module$build$src$core$config.currentConnectionPreference}getCandidate(e){this.markerConnection&&this.markerConnection.isConnected()||this.updateAvailableConnections();let t=this.getStartRadius(),i=null;for(let n=0;n<this.availableConnections.length;n++){const s=this.availableConnections[n],o=s.closest(t,e);o.connection&&(i={closest:o.connection,local:s,radius:o.radius},t=o.radius)}return i}getStartRadius(){return this.activeCandidate?Hr.config$$module$build$src$core$config.connectingSnapRadius:Hr.config$$module$build$src$core$config.snapRadius}shouldDelete(e,t){return!(!t||!this.workspace.getComponentManager().hasCapability(t.id,sl.Capability.DELETE_AREA))&&t.wouldDelete(this.topBlock)}maybeShowPreview(e){if(!this.wouldDeleteBlock&&e){var t,i=e.closest;i===(null==(t=this.activeCandidate)?void 0:t.closest)||i.getSourceBlock().isInsertionMarker()?console.log("Trying to connect to an insertion marker"):(this.activeCandidate=e,this.showPreview(this.activeCandidate))}}showPreview(e){const t=this.workspace.getRenderer();switch(t.getConnectionPreviewMethod(e.closest,e.local,this.topBlock)){case kd.PREVIEW_TYPE.INPUT_OUTLINE:this.showInsertionInputOutline(e);break;case kd.PREVIEW_TYPE.INSERTION_MARKER:this.showInsertionMarker(e);break;case kd.PREVIEW_TYPE.REPLACEMENT_FADE:this.showReplacementFade(e)}t.shouldHighlightConnection(e.closest)&&e.closest.highlight()}maybeHidePreview(e){if(e){if(this.activeCandidate){const t=this.activeCandidate.local!==e.local;(this.activeCandidate.closest!==e.closest||t||this.wouldDeleteBlock)&&this.hidePreview()}}else this.hidePreview();this.activeCandidate=this.markerConnection=null}hidePreview(){let e;const t=null==(e=this.activeCandidate)?void 0:e.closest;t&&t.targetBlock()&&this.workspace.getRenderer().shouldHighlightConnection(t)&&t.unhighlight(),this.hideReplacementFade(),this.hideInsertionInputOutline(),this.hideInsertionMarker()}showInsertionMarker(e){const{local:t,closest:i}=e;let n,s=(e=this.lastOnStack&&t===this.lastOnStack)?this.lastMarker:this.firstMarker;if(!s)throw Error("Cannot show the insertion marker because there is no insertion marker block");try{n=s.getMatchingConnection(t.getSourceBlock(),t)}catch(i){if(e&&this.lastOnStack?(this.disposeInsertionMarker(this.lastMarker),s=this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock())):(this.disposeInsertionMarker(this.firstMarker),s=this.firstMarker=this.createMarkerBlock(this.topBlock)),!s)throw Error("Cannot show the insertion marker because there is no insertion marker block");n=s.getMatchingConnection(t.getSourceBlock(),t)}if(!n)throw Error("Cannot show the insertion marker because there is no associated connection");if(n===this.markerConnection)throw Error("Made it to showInsertionMarker_ even though the marker isn't changing");s.queueRender(),Tt(),n.connect(i);const o={x:i.x-n.x,y:i.y-n.y},r=n.getOffsetInBlock().clone(),a=n;_t().then((()=>{let e,t;null==(e=s)||e.positionNearConnection(a,o,r),null==(t=s)||t.getSvgRoot().setAttribute("visibility","visible")})),this.markerConnection=n}hideInsertionMarker(){if(this.markerConnection){var e,t=this.markerConnection,i=t.getSourceBlock(),n=i.outputConnection;if(null!=(e=i.previousConnection)&&e.targetConnection||null!=n&&n.targetConnection)i.unplug(!0);else{let e;null==(e=t.targetBlock())||e.unplug(!1)}if(t.targetConnection)throw Error("markerConnection still connected at the end of disconnectInsertionMarker");this.markerConnection=null,(t=i.getSvgRoot())&&t.setAttribute("visibility","hidden")}}showInsertionInputOutline(e){e=e.closest,this.highlightedBlock=e.getSourceBlock(),this.highlightedBlock.highlightShapeForInput(e,!0)}hideInsertionInputOutline(){if(this.highlightedBlock){if(!this.activeCandidate)throw Error("Cannot hide the insertion marker outline because there is no active candidate");this.highlightedBlock.highlightShapeForInput(this.activeCandidate.closest,!1),this.highlightedBlock=null}}showReplacementFade(e){if(this.fadedBlock=e.closest.targetBlock(),!this.fadedBlock)throw Error("Cannot show the replacement fade because the closest connection does not have a target block");this.fadedBlock.fadeForReplacement(!0)}hideReplacementFade(){this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null)}getInsertionMarkers(){const e=[];return this.firstMarker&&e.push(this.firstMarker),this.lastMarker&&e.push(this.lastMarker),e}disposeInsertionMarker(e){if(e){Hr.disable$$module$build$src$core$events$utils();try{e.dispose()}finally{Hr.enable$$module$build$src$core$events$utils()}}}};!function(e){(e=e.PREVIEW_TYPE||(e.PREVIEW_TYPE={}))[e.INSERTION_MARKER=0]="INSERTION_MARKER",e[e.INPUT_OUTLINE=1]="INPUT_OUTLINE",e[e.REPLACEMENT_FADE=2]="REPLACEMENT_FADE"}(kd||(kd={}));var Od=kd.PREVIEW_TYPE,Nd={};Nd.InsertionMarkerManager=kd,Nd.PreviewType=Od;var Ad=class{constructor(e){this.overrides=null,this.name=e}getClassName(){return this.name+"-renderer"}init(e,t){this.constants_=this.makeConstants_(),t&&(this.overrides=t,Object.assign(this.constants_,t)),this.constants_.setTheme(e),this.constants_.init()}createDom(e,t){this.constants_.createDom(e,this.name+"-"+t.name,"."+this.getClassName()+"."+t.getClassName())}refreshDom(e,t){const i=this.getConstants();i.dispose(),this.constants_=this.makeConstants_(),this.overrides&&Object.assign(this.constants_,this.overrides),this.constants_.randomIdentifier=i.randomIdentifier,this.constants_.setTheme(t),this.constants_.init(),this.createDom(e,t)}dispose(){this.constants_&&this.constants_.dispose()}makeConstants_(){return new ld}makeRenderInfo_(e){return new fd(this,e)}makeDrawer_(e,t){return new ud(e,t)}makeMarkerDrawer(e,t){return new vd(e,this.getConstants(),t)}makePathObject(e,t){return new Cd(e,t,this.constants_)}getConstants(){return this.constants_}shouldHighlightConnection(e){return!0}orphanCanConnectAtEnd(e,t,i){return!!Td.getConnectionForOrphanedConnection(e,i===eh.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}getConnectionPreviewMethod(e,t,i){return Xs("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),t.type===eh.OUTPUT_VALUE||t.type===eh.PREVIOUS_STATEMENT?!e.isConnected()||this.orphanCanConnectAtEnd(i,e.targetBlock(),t.type)?kd.PREVIEW_TYPE.INSERTION_MARKER:kd.PREVIEW_TYPE.REPLACEMENT_FADE:kd.PREVIEW_TYPE.INSERTION_MARKER}render(e){const t=this.makeRenderInfo_(e);t.measure(),this.makeDrawer_(e,t).draw()}},Sd={};Sd.BottomRow=Vh,Sd.Connection=jh,Sd.ConstantProvider=ld,Sd.Drawer=ud,Sd.ExternalValueInput=Xh,Sd.Field=Yh,Sd.Hat=zh,Sd.Icon=Kh,Sd.InRowSpacer=qh,Sd.InlineInput=Jh,Sd.InputConnection=Wh,Sd.InputRow=Qh,Sd.JaggedEdge=ed,Sd.MarkerSvg=vd,Sd.Measurable=Hh,Sd.NextConnection=td,Sd.OutputConnection=id,Sd.PathObject=Cd,Sd.PreviousConnection=nd,Sd.RenderInfo=fd,Sd.Renderer=Ad,Sd.RoundCorner=sd,Sd.Row=Gh,Sd.SpacerRow=od,Sd.SquareCorner=rd,Sd.StatementInput=Zh,Sd.TopRow=ad,Sd.Types=Uh,Sd.init=ko,Sd.register=vo,Sd.unregister=Co;var Rd=class{constructor(e,t){this.workspace=e,this.theme=t,this.subscribedWorkspaces_=[],this.componentDB=new Map}getTheme(){return this.theme}setTheme(e){var t=this.theme;this.theme=e,(e=this.workspace.getInjectionDiv())&&(t&&(t=t.getClassName())&&ne(e,t),(t=this.theme.getClassName())&&te(e,t));for(let e,t=0;e=this.subscribedWorkspaces_[t];t++)e.refreshTheme();for(const[i,n]of this.componentDB)for(const s of n){e=s.element,t=s.propertyName;const n=this.theme&&this.theme.getComponentStyle(i);e.style.setProperty(t,n||"")}for(const e of this.subscribedWorkspaces_)e.hideChaff()}subscribeWorkspace(e){this.subscribedWorkspaces_.push(e)}unsubscribeWorkspace(e){if(!J(this.subscribedWorkspaces_,e))throw Error("Cannot unsubscribe a workspace that hasn't been subscribed.")}subscribe(e,t,i){this.componentDB.has(t)||this.componentDB.set(t,[]),this.componentDB.get(t).push({element:e,propertyName:i}),t=this.theme&&this.theme.getComponentStyle(t),e.style.setProperty(i,t||"")}unsubscribe(e){if(e)for(const[t,i]of this.componentDB){for(let t=i.length-1;0<=t;t--)i[t].element===e&&i.splice(t,1);i.length||this.componentDB.delete(t)}}dispose(){this.subscribedWorkspaces_.length=0,this.componentDB.clear()}},wd={CATEGORY_NAME:"VARIABLE_DYNAMIC"};wd.flyoutCategory=So,wd.flyoutCategoryBlocks=Ro,wd.onCreateVariableButtonClick_Colour=Ao,wd.onCreateVariableButtonClick_Number=No,wd.onCreateVariableButtonClick_String=Oo;var Ld=[];Ld[eh.INPUT_VALUE]=eh.OUTPUT_VALUE,Ld[eh.OUTPUT_VALUE]=eh.INPUT_VALUE,Ld[eh.NEXT_STATEMENT]=eh.PREVIOUS_STATEMENT,Ld[eh.PREVIOUS_STATEMENT]=eh.NEXT_STATEMENT;var xd=class{canConnect(e,t,i,n){return this.canConnectWithReason(e,t,i,n)===Td.CAN_CONNECT}canConnectWithReason(e,t,i,n){const s=this.doSafetyChecks(e,t);return s!==Td.CAN_CONNECT?s:this.doTypeChecks(e,t)?i&&!this.doDragChecks(e,t,n||0)?Td.REASON_DRAG_CHECKS_FAILED:Td.CAN_CONNECT:Td.REASON_CHECKS_FAILED}getErrorMessage(e,t,i){switch(e){case Td.REASON_SELF_CONNECTION:return"Attempted to connect a block to itself.";case Td.REASON_DIFFERENT_WORKSPACES:return"Blocks not on same workspace.";case Td.REASON_WRONG_TYPE:return"Attempt to connect incompatible types.";case Td.REASON_TARGET_NULL:return"Target connection is null.";case Td.REASON_CHECKS_FAILED:return"Connection checks failed. "+t+" expected "+t.getCheck()+", found "+i.getCheck();case Td.REASON_SHADOW_PARENT:return"Connecting non-shadow to shadow block.";case Td.REASON_DRAG_CHECKS_FAILED:return"Drag checks failed.";case Td.REASON_PREVIOUS_AND_OUTPUT:return"Block would have an output and a previous connection.";default:return"Unknown connection failure: this should never happen!"}}doSafetyChecks(e,t){if(!e||!t)return Td.REASON_TARGET_NULL;let i,n,s;return e.isSuperior()?(i=e.getSourceBlock(),n=t.getSourceBlock(),s=t):(n=e.getSourceBlock(),i=t.getSourceBlock(),s=e,e=t),i===n?Td.REASON_SELF_CONNECTION:s.type!==Ld[e.type]?Td.REASON_WRONG_TYPE:i.workspace!==n.workspace?Td.REASON_DIFFERENT_WORKSPACES:i.isShadow()&&!n.isShadow()?Td.REASON_SHADOW_PARENT:s.type===eh.OUTPUT_VALUE&&n.previousConnection&&n.previousConnection.isConnected()||s.type===eh.PREVIOUS_STATEMENT&&n.outputConnection&&n.outputConnection.isConnected()?Td.REASON_PREVIOUS_AND_OUTPUT:Td.CAN_CONNECT}doTypeChecks(e,t){if(e=e.getCheck(),t=t.getCheck(),!e||!t)return!0;for(let i=0;i<e.length;i++)if(t.includes(e[i]))return!0;return!1}doDragChecks(e,t,i){if(e.distanceFrom(t)>i||t.getSourceBlock().isInsertionMarker())return!1;switch(t.type){case eh.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(e,t);case eh.OUTPUT_VALUE:if(t.isConnected()&&!t.targetBlock().isInsertionMarker()||e.isConnected())return!1;break;case eh.INPUT_VALUE:if(t.isConnected()&&!t.targetBlock().isMovable()&&!t.targetBlock().isShadow())return!1;break;case eh.NEXT_STATEMENT:if(t.isConnected()&&!e.getSourceBlock().nextConnection&&!t.targetBlock().isShadow()&&t.targetBlock().nextConnection||t.targetBlock()&&!t.targetBlock().isMovable()&&!t.targetBlock().isShadow())return!1;break;default:return!1}return!ba.includes(t)}canConnectToPrevious_(e,t){return!(e.targetConnection||ba.includes(t)||t.targetConnection&&(!(e=t.targetBlock()).isInsertionMarker()||e.getPreviousBlock()))}};t(Xr.CONNECTION_CHECKER,Wr,xd);var $d=class extends sc{constructor(e){super(e),this.type="var_delete",e&&(this.varType=e.type,this.varName=e.name)}toJson(){const e=super.toJson();if(void 0===this.varType)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new $d)).varType=e.varType,t.varName=e.varName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");e?t.deleteVariableById(this.varId):t.createVariable(this.varName,this.varType,this.varId)}};t(Xr.EVENT,"var_delete",$d);var Dd=class extends sc{constructor(e,t){super(e),this.type="var_rename",e&&(this.oldName=e.name,this.newName=void 0===t?"":t)}toJson(){const e=super.toJson();if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");return e.oldName=this.oldName,e.newName=this.newName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Dd)).oldName=e.oldName,t.newName=e.newName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");e?t.renameVariableById(this.varId,this.newName):t.renameVariableById(this.varId,this.oldName)}};t(Xr.EVENT,"var_rename",Dd);var Md=class{constructor(e){this.workspace=e,this.variableMap=new Map}clear(){for(const e of this.variableMap.values())for(;0<e.length;)this.deleteVariable(e[0]);if(0!==this.variableMap.size)throw Error("Non-empty variable map")}renameVariable(e,t){if(e.name!==t){var i=this.getVariable(t,e.type),n=this.workspace.getAllBlocks(!1),s=Hr.getGroup$$module$build$src$core$events$utils();s||Hr.setGroup$$module$build$src$core$events$utils(!0);try{i&&i.getId()!==e.getId()?this.renameVariableWithConflict_(e,t,i,n):this.renameVariableAndUses_(e,t,n)}finally{Hr.setGroup$$module$build$src$core$events$utils(s)}}}renameVariableById(e,t){const i=this.getVariableById(e);if(!i)throw Error("Tried to rename a variable that didn't exist. ID: "+e);this.renameVariable(i,t)}renameVariableAndUses_(e,t,i){for(p(new(y("var_rename"))(e,t)),e.name=t,t=0;t<i.length;t++)i[t].updateVarName(e)}renameVariableWithConflict_(e,t,i,n){const s=e.type;for(t!==i.name&&this.renameVariableAndUses_(i,t,n),t=0;t<n.length;t++)n[t].renameVarById(e.getId(),i.getId());p(new(y("var_delete"))(e)),J(this.variableMap.get(s),e)}createVariable(e,t,i){var n=this.getVariable(e,t);if(n){if(i&&n.getId()!==i)throw Error('Variable "'+e+'" is already in use and its id is "'+n.getId()+'" which conflicts with the passed in id, "'+i+'".');return n}if(i&&this.getVariableById(i))throw Error('Variable id, "'+i+'", is already in use.');return n=i||h(),t=t||"",n=new rc(this.workspace,e,t,n),(e=this.variableMap.get(t)||[]).push(n),this.variableMap.delete(t),this.variableMap.set(t,e),p(new(y(Zr))(n)),n}deleteVariable(e){const t=e.getId(),i=this.variableMap.get(e.type);if(i)for(let n=0;n<i.length;n++)if(i[n].getId()===t){i.splice(n,1),p(new(y("var_delete"))(e)),0===i.length&&this.variableMap.delete(e.type);break}}deleteVariableById(e){const t=this.getVariableById(e);if(t){var i=t.name;const n=this.getVariableUsesById(e);for(let t,s=0;t=n[s];s++)if("procedures_defnoreturn"===t.type||"procedures_defreturn"===t.type)return e=String(t.getFieldValue("NAME")),i=Hr.Msg$$module$build$src$core$msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace("%1",i).replace("%2",e),void We(i);1<n.length?(i=Hr.Msg$$module$build$src$core$msg.DELETE_VARIABLE_CONFIRMATION.replace("%1",String(n.length)).replace("%2",i),Ye(i,(e=>{e&&t&&this.deleteVariableInternal(t,n)}))):this.deleteVariableInternal(t,n)}else console.warn("Can't delete non-existent variable: "+e)}deleteVariableInternal(e,t){const i=Hr.getGroup$$module$build$src$core$events$utils();i||Hr.setGroup$$module$build$src$core$events$utils(!0);try{for(let e=0;e<t.length;e++)t[e].dispose(!0);this.deleteVariable(e)}finally{Hr.setGroup$$module$build$src$core$events$utils(i)}}getVariable(e,t){if(t=this.variableMap.get(t||""))for(let i,n=0;i=t[n];n++)if(Hr.Names$$module$build$src$core$names.equals(i.name,e))return i;return null}getVariableById(e){for(const t of this.variableMap.values())for(const i of t)if(i.getId()===e)return i;return null}getVariablesOfType(e){return(e=this.variableMap.get(e||""))?e.slice():[]}getVariableTypes(e){const t=new Set(this.variableMap.keys());if(e&&e.getPotentialVariableMap())for(const i of e.getPotentialVariableMap().variableMap.keys())t.add(i);return t.has("")||t.add(""),Array.from(t.values())}getAllVariables(){let e=[];for(const t of this.variableMap.values())e=e.concat(t);return e}getAllVariableNames(){return Array.from(this.variableMap.values()).flat().map((e=>e.name))}getVariableUsesById(e){const t=[],i=this.workspace.getAllBlocks(!1);for(let n=0;n<i.length;n++){const s=i[n].getVarModels();if(s)for(let o=0;o<s.length;o++)s[o].getId()===e&&t.push(i[n])}return t}},Pd=class{get isFlyout(){return this.internalIsFlyout}get isMutator(){return this.internalIsMutator}constructor(e){this.isClearing=this.internalIsMutator=this.internalIsFlyout=this.rendered=!1,this.MAX_UNDO=1024,this.connectionDBList=[],this.topBlocks=[],this.topComments=[],this.commentDB=new Map,this.listeners=[],this.undoStack_=[],this.redoStack_=[],this.blockDB=new Map,this.typedBlocksDB=new Map,this.procedureMap=new ph,this.potentialVariableMap=null,this.id=h(),O(this),this.options=e||new dh({}),this.RTL=!!this.options.RTL,this.horizontalLayout=!!this.options.horizontalLayout,this.toolboxPosition=this.options.toolboxPosition,this.connectionChecker=new(c(Xr.CONNECTION_CHECKER,this.options,!0))(this),this.variableMap=new Md(this)}dispose(){this.listeners.length=0,this.clear(),N(this)}sortObjects_(e,t){const i=Math.sin(ri(Pd.SCAN_ANGLE))*(this.RTL?-1:1);return e=e.getRelativeToSurfaceXY(),t=t.getRelativeToSurfaceXY(),e.y+i*e.x-(t.y+i*t.x)}addTopBlock(e){this.topBlocks.push(e)}removeTopBlock(e){if(!J(this.topBlocks,e))throw Error("Block not present in workspace's list of top-most blocks.")}getTopBlocks(e=!1){const t=[].concat(this.topBlocks);return e&&1<t.length&&t.sort(this.sortObjects_.bind(this)),t}addTypedBlock(e){this.typedBlocksDB.has(e.type)||this.typedBlocksDB.set(e.type,[]),this.typedBlocksDB.get(e.type).push(e)}removeTypedBlock(e){J(this.typedBlocksDB.get(e.type),e),this.typedBlocksDB.get(e.type).length||this.typedBlocksDB.delete(e.type)}getBlocksByType(e,t=!1){return this.typedBlocksDB.has(e)?(e=this.typedBlocksDB.get(e).slice(0),t&&e&&1<e.length&&e.sort(this.sortObjects_.bind(this)),e.filter((function(e){return!e.isInsertionMarker()}))):[]}addTopComment(e){this.topComments.push(e),this.commentDB.has(e.id)&&console.warn('Overriding an existing comment on this workspace, with id "'+e.id+'"'),this.commentDB.set(e.id,e)}removeTopComment(e){if(!J(this.topComments,e))throw Error("Comment not present in workspace's list of top-most comments.");this.commentDB.delete(e.id)}getTopComments(e=!1){const t=[].concat(this.topComments);return e&&1<t.length&&t.sort(this.sortObjects_.bind(this)),t}getAllBlocks(e=!1){if(e){var t=this.getTopBlocks(!0);e=[];for(let i=0;i<t.length;i++)e.push(...t[i].getDescendants(!0))}else for(e=this.getTopBlocks(!1),t=0;t<e.length;t++)e.push(...e[t].getChildren(!1));return e.filter((function(e){return!e.isInsertionMarker()}))}clear(){this.isClearing=!0;try{const e=Hr.getGroup$$module$build$src$core$events$utils();for(e||Hr.setGroup$$module$build$src$core$events$utils(!0);this.topBlocks.length;)this.topBlocks[0].dispose(!1);for(;this.topComments.length;)this.topComments[this.topComments.length-1].dispose();Hr.setGroup$$module$build$src$core$events$utils(e),this.variableMap.clear(),this.potentialVariableMap&&this.potentialVariableMap.clear()}finally{this.isClearing=!1}}renameVariableById(e,t){this.variableMap.renameVariableById(e,t)}createVariable(e,t,i){return this.variableMap.createVariable(e,t,i)}getVariableUsesById(e){return this.variableMap.getVariableUsesById(e)}deleteVariableById(e){this.variableMap.deleteVariableById(e)}getVariable(e,t){return this.variableMap.getVariable(e,t)}getVariableById(e){return this.variableMap.getVariableById(e)}getVariablesOfType(e){return this.variableMap.getVariablesOfType(e)}getVariableTypes(){return this.variableMap.getVariableTypes(this)}getAllVariables(){return this.variableMap.getAllVariables()}getAllVariableNames(){return this.variableMap.getAllVariableNames()}getWidth(){return 0}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(e){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}remainingCapacity(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.getAllBlocks(!1).length}remainingCapacityOfType(e){return this.options.maxInstances?(void 0!==this.options.maxInstances[e]?this.options.maxInstances[e]:1/0)-this.getBlocksByType(e,!1).length:1/0}isCapacityAvailable(e){if(!this.hasBlockLimits())return!0;let t=0;for(const i in e){if(e[i]>this.remainingCapacityOfType(i))return!1;t+=e[i]}return!(t>this.remainingCapacity())}hasBlockLimits(){return 1/0!==this.options.maxBlocks||!!this.options.maxInstances}getUndoStack(){return this.undoStack_}getRedoStack(){return this.redoStack_}undo(e){var t=e?this.redoStack_:this.undoStack_,i=e?this.undoStack_:this.redoStack_;const n=t.pop();if(n){for(var s=[n];t.length&&n.group&&n.group===t[t.length-1].group;){const e=t.pop();e&&s.push(e)}for(t=0;t<s.length;t++)i.push(s[t]);s=f(s,e),Hr.setRecordUndo$$module$build$src$core$events$utils(!1);try{for(i=0;i<s.length;i++)s[i].run(e)}finally{Hr.setRecordUndo$$module$build$src$core$events$utils(!0)}}}clearUndo(){this.undoStack_.length=0,this.redoStack_.length=0,_()}addChangeListener(e){return this.listeners.push(e),e}removeChangeListener(e){J(this.listeners,e)}fireChangeListener(e){if(e.recordUndo)for(this.undoStack_.push(e),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;)this.undoStack_.shift();for(let t=0;t<this.listeners.length;t++)(0,this.listeners[t])(e)}getBlockById(e){return this.blockDB.get(e)||null}setBlockById(e,t){this.blockDB.set(e,t)}removeBlockById(e){this.blockDB.delete(e)}getCommentById(e){let t;return null!=(t=this.commentDB.get(e))?t:null}allInputsFilled(e){const t=this.getTopBlocks(!1);for(let i=0;i<t.length;i++)if(!t[i].allInputsFilled(e))return!1;return!0}getPotentialVariableMap(){return this.potentialVariableMap}createPotentialVariableMap(){this.potentialVariableMap=new Md(this)}getVariableMap(){return this.variableMap}setVariableMap(e){this.variableMap=e}getProcedureMap(){return this.procedureMap}getRootWorkspace(){let e=null;const t=this.options.parentWorkspace;return this.isFlyout?t&&t.options&&(e=t.options.parentWorkspace):t&&(e=t),e}static getById(e){return C(e)}static getAll(){return k()}};Pd.SCAN_ANGLE=3;var Bd=class{constructor(e){this.parentWorkspace=e,this.sounds=new Map,this.lastSound_=null,this.muted=!1}dispose(){this.sounds.clear()}load(e,t){if(e.length){try{var i=new globalThis.Audio}catch(e){return}for(let t=0;t<e.length;t++){const s=e[t],o=s.match(/\.(\w+)$/);if(o&&i.canPlayType("audio/"+o[1])){var n=new globalThis.Audio(s);break}}n&&this.sounds.set(t,n)}}preload(){for(const e of this.sounds.values()){e.volume=.01;const t=e.play();if(void 0!==t?t.then(e.pause).catch((function(){})):e.pause(),za||Ka)break}}play(e,t){if(!this.muted){var i=this.sounds.get(e);i?(e=new Date,null!==this.lastSound_&&e.getTime()-this.lastSound_.getTime()<100||(this.lastSound_=e,(i=za||Ya?i:i.cloneNode()).volume=void 0===t?1:t,i.play())):this.parentWorkspace&&this.parentWorkspace.getAudioManager().play(e,t)}}setMuted(e){this.muted=e}getMuted(){return this.muted}},Fd=class extends Pd{constructor(e){let t;super(e),this.resizeHandlerWrapper=null,this.resizesEnabled=this.isVisible_=this.rendered=!0,this.startScrollY=this.startScrollX=this.scrollY=this.scrollX=0,this.dragDeltaXY=null,this.oldScale=this.scale=1,this.oldLeft=this.oldTop=0,this.inverseScreenCTM=this.targetWorkspace=this.dummyWheelListener=this.configureContextMenu=this.lastRecordedPageScroll=this.injectionDiv=this.currentGesture_=this.toolbox_=this.flyout=this.scrollbar=this.trashcan=null,this.inverseScreenCTMDirty=!0,this.highlightedBlocks=[],this.toolboxCategoryCallbacks=new Map,this.flyoutButtonCallbacks=new Map,this.cachedParentSvg=null,this.keyboardAccessibilityMode=!1,this.topBoundedElements=[],this.dragTargetAreas=[],this.zoomControls_=this.layerManager=null,this.metricsManager=new(c(Xr.METRICS_MANAGER,e,!0))(this),this.getMetrics=e.getMetrics||this.metricsManager.getMetrics.bind(this.metricsManager),this.setMetrics=e.setMetrics||Fd.setTopLevelWorkspaceMetrics_,this.componentManager=new sl,this.connectionDBList=ih.init(this.connectionChecker),this.audioManager=new Bd(e.parentWorkspace),this.grid=this.options.gridPattern?new lh(this.options.gridPattern,e.gridOptions):null,this.markerManager=new au(this),cc&&tt&&this.registerToolboxCategoryCallback("VARIABLE",tt),wd&&So&&this.registerToolboxCategoryCallback("VARIABLE_DYNAMIC",So),Bh&&ao&&(this.registerToolboxCategoryCallback("PROCEDURE",ao),this.addChangeListener(co)),this.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new Rd(this,this.options.theme||hh),this.themeManager_.subscribeWorkspace(this),this.renderer=ko(this.options.renderer||"geras",this.getTheme(),null!=(t=this.options.rendererOverrides)?t:void 0),this.cachedParentSvgSize=new El(0,0)}getMarkerManager(){return this.markerManager}getMetricsManager(){return this.metricsManager}setMetricsManager(e){this.metricsManager=e,this.getMetrics=this.metricsManager.getMetrics.bind(this.metricsManager)}getComponentManager(){return this.componentManager}setCursorSvg(e){this.markerManager.setCursorSvg(e)}setMarkerSvg(e){this.markerManager.setMarkerSvg(e)}getMarker(e){return this.markerManager?this.markerManager.getMarker(e):null}getCursor(){return this.markerManager?this.markerManager.getCursor():null}getRenderer(){return this.renderer}getThemeManager(){return this.themeManager_}getTheme(){return this.themeManager_.getTheme()}setTheme(e){e||(e=hh),this.themeManager_.setTheme(e)}refreshTheme(){this.svgGroup_&&this.renderer.refreshDom(this.svgGroup_,this.getTheme()),this.updateBlockStyles_(this.getAllBlocks(!1).filter((function(e){return!!e.getStyleName()}))),this.refreshToolboxSelection(),this.toolbox_&&this.toolbox_.refreshTheme(),this.isVisible()&&this.setVisible(!0);const e=new(y("theme_change"))(this.getTheme().name,this.id);p(e)}updateBlockStyles_(e){for(let t,i=0;t=e[i];i++){const e=t.getStyleName();e&&t.setStyle(e)}}getInverseScreenCTM(){if(this.inverseScreenCTMDirty){const e=this.getParentSvg().getScreenCTM();e&&(this.inverseScreenCTM=e.inverse(),this.inverseScreenCTMDirty=!1)}return this.inverseScreenCTM}updateInverseScreenCTM(){this.inverseScreenCTMDirty=!0}isVisible(){return this.isVisible_}getSvgXY(e){let t=0,i=0,n=1;(this.getCanvas().contains(e)||this.getBubbleCanvas().contains(e))&&(n=this.scale);do{const s=ve(e);e!==this.getCanvas()&&e!==this.getBubbleCanvas()||(n=1),t+=s.x*n,i+=s.y*n,e=e.parentNode}while(e&&e!==this.getParentSvg()&&e!==this.getInjectionDiv());return new cl(t,i)}getCachedParentSvgSize(){const e=this.cachedParentSvgSize;return new El(e.width,e.height)}getOriginOffsetInPixels(){return Ce(this.getCanvas())}getInjectionDiv(){if(!this.injectionDiv){let e=this.svgGroup_;for(;e;){if((" "+(e.getAttribute("class")||"")+" ").includes(" injectionDiv ")){this.injectionDiv=e;break}e=e.parentNode}}return this.injectionDiv}getSvgGroup(){return this.svgGroup_}getBlockCanvas(){return this.getCanvas()}setResizeHandlerWrapper(e){this.resizeHandlerWrapper=e}createDom(e,t){return this.injectionDiv||(this.injectionDiv=null!=t?t:null),this.svgGroup_=ee(_l.G,{class:"blocklyWorkspace"}),e&&(this.svgBackground_=ee(_l.RECT,{height:"100%",width:"100%",class:e},this.svgGroup_),"blocklyMainBackground"===e&&this.grid?this.svgBackground_.style.fill="url(#"+this.grid.getPatternId()+")":this.themeManager_.subscribe(this.svgBackground_,"workspaceBackgroundColour","fill")),this.layerManager=new class{constructor(e){this.workspace=e,this.layers=new Map,(e=e.getInjectionDiv())&&(this.dragLayer=this.createDragLayer(e),this.animationLayer=this.createAnimationLayer(e)),e=this.createLayer(50),te(e,"blocklyBlockCanvas"),e=this.createLayer(100),te(e,"blocklyBubbleCanvas")}createDragLayer(e){const t=ee(_l.SVG,{class:"blocklyBlockDragSurface",xmlns:ul,"xmlns:html":hl,"xmlns:xlink":dl,version:"1.1"});return e.append(t),ee(_l.G,{},t)}createAnimationLayer(e){const t=ee(_l.SVG,{class:"blocklyAnimationLayer",xmlns:ul,"xmlns:html":hl,"xmlns:xlink":dl,version:"1.1"});return e.append(t),ee(_l.G,{},t)}appendToAnimationLayer(e){let t;const i=null==(t=this.dragLayer)?void 0:t.getAttribute("transform");if(i){let e;null==(e=this.animationLayer)||e.setAttribute("transform",i)}let n;null==(n=this.animationLayer)||n.appendChild(e.getSvgRoot())}translateLayers(e,t){let i;e=`translate(${e.x}, ${e.y}) scale(${t})`,null==(i=this.dragLayer)||i.setAttribute("transform",e);for(const[,t]of this.layers)t.setAttribute("transform",e)}moveToDragLayer(e){let t;null==(t=this.dragLayer)||t.appendChild(e.getSvgRoot())}moveOffDragLayer(e,t){this.append(e,t)}append(e,t){let i;this.layers.has(t)||this.createLayer(t),null==(i=this.layers.get(t))||i.appendChild(e.getSvgRoot())}createLayer(e){const t=this.workspace.getSvgGroup(),i=ee(_l.G,{});let n=!1;const s=[...this.layers].sort(((e,t)=>e[0]-t[0]));for(const[o,r]of s)if(e<o){t.insertBefore(i,r),n=!0;break}return n||t.appendChild(i),this.layers.set(e,i),i}hasLayer(e){return e===this.dragLayer||new Set(this.layers.values()).has(e)}getBlockLayer(){return this.layers.get(50)}getBubbleLayer(){return this.layers.get(100)}}(this),this.svgBlockCanvas_=this.layerManager.getBlockLayer(),this.svgBubbleCanvas_=this.layerManager.getBubbleLayer(),this.isFlyout||(j(this.svgGroup_,"pointerdown",this,this.onMouseDown_,!1),this.dummyWheelListener=()=>{},document.body.addEventListener("wheel",this.dummyWheelListener),j(this.svgGroup_,"wheel",this,this.onMouseWheel_)),this.options.hasCategories&&(this.toolbox_=new(c(Xr.TOOLBOX,this.options,!0))(this)),this.grid&&this.grid.update(this.scale),this.recordDragTargets(),(e=c(Xr.CURSOR,this.options))&&this.markerManager.setCursor(new e),this.renderer.createDom(this.svgGroup_,this.getTheme()),this.svgGroup_}dispose(){if(this.rendered=!1,this.currentGesture_&&this.currentGesture_.cancel(),this.svgGroup_&&oe(this.svgGroup_),this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=null),this.flyout&&(this.flyout.dispose(),this.flyout=null),this.trashcan&&(this.trashcan.dispose(),this.trashcan=null),this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null),this.zoomControls_&&this.zoomControls_.dispose(),this.audioManager&&this.audioManager.dispose(),this.grid&&(this.grid=null),this.renderer.dispose(),this.markerManager&&this.markerManager.dispose(),super.dispose(),this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||this.themeManager_.dispose()),this.connectionDBList.length=0,this.toolboxCategoryCallbacks.clear(),this.flyoutButtonCallbacks.clear(),!this.options.parentWorkspace){const e=this.getParentSvg();e&&e.parentNode&&oe(e.parentNode)}this.resizeHandlerWrapper&&(X(this.resizeHandlerWrapper),this.resizeHandlerWrapper=null),this.dummyWheelListener&&(document.body.removeEventListener("wheel",this.dummyWheelListener),this.dummyWheelListener=null)}addTrashcan(){this.trashcan=Fd.newTrashcan(this);const e=this.trashcan.createDom();this.svgGroup_.insertBefore(e,this.getCanvas())}static newTrashcan(e){throw Error("The implementation of newTrashcan should be monkey-patched in by blockly.ts")}addZoomControls(){this.zoomControls_=new Xl(this);const e=this.zoomControls_.createDom();this.svgGroup_.appendChild(e)}addFlyout(e){const t=new dh({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer,rendererOverrides:this.options.rendererOverrides,move:{scrollbars:!0}});return t.toolboxPosition=this.options.toolboxPosition,this.flyout=this.horizontalLayout?new(c(Xr.FLYOUTS_HORIZONTAL_TOOLBOX,this.options,!0))(t):new(c(Xr.FLYOUTS_VERTICAL_TOOLBOX,this.options,!0))(t),this.flyout.autoClose=!1,this.flyout.getWorkspace().setVisible(!0),this.flyout.createDom(e)}getFlyout(e){return this.flyout||e?this.flyout:this.toolbox_?this.toolbox_.getFlyout():null}getToolbox(){return this.toolbox_}updateScreenCalculations_(){this.updateInverseScreenCTM(),this.recordDragTargets()}resizeContents(){this.resizesEnabled&&this.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())}resize(){this.toolbox_&&this.toolbox_.position(),this.flyout&&this.flyout.position();const e=this.componentManager.getComponents(sl.Capability.POSITIONABLE,!0),t=this.getMetricsManager().getUiMetrics(),i=[];for(let n,s=0;n=e[s];s++){n.position(t,i);const e=n.getBoundingRectangle();e&&i.push(e)}this.scrollbar&&this.scrollbar.resize(),this.updateScreenCalculations_()}updateScreenCalculationsIfScrolled(){const e=Oe();cl.equals(this.lastRecordedPageScroll,e)||(this.lastRecordedPageScroll=e,this.updateScreenCalculations_())}getLayerManager(){return this.layerManager}getCanvas(){return this.layerManager.getBlockLayer()}setCachedParentSvgSize(e,t){const i=this.getParentSvg();null!=e&&(this.cachedParentSvgSize.width=e,i.setAttribute("data-cached-width",`${e}`)),null!=t&&(this.cachedParentSvgSize.height=t,i.setAttribute("data-cached-height",`${t}`))}getBubbleCanvas(){return this.layerManager.getBubbleLayer()}getParentSvg(){if(!this.cachedParentSvg){let e=this.svgGroup_;for(;e;){if("svg"===e.tagName){this.cachedParentSvg=e;break}e=e.parentNode}}return this.cachedParentSvg}maybeFireViewportChangeEvent(){if(T()){var e=this.scale,t=-this.scrollY,i=-this.scrollX;if(!(e===this.oldScale&&1>Math.abs(t-this.oldTop)&&1>Math.abs(i-this.oldLeft))){var n=new(y(na))(t,i,e,this.id,this.oldScale);this.oldScale=e,this.oldTop=t,this.oldLeft=i,p(n)}}}translate(e,t){let i,n;null==(i=this.layerManager)||i.translateLayers(new cl(e,t),this.scale),null==(n=this.grid)||n.moveTo(e,t),this.maybeFireViewportChangeEvent()}getWidth(){const e=this.getMetrics();return e?e.viewWidth/this.scale:0}setVisible(e){this.isVisible_=e,this.svgGroup_&&(this.scrollbar&&this.scrollbar.setContainerVisible(e),this.getFlyout()&&this.getFlyout().setContainerVisible(e),this.getParentSvg().style.display=e?"block":"none",this.toolbox_&&this.toolbox_.setVisible(e),e||this.hideChaff(!0))}render(){const e=this.getAllBlocks(!1);for(let t=e.length-1;0<=t;t--)e[t].queueRender();this.getTopBlocks().flatMap((e=>e.getDescendants(!1))).filter((e=>e.isInsertionMarker())).forEach((e=>e.queueRender())),_t().then((()=>{this.markerManager.updateMarkers()}))}highlightBlock(e,t){if(void 0===t){for(let e,t=0;e=this.highlightedBlocks[t];t++)e.setHighlighted(!1);this.highlightedBlocks.length=0}(e=e?this.getBlockById(e):null)&&((t=void 0===t||t)?this.highlightedBlocks.includes(e)||this.highlightedBlocks.push(e):J(this.highlightedBlocks,e),e.setHighlighted(t))}refreshToolboxSelection(){const e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox_&&e.toolbox_.getFlyout()&&e.toolbox_.refreshSelection()}renameVariableById(e,t){super.renameVariableById(e,t),this.refreshToolboxSelection()}deleteVariableById(e){super.deleteVariableById(e),this.refreshToolboxSelection()}createVariable(e,t,i){return e=super.createVariable(e,t,i),this.refreshToolboxSelection(),e}recordDragTargets(){const e=this.componentManager.getComponents(sl.Capability.DRAG_TARGET,!0);this.dragTargetAreas=[];for(let t,i=0;t=e[i];i++){const e=t.getClientRect();e&&this.dragTargetAreas.push({component:t,clientRect:e})}}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(e){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}getDragTarget(e){for(let t,i=0;t=this.dragTargetAreas[i];i++)if(t.clientRect.contains(e.clientX,e.clientY))return t.component;return null}onMouseDown_(e){const t=this.getGesture(e);t&&t.handleWsStart(e,this)}startDrag(e,t){(e=K(e,this.getParentSvg(),this.getInverseScreenCTM())).x/=this.scale,e.y/=this.scale,this.dragDeltaXY=cl.difference(t,e)}moveDrag(e){return(e=K(e,this.getParentSvg(),this.getInverseScreenCTM())).x/=this.scale,e.y/=this.scale,cl.sum(this.dragDeltaXY,e)}isDragging(){return null!==this.currentGesture_&&this.currentGesture_.isDragging()}isDraggable(){return this.options.moveOptions&&this.options.moveOptions.drag}isMovable(){return this.options.moveOptions&&!!this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch}isMovableHorizontally(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollHorizontally())}isMovableVertically(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollVertically())}onMouseWheel_(e){if(ah.inProgress())e.preventDefault(),e.stopPropagation();else{var t=this.options.zoomOptions&&this.options.zoomOptions.wheel,i=this.options.moveOptions&&this.options.moveOptions.wheel;if(t||i){var n=q(e);if(qa)var s=e.metaKey;t&&(e.ctrlKey||s||!i)?(n=-n.y/50,t=K(e,this.getParentSvg(),this.getInverseScreenCTM()),this.zoom(t.x,t.y,n)):(t=this.scrollX-n.x,i=this.scrollY-n.y,e.shiftKey&&!n.x&&(t=this.scrollX-n.y,i=this.scrollY),this.scroll(t,i)),e.preventDefault()}}}getBlocksBoundingBox(){const e=this.getTopBoundedElements();if(!e.length)return new Tl(0,0,0,0);const t=e[0].getBoundingRectangle();for(let n=1;n<e.length;n++){var i=e[n];i.isInsertionMarker&&i.isInsertionMarker()||((i=i.getBoundingRectangle()).top<t.top&&(t.top=i.top),i.bottom>t.bottom&&(t.bottom=i.bottom),i.left<t.left&&(t.left=i.left),i.right>t.right&&(t.right=i.right))}return t}cleanUp(){this.setResizesEnabled(!1),Hr.setGroup$$module$build$src$core$events$utils(!0);const e=this.getTopBlocks(!0);let t=0;for(let i,n=0;i=e[n];n++){if(!i.isMovable())continue;const e=i.getRelativeToSurfaceXY();i.moveBy(-e.x,t-e.y,["cleanup"]),i.snapToGrid(),t=i.getRelativeToSurfaceXY().y+i.getHeightWidth().height+this.renderer.getConstants().MIN_BLOCK_HEIGHT}Hr.setGroup$$module$build$src$core$events$utils(!1),this.setResizesEnabled(!0)}showContextMenu(e){if(!this.options.readOnly&&!this.isFlyout){var t=Xu.registry.getContextMenuOptions(Xu.ScopeType.WORKSPACE,{workspace:this});this.configureContextMenu&&this.configureContextMenu(t,e),Mn(e,t,this.RTL,this)}}updateToolbox(e){if(e=Le(e)){if(!this.options.languageTree)throw Error("Existing toolbox is null.  Can't create new toolbox.");if(De(e)){if(!this.toolbox_)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.languageTree=e,this.toolbox_.render(e)}else{if(!this.flyout)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.languageTree=e,this.flyout.show(e)}}else if(this.options.languageTree)throw Error("Can't nullify an existing toolbox.")}markFocused(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():(S(this),this.getParentSvg().focus({preventScroll:!0}))}zoom(e,t,i){i=Math.pow(this.options.zoomOptions.scaleSpeed,i);const n=this.scale*i;if(this.scale!==n){n>this.options.zoomOptions.maxScale?i=this.options.zoomOptions.maxScale/this.scale:n<this.options.zoomOptions.minScale&&(i=this.options.zoomOptions.minScale/this.scale);var s=this.getCanvas().getCTM(),o=this.getParentSvg().createSVGPoint();o.x=e,o.y=t,e=(o=o.matrixTransform(s.inverse())).x,t=o.y,s=s.translate(e*(1-i),t*(1-i)).scale(i),this.scrollX=s.e,this.scrollY=s.f,this.setScale(n)}}zoomCenter(e){var t=this.getMetrics();let i;this.flyout?(i=t.svgWidth?t.svgWidth/2:0,t=t.svgHeight?t.svgHeight/2:0):(i=t.viewWidth/2+t.absoluteLeft,t=t.viewHeight/2+t.absoluteTop),this.zoom(i,t,e)}zoomToFit(){if(this.isMovable()){var e=this.getMetrics(),t=e.viewWidth;e=e.viewHeight;var i=this.getBlocksBoundingBox(),n=i.right-i.left+40;if(i=i.bottom-i.top+40,n){this.flyout&&(this.horizontalLayout?(e+=this.flyout.getHeight(),i+=this.flyout.getHeight()/this.scale):(t+=this.flyout.getWidth(),n+=this.flyout.getWidth()/this.scale)),t/=n,e/=i,Hr.disable$$module$build$src$core$events$utils();try{this.setScale(Math.min(t,e)),this.scrollCenter()}finally{Hr.enable$$module$build$src$core$events$utils()}this.maybeFireViewportChangeEvent()}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}beginCanvasTransition(){te(this.getCanvas(),"blocklyCanvasTransitioning"),te(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}endCanvasTransition(){ne(this.getCanvas(),"blocklyCanvasTransitioning"),ne(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}scrollCenter(){if(this.isMovable()){var e=this.getMetrics(),t=(e.scrollWidth-e.viewWidth)/2,i=(e.scrollHeight-e.viewHeight)/2;t=-t-e.scrollLeft,i=-i-e.scrollTop,this.scroll(t,i)}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}centerOnBlock(e,t){if(this.isMovable()){var i=e?this.getBlockById(e):null;if(i){e=i.getRelativeToSurfaceXY(),i=t?{height:i.height,width:i.width}:i.getHeightWidth();var n=this.scale;t=(e.x+(this.RTL?-1:1)*i.width/2)*n,e=(e.y+i.height/2)*n,i=this.getMetrics(),this.scroll(-(t-i.viewWidth/2),-(e-i.viewHeight/2))}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}setScale(e){this.options.zoomOptions.maxScale&&e>this.options.zoomOptions.maxScale?e=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&e<this.options.zoomOptions.minScale&&(e=this.options.zoomOptions.minScale),this.scale=e,this.hideChaff(!1),(e=this.getFlyout(!1))&&e.isVisible()&&(e.reflow(),this.recordDragTargets()),this.grid&&this.grid.update(this.scale),e=this.getMetrics(),this.scrollX-=e.absoluteLeft,this.scrollY-=e.absoluteTop,e.viewLeft+=e.absoluteLeft,e.viewTop+=e.absoluteTop,this.scroll(this.scrollX,this.scrollY),this.scrollbar&&(this.flyout?this.scrollbar.resizeView(e):this.scrollbar.resizeContent(e))}getScale(){return this.options.parentWorkspace?this.options.parentWorkspace.getScale():this.scale}scroll(e,t){this.hideChaff(!0);const i=this.getMetrics();e=Math.min(e,-i.scrollLeft),t=Math.min(t,-i.scrollTop);const n=i.scrollTop+Math.max(0,i.scrollHeight-i.viewHeight);e=Math.max(e,-(i.scrollLeft+Math.max(0,i.scrollWidth-i.viewWidth))),t=Math.max(t,-n),this.scrollX=e,this.scrollY=t,this.scrollbar&&this.scrollbar.set(-(e+i.scrollLeft),-(t+i.scrollTop),!1),e+=i.absoluteLeft,t+=i.absoluteTop,this.translate(e,t)}getBlockById(e){return super.getBlockById(e)}getAllBlocks(e=!1){return super.getAllBlocks(e)}getTopBlocks(e=!1){return super.getTopBlocks(e)}addTopBlock(e){this.addTopBoundedElement(e),super.addTopBlock(e)}removeTopBlock(e){this.removeTopBoundedElement(e),super.removeTopBlock(e)}addTopComment(e){this.addTopBoundedElement(e),super.addTopComment(e)}removeTopComment(e){this.removeTopBoundedElement(e),super.removeTopComment(e)}getRootWorkspace(){return super.getRootWorkspace()}addTopBoundedElement(e){this.topBoundedElements.push(e)}removeTopBoundedElement(e){J(this.topBoundedElements,e)}getTopBoundedElements(){return[].concat(this.topBoundedElements)}setResizesEnabled(e){const t=!this.resizesEnabled&&e;this.resizesEnabled=e,t&&this.resizeContents()}clear(){this.setResizesEnabled(!1),super.clear(),this.topBoundedElements=[],this.setResizesEnabled(!0)}registerButtonCallback(e,t){if("function"!=typeof t)throw TypeError("Button callbacks must be functions.");this.flyoutButtonCallbacks.set(e,t)}getButtonCallback(e){let t;return null!=(t=this.flyoutButtonCallbacks.get(e))?t:null}removeButtonCallback(e){this.flyoutButtonCallbacks.delete(e)}registerToolboxCategoryCallback(e,t){if("function"!=typeof t)throw TypeError("Toolbox category callbacks must be functions.");this.toolboxCategoryCallbacks.set(e,t)}getToolboxCategoryCallback(e){return this.toolboxCategoryCallbacks.get(e)||null}removeToolboxCategoryCallback(e){this.toolboxCategoryCallbacks.delete(e)}getGesture(e){const t="pointerdown"===e.type,i=this.currentGesture_;return i?t&&i.hasStarted()?(console.warn("Tried to start the same gesture twice."),i.cancel(),null):i:t?this.currentGesture_=new ah(e,this):null}clearGesture(){this.currentGesture_=null}cancelCurrentGesture(){this.currentGesture_&&this.currentGesture_.cancel()}getAudioManager(){return this.audioManager}getGrid(){return this.grid}hideChaff(e=!1){Ji(),Nn(this),Ai(),this.hideComponents(e)}hideComponents(e=!1){this.getComponentManager().getComponents(sl.Capability.AUTOHIDEABLE,!0).forEach((t=>t.autoHide(e)))}static setTopLevelWorkspaceMetrics_(e){const t=this.getMetrics();"number"==typeof e.x&&(this.scrollX=-(t.scrollLeft+(t.scrollWidth-t.viewWidth)*e.x)),"number"==typeof e.y&&(this.scrollY=-(t.scrollTop+(t.scrollHeight-t.viewHeight)*e.y)),this.translate(this.scrollX+t.absoluteLeft,this.scrollY+t.absoluteTop)}},Ud={};Ud.WorkspaceSvg=Fd,Ud.resizeSvgContents=wo;var Hd=class extends Oa{constructor(e,t){super(t),this.type="trashcan_open",this.isOpen=e}toJson(){const e=super.toJson();if(void 0===this.isOpen)throw Error("Whether this is already open or not is undefined. Either pass a value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Hd)).isOpen=e.isOpen,t}};t(Xr.EVENT,"trashcan_open",Hd);var Gd=class extends Oa{constructor(e,t,i){super(i),this.type=ea,this.oldElementId=null!=e?e:void 0,this.newElementId=null!=t?t:void 0}toJson(){const e=super.toJson();return e.oldElementId=this.oldElementId,e.newElementId=this.newElementId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Gd)).oldElementId=e.oldElementId,t.newElementId=e.newElementId,t}};t(Xr.EVENT,ea,Gd);var Vd=class{constructor(){this.drawer=this.curNode=this.colour=null,this.type="marker"}setDrawer(e){this.drawer=e}getDrawer(){return this.drawer}getCurNode(){return this.curNode}setCurNode(e){const t=this.curNode;this.curNode=e,this.drawer&&this.drawer.draw(t,this.curNode)}draw(){this.drawer&&this.drawer.draw(this.curNode,this.curNode)}hide(){this.drawer&&this.drawer.hide()}dispose(){this.getDrawer()&&this.getDrawer().dispose()}},jd=class extends Vd{constructor(){super(),this.type="cursor"}next(){var e=this.getCurNode();if(!e)return null;for(e=e.next();e&&e.next()&&(e.getType()===Id.types.NEXT||e.getType()===Id.types.BLOCK);)e=e.next();return e&&this.setCurNode(e),e}in(){var e=this.getCurNode();if(!e)return null;let t,i;return e.getType()!==Id.types.PREVIOUS&&e.getType()!==Id.types.OUTPUT||(e=e.next()),(e=null!=(i=null==(t=e)?void 0:t.in())?i:null)&&this.setCurNode(e),e}prev(){var e=this.getCurNode();if(!e)return null;for(e=e.prev();e&&e.prev()&&(e.getType()===Id.types.NEXT||e.getType()===Id.types.BLOCK);)e=e.prev();return e&&this.setCurNode(e),e}out(){var e=this.getCurNode();return e?((e=e.out())&&e.getType()===Id.types.BLOCK&&(e=e.prev()||e),e&&this.setCurNode(e),e):null}};t(Xr.CURSOR,Wr,jd);var Wd=class extends jd{constructor(){super()}next(){var e=this.getCurNode();return e?((e=this.getNextNode_(e,this.validNode_))&&this.setCurNode(e),e):null}in(){return this.next()}prev(){var e=this.getCurNode();return e?((e=this.getPreviousNode_(e,this.validNode_))&&this.setCurNode(e),e):null}out(){return this.prev()}getNextNode_(e,t){if(!e)return null;const i=e.in()||e.next();return t(i)?i:i?this.getNextNode_(i,t):t(e=this.findSiblingOrParent(e.out()))?e:e?this.getNextNode_(e,t):null}getPreviousNode_(e,t){if(!e)return null;let i=e.prev();return t(i=i?this.getRightMostChild(i):e.out())?i:i?this.getPreviousNode_(i,t):null}validNode_(e){let t=!1;return(e=e&&e.getType())!==Id.types.OUTPUT&&e!==Id.types.INPUT&&e!==Id.types.FIELD&&e!==Id.types.NEXT&&e!==Id.types.PREVIOUS&&e!==Id.types.WORKSPACE||(t=!0),t}findSiblingOrParent(e){return e?e.next()||this.findSiblingOrParent(e.out()):null}getRightMostChild(e){if(!e.in())return e;for(e=e.in();e&&e.next();)e=e.next();return this.getRightMostChild(e)}};Wd.registrationName="basicCursor",t(Xr.CURSOR,Wd.registrationName,Wd);var Xd=class extends Wd{validNode_(e){let t=!1;const i=e&&e.getType();return e&&(e=e.getLocation(),i===Id.types.FIELD&&e&&e.isTabNavigable()&&e.isClickable()&&(t=!0)),t}},Yd=class extends Td{constructor(e,t){super(e,t),this.highlighted=!1,this.targetConnection=null,this.db=e.workspace.connectionDBList[t],this.dbOpposite=e.workspace.connectionDBList[Ld[t]],this.offsetInBlock=new cl(0,0),this.trackedState=Yd.TrackedState.WILL_TRACK}dispose(){let e,t;super.dispose(),this.trackedState===Yd.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),null==(t=(e=this.sourceBlock_.pathObject).removeConnectionHighlight)||t.call(e,this)}getSourceBlock(){return super.getSourceBlock()}targetBlock(){return super.targetBlock()}distanceFrom(e){const t=this.x-e.x;return e=this.y-e.y,Math.sqrt(t*t+e*e)}bumpAwayFrom(e){if(!this.sourceBlock_.workspace.isDragging()){var t=this.sourceBlock_.getRootBlock();if(!t.isInFlyout){var i=!1;if(!t.isMovable()){if(!(t=e.getSourceBlock().getRootBlock()).isMovable())return;e=this,i=!0}var n=R()==t;n||t.addSelect();var s=e.x+Hr.config$$module$build$src$core$config.snapRadius+Math.floor(10*Math.random())-this.x,o=e.y+Hr.config$$module$build$src$core$config.snapRadius+Math.floor(10*Math.random())-this.y;i&&(o=-o),t.RTL&&(s=e.x-Hr.config$$module$build$src$core$config.snapRadius-Math.floor(10*Math.random())-this.x),t.moveBy(s,o,["bump"]),n||t.removeSelect()}}}moveTo(e,t){let i=!1;return this.trackedState===Yd.TrackedState.WILL_TRACK?(this.db.addConnection(this,t),this.trackedState=Yd.TrackedState.TRACKED,i=!0):this.trackedState===Yd.TrackedState.TRACKED&&(this.db.removeConnection(this,this.y),this.db.addConnection(this,t),i=!0),this.x=e,this.y=t,i}moveBy(e,t){return this.moveTo(this.x+e,this.y+t)}moveToOffset(e){return this.moveTo(e.x+this.offsetInBlock.x,e.y+this.offsetInBlock.y)}setOffsetInBlock(e,t){this.offsetInBlock.x=e,this.offsetInBlock.y=t}getOffsetInBlock(){return this.offsetInBlock}tightenEfficiently(){var e=this.targetConnection;const t=this.targetBlock();e&&t&&(e=cl.difference(this.offsetInBlock,e.offsetInBlock),t.translate(e.x,e.y))}closest(e,t){return this.dbOpposite.searchForClosest(this,e,t)}highlight(){this.highlighted=!0,this.getSourceBlock().queueRender()}unhighlight(){this.highlighted=!1,this.getSourceBlock().queueRender()}isHighlighted(){return this.highlighted}setTracking(e){e&&this.trackedState===Yd.TrackedState.TRACKED||!e&&this.trackedState===Yd.TrackedState.UNTRACKED||this.sourceBlock_.isInFlyout||(e?(this.db.addConnection(this,this.y),this.trackedState=Yd.TrackedState.TRACKED):(this.trackedState===Yd.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),this.trackedState=Yd.TrackedState.UNTRACKED))}stopTrackingAll(){if(this.setTracking(!1),this.targetConnection){const e=this.targetBlock().getDescendants(!1);for(let t=0;t<e.length;t++){const i=e[t],n=i.getConnections_(!0);for(let e=0;e<n.length;e++)n[e].setTracking(!1);for(const e of i.getIcons())oi(e)&&e.setBubbleVisible(!1)}}}startTrackingAll(){this.setTracking(!0);let e=[];if(this.type!==eh.INPUT_VALUE&&this.type!==eh.NEXT_STATEMENT)return e;const t=this.targetBlock();if(t){let i;t.isCollapsed()?(i=[],t.outputConnection&&i.push(t.outputConnection),t.nextConnection&&i.push(t.nextConnection),t.previousConnection&&i.push(t.previousConnection)):i=t.getConnections_(!0);for(let t=0;t<i.length;t++)e.push(...i[t].startTrackingAll());e.length||(e=[t])}return e}onFailedConnect(e){const t=this.getSourceBlock();if(d()){const i=Hr.getGroup$$module$build$src$core$events$utils();setTimeout(function(){t.isDisposed()||t.getParent()||(Hr.setGroup$$module$build$src$core$events$utils(i),this.bumpAwayFrom(e),Hr.setGroup$$module$build$src$core$events$utils(!1))}.bind(this),Hr.config$$module$build$src$core$config.bumpDelay)}}disconnectInternal(e=!0){const{parentConnection:t,childConnection:i}=this.getParentAndChildConnections();if(t&&i){var n=Hr.getGroup$$module$build$src$core$events$utils();n||Hr.setGroup$$module$build$src$core$events$utils(!0);var s=t.getSourceBlock(),o=i.getSourceBlock();super.disconnectInternal(e),s.queueRender(),o.updateDisabled(),o.queueRender(),o.getSvgRoot().style.display="block",Hr.setGroup$$module$build$src$core$events$utils(n)}}respawnShadow_(){super.respawnShadow_();const e=this.targetBlock();e&&(e.initSvg(),e.queueRender())}neighbours(e){return this.dbOpposite.getNeighbours(this,e)}connect_(e){super.connect_(e);var t=this.getSourceBlock();e=e.getSourceBlock(),t.updateDisabled(),e.updateDisabled(),e.queueRender(),(t=t.getInputWithBlock(e))&&(t=t.isVisible(),e.getSvgRoot().style.display=t?"block":"none")}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return super.setCheck(e),this.sourceBlock_.queueRender(),this}};!function(e){(e=e.TrackedState||(e.TrackedState={}))[e.WILL_TRACK=-1]="WILL_TRACK",e[e.UNTRACKED=0]="UNTRACKED",e[e.TRACKED=1]="TRACKED"}(Yd||(Yd={}));var zd=Yd.TrackedState,Kd={};Kd.RenderedConnection=Yd,Kd.TrackedState=zd;var qd=class{paste(e,t,i){if(!t.isCapacityAvailable(e.typeCounts))return null;let n;i&&(e.blockState.x=i.x,e.blockState.y=i.y),i=i||new cl(e.blockState.x||0,e.blockState.y||0),Hr.disable$$module$build$src$core$events$utils();try{n=Wt(e.blockState,t),Lo(n,i)}finally{Hr.enable$$module$build$src$core$events$utils()}return n?(T()&&!n.isShadow()&&p(new(y(Hr.CREATE$$module$build$src$core$events$utils))(n)),Hr.setSelected$$module$build$src$core$common(n),n):n}};qd.TYPE="block",St(qd.TYPE,new qd);var Jd={};Jd.BlockPaster=qd,Jd.moveBlockToNotConflict=Lo;var Zd={};Zd.bumpIntoBounds=Do,Zd.bumpIntoBoundsHandler=Mo,Zd.bumpTopObjectsIntoBounds=Bo;var Qd=class{constructor(e){this.block=e,this.connectionPreviewer=this.connectionCandidate=this.startLoc=this.startChildConn=this.startParentConn=null,this.dragging=!1,this.dragOffset=new cl(0,0),this.workspace=e.workspace}isMovable(){if(this.block.isShadow()){let e,t;return null!=(t=null==(e=this.block.getParent())?void 0:e.isMovable())&&t}return this.block.isOwnMovable()&&!this.block.isDeadOrDying()&&!this.workspace.options.readOnly&&!this.block.isInFlyout}startDrag(e){var t;this.block.isShadow()?this.startDraggingShadow(e):(this.dragging=!0,Hr.getGroup$$module$build$src$core$events$utils()||Hr.setGroup$$module$build$src$core$events$utils(!0),this.fireDragStartEvent(),this.startLoc=this.block.getRelativeToSurfaceXY(),this.connectionCandidate=null,this.connectionPreviewer=new(c(Xr.CONNECTION_PREVIEWER,this.workspace.options))(this.block),le(),this.workspace.setResizesEnabled(!1),Is(),e=!!e&&(e.altKey||e.ctrlKey||e.metaKey),this.shouldDisconnect(e)&&this.disconnectBlock(e),this.block.setDragging(!0),null==(t=this.workspace.getLayerManager())||t.moveToDragLayer(this.block))}startDraggingShadow(e){const t=this.block.getParent();if(!t)throw Error("Tried to drag a shadow block with no parent. Shadow blocks should always have parents.");this.dragOffset=cl.difference(t.getRelativeToSurfaceXY(),this.block.getRelativeToSurfaceXY()),t.startDrag(e)}shouldDisconnect(e){return!!(this.block.getParent()||e&&this.block.nextConnection&&this.block.nextConnection.targetBlock())}disconnectBlock(e){let t,i,n;if(this.startParentConn=null!=(n=null==(t=this.block.outputConnection)?void 0:t.targetConnection)?n:null==(i=this.block.previousConnection)?void 0:i.targetConnection,e){let e;this.startChildConn=null==(e=this.block.nextConnection)?void 0:e.targetConnection}this.block.unplug(e),Es(this.block)}fireDragStartEvent(){const e=new(y("drag"))(this.block,!0,this.block.getDescendants(!1));p(e)}fireDragEndEvent(){const e=new(y("drag"))(this.block,!1,this.block.getDescendants(!1));p(e)}fireMoveEvent(){if(!this.block.isDeadOrDying()){var e=new(y(Hr.MOVE$$module$build$src$core$events$utils))(this.block);e.setReason(["drag"]),e.oldCoordinate=this.startLoc,e.recordNew(),p(e)}}drag(e){if(this.block.isShadow()){let t;null==(t=this.block.getParent())||t.drag(cl.sum(e,this.dragOffset))}else this.block.moveDuringDrag(e),this.updateConnectionPreview(this.block,cl.difference(e,this.startLoc))}updateConnectionPreview(e,t){var i=this.connectionCandidate;const n=this.getConnectionCandidate(e,t);if(n){this.connectionCandidate=t=i&&this.currCandidateIsBetter(i,t,n)?i:n;var{local:s,neighbour:o}=t;t=s.type===eh.OUTPUT_VALUE||s.type===eh.PREVIOUS_STATEMENT,i=o.isConnected()&&!o.targetBlock().isInsertionMarker(),t&&i&&!this.orphanCanConnectAtEnd(e,o.targetBlock(),s.type)?this.connectionPreviewer.previewReplacement(s,o,o.targetBlock()):this.connectionPreviewer.previewConnection(s,o)}else this.connectionPreviewer.hidePreview(),this.connectionCandidate=null}orphanCanConnectAtEnd(e,t,i){return!!Td.getConnectionForOrphanedConnection(e,i===eh.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}currCandidateIsBetter(e,t,i){const{local:n,neighbour:s}=e;e=new cl(n.x,n.y);const o=new cl(s.x,s.y);return t=cl.distance(cl.sum(e,t),o),i.distance>t-Hr.config$$module$build$src$core$config.currentConnectionPreference}getConnectionCandidate(e,t){e=this.getLocalConnections(e);let i=this.connectionCandidate?Hr.config$$module$build$src$core$config.connectingSnapRadius:Hr.config$$module$build$src$core$config.snapRadius,n=null;for(const s of e){const{connection:e,radius:o}=s.closest(i,t);e&&(n={local:s,neighbour:e,distance:o},i=o)}return n}getLocalConnections(e){const t=e.getConnections_(!1),i=e.lastConnectionInStack(!0);return i&&i!==e.nextConnection&&t.push(i),t}endDrag(e){if(this.block.isShadow()){let t;null==(t=this.block.getParent())||t.endDrag(e)}else{if(this.fireDragEndEvent(),this.fireMoveEvent(),ce(),Is(),this.connectionPreviewer.hidePreview(),!this.block.isDeadOrDying()&&this.dragging){let e;null==(e=this.workspace.getLayerManager())||e.moveOffDragLayer(this.block,50),this.block.setDragging(!1)}this.connectionCandidate?this.applyConnections(this.connectionCandidate):this.block.queueRender(),this.block.snapToGrid(),this.connectionPreviewer.dispose(),this.workspace.setResizesEnabled(!0),Hr.setGroup$$module$build$src$core$events$utils(!1)}}applyConnections(e){const{local:t,neighbour:i}=e;t.connect(i);const n=t.isSuperior()?i:t,s=this.block.getRootBlock();_t().then((()=>{Ts(n.getSourceBlock()),setTimeout((()=>{s.bringToFront()}),0)}))}revertDrag(){if(this.block.isShadow()){let e;null==(e=this.block.getParent())||e.revertDrag()}else{var e;if(null==(e=this.startChildConn)||e.connect(this.block.nextConnection),this.startParentConn)switch(this.startParentConn.type){case eh.INPUT_VALUE:this.startParentConn.connect(this.block.outputConnection);break;case eh.NEXT_STATEMENT:this.startParentConn.connect(this.block.previousConnection)}else{let e;this.block.moveTo(this.startLoc,["drag"]),null==(e=this.workspace.getLayerManager())||e.moveOffDragLayer(this.block,50),Do(this.workspace,this.workspace.getMetricsManager().getScrollMetrics(!0),this.block)}this.startParentConn=this.startChildConn=null,this.connectionPreviewer.hidePreview(),this.connectionCandidate=null,this.block.setDragging(!1),this.dragging=!1}}},ep=class extends Ed{constructor(e,t,i){if(super(e,t,i),this.width=this.height=0,this.warningTextDb=new Map,this.mutator=null,this.rendered=!0,this.eventsInit_=this.renderIsInProgress_=this.visuallyDisabled=!1,this.translation="",this.dragging=!1,this.relativeCoords=new cl(0,0),this.dragStrategy=new Qd(this),!e.rendered)throw TypeError("Cannot create a rendered block in a headless workspace");this.workspace=e,this.svgGroup_=ee(_l.G,{}),this.style=e.getRenderer().getConstants().getBlockStyle(null),this.pathObject=e.getRenderer().makePathObject(this.svgGroup_,this.style),(e=this.pathObject.svgPath).tooltip=this,Wi(e),this.svgGroup_.setAttribute("data-id",this.id),this.doInit_()}initSvg(){if(!this.initialized){for(var e of this.inputList)e.init();for(const e of this.getIcons())e.initView(this.createIconPointerDownListener(e)),e.updateEditable();this.applyColour(),this.pathObject.updateMovable(this.isMovable()||this.isInFlyout),e=this.getSvgRoot(),!this.workspace.options.readOnly&&e&&j(e,"pointerdown",this,this.onMouseDown_),e.parentNode||this.workspace.getCanvas().appendChild(e),this.initialized=!0}}getColourSecondary(){return this.style.colourSecondary}getColourTertiary(){return this.style.colourTertiary}select(){if(this.isShadow()){let e;null==(e=this.getParent())||e.select()}else this.addSelect()}unselect(){if(this.isShadow()){let e;null==(e=this.getParent())||e.unselect()}else this.removeSelect()}setParent(e){const t=this.parentBlock_;if(e!==t){le(),super.setParent(e),ce();var i=this.getSvgRoot();if(!this.workspace.isClearing&&i){var n=this.getRelativeToSurfaceXY();e?e.getSvgRoot().appendChild(i):t&&((e=this.workspace.getCanvas().querySelector(".blocklyDragging"))?this.workspace.getCanvas().insertBefore(i,e):this.workspace.getCanvas().appendChild(i),this.translate(n.x,n.y)),this.applyColour()}}}getRelativeToSurfaceXY(){const e=this.workspace.getLayerManager();if(!e)throw Error("Cannot calculate position because the workspace has not been appended");let t=0,i=0,n=this.getSvgRoot();if(n)do{const e=ve(n);t+=e.x,i+=e.y,n=n.parentNode}while(n&&!e.hasLayer(n));return new cl(t,i)}moveBy(e,t,i){if(this.parentBlock_)throw Error("Block has parent");const n=T();let s=null;n&&(s=new(y(Hr.MOVE$$module$build$src$core$events$utils))(this),i&&s.setReason(i)),e=new cl(e,t),t=this.getRelativeToSurfaceXY(),e=cl.sum(t,e),this.translate(e.x,e.y),this.updateComponentLocations(e),n&&s&&(s.recordNew(),p(s)),this.workspace.resizeContents()}translate(e,t){this.translation=`translate(${e}, ${t})`,this.relativeCoords=new cl(e,t),this.getSvgRoot().setAttribute("transform",this.getTranslation())}getTranslation(){return this.translation}moveTo(e,t){const i=this.getRelativeToSurfaceXY();this.moveBy(e.x-i.x,e.y-i.y,t)}moveDuringDrag(e){this.translate(e.x,e.y),this.getSvgRoot().setAttribute("transform",this.getTranslation()),this.updateComponentLocations(e)}snapToGrid(){if(!this.isDeadOrDying()&&!this.getParent()&&!this.isInFlyout){var e=this.workspace.getGrid();if(null!=e&&e.shouldSnap()){var t=this.getRelativeToSurfaceXY();(e=e.alignXY(t))!==t&&this.moveTo(e,["snap"])}}}getBoundingRectangle(){const e=this.getRelativeToSurfaceXY(),t=this.getHeightWidth();let i,n;return this.RTL?(i=e.x-t.width,n=e.x):(i=e.x,n=e.x+t.width),new Tl(e.y,e.y+t.height,i,n)}markDirty(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(let e,t=0;e=this.inputList[t];t++)e.markDirty()}setCollapsed(e){this.collapsed_!==e&&(super.setCollapsed(e),this.updateCollapsed_())}updateCollapsed_(){var e=this.isCollapsed();const t="_TEMP_COLLAPSED_INPUT",i="_TEMP_COLLAPSED_FIELD";for(let i,n=0;i=this.inputList[n];n++)i.name!==t&&i.setVisible(!e);for(var n of this.getIcons())n.updateCollapsed();e?(e=this.toString(30),(n=this.getField(i))?n.setValue(e):(this.getInput(t)||this.appendDummyInput(t)).appendField(new hd(e),i)):(this.updateDisabled(),this.removeInput(t))}tab(e,t){const i=new Xd;i.setCurNode(Id.createFieldNode(e)),e=i.getCurNode(),t?i.next():i.prev(),(t=i.getCurNode())&&t!==e&&(t.getLocation().showEditor(),this.workspace.keyboardAccessibilityMode&&this.workspace.getCursor().setCurNode(t))}onMouseDown_(e){const t=this.workspace.getGesture(e);t&&t.handleBlockStart(e,this)}showHelp(){const e="function"==typeof this.helpUrl?this.helpUrl():this.helpUrl;e&&window.open(e)}generateContextMenu(){if(this.workspace.options.readOnly||!this.contextMenu)return null;const e=Xu.registry.getContextMenuOptions(Xu.ScopeType.BLOCK,{block:this});return this.customContextMenu&&this.customContextMenu(e),e}showContextMenu(e){const t=this.generateContextMenu();t&&t.length&&(Mn(e,t,this.RTL,this.workspace),Dn(this))}updateComponentLocations(e){this.dragging||this.updateConnectionLocations(e),this.updateIconLocations(e),this.updateFieldLocations(e);for(const t of this.getChildren(!1))t.updateComponentLocations(cl.sum(e,t.relativeCoords))}updateConnectionLocations(e){for(const t of this.getConnections_(!1))t.moveToOffset(e)}updateIconLocations(e){for(const t of this.getIcons())t.onLocationChange(e)}updateFieldLocations(e){for(const t of this.inputList)for(const i of t.fieldRow)i.onLocationChange(e)}setDragging(e){(this.dragging=e)?(this.translation="",ba.push(...this.getConnections_(!0)),te(this.svgGroup_,"blocklyDragging")):(ba.length=0,ne(this.svgGroup_,"blocklyDragging"));for(let t=0;t<this.childBlocks_.length;t++)this.childBlocks_[t].setDragging(e)}setMovable(e){super.setMovable(e),this.pathObject.updateMovable(e)}setEditable(e){super.setEditable(e),e=this.getIcons();for(let t=0;t<e.length;t++)e[t].updateEditable()}setShadow(e){super.setShadow(e),this.applyColour()}setInsertionMarker(e){this.isInsertionMarker_!==e&&(this.isInsertionMarker_=e)&&(this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))}getSvgRoot(){return this.svgGroup_}dispose(e,t){this.disposing=!0,qi(),Hn(),t&&(this.unplug(e),fs(this)),super.dispose(!!e),oe(this.svgGroup_)}disposeInternal(){this.disposing=!0,super.disposeInternal(),R()===this&&(this.unselect(),this.workspace.cancelCurrentGesture()),[...this.warningTextDb.values()].forEach((e=>clearTimeout(e))),this.warningTextDb.clear(),this.getIcons().forEach((e=>e.dispose()))}checkAndDelete(){this.workspace.isFlyout||(Hr.setGroup$$module$build$src$core$events$utils(!0),this.workspace.hideChaff(),this.outputConnection?this.dispose(!1,!0):this.dispose(!0,!0),Hr.setGroup$$module$build$src$core$events$utils(!1))}toCopyData(){return this.isInsertionMarker_?null:{paster:qd.TYPE,blockState:Mt(this,{addCoordinates:!0,addNextBlocks:!1}),typeCounts:$(this,!0)}}applyColour(){this.pathObject.applyColour(this);const e=this.getIcons();for(let t=0;t<e.length;t++)e[t].applyColour();for(let e,t=0;e=this.inputList[t];t++)for(let t,i=0;t=e.fieldRow[i];i++)t.applyColour()}updateDisabled(){const e=!this.isEnabled()||this.getInheritedDisabled();if(this.visuallyDisabled===e){let e;null==(e=this.getNextBlock())||e.updateDisabled()}else{this.applyColour(),this.visuallyDisabled=e;for(const e of this.getChildren(!1))e.updateDisabled()}}setWarningText(e,t=""){if(t)this.warningTextDb.has(t)&&(clearTimeout(this.warningTextDb.get(t)),this.warningTextDb.delete(t));else{for(var i of this.warningTextDb.values())clearTimeout(i);this.warningTextDb.clear()}if(this.workspace.isDragging())this.warningTextDb.set(t,setTimeout((()=>{this.isDeadOrDying()||(this.warningTextDb.delete(t),this.setWarningText(e,t))}),100));else if(this.isInFlyout&&(e=null),i=this.getIcon(Dh.TYPE),e){let n=this.getSurroundParent(),s=null;for(;n;)n.isCollapsed()&&(s=n),n=n.getSurroundParent();s&&s.setWarningText(Hr.Msg$$module$build$src$core$msg.COLLAPSED_WARNINGS_WARNING,ep.COLLAPSED_WARNING_ID),i?i.addMessage(e,t):this.addIcon(new Dh(this).addMessage(e,t))}else i&&(t?(i.addMessage("",t),i.getText()||this.removeIcon(Dh.TYPE)):this.removeIcon(Dh.TYPE))}setMutator(e){this.removeIcon(Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE),e&&this.addIcon(e)}addIcon(e){return super.addIcon(e),e instanceof Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon&&(this.mutator=e),e.initView(this.createIconPointerDownListener(e)),e.applyColour(),e.updateEditable(),this.queueRender(),e}createIconPointerDownListener(e){return t=>{this.isDeadOrDying()||(t=this.workspace.getGesture(t))&&t.setStartIcon(e)}}removeIcon(e){const t=super.removeIcon(e);return e.equals(Hr.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE)&&(this.mutator=null),this.queueRender(),t}setEnabled(e){Xs("setEnabled","v11","v12","the setDisabledReason method of BlockSvg");const t=this.isEnabled();super.setEnabled(e),this.isEnabled()===t||this.getInheritedDisabled()||this.updateDisabled()}setDisabledReason(e,t){const i=this.isEnabled();super.setDisabledReason(e,t),this.isEnabled()===i||this.getInheritedDisabled()||this.updateDisabled()}setHighlighted(e){this.pathObject.updateHighlighted(e)}addSelect(){this.pathObject.updateSelected(!0)}removeSelect(){this.pathObject.updateSelected(!1)}setDeleteStyle(e){this.pathObject.updateDraggingDelete(e)}getColour(){return this.style.colourPrimary}setColour(e){super.setColour(e),e=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_),this.pathObject.setStyle(e.style),this.style=e.style,this.styleName_=e.name,this.applyColour()}setStyle(e){const t=this.workspace.getRenderer().getConstants().getBlockStyle(e);if(this.styleName_=e,!t)throw Error("Invalid style name: "+e);this.hat=t.hat,this.pathObject.setStyle(t),this.colour_=t.colourPrimary,this.style=t,this.applyColour()}bringToFront(e=!1){let t=this;if(!t.isDeadOrDying())do{const i=t.getSvgRoot(),n=i.parentNode,s=n.childNodes;if(s[s.length-1]!==i&&n.appendChild(i),e)break;t=t.getParent()}while(t)}setPreviousStatement(e,t){super.setPreviousStatement(e,t),this.queueRender()}setNextStatement(e,t){super.setNextStatement(e,t),this.queueRender()}setOutput(e,t){super.setOutput(e,t),this.queueRender()}setInputsInline(e){super.setInputsInline(e),this.queueRender()}removeInput(e,t){return e=super.removeInput(e,t),this.queueRender(),e}moveNumberedInputBefore(e,t){super.moveNumberedInputBefore(e,t),this.queueRender()}appendInput(e){return super.appendInput(e),this.queueRender(),e}setConnectionTracking(e){if(this.previousConnection&&this.previousConnection.setTracking(e),this.outputConnection&&this.outputConnection.setTracking(e),this.nextConnection){this.nextConnection.setTracking(e);var t=this.nextConnection.targetBlock();t&&t.setConnectionTracking(e)}if(!this.collapsed_)for(t=0;t<this.inputList.length;t++){var i=this.inputList[t].connection;i&&(i.setTracking(e),(i=i.targetBlock())&&i.setConnectionTracking(e))}}getConnections_(e){const t=[];if(this.outputConnection&&t.push(this.outputConnection),this.previousConnection&&t.push(this.previousConnection),this.nextConnection&&t.push(this.nextConnection),e||!this.collapsed_)for(let e,i=0;e=this.inputList[i];i++)e.connection&&t.push(e.connection);return t}lastConnectionInStack(e){return super.lastConnectionInStack(e)}getMatchingConnection(e,t){return super.getMatchingConnection(e,t)}makeConnection_(e){return new Yd(this,e)}getNextBlock(){return super.getNextBlock()}getPreviousBlock(){return super.getPreviousBlock()}bumpNeighbours(){const e=this.getRootBlock();if(!(this.isDeadOrDying()||this.workspace.isDragging()||e.isInFlyout))for(const t of this.getConnections_(!1)){if(t.isSuperior()){let e;null==(e=t.targetBlock())||e.bumpNeighbours()}for(const i of t.neighbours(Hr.config$$module$build$src$core$config.snapRadius))i.getSourceBlock().getRootBlock()!==e&&(t.isConnected()&&i.isConnected()||(t.isSuperior()?i.bumpAwayFrom(t):t.bumpAwayFrom(i)))}}scheduleSnapAndBump(){this.snapToGrid(),this.bumpNeighbours()}positionNearConnection(e,t,i){if(e.type===eh.NEXT_STATEMENT||e.type===eh.INPUT_VALUE){let n=t.x;t=t.y,n+=i.x-e.getOffsetInBlock().x,t+=i.y-e.getOffsetInBlock().y,this.moveBy(n,t)}}getChildren(e){return super.getChildren(e)}queueRender(){return ft(this)}render(){this.queueRender(),Tt()}renderEfficiently(){le(),this.isCollapsed()&&this.updateCollapsed_(),this.isEnabled()||this.updateDisabled(),this.workspace.getRenderer().render(this),this.tightenChildrenEfficiently(),ce(),this.updateMarkers_()}tightenChildrenEfficiently(){for(const e of this.inputList){const t=e.connection;t&&t.tightenEfficiently()}this.nextConnection&&this.nextConnection.tightenEfficiently()}updateMarkers_(){this.workspace.keyboardAccessibilityMode&&this.pathObject.cursorSvg&&this.workspace.getCursor().draw(),this.workspace.keyboardAccessibilityMode&&this.pathObject.markerSvg&&this.workspace.getMarker(au.LOCAL_MARKER).draw();for(const e of this.inputList)for(const t of e.fieldRow)t.updateMarkers_()}setCursorSvg(e){this.pathObject.setCursorSvg(e)}setMarkerSvg(e){this.pathObject.setMarkerSvg(e)}getHeightWidth(){let e=this.height,t=this.width;var i=this.getNextBlock();if(i){i=i.getHeightWidth();const n=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;e+=i.height-n,t=Math.max(t,i.width)}return{height:e,width:t}}fadeForReplacement(e){this.pathObject.updateReplacementFade(e)}highlightShapeForInput(e,t){this.pathObject.updateShapeForInputHighlight(e,t)}setDragStrategy(e){this.dragStrategy=e}isMovable(){return this.dragStrategy.isMovable()}startDrag(e){this.dragStrategy.startDrag(e)}drag(e,t){this.dragStrategy.drag(e,t)}endDrag(e){this.dragStrategy.endDrag(e)}revertDrag(){this.dragStrategy.revertDrag()}toFlyoutInfo(){const e=Object.assign({},{kind:"BLOCK"},Mt(this)),t=new Set(["id","height","width","pinned","enabled"]),i=function(e){for(const n in e)t.has(n)?delete e[n]:"object"==typeof e[n]&&i(e[n])};return i(e),[e]}};ep.INLINE=-1,ep.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_";var tp=class{constructor(){}onDragEnter(e){}onDragOver(e){}onDragExit(e){}onDrop(e){}getClientRect(){return null}shouldPreventMove(e){return!1}},ip=class extends tp{constructor(){super(),this.wouldDelete_=!1}wouldDelete(e){return e instanceof ep?(e=!e.getParent()&&e.isDeletable(),this.updateWouldDelete_(e)):this.updateWouldDelete_(Fo(e)&&e.isDeletable()),this.wouldDelete_}updateWouldDelete_(e){this.wouldDelete_=e}},np=class extends ip{constructor(e){super(),this.workspace=e,this.id="trashcan",this.contents=[],this.flyout=null,this.isLidOpen=!1,this.minOpenness=0,this.lidTask=this.svgLid=this.svgGroup=null,this.top=this.left=this.lidOpen=0,this.initialized=!1,0>=this.workspace.options.maxTrashcanContents||(e=new dh({scrollbars:!0,parentWorkspace:this.workspace,rtl:this.workspace.RTL,oneBasedIndex:this.workspace.options.oneBasedIndex,renderer:this.workspace.options.renderer,rendererOverrides:this.workspace.options.rendererOverrides,move:{scrollbars:!0}}),this.workspace.horizontalLayout?(e.toolboxPosition=this.workspace.toolboxPosition===$l.TOP?$l.BOTTOM:$l.TOP,this.flyout=new(c(Xr.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace.options,!0))(e)):(e.toolboxPosition=this.workspace.toolboxPosition===$l.RIGHT?$l.LEFT:$l.RIGHT,this.flyout=new(c(Xr.FLYOUTS_VERTICAL_TOOLBOX,this.workspace.options,!0))(e)),this.workspace.addChangeListener(this.onDelete.bind(this)))}createDom(){let e;this.svgGroup=ee(_l.G,{class:"blocklyTrash"});const t=String(Math.random()).substring(2);e=ee(_l.CLIPPATH,{id:"blocklyTrashBodyClipPath"+t},this.svgGroup),ee(_l.RECT,{width:sp,height:op,y:rp},e);const i=ee(_l.IMAGE,{width:Vl,x:-up,height:jl,y:-hp,"clip-path":"url(#blocklyTrashBodyClipPath"+t+")"},this.svgGroup);return i.setAttributeNS(dl,"xlink:href",this.workspace.options.pathToMedia+Wl),e=ee(_l.CLIPPATH,{id:"blocklyTrashLidClipPath"+t},this.svgGroup),ee(_l.RECT,{width:sp,height:rp},e),this.svgLid=ee(_l.IMAGE,{width:Vl,x:-up,height:jl,y:-hp,"clip-path":"url(#blocklyTrashLidClipPath"+t+")"},this.svgGroup),this.svgLid.setAttributeNS(dl,"xlink:href",this.workspace.options.pathToMedia+Wl),W(this.svgGroup,"pointerdown",this,this.blockMouseDownWhenOpenable),W(this.svgGroup,"pointerup",this,this.click),W(i,"pointerover",this,this.mouseOver),W(i,"pointerout",this,this.mouseOut),this.animateLid(),this.svgGroup}init(){0<this.workspace.options.maxTrashcanContents&&(re(this.flyout.createDom(_l.SVG),this.workspace.getParentSvg()),this.flyout.init(this.workspace)),this.workspace.getComponentManager().addComponent({component:this,weight:1,capabilities:[sl.Capability.AUTOHIDEABLE,sl.Capability.DELETE_AREA,sl.Capability.DRAG_TARGET,sl.Capability.POSITIONABLE]}),this.initialized=!0,this.setLidOpen(!1)}dispose(){this.workspace.getComponentManager().removeComponent("trashcan"),this.svgGroup&&oe(this.svgGroup),this.lidTask&&clearTimeout(this.lidTask)}hasContents(){return!!this.contents.length}contentsIsOpen(){return!!this.flyout&&this.flyout.isVisible()}openFlyout(){if(!this.contentsIsOpen()){var e=this.contents.map((function(e){return JSON.parse(e)})),t=this.workspace.getParentSvg().style;t.cursor="wait",setTimeout((()=>{let i,n;null==(i=this.flyout)||i.show(e),t.cursor="",null==(n=this.workspace.scrollbar)||n.setVisible(!1)}),10),this.fireUiEvent(!0)}}closeFlyout(){var e,t;this.contentsIsOpen()&&(null==(e=this.flyout)||e.hide(),null==(t=this.workspace.scrollbar)||t.setVisible(!0),this.fireUiEvent(!1),this.workspace.recordDragTargets())}autoHide(e){!e&&this.flyout&&this.closeFlyout()}emptyContents(){this.hasContents()&&(this.contents.length=0,this.setMinOpenness(0),this.closeFlyout())}position(e,t){if(this.initialized){var i,n=Ve(this.workspace,e);e=Ge(n,new El(sp,op+rp),lp,ap,e,this.workspace),t=je(e,ap,n.vertical===Pl.TOP?Fl.DOWN:Fl.UP,t),this.top=t.top,this.left=t.left,null==(i=this.svgGroup)||i.setAttribute("transform","translate("+this.left+","+this.top+")")}}getBoundingRectangle(){return new Tl(this.top,this.top+op+rp,this.left,this.left+sp)}getClientRect(){if(!this.svgGroup)return null;var e=this.svgGroup.getBoundingClientRect();const t=e.top+hp-cp;return e=e.left+up-cp,new Tl(t,t+rp+op+2*cp,e,e+sp+2*cp)}onDragOver(e){this.setLidOpen(this.wouldDelete_)}onDragExit(e){this.setLidOpen(!1)}onDrop(e){setTimeout(this.setLidOpen.bind(this,!1),100)}setLidOpen(e){this.isLidOpen!==e&&(this.lidTask&&clearTimeout(this.lidTask),this.isLidOpen=e,this.animateLid())}animateLid(){const e=gp;var t=1/(e+1);this.lidOpen+=this.isLidOpen?t:-t,this.lidOpen=Math.min(Math.max(this.lidOpen,this.minOpenness),1),this.setLidAngle(this.lidOpen*_p),t=mp+this.lidOpen*(fp-mp),this.svgGroup&&(this.svgGroup.style.opacity=`${t}`),this.lidOpen>this.minOpenness&&1>this.lidOpen&&(this.lidTask=setTimeout(this.animateLid.bind(this),pp/e))}setLidAngle(e){const t=this.workspace.toolboxPosition===$l.RIGHT||this.workspace.horizontalLayout&&this.workspace.RTL;let i;null==(i=this.svgLid)||i.setAttribute("transform","rotate("+(t?-e:e)+","+(t?4:sp-4)+","+(rp-2)+")")}setMinOpenness(e){this.minOpenness=e,this.isLidOpen||this.setLidAngle(e*_p)}closeLid(){this.setLidOpen(!1)}click(){this.hasContents()&&!this.workspace.isDragging()&&this.openFlyout()}fireUiEvent(e){e=new(y("trashcan_open"))(e,this.workspace.id),p(e)}blockMouseDownWhenOpenable(e){!this.contentsIsOpen()&&this.hasContents()&&e.stopPropagation()}mouseOver(){this.hasContents()&&this.setLidOpen(!0)}mouseOut(){this.setLidOpen(!1)}onDelete(e){if(!(0>=this.workspace.options.maxTrashcanContents||e.type!==Hr.DELETE$$module$build$src$core$events$utils||e.type!==Hr.DELETE$$module$build$src$core$events$utils||e.wasShadow)){if(!e.oldJson)throw Error("Encountered a delete event without proper oldJson");if(e=JSON.stringify(this.cleanBlockJson(e.oldJson)),!this.contents.includes(e)){for(this.contents.unshift(e);this.contents.length>this.workspace.options.maxTrashcanContents;)this.contents.pop();this.setMinOpenness(dp)}}}cleanBlockJson(e){return function e(t){if(t){if(delete t.id,delete t.x,delete t.y,delete t.enabled,delete t.disabledReasons,t.icons&&t.icons.comment){var i=t.icons.comment;delete i.height,delete i.width,delete i.pinned}for(var n in i=t.inputs){var s=i[n];const t=s.block;s=s.shadow,t&&e(t),s&&e(s)}t.next&&(t=(n=t.next).block,n=n.shadow,t&&e(t),n&&e(n))}}(e=JSON.parse(JSON.stringify(e))),Object.assign({},{kind:"BLOCK"},e)}},sp=47,op=44,rp=16,ap=20,lp=20,cp=10,up=0,hp=32,dp=.1,pp=80,gp=4,mp=.4,fp=.8,_p=45,Tp=class{constructor(){this.shortcuts=new Map,this.keyMap=new Map,this.reset()}reset(){this.shortcuts.clear(),this.keyMap.clear()}register(e,t){if(this.shortcuts.get(e.name)&&!t)throw Error(`Shortcut named "${e.name}" already exists.`);if(this.shortcuts.set(e.name,e),(t=e.keyCodes)&&0<t.length)for(let i=0;i<t.length;i++)this.addKeyMapping(t[i],e.name,!!e.allowCollision)}unregister(e){return this.shortcuts.get(e)?(this.removeAllKeyMappings(e),this.shortcuts.delete(e),!0):(console.warn(`Keyboard shortcut named "${e}" not found.`),!1)}addKeyMapping(e,t,i){e=`${e}`;const n=this.keyMap.get(e);if(n&&!i)throw Error(`Shortcut named "${t}" collides with shortcuts "${n}"`);n&&i?n.unshift(t):this.keyMap.set(e,[t])}removeKeyMapping(e,t,i){const n=this.keyMap.get(e);if(!n)return i||console.warn(`No keyboard shortcut named "${t}" registered with key code "${e}"`),!1;const s=n.indexOf(t);return-1<s?(n.splice(s,1),0===n.length&&this.keyMap.delete(e),!0):(i||console.warn(`No keyboard shortcut named "${t}" registered with key code "${e}"`),!1)}removeAllKeyMappings(e){for(const t of this.keyMap.keys())this.removeKeyMapping(t,e,!0)}setKeyMap(e){this.keyMap.clear();for(const t in e)this.keyMap.set(t,e[t])}getKeyMap(){const e=Object.create(null);for(const[t,i]of this.keyMap)e[t]=i;return e}getRegistry(){const e=Object.create(null);for(const[t,i]of this.shortcuts)e[t]=i;return vs(Object.create(null),e)}onKeyDown(e,t){var i=this.serializeKeyEvent_(t);if(!(i=this.getShortcutNamesByKeyCode(i)))return!1;for(let n,s=0;n=i[s];s++){const i=this.shortcuts.get(n);let s,o;if(null==(s=i)||!s.preconditionFn||null!=(o=i)&&o.preconditionFn(e)){let n,s;if(null!=(n=i)&&n.callback&&null!=(s=i)&&s.callback(e,t,i))return!0}}return!1}getShortcutNamesByKeyCode(e){return this.keyMap.get(e)||[]}getKeyCodesByShortcutName(e){const t=[];for(const[i,n]of this.keyMap)-1<n.indexOf(e)&&t.push(i);return t}serializeKeyEvent_(e){let t="";for(const i in Tp.modifierKeys)e.getModifierState(i)&&(""!==t&&(t+="+"),t+=i);return""!==t&&e.keyCode?t+="+"+e.keyCode:e.keyCode&&(t=String(e.keyCode)),t}checkModifiers_(e){for(let t,i=0;t=e[i];i++)if(!(t in Tp.modifierKeys))throw Error(t+" is not a valid modifier key.")}createSerializedKey(e,t){let i="";if(t){this.checkModifiers_(t);for(const e in Tp.modifierKeys)t.includes(Tp.modifierKeys[e])&&(""!==i&&(i+="+"),i+=e)}return""!==i&&e?i+="+"+e:e&&(i=`${e}`),i}};Tp.registry=new Tp,function(e){(e=e.modifierKeys||(e.modifierKeys={}))[e.Shift=16]="Shift",e[e.Control=17]="Control",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta"}(Tp||(Tp={}));var Ep,bp=null,Ip=null,yp={duplicateInternal:Vo,copyInternal:Uo},vp={};vp.BlockPaster=qd,vp.TEST_ONLY=yp,vp.paste=Ho,vp.registry=vc,function(e){e.ESCAPE="escape",e.DELETE="delete",e.COPY="copy",e.CUT="cut",e.PASTE="paste",e.UNDO="undo",e.REDO="redo"}(Ep||(Ep={}));var Cp=null,kp=null,Op=null;Zo();var Np={};Np.names=Ep,Np.registerCopy=Yo,Np.registerCut=zo,Np.registerDefaultShortcuts=Zo,Np.registerDelete=Xo,Np.registerEscape=Wo,Np.registerPaste=Ko,Np.registerRedo=Jo,Np.registerUndo=qo;var Ap={ProcedureSerializer:class{constructor(e,t){this.procedureModelClass=e,this.parameterModelClass=t,this.priority=75}save(e){return(e=e.getProcedureMap().getProcedures().map((e=>Qo(e)))).length?e:null}load(e,t){const i=t.getProcedureMap();for(const n of e)i.add(er(this.procedureModelClass,this.parameterModelClass,n,t))}clear(e){e.getProcedureMap().clear()}}};Ap.loadProcedure=er,Ap.saveProcedure=Qo;var Sp=class{constructor(){this.priority=100}save(e){const t=[];for(const i of e.getAllVariables())e={name:i.name,id:i.getId()},i.type&&(e.type=i.type),t.push(e);return t.length?t:null}load(e,t){for(const i of e)t.createVariable(i.name,i.type,i.id)}clear(e){e.getVariableMap().clear()}};kt("variables",new Sp);var Rp={};Rp.VariableSerializer=Sp;var wp={};wp.load=ir,wp.save=tr;var Lp={blocks:Uc,exceptions:Bc,priorities:{BLOCKS:50,PROCEDURES:75,VARIABLES:100,WORKSPACE_COMMENTS:25},procedures:Ap,registry:bc,variables:Rp,workspaceComments:yc,workspaces:wp},xp=class{constructor(e,t,i,n,s){this.workspace=e,this.oldHostMetrics_=this.corner_=this.vScroll=this.hScroll=null,i=void 0===i||i;const o=(t=void 0===t||t)&&i;t&&(this.hScroll=new kl(e,!0,o,n,s)),i&&(this.vScroll=new kl(e,!1,o,n,s)),o&&(this.corner_=ee(_l.RECT,{height:kl.scrollbarThickness,width:kl.scrollbarThickness,class:"blocklyScrollbarBackground"}),re(this.corner_,e.getBubbleCanvas()))}dispose(){oe(this.corner_),this.oldHostMetrics_=this.corner_=null,this.hScroll&&(this.hScroll.dispose(),this.hScroll=null),this.vScroll&&(this.vScroll.dispose(),this.vScroll=null)}resize(){const e=this.workspace.getMetrics();if(e){var t=!1,i=!1;if(this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth===e.viewWidth&&this.oldHostMetrics_.viewHeight===e.viewHeight&&this.oldHostMetrics_.absoluteTop===e.absoluteTop&&this.oldHostMetrics_.absoluteLeft===e.absoluteLeft?(this.oldHostMetrics_&&this.oldHostMetrics_.scrollWidth===e.scrollWidth&&this.oldHostMetrics_.viewLeft===e.viewLeft&&this.oldHostMetrics_.scrollLeft===e.scrollLeft||(t=!0),this.oldHostMetrics_&&this.oldHostMetrics_.scrollHeight===e.scrollHeight&&this.oldHostMetrics_.viewTop===e.viewTop&&this.oldHostMetrics_.scrollTop===e.scrollTop||(i=!0)):i=t=!0,t||i){try{Hr.disable$$module$build$src$core$events$utils(),this.hScroll&&t&&this.hScroll.resize(e),this.vScroll&&i&&this.vScroll.resize(e)}finally{Hr.enable$$module$build$src$core$events$utils()}this.workspace.maybeFireViewportChangeEvent()}if(this.hScroll&&this.vScroll){if(!this.oldHostMetrics_||this.oldHostMetrics_.viewWidth!==e.viewWidth||this.oldHostMetrics_.absoluteLeft!==e.absoluteLeft){let e;null==(e=this.corner_)||e.setAttribute("x",String(this.vScroll.position.x))}if(!this.oldHostMetrics_||this.oldHostMetrics_.viewHeight!==e.viewHeight||this.oldHostMetrics_.absoluteTop!==e.absoluteTop){let e;null==(e=this.corner_)||e.setAttribute("y",String(this.hScroll.position.y))}}this.oldHostMetrics_=e}}canScrollHorizontally(){return!!this.hScroll}canScrollVertically(){return!!this.vScroll}setOrigin(e,t){this.hScroll&&this.hScroll.setOrigin(e,t),this.vScroll&&this.vScroll.setOrigin(e,t)}set(e,t,i){this.hScroll&&this.hScroll.set(e,!1),this.vScroll&&this.vScroll.set(t,!1),(i||void 0===i)&&(e={},this.hScroll&&(e.x=this.hScroll.getRatio_()),this.vScroll&&(e.y=this.vScroll.getRatio_()),this.workspace.setMetrics(e))}setX(e){this.hScroll&&this.hScroll.set(e,!0)}setY(e){this.vScroll&&this.vScroll.set(e,!0)}setContainerVisible(e){this.hScroll&&this.hScroll.setContainerVisible(e),this.vScroll&&this.vScroll.setContainerVisible(e)}isVisible(){let e=!1;return this.hScroll&&(e=this.hScroll.isVisible()),this.vScroll&&(e=e||this.vScroll.isVisible()),e}setVisible(e){this.hScroll&&this.hScroll.setVisibleInternal(e),this.vScroll&&this.vScroll.setVisibleInternal(e)}resizeContent(e){this.hScroll&&this.hScroll.resizeContentHorizontal(e),this.vScroll&&this.vScroll.resizeContentVertical(e)}resizeView(e){this.hScroll&&this.hScroll.resizeViewHorizontal(e),this.vScroll&&this.vScroll.resizeViewVertical(e)}},$p=class{constructor(e){this.workspace_=e}getDimensionsPx_(e){let t=0,i=0;return e&&(t=e.getWidth(),i=e.getHeight()),new El(t,i)}getFlyoutMetrics(e){return{width:(e=this.getDimensionsPx_(this.workspace_.getFlyout(e))).width,height:e.height,position:this.workspace_.toolboxPosition}}getToolboxMetrics(){const e=this.getDimensionsPx_(this.workspace_.getToolbox());return{width:e.width,height:e.height,position:this.workspace_.toolboxPosition}}getSvgMetrics(){return this.workspace_.getCachedParentSvgSize()}getAbsoluteMetrics(){let e=0,t=0;const i=this.getToolboxMetrics(),n=this.getFlyoutMetrics(),s=!!this.workspace_.getToolbox();var o;const r=!(null!=(o=this.workspace_.getFlyout())&&o.autoClose),a=(o=s?i.position:n.position)===$l.TOP;return o===$l.LEFT&&(s&&(e+=i.width),r&&(e+=n.width)),a&&(s&&(t+=i.height),r&&(t+=n.height)),{top:t,left:e}}getViewMetrics(e){e=e?this.workspace_.scale:1;const t=this.getSvgMetrics(),i=this.getToolboxMetrics(),n=this.getFlyoutMetrics(),s=!!this.workspace_.getToolbox();var o;const r=!(null!=(o=this.workspace_.getFlyout())&&o.autoClose),a=(o=s?i.position:n.position)===$l.LEFT||o===$l.RIGHT;return o!==$l.TOP&&o!==$l.BOTTOM||(s&&(t.height-=i.height),r&&(t.height-=n.height)),a&&(s&&(t.width-=i.width),r&&(t.width-=n.width)),{height:t.height/e,width:t.width/e,top:-this.workspace_.scrollY/e,left:-this.workspace_.scrollX/e}}getContentMetrics(e){e=e?1:this.workspace_.scale;const t=this.workspace_.getBlocksBoundingBox();return{height:(t.bottom-t.top)*e,width:(t.right-t.left)*e,top:t.top*e,left:t.left*e}}hasFixedEdges(){return!this.workspace_.isMovableHorizontally()||!this.workspace_.isMovableVertically()}getComputedFixedEdges_(e){if(!this.hasFixedEdges())return{};const t=this.workspace_.isMovableHorizontally(),i=this.workspace_.isMovableVertically();e=e||this.getViewMetrics(!1);const n={};return i||(n.top=e.top,n.bottom=e.top+e.height),t||(n.left=e.left,n.right=e.left+e.width),n}getPaddedContent_(e,t){const i=t.top+t.height,n=t.left+t.width,s=e.width,o=s/2,r=(e=e.height)/2;return{top:Math.min(t.top-r,i-e),bottom:Math.max(i+r,t.top+e),left:Math.min(t.left-o,n-s),right:Math.max(n+o,t.left+s)}}getScrollMetrics(e,t,i){e=e?this.workspace_.scale:1,t=t||this.getViewMetrics(!1);var n=i||this.getContentMetrics();i=this.getComputedFixedEdges_(t),t=this.getPaddedContent_(t,n),n=void 0!==i.top?i.top:t.top;const s=void 0!==i.left?i.left:t.left;return{top:n/e,left:s/e,width:((void 0!==i.right?i.right:t.right)-s)/e,height:((void 0!==i.bottom?i.bottom:t.bottom)-n)/e}}getUiMetrics(){return{viewMetrics:this.getViewMetrics(),absoluteMetrics:this.getAbsoluteMetrics(),toolboxMetrics:this.getToolboxMetrics()}}getMetrics(){const e=this.getToolboxMetrics(),t=this.getFlyoutMetrics(!0),i=this.getSvgMetrics(),n=this.getAbsoluteMetrics(),s=this.getViewMetrics(),o=this.getContentMetrics(),r=this.getScrollMetrics(!1,s,o);return{contentHeight:o.height,contentWidth:o.width,contentTop:o.top,contentLeft:o.left,scrollHeight:r.height,scrollWidth:r.width,scrollTop:r.top,scrollLeft:r.left,viewHeight:s.height,viewWidth:s.width,viewTop:s.top,viewLeft:s.left,absoluteTop:n.top,absoluteLeft:n.left,svgHeight:i.height,svgWidth:i.width,toolboxWidth:e.width,toolboxHeight:e.height,toolboxPosition:e.position,flyoutWidth:t.width,flyoutHeight:t.height}}};t(Xr.METRICS_MANAGER,Wr,$p),"Blockly"in globalThis||(globalThis.Blockly={Msg:Jl});var Dp=class extends ld{constructor(){super(),this.GRID_UNIT=4,this.CURSOR_COLOUR="#ffa200",this.CURSOR_RADIUS=5,this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0,this.START_HAT_HEIGHT=22,this.START_HAT_WIDTH=96,this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5},this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:1*this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}},this.FULL_BLOCK_FIELDS=!0,this.FIELD_TEXT_FONTWEIGHT="bold",this.FIELD_TEXT_FONTFAMILY='"Helvetica Neue", "Segoe UI", Helvetica, sans-serif',this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0,this.SELECTED_GLOW_COLOUR="#fff200",this.SELECTED_GLOW_SIZE=.5,this.REPLACEMENT_GLOW_COLOUR="#fff200",this.REPLACEMENT_GLOW_SIZE=2,this.selectedGlowFilterId="",this.selectedGlowFilter=null,this.replacementGlowFilterId="",this.SQUARED=this.ROUNDED=this.HEXAGONAL=this.replacementGlowFilter=null,this.SMALL_PADDING=this.GRID_UNIT,this.MEDIUM_PADDING=2*this.GRID_UNIT,this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT,this.LARGE_PADDING=4*this.GRID_UNIT,this.CORNER_RADIUS=1*this.GRID_UNIT,this.NOTCH_WIDTH=9*this.GRID_UNIT,this.NOTCH_HEIGHT=2*this.GRID_UNIT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT,this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT,this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT,this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT,this.TOP_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT,this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*this.GRID_UNIT,this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT,this.CURSOR_WS_WIDTH=20*this.GRID_UNIT,this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT,this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS,this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT,this.FIELD_BORDER_RECT_Y_PADDING=1.625*this.GRID_UNIT,this.FIELD_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_COLOUR_DEFAULT_WIDTH=6*this.GRID_UNIT,this.FIELD_COLOUR_DEFAULT_HEIGHT=8*this.GRID_UNIT,this.FIELD_CHECKBOX_X_OFFSET=1*this.GRID_UNIT,this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH=12*this.GRID_UNIT}setFontConstants_(e){super.setFontConstants_(e),this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT=this.FIELD_TEXT_HEIGHT+2*this.FIELD_BORDER_RECT_Y_PADDING}init(){super.init(),this.HEXAGONAL=this.makeHexagonal(),this.ROUNDED=this.makeRounded(),this.SQUARED=this.makeSquared(),this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT+this.INSIDE_CORNERS.rightWidth}setDynamicProperties_(e){super.setDynamicProperties_(e),this.SELECTED_GLOW_COLOUR=e.getComponentStyle("selectedGlowColour")||this.SELECTED_GLOW_COLOUR;const t=Number(e.getComponentStyle("selectedGlowSize"));this.SELECTED_GLOW_SIZE=t&&!isNaN(t)?t:this.SELECTED_GLOW_SIZE,this.REPLACEMENT_GLOW_COLOUR=e.getComponentStyle("replacementGlowColour")||this.REPLACEMENT_GLOW_COLOUR,this.REPLACEMENT_GLOW_SIZE=(e=Number(e.getComponentStyle("replacementGlowSize")))&&!isNaN(e)?e:this.REPLACEMENT_GLOW_SIZE}dispose(){super.dispose(),this.selectedGlowFilter&&oe(this.selectedGlowFilter),this.replacementGlowFilter&&oe(this.replacementGlowFilter)}makeStartHat(){const e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH;return{height:e,width:t,path:zs("c",[Ys(25,-e),Ys(71,-e),Ys(t,0)])}}makeHexagonal(){function e(e,i,n){var s=e/2;return Js(-(n=n?-1:1)*(s=s>t?t:s),e=(i?-1:1)*e/2)+Js(n*s,e)}const t=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width:e=>(e/=2)>t?t:e,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}makeRounded(){function e(e,t,n){const s=e>i?e-i:0,o=n===t?"0":"1";return eo("a","0 0,"+o,e=(e>i?i:e)/2,Ys((n?1:-1)*e,(t?-1:1)*e))+Qs("v",(t?-1:1)*s)+eo("a","0 0,"+o,e,Ys((n?-1:1)*e,(t?-1:1)*e))}const t=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,i=2*t;return{type:this.SHAPES.ROUND,isDynamic:!0,width:e=>(e/=2)>t?t:e,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}makeSquared(){function e(e,i,n){e-=2*t;const s=n===i?"0":"1";return eo("a","0 0,"+s,t,Ys((n?1:-1)*t,(i?-1:1)*t))+Qs("v",(i?-1:1)*e)+eo("a","0 0,"+s,t,Ys((n?-1:1)*t,(i?-1:1)*t))}const t=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width:e=>t,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}shapeFor(e){let t=e.getCheck();switch(!t&&e.targetConnection&&(t=e.targetConnection.getCheck()),e.type){case eh.INPUT_VALUE:case eh.OUTPUT_VALUE:if(null!==(e=e.getSourceBlock().getOutputShape()))switch(e){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED}return t&&t.includes("Boolean")?this.HEXAGONAL:(t&&t.includes("Number")||t&&t.includes("String"),this.ROUNDED);case eh.PREVIOUS_STATEMENT:case eh.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}}makeNotch(){function e(e){return zs("c",[Ys(e*s/2,0),Ys(e*s*3/4,r/2),Ys(e*s,r)])+Zs([Ys(e*s,o)])+zs("c",[Ys(e*s/4,r/2),Ys(e*s/2,r),Ys(e*s,r)])+Qs("h",e*n)+zs("c",[Ys(e*s/2,0),Ys(e*s*3/4,-r/2),Ys(e*s,-r)])+Zs([Ys(e*s,-o)])+zs("c",[Ys(e*s/4,-r/2),Ys(e*s/2,-r),Ys(e*s,-r)])}const t=this.NOTCH_WIDTH,i=this.NOTCH_HEIGHT,n=t/3,s=n/3,o=i/2,r=o/2,a=e(1),l=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:i,pathLeft:a,pathRight:l}}makeInsideCorners(){const e=this.CORNER_RADIUS,t=eo("a","0 0,0",e,Ys(-e,e)),i=eo("a","0 0,1",e,Ys(-e,e));return{width:e,height:e,pathTop:t,pathBottom:eo("a","0 0,0",e,Ys(e,e)),rightWidth:e,rightHeight:e,pathTopRight:i,pathBottomRight:eo("a","0 0,1",e,Ys(e,e))}}generateSecondaryColour_(e){return pn("#000",e,.15)||e}generateTertiaryColour_(e){return pn("#000",e,.25)||e}createDom(e,t,i){super.createDom(e,t,i),e=ee(_l.DEFS,{},e),t=ee(_l.FILTER,{id:"blocklySelectedGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),ee(_l.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.SELECTED_GLOW_SIZE},t),i=ee(_l.FECOMPONENTTRANSFER,{result:"outBlur"},t),ee(_l.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},i),ee(_l.FEFLOOD,{"flood-color":this.SELECTED_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},t),ee(_l.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),this.selectedGlowFilterId=t.id,this.selectedGlowFilter=t,e=ee(_l.FILTER,{id:"blocklyReplacementGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),ee(_l.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.REPLACEMENT_GLOW_SIZE},e),t=ee(_l.FECOMPONENTTRANSFER,{result:"outBlur"},e),ee(_l.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),ee(_l.FEFLOOD,{"flood-color":this.REPLACEMENT_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},e),ee(_l.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),ee(_l.FECOMPOSITE,{in:"SourceGraphic",in2:"outGlow",operator:"over"},e),this.replacementGlowFilterId=e.id,this.replacementGlowFilter=e}getCSS_(e){return[`${e} .blocklyText,`,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyTextInputBubble textarea {`,"font-weight: normal;","}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,`${e} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"}",`${e} .blocklyNonEditableText>text,`,`${e} .blocklyEditableText>text,`,`${e} .blocklyNonEditableText>g>text,`,`${e} .blocklyEditableText>g>text {`,"fill: #575E75;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #575E75;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #575E75;","}",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>rect,",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>.blocklyPath {","stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"color: #575E75;","}",`${e} .blocklyDropdownText {`,"fill: #fff !important;","}",`${e}.blocklyWidgetDiv .goog-menuitem,`,`${e}.blocklyDropDownDiv .goog-menuitem {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e}.blocklyDropDownDiv .goog-menuitem-content {`,"color: #fff;","}",`${e} .blocklyHighlightedConnectionPath {`,`stroke: ${this.SELECTED_GLOW_COLOUR};`,"}",`${e} .blocklyDisabled > .blocklyOutlinePath {`,`fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,"}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},Mp=class extends ud{constructor(e,t){super(e,t)}draw(){const e=this.block_.pathObject;e.beginDrawing(),this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),e.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_(),this.info_.outputConnection&&(e.outputShapeType=this.info_.outputConnection.shape.type),e.endDrawing()}drawOutline_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):super.drawOutline_()}drawLeft_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?this.drawLeftDynamicConnection_():super.drawLeft_()}drawRightSideRow_(e){if(!(0>=e.height)){if(Uh.isSpacer(e)){const n=e.precedesStatement;var t=e.followsStatement;if(n||t){const s=this.constants_.INSIDE_CORNERS;var i=s.rightHeight;return i=e.height-(n?i:0),t=t?s.pathBottomRight:"",e=0<i?Qs("V",e.yPos+i):"",void(this.outlinePath_+=t+e+(n?s.pathTopRight:""))}}this.outlinePath_+=Qs("V",e.yPos+e.height)}}drawRightDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)}drawLeftDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.positionOutputConnection_(),this.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height),this.outlinePath_+="z"}drawFlatTop_(){const e=this.info_.topRow;this.positionPreviousConnection_(),this.outlinePath_+=qs(e.xPos,this.info_.startY),this.outlinePath_+=Qs("h",e.width)}drawFlatBottom_(){const e=this.info_.bottomRow;this.positionNextConnection_(),this.outlinePath_+=Qs("V",e.baseline),this.outlinePath_+=Qs("h",-e.width)}drawInlineInput_(e){this.positionInlineInputConnection_(e);const t=e.input.name;e.connectedBlock||this.info_.isInsertionMarker||(e=Ks(e.xPos+e.connectionWidth,e.centerline-e.height/2)+this.getInlineInputPath(e),this.block_.pathObject.setOutlinePath(t,e))}getInlineInputPath(e){const t=e.width-2*e.connectionWidth,i=e.height;return Qs("h",t)+e.shape.pathRightDown(i)+Qs("h",-t)+e.shape.pathUp(i)+"z"}drawStatementInput_(e){var t=e.getLastInput();const i=t.xPos+t.notchOffset+t.shape.width,n=this.constants_.INSIDE_CORNERS,s=t.shape.pathRight+Qs("h",-(t.notchOffset-n.width))+n.pathTop,o=e.height-2*n.height;t=n.pathBottom+Qs("h",t.notchOffset-n.width)+(t.connectedBottomNextConnection?"":t.shape.pathLeft),this.outlinePath_+=Qs("H",i)+s+Qs("v",o)+t+Qs("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}drawConnectionHighlightPath(e){const t=e.connectionModel;if(t.type===eh.NEXT_STATEMENT||t.type===eh.PREVIOUS_STATEMENT||t.type===eh.OUTPUT_VALUE&&!e.isDynamicShape)super.drawConnectionHighlightPath(e);else{e=t.type===eh.INPUT_VALUE?Ks(e.connectionWidth,-e.height/2)+this.getInlineInputPath(e):Ks(e.width,-e.height/2)+e.shape.pathDown(e.height);var i,n,s=t.getSourceBlock();null==(n=(i=s.pathObject).addConnectionHighlight)||n.call(i,t,e,t.getOffsetInBlock(),s.RTL)}}},Pp=class extends wu{constructor(e,t,i,n,s,o,r){if(super(wu.SKIP_SETUP),this.imageElement=this.clickHandler=null,this.flipRtl=this.isDirty_=this.EDITABLE=!1,this.altText="",i=Number(_n(i)),t=Number(_n(t)),isNaN(i)||isNaN(t))throw Error("Height and width values of an image field must cast to numbers.");if(0>=i||0>=t)throw Error("Height and width values of an image field must be greater than 0.");this.size_=new El(t,i+Pp.Y_PADDING),this.imageHeight=i,"function"==typeof s&&(this.clickHandler=s),e!==wu.SKIP_SETUP&&(r?this.configure_(r):(this.flipRtl=!!o,this.altText=_n(n)||""),this.setValue(_n(e)))}configure_(e){super.configure_(e),e.flipRtl&&(this.flipRtl=e.flipRtl),e.alt&&(this.altText=_n(e.alt))}initView(){this.imageElement=ee(_l.IMAGE,{height:this.imageHeight+"px",width:this.size_.width+"px",alt:this.altText},this.fieldGroup_),this.imageElement.setAttributeNS(dl,"xlink:href",this.value_),this.clickHandler&&(this.imageElement.style.cursor="pointer")}updateSize_(){}doClassValidation_(e){return"string"!=typeof e?null:e}doValueUpdate_(e){this.value_=e,this.imageElement&&this.imageElement.setAttributeNS(dl,"xlink:href",this.value_)}getFlipRtl(){return this.flipRtl}setAlt(e){e!==this.altText&&(this.altText=e||"",this.imageElement&&this.imageElement.setAttribute("alt",this.altText))}showEditor_(){this.clickHandler&&this.clickHandler(this)}setOnClickHandler(e){this.clickHandler=e}getText_(){return this.altText}static fromJson(e){if(!e.src||!e.width||!e.height)throw Error("src, width, and height values for an image field arerequired. The width and height must be non-zero.");return new this(e.src,e.width,e.height,void 0,void 0,void 0,e)}};Pp.Y_PADDING=1,Os("field_image",Pp),Pp.prototype.DEFAULT_VALUE="";var Bp=class extends wu{constructor(e,t,i){super(wu.SKIP_SETUP),this.spellcheck_=!0,this.htmlInput_=null,this.isTextValid_=this.isBeingEdited_=!1,this.onKeyInputWrapper_=this.onKeyDownWrapper_=this.valueWhenEditorWasOpened_=null,this.fullBlockClickTarget_=!1,this.workspace_=null,this.SERIALIZABLE=!0,this.CURSOR="text",e!==wu.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),void 0!==e.spellcheck&&(this.spellcheck_=e.spellcheck)}initView(){if(!this.getSourceBlock())throw new Lu;super.initView(),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot())}isFullBlockField(){const e=this.getSourceBlock();if(!e)throw new Lu;let t;return this.fullBlockClickTarget_=!(null==(t=this.getConstants())||!t.FULL_BLOCK_FIELDS)&&e.isSimpleReporter()}doValueInvalid_(e,t=!0){this.isBeingEdited_&&(this.isDirty_=!0,this.isTextValid_=!1,e=this.value_,this.value_=this.valueWhenEditorWasOpened_,this.sourceBlock_&&T()&&this.value_!==e&&t&&p(new(y(Hr.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock_,"field",this.name||null,e,this.value_)))}doValueUpdate_(e){this.isTextValid_=this.isDirty_=!0,this.value_=e}applyColour(){const e=this.getSourceBlock();if(!e)throw new Lu;this.getConstants().FULL_BLOCK_FIELDS&&this.fieldGroup_&&(!this.isFullBlockField()&&this.borderRect_?(this.borderRect_.style.display="block",this.borderRect_.setAttribute("stroke",e.style.colourTertiary)):(this.borderRect_.style.display="none",e.pathObject.svgPath.setAttribute("fill",this.getConstants().FIELD_BORDER_RECT_COLOUR)))}getSize(){let e;return null!=(e=this.getConstants())&&e.FULL_BLOCK_FIELDS&&(this.render_(),this.isDirty_=!1),super.getSize()}onLocationChange(){this.isBeingEdited_&&this.resizeEditor_()}render_(){if(super.render_(),this.isBeingEdited_){var e=this.htmlInput_;this.isTextValid_?(ne(e,"blocklyInvalidInput"),$t(e,Oc.INVALID,!1)):(te(e,"blocklyInvalidInput"),$t(e,Oc.INVALID,!0))}if(!(e=this.getSourceBlock()))throw new Lu;this.getConstants().FULL_BLOCK_FIELDS&&e.applyColour()}setSpellcheck(e){e!==this.spellcheck_&&(this.spellcheck_=e,this.htmlInput_&&this.htmlInput_.setAttribute("spellcheck",this.spellcheck_))}showEditor_(e,t=!1){this.workspace_=this.sourceBlock_.workspace,!t&&this.workspace_.options.modalInputs&&(Ja||Ya||za)?this.showPromptEditor_():this.showInlineEditor_(t)}showPromptEditor_(){qe(Hr.Msg$$module$build$src$core$msg.CHANGE_VALUE_TITLE,this.getText(),(e=>{null!==e&&this.setValue(this.getValueFromEditorText_(e)),this.onFinishEditing_(this.value_)}))}showInlineEditor_(e){const t=this.getSourceBlock();if(!t)throw new Lu;vn(this,t.RTL,this.widgetDispose_.bind(this),this.workspace_),this.htmlInput_=this.widgetCreate_(),this.isBeingEdited_=!0,this.valueWhenEditorWasOpened_=this.value_,e||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())}widgetCreate_(){var e=this.getSourceBlock();if(!e)throw new Lu;Hr.setGroup$$module$build$src$core$events$utils(!0);const t=bn();var i=this.getClickTarget_();if(!i)throw Error("A click target has not been set.");te(i,"editing"),(i=document.createElement("input")).className="blocklyHtmlInput",i.setAttribute("spellcheck",this.spellcheck_);const n=this.workspace_.getScale();var s=this.getConstants().FIELD_TEXT_FONTSIZE*n+"pt";return t.style.fontSize=s,i.style.fontSize=s,s=Bp.BORDERRADIUS*n+"px",this.isFullBlockField()&&(s=((s=this.getScaledBBox()).bottom-s.top)/2+"px",e=e.getParent()?e.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary,i.style.border=1*n+"px solid "+e,t.style.borderRadius=s,t.style.transition="box-shadow 0.25s ease 0s",this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW&&(t.style.boxShadow="rgba(255, 255, 255, 0.3) 0 0 0 "+4*n+"px")),i.style.borderRadius=s,t.appendChild(i),i.value=i.defaultValue=this.getEditorText_(this.value_),i.setAttribute("data-untyped-default-value",String(this.value_)),this.resizeEditor_(),this.bindInputEvents_(i),i}widgetDispose_(){this.isBeingEdited_=!1,this.isTextValid_=!0,this.forceRerender(),this.onFinishEditing_(this.value_),this.sourceBlock_&&T()&&null!==this.valueWhenEditorWasOpened_&&this.valueWhenEditorWasOpened_!==this.value_&&(p(new(y(Hr.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock_,"field",this.name||null,this.valueWhenEditorWasOpened_,this.value_)),this.valueWhenEditorWasOpened_=null),Hr.setGroup$$module$build$src$core$events$utils(!1),this.unbindInputEvents_();var e=bn().style;if(e.width="auto",e.height="auto",e.fontSize="",e.transition="",e.boxShadow="",this.htmlInput_=null,!(e=this.getClickTarget_()))throw Error("A click target has not been set.");ne(e,"editing")}onFinishEditing_(e){}bindInputEvents_(e){this.onKeyDownWrapper_=j(e,"keydown",this,this.onHtmlInputKeyDown_),this.onKeyInputWrapper_=j(e,"input",this,this.onHtmlInputChange_)}unbindInputEvents_(){this.onKeyDownWrapper_&&(X(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null),this.onKeyInputWrapper_&&(X(this.onKeyInputWrapper_),this.onKeyInputWrapper_=null)}onHtmlInputKeyDown_(e){"Enter"===e.key?(On(this),Ai()):"Escape"===e.key?(this.setValue(this.htmlInput_.getAttribute("data-untyped-default-value"),!1),On(this),Ai()):"Tab"===e.key&&(On(this),Ai(),this.sourceBlock_.tab(this,!e.shiftKey),e.preventDefault())}onHtmlInputChange_(e){e=this.value_,this.setValue(this.getValueFromEditorText_(this.htmlInput_.value),!1),this.sourceBlock_&&T()&&this.value_!==e&&p(new(y(Jr))(this.sourceBlock_,this.name||null,e,this.value_))}setEditorValue_(e,t=!0){this.isDirty_=!0,this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(e)),this.setValue(e,t)}resizeEditor_(){var e=this.getSourceBlock();if(!e)throw new Lu;const t=bn(),i=this.getScaledBBox();t.style.width=i.right-i.left+"px",t.style.height=i.bottom-i.top+"px",e=new cl(e.RTL?i.right-t.offsetWidth:i.left,i.top),t.style.left=e.x+"px",t.style.top=e.y+"px"}repositionForWindowResize(){const e=this.getSourceBlock();return e instanceof ep&&(Do(this.workspace_,this.workspace_.getMetricsManager().getViewMetrics(!0),e)||this.resizeEditor_(),!0)}isTabNavigable(){return!0}getText_(){return this.isBeingEdited_&&this.htmlInput_?this.htmlInput_.value:null}getEditorText_(e){return`${e}`}getValueFromEditorText_(e){return e}};Bp.BORDERRADIUS=4;var Fp=class extends Bp{constructor(e,t,i){super(e,t,i)}doClassValidation_(e){return void 0===e?null:`${e}`}static fromJson(e){return new this(_n(e.text),void 0,e)}};Os("field_input",Fp),Fp.prototype.DEFAULT_VALUE="";var Up=class extends Vh{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){return!!e.outputConnection}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},Hp=class extends Zh{constructor(e,t){if(super(e,t),this.connectedBottomNextConnection=!1,this.connectedBlock){for(e=this.connectedBlock;t=e.getNextBlock();)e=t;e.nextConnection||(this.height=this.connectedBlockHeight,this.connectedBottomNextConnection=!0)}}},Gp=class extends Hh{constructor(e){super(e),this.width=this.height=0,this.type|=Uh.getType("RIGHT_CONNECTION")}},Vp=class extends ad{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){const t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection;return!!e.outputConnection||t}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},jp=class extends fd{constructor(e,t){super(e,t),this.isInline=!0,this.renderer_=e,this.constants_=this.renderer_.getConstants(),this.topRow=new Vp(this.constants_),this.bottomRow=new Up(this.constants_),this.isMultiRow=!t.getInputsInline()||t.isCollapsed(),this.hasStatementInput=0<t.statementInputCount,this.rightSide=this.outputConnection?new Gp(this.constants_):null,this.rightAlignedDummyInputs=new WeakMap}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.adjustXPosition_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}shouldStartNewRow_(e,t){return!!t&&(t instanceof gd||e instanceof md||t instanceof md||(e instanceof Hr.ValueInput$$module$build$src$core$inputs$value_input||e instanceof pd||e instanceof gd)&&(!this.isInline||this.isMultiRow))}getDesiredRowWidth_(e){return e.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):super.getDesiredRowWidth_(e)}getInRowSpacing_(e,t){return e&&t||!this.outputConnection||!this.outputConnection.isDynamicShape||this.hasStatementInput||this.bottomRow.hasNextConnection?!e&&t&&Uh.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:e&&Uh.isLeftRoundedCorner(e)&&t&&(Uh.isPreviousConnection(t)||Uh.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:e&&Uh.isLeftSquareCorner(e)&&t&&Uh.isHat(t)?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING}getSpacerRowHeight_(e,t){if(Uh.isTopRow(e)&&Uh.isBottomRow(t))return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;const i=Uh.isInputRow(e)&&e.hasStatement,n=Uh.isInputRow(t)&&t.hasStatement;return n||i?(e=Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0),n&&i?Math.max(e,this.constants_.DUMMY_INPUT_MIN_HEIGHT):e):Uh.isTopRow(e)?e.hasPreviousConnection||this.outputConnection&&!this.hasStatementInput?this.constants_.NO_PADDING:Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):Uh.isBottomRow(t)?this.outputConnection?!t.hasNextConnection&&this.hasStatementInput?Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):this.constants_.NO_PADDING:Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}getSpacerRowWidth_(e,t){const i=this.width-this.startX;return Uh.isInputRow(e)&&e.hasStatement||Uh.isInputRow(t)&&t.hasStatement?Math.max(i,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):i}getElemCenterline_(e,t){if(e.hasStatement&&!Uh.isSpacer(t)&&!Uh.isStatementInput(t))return e.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2;if(Uh.isInlineInput(t)&&t instanceof Wh){const i=t.connectedBlock;if(i&&i.outputConnection&&i.nextConnection)return e.yPos+i.height/2}return super.getElemCenterline_(e,t)}addInput_(e,t){if((e instanceof pd||e instanceof gd)&&t.hasDummyInput&&t.align===Hr.Align$$module$build$src$core$inputs$align.LEFT&&e.align===Hr.Align$$module$build$src$core$inputs$align.RIGHT)this.rightAlignedDummyInputs.set(t,e);else if(e instanceof md)return t.elements.push(new Hp(this.constants_,e)),t.hasStatement=!0,void(null===t.align&&(t.align=e.align));super.addInput_(e,t)}addAlignmentPadding_(e,t){if(this.rightAlignedDummyInputs.get(e)){let i;for(let t=0;t<e.elements.length;t++){const n=e.elements[t];if(Uh.isSpacer(n)&&(i=n),Uh.isField(n)&&n instanceof Yh&&n.parentInput===this.rightAlignedDummyInputs.get(e))break}if(i)return i.width+=t,void(e.width+=t)}super.addAlignmentPadding_(e,t)}adjustXPosition_(){const e=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH;let t=e;for(let s=2;s<this.rows.length-1;s+=2){var i=this.rows[s-1];const o=this.rows[s];var n=this.rows[s+1];if(i=2===s?!!this.topRow.hasPreviousConnection:!!i.followsStatement,n=s+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!n.precedesStatement,Uh.isInputRow(o)&&o.hasStatement){let i,n;o.measure(),t=o.width-(null!=(n=null==(i=o.getLastInput())?void 0:i.width)?n:0)+e}else if(i&&(2===s||n)&&Uh.isInputRow(o)&&!o.hasStatement){n=o.xPos,i=null;for(let e=0;e<o.elements.length;e++){const s=o.elements[e];Uh.isSpacer(s)&&(i=s),i&&(Uh.isField(s)||Uh.isInput(s))&&n<t&&!(Uh.isField(s)&&s instanceof Yh&&(s.field instanceof hd||s.field instanceof Pp))&&(i.width+=t-n),n+=s.width}}}}finalizeOutputConnection_(){if(this.outputConnection&&this.outputConnection.isDynamicShape){var e=this.outputConnection.shape;if("isDynamic"in e&&e.isDynamic){for(var t=0,i=0;i<this.rows.length;i++){const e=this.rows[i];e.yPos=t,t+=e.height}this.height=t,i=this.bottomRow.hasNextConnection?this.height-this.bottomRow.descenderHeight:this.height,t=e.height(i),i=e.width(i),this.outputConnection.height=t,this.outputConnection.width=i,this.outputConnection.startX=i,this.outputConnection.connectionOffsetY=e.connectionOffsetY(t),this.outputConnection.connectionOffsetX=e.connectionOffsetX(i),e=0,this.hasStatementInput||this.bottomRow.hasNextConnection||(e=i,this.rightSide.height=t,this.rightSide.width=e,this.rightSide.centerline=t/2,this.rightSide.xPos=this.width+e),this.startX=i,this.width+=i+e,this.widthWithChildren+=i+e}}}finalizeHorizontalAlignment_(){if(this.outputConnection&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){for(var e=0,t=0;t<this.rows.length;t++){var i=this.rows[t];if(!Uh.isInputRow(i))continue;e=i.elements[i.elements.length-2];let n=this.getNegativeSpacing_(i.elements[1]),s=this.getNegativeSpacing_(e);e=n+s;const o=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-e<o&&(n=(e=this.width-o)/2,s=e/2),i.elements.unshift(new qh(this.constants_,-n)),i.elements.push(new qh(this.constants_,-s))}if(e)for(this.width-=e,this.widthWithChildren-=e,this.rightSide.xPos-=e,t=0;t<this.rows.length;t++)i=this.rows[t],Uh.isTopOrBottomRow(i)&&(i.elements[1].width-=e),i.width-=e,i.widthWithConnectedBlocks-=e}}getNegativeSpacing_(e){if(!e||!this.outputConnection)return 0;const t=this.outputConnection.width;var i=this.outputConnection.shape.type;const n=this.constants_;if(1<this.inputRows.length)switch(i){case n.SHAPES.ROUND:return i=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,t-(i=this.height/2>i?i:this.height/2)*(1-Math.sin(Math.acos((i-this.constants_.SMALL_PADDING)/i)));default:return 0}if(Uh.isInlineInput(e)&&e instanceof Wh){const s=e.connectedBlock;return null==(e=s?s.pathObject.outputShapeType:e.shape.type)||s&&s.outputConnection&&(s.statementInputCount||s.nextConnection)||i===n.SHAPES.HEXAGONAL&&i!==e?0:t-this.constants_.SHAPE_IN_SHAPE_PADDING[i][e]}return Uh.isField(e)&&e instanceof Yh?i===n.SHAPES.ROUND&&e.field instanceof Fp?t-2.75*n.GRID_UNIT:t-this.constants_.SHAPE_IN_SHAPE_PADDING[i][0]:Uh.isIcon(e)?this.constants_.SMALL_PADDING:0}finalizeVerticalAlignment_(){if(!this.outputConnection)for(let n=2;n<this.rows.length-1;n+=2){const s=this.rows[n-1],o=this.rows[n],r=this.rows[n+1];var e=2===n,t=n+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!r.precedesStatement;if(e?this.topRow.hasPreviousConnection:s.followsStatement){var i=o.elements[1];if(i=3===o.elements.length&&i instanceof Yh&&(i.field instanceof hd||i.field instanceof Pp),!e&&i)s.height-=this.constants_.SMALL_PADDING,r.height-=this.constants_.SMALL_PADDING,o.height-=this.constants_.MEDIUM_PADDING;else if(e||t){if(t){for(e=!1,t=0;t<o.elements.length;t++)if((i=o.elements[t])instanceof Wh&&Uh.isInlineInput(i)&&i.connectedBlock&&!i.connectedBlock.isShadow()&&40<=i.connectedBlock.getHeightWidth().height){e=!0;break}e&&(s.height-=this.constants_.SMALL_PADDING,r.height-=this.constants_.SMALL_PADDING)}}else s.height+=this.constants_.SMALL_PADDING}}}finalize_(){this.finalizeOutputConnection_(),this.finalizeHorizontalAlignment_(),this.finalizeVerticalAlignment_(),super.finalize_(),this.rightSide&&(this.widthWithChildren+=this.rightSide.width)}},Wp=class extends vd{constructor(e,t,i){super(e,t,i),this.markerCircle=null}showWithInputOutput(e){const t=e.getSourceBlock();e=e.getLocation().getOffsetInBlock(),this.positionCircle(e.x,e.y),this.setParent_(t),this.showCurrent_()}showWithOutput_(e){this.showWithInputOutput(e)}showWithInput_(e){this.showWithInputOutput(e)}showWithBlock_(e){const t=(e=e.getLocation()).getHeightWidth();this.positionRect_(0,0,t.width,t.height),this.setParent_(e),this.showCurrent_()}positionCircle(e,t){let i,n;null==(i=this.markerCircle)||i.setAttribute("cx",`${e}`),null==(n=this.markerCircle)||n.setAttribute("cy",`${t}`),this.currentMarkerSvg=this.markerCircle}hide(){super.hide(),this.markerCircle&&(this.markerCircle.style.display="none")}createDomInternal_(){if(super.createDomInternal_(),this.markerCircle=ee(_l.CIRCLE,{r:this.constants_.CURSOR_RADIUS,"stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const e=this.getBlinkProperties_();ee(_l.ANIMATE,e,this.markerCircle)}return this.markerSvg_}applyColour_(e){let t,i;if(super.applyColour_(e),null==(t=this.markerCircle)||t.setAttribute("fill",this.colour_),null==(i=this.markerCircle)||i.setAttribute("stroke",this.colour_),this.isCursor()){let t;e=this.colour_+";transparent;transparent;",null==(t=this.markerCircle)||t.firstElementChild.setAttribute("values",e)}}},Xp=class extends Cd{constructor(e,t,i){super(e,t,i),this.svgPathSelected=null,this.outlines=new Map,this.remainingOutlines=new Set,this.outputShapeType=null,this.constants=i}setPath(e){super.setPath(e),this.svgPathSelected&&this.svgPathSelected.setAttribute("d",e)}applyColour(e){super.applyColour(e);const t=e.getParent();e.isShadow()&&t&&this.svgPath.setAttribute("stroke",t.style.colourTertiary);for(const e of this.outlines.values())e.setAttribute("fill",this.style.colourTertiary)}flipRTL(){super.flipRTL();for(const e of this.outlines.values())e.setAttribute("transform","scale(-1 1)")}updateSelected(e){this.setClass_("blocklySelected",e),e?this.svgPathSelected||(this.svgPathSelected=this.svgPath.cloneNode(!0),this.svgPathSelected.setAttribute("fill","none"),this.svgPathSelected.setAttribute("filter","url(#"+this.constants.selectedGlowFilterId+")"),this.svgRoot.appendChild(this.svgPathSelected)):this.svgPathSelected&&(this.svgRoot.removeChild(this.svgPathSelected),this.svgPathSelected=null)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e),e?this.svgPath.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):this.svgPath.removeAttribute("filter")}updateShapeForInputHighlight(e,t){e=e.getParentInput().name,(e=this.getOutlinePath(e))&&(t?e.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):e.removeAttribute("filter"))}beginDrawing(){this.remainingOutlines.clear();for(const e of this.outlines.keys())this.remainingOutlines.add(e)}endDrawing(){if(this.remainingOutlines.size)for(const e of this.remainingOutlines)this.removeOutlinePath(e);this.remainingOutlines.clear()}setOutlinePath(e,t){(e=this.getOutlinePath(e)).setAttribute("d",t),e.setAttribute("fill",this.style.colourTertiary)}getOutlinePath(e){return this.outlines.has(e)||this.outlines.set(e,ee(_l.PATH,{class:"blocklyOutlinePath",d:""},this.svgRoot)),this.remainingOutlines.delete(e),this.outlines.get(e)}removeOutlinePath(e){let t,i;null==(t=this.outlines.get(e))||null==(i=t.parentNode)||i.removeChild(this.outlines.get(e)),this.outlines.delete(e)}},Yp=class extends Ad{constructor(e){super(e)}makeConstants_(){return new Dp}makeRenderInfo_(e){return new jp(this,e)}makeDrawer_(e,t){return new Mp(e,t)}makeMarkerDrawer(e,t){return new Wp(e,this.getConstants(),t)}makePathObject(e,t){return new Xp(e,t,this.getConstants())}getConstants(){return this.constants_}getConnectionPreviewMethod(e,t,i){return Xs("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),t.type===eh.OUTPUT_VALUE?e.isConnected()?kd.PREVIEW_TYPE.REPLACEMENT_FADE:kd.PREVIEW_TYPE.INPUT_OUTLINE:super.getConnectionPreviewMethod(e,t,i)}};vo("zelos",Yp);var zp=class{constructor(e){this.staticConn=this.draggedConn=this.markerConn=this.fadedBlock=null,this.workspace=e.workspace}previewReplacement(e,t,i){Hr.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.fadedBlock=i,i.fadeForReplacement(!0),this.workspace.getRenderer().shouldHighlightConnection(t)&&(t.highlight(),this.staticConn=t)}finally{Hr.enable$$module$build$src$core$events$utils()}}previewConnection(e,t){if(e!==this.draggedConn||t!==this.staticConn){Hr.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.shouldUseMarkerPreview(e,t)&&(this.markerConn=this.previewMarker(e,t)),this.workspace.getRenderer().shouldHighlightConnection(t)&&t.highlight(),this.draggedConn=e,this.staticConn=t}finally{Hr.enable$$module$build$src$core$events$utils()}}}shouldUseMarkerPreview(e,t){return t.type===eh.PREVIOUS_STATEMENT||t.type===eh.NEXT_STATEMENT||!(this.workspace.getRenderer()instanceof Yp)}previewMarker(e,t){const i=e.getSourceBlock(),n=this.createInsertionMarker(i),s=this.getMatchingConnection(i,n,e);if(!s)return null;n.queueRender(),Tt(),s.connect(t);const o={x:t.x-s.x,y:t.y-s.y},r=s.getOffsetInBlock().clone();return _t().then((()=>{if(!n.isDeadOrDying()){Hr.disable$$module$build$src$core$events$utils();try{null==n||n.positionNearConnection(s,o,r),null==n||n.getSvgRoot().setAttribute("visibility","visible")}finally{Hr.enable$$module$build$src$core$events$utils()}}})),s}createInsertionMarker(e){const t=Mt(e,{addCoordinates:!1,addInputBlocks:!1,addNextBlocks:!1,doFullSerialization:!1});if(!t)throw Error(`Failed to serialize source block. ${e.toDevString()}`);e=Wt(t,this.workspace);for(const t of e.getDescendants(!1))t.setInsertionMarker(!0);return e.initSvg(),e.getSvgRoot().setAttribute("visibility","hidden"),e}getMatchingConnection(e,t,i){if(e=e.getConnections_(!0),t=t.getConnections_(!0),e.length!==t.length)return null;for(let n=0;n<e.length;n++)if(e[n]===i)return t[n];return null}hidePreview(){Hr.disable$$module$build$src$core$events$utils();try{this.staticConn&&(this.staticConn.unhighlight(),this.staticConn=null),this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null),this.markerConn&&(this.hideInsertionMarker(this.markerConn),this.draggedConn=this.markerConn=null)}finally{Hr.enable$$module$build$src$core$events$utils()}}hideInsertionMarker(e){const t=e.getSourceBlock(),i=t.outputConnection;let n;if(null!=(n=t.previousConnection)&&n.targetConnection||null!=i&&i.targetConnection)t.unplug(!0);else{let t;null==(t=e.targetBlock())||t.unplug(!1)}t.dispose()}dispose(){this.hidePreview()}};t(Xr.CONNECTION_PREVIEWER,Wr,zp);var Kp={};Kp.Align=Hr.Align$$module$build$src$core$inputs$align,Kp.DummyInput=pd,Kp.EndRowInput=gd,Kp.Input=dd,Kp.StatementInput=md,Kp.ValueInput=Hr.ValueInput$$module$build$src$core$inputs$value_input,Kp.inputTypes=Hr.inputTypes$$module$build$src$core$inputs$input_types;var qp=!1;Hr.CodeGenerator$$module$build$src$core$generator=class{constructor(e){this.forBlock=Object.create(null),this.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",this.STATEMENT_SUFFIX=this.STATEMENT_PREFIX=this.INFINITE_LOOP_TRAP=null,this.INDENT="  ",this.COMMENT_WRAP=60,this.ORDER_OVERRIDES=[],this.isInitialized=null,this.RESERVED_WORDS_="",this.definitions_=Object.create(null),this.functionNames_=Object.create(null),this.nameDB_=void 0,this.name_=e,this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")}workspaceToCode(e){e||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),e=A());var t=[];this.init(e),e=e.getTopBlocks(!0);for(let i,n=0;i=e[n];n++){let e=this.blockToCode(i);Array.isArray(e)&&(e=e[0]),e&&(i.outputConnection&&(e=this.scrubNakedValue(e),this.STATEMENT_PREFIX&&!i.suppressPrefixSuffix&&(e=this.injectId(this.STATEMENT_PREFIX,i)+e),this.STATEMENT_SUFFIX&&!i.suppressPrefixSuffix&&(e+=this.injectId(this.STATEMENT_SUFFIX,i))),t.push(e))}return t=t.join("\n"),(t=(t=(t=this.finish(t)).replace(/^\s+\n/,"")).replace(/\n\s+$/,"\n")).replace(/[ \t]+\n/g,"\n")}prefixLines(e,t){return t+e.replace(/(?!\n$)\n/g,"\n"+t)}allNestedComments(e){const t=[];e=e.getDescendants(!0);for(let i=0;i<e.length;i++){const n=e[i].getCommentText();n&&t.push(n)}return t.length&&t.push(""),t.join("\n")}blockToCode(e,t){if(!1===this.isInitialized&&console.warn("CodeGenerator init was not called before blockToCode was called."),!e)return"";if(!e.isEnabled())return t?"":this.blockToCode(e.getNextBlock());if(e.isInsertionMarker())return t?"":this.blockToCode(e.getChildren(!1)[0]);var i=this.forBlock[e.type];if("function"!=typeof i)throw Error(`${this.name_} generator does not know how to generate code for block type "${e.type}".`);if(i=i.call(e,e,this),Array.isArray(i)){if(!e.outputConnection)throw TypeError("Expecting string from statement block: "+e.type);return[this.scrub_(e,i[0],t),i[1]]}if("string"==typeof i)return this.STATEMENT_PREFIX&&!e.suppressPrefixSuffix&&(i=this.injectId(this.STATEMENT_PREFIX,e)+i),this.STATEMENT_SUFFIX&&!e.suppressPrefixSuffix&&(i+=this.injectId(this.STATEMENT_SUFFIX,e)),this.scrub_(e,i,t);if(null===i)return"";throw SyntaxError("Invalid code generated: "+i)}valueToCode(e,t,i){if(isNaN(i))throw TypeError("Expecting valid order from block: "+e.type);var n=e.getInputTargetBlock(t);if(!n&&!e.getInput(t))throw ReferenceError(`Input "${t}" doesn't exist on "${e.type}"`);if(!n)return"";if(""===(t=this.blockToCode(n)))return"";if(!Array.isArray(t))throw TypeError(`Expecting tuple from value block: ${n.type} See developers.google.com/blockly/guides/create-custom-blocks/generating-code for more information`);if(e=t[0],t=t[1],isNaN(t))throw TypeError("Expecting valid order from value block: "+n.type);if(!e)return"";n=!1;var s=Math.floor(i);const o=Math.floor(t);if(s<=o&&(s!==o||0!==s&&99!==s))for(n=!0,s=0;s<this.ORDER_OVERRIDES.length;s++)if(this.ORDER_OVERRIDES[s][0]===i&&this.ORDER_OVERRIDES[s][1]===t){n=!1;break}return n&&(e="("+e+")"),e}statementToCode(e,t){const i=e.getInputTargetBlock(t);if(!i&&!e.getInput(t))throw ReferenceError(`Input "${t}" doesn't exist on "${e.type}"`);if("string"!=typeof(e=this.blockToCode(i)))throw TypeError("Expecting code from statement block: "+(i&&i.type));return e&&(e=this.prefixLines(e,this.INDENT)),e}addLoopTrap(e,t){return this.INFINITE_LOOP_TRAP&&(e=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,t),this.INDENT)+e),this.STATEMENT_SUFFIX&&!t.suppressPrefixSuffix&&(e=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+e),this.STATEMENT_PREFIX&&!t.suppressPrefixSuffix&&(e+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,t),this.INDENT)),e}injectId(e,t){return t=t.id.replace(/\$/g,"$$$$"),e.replace(/%1/g,"'"+t+"'")}addReservedWords(e){this.RESERVED_WORDS_+=e+","}provideFunction_(e,t){if(!this.definitions_[e]){const i=this.nameDB_.getDistinctName(e,Hr.NameType$$module$build$src$core$names.PROCEDURE);let n;for(this.functionNames_[e]=i,Array.isArray(t)&&(t=t.join("\n")),t=t.trim().replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,i);n!==t;)n=t,t=t.replace(/^(( {2})*) {2}/gm,"$1\0");t=t.replace(/\0/g,this.INDENT),this.definitions_[e]=t}return this.functionNames_[e]}getVariableName(e){return this.getName(e,Hr.NameType$$module$build$src$core$names.VARIABLE)}getProcedureName(e){return this.getName(e,Hr.NameType$$module$build$src$core$names.PROCEDURE)}getName(e,t){if(!this.nameDB_)throw Error("Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.");return this.nameDB_.getName(e,t)}init(e){this.definitions_=Object.create(null),this.functionNames_=Object.create(null)}scrub_(e,t,i){return t}finish(e){return this.definitions_=Object.create(null),this.functionNames_=Object.create(null),e}scrubNakedValue(e){return e}},Hr.CodeGenerator$$module$build$src$core$generator;var Jp,Zp=class extends $p{constructor(e,t){super(e),this.flyout_=t}getBoundingBox_(){let e;try{e=this.workspace_.getCanvas().getBBox()}catch(t){e={height:0,y:0,width:0,x:0}}return e}getContentMetrics(e){const t=this.getBoundingBox_();return e=e?1:this.workspace_.scale,{height:t.height*e,width:t.width*e,top:t.y*e,left:t.x*e}}getScrollMetrics(e,t,i){return t=i||this.getContentMetrics(),i=this.flyout_.MARGIN*this.workspace_.scale,e=e?this.workspace_.scale:1,{height:(t.height+2*i)/e,width:(t.width+t.left+i)/e,top:0,left:0}}};!function(e){e.BLOCK="block",e.BUTTON="button"}(Jp||(Jp={}));var Qp=class extends ip{constructor(e){super(),this.horizontalLayout=!1,this.boundEvents=[],this.filterWrapper=this.reflowWrapper=null,this.mats=[],this.buttons_=[],this.contents=[],this.listeners=[],this.permanentlyDisabled=[],this.recycledBlocks=[],this.autoClose=!0,this.isVisible_=!1,this.containerVisible=!0,this.CORNER_RADIUS=8,this.SCROLLBAR_MARGIN=2.5,this.height_=this.width_=0,this.dragAngleRange_=70,this.svgGroup_=this.svgBackground_=null,e.setMetrics=this.setMetrics_.bind(this),this.workspace_=new Fd(e),this.workspace_.setMetricsManager(new Zp(this.workspace_,this)),this.workspace_.internalIsFlyout=!0,this.workspace_.setVisible(this.isVisible_),this.id=h(),this.RTL=!!e.RTL,this.toolboxPosition_=e.toolboxPosition,this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH,this.rectMap_=new WeakMap,this.MARGIN=this.CORNER_RADIUS,this.GAP_X=3*this.MARGIN,this.GAP_Y=3*this.MARGIN}createDom(e){return this.svgGroup_=ee(e,{class:"blocklyFlyout"}),this.svgGroup_.style.display="none",this.svgBackground_=ee(_l.PATH,{class:"blocklyFlyoutBackground"},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutBackgroundColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutOpacity","fill-opacity"),this.svgGroup_}init(e){this.targetWorkspace=e,this.workspace_.targetWorkspace=e,this.workspace_.scrollbar=new xp(this.workspace_,this.horizontalLayout,!this.horizontalLayout,"blocklyFlyoutScrollbar",this.SCROLLBAR_MARGIN),this.hide(),this.boundEvents.push(j(this.svgGroup_,"wheel",this,this.wheel_)),this.filterWrapper=this.filterForCapacity.bind(this),this.targetWorkspace.addChangeListener(this.filterWrapper),this.boundEvents.push(j(this.svgBackground_,"pointerdown",this,this.onMouseDown)),this.workspace_.getGesture=this.targetWorkspace.getGesture.bind(this.targetWorkspace),this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap()),this.workspace_.createPotentialVariableMap(),e.getComponentManager().addComponent({component:this,weight:1,capabilities:[sl.Capability.AUTOHIDEABLE,sl.Capability.DELETE_AREA,sl.Capability.DRAG_TARGET]})}dispose(){this.hide(),this.targetWorkspace.getComponentManager().removeComponent(this.id);for(const e of this.boundEvents)X(e);this.boundEvents.length=0,this.filterWrapper&&this.targetWorkspace.removeChangeListener(this.filterWrapper),this.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.dispose()),this.svgGroup_&&oe(this.svgGroup_)}getWidth(){return this.width_}getHeight(){return this.height_}getFlyoutScale(){return this.targetWorkspace.scale}getWorkspace(){return this.workspace_}setAutoClose(e){this.autoClose=e,this.targetWorkspace.recordDragTargets(),this.targetWorkspace.resizeContents()}autoHide(e){!e&&this.targetWorkspace.getFlyout(!0)===this&&this.autoClose&&this.hide()}getTargetWorkspace(){return this.targetWorkspace}isVisible(){return this.isVisible_}setVisible(e){const t=e!==this.isVisible();this.isVisible_=e,t&&(this.autoClose||this.targetWorkspace.recordDragTargets(),this.updateDisplay())}setContainerVisible(e){const t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay()}getContents(){return this.contents}setContents(e){this.contents=e}updateDisplay(){let e,t;e=!!this.containerVisible&&this.isVisible(),this.svgGroup_&&(this.svgGroup_.style.display=e?"block":"none"),null==(t=this.workspace_.scrollbar)||t.setContainerVisible(e)}positionAt_(e,t,i,n){let s,o;null==(s=this.svgGroup_)||s.setAttribute("width",`${e}`),null==(o=this.svgGroup_)||o.setAttribute("height",`${t}`),this.workspace_.setCachedParentSvgSize(e,t),this.svgGroup_&&ae(this.svgGroup_,"translate("+i+"px,"+n+"px)"),(e=this.workspace_.scrollbar)&&(e.setOrigin(i,n),e.resize(),e.hScroll&&e.hScroll.setPosition(e.hScroll.position.x,e.hScroll.position.y),e.vScroll&&e.vScroll.setPosition(e.vScroll.position.x,e.vScroll.position.y))}hide(){if(this.isVisible()){this.setVisible(!1);for(const e of this.listeners)X(e);this.listeners.length=0,this.reflowWrapper&&(this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowWrapper=null)}}show(e){this.workspace_.setResizesEnabled(!1),this.hide(),this.clearOldBlocks(),"string"==typeof e&&(e=this.getDynamicCategoryContents(e)),this.setVisible(!0),e=$e(e),e=this.createFlyoutInfo(e),Tt(this.workspace_),this.setContents(e.contents),this.layout_(e.contents,e.gaps),this.horizontalLayout?this.height_=0:this.width_=0,this.workspace_.setResizesEnabled(!0),this.reflow(),this.filterForCapacity(),this.position(),this.reflowWrapper=this.reflow.bind(this),this.workspace_.addChangeListener(this.reflowWrapper),this.emptyRecycledBlocks()}createFlyoutInfo(e){const t=[],i=[];this.permanentlyDisabled.length=0;const n=this.horizontalLayout?this.GAP_X:this.GAP_Y;for(const s of e){if("custom"in s){e=this.getDynamicCategoryContents(s.custom),e=$e(e);const{contents:n,gaps:o}=this.createFlyoutInfo(e);t.push(...n),i.push(...o)}switch(s.kind.toUpperCase()){case"BLOCK":e=s;const o=this.createFlyoutBlock(e);t.push({type:Jp.BLOCK,block:o}),this.addBlockGap(e,i,n);break;case"SEP":this.addSeparatorGap(s,i,n);break;case"LABEL":e=this.createButton(s,!0),t.push({type:Jp.BUTTON,button:e}),i.push(n);break;case"BUTTON":e=this.createButton(s,!1),t.push({type:Jp.BUTTON,button:e}),i.push(n)}}return{contents:t,gaps:i}}getDynamicCategoryContents(e){if("function"!=typeof(e=this.workspace_.targetWorkspace.getToolboxCategoryCallback(e)))throw TypeError("Couldn't find a callback function when opening a toolbox category.");return e(this.workspace_.targetWorkspace)}createButton(e,t){return new bd(this.workspace_,this.targetWorkspace,e,t)}createFlyoutBlock(e){let t;return e.blockxml?(e="string"==typeof e.blockxml?Hr.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,(t=this.getRecycledBlock(e.getAttribute("type")))||(t=is(e,this.workspace_))):(t=this.getRecycledBlock(e.type))||(void 0===e.enabled&&(e.enabled="true"!==e.disabled&&!0!==e.disabled),void 0===e.disabledReasons&&!1===e.enabled&&(e.disabledReasons=[Yl]),t=Xt(e,this.workspace_)),t.isEnabled()||this.permanentlyDisabled.push(t),t}getRecycledBlock(e){let t=-1;for(let i=0;i<this.recycledBlocks.length;i++)if(this.recycledBlocks[i].type===e){t=i;break}return-1===t?void 0:this.recycledBlocks.splice(t,1)[0]}addBlockGap(e,t,i){let n;e.gap?n=parseInt(String(e.gap)):e.blockxml&&(e="string"==typeof e.blockxml?Hr.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,n=parseInt(e.getAttribute("gap"))),t.push(!n||isNaN(n)?i:n)}addSeparatorGap(e,t,i){e=parseInt(String(e.gap)),!isNaN(e)&&0<t.length?t[t.length-1]=e:t.push(i)}clearOldBlocks(){var e=this.workspace_.getTopBlocks(!1);for(let t,i=0;t=e[i];i++)this.blockIsRecyclable_(t)?this.recycleBlock(t):t.dispose(!1,!1);for(e=0;e<this.mats.length;e++){const t=this.mats[e];t&&(Xi(t),oe(t))}this.mats.length=0;for(let e,t=0;e=this.buttons_[t];t++)e.dispose();let t;this.buttons_.length=0,null==(t=this.workspace_.getPotentialVariableMap())||t.clear()}emptyRecycledBlocks(){for(let e=0;e<this.recycledBlocks.length;e++)this.recycledBlocks[e].dispose();this.recycledBlocks=[]}blockIsRecyclable_(e){return!1}recycleBlock(e){const t=e.getRelativeToSurfaceXY();e.moveBy(-t.x,-t.y),this.recycledBlocks.push(e)}addBlockListeners_(e,t,i){this.listeners.push(j(e,"pointerdown",null,this.blockMouseDown(t))),this.listeners.push(j(i,"pointerdown",null,this.blockMouseDown(t))),this.listeners.push(W(e,"pointerenter",t,(()=>{this.targetWorkspace.isDragging()||t.addSelect()}))),this.listeners.push(W(e,"pointerleave",t,(()=>{this.targetWorkspace.isDragging()||t.removeSelect()}))),this.listeners.push(W(i,"pointerenter",t,(()=>{this.targetWorkspace.isDragging()||t.addSelect()}))),this.listeners.push(W(i,"pointerleave",t,(()=>{this.targetWorkspace.isDragging()||t.removeSelect()})))}blockMouseDown(e){return t=>{const i=this.targetWorkspace.getGesture(t);i&&(i.setStartBlock(e),i.handleFlyoutStart(t,this))}}onMouseDown(e){const t=this.targetWorkspace.getGesture(e);t&&t.handleFlyoutStart(e,this)}isBlockCreatable(e){return e.isEnabled()}createBlock(e){let t=null;Hr.disable$$module$build$src$core$events$utils();var i=this.targetWorkspace.getAllVariables();this.targetWorkspace.setResizesEnabled(!1);try{t=this.placeNewBlock(e)}finally{Hr.enable$$module$build$src$core$events$utils()}if(this.targetWorkspace.hideChaff(),e=mt(this.targetWorkspace,i),T()){for(Hr.setGroup$$module$build$src$core$events$utils(!0),i=0;i<e.length;i++){const t=e[i];p(new(y(Zr))(t))}p(new(y(Hr.CREATE$$module$build$src$core$events$utils))(t))}return this.autoClose?this.hide():this.filterForCapacity(),t}initFlyoutButton_(e,t,i){const n=e.createDom();e.moveTo(t,i),e.show(),this.listeners.push(j(n,"pointerdown",this,this.onMouseDown)),this.buttons_.push(e)}createRect_(e,t,i,n,s){return(t=ee(_l.RECT,{"fill-opacity":0,x:t,y:i,height:n.height,width:n.width})).tooltip=e,Wi(t),this.workspace_.getCanvas().insertBefore(t,e.getSvgRoot()),this.rectMap_.set(e,t),this.mats[s]=t}moveRectToBlock_(e,t){const i=t.getHeightWidth();e.setAttribute("width",String(i.width)),e.setAttribute("height",String(i.height)),t=t.getRelativeToSurfaceXY(),e.setAttribute("y",String(t.y)),e.setAttribute("x",String(this.RTL?t.x-i.width:t.x))}filterForCapacity(){const e=this.workspace_.getTopBlocks(!1);for(let t,i=0;t=e[i];i++)if(!this.permanentlyDisabled.includes(t)){const e=this.targetWorkspace.isCapacityAvailable($(t));for(;t;)t.setDisabledReason(!e,"WORKSPACE_AT_BLOCK_CAPACITY"),t=t.getNextBlock()}}reflow(){this.reflowWrapper&&this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowInternal_(),this.reflowWrapper&&this.workspace_.addChangeListener(this.reflowWrapper)}isScrollable(){return!!this.workspace_.scrollbar&&this.workspace_.scrollbar.isVisible()}placeNewBlock(e){var t=this.targetWorkspace;if(!e.getSvgRoot())throw Error("oldBlock is not rendered");const i=this.serializeBlock(e);return t.setResizesEnabled(!1),t=Wt(i,t),this.positionNewBlock(e,t),t}serializeBlock(e){return Mt(e)}positionNewBlock(e,t){const i=this.targetWorkspace;var n=i.getOriginOffsetInPixels(),s=this.workspace_.getOriginOffsetInPixels();(e=e.getRelativeToSurfaceXY()).scale(this.workspace_.scale),s=cl.sum(s,e),(n=cl.difference(s,n)).scale(1/i.scale),t.moveTo(new cl(n.x,n.y))}};Qp.FlyoutItemType=Jp;var eg=class extends Qp{constructor(e){super(e)}setMetrics_(e){if(this.isVisible()){var t=this.workspace_.getMetricsManager(),i=t.getScrollMetrics(),n=t.getViewMetrics();t=t.getAbsoluteMetrics(),"number"==typeof e.y&&(this.workspace_.scrollY=-(i.top+(i.height-n.height)*e.y)),this.workspace_.translate(this.workspace_.scrollX+t.left,this.workspace_.scrollY+t.top)}}getX(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const t=e.getAbsoluteMetrics(),i=e.getViewMetrics();return e=e.getToolboxMetrics(),this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?this.toolboxPosition_===$l.LEFT?e.width:i.width-this.width_:this.toolboxPosition_===$l.LEFT?0:i.width:this.toolboxPosition_===$l.LEFT?0:i.width+t.left-this.width_}getY(){return 0}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.height_=e.height,this.setBackgroundPath(this.width_-this.CORNER_RADIUS,e.height-2*this.CORNER_RADIUS),e=this.getX();var t=this.getY();this.positionAt_(this.width_,this.height_,e,t)}}setBackgroundPath(e,t){const i=this.toolboxPosition_===$l.RIGHT;var n=e+this.CORNER_RADIUS;(n=["M "+(i?n:0)+",0"]).push("h",i?-e:e),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,i?0:1,i?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("v",Math.max(0,t)),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,i?0:1,i?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("h",i?e:-e),n.push("z"),this.svgBackground_.setAttribute("d",n.join(" "))}scrollToStart(){let e;null==(e=this.workspace_.scrollbar)||e.setY(0)}wheel_(e){var t=q(e);if(t.y){const e=this.workspace_.getMetricsManager(),i=e.getScrollMetrics();let n;t=e.getViewMetrics().top-i.top+t.y,null==(n=this.workspace_.scrollbar)||n.setY(t),Nn(this.workspace_),Ai()}e.preventDefault(),e.stopPropagation()}layout_(e,t){this.workspace_.scale=this.targetWorkspace.scale;var i=this.MARGIN;const n=this.RTL?i:i+this.tabWidth_;for(let a,l=0;a=e[l];l++)if("block"===a.type){var s=a.block;if(!s)continue;var o=s.getDescendants(!1);for(let e,t=0;e=o[t];t++)e.isInFlyout=!0;o=s.getSvgRoot();const e=s.getHeightWidth();var r=s.outputConnection?n-this.tabWidth_:n;s.moveBy(r,i),r=this.createRect_(s,this.RTL?r-e.width:r,i,e,l),this.addBlockListeners_(o,s,r),i+=e.height+t[l]}else"button"===a.type&&(s=a.button,this.initFlyoutButton_(s,n,i),i+=s.height+t[l])}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const t=this.dragAngleRange_;return e<t&&e>-t||e<-180+t||e>180-t}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),t=e.left;return this.toolboxPosition_===$l.LEFT?new Tl(-1e9,1e9,-1e9,t+e.width):new Tl(-1e9,1e9,t,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=0;var t=this.workspace_.getTopBlocks(!1);for(let n,s=0;n=t[s];s++){var i=n.getHeightWidth().width;n.outputConnection&&(i-=this.tabWidth_),e=Math.max(e,i)}for(let t,i=0;t=this.buttons_[i];i++)e=Math.max(e,t.width);if(e+=1.5*this.MARGIN+this.tabWidth_,e*=this.workspace_.scale,e+=kl.scrollbarThickness,this.width_!==e){for(let n,s=0;n=t[s];s++){if(this.RTL){i=n.getRelativeToSurfaceXY().x;let t=e/this.workspace_.scale-this.MARGIN;n.outputConnection||(t-=this.tabWidth_),n.moveBy(t-i,0)}this.rectMap_.has(n)&&this.moveRectToBlock_(this.rectMap_.get(n),n)}if(this.RTL)for(let i,n=0;i=this.buttons_[n];n++)t=i.getPosition().y,i.moveTo(e/this.workspace_.scale-i.width-this.MARGIN-this.tabWidth_,t);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==$l.LEFT||this.targetWorkspace.translate(this.targetWorkspace.scrollX+e,this.targetWorkspace.scrollY),this.width_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};eg.registryName="verticalFlyout",t(Xr.FLYOUTS_VERTICAL_TOOLBOX,Wr,eg);var tg=class extends Qp{constructor(e){super(e),this.horizontalLayout=!0}setMetrics_(e){if(this.isVisible()){var t=this.workspace_.getMetricsManager(),i=t.getScrollMetrics(),n=t.getViewMetrics();t=t.getAbsoluteMetrics(),"number"==typeof e.x&&(this.workspace_.scrollX=-(i.left+(i.width-n.width)*e.x)),this.workspace_.translate(this.workspace_.scrollX+t.left,this.workspace_.scrollY+t.top)}}getX(){return 0}getY(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const t=e.getAbsoluteMetrics(),i=e.getViewMetrics();e=e.getToolboxMetrics();const n=this.toolboxPosition_===$l.TOP;return this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?n?e.height:i.height-this.height_:n?0:i.height:n?0:i.height+t.top-this.height_}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.width_=e.width,this.setBackgroundPath(e.width-2*this.CORNER_RADIUS,this.height_-this.CORNER_RADIUS),e=this.getX();var t=this.getY();this.positionAt_(this.width_,this.height_,e,t)}}setBackgroundPath(e,t){const i=this.toolboxPosition_===$l.TOP,n=["M 0,"+(i?0:this.CORNER_RADIUS)];i?(n.push("h",e+2*this.CORNER_RADIUS),n.push("v",t),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("h",-e),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),n.push("h",e),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("v",t),n.push("h",-e-2*this.CORNER_RADIUS)),n.push("z"),this.svgBackground_.setAttribute("d",n.join(" "))}scrollToStart(){let e;null==(e=this.workspace_.scrollbar)||e.setX(this.RTL?1/0:0)}wheel_(e){var t=q(e);if(t=t.x||t.y){const e=this.workspace_.getMetricsManager(),i=e.getScrollMetrics();let n;t=e.getViewMetrics().left-i.left+t,null==(n=this.workspace_.scrollbar)||n.setX(t),Nn(this.workspace_),Ai()}e.preventDefault(),e.stopPropagation()}layout_(e,t){this.workspace_.scale=this.targetWorkspace.scale;const i=this.MARGIN;let n=i+this.tabWidth_;this.RTL&&(e=e.reverse());for(let a,l=0;a=e[l];l++)if("block"===a.type){var s=a.block;if(null==s)continue;var o=s.getDescendants(!1);for(let e,t=0;e=o[t];t++)e.isInFlyout=!0;o=s.getSvgRoot();const e=s.getHeightWidth();var r=s.outputConnection?this.tabWidth_:0;r=this.RTL?n+e.width:n-r,s.moveBy(r,i),r=this.createRect_(s,r,i,e,l),n+=e.width+t[l],this.addBlockListeners_(o,s,r)}else"button"===a.type&&(s=a.button,this.initFlyoutButton_(s,n,i),n+=s.width+t[l])}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const t=this.dragAngleRange_;return e<90+t&&e>90-t||e>-90-t&&e<-90+t}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),t=e.top;return this.toolboxPosition_===$l.TOP?new Tl(-1e9,t+e.height,-1e9,1e9):new Tl(t,1e9,-1e9,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=0;const t=this.workspace_.getTopBlocks(!1);for(let i,n=0;i=t[n];n++)e=Math.max(e,i.getHeightWidth().height);const i=this.buttons_;for(let t,n=0;t=i[n];n++)e=Math.max(e,t.height);if(e+=1.5*this.MARGIN,e*=this.workspace_.scale,e+=kl.scrollbarThickness,this.height_!==e){for(let e,i=0;e=t[i];i++)this.rectMap_.has(e)&&this.moveRectToBlock_(this.rectMap_.get(e),e);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==$l.TOP||this.targetWorkspace.translate(this.targetWorkspace.scrollX,this.targetWorkspace.scrollY+e),this.height_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};t(Xr.FLYOUTS_HORIZONTAL_TOOLBOX,Wr,tg);var ig=class extends _h{constructor(e,t,i,n,s){super(wu.SKIP_SETUP),this.defaultType="",this.variableTypes=[],this.variable=null,this.SERIALIZABLE=!0,this.menuGenerator_=ig.dropdownCreate,this.defaultVariableName="string"==typeof e?e:"",this.size_=new El(0,0),e!==wu.SKIP_SETUP&&(s?this.configure_(s):this.setTypes(i,n),t&&this.setValidator(t))}configure_(e){super.configure_(e),this.setTypes(e.variableTypes,e.defaultType)}initModel(){var e=this.getSourceBlock();if(!e)throw new Lu;this.variable||(e=Hr.getOrCreateVariablePackage$$module$build$src$core$variables(e.workspace,null,this.defaultVariableName,this.defaultType),this.doValueUpdate_(e.getId()))}shouldAddBorderRect_(){const e=this.getSourceBlock();if(!e)throw new Lu;return super.shouldAddBorderRect_()&&(!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||"variables_get"!==e.type)}fromXml(e){var t=this.getSourceBlock();if(!t)throw new Lu;const i=e.getAttribute("id"),n=e.textContent,s=e.getAttribute("variabletype")||e.getAttribute("variableType")||"";if(t=Hr.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,i,n,s),null!==s&&s!==t.type)throw Error("Serialized variable type with id '"+t.getId()+"' had type "+t.type+", and does not match variable field that references it: "+Jn(e)+".");this.setValue(t.getId())}toXml(e){return this.initModel(),e.id=this.variable.getId(),e.textContent=this.variable.name,this.variable.type&&e.setAttribute("variabletype",this.variable.type),e}saveState(e){var t=this.saveLegacyState(ig);return null!==t||(this.initModel(),t={id:this.variable.getId()},e&&(t.name=this.variable.name,t.type=this.variable.type)),t}loadState(e){const t=this.getSourceBlock();if(!t)throw new Lu;this.loadLegacyState(ig,e)||(e=Hr.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,e.id||null,e.name,e.type||""),this.setValue(e.getId()))}setSourceBlock(e){if(e.isShadow())throw Error("Variable fields are not allowed to exist on shadow blocks.");super.setSourceBlock(e)}getValue(){return this.variable?this.variable.getId():null}getText(){return this.variable?this.variable.name:""}getVariable(){return this.variable}getValidator(){return this.variable?this.validator_:null}doClassValidation_(e){if(null===e)return null;var t=this.getSourceBlock();if(!t)throw new Lu;return(t=Hr.getVariable$$module$build$src$core$variables(t.workspace,e))?(t=t.type,this.typeIsAllowed(t)?e:(console.warn("Variable type doesn't match this field!  Type was "+t),null)):(console.warn("Variable id doesn't point to a real variable! ID was "+e),null)}doValueUpdate_(e){const t=this.getSourceBlock();if(!t)throw new Lu;this.variable=Hr.getVariable$$module$build$src$core$variables(t.workspace,e),super.doValueUpdate_(e)}typeIsAllowed(e){const t=this.getVariableTypes();if(!t)return!0;for(let i=0;i<t.length;i++)if(e===t[i])return!0;return!1}getVariableTypes(){var e=this.variableTypes;if(null===e&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())return this.sourceBlock_.workspace.getVariableTypes();if(0===(e=e||[""]).length)throw e=this.getText(),Error("'variableTypes' of field variable "+e+" was an empty list");return e}setTypes(e=null,t=""){if(Array.isArray(e)){let i=!1;for(let n=0;n<e.length;n++)e[n]===t&&(i=!0);if(!i)throw Error("Invalid default type '"+t+"' in the definition of a FieldVariable")}else if(null!==e)throw Error("'variableTypes' was not an array in the definition of a FieldVariable");this.defaultType=t,this.variableTypes=e}refreshVariableName(){this.forceRerender()}onItemSelected_(e,t){if(e=t.getValue(),this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()){if("RENAME_VARIABLE_ID"===e)return void Hr.renameVariable$$module$build$src$core$variables(this.sourceBlock_.workspace,this.variable);if("DELETE_VARIABLE_ID"===e)return void this.sourceBlock_.workspace.deleteVariableById(this.variable.getId())}this.setValue(e)}referencesVariables(){return!0}static fromJson(e){return new this(_n(e.variable),void 0,void 0,void 0,e)}static dropdownCreate(){if(!this.variable)throw Error("Tried to call dropdownCreate on a variable field with no variable selected.");const e=this.getText();let t=[];if(this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())for(var i=this.getVariableTypes(),n=0;n<i.length;n++){const e=this.sourceBlock_.workspace.getVariablesOfType(i[n]);t=t.concat(e)}for(t.sort(rc.compareByName),i=[],n=0;n<t.length;n++)i[n]=[t[n].name,t[n].getId()];return i.push([Hr.Msg$$module$build$src$core$msg.RENAME_VARIABLE,"RENAME_VARIABLE_ID"]),Hr.Msg$$module$build$src$core$msg.DELETE_VARIABLE&&i.push([Hr.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",e),"DELETE_VARIABLE_ID"]),i}};Os("field_variable",ig);var ng=class extends Bp{constructor(e,t,i,n,s,o){super(wu.SKIP_SETUP),this.min_=-1/0,this.max_=1/0,this.precision_=0,this.decimalPlaces=null,this.spellcheck_=!1,e!==wu.SKIP_SETUP&&(o?this.configure_(o):this.setConstraints(t,i,n),this.setValue(e),s&&this.setValidator(s))}configure_(e){super.configure_(e),this.setMinInternal(e.min),this.setMaxInternal(e.max),this.setPrecisionInternal(e.precision)}setConstraints(e,t,i){this.setMinInternal(e),this.setMaxInternal(t),this.setPrecisionInternal(i),this.setValue(this.getValue())}setMin(e){this.setMinInternal(e),this.setValue(this.getValue())}setMinInternal(e){null==e?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))}getMin(){return this.min_}setMax(e){this.setMaxInternal(e),this.setValue(this.getValue())}setMaxInternal(e){null==e?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))}getMax(){return this.max_}setPrecision(e){this.setPrecisionInternal(e),this.setValue(this.getValue())}setPrecisionInternal(e){this.precision_=Number(e)||0;let t=String(this.precision_);t.includes("e")&&(t=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const i=t.indexOf(".");this.decimalPlaces=-1===i?e?0:null:t.length-i-1}getPrecision(){return this.precision_}doClassValidation_(e){return null===e?null:(e=(e=(e=`${e}`.replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity"),e=Number(e||0),isNaN(e)?null:(e=Math.min(Math.max(e,this.min_),this.max_),this.precision_&&isFinite(e)&&(e=Math.round(e/this.precision_)*this.precision_),null!==this.decimalPlaces&&(e=Number(e.toFixed(this.decimalPlaces))),e))}widgetCreate_(){const e=super.widgetCreate_();return-1/0<this.min_&&(e.min=`${this.min_}`,$t(e,Oc.VALUEMIN,this.min_)),1/0>this.max_&&(e.max=`${this.max_}`,$t(e,Oc.VALUEMAX,this.max_)),e}static fromJson(e){return new this(e.value,void 0,void 0,void 0,void 0,e)}};Os("field_number",ng),ng.prototype.DEFAULT_VALUE=0;var sg=class extends hd{constructor(e,t,i){super(String(null!=e?e:""),t,i),this.EDITABLE=!1,this.SERIALIZABLE=!0}static fromJson(e){return new this(_n(e.text),void 0,e)}};Os("field_label_serializable",sg);var og=class extends wu{constructor(e,t,i){super(wu.SKIP_SETUP),this.SERIALIZABLE=!0,this.CURSOR="default",this.value_=this.value_,this.checkChar=og.CHECK_CHAR,e!==wu.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),e.checkCharacter&&(this.checkChar=e.checkCharacter)}saveState(){const e=this.saveLegacyState(og);return null!==e?e:this.getValueBoolean()}initView(){super.initView();const e=this.getTextElement();te(e,"blocklyCheckbox"),e.style.display=this.value_?"block":"none"}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_(this.getConstants().FIELD_CHECKBOX_X_OFFSET)}getDisplayText_(){return this.checkChar}setCheckCharacter(e){this.checkChar=e||og.CHECK_CHAR,this.forceRerender()}showEditor_(){this.setValue(!this.value_)}doClassValidation_(e){return!0===e||"TRUE"===e?"TRUE":!1===e||"FALSE"===e?"FALSE":null}doValueUpdate_(e){this.value_=this.convertValueToBool_(e),this.textElement_&&(this.textElement_.style.display=this.value_?"block":"none")}getValue(){return this.value_?"TRUE":"FALSE"}getValueBoolean(){return this.value_}getText(){return String(this.convertValueToBool_(this.value_))}convertValueToBool_(e){return"string"==typeof e?"TRUE"===e:!!e}static fromJson(e){return new this(e.checked,void 0,e)}};og.CHECK_CHAR="",Os("field_checkbox",og),og.prototype.DEFAULT_VALUE=!1;var rg=class{constructor(e,t){this.draggable=e,this.workspace=t,this.dragTarget=null,this.startLoc=e.getRelativeToSurfaceXY()}onDragStart(e){this.draggable.startDrag(e)}onDrag(e,t){this.moveDraggable(e,t),t=this.getRoot(this.draggable),Fo(t)&&t.setDeleteStyle(this.wouldDeleteDraggable(e,t)),this.updateDragTarget(e)}updateDragTarget(e){e=this.workspace.getDragTarget(e);const t=this.getRoot(this.draggable);if(this.dragTarget!==e){let i;null==(i=this.dragTarget)||i.onDragExit(t),null==e||e.onDragEnter(t)}null==e||e.onDragOver(t),this.dragTarget=e}moveDraggable(e,t){t=this.pixelsToWorkspaceUnits(t),t=cl.sum(this.startLoc,t),this.draggable.drag(t,e)}wouldDeleteDraggable(e,t){return!(!(e=this.workspace.getDragTarget(e))||!this.workspace.getComponentManager().hasCapability(e.id,sl.Capability.DELETE_AREA))&&e.wouldDelete(t)}onDragEnd(e){const t=Hr.getGroup$$module$build$src$core$events$utils();var i=this.workspace.getDragTarget(e);const n=this.getRoot(this.draggable);if(i){let e;null==(e=this.dragTarget)||e.onDrop(n)}this.shouldReturnToStart(e,n)&&this.draggable.revertDrag(),(i=Fo(n)&&this.wouldDeleteDraggable(e,n))&&this.draggable instanceof ep&&fs(this.draggable.getRootBlock()),this.draggable.endDrag(e),i&&Fo(n)&&(e=Hr.getGroup$$module$build$src$core$events$utils(),Hr.setGroup$$module$build$src$core$events$utils(t),n.dispose(),Hr.setGroup$$module$build$src$core$events$utils(e))}getRoot(e){return e instanceof ep?e.getRootBlock():e}shouldReturnToStart(e,t){return!!(e=this.workspace.getDragTarget(e))&&e.shouldPreventMove(t)}pixelsToWorkspaceUnits(e){return e=new cl(e.x/this.workspace.scale,e.y/this.workspace.scale),this.workspace.isMutator&&e.scale(1/this.workspace.options.parentWorkspace.scale),e}};t(Xr.BLOCK_DRAGGER,Wr,rg);var ag={};ag.BlockDragStrategy=Qd,ag.BubbleDragStrategy=bh,ag.CommentDragStrategy=Ec,ag.Dragger=rg;var lg=class extends Oa{constructor(e,t,i){super(e?e.workspace.id:void 0),this.type="drag",e&&(this.blockId=e.id,this.isStart=t,this.blocks=i)}toJson(){const e=super.toJson();if(void 0===this.isStart)throw Error("Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson");if(void 0===this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.isStart=this.isStart,e.blockId=this.blockId,e.blocks=this.blocks,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new lg)).isStart=e.isStart,t.blockId=e.blockId,t.blocks=e.blocks,t}};t(Xr.EVENT,"drag",lg);var cg=class extends Hc{constructor(e,t,i,n){super(e),this.type=Jr,this.recordUndo=!1,e&&(this.name=t,this.oldValue=i,this.newValue=n)}toJson(){const e=super.toJson();if(!this.name)throw Error("The changed field name is undefined. Either pass a name to the constructor, or call fromJson.");return e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new cg)).name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,t}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(!(t=t.getBlockById(this.blockId)))throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");e=e?this.newValue:this.oldValue,(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name)}};t(Xr.EVENT,Jr,cg);var ug=class extends Hc{constructor(e){super(e),this.type=Hr.MOVE$$module$build$src$core$events$utils,e&&(e.isShadow()&&(this.recordUndo=!1),e=this.currentLocation_(),this.oldParentId=e.parentId,this.oldInputName=e.inputName,this.oldCoordinate=e.coordinate)}toJson(){const e=super.toJson();return e.oldParentId=this.oldParentId,e.oldInputName=this.oldInputName,this.oldCoordinate&&(e.oldCoordinate=`${Math.round(this.oldCoordinate.x)}, ${Math.round(this.oldCoordinate.y)}`),e.newParentId=this.newParentId,e.newInputName=this.newInputName,this.newCoordinate&&(e.newCoordinate=`${Math.round(this.newCoordinate.x)}, ${Math.round(this.newCoordinate.y)}`),this.reason&&(e.reason=this.reason),this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new ug)).oldParentId=e.oldParentId,t.oldInputName=e.oldInputName,e.oldCoordinate&&(i=e.oldCoordinate.split(","),t.oldCoordinate=new cl(Number(i[0]),Number(i[1]))),t.newParentId=e.newParentId,t.newInputName=e.newInputName,e.newCoordinate&&(i=e.newCoordinate.split(","),t.newCoordinate=new cl(Number(i[0]),Number(i[1]))),void 0!==e.reason&&(t.reason=e.reason),void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}recordNew(){const e=this.currentLocation_();this.newParentId=e.parentId,this.newInputName=e.inputName,this.newCoordinate=e.coordinate}setReason(e){this.reason=e}currentLocation_(){var e=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var t=e.getBlockById(this.blockId);if(!t)throw Error("The block associated with the block move event could not be found");e={};const i=t.getParent();return i?(e.parentId=i.id,(t=i.getInputWithBlock(t))&&(e.inputName=t.name)):e.coordinate=t.getRelativeToSurfaceXY(),e}isNull(){return this.oldParentId===this.newParentId&&this.oldInputName===this.newInputName&&cl.equals(this.oldCoordinate,this.newCoordinate)}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var i=t.getBlockById(this.blockId);if(i){var n=e?this.newParentId:this.oldParentId,s=e?this.newInputName:this.oldInputName;if(e=e?this.newCoordinate:this.oldCoordinate,n){var o=t.getBlockById(n);if(!o)return void console.warn("Can't connect to non-existent block: "+n)}if(i.getParent()&&i.unplug(),e)s=i.getRelativeToSurfaceXY(),i.moveBy(e.x-s.x,e.y-s.y,this.reason);else{let e,n;(!(t=i.outputConnection)||i.previousConnection&&i.previousConnection.isConnected())&&(t=i.previousConnection),i=null==(n=t)?void 0:n.type,s?(i=o.getInput(s))&&(e=i.connection):i===eh.PREVIOUS_STATEMENT&&(e=o.nextConnection),e&&t?t.connect(e):console.warn("Can't connect to non-existent input: "+s)}}else console.warn("Can't move non-existent block: "+this.blockId)}};t(Xr.EVENT,Hr.MOVE$$module$build$src$core$events$utils,ug);var hg,dg=class extends Oa{constructor(e,t,i){super(e?e.workspace.id:void 0),this.type=ia,e&&(this.blockId=e.id,this.isOpen=t,this.bubbleType=i)}toJson(){const e=super.toJson();if(void 0===this.isOpen)throw Error("Whether this event is for opening the bubble is undefined. Either pass the value to the constructor, or call fromJson");if(!this.bubbleType)throw Error("The type of bubble is undefined. Either pass the value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e.bubbleType=this.bubbleType,e.blockId=this.blockId||"",e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new dg)).isOpen=e.isOpen,t.bubbleType=e.bubbleType,t.blockId=e.blockId,t}};!function(e){e.MUTATOR="mutator",e.COMMENT="comment",e.WARNING="warning"}(hg||(hg={})),t(Xr.EVENT,ia,dg);var pg={};pg.BubbleOpen=dg,pg.BubbleType=hg;var gg=class extends ka{constructor(e){super(),this.isBlank=!e,e&&(this.commentId=e.id,this.workspaceId=e.workspace.id,this.group=Hr.getGroup$$module$build$src$core$events$utils(),this.recordUndo=d())}toJson(){const e=super.toJson();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");return e.commentId=this.commentId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new gg)).commentId=e.commentId,t}static CommentCreateDeleteHelper(e,t){const i=e.getEventWorkspace_();if(t){if(!e.json)throw Error("Encountered a comment event without proper json");At(e.json,i)}else{if(!e.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(t=i.getCommentById(e.commentId))?t.dispose():console.warn("Can't delete non-existent comment: "+e.commentId)}}},mg=class extends gg{constructor(e,t,i){super(e),this.type="comment_change",e&&(this.oldContents_=void 0===t?"":t,this.newContents_=void 0===i?"":i)}toJson(){const e=super.toJson();if(!this.oldContents_)throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newContents_)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");return e.oldContents=this.oldContents_,e.newContents=this.newContents_,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new mg)).oldContents_=e.oldContents,t.newContents_=e.newContents,t}isNull(){return this.oldContents_===this.newContents_}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){var i=e?this.newContents_:this.oldContents_;if(void 0===i){if(e)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson")}t.setText(i)}else console.warn("Can't change non-existent comment: "+this.commentId)}};t(Xr.EVENT,"comment_change",mg);var fg=class extends gg{constructor(e){super(e),this.type=sa,e&&(this.xml=jn(e),this.json=Nt(e,{addCoordinates:!0}))}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.json)throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=Jn(this.xml),e.json=this.json,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new fg)).xml=Hr.textToDom$$module$build$src$core$utils$xml(e.xml),t.json=e.json,t}run(e){gg.CommentCreateDeleteHelper(this,e)}};t(Xr.EVENT,sa,fg);var _g=class extends gg{constructor(e){super(e),this.type="comment_delete",e&&(this.xml=jn(e),this.json=Nt(e,{addCoordinates:!0}))}run(e){gg.CommentCreateDeleteHelper(this,!e)}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.json)throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=Jn(this.xml),e.json=this.json,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new _g)).xml=Hr.textToDom$$module$build$src$core$utils$xml(e.xml),t.json=e.json,t}};t(Xr.EVENT,"comment_delete",_g);var Tg=class extends gg{constructor(e){super(e),this.type=oa,e&&(this.comment_=e,this.oldCoordinate_=e.getRelativeToSurfaceXY())}recordNew(){if(this.newCoordinate_)throw Error("Tried to record the new position of a comment on the same event twice.");if(!this.comment_)throw Error("The comment is undefined. Pass a comment to the constructor if you want to use the record functionality");this.newCoordinate_=this.comment_.getRelativeToSurfaceXY()}setReason(e){this.reason=e}setOldCoordinate(e){this.oldCoordinate_=e}toJson(){const e=super.toJson();if(!this.oldCoordinate_)throw Error("The old comment position is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.newCoordinate_)throw Error("The new comment position is undefined. Either call recordNew, or call fromJson");return e.oldCoordinate=`${Math.round(this.oldCoordinate_.x)}, ${Math.round(this.oldCoordinate_.y)}`,e.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y),e}static fromJson(e,t,i){return t=super.fromJson(e,t,null!=i?i:new Tg),i=e.oldCoordinate.split(","),t.oldCoordinate_=new cl(Number(i[0]),Number(i[1])),i=e.newCoordinate.split(","),t.newCoordinate_=new cl(Number(i[0]),Number(i[1])),t}isNull(){return cl.equals(this.oldCoordinate_,this.newCoordinate_)}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){if(!(e=e?this.newCoordinate_:this.oldCoordinate_))throw Error("Either oldCoordinate_ or newCoordinate_ is undefined. Either pass a comment to the constructor and call recordNew, or call fromJson");t.moveTo(e)}else console.warn("Can't move non-existent comment: "+this.commentId)}};t(Xr.EVENT,oa,Tg);var Eg=class extends gg{constructor(e,t){super(e),this.newCollapsed=t,this.type="comment_collapse"}toJson(){const e=super.toJson();if(void 0===this.newCollapsed)throw Error("The new collapse value undefined. Either call recordNew, or call fromJson");return e.newCollapsed=this.newCollapsed,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Eg)).newCollapsed=e.newCollapsed,t}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(t=t.getCommentById(this.commentId))?t.setCollapsed(e?!!this.newCollapsed:!this.newCollapsed):console.warn("Can't collapse or uncollapse non-existent comment: "+this.commentId)}};t(Xr.EVENT,"comment_collapse",Eg);var bg=class extends Oa{constructor(e,t,i){super(i),this.type="toolbox_item_select",this.oldItem=null!=e?e:void 0,this.newItem=null!=t?t:void 0}toJson(){const e=super.toJson();return e.oldItem=this.oldItem,e.newItem=this.newItem,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new bg)).oldItem=e.oldItem,t.newItem=e.newItem,t}};t(Xr.EVENT,"toolbox_item_select",bg);var Ig=class extends ka{constructor(e){super(),this.isBlank=!0,this.recordUndo=!1,this.type=ra,this.isBlank=!!e,e&&(this.workspaceId=e.id)}};t(Xr.EVENT,ra,Ig),Hr.CHANGE$$module$build$src$core$events$utils,Hr.CREATE$$module$build$src$core$events$utils,Hr.DELETE$$module$build$src$core$events$utils,Hr.MOVE$$module$build$src$core$events$utils,Hr.CHANGE$$module$build$src$core$events$utils,Hr.CREATE$$module$build$src$core$events$utils,Hr.DELETE$$module$build$src$core$events$utils,Hr.MOVE$$module$build$src$core$events$utils,Hr.disable$$module$build$src$core$events$utils,Hr.enable$$module$build$src$core$events$utils,Hr.getGroup$$module$build$src$core$events$utils,Hr.setGroup$$module$build$src$core$events$utils,Hr.setRecordUndo$$module$build$src$core$events$utils;var yg={};yg.Abstract=ka,yg.BLOCK_CHANGE=Hr.CHANGE$$module$build$src$core$events$utils,yg.BLOCK_CREATE=Hr.CREATE$$module$build$src$core$events$utils,yg.BLOCK_DELETE=Hr.DELETE$$module$build$src$core$events$utils,yg.BLOCK_DRAG="drag",yg.BLOCK_FIELD_INTERMEDIATE_CHANGE=Jr,yg.BLOCK_MOVE=Hr.MOVE$$module$build$src$core$events$utils,yg.BUBBLE_OPEN=ia,yg.BUMP_EVENTS=la,yg.BlockBase=Hc,yg.BlockChange=Gc,yg.BlockCreate=Ju,yg.BlockDelete=_d,yg.BlockDrag=lg,yg.BlockFieldIntermediateChange=cg,yg.BlockMove=ug,yg.BubbleOpen=dg,yg.BubbleType=hg,yg.CHANGE=Hr.CHANGE$$module$build$src$core$events$utils,yg.CLICK=ta,yg.COMMENT_CHANGE="comment_change",yg.COMMENT_CREATE=sa,yg.COMMENT_DELETE="comment_delete",yg.COMMENT_MOVE=oa,yg.CREATE=Hr.CREATE$$module$build$src$core$events$utils,yg.Click=Na,yg.ClickTarget=va,yg.CommentBase=gg,yg.CommentChange=mg,yg.CommentCollapse=Eg,yg.CommentCreate=fg,yg.CommentDelete=_g,yg.CommentMove=Tg,yg.DELETE=Hr.DELETE$$module$build$src$core$events$utils,yg.FINISHED_LOADING=ra,yg.FinishedLoading=Ig,yg.MARKER_MOVE="marker_move",yg.MOVE=Hr.MOVE$$module$build$src$core$events$utils,yg.MarkerMove=yd,yg.SELECTED=ea,yg.Selected=Gd,yg.THEME_CHANGE="theme_change",yg.TOOLBOX_ITEM_SELECT="toolbox_item_select",yg.TRASHCAN_OPEN="trashcan_open",yg.ThemeChange=Qu,yg.ToolboxItemSelect=bg,yg.TrashcanOpen=Hd,yg.UI=Qr,yg.UiBase=Oa,yg.VAR_CREATE=Zr,yg.VAR_DELETE="var_delete",yg.VAR_RENAME="var_rename",yg.VIEWPORT_CHANGE=na,yg.VarBase=sc,yg.VarCreate=oc,yg.VarDelete=$d,yg.VarRename=Dd,yg.ViewportChange=th,yg.clearPendingUndo=_,yg.disable=Hr.disable$$module$build$src$core$events$utils,yg.disableOrphans=v,yg.enable=Hr.enable$$module$build$src$core$events$utils,yg.filter=f,yg.fire=p,yg.fromJson=I,yg.get=y,yg.getDescendantIds=b,yg.getGroup=Hr.getGroup$$module$build$src$core$events$utils,yg.getRecordUndo=d,yg.isEnabled=T,yg.setGroup=Hr.setGroup$$module$build$src$core$events$utils,yg.setRecordUndo=Hr.setRecordUndo$$module$build$src$core$events$utils;var vg={};vg.BottomRow=Up,vg.ConstantProvider=Dp,vg.Drawer=Mp,vg.MarkerSvg=Wp,vg.PathObject=Xp,vg.RenderInfo=jp,vg.Renderer=Yp,vg.RightConnectionShape=Gp,vg.StatementInput=Hp,vg.TopRow=Vp,$r();var Cg={};Cg.registerCleanup=dr,Cg.registerCollapse=gr,Cg.registerCollapseExpandBlock=Cr,Cg.registerComment=yr,Cg.registerCommentCreate=Rr,Cg.registerCommentDelete=Ar,Cg.registerCommentDuplicate=Sr,Cg.registerCommentOptions=xr,Cg.registerDefaultOptions=$r,Cg.registerDelete=Or,Cg.registerDeleteAll=Er,Cg.registerDisable=kr,Cg.registerDuplicate=Ir,Cg.registerExpand=mr,Cg.registerHelp=Nr,Cg.registerInline=vr,Cg.registerRedo=hr,Cg.registerUndo=ur;var kg={};kg.CommentView=Tc,kg.RenderedWorkspaceComment=Ku,kg.WorkspaceComment=_c;var Og={};Og.Bubble=Ih,Og.MiniWorkspaceBubble=yh,Og.TextBubble=Lh,Og.TextInputBubble=xh;var Ng=class extends ld{constructor(){super(),this.FIELD_TEXT_BASELINE_CENTER=!1,this.DARK_PATH_OFFSET=1,this.MAX_BOTTOM_WIDTH=30,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT/2}getCSS_(e){return super.getCSS_(e).concat([`${e} .blocklyInsertionMarker>.blocklyPathLight,`,`${e} .blocklyInsertionMarker>.blocklyPathDark {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"])}},Ag=class{constructor(e){this.inlineSteps_=this.steps_="",this.info_=e,this.RTL_=this.info_.RTL,e=e.getRenderer(),this.constants_=e.getConstants(),this.highlightConstants_=e.getHighlightConstants(),this.highlightOffset=this.highlightConstants_.OFFSET,this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER,this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER,this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB,this.notchPaths_=this.highlightConstants_.NOTCH,this.startPaths_=this.highlightConstants_.START_HAT,this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH}getPath(){return this.steps_+"\n"+this.inlineSteps_}drawTopCorner(e){this.steps_+=qs(e.xPos,this.info_.startY);for(let t,i=0;t=e.elements[i];i++)Uh.isLeftSquareCorner(t)?this.steps_+=this.highlightConstants_.START_POINT:Uh.isLeftRoundedCorner(t)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):Uh.isPreviousConnection(t)?this.steps_+=this.notchPaths_.pathLeft:Uh.isHat(t)?this.steps_+=this.startPaths_.path(this.RTL_):Uh.isSpacer(t)&&0!==t.width&&(this.steps_+=Qs("H",t.xPos+t.width-this.highlightOffset));this.steps_+=Qs("H",e.xPos+e.width-this.highlightOffset)}drawJaggedEdge_(e){this.info_.RTL&&(this.steps_+=this.jaggedTeethPaths_.pathLeft+Qs("v",e.height-this.jaggedTeethPaths_.height-this.highlightOffset))}drawValueInput(e){const t=e.getLastInput();if(this.RTL_){const i=e.height-t.connectionHeight;this.steps_+=Ks(t.xPos+t.width-this.highlightOffset,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+Qs("v",i)}else this.steps_+=Ks(t.xPos+t.width,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)}drawStatementInput(e){const t=e.getLastInput();if(t)if(this.RTL_){const i=e.height-2*this.insideCornerPaths_.height;this.steps_+=Ks(t.xPos,e.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+Qs("v",i)+this.insideCornerPaths_.pathBottom(this.RTL_)+Js(e.width-t.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=Ks(t.xPos,e.yPos+e.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+Js(e.width-t.xPos-this.insideCornerPaths_.width,0)}drawRightSideRow(e){const t=e.xPos+e.width-this.highlightOffset;e instanceof od&&e.followsStatement&&(this.steps_+=Qs("H",t)),this.RTL_&&(this.steps_+=Qs("H",t),e.height>this.highlightOffset&&(this.steps_+=Qs("V",e.yPos+e.height-this.highlightOffset)))}drawBottomRow(e){if(this.RTL_)this.steps_+=Qs("V",e.baseline-this.highlightOffset);else{const t=this.info_.bottomRow.elements[0];Uh.isLeftSquareCorner(t)?this.steps_+=Ks(e.xPos+this.highlightOffset,e.baseline-this.highlightOffset):Uh.isLeftRoundedCorner(t)&&(this.steps_+=Ks(e.xPos,e.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}}drawLeft(){var e=this.info_.outputConnection;e&&(e=e.connectionOffsetY+e.height,this.RTL_?this.steps_+=Ks(this.info_.startX,e):(this.steps_+=Ks(this.info_.startX+this.highlightOffset,this.info_.bottomRow.baseline-this.highlightOffset),this.steps_+=Qs("V",e)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_)),this.RTL_||(e=this.info_.topRow,Uh.isLeftRoundedCorner(e.elements[0])?this.steps_+=Qs("V",this.outsideCornerPaths_.height):this.steps_+=Qs("V",e.capline+this.highlightOffset))}drawInlineInput(e){const t=this.highlightOffset,i=e.xPos+e.connectionWidth;var n=e.centerline-e.height/2;const s=e.width-e.connectionWidth,o=n+t;this.RTL_?(n=e.connectionOffsetY-t,e=e.height-(e.connectionOffsetY+e.connectionHeight)+t,this.inlineSteps_+=Ks(i-t,o)+Qs("v",n)+this.puzzleTabPaths_.pathDown(this.RTL_)+Qs("v",e)+Qs("h",s)):this.inlineSteps_+=Ks(e.xPos+e.width+t,o)+Qs("v",e.height)+Qs("h",-s)+Ks(i,n+e.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)}},Sg=class extends ud{constructor(e,t){super(e,t),this.highlighter_=new Ag(t)}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights();const e=this.block_.pathObject;e.setPath(this.outlinePath_+"\n"+this.inlinePath_),e.setHighlightPath(this.highlighter_.getPath()),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_()}drawTop_(){this.highlighter_.drawTopCorner(this.info_.topRow),this.highlighter_.drawRightSideRow(this.info_.topRow),super.drawTop_()}drawJaggedEdge_(e){this.highlighter_.drawJaggedEdge_(e),super.drawJaggedEdge_(e)}drawValueInput_(e){this.highlighter_.drawValueInput(e),super.drawValueInput_(e)}drawStatementInput_(e){this.highlighter_.drawStatementInput(e),super.drawStatementInput_(e)}drawRightSideRow_(e){this.highlighter_.drawRightSideRow(e),this.outlinePath_+=Qs("H",e.xPos+e.width)+Qs("V",e.yPos+e.height)}drawBottom_(){this.highlighter_.drawBottomRow(this.info_.bottomRow),super.drawBottom_()}drawLeft_(){this.highlighter_.drawLeft(),super.drawLeft_()}drawInlineInput_(e){this.highlighter_.drawInlineInput(e),super.drawInlineInput_(e)}positionInlineInputConnection_(e){const t=e.centerline-e.height/2;if(e.connectionModel){let i=e.xPos+e.connectionWidth+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(i*=-1),e.connectionModel.setOffsetInBlock(i,t+e.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}}positionStatementInputConnection_(e){const t=e.getLastInput();if(null!=t&&t.connectionModel){let i=e.xPos+e.statementEdge+t.notchOffset;i=this.info_.RTL?-1*i:i+this.constants_.DARK_PATH_OFFSET,t.connectionModel.setOffsetInBlock(i,e.yPos+this.constants_.DARK_PATH_OFFSET)}}positionExternalValueConnection_(e){const t=e.getLastInput();if(t&&t.connectionModel){let i=e.xPos+e.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(i*=-1),t.connectionModel.setOffsetInBlock(i,e.yPos)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const t=e.connection,i=t.xPos;t.connectionModel.setOffsetInBlock((this.info_.RTL?-i:i)+this.constants_.DARK_PATH_OFFSET/2,e.baseline+this.constants_.DARK_PATH_OFFSET)}}},Rg=class{constructor(e){this.OFFSET=.5,this.constantProvider=e,this.START_POINT=qs(this.OFFSET,this.OFFSET)}init(){this.INSIDE_CORNER=this.makeInsideCorner(),this.OUTSIDE_CORNER=this.makeOutsideCorner(),this.PUZZLE_TAB=this.makePuzzleTab(),this.NOTCH=this.makeNotch(),this.JAGGED_TEETH=this.makeJaggedTeeth(),this.START_HAT=this.makeStartHat()}makeInsideCorner(){const e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,i=(1-Math.SQRT1_2)*(e+t)-t,n=qs(i,i)+eo("a","0 0,0",e,Ys(-i-t,e-i)),s=eo("a","0 0,0",e+t,Ys(e+t,e+t)),o=qs(i,-i)+eo("a","0 0,0",e+t,Ys(e-i,i+t));return{width:e+t,height:e,pathTop:e=>e?n:"",pathBottom:e=>e?s:o}}makeOutsideCorner(){const e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,i=(1-Math.SQRT1_2)*(e-t)+t,n=qs(i,i)+eo("a","0 0,1",e-t,Ys(e-i,-i+t)),s=qs(t,e)+eo("a","0 0,1",e-t,Ys(e,-e+t)),o=-i,r=qs(i,o)+eo("a","0 0,1",e-t,Ys(-i+t,-o-e));return{height:e,topLeft:e=>e?n:s,bottomLeft:()=>r}}makePuzzleTab(){const e=this.constantProvider.TAB_WIDTH,t=this.constantProvider.TAB_HEIGHT,i=qs(-2,3.4-t)+Js(-.45*e,-2.1),n=Qs("v",2.5)+qs(.97*-e,2.5)+zs("q",[Ys(.05*-e,10),Ys(.3*e,9.5)])+qs(.67*e,-1.9)+Qs("v",2.5),s=Qs("v",-1.5)+qs(-.92*e,-.5)+zs("q",[Ys(-.19*e,-5.5),Ys(0,-11)])+qs(.92*e,1),o=qs(-5,t-.7)+Js(.46*e,-2.1);return{width:e,height:t,pathUp:e=>e?i:s,pathDown:e=>e?n:o}}makeNotch(){return{pathLeft:Qs("h",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}}makeJaggedTeeth(){return{pathLeft:Js(5.1,2.6)+qs(-10.2,6.8)+Js(5.1,2.6),height:12,width:10.2}}makeStartHat(){const e=this.constantProvider.START_HAT.height,t=qs(25,-8.7)+zs("c",[Ys(29.7,-6.2),Ys(57.2,-.5),Ys(75,8.7)]),i=zs("c",[Ys(17.8,-9.2),Ys(45.3,-14.9),Ys(75,-8.7)])+Ks(100.5,e+.5);return{path:e=>e?t:i}}},wg=class extends Jh{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)}},Lg=class extends Zh{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)}},xg=class extends fd{constructor(e,t){super(e,t),this.renderer_=e}getRenderer(){return this.renderer_}populateBottomRow_(){super.populateBottomRow_(),this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof md||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)}addInput_(e,t){this.isInline&&e instanceof Hr.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new wg(this.constants_,e)),t.hasInlineInput=!0):e instanceof md?(t.elements.push(new Lg(this.constants_,e)),t.hasStatement=!0):e instanceof Hr.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new Xh(this.constants_,e)),t.hasExternalInput=!0):(e instanceof pd||e instanceof gd)&&(t.minHeight=Math.max(t.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),this.isInline||null!==t.align||(t.align=e.align)}addElemSpacing_(){let e=!1;for(let t,i=0;t=this.rows[i];i++)t.hasExternalInput&&(e=!0);for(let i,n=0;i=this.rows[n];n++){var t=i.elements;if(i.elements=[],i.startsWithElemSpacer()&&i.elements.push(new qh(this.constants_,this.getInRowSpacing_(null,t[0]))),t.length){for(let e=0;e<t.length-1;e++){i.elements.push(t[e]);const n=this.getInRowSpacing_(t[e],t[e+1]);i.elements.push(new qh(this.constants_,n))}i.elements.push(t[t.length-1]),i.endsWithElemSpacer()&&(t=this.getInRowSpacing_(t[t.length-1],null),e&&i.hasDummyInput&&(t+=this.constants_.TAB_WIDTH),i.elements.push(new qh(this.constants_,t)))}}}getInRowSpacing_(e,t){if(!e)return t&&Uh.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&Uh.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&Uh.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!Uh.isInput(e)&&(!t||Uh.isStatementInput(t)))return Uh.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:Uh.isIcon(e)?2*this.constants_.LARGE_PADDING+1:Uh.isHat(e)?this.constants_.NO_PADDING:Uh.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:Uh.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:Uh.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(Uh.isInput(e)&&!t){if(Uh.isExternalInput(e))return this.constants_.NO_PADDING;if(Uh.isInlineInput(e))return this.constants_.LARGE_PADDING;if(Uh.isStatementInput(e))return this.constants_.NO_PADDING}if(!Uh.isInput(e)&&t&&Uh.isInput(t)){if(Uh.isField(e)&&e.isEditable){if(Uh.isInlineInput(t)||Uh.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(Uh.isInlineInput(t)||Uh.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(Uh.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(Uh.isIcon(e)&&t&&!Uh.isInput(t))return this.constants_.LARGE_PADDING;if(Uh.isInlineInput(e)&&t&&Uh.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(Uh.isLeftSquareCorner(e)&&t){if(Uh.isHat(t))return this.constants_.NO_PADDING;if(Uh.isPreviousConnection(t))return t.notchOffset;if(Uh.isNextConnection(t))return t.notchOffset+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}if(Uh.isLeftRoundedCorner(e)&&t){if(Uh.isPreviousConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS;if(Uh.isNextConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}return Uh.isField(e)&&t&&Uh.isField(t)&&e.isEditable===t.isEditable||t&&Uh.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return Uh.isTopRow(e)&&Uh.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:Uh.isTopRow(e)||Uh.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||!e.hasStatement&&t.hasDummyInput||e.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){if(Uh.isSpacer(t))return e.yPos+t.height/2;if(Uh.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,Uh.isNextConnection(t)?e+t.height/2:e-t.height/2;if(Uh.isTopRow(e))return Uh.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;let i=e.yPos;return Uh.isField(t)||Uh.isIcon(t)?(i+=t.height/2,(e.hasInlineInput||e.hasStatement)&&t.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=e.height&&(i+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):i=Uh.isInlineInput(t)?i+t.height/2:i+e.height/2,i}alignRowElements_(){if(this.isInline){var e=0,t=new WeakMap,i=null;for(let n,s=this.rows.length-1;n=this.rows[s];s--)t.set(n,e),Uh.isInputRow(n)&&(n.hasStatement&&this.alignStatementRow_(n),i&&i.hasStatement&&n.width<i.width?t.set(n,i.width):e=n.hasStatement?n.width:Math.max(e,n.width),i=n);e=0;for(let n,s=0;n=this.rows[s];s++)n.hasStatement?e=this.getDesiredRowWidth_(n):Uh.isSpacer(n)?n.width=Math.max(e,t.get(n)):(i=n.width,0<(e=Math.max(e,t.get(n))-i)&&this.addAlignmentPadding_(n,e),e=n.width)}else super.alignRowElements_()}getDesiredRowWidth_(e){return this.isInline&&e.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:super.getDesiredRowWidth_(e)}finalize_(){let e=0,t=0;for(let n,s=0;n=this.rows[s];s++){n.yPos=t,n.xPos=this.startX,t+=n.height,e=Math.max(e,n.widthWithConnectedBlocks);var i=t-this.topRow.ascenderHeight;n===this.bottomRow&&i<this.constants_.MIN_BLOCK_HEIGHT&&(i=this.constants_.MIN_BLOCK_HEIGHT-i,this.bottomRow.height+=i,t+=i),this.recordElemPositions_(n)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(i=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,i.getHeightWidth().width-this.constants_.DARK_PATH_OFFSET)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX+this.constants_.DARK_PATH_OFFSET,this.width+=this.constants_.DARK_PATH_OFFSET,this.height=t+this.constants_.DARK_PATH_OFFSET,this.startY=this.topRow.capline}},$g=class extends Cd{constructor(e,t,i){super(e,t,i),this.constants=i,this.colourDark="#000000",this.svgPathDark=ee(_l.PATH,{class:"blocklyPathDark",transform:"translate(1,1)"}),this.svgRoot.insertBefore(this.svgPathDark,this.svgPath),this.svgPathLight=ee(_l.PATH,{class:"blocklyPathLight"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e),this.svgPathDark.setAttribute("d",e)}setHighlightPath(e){this.svgPathLight.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)"),this.svgPathLight.setAttribute("transform","scale(-1 1)"),this.svgPathDark.setAttribute("transform","translate(1,1) scale(-1 1)")}applyColour(e){if(this.svgPathLight.style.display="",this.svgPathDark.style.display="",!this.style.colourTertiary)throw Error("The renderer did not properly initialize the tertiary colour of the block style");this.svgPathLight.setAttribute("stroke",this.style.colourTertiary),this.svgPathDark.setAttribute("fill",this.colourDark),super.applyColour(e),this.svgPath.setAttribute("stroke","none")}setStyle(e){this.style=e,this.colourDark=pn("#000",this.style.colourPrimary,.2)||this.colourDark}updateHighlighted(e){e?(this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"),this.svgPathLight.style.display="none"):(this.svgPath.setAttribute("filter","none"),this.svgPathLight.style.display="inline")}updateShadow_(e){if(e){if(this.svgPathLight.style.display="none",!this.style.colourSecondary)throw Error("The renderer did not properly initialize the secondary colour of the block style block style");this.svgPathDark.setAttribute("fill",this.style.colourSecondary),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary)}}updateDisabled_(e){super.updateDisabled_(e),e&&this.svgPath.setAttribute("stroke","none")}},Dg=class extends Ad{constructor(e){super(e),this.highlightConstants=null}init(e,t){super.init(e,t),this.highlightConstants=this.makeHighlightConstants_(),this.highlightConstants.init()}refreshDom(e,t){super.refreshDom(e,t),this.getHighlightConstants().init()}makeConstants_(){return new Ng}makeRenderInfo_(e){return new xg(this,e)}makeDrawer_(e,t){return new Sg(e,t)}makePathObject(e,t){return new $g(e,t,this.getConstants())}makeHighlightConstants_(){return new Rg(this.getConstants())}getHighlightConstants(){if(!this.highlightConstants)throw Error("Cannot access the highlight constants because init has not been called");return this.highlightConstants}};vo("geras",Dg);var Mg={};Mg.ConstantProvider=Ng,Mg.Drawer=Sg,Mg.HighlightConstantProvider=Rg,Mg.Highlighter=Ag,Mg.InlineInput=wg,Mg.PathObject=$g,Mg.RenderInfo=xg,Mg.Renderer=Dg,Mg.StatementInput=Lg;var Pg=class extends fd{constructor(e,t){super(e,t)}getRenderer(){return this.renderer_}addElemSpacing_(){let e=!1;for(var t=0;t<this.rows.length;t++)if(this.rows[t].hasExternalInput){e=!0;break}for(t=0;t<this.rows.length;t++){const n=this.rows[t];var i=n.elements;if(n.elements=[],n.startsWithElemSpacer()&&n.elements.push(new qh(this.constants_,this.getInRowSpacing_(null,i[0]))),i.length){for(let e=0;e<i.length-1;e++){n.elements.push(i[e]);const t=this.getInRowSpacing_(i[e],i[e+1]);n.elements.push(new qh(this.constants_,t))}n.elements.push(i[i.length-1]),n.endsWithElemSpacer()&&(i=this.getInRowSpacing_(i[i.length-1],null),e&&n.hasDummyInput&&(i+=this.constants_.TAB_WIDTH),n.elements.push(new qh(this.constants_,i)))}}}getInRowSpacing_(e,t){if(!e)return t&&Uh.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&Uh.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&Uh.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!Uh.isInput(e)&&!t)return Uh.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:Uh.isIcon(e)?2*this.constants_.LARGE_PADDING+1:Uh.isHat(e)?this.constants_.NO_PADDING:Uh.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:Uh.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:Uh.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(Uh.isInput(e)&&!t){if(Uh.isExternalInput(e))return this.constants_.NO_PADDING;if(Uh.isInlineInput(e))return this.constants_.LARGE_PADDING;if(Uh.isStatementInput(e))return this.constants_.NO_PADDING}if(!Uh.isInput(e)&&t&&Uh.isInput(t)){if(Uh.isField(e)&&e.isEditable){if(Uh.isInlineInput(t)||Uh.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(Uh.isInlineInput(t)||Uh.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(Uh.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(Uh.isIcon(e)&&t&&!Uh.isInput(t))return this.constants_.LARGE_PADDING;if(Uh.isInlineInput(e)&&t&&Uh.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(Uh.isLeftSquareCorner(e)&&t){if(Uh.isHat(t))return this.constants_.NO_PADDING;if(Uh.isPreviousConnection(t)||Uh.isNextConnection(t))return t.notchOffset}return Uh.isLeftRoundedCorner(e)&&t?t.notchOffset-this.constants_.CORNER_RADIUS:Uh.isField(e)&&t&&Uh.isField(t)&&e.isEditable===t.isEditable||t&&Uh.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return Uh.isTopRow(e)&&Uh.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:Uh.isTopRow(e)||Uh.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||e.hasDummyInput||t.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){if(Uh.isSpacer(t))return e.yPos+t.height/2;if(Uh.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,Uh.isNextConnection(t)?e+t.height/2:e-t.height/2;if(Uh.isTopRow(e))return Uh.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;let i=e.yPos;return Uh.isField(t)&&e.hasStatement?i+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+t.height/2):i+e.height/2}finalize_(){let e=0,t=0;for(var i=0;i<this.rows.length;i++){const s=this.rows[i];s.yPos=t,s.xPos=this.startX,t+=s.height,e=Math.max(e,s.widthWithConnectedBlocks);var n=t-this.topRow.ascenderHeight;s===this.bottomRow&&n<this.constants_.MIN_BLOCK_HEIGHT&&(n=this.constants_.MIN_BLOCK_HEIGHT-n,this.bottomRow.height+=n,t+=n),this.recordElemPositions_(s)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(i=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,i.getHeightWidth().width)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX,this.height=t,this.startY=this.topRow.capline}},Bg=class extends Ad{constructor(e){super(e)}makeRenderInfo_(e){return new Pg(this,e)}};vo("thrasos",Bg);var Fg={};Fg.RenderInfo=Pg,Fg.Renderer=Bg;var Ug=new uh("zelos",{colour_blocks:{colourPrimary:"#CF63CF",colourSecondary:"#C94FC9",colourTertiary:"#BD42BD"},list_blocks:{colourPrimary:"#9966FF",colourSecondary:"#855CD6",colourTertiary:"#774DCB"},logic_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC"},loop_blocks:{colourPrimary:"#0fBD8C",colourSecondary:"#0DA57A",colourTertiary:"#0B8E69"},math_blocks:{colourPrimary:"#59C059",colourSecondary:"#46B946",colourTertiary:"#389438"},procedure_blocks:{colourPrimary:"#FF6680",colourSecondary:"#FF4D6A",colourTertiary:"#FF3355"},text_blocks:{colourPrimary:"#FFBF00",colourSecondary:"#E6AC00",colourTertiary:"#CC9900"},variable_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},variable_dynamic_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},hat_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC",hat:"cap"}},{colour_category:{colour:"#CF63CF"},list_category:{colour:"#9966FF"},logic_category:{colour:"#4C97FF"},loop_category:{colour:"#0fBD8C"},math_category:{colour:"#59C059"},procedure_category:{colour:"#FF6680"},text_category:{colour:"#FFBF00"},variable_category:{colour:"#FF8C1A"},variable_dynamic_category:{colour:"#FF8C1A"}}),Hg={Classic:hh,Zelos:Ug},Gg=class{constructor(e,t,i){this.id_=e.toolboxitemid||u(),this.level_=(this.parent_=i||null)?this.parent_.getLevel()+1:0,this.toolboxItemDef_=e,this.parentToolbox_=t,this.workspace_=this.parentToolbox_.getWorkspace()}init(){}getDiv(){return null}getClickTarget(){return null}getId(){return this.id_}getParent(){return null}getLevel(){return this.level_}isSelectable(){return!1}isCollapsible(){return!1}dispose(){}setVisible_(e){}},Vg=class extends Gg{constructor(e,t,i){super(e,t,i),this.colour_=this.name_="",this.labelDom_=this.iconDom_=this.rowContents_=this.rowDiv_=this.htmlDiv_=null,this.isDisabled_=this.isHidden_=!1,this.flyoutItems_=[],this.cssConfig_=this.makeDefaultCssConfig_()}init(){this.parseCategoryDef_(this.toolboxItemDef_),this.parseContents_(this.toolboxItemDef_),this.createDom_(),"true"===this.toolboxItemDef_.hidden&&this.hide()}makeDefaultCssConfig_(){return{container:"blocklyToolboxCategory",row:"blocklyTreeRow",rowcontentcontainer:"blocklyTreeRowContentContainer",icon:"blocklyTreeIcon",label:"blocklyTreeLabel",contents:"blocklyToolboxContents",selected:"blocklyTreeSelected",openicon:"blocklyTreeIconOpen",closedicon:"blocklyTreeIconClosed"}}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else if(e=e.contents)for(let t=0;t<e.length;t++){const i=e[t];Array.isArray(this.flyoutItems_)&&this.flyoutItems_.push(i)}}parseCategoryDef_(e){this.name_="name"in e?_n(e.name):"",this.colour_=this.getColour_(e),Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}createDom_(){this.htmlDiv_=this.createContainer_(),xt(this.htmlDiv_,kc.TREEITEM),$t(this.htmlDiv_,Oc.SELECTED,!1),$t(this.htmlDiv_,Oc.LEVEL,this.level_+1),this.rowDiv_=this.createRowContainer_(),this.rowDiv_.style.pointerEvents="auto",this.htmlDiv_.appendChild(this.rowDiv_),this.rowContents_=this.createRowContentsContainer_(),this.rowContents_.style.pointerEvents="none",this.rowDiv_.appendChild(this.rowContents_),this.iconDom_=this.createIconDom_(),xt(this.iconDom_,kc.PRESENTATION),this.rowContents_.appendChild(this.iconDom_),this.labelDom_=this.createLabelDom_(this.name_),this.rowContents_.appendChild(this.labelDom_);const e=this.labelDom_.getAttribute("id");return e&&$t(this.htmlDiv_,Oc.LABELLEDBY,e),this.addColourBorder_(this.colour_),this.htmlDiv_}createContainer_(){const e=document.createElement("div"),t=this.cssConfig_.container;return t&&te(e,t),e}createRowContainer_(){const e=document.createElement("div");var t=this.cssConfig_.row;return t&&te(e,t),t=Vg.nestedPadding*this.getLevel()+"px",this.workspace_.RTL?e.style.paddingRight=t:e.style.paddingLeft=t,e}createRowContentsContainer_(){const e=document.createElement("div"),t=this.cssConfig_.rowcontentcontainer;return t&&te(e,t),e}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const t=this.cssConfig_.icon;t&&te(e,t)}return e.style.display="inline-block",e}createLabelDom_(e){const t=document.createElement("span");return t.setAttribute("id",this.getId()+".label"),t.textContent=e,(e=this.cssConfig_.label)&&te(t,e),t}refreshTheme(){this.colour_=this.getColour_(this.toolboxItemDef_),this.addColourBorder_(this.colour_)}addColourBorder_(e){e&&(e=Vg.borderWidth+"px solid "+(e||"#ddd"),this.workspace_.RTL?this.rowDiv_.style.borderRight=e:this.rowDiv_.style.borderLeft=e)}getColour_(e){const t=e.categorystyle||e.categoryStyle;if((e=e.colour)&&t)console.warn('Toolbox category "'+this.name_+'" must not have both a style and a colour');else{if(t)return this.getColourfromStyle_(t);if(e)return this.parseColour_(e)}return""}getColourfromStyle_(e){var t=this.workspace_.getTheme();if(e&&t){if((t=t.categoryStyles[e])&&t.colour)return this.parseColour_(t.colour);console.warn('Style "'+e+'" must exist and contain a colour value')}return""}getClickTarget(){return this.rowDiv_}parseColour_(e){if(null==(e=_n(e))||""===e)return"";var t=Number(e);return isNaN(t)?(t=cn(e))?t:(console.warn('Toolbox category "'+this.name_+'" has unrecognized colour attribute: '+e),""):gn(t)}openIcon_(e){if(e){var t=this.cssConfig_.closedicon;t&&ie(e,t),(t=this.cssConfig_.openicon)&&te(e,t)}}closeIcon_(e){if(e){var t=this.cssConfig_.openicon;t&&ie(e,t),(t=this.cssConfig_.closedicon)&&te(e,t)}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none",this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}hide(){this.setVisible_(!1)}show(){this.setVisible_(!0)}isVisible(){return!this.isHidden_&&this.allAncestorsExpanded_()}allAncestorsExpanded_(){let e=this;for(;e.getParent();)if(!(e=e.getParent()).isExpanded())return!1;return!0}isSelectable(){return this.isVisible()&&!this.isDisabled_}onClick(e){}setSelected(e){if(this.rowDiv_){var t=this.cssConfig_.selected;if(e){const e=this.parseColour_(Vg.defaultBackgroundColour);this.rowDiv_.style.backgroundColor=this.colour_||e,t&&te(this.rowDiv_,t)}else this.rowDiv_.style.backgroundColor="",t&&ne(this.rowDiv_,t);$t(this.htmlDiv_,Oc.SELECTED,e)}}setDisabled(e){this.isDisabled_=e,this.getDiv().setAttribute("disabled",`${e}`),e?this.getDiv().setAttribute("disabled","true"):this.getDiv().removeAttribute("disabled")}getName(){return this.name_}getParent(){return this.parent_}getDiv(){return this.htmlDiv_}getContents(){return this.flyoutItems_}updateFlyoutContents(e){this.flyoutItems_=[],this.toolboxItemDef_="string"==typeof e?{kind:this.toolboxItemDef_.kind,custom:e,id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden}:{kind:this.toolboxItemDef_.kind,name:"name"in this.toolboxItemDef_?this.toolboxItemDef_.name:"",contents:$e(e),id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden},this.parseContents_(this.toolboxItemDef_)}dispose(){oe(this.htmlDiv_)}};Vg.registrationName="category",Vg.nestedPadding=19,Vg.borderWidth=8,Vg.defaultBackgroundColour="#57e",Z('\n.blocklyTreeRow:not(.blocklyTreeSelected):hover {\n  background-color: rgba(255, 255, 255, .2);\n}\n\n.blocklyToolboxDiv[layout="h"] .blocklyToolboxCategory {\n  margin: 1px 5px 1px 0;\n}\n\n.blocklyToolboxDiv[dir="RTL"][layout="h"] .blocklyToolboxCategory {\n  margin: 1px 0 1px 5px;\n}\n\n.blocklyTreeRow {\n  height: 22px;\n  line-height: 22px;\n  margin-bottom: 3px;\n  padding-right: 8px;\n  white-space: nowrap;\n}\n\n.blocklyToolboxDiv[dir="RTL"] .blocklyTreeRow {\n  margin-left: 8px;\n  padding-right: 0;\n}\n\n.blocklyTreeIcon {\n  background-image: url(<<<PATH>>>/sprites.png);\n  height: 16px;\n  vertical-align: middle;\n  visibility: hidden;\n  width: 16px;\n}\n\n.blocklyTreeIconClosed {\n  background-position: -32px -1px;\n}\n\n.blocklyToolboxDiv[dir="RTL"] .blocklyTreeIconClosed {\n  background-position: 0 -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: -32px -17px;\n}\n\n.blocklyToolboxDiv[dir="RTL"] .blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: 0 -17px;\n}\n\n.blocklyTreeIconOpen {\n  background-position: -16px -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconOpen {\n  background-position: -16px -17px;\n}\n\n.blocklyTreeLabel {\n  cursor: default;\n  font: 16px sans-serif;\n  padding: 0 3px;\n  vertical-align: middle;\n}\n\n.blocklyToolboxDelete .blocklyTreeLabel {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyTreeSelected .blocklyTreeLabel {\n  color: #fff;\n}\n'),t(Xr.TOOLBOX_ITEM,Vg.registrationName,Vg);var jg=class extends Gg{constructor(e,t){super(e,t),this.cssConfig_={container:"blocklyTreeSeparator"},this.htmlDiv_=null,Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}init(){this.createDom_()}createDom_(){const e=document.createElement("div"),t=this.cssConfig_.container;return t&&te(e,t),this.htmlDiv_=e}getDiv(){return this.htmlDiv_}dispose(){oe(this.htmlDiv_)}};jg.registrationName="sep",Z('\n.blocklyTreeSeparator {\n  border-bottom: solid #e5e5e5 1px;\n  height: 0;\n  margin: 5px 0;\n}\n\n.blocklyToolboxDiv[layout="h"] .blocklyTreeSeparator {\n  border-right: solid #e5e5e5 1px;\n  border-bottom: none;\n  height: auto;\n  margin: 0 5px 0 5px;\n  padding: 5px 0;\n  width: 0;\n}\n'),t(Xr.TOOLBOX_ITEM,jg.registrationName,jg);var Wg=class extends Vg{constructor(e,t,i){super(e,t,i),this.subcategoriesDiv_=null,this.expanded_=!1,this.toolboxItems_=[]}makeDefaultCssConfig_(){const e=super.makeDefaultCssConfig_();return e.contents="blocklyToolboxContents",e}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else{const t=e.contents;if(t){this.flyoutItems_=[],e=!0;for(let i=0;i<t.length;i++){const n=t[i];!o(Xr.TOOLBOX_ITEM,n.kind)||n.kind.toLowerCase()===jg.registrationName&&e?(this.flyoutItems_.push(n),e=!0):(this.createToolboxItem_(n),e=!1)}}}}createToolboxItem_(e){let t=e.kind;"CATEGORY"===t.toUpperCase()&&Pe(e)&&(t=Wg.registrationName),e=new(r(Xr.TOOLBOX_ITEM,t))(e,this.parentToolbox_,this),this.toolboxItems_.push(e)}init(){super.init(),this.setExpanded("true"===this.toolboxItemDef_.expanded||!0===this.toolboxItemDef_.expanded)}createDom_(){super.createDom_();const e=this.getChildToolboxItems();return this.subcategoriesDiv_=this.createSubCategoriesDom_(e),xt(this.subcategoriesDiv_,kc.GROUP),this.htmlDiv_.appendChild(this.subcategoriesDiv_),this.closeIcon_(this.iconDom_),$t(this.htmlDiv_,Oc.EXPANDED,!1),this.htmlDiv_}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const t=this.cssConfig_.icon;t&&te(e,t),e.style.visibility="visible"}return e.style.display="inline-block",e}createSubCategoriesDom_(e){const t=document.createElement("div");t.style.display="none";var i=this.cssConfig_.contents;for(i&&te(t,i),i=0;i<e.length;i++){const n=e[i];n.init();const s=n.getDiv();if(t.appendChild(s),n.getClickTarget){let e;null==(e=n.getClickTarget())||e.setAttribute("id",n.getId())}}return t}setExpanded(e){if(this.expanded_!==e){if(this.expanded_=e)this.subcategoriesDiv_.style.display="block",this.openIcon_(this.iconDom_);else{let e;null==(e=this.parentToolbox_.getFlyout())||e.setVisible(!1),this.subcategoriesDiv_.style.display="none",this.closeIcon_(this.iconDom_)}$t(this.htmlDiv_,Oc.EXPANDED,e),this.parentToolbox_.handleToolboxItemResize()}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none";const t=this.getChildToolboxItems();for(let i=0;i<t.length;i++)t[i].setVisible_(e);this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}isExpanded(){return this.expanded_}isCollapsible(){return!0}onClick(e){this.toggleExpanded()}toggleExpanded(){this.setExpanded(!this.expanded_)}getDiv(){return this.htmlDiv_}getChildToolboxItems(){return this.toolboxItems_}};Wg.registrationName="collapsibleCategory",t(Xr.TOOLBOX_ITEM,Wg.registrationName,Wg);var Xg=class extends ip{constructor(e){super(),this.id="toolbox",this.contentsDiv_=this.HtmlDiv=null,this.isVisible_=!1,this.contents_=[],this.height_=this.width_=0,this.previouslySelectedItem_=this.selectedItem_=this.flyout_=null,this.boundEvents_=[],this.workspace_=e,this.toolboxDef_=e.options.languageTree||{contents:[]},this.horizontalLayout_=e.options.horizontalLayout,this.RTL=e.options.RTL,this.contentMap_=Object.create(null),this.toolboxPosition=e.options.toolboxPosition}onShortcut(e){return!1}init(){var e=this.workspace_;const t=e.getParentSvg();this.flyout_=this.createFlyout_(),this.HtmlDiv=this.createDom_(this.workspace_),re(this.flyout_.createDom("svg"),t),this.setVisible(!0),this.flyout_.init(e),this.render(this.toolboxDef_),(e=e.getThemeManager()).subscribe(this.HtmlDiv,"toolboxBackgroundColour","background-color"),e.subscribe(this.HtmlDiv,"toolboxForegroundColour","color"),this.workspace_.getComponentManager().addComponent({component:this,weight:1,capabilities:[sl.Capability.AUTOHIDEABLE,sl.Capability.DELETE_AREA,sl.Capability.DRAG_TARGET]})}createDom_(e){e=e.getParentSvg();const t=this.createContainer_();return this.contentsDiv_=this.createContentsContainer_(),this.contentsDiv_.tabIndex=0,xt(this.contentsDiv_,kc.TREE),t.appendChild(this.contentsDiv_),e.parentNode.insertBefore(t,e),this.attachEvents_(t,this.contentsDiv_),t}createContainer_(){const e=document.createElement("div");return e.setAttribute("layout",this.isHorizontal()?"h":"v"),te(e,"blocklyToolboxDiv"),te(e,"blocklyNonSelectable"),e.setAttribute("dir",this.RTL?"RTL":"LTR"),e}createContentsContainer_(){const e=document.createElement("div");return te(e,"blocklyToolboxContents"),this.isHorizontal()&&(e.style.flexDirection="row"),e}attachEvents_(e,t){e=j(e,"pointerdown",this,this.onClick_,!1),this.boundEvents_.push(e),t=j(t,"keydown",this,this.onKeyDown_,!1),this.boundEvents_.push(t)}onClick_(e){if(z(e)||e.target===this.HtmlDiv)A().hideChaff(!1);else{var t=e.target.getAttribute("id");t&&(t=this.getToolboxItemById(t)).isSelectable()&&(this.setSelectedItem(t),t.onClick(e)),A().hideChaff(!0)}U()}onKeyDown_(e){let t=!1;switch(e.key){case"ArrowDown":t=this.selectNext_();break;case"ArrowUp":t=this.selectPrevious_();break;case"ArrowLeft":t=this.selectParent_();break;case"ArrowRight":t=this.selectChild_();break;case"Enter":case" ":this.selectedItem_&&this.selectedItem_.isCollapsible()&&(this.selectedItem_.toggleExpanded(),t=!0);break;default:t=!1}!t&&this.selectedItem_&&this.selectedItem_.onKeyDown&&(t=this.selectedItem_.onKeyDown(e)),t&&e.preventDefault()}createFlyout_(){const e=this.workspace_,t=new dh({parentWorkspace:e,rtl:e.RTL,oneBasedIndex:e.options.oneBasedIndex,horizontalLayout:e.horizontalLayout,renderer:e.options.renderer,rendererOverrides:e.options.rendererOverrides,move:{scrollbars:!0}});return t.toolboxPosition=e.options.toolboxPosition,new(e.horizontalLayout?c(Xr.FLYOUTS_HORIZONTAL_TOOLBOX,e.options,!0):c(Xr.FLYOUTS_VERTICAL_TOOLBOX,e.options,!0))(t)}render(e){this.toolboxDef_=e;for(let e=0;e<this.contents_.length;e++){const t=this.contents_[e];t&&t.dispose()}this.contents_=[],this.contentMap_=Object.create(null),this.renderContents_(e.contents),this.position(),this.handleToolboxItemResize()}renderContents_(e){const t=document.createDocumentFragment();for(let i=0;i<e.length;i++)this.createToolboxItem_(e[i],t);this.contentsDiv_.appendChild(t)}createToolboxItem_(e,t){var i=e.kind;"CATEGORY"===i.toUpperCase()&&Pe(e)&&(i=Wg.registrationName),(i=r(Xr.TOOLBOX_ITEM,i.toLowerCase()))&&((e=new i(e,this)).init(),this.addToolboxItem_(e),(i=e.getDiv())&&t.appendChild(i),e.getClickTarget()&&e.getClickTarget().setAttribute("id",e.getId()))}addToolboxItem_(e){if(this.contents_.push(e),this.contentMap_[e.getId()]=e,e.isCollapsible()){e=e.getChildToolboxItems();for(let t=0;t<e.length;t++)this.addToolboxItem_(e[t])}}getToolboxItems(){return this.contents_}addStyle(e){e&&this.HtmlDiv&&te(this.HtmlDiv,e)}removeStyle(e){e&&this.HtmlDiv&&ne(this.HtmlDiv,e)}getClientRect(){if(!this.HtmlDiv||!this.isVisible_)return null;var e=this.HtmlDiv.getBoundingClientRect();const t=e.top,i=t+e.height,n=e.left;return e=n+e.width,this.toolboxPosition===$l.TOP?new Tl(-1e7,i,-1e7,1e7):this.toolboxPosition===$l.BOTTOM?new Tl(t,1e7,-1e7,1e7):this.toolboxPosition===$l.LEFT?new Tl(-1e7,1e7,-1e7,e):new Tl(-1e7,1e7,n,1e7)}wouldDelete(e){return e instanceof ep?this.updateWouldDelete_(!e.getParent()&&e.isDeletable()):this.updateWouldDelete_(Fo(e)&&e.isDeletable()),this.wouldDelete_}onDragEnter(e){this.updateCursorDeleteStyle_(!0)}onDragExit(e){this.updateCursorDeleteStyle_(!1)}onDrop(e){this.updateCursorDeleteStyle_(!1)}updateWouldDelete_(e){e!==this.wouldDelete_&&(this.updateCursorDeleteStyle_(!1),this.wouldDelete_=e,this.updateCursorDeleteStyle_(!0))}updateCursorDeleteStyle_(e){const t=this.wouldDelete_?"blocklyToolboxDelete":"blocklyToolboxGrab";e?this.addStyle(t):this.removeStyle(t)}getToolboxItemById(e){return this.contentMap_[e]||null}getWidth(){return this.width_}getHeight(){return this.height_}getFlyout(){return this.flyout_}getWorkspace(){return this.workspace_}getSelectedItem(){return this.selectedItem_}getPreviouslySelectedItem(){return this.previouslySelectedItem_}isHorizontal(){return this.horizontalLayout_}position(){const e=this.workspace_.getMetrics(),t=this.HtmlDiv;t&&(this.horizontalLayout_?(t.style.left="0",t.style.height="auto",t.style.width="100%",this.height_=t.offsetHeight,this.width_=e.viewWidth,this.toolboxPosition===$l.TOP?t.style.top="0":t.style.bottom="0"):(this.toolboxPosition===$l.RIGHT?t.style.right="0":t.style.left="0",t.style.height="100%",this.width_=t.offsetWidth,this.height_=e.viewHeight),this.flyout_.position())}handleToolboxItemResize(){const e=this.workspace_,t=this.HtmlDiv.getBoundingClientRect();e.translate(this.toolboxPosition===$l.LEFT?e.scrollX+t.width:e.scrollX,this.toolboxPosition===$l.TOP?e.scrollY+t.height:e.scrollY),x(e)}clearSelection(){this.setSelectedItem(null)}refreshTheme(){for(let e=0;e<this.contents_.length;e++){const t=this.contents_[e];t.refreshTheme&&t.refreshTheme()}}refreshSelection(){this.selectedItem_&&this.selectedItem_.isSelectable()&&this.selectedItem_.getContents().length&&this.flyout_.show(this.selectedItem_.getContents())}setVisible(e){this.isVisible_!==e&&(this.HtmlDiv.style.display=e?"block":"none",this.isVisible_=e,this.workspace_.recordDragTargets())}autoHide(e){!e&&this.flyout_&&this.flyout_.autoClose&&this.clearSelection()}setSelectedItem(e){const t=this.selectedItem_;!e&&!t||e&&!Br(e)||(this.shouldDeselectItem_(t,e)&&null!==t&&this.deselectItem_(t),this.shouldSelectItem_(t,e)&&null!==e&&this.selectItem_(t,e),this.updateFlyout_(t,e),this.fireSelectEvent_(t,e))}shouldDeselectItem_(e,t){return null!==e&&(!e.isCollapsible()||e!==t)}shouldSelectItem_(e,t){return null!==t&&t!==e}deselectItem_(e){this.selectedItem_=null,this.previouslySelectedItem_=e,e.setSelected(!1),$t(this.contentsDiv_,Oc.ACTIVEDESCENDANT,"")}selectItem_(e,t){this.selectedItem_=t,this.previouslySelectedItem_=e,t.setSelected(!0),$t(this.contentsDiv_,Oc.ACTIVEDESCENDANT,t.getId())}selectItemByPosition(e){-1<e&&e<this.contents_.length&&(e=this.contents_[e]).isSelectable()&&this.setSelectedItem(e)}updateFlyout_(e,t){t&&(e!==t||t.isCollapsible())&&t.getContents().length?(this.flyout_.show(t.getContents()),this.flyout_.scrollToStart()):this.flyout_.hide()}fireSelectEvent_(e,t){const i=e&&e.getName();let n=t&&t.getName();e===t&&(n=null),e=new(y("toolbox_item_select"))(i,n,this.workspace_.id),p(e)}selectParent_(){return!(!this.selectedItem_||(this.selectedItem_.isCollapsible()&&this.selectedItem_.isExpanded()?(this.selectedItem_.toggleExpanded(),0):!this.selectedItem_.getParent()||!this.selectedItem_.getParent().isSelectable()||(this.setSelectedItem(this.selectedItem_.getParent()),0)))}selectChild_(){if(!this.selectedItem_||!this.selectedItem_.isCollapsible())return!1;const e=this.selectedItem_;return e.isExpanded()?this.selectNext_():e.toggleExpanded(),!0}selectNext_(){if(!this.selectedItem_)return!1;let e=this.contents_.indexOf(this.selectedItem_)+1;if(-1<e&&e<this.contents_.length){let t=this.contents_[e];for(;t&&!t.isSelectable();)t=this.contents_[++e];if(t&&t.isSelectable())return this.setSelectedItem(t),!0}return!1}selectPrevious_(){if(!this.selectedItem_)return!1;let e=this.contents_.indexOf(this.selectedItem_)-1;if(-1<e&&e<this.contents_.length){let t=this.contents_[e];for(;t&&!t.isSelectable();)t=this.contents_[--e];if(t&&t.isSelectable())return this.setSelectedItem(t),!0}return!1}dispose(){this.workspace_.getComponentManager().removeComponent("toolbox"),this.flyout_.dispose();for(var e=0;e<this.contents_.length;e++)this.contents_[e].dispose();for(e=0;e<this.boundEvents_.length;e++)X(this.boundEvents_[e]);this.boundEvents_=[],this.contents_=[],this.HtmlDiv&&(this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv),oe(this.HtmlDiv))}};Z('\n.blocklyToolboxDelete {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyToolboxGrab {\n  cursor: url("<<<PATH>>>/handclosed.cur"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Category tree in Toolbox. */\n.blocklyToolboxDiv {\n  background-color: #ddd;\n  overflow-x: visible;\n  overflow-y: auto;\n  padding: 4px 0 4px 0;\n  position: absolute;\n  z-index: 70;  /* so blocks go under toolbox when dragging */\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\n}\n\n.blocklyToolboxContents {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: column;\n}\n\n.blocklyToolboxContents:focus {\n  outline: none;\n}\n'),t(Xr.TOOLBOX,Wr,Xg);var Yg=eh.INPUT_VALUE,zg=eh.OUTPUT_VALUE,Kg=eh.NEXT_STATEMENT,qg=eh.PREVIOUS_STATEMENT,Jg=$l.TOP,Zg=$l.BOTTOM,Qg=$l.LEFT,em=$l.RIGHT;Pd.prototype.newBlock=function(e,t){return new Ed(this,e,t)},Fd.prototype.newBlock=function(e,t){return new ep(this,e,t)},Pd.prototype.newComment=function(e){return new _c(this,e)},Fd.prototype.newComment=function(e){return new Ku(this,e)},Fd.newTrashcan=function(e){return new np(e)},yh.prototype.newWorkspaceSvg=function(e){return new Fd(e)},Hr.Names$$module$build$src$core$names.prototype.populateProcedures=function(e){e=(e=no(e))[0].concat(e[1]);for(let t=0;t<e.length;t++)this.getName(e[t][0],Hr.Names$$module$build$src$core$names.NameType.PROCEDURE)};var tm={};return tm.ASTNode=Id,tm.BasicCursor=Wd,tm.Block=Ed,tm.BlockSvg=ep,tm.Blocks=da,tm.COLLAPSED_FIELD_NAME="_TEMP_COLLAPSED_FIELD",tm.COLLAPSED_INPUT_NAME="_TEMP_COLLAPSED_INPUT",tm.COLLAPSE_CHARS=30,tm.CodeGenerator=Hr.CodeGenerator$$module$build$src$core$generator,tm.CollapsibleToolboxCategory=Wg,tm.ComponentManager=sl,tm.Connection=Td,tm.ConnectionChecker=xd,tm.ConnectionDB=ih,tm.ConnectionType=eh,tm.ContextMenu=Wu,tm.ContextMenuItems=Cg,tm.ContextMenuRegistry=Xu,tm.Css=al,tm.Cursor=jd,tm.DELETE_VARIABLE_ID="DELETE_VARIABLE_ID",tm.DeleteArea=ip,tm.DragTarget=tp,tm.DropDownDiv=ru,tm.Events=yg,tm.Extensions=kh,tm.Field=wu,tm.FieldCheckbox=og,tm.FieldDropdown=_h,tm.FieldImage=Pp,tm.FieldLabel=hd,tm.FieldLabelSerializable=sg,tm.FieldNumber=ng,tm.FieldTextInput=Fp,tm.FieldVariable=ig,tm.Flyout=Qp,tm.FlyoutButton=bd,tm.FlyoutMetricsManager=Zp,tm.Generator=Hr.CodeGenerator$$module$build$src$core$generator,tm.Gesture=ah,tm.Grid=lh,tm.HorizontalFlyout=tg,tm.INPUT_VALUE=Yg,tm.Input=dd,tm.InsertionMarkerManager=kd,tm.InsertionMarkerPreviewer=zp,tm.Marker=Vd,tm.MarkerManager=au,tm.Menu=Rc,tm.MenuItem=wc,tm.MetricsManager=$p,tm.Msg=Hr.Msg$$module$build$src$core$msg,tm.NEXT_STATEMENT=Kg,tm.Names=Hr.Names$$module$build$src$core$names,tm.OPPOSITE_TYPE=Ld,tm.OUTPUT_VALUE=zg,tm.Options=dh,tm.PREVIOUS_STATEMENT=qg,tm.PROCEDURE_CATEGORY_NAME="PROCEDURE",tm.Procedures=Bh,tm.RENAME_VARIABLE_ID="RENAME_VARIABLE_ID",tm.RenderedConnection=Yd,tm.Scrollbar=kl,tm.ScrollbarPair=xp,tm.ShortcutItems=Np,tm.ShortcutRegistry=Tp,tm.TOOLBOX_AT_BOTTOM=Zg,tm.TOOLBOX_AT_LEFT=Qg,tm.TOOLBOX_AT_RIGHT=em,tm.TOOLBOX_AT_TOP=Jg,tm.TabNavigateCursor=Xd,tm.Theme=uh,tm.ThemeManager=Rd,tm.Themes=Hg,tm.Toolbox=Xg,tm.ToolboxCategory=Vg,tm.ToolboxItem=Gg,tm.ToolboxSeparator=jg,tm.Tooltip=ku,tm.Touch=ja,tm.Trashcan=np,tm.UnattachedFieldError=Lu,tm.VARIABLE_CATEGORY_NAME="VARIABLE",tm.VARIABLE_DYNAMIC_CATEGORY_NAME="VARIABLE_DYNAMIC",tm.VERSION="11.1.1",tm.VariableMap=Md,tm.VariableModel=rc,tm.Variables=cc,tm.VariablesDynamic=wd,tm.VerticalFlyout=eg,tm.WidgetDiv=Hu,tm.Workspace=Pd,tm.WorkspaceAudio=Bd,tm.WorkspaceDragger=rh,tm.WorkspaceSvg=Fd,tm.Xml=qu,tm.ZoomControls=Xl,tm.blockAnimations=oh,tm.blockRendering=Sd,tm.browserEvents=tl,tm.bubbles=Og,tm.bumpObjects=Zd,tm.clipboard=vp,tm.comments=kg,tm.common=ya,tm.config=Hr.config$$module$build$src$core$config,tm.constants=zl,tm.defineBlocksWithJsonArray=M,tm.dialog=ic,tm.dragging=ag,tm.fieldRegistry=fh,tm.geras=Mg,tm.getMainWorkspace=A,tm.getSelected=R,tm.hasBubble=oi,tm.hideChaff=Fr,tm.icons=Fh,tm.inject=nr,tm.inputs=Kp,tm.isCopyable=jo,tm.isDeletable=Fo,tm.isDraggable=ys,tm.isIcon=bo,tm.isObservable=ks,tm.isPaster=Dr,tm.isRenderedElement=Mr,tm.isSelectable=Pr,tm.isSerializable=Dt,tm.isVariableBackedParameterModel=Ze,tm.procedures=Bh,tm.registry=Yr,tm.renderManagement=fc,tm.serialization=Lp,tm.setLocale=ql,tm.setParentContainer=L,tm.svgResize=x,tm.thrasos=Fg,tm.uiPosition=Gl,tm.utils=Rh,tm.zelos=vg,tm.__namespace__=Hr,tm},"function"==typeof define&&define.amd?define([],s):"object"==typeof i?t.exports=s():n.Blockly=s()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],202:[function(e,t,i){t.exports=e("./blocks_compressed.js")},{"./blocks_compressed.js":203}],203:[function(e,t,i){var n,s;n=this,s=function(e){var t=e.__namespace__,i=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get_dynamic",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_dynamic_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableDynamicSetterGetter"]},{type:"variables_set_dynamic",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_dynamic_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableDynamicSetterGetter"]}]),n={customContextMenu:function(e){if(this.isInFlyout)"variables_get_dynamic"!==this.type&&"variables_get_reporter_dynamic"!==this.type||(n={text:t.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:s(this)},r=this.getField("VAR").getText(),r={text:t.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",r),enabled:!0,callback:o(this)},e.unshift(n),e.unshift(r));else{if("variables_get_dynamic"===this.type)var i="variables_set_dynamic",n=t.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else i="variables_get_dynamic",n=t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var r=this.getField("VAR");i={type:i,fields:{VAR:r.saveState(!0)}},e.push({enabled:0<this.workspace.remainingCapacity(),text:n.replace("%1",r.getText()),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,i)})}},onchange:function(e){e=this.getFieldValue("VAR"),e=t.getVariable$$module$build$src$core$variables(this.workspace,e),"variables_get_dynamic"===this.type?this.outputConnection.setCheck(e.type):this.getInput("VALUE").connection.setCheck(e.type)}},s=function(e){return function(){const i=e.workspace,n=e.getField("VAR").getVariable();t.renameVariable$$module$build$src$core$variables(i,n)}},o=function(e){return function(){const t=e.workspace,i=e.getField("VAR").getVariable();t.deleteVariableById(i.getId()),t.refreshToolboxSelection()}};t.registerMixin$$module$build$src$core$extensions("contextMenu_variableDynamicSetterGetter",n),t.defineBlocks$$module$build$src$core$common(i);var r={blocks:i},a=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableSetterGetter"]},{type:"variables_set",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableSetterGetter"]}]),l={customContextMenu:function(e){if(this.isInFlyout)"variables_get"!==this.type&&"variables_get_reporter"!==this.type||(n={text:t.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:c(this)},s=this.getField("VAR").getText(),s={text:t.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",s),enabled:!0,callback:u(this)},e.unshift(n),e.unshift(s));else{if("variables_get"===this.type)var i="variables_set",n=t.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else i="variables_get",n=t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var s=this.getField("VAR");i={type:i,fields:{VAR:s.saveState(!0)}},e.push({enabled:0<this.workspace.remainingCapacity(),text:n.replace("%1",s.getText()),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,i)})}}},c=function(e){return function(){const i=e.workspace,n=e.getField("VAR").getVariable();t.renameVariable$$module$build$src$core$variables(i,n)}},u=function(e){return function(){const t=e.workspace,i=e.getField("VAR").getVariable();t.deleteVariableById(i.getId()),t.refreshToolboxSelection()}};t.registerMixin$$module$build$src$core$extensions("contextMenu_variableSetterGetter",l),t.defineBlocks$$module$build$src$core$common(a);var h={blocks:a},d=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"text",message0:"%1",args0:[{type:"field_input",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"text_join",message0:"",output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"text_join_mutator"},{type:"text_create_join_container",message0:"%{BKY_TEXT_CREATE_JOIN_TITLE_JOIN} %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_TOOLTIP}",enableContextMenu:!1},{type:"text_create_join_item",message0:"%{BKY_TEXT_CREATE_JOIN_ITEM_TITLE_ITEM}",previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_ITEM_TOOLTIP}",enableContextMenu:!1},{type:"text_append",message0:"%{BKY_TEXT_APPEND_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_TEXT_APPEND_VARIABLE}"},{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",extensions:["text_append_tooltip"]},{type:"text_length",message0:"%{BKY_TEXT_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"text_blocks",tooltip:"%{BKY_TEXT_LENGTH_TOOLTIP}",helpUrl:"%{BKY_TEXT_LENGTH_HELPURL}"},{type:"text_isEmpty",message0:"%{BKY_TEXT_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"text_blocks",tooltip:"%{BKY_TEXT_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_TEXT_ISEMPTY_HELPURL}"},{type:"text_indexOf",message0:"%{BKY_TEXT_INDEXOF_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"END",options:[["%{BKY_TEXT_INDEXOF_OPERATOR_FIRST}","FIRST"],["%{BKY_TEXT_INDEXOF_OPERATOR_LAST}","LAST"]]},{type:"input_value",name:"FIND",check:"String"}],output:"Number",style:"text_blocks",helpUrl:"%{BKY_TEXT_INDEXOF_HELPURL}",inputsInline:!0,extensions:["text_indexOf_tooltip"]},{type:"text_charAt",message0:"%{BKY_TEXT_CHARAT_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"WHERE",options:[["%{BKY_TEXT_CHARAT_FROM_START}","FROM_START"],["%{BKY_TEXT_CHARAT_FROM_END}","FROM_END"],["%{BKY_TEXT_CHARAT_FIRST}","FIRST"],["%{BKY_TEXT_CHARAT_LAST}","LAST"],["%{BKY_TEXT_CHARAT_RANDOM}","RANDOM"]]}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_CHARAT_HELPURL}",inputsInline:!0,mutator:"text_charAt_mutator"}]),p={init:function(){this.WHERE_OPTIONS_1=[[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_LAST,"LAST"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("STRING").setCheck("String").appendField(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL),this.setInputsInline(!0),this.setOutput(!0,"String"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TOOLTIP)},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");var i=this.getInput("AT1")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at1",`${i}`),i=this.getInput("AT2")instanceof t.ValueInput$$module$build$src$core$inputs$value_input,e.setAttribute("at2",`${i}`),e},domToMutation:function(e){const t="true"===e.getAttribute("at1");e="true"===e.getAttribute("at2"),this.updateAt_(1,t),this.updateAt_(2,e)},updateAt_:function(e,i){this.removeInput("AT"+e),this.removeInput("ORDINAL"+e,!0),i?(this.appendValueInput("AT"+e).setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+e).appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+e),2===e&&t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL));const n=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+e]});n.setValidator((function(t){const n="FROM_START"===t||"FROM_END"===t;if(n!==i){const i=this.getSourceBlock();return i.updateAt_(e,n),i.setFieldValue(t,"WHERE"+e),null}})),this.getInput("AT"+e).appendField(n,"WHERE"+e),1===e&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2"))}};d.text_getSubstring=p,d.text_changeCase={init:function(){const e=[[t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE,"UPPERCASE"],[t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE,"LOWERCASE"],[t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_TITLECASE,"TITLECASE"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),"CASE"),this.setOutput(!0,"String"),this.setTooltip(t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_TOOLTIP)}},d.text_trim={init:function(){const e=[[t.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_BOTH,"BOTH"],[t.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_LEFT,"LEFT"],[t.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_RIGHT,"RIGHT"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_TRIM_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),"MODE"),this.setOutput(!0,"String"),this.setTooltip(t.Msg$$module$build$src$core$msg.TEXT_TRIM_TOOLTIP)}},d.text_print={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_PRINT_TITLE,args0:[{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_PRINT_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_PRINT_HELPURL})}};var g={updateType_:function(e){this.outputConnection.setCheck("NUMBER"===e?"Number":"String")},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("type",this.getFieldValue("TYPE")),e},domToMutation:function(e){this.updateType_(e.getAttribute("type"))}};d.text_prompt_ext=Object.assign({},g,{init:function(){var e=[[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator((e=>{this.updateType_(e)})),this.appendValueInput("TEXT").appendField(e,"TYPE"),this.setOutput(!0,"String"),this.setTooltip((()=>"TEXT"===this.getFieldValue("TYPE")?t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER))}});var m=Object.assign({},g,{init:function(){this.mixin(f);var e=[[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator((e=>{this.updateType_(e)})),this.appendDummyInput().appendField(e,"TYPE").appendField(this.newQuote_(!0)).appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:""}),"TEXT").appendField(this.newQuote_(!1)),this.setOutput(!0,"String"),this.setTooltip((()=>"TEXT"===this.getFieldValue("TYPE")?t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER))}});d.text_prompt=m,d.text_count={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_COUNT_MESSAGE0,args0:[{type:"input_value",name:"SUB",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"Number",inputsInline:!0,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_COUNT_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_COUNT_HELPURL})}},d.text_replace={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_REPLACE_MESSAGE0,args0:[{type:"input_value",name:"FROM",check:"String"},{type:"input_value",name:"TO",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_REPLACE_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_REPLACE_HELPURL})}},d.text_reverse={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_REVERSE_MESSAGE0,args0:[{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_REVERSE_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_REVERSE_HELPURL})}};var f={QUOTE_IMAGE_LEFT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAn0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMfz9AylsaRRgGzvZAAAAAElFTkSuQmCC",QUOTE_IMAGE_RIGHT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAqUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhggONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvBO3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5AoslLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==",QUOTE_IMAGE_WIDTH:12,QUOTE_IMAGE_HEIGHT:12,quoteField_:function(e){for(let t,i=0;t=this.inputList[i];i++)for(let i,n=0;i=t.fieldRow[n];n++)if(e===i.name)return t.insertFieldAt(n,this.newQuote_(!0)),void t.insertFieldAt(n+2,this.newQuote_(!1));console.warn('field named "'+e+'" not found in '+this.toDevString())},newQuote_:function(e){return e=this.RTL?!e:e,t.fromJson$$module$build$src$core$field_registry({type:"field_image",src:e?this.QUOTE_IMAGE_LEFT_DATAURI:this.QUOTE_IMAGE_RIGHT_DATAURI,width:this.QUOTE_IMAGE_WIDTH,height:this.QUOTE_IMAGE_HEIGHT,alt:e?"":""})}},_={itemCount_:0,mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("items",`${this.itemCount_}`),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(e){this.itemCount_=e.itemCount,this.updateShape_()},decompose:function(e){const t=e.newBlock("text_create_join_container");t.initSvg();let i=t.getInput("STACK").connection;for(let t=0;t<this.itemCount_;t++){const t=e.newBlock("text_create_join_item");t.initSvg(),i.connect(t.previousConnection),i=t.nextConnection}return t},compose:function(e){var t=e.getInputTargetBlock("STACK");for(e=[];t;)t.isInsertionMarker()||e.push(t.valueConnection_),t=t.getNextBlock();for(t=0;t<this.itemCount_;t++){const i=this.getInput("ADD"+t).connection.targetConnection;i&&!e.includes(i)&&i.disconnect()}for(this.itemCount_=e.length,this.updateShape_(),t=0;t<this.itemCount_;t++){let i;null==(i=e[t])||i.reconnect(this,"ADD"+t)}},saveConnections:function(e){e=e.getInputTargetBlock("STACK");let t=0;for(;e;){if(e.isInsertionMarker()){e=e.getNextBlock();continue}const i=this.getInput("ADD"+t);e.valueConnection_=i&&i.connection.targetConnection,e=e.getNextBlock(),t++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(this.newQuote_(!0)).appendField(this.newQuote_(!1));for(var e=0;e<this.itemCount_;e++)if(!this.getInput("ADD"+e)){const i=this.appendValueInput("ADD"+e).setAlign(t.Align$$module$build$src$core$inputs$align.RIGHT);0===e&&i.appendField(t.Msg$$module$build$src$core$msg.TEXT_JOIN_TITLE_CREATEWITH)}for(e=this.itemCount_;this.getInput("ADD"+e);e++)this.removeInput("ADD"+e)}};t.register$$module$build$src$core$extensions("text_append_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_TEXT_APPEND_TOOLTIP}","VAR"));var T={isAt_:!1,mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("at",`${this.isAt_}`),e},domToMutation:function(e){e="false"!==e.getAttribute("at"),this.updateAt_(e)},updateAt_:function(e){this.removeInput("AT",!0),this.removeInput("ORDINAL",!0),e&&(this.appendValueInput("AT").setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)),t.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL)),this.isAt_=e}};t.register$$module$build$src$core$extensions("text_indexOf_tooltip",(function(){this.setTooltip((()=>t.Msg$$module$build$src$core$msg.TEXT_INDEXOF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1")))})),t.register$$module$build$src$core$extensions("text_quotes",(function(){this.mixin(f),this.quoteField_("TEXT")})),t.registerMixin$$module$build$src$core$extensions("quote_image_mixin",f),t.registerMutator$$module$build$src$core$extensions("text_join_mutator",_,(function(){this.mixin(f),this.itemCount_=2,this.updateShape_(),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["text_create_join_item"],this))})),t.registerMutator$$module$build$src$core$extensions("text_charAt_mutator",T,(function(){this.getField("WHERE").setValidator((function(e){e="FROM_START"===e||"FROM_END"===e;const t=this.getSourceBlock();e!==t.isAt_&&t.updateAt_(e)})),this.updateAt_(!0),this.setTooltip((()=>{var e=this.getFieldValue("WHERE");let i=t.Msg$$module$build$src$core$msg.TEXT_CHARAT_TOOLTIP;return("FROM_START"===e||"FROM_END"===e)&&(e="FROM_START"===e?t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP)&&(i+="  "+e.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),i}))})),t.defineBlocks$$module$build$src$core$common(d);var E={blocks:d},b={},I={setStatements_:function(e){this.hasStatements_!==e&&(e?(this.appendStatementInput("STACK").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_DO),this.getInput("RETURN")&&this.moveInputBefore("STACK","RETURN")):this.removeInput("STACK",!0),this.hasStatements_=e)},updateParams_:function(){let e="";this.arguments_.length&&(e=t.Msg$$module$build$src$core$msg.PROCEDURES_BEFORE_PARAMS+" "+this.arguments_.join(", ")),t.disable$$module$build$src$core$events$utils();try{this.setFieldValue(e,"PARAMS")}finally{t.enable$$module$build$src$core$events$utils()}},mutationToDom:function(e){const i=t.createElement$$module$build$src$core$utils$xml("mutation");e&&i.setAttribute("name",this.getFieldValue("NAME"));for(let n=0;n<this.argumentVarModels_.length;n++){const s=t.createElement$$module$build$src$core$utils$xml("arg"),o=this.argumentVarModels_[n];s.setAttribute("name",o.name),s.setAttribute("varid",o.getId()),e&&this.paramIds_&&s.setAttribute("paramId",this.paramIds_[n]),i.appendChild(s)}return this.hasStatements_||i.setAttribute("statements","false"),i},domToMutation:function(e){this.arguments_=[],this.argumentVarModels_=[];for(let n,s=0;n=e.childNodes[s];s++)if("arg"===n.nodeName.toLowerCase()){var i=n;const e=i.getAttribute("name");i=i.getAttribute("varid")||i.getAttribute("varId"),this.arguments_.push(e),null!==(i=t.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,i,e,""))?this.argumentVarModels_.push(i):console.log(`Failed to create a variable named "${e}", ignoring.`)}this.updateParams_(),t.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_("false"!==e.getAttribute("statements"))},saveExtraState:function(){if(!this.argumentVarModels_.length&&this.hasStatements_)return null;const e=Object.create(null);if(this.argumentVarModels_.length){e.params=[];for(let t=0;t<this.argumentVarModels_.length;t++)e.params.push({name:this.argumentVarModels_[t].name,id:this.argumentVarModels_[t].getId()})}return this.hasStatements_||(e.hasStatements=!1),e},loadExtraState:function(e){if(this.arguments_=[],this.argumentVarModels_=[],e.params)for(let n=0;n<e.params.length;n++){var i=e.params[n];i=t.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,i.id,i.name,""),this.arguments_.push(i.name),this.argumentVarModels_.push(i)}this.updateParams_(),t.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(!1!==e.hasStatements)},decompose:function(e){const i=t.createElement$$module$build$src$core$utils$xml("block");i.setAttribute("type","procedures_mutatorcontainer");var n=t.createElement$$module$build$src$core$utils$xml("statement");n.setAttribute("name","STACK"),i.appendChild(n);for(let e=0;e<this.arguments_.length;e++){const i=t.createElement$$module$build$src$core$utils$xml("block");i.setAttribute("type","procedures_mutatorarg");var s=t.createElement$$module$build$src$core$utils$xml("field");s.setAttribute("name","NAME");const o=t.createTextNode$$module$build$src$core$utils$xml(this.arguments_[e]);s.appendChild(o),i.appendChild(s),s=t.createElement$$module$build$src$core$utils$xml("next"),i.appendChild(s),n.appendChild(i),n=s}return e=t.domToBlock$$module$build$src$core$xml(i,e),"procedures_defreturn"===this.type?e.setFieldValue(this.hasStatements_,"STATEMENTS"):e.removeInput("STATEMENT_INPUT"),t.mutateCallers$$module$build$src$core$procedures(this),e},compose:function(e){this.arguments_=[],this.paramIds_=[],this.argumentVarModels_=[];let i=e.getInputTargetBlock("STACK");for(;i&&!i.isInsertionMarker();){var n=i.getFieldValue("NAME");this.arguments_.push(n),n=this.workspace.getVariable(n,""),this.argumentVarModels_.push(n),this.paramIds_.push(i.id),i=i.nextConnection&&i.nextConnection.targetBlock()}if(this.updateParams_(),t.mutateCallers$$module$build$src$core$procedures(this),null!==(e=e.getFieldValue("STATEMENTS"))&&(e="TRUE"===e,this.hasStatements_!==e))if(e){var s;this.setStatements_(!0),null==(s=this.statementConnection_)||s.reconnect(this,"STACK"),this.statementConnection_=null}else s=this.getInput("STACK").connection,(this.statementConnection_=s.targetConnection)&&((s=s.targetBlock()).unplug(),s.bumpNeighbours()),this.setStatements_(!1)},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},renameVarById:function(e,i){var n=this.workspace.getVariableById(e);if(""===n.type){n=n.name,i=this.workspace.getVariableById(i);var s=!1;for(let t=0;t<this.argumentVarModels_.length;t++)this.argumentVarModels_[t].getId()===e&&(this.arguments_[t]=i.name,this.argumentVarModels_[t]=i,s=!0);s&&(this.displayRenamedVar_(n,i.name),t.mutateCallers$$module$build$src$core$procedures(this))}},updateVarName:function(e){const i=e.name;let n,s=!1;for(let t=0;t<this.argumentVarModels_.length;t++)this.argumentVarModels_[t].getId()===e.getId()&&(n=this.arguments_[t],this.arguments_[t]=i,s=!0);s&&(this.displayRenamedVar_(n,i),t.mutateCallers$$module$build$src$core$procedures(this))},displayRenamedVar_:function(e,i){this.updateParams_();var n=this.getIcon(t.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE);if(n&&n.bubbleIsVisible()){n=n.getWorkspace().getAllBlocks(!1);for(let s,o=0;s=n[o];o++)"procedures_mutatorarg"===s.type&&t.Names$$module$build$src$core$names.equals(e,s.getFieldValue("NAME"))&&s.setFieldValue(i,"NAME")}},customContextMenu:function(e){if(!this.isInFlyout){var i=this.getFieldValue("NAME"),n={type:this.callType_,extraState:{name:i,params:this.arguments_}};if(e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.PROCEDURES_CREATE_DO.replace("%1",i),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,n)}),!this.isCollapsed())for(i=0;i<this.argumentVarModels_.length;i++){const s={type:"variables_get",fields:{VAR:{name:(n=this.argumentVarModels_[i]).name,id:n.getId(),type:n.type}}};e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",n.name),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,s)})}}}};b.procedures_defnoreturn=Object.assign({},I,{init:function(){var e=t.findLegalName$$module$build$src$core$procedures("",this);(e=t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:e})).setValidator(t.rename$$module$build$src$core$procedures),e.setSpellcheck(!1),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT&&this.setCommentText(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TOOLTIP),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!1]},callType_:"procedures_callnoreturn"}),b.procedures_defreturn=Object.assign({},I,{init:function(){var e=t.findLegalName$$module$build$src$core$procedures("",this);(e=t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:e})).setValidator(t.rename$$module$build$src$core$procedures),e.setSpellcheck(!1),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.appendValueInput("RETURN").setAlign(t.Align$$module$build$src$core$inputs$align.RIGHT).appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT&&this.setCommentText(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TOOLTIP),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!0]},callType_:"procedures_callreturn"});var y={init:function(){this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TITLE),this.appendStatementInput("STACK"),this.appendDummyInput("STATEMENT_INPUT").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_ALLOW_STATEMENTS).appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_checkbox",checked:!0}),"STATEMENTS"),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP),this.contextMenu=!1}};b.procedures_mutatorcontainer=y;var v={init:function(){const e=t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:t.DEFAULT_ARG$$module$build$src$core$procedures});e.setValidator(this.validator_),e.oldShowEditorFn_=e.showEditor_,e.showEditor_=function(){this.createdVariables_=[],this.oldShowEditorFn_()},this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TITLE).appendField(e,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TOOLTIP),this.contextMenu=!1,e.onFinishEditing_=this.deleteIntermediateVars_,e.createdVariables_=[],e.onFinishEditing_("x")},validator_:function(e){var t=this.getSourceBlock();const i=t.workspace.getRootWorkspace();if(!(e=e.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,"")))return null;const n=(t.workspace.targetWorkspace||t.workspace).getAllBlocks(!1),s=e.toLowerCase();for(let e=0;e<n.length;e++){if(n[e].id===this.getSourceBlock().id)continue;const t=n[e].getFieldValue("NAME");if(t&&t.toLowerCase()===s)return null}return t.isInFlyout||((t=i.getVariable(e,""))&&t.name!==e&&i.renameVariableById(t.getId(),e),t||(t=i.createVariable(e,""))&&this.createdVariables_&&this.createdVariables_.push(t)),e},deleteIntermediateVars_:function(e){const t=this.getSourceBlock().workspace.getRootWorkspace();if(t)for(let i=0;i<this.createdVariables_.length;i++){const n=this.createdVariables_[i];n.name!==e&&t.deleteVariableById(n.getId())}}};b.procedures_mutatorarg=v;var C={getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(e,i){t.Names$$module$build$src$core$names.equals(e,this.getProcedureCall())&&(this.setFieldValue(i,"NAME"),this.setTooltip((this.outputConnection?t.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_TOOLTIP:t.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_TOOLTIP).replace("%1",i)))},setProcedureParameters_:function(e,i){var n=t.getDefinition$$module$build$src$core$procedures(this.getProcedureCall(),this.workspace);if((n=(n=n&&n.getIcon(t.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE))&&n.bubbleIsVisible())?this.setCollapsed(!1):(this.quarkConnections_={},this.quarkIds_=null),e.join("\n")===this.arguments_.join("\n"))this.quarkIds_=i;else{if(i.length!==e.length)throw RangeError("paramNames and paramIds must be the same length.");this.quarkIds_||(this.quarkConnections_={},this.quarkIds_=[]);for(let e=0;e<this.arguments_.length;e++){var s=this.getInput("ARG"+e);s&&(s=s.connection.targetConnection,this.quarkConnections_[this.quarkIds_[e]]=s,n&&s&&!i.includes(this.quarkIds_[e])&&(s.disconnect(),s.getSourceBlock().bumpNeighbours()))}for(this.arguments_=[].concat(e),this.argumentVarModels_=[],e=0;e<this.arguments_.length;e++)n=t.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,null,this.arguments_[e],""),this.argumentVarModels_.push(n);if(this.updateShape_(),this.quarkIds_=i)for(i=0;i<this.arguments_.length;i++)if((e=this.quarkIds_[i])in this.quarkConnections_){let t;null!=(t=this.quarkConnections_[e])&&t.reconnect(this,"ARG"+i)||delete this.quarkConnections_[e]}}},updateShape_:function(){for(var e=0;e<this.arguments_.length;e++){var i=this.getField("ARGNAME"+e);if(i){t.disable$$module$build$src$core$events$utils();try{i.setValue(this.arguments_[e])}finally{t.enable$$module$build$src$core$events$utils()}}else i=t.fromJson$$module$build$src$core$field_registry({type:"field_label",text:this.arguments_[e]}),this.appendValueInput("ARG"+e).setAlign(t.Align$$module$build$src$core$inputs$align.RIGHT).appendField(i,"ARGNAME"+e)}for(e=this.arguments_.length;this.getInput("ARG"+e);e++)this.removeInput("ARG"+e);(e=this.getInput("TOPROW"))&&(this.arguments_.length?this.getField("WITH")||e.appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_CALL_BEFORE_PARAMS,"WITH"):this.getField("WITH")&&e.removeField("WITH"))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");e.setAttribute("name",this.getProcedureCall());for(let i=0;i<this.arguments_.length;i++){const n=t.createElement$$module$build$src$core$utils$xml("arg");n.setAttribute("name",this.arguments_[i]),e.appendChild(n)}return e},domToMutation:function(e){var t=e.getAttribute("name");this.renameProcedure(this.getProcedureCall(),t),t=[];const i=[];for(let n,s=0;n=e.childNodes[s];s++)"arg"===n.nodeName.toLowerCase()&&(t.push(n.getAttribute("name")),i.push(n.getAttribute("paramId")));this.setProcedureParameters_(t,i)},saveExtraState:function(){const e=Object.create(null);return e.name=this.getProcedureCall(),this.arguments_.length&&(e.params=this.arguments_),e},loadExtraState:function(e){if(this.renameProcedure(this.getProcedureCall(),e.name),e=e.params){const t=[];t.length=e.length,t.fill(null),this.setProcedureParameters_(e,t)}},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},onchange:function(e){if(this.workspace&&!this.workspace.isFlyout&&e.recordUndo)if(e.type===t.CREATE$$module$build$src$core$events$utils&&e.ids.includes(this.id)){var i=this.getProcedureCall();if(!(i=t.getDefinition$$module$build$src$core$procedures(i,this.workspace))||i.type===this.defType_&&JSON.stringify(i.getVars())===JSON.stringify(this.arguments_)||(i=null),!i){t.setGroup$$module$build$src$core$events$utils(e.group),e=t.createElement$$module$build$src$core$utils$xml("xml"),(i=t.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type",this.defType_);var n=this.getRelativeToSurfaceXY(),s=n.y+2*t.config$$module$build$src$core$config.snapRadius;i.setAttribute("x",`${n.x+t.config$$module$build$src$core$config.snapRadius*(this.RTL?-1:1)}`),i.setAttribute("y",`${s}`),n=this.mutationToDom(),i.appendChild(n),(n=t.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name","NAME"),s=this.getProcedureCall();const o=t.findLegalName$$module$build$src$core$procedures(s,this);s!==o&&this.renameProcedure(s,o),n.appendChild(t.createTextNode$$module$build$src$core$utils$xml(s)),i.appendChild(n),e.appendChild(i),t.domToWorkspace$$module$build$src$core$xml(e,this.workspace),t.setGroup$$module$build$src$core$events$utils(!1)}}else e.type===t.DELETE$$module$build$src$core$events$utils?(i=this.getProcedureCall(),t.getDefinition$$module$build$src$core$procedures(i,this.workspace)||(t.setGroup$$module$build$src$core$events$utils(e.group),this.dispose(!0),t.setGroup$$module$build$src$core$events$utils(!1))):e.type===t.CHANGE$$module$build$src$core$events$utils&&"disabled"===e.element&&(i=this.getProcedureCall(),(s=t.getDefinition$$module$build$src$core$procedures(i,this.workspace))&&s.id===e.blockId&&((n=t.getGroup$$module$build$src$core$events$utils())&&console.log("Saw an existing group while responding to a definition change"),t.setGroup$$module$build$src$core$events$utils(e.group),e=s.isEnabled(),this.setDisabledReason(!e,"DISABLED_PROCEDURE_DEFINITION"),this.setWarningText(e?null:t.Msg$$module$build$src$core$msg.PROCEDURES_CALL_DISABLED_DEF_WARNING.replace("%1",i)),t.setGroup$$module$build$src$core$events$utils(n)))},customContextMenu:function(e){if(this.workspace.isMovable()){var i=this.getProcedureCall(),n=this.workspace;e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.PROCEDURES_HIGHLIGHT_DEF,callback:function(){const e=t.getDefinition$$module$build$src$core$procedures(i,n);e&&(n.centerOnBlock(e.id),t.setSelected$$module$build$src$core$common(e))}})}}};b.procedures_callnoreturn=Object.assign({},C,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defnoreturn"}),b.procedures_callreturn=Object.assign({},C,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setOutput(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defreturn"});var k={init:function(){this.appendValueInput("CONDITION").setCheck("Boolean").appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_IF),this.appendValueInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_TOOLTIP),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_HELPURL),this.hasReturnValue_=!0},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("value",String(Number(this.hasReturnValue_))),e},domToMutation:function(e){this.hasReturnValue_="1"===e.getAttribute("value"),this.hasReturnValue_||(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN))},onchange:function(e){if(!(this.workspace.isDragging&&this.workspace.isDragging()||e.type!==t.MOVE$$module$build$src$core$events$utils&&e.type!==t.CREATE$$module$build$src$core$events$utils)){e=!1;var i=this;do{if(this.FUNCTION_TYPES.includes(i.type)){e=!0;break}i=i.getSurroundParent()}while(i);if(e?("procedures_defnoreturn"===i.type&&this.hasReturnValue_?(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!1):"procedures_defreturn"!==i.type||this.hasReturnValue_||(this.removeInput("VALUE"),this.appendValueInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!0),this.setWarningText(null)):this.setWarningText(t.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_WARNING),!this.isInFlyout)try{t.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!e,"UNPARENTED_IFRETURN")}finally{t.setRecordUndo$$module$build$src$core$events$utils(!0)}}},FUNCTION_TYPES:["procedures_defnoreturn","procedures_defreturn"]};b.procedures_ifreturn=k,t.defineBlocks$$module$build$src$core$common(b);var O={blocks:b},N=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"math_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:"Number",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",style:"math_blocks",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_arithmetic",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Number"},{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ADDITION_SYMBOL}","ADD"],["%{BKY_MATH_SUBTRACTION_SYMBOL}","MINUS"],["%{BKY_MATH_MULTIPLICATION_SYMBOL}","MULTIPLY"],["%{BKY_MATH_DIVISION_SYMBOL}","DIVIDE"],["%{BKY_MATH_POWER_SYMBOL}","POWER"]]},{type:"input_value",name:"B",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ARITHMETIC_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_single",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_SINGLE_OP_ROOT}","ROOT"],["%{BKY_MATH_SINGLE_OP_ABSOLUTE}","ABS"],["-","NEG"],["ln","LN"],["log10","LOG10"],["e^","EXP"],["10^","POW10"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_SINGLE_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_trig",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_TRIG_SIN}","SIN"],["%{BKY_MATH_TRIG_COS}","COS"],["%{BKY_MATH_TRIG_TAN}","TAN"],["%{BKY_MATH_TRIG_ASIN}","ASIN"],["%{BKY_MATH_TRIG_ACOS}","ACOS"],["%{BKY_MATH_TRIG_ATAN}","ATAN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_TRIG_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_constant",message0:"%1",args0:[{type:"field_dropdown",name:"CONSTANT",options:[["","PI"],["e","E"],["","GOLDEN_RATIO"],["sqrt(2)","SQRT2"],["sqrt()","SQRT1_2"],["","INFINITY"]]}],output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTANT_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTANT_HELPURL}"},{type:"math_number_property",message0:"%1 %2",args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"field_dropdown",name:"PROPERTY",options:[["%{BKY_MATH_IS_EVEN}","EVEN"],["%{BKY_MATH_IS_ODD}","ODD"],["%{BKY_MATH_IS_PRIME}","PRIME"],["%{BKY_MATH_IS_WHOLE}","WHOLE"],["%{BKY_MATH_IS_POSITIVE}","POSITIVE"],["%{BKY_MATH_IS_NEGATIVE}","NEGATIVE"],["%{BKY_MATH_IS_DIVISIBLE_BY}","DIVISIBLE_BY"]]}],inputsInline:!0,output:"Boolean",style:"math_blocks",tooltip:"%{BKY_MATH_IS_TOOLTIP}",mutator:"math_is_divisibleby_mutator"},{type:"math_change",message0:"%{BKY_MATH_CHANGE_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_MATH_CHANGE_TITLE_ITEM}"},{type:"input_value",name:"DELTA",check:"Number"}],previousStatement:null,nextStatement:null,style:"variable_blocks",helpUrl:"%{BKY_MATH_CHANGE_HELPURL}",extensions:["math_change_tooltip"]},{type:"math_round",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ROUND_OPERATOR_ROUND}","ROUND"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDUP}","ROUNDUP"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDDOWN}","ROUNDDOWN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ROUND_HELPURL}",tooltip:"%{BKY_MATH_ROUND_TOOLTIP}"},{type:"math_on_list",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ONLIST_OPERATOR_SUM}","SUM"],["%{BKY_MATH_ONLIST_OPERATOR_MIN}","MIN"],["%{BKY_MATH_ONLIST_OPERATOR_MAX}","MAX"],["%{BKY_MATH_ONLIST_OPERATOR_AVERAGE}","AVERAGE"],["%{BKY_MATH_ONLIST_OPERATOR_MEDIAN}","MEDIAN"],["%{BKY_MATH_ONLIST_OPERATOR_MODE}","MODE"],["%{BKY_MATH_ONLIST_OPERATOR_STD_DEV}","STD_DEV"],["%{BKY_MATH_ONLIST_OPERATOR_RANDOM}","RANDOM"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ONLIST_HELPURL}",mutator:"math_modes_of_list_mutator",extensions:["math_op_tooltip"]},{type:"math_modulo",message0:"%{BKY_MATH_MODULO_TITLE}",args0:[{type:"input_value",name:"DIVIDEND",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_MODULO_TOOLTIP}",helpUrl:"%{BKY_MATH_MODULO_HELPURL}"},{type:"math_constrain",message0:"%{BKY_MATH_CONSTRAIN_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"Number"},{type:"input_value",name:"LOW",check:"Number"},{type:"input_value",name:"HIGH",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTRAIN_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTRAIN_HELPURL}"},{type:"math_random_int",message0:"%{BKY_MATH_RANDOM_INT_TITLE}",args0:[{type:"input_value",name:"FROM",check:"Number"},{type:"input_value",name:"TO",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_INT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_INT_HELPURL}"},{type:"math_random_float",message0:"%{BKY_MATH_RANDOM_FLOAT_TITLE_RANDOM}",output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_FLOAT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_FLOAT_HELPURL}"},{type:"math_atan2",message0:"%{BKY_MATH_ATAN2_TITLE}",args0:[{type:"input_value",name:"X",check:"Number"},{type:"input_value",name:"Y",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_ATAN2_TOOLTIP}",helpUrl:"%{BKY_MATH_ATAN2_HELPURL}"}]);t.register$$module$build$src$core$extensions("math_op_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("OP",{ADD:"%{BKY_MATH_ARITHMETIC_TOOLTIP_ADD}",MINUS:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MINUS}",MULTIPLY:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MULTIPLY}",DIVIDE:"%{BKY_MATH_ARITHMETIC_TOOLTIP_DIVIDE}",POWER:"%{BKY_MATH_ARITHMETIC_TOOLTIP_POWER}",ROOT:"%{BKY_MATH_SINGLE_TOOLTIP_ROOT}",ABS:"%{BKY_MATH_SINGLE_TOOLTIP_ABS}",NEG:"%{BKY_MATH_SINGLE_TOOLTIP_NEG}",LN:"%{BKY_MATH_SINGLE_TOOLTIP_LN}",LOG10:"%{BKY_MATH_SINGLE_TOOLTIP_LOG10}",EXP:"%{BKY_MATH_SINGLE_TOOLTIP_EXP}",POW10:"%{BKY_MATH_SINGLE_TOOLTIP_POW10}",SIN:"%{BKY_MATH_TRIG_TOOLTIP_SIN}",COS:"%{BKY_MATH_TRIG_TOOLTIP_COS}",TAN:"%{BKY_MATH_TRIG_TOOLTIP_TAN}",ASIN:"%{BKY_MATH_TRIG_TOOLTIP_ASIN}",ACOS:"%{BKY_MATH_TRIG_TOOLTIP_ACOS}",ATAN:"%{BKY_MATH_TRIG_TOOLTIP_ATAN}",SUM:"%{BKY_MATH_ONLIST_TOOLTIP_SUM}",MIN:"%{BKY_MATH_ONLIST_TOOLTIP_MIN}",MAX:"%{BKY_MATH_ONLIST_TOOLTIP_MAX}",AVERAGE:"%{BKY_MATH_ONLIST_TOOLTIP_AVERAGE}",MEDIAN:"%{BKY_MATH_ONLIST_TOOLTIP_MEDIAN}",MODE:"%{BKY_MATH_ONLIST_TOOLTIP_MODE}",STD_DEV:"%{BKY_MATH_ONLIST_TOOLTIP_STD_DEV}",RANDOM:"%{BKY_MATH_ONLIST_TOOLTIP_RANDOM}"}));var A={mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation"),i="DIVISIBLE_BY"===this.getFieldValue("PROPERTY");return e.setAttribute("divisor_input",String(i)),e},domToMutation:function(e){e="true"===e.getAttribute("divisor_input"),this.updateShape_(e)},updateShape_:function(e){const t=this.getInput("DIVISOR");e?t||this.appendValueInput("DIVISOR").setCheck("Number"):t&&this.removeInput("DIVISOR")}};t.registerMutator$$module$build$src$core$extensions("math_is_divisibleby_mutator",A,(function(){this.getField("PROPERTY").setValidator((function(e){e="DIVISIBLE_BY"===e,this.getSourceBlock().updateShape_(e)}))})),t.register$$module$build$src$core$extensions("math_change_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_MATH_CHANGE_TOOLTIP}","VAR"));var S={updateType_:function(e){"MODE"===e?this.outputConnection.setCheck("Array"):this.outputConnection.setCheck("Number")},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("op",this.getFieldValue("OP")),e},domToMutation:function(e){if(null===(e=e.getAttribute("op")))throw new TypeError("xmlElement had no op attribute");this.updateType_(e)}};t.registerMutator$$module$build$src$core$extensions("math_modes_of_list_mutator",S,(function(){this.getField("OP").setValidator(function(e){this.updateType_(e)}.bind(this))})),t.defineBlocks$$module$build$src$core$common(N);var R={blocks:N},w=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"controls_repeat_ext",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"input_value",name:"TIMES",check:"Number"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_repeat",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"field_number",name:"TIMES",value:10,min:0,precision:1}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_whileUntil",message0:"%1 %2",args0:[{type:"field_dropdown",name:"MODE",options:[["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_WHILE}","WHILE"],["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_UNTIL}","UNTIL"]]},{type:"input_value",name:"BOOL",check:"Boolean"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_WHILEUNTIL_HELPURL}",extensions:["controls_whileUntil_tooltip"]},{type:"controls_for",message0:"%{BKY_CONTROLS_FOR_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"FROM",check:"Number",align:"RIGHT"},{type:"input_value",name:"TO",check:"Number",align:"RIGHT"},{type:"input_value",name:"BY",check:"Number",align:"RIGHT"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],inputsInline:!0,previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOR_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_for_tooltip"]},{type:"controls_forEach",message0:"%{BKY_CONTROLS_FOREACH_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"LIST",check:"Array"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOREACH_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_forEach_tooltip"]},{type:"controls_flow_statements",message0:"%1",args0:[{type:"field_dropdown",name:"FLOW",options:[["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK}","BREAK"],["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE}","CONTINUE"]]}],previousStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FLOW_STATEMENTS_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_flow_tooltip","controls_flow_in_loop_check"]}]);t.register$$module$build$src$core$extensions("controls_whileUntil_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("MODE",{WHILE:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_WHILE}",UNTIL:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL}"})),t.register$$module$build$src$core$extensions("controls_flow_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("FLOW",{BREAK:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK}",CONTINUE:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE}"}));var L={customContextMenu:function(e){if(!this.isInFlyout){var i=this.getField("VAR"),n=i.getVariable().name;this.isCollapsed()||null===n||(i={type:"variables_get",fields:{VAR:i.saveState(!0)}},e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",n),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,i)}))}}};t.registerMixin$$module$build$src$core$extensions("contextMenu_newGetVariableBlock",L),t.register$$module$build$src$core$extensions("controls_for_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOR_TOOLTIP}","VAR")),t.register$$module$build$src$core$extensions("controls_forEach_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOREACH_TOOLTIP}","VAR"));var x=new Set(["controls_repeat","controls_repeat_ext","controls_forEach","controls_for","controls_whileUntil"]),$={getSurroundLoop:function(){let e=this;do{if(x.has(e.type))return e;e=e.getSurroundParent()}while(e);return null},onchange:function(e){const i=this.workspace;if(i.isDragging&&!i.isDragging()&&(e.type===t.MOVE$$module$build$src$core$events$utils||e.type===t.CREATE$$module$build$src$core$events$utils)&&(e=!!this.getSurroundLoop(),this.setWarningText(e?null:t.Msg$$module$build$src$core$msg.CONTROLS_FLOW_STATEMENTS_WARNING),!this.isInFlyout))try{t.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!e,"CONTROL_FLOW_NOT_IN_LOOP")}finally{t.setRecordUndo$$module$build$src$core$events$utils(!0)}}};t.registerMixin$$module$build$src$core$extensions("controls_flow_in_loop_check",$),t.defineBlocks$$module$build$src$core$common(w);var D={blocks:w,loopTypes:x},M=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"logic_boolean",message0:"%1",args0:[{type:"field_dropdown",name:"BOOL",options:[["%{BKY_LOGIC_BOOLEAN_TRUE}","TRUE"],["%{BKY_LOGIC_BOOLEAN_FALSE}","FALSE"]]}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_BOOLEAN_TOOLTIP}",helpUrl:"%{BKY_LOGIC_BOOLEAN_HELPURL}"},{type:"controls_if",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],previousStatement:null,nextStatement:null,style:"logic_blocks",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,mutator:"controls_if_mutator",extensions:["controls_if_tooltip"]},{type:"controls_ifelse",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],message2:"%{BKY_CONTROLS_IF_MSG_ELSE} %1",args2:[{type:"input_statement",name:"ELSE"}],previousStatement:null,nextStatement:null,style:"logic_blocks",tooltip:"%{BKYCONTROLS_IF_TOOLTIP_2}",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_if_tooltip"]},{type:"logic_compare",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A"},{type:"field_dropdown",name:"OP",options:[["=","EQ"],["","NEQ"],["<","LT"],["","LTE"],[">","GT"],["","GTE"]]},{type:"input_value",name:"B"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",extensions:["logic_compare","logic_op_tooltip"]},{type:"logic_operation",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Boolean"},{type:"field_dropdown",name:"OP",options:[["%{BKY_LOGIC_OPERATION_AND}","AND"],["%{BKY_LOGIC_OPERATION_OR}","OR"]]},{type:"input_value",name:"B",check:"Boolean"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_OPERATION_HELPURL}",extensions:["logic_op_tooltip"]},{type:"logic_negate",message0:"%{BKY_LOGIC_NEGATE_TITLE}",args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_NEGATE_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NEGATE_HELPURL}"},{type:"logic_null",message0:"%{BKY_LOGIC_NULL}",output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_NULL_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NULL_HELPURL}"},{type:"logic_ternary",message0:"%{BKY_LOGIC_TERNARY_CONDITION} %1",args0:[{type:"input_value",name:"IF",check:"Boolean"}],message1:"%{BKY_LOGIC_TERNARY_IF_TRUE} %1",args1:[{type:"input_value",name:"THEN"}],message2:"%{BKY_LOGIC_TERNARY_IF_FALSE} %1",args2:[{type:"input_value",name:"ELSE"}],output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_TERNARY_TOOLTIP}",helpUrl:"%{BKY_LOGIC_TERNARY_HELPURL}",extensions:["logic_ternary"]},{type:"controls_if_if",message0:"%{BKY_CONTROLS_IF_IF_TITLE_IF}",nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_IF_TOOLTIP}"},{type:"controls_if_elseif",message0:"%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}",previousStatement:null,nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}"},{type:"controls_if_else",message0:"%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}",previousStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSE_TOOLTIP}"}]);t.register$$module$build$src$core$extensions("logic_op_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("OP",{EQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_EQ}",NEQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_NEQ}",LT:"%{BKY_LOGIC_COMPARE_TOOLTIP_LT}",LTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_LTE}",GT:"%{BKY_LOGIC_COMPARE_TOOLTIP_GT}",GTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_GTE}",AND:"%{BKY_LOGIC_OPERATION_TOOLTIP_AND}",OR:"%{BKY_LOGIC_OPERATION_TOOLTIP_OR}"}));var P={elseifCount_:0,elseCount_:0,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const e=t.createElement$$module$build$src$core$utils$xml("mutation");return this.elseifCount_&&e.setAttribute("elseif",String(this.elseifCount_)),this.elseCount_&&e.setAttribute("else","1"),e},domToMutation:function(e){this.elseifCount_=parseInt(e.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(e.getAttribute("else"),10)||0,this.rebuildShape_()},saveExtraState:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const e=Object.create(null);return this.elseifCount_&&(e.elseIfCount=this.elseifCount_),this.elseCount_&&(e.hasElse=!0),e},loadExtraState:function(e){this.elseifCount_=e.elseIfCount||0,this.elseCount_=e.hasElse?1:0,this.updateShape_()},decompose:function(e){const t=e.newBlock("controls_if_if");t.initSvg();let i=t.nextConnection;for(let t=1;t<=this.elseifCount_;t++){const t=e.newBlock("controls_if_elseif");t.initSvg(),i.connect(t.previousConnection),i=t.nextConnection}return this.elseCount_&&((e=e.newBlock("controls_if_else")).initSvg(),i.connect(e.previousConnection)),t},compose:function(e){e=e.nextConnection.targetBlock(),this.elseCount_=this.elseifCount_=0;const t=[null],i=[null];let n=null;for(;e;){if(!e.isInsertionMarker())switch(e.type){case"controls_if_elseif":this.elseifCount_++,t.push(e.valueConnection_),i.push(e.statementConnection_);break;case"controls_if_else":this.elseCount_++,n=e.statementConnection_;break;default:throw TypeError("Unknown block type: "+e.type)}e=e.getNextBlock()}this.updateShape_(),this.reconnectChildBlocks_(t,i,n)},saveConnections:function(e){e=e.nextConnection.targetBlock();let t=1;for(;e;){if(!e.isInsertionMarker())switch(e.type){case"controls_if_elseif":var i=this.getInput("IF"+t);const n=this.getInput("DO"+t);e.valueConnection_=i&&i.connection.targetConnection,e.statementConnection_=n&&n.connection.targetConnection,t++;break;case"controls_if_else":i=this.getInput("ELSE"),e.statementConnection_=i&&i.connection.targetConnection;break;default:throw TypeError("Unknown block type: "+e.type)}e=e.getNextBlock()}},rebuildShape_:function(){const e=[null],t=[null];let i=null;this.getInput("ELSE")&&(i=this.getInput("ELSE").connection.targetConnection);for(let i=1;this.getInput("IF"+i);i++){const n=this.getInput("IF"+i),s=this.getInput("DO"+i);e.push(n.connection.targetConnection),t.push(s.connection.targetConnection)}this.updateShape_(),this.reconnectChildBlocks_(e,t,i)},updateShape_:function(){this.getInput("ELSE")&&this.removeInput("ELSE");for(var e=1;this.getInput("IF"+e);e++)this.removeInput("IF"+e),this.removeInput("DO"+e);for(e=1;e<=this.elseifCount_;e++)this.appendValueInput("IF"+e).setCheck("Boolean").appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSEIF),this.appendStatementInput("DO"+e).appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_THEN);this.elseCount_&&this.appendStatementInput("ELSE").appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSE)},reconnectChildBlocks_:function(e,t,i){for(let i=1;i<=this.elseifCount_;i++){let n,s;null==(n=e[i])||n.reconnect(this,"IF"+i),null==(s=t[i])||s.reconnect(this,"DO"+i)}null==i||i.reconnect(this,"ELSE")}};t.registerMutator$$module$build$src$core$extensions("controls_if_mutator",P,null,["controls_if_elseif","controls_if_else"]),t.register$$module$build$src$core$extensions("controls_if_tooltip",(function(){this.setTooltip(function(){return this.elseifCount_||this.elseCount_?!this.elseifCount_&&this.elseCount_?t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_2:this.elseifCount_&&!this.elseCount_?t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_3:this.elseifCount_&&this.elseCount_?t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_4:"":t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_1}.bind(this))}));var B={onchange:function(e){this.prevBlocks_||(this.prevBlocks_=[null,null]);var i=this.getInputTargetBlock("A");const n=this.getInputTargetBlock("B");i&&n&&!this.workspace.connectionChecker.doTypeChecks(i.outputConnection,n.outputConnection)&&(t.setGroup$$module$build$src$core$events$utils(e.group),(e=this.prevBlocks_[0])!==i&&(i.unplug(),!e||e.isDisposed()||e.isShadow()||this.getInput("A").connection.connect(e.outputConnection)),(i=this.prevBlocks_[1])!==n&&(n.unplug(),!i||i.isDisposed()||i.isShadow()||this.getInput("B").connection.connect(i.outputConnection)),this.bumpNeighbours(),t.setGroup$$module$build$src$core$events$utils(!1)),this.prevBlocks_[0]=this.getInputTargetBlock("A"),this.prevBlocks_[1]=this.getInputTargetBlock("B")}};t.register$$module$build$src$core$extensions("logic_compare",(function(){this.mixin(B)}));var F={prevParentConnection_:null,onchange:function(e){const i=this.getInputTargetBlock("THEN"),n=this.getInputTargetBlock("ELSE"),s=this.outputConnection.targetConnection;if((i||n)&&s)for(let o=0;2>o;o++){const r=1===o?i:n;r&&!r.workspace.connectionChecker.doTypeChecks(r.outputConnection,s)&&(t.setGroup$$module$build$src$core$events$utils(e.group),s===this.prevParentConnection_?(this.unplug(),s.getSourceBlock().bumpNeighbours()):(r.unplug(),r.bumpNeighbours()),t.setGroup$$module$build$src$core$events$utils(!1))}this.prevParentConnection_=s}};t.registerMixin$$module$build$src$core$extensions("logic_ternary",F),t.defineBlocks$$module$build$src$core$common(M);var U={blocks:M},H=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"lists_create_empty",message0:"%{BKY_LISTS_CREATE_EMPTY_TITLE}",output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_CREATE_EMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_CREATE_EMPTY_HELPURL}"},{type:"lists_repeat",message0:"%{BKY_LISTS_REPEAT_TITLE}",args0:[{type:"input_value",name:"ITEM"},{type:"input_value",name:"NUM",check:"Number"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_LISTS_REPEAT_HELPURL}"},{type:"lists_reverse",message0:"%{BKY_LISTS_REVERSE_MESSAGE0}",args0:[{type:"input_value",name:"LIST",check:"Array"}],output:"Array",inputsInline:!0,style:"list_blocks",tooltip:"%{BKY_LISTS_REVERSE_TOOLTIP}",helpUrl:"%{BKY_LISTS_REVERSE_HELPURL}"},{type:"lists_isEmpty",message0:"%{BKY_LISTS_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"list_blocks",tooltip:"%{BKY_LISTS_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_ISEMPTY_HELPURL}"},{type:"lists_length",message0:"%{BKY_LISTS_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"list_blocks",tooltip:"%{BKY_LISTS_LENGTH_TOOLTIP}",helpUrl:"%{BKY_LISTS_LENGTH_HELPURL}"}]),G={init:function(){this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.itemCount_=3,this.updateShape_(),this.setOutput(!0,"Array"),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["lists_create_with_item"],this)),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_TOOLTIP)},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("items",String(this.itemCount_)),e},domToMutation:function(e){if(!(e=e.getAttribute("items")))throw new TypeError("element did not have items");this.itemCount_=parseInt(e,10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(e){this.itemCount_=e.itemCount,this.updateShape_()},decompose:function(e){const t=e.newBlock("lists_create_with_container");t.initSvg();let i=t.getInput("STACK").connection;for(let t=0;t<this.itemCount_;t++){const t=e.newBlock("lists_create_with_item");if(t.initSvg(),!t.previousConnection)throw Error("itemBlock has no previousConnection");i.connect(t.previousConnection),i=t.nextConnection}return t},compose:function(e){var t=e.getInputTargetBlock("STACK");for(e=[];t;)t.isInsertionMarker()||e.push(t.valueConnection_),t=t.getNextBlock();for(t=0;t<this.itemCount_;t++){const i=this.getInput("ADD"+t).connection.targetConnection;i&&!e.includes(i)&&i.disconnect()}for(this.itemCount_=e.length,this.updateShape_(),t=0;t<this.itemCount_;t++){let i;null==(i=e[t])||i.reconnect(this,"ADD"+t)}},saveConnections:function(e){e=e.getInputTargetBlock("STACK");let t=0;for(;e;){if(e.isInsertionMarker()){e=e.getNextBlock();continue}const i=this.getInput("ADD"+t);let n;e.valueConnection_=null==(n=i)?void 0:n.connection.targetConnection,e=e.getNextBlock(),t++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_EMPTY_TITLE);for(var e=0;e<this.itemCount_;e++)if(!this.getInput("ADD"+e)){const i=this.appendValueInput("ADD"+e).setAlign(t.Align$$module$build$src$core$inputs$align.RIGHT);0===e&&i.appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_INPUT_WITH)}for(e=this.itemCount_;this.getInput("ADD"+e);e++)this.removeInput("ADD"+e)}};H.lists_create_with=G;var V={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD),this.appendStatementInput("STACK"),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP),this.contextMenu=!1}};H.lists_create_with_container=V;var j={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TITLE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TOOLTIP),this.contextMenu=!1}};H.lists_create_with_item=j;var W={init:function(){var e=[[t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_FIRST,"FIRST"],[t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_LAST,"LAST"]];if(this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_HELPURL),this.setStyle("list_blocks"),this.setOutput(!0,"Number"),this.appendValueInput("VALUE").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_INPUT_IN_LIST),!(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})))throw Error("field_dropdown not found");this.appendValueInput("FIND").appendField(e,"END"),this.setInputsInline(!0),this.setTooltip((()=>t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1")))}};H.lists_indexOf=W;var X={init:function(){var e=[[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET,"GET"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET_REMOVE,"GET_REMOVE"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_REMOVE,"REMOVE"]];this.WHERE_OPTIONS=[[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_HELPURL),this.setStyle("list_blocks"),(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator((function(e){e="REMOVE"===e,this.getSourceBlock().updateStatement_(e)})),this.appendValueInput("VALUE").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(e,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL),this.setInputsInline(!0),this.setOutput(!0),this.updateAt_(!0),this.setTooltip((()=>{const e=this.getFieldValue("MODE"),i=this.getFieldValue("WHERE");let n="";switch(e+" "+i){case"GET FROM_START":case"GET FROM_END":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM;break;case"GET FIRST":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST;break;case"GET LAST":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST;break;case"GET RANDOM":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM;break;case"GET_REMOVE FROM_START":case"GET_REMOVE FROM_END":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM;break;case"GET_REMOVE FIRST":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST;break;case"GET_REMOVE LAST":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST;break;case"GET_REMOVE RANDOM":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM;break;case"REMOVE FROM_START":case"REMOVE FROM_END":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM;break;case"REMOVE FIRST":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST;break;case"REMOVE LAST":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST;break;case"REMOVE RANDOM":n=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM}return"FROM_START"!==i&&"FROM_END"!==i||(n+="  "+("FROM_START"===i?t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP).replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),n}))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");e.setAttribute("statement",String(!this.outputConnection));const i=this.getInput("AT")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at",String(i)),e},domToMutation:function(e){const t="true"===e.getAttribute("statement");this.updateStatement_(t),e="false"!==e.getAttribute("at"),this.updateAt_(e)},saveExtraState:function(){return this.outputConnection?null:{isStatement:!0}},loadExtraState:function(e){e.isStatement?this.updateStatement_(!0):"string"==typeof e&&this.domToMutation(t.textToDom$$module$build$src$core$utils$xml(e))},updateStatement_:function(e){e!==!this.outputConnection&&(this.unplug(!0,!0),e?(this.setOutput(!1),this.setPreviousStatement(!0),this.setNextStatement(!0)):(this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0)))},updateAt_:function(e){this.removeInput("AT"),this.removeInput("ORDINAL",!0),e?(this.appendValueInput("AT").setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");const i=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS});i.setValidator((function(t){const i="FROM_START"===t||"FROM_END"===t;if(i!==e){const e=this.getSourceBlock();return e.updateAt_(i),e.setFieldValue(t,"WHERE"),null}})),this.getInput("AT").appendField(i,"WHERE"),t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.moveInputBefore("TAIL",null)}};H.lists_getIndex=X;var Y={init:function(){var e=[[t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_SET,"SET"],[t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INSERT,"INSERT"]];this.WHERE_OPTIONS=[[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_IN_LIST),e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),this.appendDummyInput().appendField(e,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),this.appendValueInput("TO").appendField(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_TO),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP),this.updateAt_(!0),this.setTooltip((()=>{const e=this.getFieldValue("MODE"),i=this.getFieldValue("WHERE");let n="";switch(e+" "+i){case"SET FROM_START":case"SET FROM_END":n=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM;break;case"SET FIRST":n=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST;break;case"SET LAST":n=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST;break;case"SET RANDOM":n=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM;break;case"INSERT FROM_START":case"INSERT FROM_END":n=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM;break;case"INSERT FIRST":n=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST;break;case"INSERT LAST":n=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST;break;case"INSERT RANDOM":n=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM}return"FROM_START"!==i&&"FROM_END"!==i||(n+="  "+t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),n}))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation"),i=this.getInput("AT")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at",String(i)),e},domToMutation:function(e){e="false"!==e.getAttribute("at"),this.updateAt_(e)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(e){this.removeInput("AT"),this.removeInput("ORDINAL",!0),e?(this.appendValueInput("AT").setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");const i=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS});i.setValidator((function(t){const i="FROM_START"===t||"FROM_END"===t;if(i!==e){const e=this.getSourceBlock();return e.updateAt_(i),e.setFieldValue(t,"WHERE"),null}})),this.moveInputBefore("AT","TO"),this.getInput("ORDINAL")&&this.moveInputBefore("ORDINAL","TO"),this.getInput("AT").appendField(i,"WHERE")}};H.lists_setIndex=Y;var z={init:function(){this.WHERE_OPTIONS_1=[[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_LAST,"LAST"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_INPUT_IN_LIST),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TOOLTIP)},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");var i=this.getInput("AT1")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at1",String(i)),i=this.getInput("AT2")instanceof t.ValueInput$$module$build$src$core$inputs$value_input,e.setAttribute("at2",String(i)),e},domToMutation:function(e){const t="true"===e.getAttribute("at1");e="true"===e.getAttribute("at2"),this.updateAt_(1,t),this.updateAt_(2,e)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(e,i){this.removeInput("AT"+e),this.removeInput("ORDINAL"+e,!0),i?(this.appendValueInput("AT"+e).setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+e).appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+e);const n=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+e]});n.setValidator((function(t){const n="FROM_START"===t||"FROM_END"===t;if(n!==i){const i=this.getSourceBlock();return i.updateAt_(e,n),i.setFieldValue(t,"WHERE"+e),null}})),this.getInput("AT"+e).appendField(n,"WHERE"+e),1===e&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2")),t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.moveInputBefore("TAIL",null)}};H.lists_getSublist=z,H.lists_sort={init:function(){this.jsonInit({message0:"%{BKY_LISTS_SORT_TITLE}",args0:[{type:"field_dropdown",name:"TYPE",options:[["%{BKY_LISTS_SORT_TYPE_NUMERIC}","NUMERIC"],["%{BKY_LISTS_SORT_TYPE_TEXT}","TEXT"],["%{BKY_LISTS_SORT_TYPE_IGNORECASE}","IGNORE_CASE"]]},{type:"field_dropdown",name:"DIRECTION",options:[["%{BKY_LISTS_SORT_ORDER_ASCENDING}","1"],["%{BKY_LISTS_SORT_ORDER_DESCENDING}","-1"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_SORT_TOOLTIP}",helpUrl:"%{BKY_LISTS_SORT_HELPURL}"})}},H.lists_split={init:function(){const e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:[[t.Msg$$module$build$src$core$msg.LISTS_SPLIT_LIST_FROM_TEXT,"SPLIT"],[t.Msg$$module$build$src$core$msg.LISTS_SPLIT_TEXT_FROM_LIST,"JOIN"]]});if(!e)throw Error("field_dropdown not found");e.setValidator((e=>{this.updateType_(e)})),this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_SPLIT_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("INPUT").setCheck("String").appendField(e,"MODE"),this.appendValueInput("DELIM").setCheck("String").appendField(t.Msg$$module$build$src$core$msg.LISTS_SPLIT_WITH_DELIMITER),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.setTooltip((()=>{const e=this.getFieldValue("MODE");if("SPLIT"===e)return t.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_SPLIT;if("JOIN"===e)return t.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_JOIN;throw Error("Unknown mode: "+e)}))},updateType_:function(e){if(this.getFieldValue("MODE")!==e){const e=this.getInput("INPUT").connection;e.setShadowDom(null);const t=e.targetBlock();t&&(e.disconnect(),t.isShadow()?t.dispose(!1):this.bumpNeighbours())}"SPLIT"===e?(this.outputConnection.setCheck("Array"),this.getInput("INPUT").setCheck("String")):(this.outputConnection.setCheck("String"),this.getInput("INPUT").setCheck("Array"))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("mode",this.getFieldValue("MODE")),e},domToMutation:function(e){this.updateType_(e.getAttribute("mode"))},saveExtraState:function(){return null},loadExtraState:function(){}},t.defineBlocks$$module$build$src$core$common(H);var K={blocks:H},q={blocks:Object.assign({},H,M,w,N,b,d,a,i),lists:K,logic:U,loops:D,math:R,procedures:O,texts:E,variables:h,variablesDynamic:r};return q.__namespace__=t,q},"function"==typeof define&&define.amd?define(["./blockly_compressed.js"],s):"object"==typeof i?t.exports=s(e("./blockly_compressed.js")):n.Blockly.libraryBlocks=s(n.Blockly)},{"./blockly_compressed.js":201}],204:[function(e,t,i){t.exports=e("./blockly_compressed.js")},{"./blockly_compressed.js":201}],205:[function(e,t,i){t.exports=e("./dart_compressed.js")},{"./dart_compressed.js":206}],206:[function(e,t,i){var n,s;n=this,s=function(e){var t,i,n=e.__namespace__,s=function(e,i){let n,s,o=0,r="";i.STATEMENT_PREFIX&&(r+=i.injectId(i.STATEMENT_PREFIX,e));do{s=i.valueToCode(e,"IF"+o,t.NONE)||"false",n=i.statementToCode(e,"DO"+o),i.STATEMENT_SUFFIX&&(n=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+n),r+=(0<o?"else ":"")+"if ("+s+") {\n"+n+"}",o++}while(e.getInput("IF"+o));return(e.getInput("ELSE")||i.STATEMENT_SUFFIX)&&(n=i.statementToCode(e,"ELSE"),i.STATEMENT_SUFFIX&&(n=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+n),r+=" else {\n"+n+"}"),r+"\n"},o=function(e,i){let s;s=e.getField("TIMES")?String(Number(e.getFieldValue("TIMES"))):i.valueToCode(e,"TIMES",t.ASSIGNMENT)||"0";let o=i.statementToCode(e,"DO");o=i.addLoopTrap(o,e),e="";const r=i.nameDB_.getDistinctName("count",n.NameType$$module$build$src$core$names.VARIABLE);let a=s;return s.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(s)||(e+="var "+(a=i.nameDB_.getDistinctName("repeat_end",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+s+";\n"),e+"for (int "+r+" = 0; "+r+" < "+a+"; "+r+"++) {\n"+o+"}\n"},r=function(e,i){const n=e.getFieldValue("OP");let s;if("NEG"===n)return"-"===(e=i.valueToCode(e,"NUM",t.UNARY_PREFIX)||"0")[0]&&(e=" "+e),["-"+e,t.UNARY_PREFIX];switch(i.definitions_.import_dart_math="import 'dart:math' as Math;",e="ABS"===n||"ROUND"===n.substring(0,5)?i.valueToCode(e,"NUM",t.UNARY_POSTFIX)||"0":"SIN"===n||"COS"===n||"TAN"===n?i.valueToCode(e,"NUM",t.MULTIPLICATIVE)||"0":i.valueToCode(e,"NUM",t.NONE)||"0",n){case"ABS":s=e+".abs()";break;case"ROOT":s="Math.sqrt("+e+")";break;case"LN":s="Math.log("+e+")";break;case"EXP":s="Math.exp("+e+")";break;case"POW10":s="Math.pow(10,"+e+")";break;case"ROUND":s=e+".round()";break;case"ROUNDUP":s=e+".ceil()";break;case"ROUNDDOWN":s=e+".floor()";break;case"SIN":s="Math.sin("+e+" / 180 * Math.pi)";break;case"COS":s="Math.cos("+e+" / 180 * Math.pi)";break;case"TAN":s="Math.tan("+e+" / 180 * Math.pi)"}if(s)return[s,t.UNARY_POSTFIX];switch(n){case"LOG10":s="Math.log("+e+") / Math.log(10)";break;case"ASIN":s="Math.asin("+e+") / Math.pi * 180";break;case"ACOS":s="Math.acos("+e+") / Math.pi * 180";break;case"ATAN":s="Math.atan("+e+") / Math.pi * 180";break;default:throw Error("Unknown math operator: "+n)}return[s,t.MULTIPLICATIVE]},a=function(e,i){const n=i.getProcedureName(e.getFieldValue("NAME"));var s="";i.STATEMENT_PREFIX&&(s+=i.injectId(i.STATEMENT_PREFIX,e)),i.STATEMENT_SUFFIX&&(s+=i.injectId(i.STATEMENT_SUFFIX,e)),s&&(s=i.prefixLines(s,i.INDENT));let o="";i.INFINITE_LOOP_TRAP&&(o=i.prefixLines(i.injectId(i.INFINITE_LOOP_TRAP,e),i.INDENT));let r="";e.getInput("STACK")&&(r=i.statementToCode(e,"STACK"));let a="";e.getInput("RETURN")&&(a=i.valueToCode(e,"RETURN",t.NONE)||"");let l="";r&&a&&(l=s),a&&(a=i.INDENT+"return "+a+";\n");const c=a?"dynamic":"void",u=[],h=e.getVars();for(let e=0;e<h.length;e++)u[e]=i.getVariableName(h[e]);return s=c+" "+n+"("+u.join(", ")+") {\n"+s+o+r+l+a+"}",s=i.scrub_(e,s),i.definitions_["%"+n]=s,null},l=function(e,i){i.definitions_.import_dart_html="import 'dart:html' as Html;";let n="Html.window.prompt("+(e.getField("TEXT")?i.quote_(e.getFieldValue("TEXT")):i.valueToCode(e,"TEXT",t.NONE)||"''")+", '')";return"NUMBER"===e.getFieldValue("TYPE")&&(i.definitions_.import_dart_math="import 'dart:math' as Math;",n="Math.parseDouble("+n+")"),[n,t.UNARY_POSTFIX]},c=function(e,i){return[i.getVariableName(e.getFieldValue("VAR")),t.ATOMIC]},u=function(e,i){const n=i.valueToCode(e,"VALUE",t.ASSIGNMENT)||"0";return i.getVariableName(e.getFieldValue("VAR"))+" = "+n+";\n"};(i=t||(t={}))[i.ATOMIC=0]="ATOMIC",i[i.UNARY_POSTFIX=1]="UNARY_POSTFIX",i[i.UNARY_PREFIX=2]="UNARY_PREFIX",i[i.MULTIPLICATIVE=3]="MULTIPLICATIVE",i[i.ADDITIVE=4]="ADDITIVE",i[i.SHIFT=5]="SHIFT",i[i.BITWISE_AND=6]="BITWISE_AND",i[i.BITWISE_XOR=7]="BITWISE_XOR",i[i.BITWISE_OR=8]="BITWISE_OR",i[i.RELATIONAL=9]="RELATIONAL",i[i.EQUALITY=10]="EQUALITY",i[i.LOGICAL_AND=11]="LOGICAL_AND",i[i.LOGICAL_OR=12]="LOGICAL_OR",i[i.IF_NULL=13]="IF_NULL",i[i.CONDITIONAL=14]="CONDITIONAL",i[i.CASCADE=15]="CASCADE",i[i.ASSIGNMENT=16]="ASSIGNMENT",i[i.NONE=99]="NONE";var h=class extends n.CodeGenerator$$module$build$src$core$generator{constructor(e="Dart"){super(e),this.isInitialized=!1;for(const i in t)"string"!=typeof(e=t[i])&&(this["ORDER_"+i]=e);this.addReservedWords("assert,break,case,catch,class,const,continue,default,do,else,enum,extends,false,final,finally,for,if,in,is,new,null,rethrow,return,super,switch,this,throw,true,try,var,void,while,with,print,identityHashCode,identical,BidirectionalIterator,Comparable,double,Function,int,Invocation,Iterable,Iterator,List,Map,Match,num,Pattern,RegExp,Set,StackTrace,String,StringSink,Type,bool,DateTime,Deprecated,Duration,Expando,Null,Object,RuneIterator,Runes,Stopwatch,StringBuffer,Symbol,Uri,Comparator,AbstractClassInstantiationError,ArgumentError,AssertionError,CastError,ConcurrentModificationError,CyclicInitializationError,Error,Exception,FallThroughError,FormatException,IntegerDivisionByZeroException,NoSuchMethodError,NullThrownError,OutOfMemoryError,RangeError,StackOverflowError,StateError,TypeError,UnimplementedError,UnsupportedError")}init(e){super.init(e),this.nameDB_?this.nameDB_.reset():this.nameDB_=new n.Names$$module$build$src$core$names(this.RESERVED_WORDS_),this.nameDB_.setVariableMap(e.getVariableMap()),this.nameDB_.populateVariables(e),this.nameDB_.populateProcedures(e);const t=[];var i=n.allDeveloperVariables$$module$build$src$core$variables(e);for(let e=0;e<i.length;e++)t.push(this.nameDB_.getName(i[e],n.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));for(e=n.allUsedVarModels$$module$build$src$core$variables(e),i=0;i<e.length;i++)t.push(this.nameDB_.getName(e[i].getId(),n.NameType$$module$build$src$core$names.VARIABLE));t.length&&(this.definitions_.variables="var "+t.join(", ")+";"),this.isInitialized=!0}finish(e){e&&(e=this.prefixLines(e,this.INDENT)),e="main() {\n"+e+"}";const t=[],i=[];for(let e in this.definitions_){const n=this.definitions_[e];n.match(/^import\s/)?t.push(n):i.push(n)}return e=super.finish(e),this.isInitialized=!1,this.nameDB_.reset(),(t.join("\n")+"\n\n"+i.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+e}scrubNakedValue(e){return e+";\n"}quote_(e){return"'"+(e=e.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/\$/g,"\\$").replace(/'/g,"\\'"))+"'"}multiline_quote_(e){return e.split(/\n/g).map(this.quote_).join(" + '\\n' + \n")}scrub_(e,t,i=!1){let s="";if(!e.outputConnection||!e.outputConnection.targetConnection){var o=e.getCommentText();o&&(o=n.wrap$$module$build$src$core$utils$string(o,this.COMMENT_WRAP-3),s=e.getProcedureDef?s+this.prefixLines(o+"\n","/// "):s+this.prefixLines(o+"\n","// "));for(let t=0;t<e.inputList.length;t++)e.inputList[t].type===n.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&(o=e.inputList[t].connection.targetBlock())&&(o=this.allNestedComments(o))&&(s+=this.prefixLines(o,"// "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),s+t+(i?"":this.blockToCode(e))}getAdjusted(e,i,s=0,o=!1,r=t.NONE){e.workspace.options.oneBasedIndex&&s--;const a=e.workspace.options.oneBasedIndex?"1":"0";let l=r;return s?l=t.ADDITIVE:o&&(l=t.UNARY_PREFIX),e=this.valueToCode(e,i,l)||a,0!==s||o?n.isNumber$$module$build$src$core$utils$string(e)?(e=String(Number(e)+s),o&&(e=String(-Number(e))),e):(0<s?e=`${e} + ${s}`:0>s&&(e=`${e} - ${-s}`),o&&(e=s?`-(${e})`:`-${e}`),Math.floor(r)>=Math.floor(l)&&(e=`(${e})`),e):e}},d={};d.DartGenerator=h,d.Order=t;var p={lists_create_empty:function(e,i){return["[]",t.ATOMIC]},lists_create_with:function(e,i){const n=Array(e.itemCount_);for(let s=0;s<e.itemCount_;s++)n[s]=i.valueToCode(e,"ADD"+s,t.NONE)||"null";return["["+n.join(", ")+"]",t.ATOMIC]},lists_getIndex:function(e,i){function s(){const e=i.nameDB_.getDistinctName("tmp_list",n.NameType$$module$build$src$core$names.VARIABLE),t="List "+e+" = "+a+";\n";return a=e,t}var o=e.getFieldValue("MODE")||"GET";const r=e.getFieldValue("WHERE")||"FROM_START";let a=i.valueToCode(e,"VALUE","RANDOM"===r||"FROM_END"===r?t.NONE:t.UNARY_POSTFIX)||"[]";if(("RANDOM"!==r||"REMOVE"!==o)&&"FROM_END"!==r||a.match(/^\w+$/))switch(r){case"FIRST":if("GET"===o)return[a+".first",t.UNARY_POSTFIX];if("GET_REMOVE"===o)return[a+".removeAt(0)",t.UNARY_POSTFIX];if("REMOVE"===o)return a+".removeAt(0);\n";break;case"LAST":if("GET"===o)return[a+".last",t.UNARY_POSTFIX];if("GET_REMOVE"===o)return[a+".removeLast()",t.UNARY_POSTFIX];if("REMOVE"===o)return a+".removeLast();\n";break;case"FROM_START":if(e=i.getAdjusted(e,"AT"),"GET"===o)return[a+"["+e+"]",t.UNARY_POSTFIX];if("GET_REMOVE"===o)return[a+".removeAt("+e+")",t.UNARY_POSTFIX];if("REMOVE"===o)return a+".removeAt("+e+");\n";break;case"FROM_END":if(e=i.getAdjusted(e,"AT",1,!1,t.ADDITIVE),"GET"===o)return[a+"["+a+".length - "+e+"]",t.UNARY_POSTFIX];if("GET_REMOVE"===o||"REMOVE"===o){if(e=a+".removeAt("+a+".length - "+e+")","GET_REMOVE"===o)return[e,t.UNARY_POSTFIX];if("REMOVE"===o)return e+";\n"}break;case"RANDOM":if(i.definitions_.import_dart_math="import 'dart:math' as Math;","REMOVE"===o)return"int "+(o=i.nameDB_.getDistinctName("tmp_x",n.NameType$$module$build$src$core$names.VARIABLE))+" = new Math.Random().nextInt("+a+".length);\n"+a+".removeAt("+o+");\n";if("GET"===o)return[i.provideFunction_("lists_get_random_item",`\ndynamic ${i.FUNCTION_NAME_PLACEHOLDER_}(List my_list) {\n  int x = new Math.Random().nextInt(my_list.length);\n  return my_list[x];\n}\n`)+"("+a+")",t.UNARY_POSTFIX];if("GET_REMOVE"===o)return[i.provideFunction_("lists_remove_random_item",`\ndynamic ${i.FUNCTION_NAME_PLACEHOLDER_}(List my_list) {\n  int x = new Math.Random().nextInt(my_list.length);\n  return my_list.removeAt(x);\n}\n`)+"("+a+")",t.UNARY_POSTFIX]}else{if("RANDOM"===r)return i.definitions_.import_dart_math="import 'dart:math' as Math;",(o=s())+"int "+(e=i.nameDB_.getDistinctName("tmp_x",n.NameType$$module$build$src$core$names.VARIABLE))+" = new Math.Random().nextInt("+a+".length);\n"+a+".removeAt("+e+");\n";if("REMOVE"===o)return o=i.getAdjusted(e,"AT",1,!1,t.ADDITIVE),s()+(a+".removeAt(")+a+".length - "+o+");\n";if("GET"===o)return o=i.getAdjusted(e,"AT",1),[i.provideFunction_("lists_get_from_end",`\ndynamic ${i.FUNCTION_NAME_PLACEHOLDER_}(List my_list, num x) {\n  x = my_list.length - x;\n  return my_list[x];\n}\n`)+"("+a+", "+o+")",t.UNARY_POSTFIX];if("GET_REMOVE"===o)return o=i.getAdjusted(e,"AT",1),[i.provideFunction_("lists_remove_from_end",`\ndynamic ${i.FUNCTION_NAME_PLACEHOLDER_}(List my_list, num x) {\n  x = my_list.length - x;\n  return my_list.removeAt(x);\n}\n`)+"("+a+", "+o+")",t.UNARY_POSTFIX]}throw Error("Unhandled combination (lists_getIndex).")},lists_getSublist:function(e,i){const n=i.valueToCode(e,"LIST",t.UNARY_POSTFIX)||"[]";var s=e.getFieldValue("WHERE1");const o=e.getFieldValue("WHERE2");if(n.match(/^\w+$/)||"FROM_END"!==s&&"FROM_START"===o){switch(s){case"FROM_START":s=i.getAdjusted(e,"AT1");break;case"FROM_END":s=n+".length - "+(s=i.getAdjusted(e,"AT1",1,!1,t.ADDITIVE));break;case"FIRST":s="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(o){case"FROM_START":var r=i.getAdjusted(e,"AT2",1);break;case"FROM_END":r=n+".length - "+(r=i.getAdjusted(e,"AT2",0,!1,t.ADDITIVE));break;case"LAST":break;default:throw Error("Unhandled option (lists_getSublist).")}i="LAST"===o?n+".sublist("+s+")":n+".sublist("+s+", "+r+")"}else r=i.getAdjusted(e,"AT1"),e=i.getAdjusted(e,"AT2"),i=i.provideFunction_("lists_get_sublist",`\nList ${i.FUNCTION_NAME_PLACEHOLDER_}(List list, String where1, num at1, String where2, num at2) {\n  int getAt(String where, num at) {\n    if (where == 'FROM_END') {\n      at = list.length - 1 - at;\n    } else if (where == 'FIRST') {\n      at = 0;\n    } else if (where == 'LAST') {\n      at = list.length - 1;\n    } else if (where != 'FROM_START') {\n      throw 'Unhandled option (lists_getSublist).';\n    }\n    return at;\n  }\n  at1 = getAt(where1, at1);\n  at2 = getAt(where2, at2) + 1;\n  return list.sublist(at1, at2);\n}\n`)+"("+n+", '"+s+"', "+r+", '"+o+"', "+e+")";return[i,t.UNARY_POSTFIX]},lists_indexOf:function(e,i){const n="FIRST"===e.getFieldValue("END")?"indexOf":"lastIndexOf",s=i.valueToCode(e,"FIND",t.NONE)||"''";return i=(i.valueToCode(e,"VALUE",t.UNARY_POSTFIX)||"[]")+"."+n+"("+s+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.ADDITIVE]:[i,t.UNARY_POSTFIX]},lists_isEmpty:function(e,i){return[(i.valueToCode(e,"VALUE",t.UNARY_POSTFIX)||"[]")+".isEmpty",t.UNARY_POSTFIX]},lists_length:function(e,i){return[(i.valueToCode(e,"VALUE",t.UNARY_POSTFIX)||"[]")+".length",t.UNARY_POSTFIX]},lists_repeat:function(e,i){const n=i.valueToCode(e,"ITEM",t.NONE)||"null";return["new List.filled("+(i.valueToCode(e,"NUM",t.NONE)||"0")+", "+n+")",t.UNARY_POSTFIX]},lists_reverse:function(e,i){return["new List.from("+(i.valueToCode(e,"LIST",t.NONE)||"[]")+".reversed)",t.UNARY_POSTFIX]},lists_setIndex:function(e,i){function s(){if(a.match(/^\w+$/))return"";const e=i.nameDB_.getDistinctName("tmp_list",n.NameType$$module$build$src$core$names.VARIABLE),t="List "+e+" = "+a+";\n";return a=e,t}const o=e.getFieldValue("MODE")||"GET";var r=e.getFieldValue("WHERE")||"FROM_START";let a=i.valueToCode(e,"LIST",t.UNARY_POSTFIX)||"[]";const l=i.valueToCode(e,"TO",t.ASSIGNMENT)||"null";switch(r){case"FIRST":if("SET"===o)return a+"[0] = "+l+";\n";if("INSERT"===o)return a+".insert(0, "+l+");\n";break;case"LAST":if("SET"===o)return s()+(a+"[")+a+".length - 1] = "+l+";\n";if("INSERT"===o)return a+".add("+l+");\n";break;case"FROM_START":if(e=i.getAdjusted(e,"AT"),"SET"===o)return a+"["+e+"] = "+l+";\n";if("INSERT"===o)return a+".insert("+e+", "+l+");\n";break;case"FROM_END":if(e=i.getAdjusted(e,"AT",1,!1,t.ADDITIVE),r=s(),"SET"===o)return r+(a+"[")+a+".length - "+e+"] = "+l+";\n";if("INSERT"===o)return r+(a+".insert(")+a+".length - "+e+", "+l+");\n";break;case"RANDOM":if(i.definitions_.import_dart_math="import 'dart:math' as Math;",e=s(),e+="int "+(r=i.nameDB_.getDistinctName("tmp_x",n.NameType$$module$build$src$core$names.VARIABLE))+" = new Math.Random().nextInt("+a+".length);\n","SET"===o)return e+(a+"[")+r+"] = "+l+";\n";if("INSERT"===o)return e+(a+".insert(")+r+", "+l+");\n"}throw Error("Unhandled combination (lists_setIndex).")},lists_sort:function(e,i){const n=i.valueToCode(e,"LIST",t.NONE)||"[]",s="1"===e.getFieldValue("DIRECTION")?1:-1;return e=e.getFieldValue("TYPE"),[i.provideFunction_("lists_sort",`\nList ${i.FUNCTION_NAME_PLACEHOLDER_}(List list, String type, int direction) {\n  var compareFuncs = {\n    'NUMERIC': (a, b) => (direction * a.compareTo(b)).toInt(),\n    'TEXT': (a, b) => direction * a.toString().compareTo(b.toString()),\n    'IGNORE_CASE':\n      (a, b) => direction *\n      a.toString().toLowerCase().compareTo(b.toString().toLowerCase())\n  };\n  list = new List.from(list);\n  var compare = compareFuncs[type];\n  list.sort(compare);\n  return list;\n}\n`)+"("+n+', "'+e+'", '+s+")",t.UNARY_POSTFIX]},lists_split:function(e,i){let n=i.valueToCode(e,"INPUT",t.UNARY_POSTFIX);if(i=i.valueToCode(e,"DELIM",t.NONE)||"''","SPLIT"===(e=e.getFieldValue("MODE")))n||(n="''"),e="split";else{if("JOIN"!==e)throw Error("Unknown mode: "+e);n||(n="[]"),e="join"}return[n+"."+e+"("+i+")",t.UNARY_POSTFIX]}},g={};g.controls_if=s,g.controls_ifelse=s,g.logic_boolean=function(e,i){return["TRUE"===e.getFieldValue("BOOL")?"true":"false",t.ATOMIC]},g.logic_compare=function(e,i){const n={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],s="=="===n||"!="===n?t.EQUALITY:t.RELATIONAL;return[(i.valueToCode(e,"A",s)||"0")+" "+n+" "+(e=i.valueToCode(e,"B",s)||"0"),s]},g.logic_negate=function(e,i){const n=t.UNARY_PREFIX;return["!"+(i.valueToCode(e,"BOOL",n)||"true"),n]},g.logic_null=function(e,i){return["null",t.ATOMIC]},g.logic_operation=function(e,i){const n="AND"===e.getFieldValue("OP")?"&&":"||",s="&&"===n?t.LOGICAL_AND:t.LOGICAL_OR;let o=i.valueToCode(e,"A",s);return e=i.valueToCode(e,"B",s),o||e?(i="&&"===n?"true":"false",o||(o=i),e||(e=i)):e=o="false",[o+" "+n+" "+e,s]},g.logic_ternary=function(e,i){return[(i.valueToCode(e,"IF",t.CONDITIONAL)||"false")+" ? "+(i.valueToCode(e,"THEN",t.CONDITIONAL)||"null")+" : "+(e=i.valueToCode(e,"ELSE",t.CONDITIONAL)||"null"),t.CONDITIONAL]};var m={controls_flow_statements:function(e,t){let i="";if(t.STATEMENT_PREFIX&&(i+=t.injectId(t.STATEMENT_PREFIX,e)),t.STATEMENT_SUFFIX&&(i+=t.injectId(t.STATEMENT_SUFFIX,e)),t.STATEMENT_PREFIX){const n=e.getSurroundLoop();n&&!n.suppressPrefixSuffix&&(i+=t.injectId(t.STATEMENT_PREFIX,n))}switch(e.getFieldValue("FLOW")){case"BREAK":return i+"break;\n";case"CONTINUE":return i+"continue;\n"}throw Error("Unknown flow statement.")},controls_for:function(e,i){var s=i.getVariableName(e.getFieldValue("VAR")),o=i.valueToCode(e,"FROM",t.ASSIGNMENT)||"0",r=i.valueToCode(e,"TO",t.ASSIGNMENT)||"0";const a=i.valueToCode(e,"BY",t.ASSIGNMENT)||"1";let l=i.statementToCode(e,"DO");if(l=i.addLoopTrap(l,e),n.isNumber$$module$build$src$core$utils$string(o)&&n.isNumber$$module$build$src$core$utils$string(r)&&n.isNumber$$module$build$src$core$utils$string(a))e="for ("+s+" = "+o+"; "+s+((i=Number(o)<=Number(r))?" <= ":" >= ")+r+"; "+s,e=1===(s=Math.abs(Number(a)))?e+(i?"++":"--"):e+(i?" += ":" -= ")+s,e+=") {\n"+l+"}\n";else{e="";let t=o;o.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(o)||(e+="var "+(t=i.nameDB_.getDistinctName(s+"_start",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+o+";\n"),o=r,r.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(r)||(e+="var "+(o=i.nameDB_.getDistinctName(s+"_end",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+r+";\n"),e+="num "+(r=i.nameDB_.getDistinctName(s+"_inc",n.NameType$$module$build$src$core$names.VARIABLE))+" = ",e=n.isNumber$$module$build$src$core$utils$string(a)?e+(Math.abs(Number(a))+";\n"):e+"("+a+").abs();\n",e+="if ("+t+" > "+o+") {\n",e=(e+=i.INDENT+r+" = -"+r+";\n")+"}\nfor ("+s+" = "+t+"; "+r+" >= 0 ? "+s+" <= "+o+" : "+s+" >= "+o+"; "+s+" += "+r+") {\n"+l+"}\n"}return e},controls_forEach:function(e,i){const n=i.getVariableName(e.getFieldValue("VAR")),s=i.valueToCode(e,"LIST",t.ASSIGNMENT)||"[]";let o=i.statementToCode(e,"DO");return"for (var "+n+" in "+s+") {\n"+(o=i.addLoopTrap(o,e))+"}\n"}};m.controls_repeat=o,m.controls_repeat_ext=o,m.controls_whileUntil=function(e,i){const n="UNTIL"===e.getFieldValue("MODE");let s=i.valueToCode(e,"BOOL",n?t.UNARY_PREFIX:t.NONE)||"false",o=i.statementToCode(e,"DO");return n&&(s="!"+s),"while ("+s+") {\n"+(o=i.addLoopTrap(o,e))+"}\n"};var f={math_arithmetic:function(e,i){var n={ADD:[" + ",t.ADDITIVE],MINUS:[" - ",t.ADDITIVE],MULTIPLY:[" * ",t.MULTIPLICATIVE],DIVIDE:[" / ",t.MULTIPLICATIVE],POWER:[null,t.NONE]}[e.getFieldValue("OP")];const s=n[0];n=n[1];const o=i.valueToCode(e,"A",n)||"0";return e=i.valueToCode(e,"B",n)||"0",s?[o+s+e,n]:(i.definitions_.import_dart_math="import 'dart:math' as Math;",["Math.pow("+o+", "+e+")",t.UNARY_POSTFIX])},math_atan2:function(e,i){i.definitions_.import_dart_math="import 'dart:math' as Math;";const n=i.valueToCode(e,"X",t.NONE)||"0";return["Math.atan2("+(i.valueToCode(e,"Y",t.NONE)||"0")+", "+n+") / Math.pi * 180",t.MULTIPLICATIVE]},math_change:function(e,i){const n=i.valueToCode(e,"DELTA",t.ADDITIVE)||"0";return(e=i.getVariableName(e.getFieldValue("VAR")))+" = ("+e+" is num ? "+e+" : 0) + "+n+";\n"},math_constant:function(e,i){const n={PI:["Math.pi",t.UNARY_POSTFIX],E:["Math.e",t.UNARY_POSTFIX],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",t.MULTIPLICATIVE],SQRT2:["Math.sqrt2",t.UNARY_POSTFIX],SQRT1_2:["Math.sqrt1_2",t.UNARY_POSTFIX],INFINITY:["double.infinity",t.ATOMIC]};return"INFINITY"!==(e=e.getFieldValue("CONSTANT"))&&(i.definitions_.import_dart_math="import 'dart:math' as Math;"),n[e]},math_constrain:function(e,i){return i.definitions_.import_dart_math="import 'dart:math' as Math;",["Math.min(Math.max("+(i.valueToCode(e,"VALUE",t.NONE)||"0")+", "+(i.valueToCode(e,"LOW",t.NONE)||"0")+"), "+(e=i.valueToCode(e,"HIGH",t.NONE)||"double.infinity")+")",t.UNARY_POSTFIX]},math_modulo:function(e,i){return[(i.valueToCode(e,"DIVIDEND",t.MULTIPLICATIVE)||"0")+" % "+(e=i.valueToCode(e,"DIVISOR",t.MULTIPLICATIVE)||"0"),t.MULTIPLICATIVE]},math_number:function(e,i){return 1/0===(e=Number(e.getFieldValue("NUM")))?["double.infinity",t.UNARY_POSTFIX]:-1/0===e?["-double.infinity",t.UNARY_PREFIX]:[String(e),0>e?t.UNARY_PREFIX:t.ATOMIC]},math_number_property:function(e,i){var n={EVEN:[" % 2 == 0",t.MULTIPLICATIVE,t.EQUALITY],ODD:[" % 2 == 1",t.MULTIPLICATIVE,t.EQUALITY],WHOLE:[" % 1 == 0",t.MULTIPLICATIVE,t.EQUALITY],POSITIVE:[" > 0",t.RELATIONAL,t.RELATIONAL],NEGATIVE:[" < 0",t.RELATIONAL,t.RELATIONAL],DIVISIBLE_BY:[null,t.MULTIPLICATIVE,t.EQUALITY],PRIME:[null,t.NONE,t.UNARY_POSTFIX]};const s=e.getFieldValue("PROPERTY"),[o,r,a]=n[s];if(n=i.valueToCode(e,"NUMBER_TO_CHECK",r)||"0","PRIME"===s)i.definitions_.import_dart_math="import 'dart:math' as Math;",e=i.provideFunction_("math_isPrime",`\nbool ${i.FUNCTION_NAME_PLACEHOLDER_}(n) {\n  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods\n  if (n == 2 || n == 3) {\n    return true;\n  }\n  // False if n is null, negative, is 1, or not whole.\n  // And false if n is divisible by 2 or 3.\n  if (n == null || n <= 1 || n % 1 != 0 || n % 2 == 0 || n % 3 == 0) {\n    return false;\n  }\n  // Check all the numbers of form 6k +/- 1, up to sqrt(n).\n  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {\n    if (n % (x - 1) == 0 || n % (x + 1) == 0) {\n      return false;\n    }\n  }\n  return true;\n}\n`)+"("+n+")";else if("DIVISIBLE_BY"===s){if("0"===(e=i.valueToCode(e,"DIVISOR",t.MULTIPLICATIVE)||"0"))return["false",t.ATOMIC];e=n+" % "+e+" == 0"}else e=n+o;return[e,a]},math_on_list:function(e,i){const n=e.getFieldValue("OP");switch(e=i.valueToCode(e,"LIST",t.NONE)||"[]",n){case"SUM":i=i.provideFunction_("math_sum",`\nnum ${i.FUNCTION_NAME_PLACEHOLDER_}(List<num> myList) {\n  num sumVal = 0;\n  myList.forEach((num entry) {sumVal += entry;});\n  return sumVal;\n}\n`)+"("+e+")";break;case"MIN":i.definitions_.import_dart_math="import 'dart:math' as Math;",i=i.provideFunction_("math_min",`\nnum ${i.FUNCTION_NAME_PLACEHOLDER_}(List<num> myList) {\n  if (myList.isEmpty) return null;\n  num minVal = myList[0];\n  myList.forEach((num entry) {minVal = Math.min(minVal, entry);});\n  return minVal;\n}\n`)+"("+e+")";break;case"MAX":i.definitions_.import_dart_math="import 'dart:math' as Math;",i=i.provideFunction_("math_max",`\nnum ${i.FUNCTION_NAME_PLACEHOLDER_}(List<num> myList) {\n  if (myList.isEmpty) return null;\n  num maxVal = myList[0];\n  myList.forEach((num entry) {maxVal = Math.max(maxVal, entry);});\n  return maxVal;\n}\n`)+"("+e+")";break;case"AVERAGE":i=i.provideFunction_("math_mean",`\nnum ${i.FUNCTION_NAME_PLACEHOLDER_}(List myList) {\n  // First filter list for numbers only.\n  List localList = new List.from(myList);\n  localList.removeWhere((a) => a is! num);\n  if (localList.isEmpty) return null;\n  num sumVal = 0;\n  localList.forEach((var entry) {sumVal += entry;});\n  return sumVal / localList.length;\n}\n`)+"("+e+")";break;case"MEDIAN":i=i.provideFunction_("math_median",`\nnum ${i.FUNCTION_NAME_PLACEHOLDER_}(List myList) {\n  // First filter list for numbers only, then sort, then return middle value\n  // or the average of two middle values if list has an even number of elements.\n  List localList = new List.from(myList);\n  localList.removeWhere((a) => a is! num);\n  if (localList.isEmpty) return null;\n  localList.sort((a, b) => (a - b));\n  int index = localList.length ~/ 2;\n  if (localList.length % 2 == 1) {\n    return localList[index];\n  } else {\n    return (localList[index - 1] + localList[index]) / 2;\n  }\n}\n`)+"("+e+")";break;case"MODE":i.definitions_.import_dart_math="import 'dart:math' as Math;",i=i.provideFunction_("math_modes",`\nList ${i.FUNCTION_NAME_PLACEHOLDER_}(List values) {\n  List modes = [];\n  List counts = [];\n  int maxCount = 0;\n  for (int i = 0; i < values.length; i++) {\n    var value = values[i];\n    bool found = false;\n    int thisCount;\n    for (int j = 0; j < counts.length; j++) {\n      if (counts[j][0] == value) {\n        thisCount = ++counts[j][1];\n        found = true;\n        break;\n      }\n    }\n    if (!found) {\n      counts.add([value, 1]);\n      thisCount = 1;\n    }\n    maxCount = Math.max(thisCount, maxCount);\n  }\n  for (int j = 0; j < counts.length; j++) {\n    if (counts[j][1] == maxCount) {\n        modes.add(counts[j][0]);\n    }\n  }\n  return modes;\n}\n`)+"("+e+")";break;case"STD_DEV":i.definitions_.import_dart_math="import 'dart:math' as Math;",i=i.provideFunction_("math_standard_deviation",`\nnum ${i.FUNCTION_NAME_PLACEHOLDER_}(List myList) {\n  // First filter list for numbers only.\n  List numbers = new List.from(myList);\n  numbers.removeWhere((a) => a is! num);\n  if (numbers.isEmpty) return null;\n  num n = numbers.length;\n  num sum = 0;\n  numbers.forEach((x) => sum += x);\n  num mean = sum / n;\n  num sumSquare = 0;\n  numbers.forEach((x) => sumSquare += Math.pow(x - mean, 2));\n  return Math.sqrt(sumSquare / n);\n}\n`)+"("+e+")";break;case"RANDOM":i.definitions_.import_dart_math="import 'dart:math' as Math;",i=i.provideFunction_("math_random_item",`\ndynamic ${i.FUNCTION_NAME_PLACEHOLDER_}(List myList) {\n  int x = new Math.Random().nextInt(myList.length);\n  return myList[x];\n}\n`)+"("+e+")";break;default:throw Error("Unknown operator: "+n)}return[i,t.UNARY_POSTFIX]},math_random_float:function(e,i){return i.definitions_.import_dart_math="import 'dart:math' as Math;",["new Math.Random().nextDouble()",t.UNARY_POSTFIX]},math_random_int:function(e,i){i.definitions_.import_dart_math="import 'dart:math' as Math;";const n=i.valueToCode(e,"FROM",t.NONE)||"0";return e=i.valueToCode(e,"TO",t.NONE)||"0",[i.provideFunction_("math_random_int",`\nint ${i.FUNCTION_NAME_PLACEHOLDER_}(num a, num b) {\n  if (a > b) {\n    // Swap a and b to ensure a is smaller.\n    num c = a;\n    a = b;\n    b = c;\n  }\n  return new Math.Random().nextInt(b - a + 1) + a;\n}\n`)+"("+n+", "+e+")",t.UNARY_POSTFIX]}};f.math_round=r,f.math_single=r,f.math_trig=r;var _={procedures_callnoreturn:function(e,t){return t.forBlock.procedures_callreturn(e,t)[0]+";\n"},procedures_callreturn:function(e,i){const n=i.getProcedureName(e.getFieldValue("NAME")),s=[],o=e.getVars();for(let n=0;n<o.length;n++)s[n]=i.valueToCode(e,"ARG"+n,t.NONE)||"null";return[n+"("+s.join(", ")+")",t.UNARY_POSTFIX]}};_.procedures_defnoreturn=a,_.procedures_defreturn=a,_.procedures_ifreturn=function(e,i){let n="if ("+(i.valueToCode(e,"CONDITION",t.NONE)||"false")+") {\n";return i.STATEMENT_SUFFIX&&(n+=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)),e.hasReturnValue_?(e=i.valueToCode(e,"VALUE",t.NONE)||"null",n+=i.INDENT+"return "+e+";\n"):n+=i.INDENT+"return;\n",n+"}\n"};var T={text:function(e,i){return[i.quote_(e.getFieldValue("TEXT")),t.ATOMIC]},text_append:function(e,i){const n=i.getVariableName(e.getFieldValue("VAR"));return n+" = ["+n+", "+(e=i.valueToCode(e,"TEXT",t.NONE)||"''")+"].join();\n"},text_changeCase:function(e,i){const n={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[e.getFieldValue("CASE")];return e=i.valueToCode(e,"TEXT",n?t.UNARY_POSTFIX:t.NONE)||"''",[n?e+n:i.provideFunction_("text_toTitleCase",`\nString ${i.FUNCTION_NAME_PLACEHOLDER_}(String str) {\n  RegExp exp = new RegExp(r'\\b');\n  List<String> list = str.split(exp);\n  final title = new StringBuffer();\n  for (String part in list) {\n    if (part.length > 0) {\n      title.write(part[0].toUpperCase());\n      if (part.length > 0) {\n        title.write(part.substring(1).toLowerCase());\n      }\n    }\n  }\n  return title.toString();\n}\n`)+"("+e+")",t.UNARY_POSTFIX]},text_charAt:function(e,i){const n=e.getFieldValue("WHERE")||"FROM_START",s=i.valueToCode(e,"VALUE","FIRST"===n||"FROM_START"===n?t.UNARY_POSTFIX:t.NONE)||"''";switch(n){case"FIRST":return[s+"[0]",t.UNARY_POSTFIX];case"FROM_START":return[s+"["+(e=i.getAdjusted(e,"AT"))+"]",t.UNARY_POSTFIX];case"LAST":case"FROM_END":return e="LAST"===n?1:i.getAdjusted(e,"AT",1),[`${i.provideFunction_("text_get_from_end",`\nString ${i.FUNCTION_NAME_PLACEHOLDER_}(String text, num x) {\n  return text[text.length - x];\n}\n`)}(${s}, ${e})`,t.UNARY_POSTFIX];case"RANDOM":return i.definitions_.import_dart_math="import 'dart:math' as Math;",[i.provideFunction_("text_random_letter",`\nString ${i.FUNCTION_NAME_PLACEHOLDER_}(String text) {\n  int x = new Math.Random().nextInt(text.length);\n  return text[x];\n}\n`)+"("+s+")",t.UNARY_POSTFIX]}throw Error("Unhandled option (text_charAt).")},text_count:function(e,i){const n=i.valueToCode(e,"TEXT",t.NONE)||"''";return e=i.valueToCode(e,"SUB",t.NONE)||"''",[i.provideFunction_("text_count",`\nint ${i.FUNCTION_NAME_PLACEHOLDER_}(String haystack, String needle) {\n  if (needle.length == 0) {\n    return haystack.length + 1;\n  }\n  int index = 0;\n  int count = 0;\n  while (index != -1) {\n    index = haystack.indexOf(needle, index);\n    if (index != -1) {\n      count++;\n     index += needle.length;\n    }\n  }\n  return count;\n}\n`)+"("+n+", "+e+")",t.UNARY_POSTFIX]},text_getSubstring:function(e,i){var n=e.getFieldValue("WHERE1");const s=e.getFieldValue("WHERE2"),o="FROM_END"!==n&&"FROM_START"===s,r=i.valueToCode(e,"STRING",o?t.UNARY_POSTFIX:t.NONE)||"''";if("FIRST"===n&&"LAST"===s)return[r,t.NONE];if(r.match(/^'?\w+'?$/)||o){switch(n){case"FROM_START":n=i.getAdjusted(e,"AT1");break;case"FROM_END":n=r+".length - "+(n=i.getAdjusted(e,"AT1",1,!1,t.ADDITIVE));break;case"FIRST":n="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(s){case"FROM_START":var a=i.getAdjusted(e,"AT2",1);break;case"FROM_END":a=r+".length - "+(a=i.getAdjusted(e,"AT2",0,!1,t.ADDITIVE));break;case"LAST":break;default:throw Error("Unhandled option (text_getSubstring).")}i="LAST"===s?r+".substring("+n+")":r+".substring("+n+", "+a+")"}else a=i.getAdjusted(e,"AT1"),e=i.getAdjusted(e,"AT2"),i=i.provideFunction_("text_get_substring",`\nString ${i.FUNCTION_NAME_PLACEHOLDER_}(String text, String where1, num at1, String where2, num at2) {\n  int getAt(String where, num at) {\n    if (where == 'FROM_END') {\n      at = text.length - 1 - at;\n    } else if (where == 'FIRST') {\n      at = 0;\n    } else if (where == 'LAST') {\n      at = text.length - 1;\n    } else if (where != 'FROM_START') {\n      throw 'Unhandled option (text_getSubstring).';\n    }\n    return at;\n  }\n  at1 = getAt(where1, at1);\n  at2 = getAt(where2, at2) + 1;\n  return text.substring(at1, at2);\n}\n`)+"("+r+", '"+n+"', "+a+", '"+s+"', "+e+")";return[i,t.UNARY_POSTFIX]},text_indexOf:function(e,i){const n="FIRST"===e.getFieldValue("END")?"indexOf":"lastIndexOf",s=i.valueToCode(e,"FIND",t.NONE)||"''";return i=(i.valueToCode(e,"VALUE",t.UNARY_POSTFIX)||"''")+"."+n+"("+s+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.ADDITIVE]:[i,t.UNARY_POSTFIX]},text_isEmpty:function(e,i){return[(i.valueToCode(e,"VALUE",t.UNARY_POSTFIX)||"''")+".isEmpty",t.UNARY_POSTFIX]},text_join:function(e,i){switch(e.itemCount_){case 0:return["''",t.ATOMIC];case 1:return[(i.valueToCode(e,"ADD0",t.UNARY_POSTFIX)||"''")+".toString()",t.UNARY_POSTFIX];default:const n=Array(e.itemCount_);for(let s=0;s<e.itemCount_;s++)n[s]=i.valueToCode(e,"ADD"+s,t.NONE)||"''";return["["+n.join(",")+"].join()",t.UNARY_POSTFIX]}},text_length:function(e,i){return[(i.valueToCode(e,"VALUE",t.UNARY_POSTFIX)||"''")+".length",t.UNARY_POSTFIX]},text_print:function(e,i){return"print("+(i.valueToCode(e,"TEXT",t.NONE)||"''")+");\n"}};T.text_prompt=l,T.text_prompt_ext=l,T.text_replace=function(e,i){return[(i.valueToCode(e,"TEXT",t.UNARY_POSTFIX)||"''")+".replaceAll("+(i.valueToCode(e,"FROM",t.NONE)||"''")+", "+(e=i.valueToCode(e,"TO",t.NONE)||"''")+")",t.UNARY_POSTFIX]},T.text_reverse=function(e,i){return["new String.fromCharCodes("+(i.valueToCode(e,"TEXT",t.UNARY_POSTFIX)||"''")+".runes.toList().reversed)",t.UNARY_PREFIX]},T.text_trim=function(e,i){const n={LEFT:".replaceFirst(new RegExp(r'^\\s+'), '')",RIGHT:".replaceFirst(new RegExp(r'\\s+$'), '')",BOTH:".trim()"}[e.getFieldValue("MODE")];return[(i.valueToCode(e,"TEXT",t.UNARY_POSTFIX)||"''")+n,t.UNARY_POSTFIX]};var E={};E.variables_get=c,E.variables_set=u;var b={};b.variables_get_dynamic=c,b.variables_set_dynamic=u;var I=new h;I.addReservedWords("Html,Math");var y=Object.assign({},p,g,m,f,_,T,E,b);for(const e in y)I.forBlock[e]=y[e];var v={};return v.DartGenerator=h,v.Order=t,v.dartGenerator=I,v.__namespace__=n,v},"function"==typeof define&&define.amd?define(["./blockly_compressed.js"],s):"object"==typeof i?t.exports=s(e("./blockly_compressed.js")):(n.dart=s(n.Blockly),n.Blockly.Dart=n.dart.dartGenerator)},{"./blockly_compressed.js":201}],207:[function(e,t,i){var n,s;n=this,s=function(e,t,i){"use strict";return e.setLocale(t),e},"function"==typeof define&&define.amd?define(["blockly/core","blockly/msg/en","blockly/blocks"],s):"object"==typeof i?t.exports=s(e("blockly/core"),e("blockly/msg/en"),e("blockly/blocks")):n.Blockly=s(n.Blockly,n.Blockly.Msg,n.Blockly.Blocks)},{"blockly/blocks":202,"blockly/core":204,"blockly/msg/en":212}],208:[function(e,t,i){t.exports=e("./javascript_compressed.js")},{"./javascript_compressed.js":209}],209:[function(e,t,i){var n,s;n=this,s=function(e){var t,i,n=e.__namespace__,s=function(e,i){var n=0;let s="";i.STATEMENT_PREFIX&&(s+=i.injectId(i.STATEMENT_PREFIX,e));do{const o=i.valueToCode(e,"IF"+n,t.NONE)||"false";let r=i.statementToCode(e,"DO"+n);i.STATEMENT_SUFFIX&&(r=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+r),s+=(0<n?" else ":"")+"if ("+o+") {\n"+r+"}",n++}while(e.getInput("IF"+n));return(e.getInput("ELSE")||i.STATEMENT_SUFFIX)&&(n=i.statementToCode(e,"ELSE"),i.STATEMENT_SUFFIX&&(n=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+n),s+=" else {\n"+n+"}"),s+"\n"},o=function(e,i){let s;s=e.getField("TIMES")?String(Number(e.getFieldValue("TIMES"))):i.valueToCode(e,"TIMES",t.ASSIGNMENT)||"0";let o=i.statementToCode(e,"DO");o=i.addLoopTrap(o,e),e="";const r=i.nameDB_.getDistinctName("count",n.NameType$$module$build$src$core$names.VARIABLE);let a=s;return s.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(s)||(e+="var "+(a=i.nameDB_.getDistinctName("repeat_end",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+s+";\n"),e+"for (var "+r+" = 0; "+r+" < "+a+"; "+r+"++) {\n"+o+"}\n"},r=function(e,i){const n=e.getFieldValue("OP");let s;if("NEG"===n)return"-"===(e=i.valueToCode(e,"NUM",t.UNARY_NEGATION)||"0")[0]&&(e=" "+e),["-"+e,t.UNARY_NEGATION];switch(e="SIN"===n||"COS"===n||"TAN"===n?i.valueToCode(e,"NUM",t.DIVISION)||"0":i.valueToCode(e,"NUM",t.NONE)||"0",n){case"ABS":s="Math.abs("+e+")";break;case"ROOT":s="Math.sqrt("+e+")";break;case"LN":s="Math.log("+e+")";break;case"EXP":s="Math.exp("+e+")";break;case"POW10":s="Math.pow(10,"+e+")";break;case"ROUND":s="Math.round("+e+")";break;case"ROUNDUP":s="Math.ceil("+e+")";break;case"ROUNDDOWN":s="Math.floor("+e+")";break;case"SIN":s="Math.sin("+e+" / 180 * Math.PI)";break;case"COS":s="Math.cos("+e+" / 180 * Math.PI)";break;case"TAN":s="Math.tan("+e+" / 180 * Math.PI)"}if(s)return[s,t.FUNCTION_CALL];switch(n){case"LOG10":s="Math.log("+e+") / Math.log(10)";break;case"ASIN":s="Math.asin("+e+") / Math.PI * 180";break;case"ACOS":s="Math.acos("+e+") / Math.PI * 180";break;case"ATAN":s="Math.atan("+e+") / Math.PI * 180";break;default:throw Error("Unknown math operator: "+n)}return[s,t.DIVISION]},a=function(e,i){const n=i.getProcedureName(e.getFieldValue("NAME"));var s="";i.STATEMENT_PREFIX&&(s+=i.injectId(i.STATEMENT_PREFIX,e)),i.STATEMENT_SUFFIX&&(s+=i.injectId(i.STATEMENT_SUFFIX,e)),s&&(s=i.prefixLines(s,i.INDENT));let o="";i.INFINITE_LOOP_TRAP&&(o=i.prefixLines(i.injectId(i.INFINITE_LOOP_TRAP,e),i.INDENT));let r="";e.getInput("STACK")&&(r=i.statementToCode(e,"STACK"));let a="";e.getInput("RETURN")&&(a=i.valueToCode(e,"RETURN",t.NONE)||"");let l="";r&&a&&(l=s),a&&(a=i.INDENT+"return "+a+";\n");const c=[],u=e.getVars();for(let e=0;e<u.length;e++)c[e]=i.getVariableName(u[e]);return s="function "+n+"("+c.join(", ")+") {\n"+s+o+r+l+a+"}",s=i.scrub_(e,s),i.definitions_["%"+n]=s,null},l=function(e,i){return i="window.prompt("+(e.getField("TEXT")?i.quote_(e.getFieldValue("TEXT")):i.valueToCode(e,"TEXT",t.NONE)||"''")+")","NUMBER"===e.getFieldValue("TYPE")&&(i="Number("+i+")"),[i,t.FUNCTION_CALL]},c=function(e,i){return[i.getVariableName(e.getFieldValue("VAR")),t.ATOMIC]},u=function(e,i){const n=i.valueToCode(e,"VALUE",t.ASSIGNMENT)||"0";return i.getVariableName(e.getFieldValue("VAR"))+" = "+n+";\n"};(i=t||(t={}))[i.ATOMIC=0]="ATOMIC",i[i.NEW=1.1]="NEW",i[i.MEMBER=1.2]="MEMBER",i[i.FUNCTION_CALL=2]="FUNCTION_CALL",i[i.INCREMENT=3]="INCREMENT",i[i.DECREMENT=3]="DECREMENT",i[i.BITWISE_NOT=4.1]="BITWISE_NOT",i[i.UNARY_PLUS=4.2]="UNARY_PLUS",i[i.UNARY_NEGATION=4.3]="UNARY_NEGATION",i[i.LOGICAL_NOT=4.4]="LOGICAL_NOT",i[i.TYPEOF=4.5]="TYPEOF",i[i.VOID=4.6]="VOID",i[i.DELETE=4.7]="DELETE",i[i.AWAIT=4.8]="AWAIT",i[i.EXPONENTIATION=5]="EXPONENTIATION",i[i.MULTIPLICATION=5.1]="MULTIPLICATION",i[i.DIVISION=5.2]="DIVISION",i[i.MODULUS=5.3]="MODULUS",i[i.SUBTRACTION=6.1]="SUBTRACTION",i[i.ADDITION=6.2]="ADDITION",i[i.BITWISE_SHIFT=7]="BITWISE_SHIFT",i[i.RELATIONAL=8]="RELATIONAL",i[i.IN=8]="IN",i[i.INSTANCEOF=8]="INSTANCEOF",i[i.EQUALITY=9]="EQUALITY",i[i.BITWISE_AND=10]="BITWISE_AND",i[i.BITWISE_XOR=11]="BITWISE_XOR",i[i.BITWISE_OR=12]="BITWISE_OR",i[i.LOGICAL_AND=13]="LOGICAL_AND",i[i.LOGICAL_OR=14]="LOGICAL_OR",i[i.CONDITIONAL=15]="CONDITIONAL",i[i.ASSIGNMENT=16]="ASSIGNMENT",i[i.YIELD=17]="YIELD",i[i.COMMA=18]="COMMA",i[i.NONE=99]="NONE";var h=class extends n.CodeGenerator$$module$build$src$core$generator{constructor(e="JavaScript"){super(e),this.ORDER_OVERRIDES=[[t.FUNCTION_CALL,t.MEMBER],[t.FUNCTION_CALL,t.FUNCTION_CALL],[t.MEMBER,t.MEMBER],[t.MEMBER,t.FUNCTION_CALL],[t.LOGICAL_NOT,t.LOGICAL_NOT],[t.MULTIPLICATION,t.MULTIPLICATION],[t.ADDITION,t.ADDITION],[t.LOGICAL_AND,t.LOGICAL_AND],[t.LOGICAL_OR,t.LOGICAL_OR]],this.isInitialized=!1;for(const i in t)"string"!=typeof(e=t[i])&&(this["ORDER_"+i]=e);this.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(globalThis).join(","))}init(e){super.init(e),this.nameDB_?this.nameDB_.reset():this.nameDB_=new n.Names$$module$build$src$core$names(this.RESERVED_WORDS_),this.nameDB_.setVariableMap(e.getVariableMap()),this.nameDB_.populateVariables(e),this.nameDB_.populateProcedures(e);const t=[];var i=n.allDeveloperVariables$$module$build$src$core$variables(e);for(let e=0;e<i.length;e++)t.push(this.nameDB_.getName(i[e],n.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));for(e=n.allUsedVarModels$$module$build$src$core$variables(e),i=0;i<e.length;i++)t.push(this.nameDB_.getName(e[i].getId(),n.NameType$$module$build$src$core$names.VARIABLE));t.length&&(this.definitions_.variables="var "+t.join(", ")+";"),this.isInitialized=!0}finish(e){const t=Object.values(this.definitions_);return super.finish(e),this.isInitialized=!1,this.nameDB_.reset(),t.join("\n\n")+"\n\n\n"+e}scrubNakedValue(e){return e+";\n"}quote_(e){return"'"+(e=e.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"))+"'"}multiline_quote_(e){return e.split(/\n/g).map(this.quote_).join(" + '\\n' +\n")}scrub_(e,t,i=!1){let s="";if(!e.outputConnection||!e.outputConnection.targetConnection){var o=e.getCommentText();o&&(o=n.wrap$$module$build$src$core$utils$string(o,this.COMMENT_WRAP-3),s+=this.prefixLines(o+"\n","// "));for(let t=0;t<e.inputList.length;t++)e.inputList[t].type===n.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&(o=e.inputList[t].connection.targetBlock())&&(o=this.allNestedComments(o))&&(s+=this.prefixLines(o,"// "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),s+t+(i?"":this.blockToCode(e))}getAdjusted(e,i,s=0,o=!1,r=t.NONE){e.workspace.options.oneBasedIndex&&s--;const a=e.workspace.options.oneBasedIndex?"1":"0";let l=r;return 0<s?l=t.ADDITION:0>s?l=t.SUBTRACTION:o&&(l=t.UNARY_NEGATION),e=this.valueToCode(e,i,l)||a,0!==s||o?n.isNumber$$module$build$src$core$utils$string(e)?(e=String(Number(e)+s),o&&(e=String(-Number(e))),e):(0<s?e=`${e} + ${s}`:0>s&&(e=`${e} - ${-s}`),o&&(e=s?`-(${e})`:`-${e}`),Math.floor(r)>=Math.floor(l)&&(e=`(${e})`),e):e}},d={};d.JavascriptGenerator=h,d.Order=t;var p=function(e,t,i){return"FIRST"===t?"0":"FROM_END"===t?e+".length - 1 - "+i:"LAST"===t?e+".length - 1":i},g={lists_create_empty:function(e,i){return["[]",t.ATOMIC]},lists_create_with:function(e,i){const n=Array(e.itemCount_);for(let s=0;s<e.itemCount_;s++)n[s]=i.valueToCode(e,"ADD"+s,t.NONE)||"null";return["["+n.join(", ")+"]",t.ATOMIC]},lists_getIndex:function(e,i){const n=e.getFieldValue("MODE")||"GET",s=e.getFieldValue("WHERE")||"FROM_START";var o=i.valueToCode(e,"VALUE","RANDOM"===s?t.NONE:t.MEMBER)||"[]";switch(s){case"FIRST":if("GET"===n)return[o+"[0]",t.MEMBER];if("GET_REMOVE"===n)return[o+".shift()",t.MEMBER];if("REMOVE"===n)return o+".shift();\n";break;case"LAST":if("GET"===n)return[o+".slice(-1)[0]",t.MEMBER];if("GET_REMOVE"===n)return[o+".pop()",t.MEMBER];if("REMOVE"===n)return o+".pop();\n";break;case"FROM_START":if(e=i.getAdjusted(e,"AT"),"GET"===n)return[o+"["+e+"]",t.MEMBER];if("GET_REMOVE"===n)return[o+".splice("+e+", 1)[0]",t.FUNCTION_CALL];if("REMOVE"===n)return o+".splice("+e+", 1);\n";break;case"FROM_END":if(e=i.getAdjusted(e,"AT",1,!0),"GET"===n)return[o+".slice("+e+")[0]",t.FUNCTION_CALL];if("GET_REMOVE"===n)return[o+".splice("+e+", 1)[0]",t.FUNCTION_CALL];if("REMOVE"===n)return o+".splice("+e+", 1);";break;case"RANDOM":if(o=i.provideFunction_("listsGetRandomItem",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(list, remove) {\n  var x = Math.floor(Math.random() * list.length);\n  if (remove) {\n    return list.splice(x, 1)[0];\n  } else {\n    return list[x];\n  }\n}\n`)+"("+o+", "+("GET"!==n)+")","GET"===n||"GET_REMOVE"===n)return[o,t.FUNCTION_CALL];if("REMOVE"===n)return o+";\n"}throw Error("Unhandled combination (lists_getIndex).")},lists_getSublist:function(e,i){var n={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"},s=i.valueToCode(e,"LIST",t.MEMBER)||"[]";const o=e.getFieldValue("WHERE1"),r=e.getFieldValue("WHERE2");if("FIRST"===o&&"LAST"===r)s+=".slice(0)";else if(s.match(/^\w+$/)||"FROM_END"!==o&&"FROM_START"===r){switch(o){case"FROM_START":n=i.getAdjusted(e,"AT1");break;case"FROM_END":n=s+".length - "+(n=i.getAdjusted(e,"AT1",1,!1,t.SUBTRACTION));break;case"FIRST":n="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(r){case"FROM_START":i=i.getAdjusted(e,"AT2",1);break;case"FROM_END":i=s+".length - "+(i=i.getAdjusted(e,"AT2",0,!1,t.SUBTRACTION));break;case"LAST":i=s+".length";break;default:throw Error("Unhandled option (lists_getSublist).")}s=s+".slice("+n+", "+i+")"}else{const t=i.getAdjusted(e,"AT1");e=i.getAdjusted(e,"AT2"),s=i.provideFunction_("subsequence"+n[o]+n[r],`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(sequence${"FROM_END"===o||"FROM_START"===o?", at1":""}${"FROM_END"===r||"FROM_START"===r?", at2":""}) {\n  var start = ${p("sequence",o,"at1")};\n  var end = ${p("sequence",r,"at2")} + 1;\n  return sequence.slice(start, end);\n}\n`)+"("+s+("FROM_END"===o||"FROM_START"===o?", "+t:"")+("FROM_END"===r||"FROM_START"===r?", "+e:"")+")"}return[s,t.FUNCTION_CALL]},lists_indexOf:function(e,i){const n="FIRST"===e.getFieldValue("END")?"indexOf":"lastIndexOf",s=i.valueToCode(e,"FIND",t.NONE)||"''";return i=(i.valueToCode(e,"VALUE",t.MEMBER)||"[]")+"."+n+"("+s+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.ADDITION]:[i,t.FUNCTION_CALL]},lists_isEmpty:function(e,i){return["!"+(i.valueToCode(e,"VALUE",t.MEMBER)||"[]")+".length",t.LOGICAL_NOT]},lists_length:function(e,i){return[(i.valueToCode(e,"VALUE",t.MEMBER)||"[]")+".length",t.MEMBER]},lists_repeat:function(e,i){return[i.provideFunction_("listsRepeat",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(value, n) {\n  var array = [];\n  for (var i = 0; i < n; i++) {\n    array[i] = value;\n  }\n  return array;\n}\n`)+"("+(i.valueToCode(e,"ITEM",t.NONE)||"null")+", "+(e=i.valueToCode(e,"NUM",t.NONE)||"0")+")",t.FUNCTION_CALL]},lists_reverse:function(e,i){return[(i.valueToCode(e,"LIST",t.FUNCTION_CALL)||"[]")+".slice().reverse()",t.FUNCTION_CALL]},lists_setIndex:function(e,i){function s(){if(o.match(/^\w+$/))return"";const e=i.nameDB_.getDistinctName("tmpList",n.NameType$$module$build$src$core$names.VARIABLE),t="var "+e+" = "+o+";\n";return o=e,t}let o=i.valueToCode(e,"LIST",t.MEMBER)||"[]";const r=e.getFieldValue("MODE")||"GET";var a=e.getFieldValue("WHERE")||"FROM_START";const l=i.valueToCode(e,"TO",t.ASSIGNMENT)||"null";switch(a){case"FIRST":if("SET"===r)return o+"[0] = "+l+";\n";if("INSERT"===r)return o+".unshift("+l+");\n";break;case"LAST":if("SET"===r)return s()+(o+"[")+o+".length - 1] = "+l+";\n";if("INSERT"===r)return o+".push("+l+");\n";break;case"FROM_START":if(e=i.getAdjusted(e,"AT"),"SET"===r)return o+"["+e+"] = "+l+";\n";if("INSERT"===r)return o+".splice("+e+", 0, "+l+");\n";break;case"FROM_END":if(e=i.getAdjusted(e,"AT",1,!1,t.SUBTRACTION),a=s(),"SET"===r)return a+(o+"[")+o+".length - "+e+"] = "+l+";\n";if("INSERT"===r)return a+(o+".splice(")+o+".length - "+e+", 0, "+l+");\n";break;case"RANDOM":if(e=s(),e+="var "+(a=i.nameDB_.getDistinctName("tmpX",n.NameType$$module$build$src$core$names.VARIABLE))+" = Math.floor(Math.random() * "+o+".length);\n","SET"===r)return e+(o+"[")+a+"] = "+l+";\n";if("INSERT"===r)return e+(o+".splice(")+a+", 0, "+l+");\n"}throw Error("Unhandled combination (lists_setIndex).")},lists_sort:function(e,i){const n=i.valueToCode(e,"LIST",t.FUNCTION_CALL)||"[]",s="1"===e.getFieldValue("DIRECTION")?1:-1;return e=e.getFieldValue("TYPE"),[n+".slice().sort("+(i=i.provideFunction_("listsGetSortCompare",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(type, direction) {\n  var compareFuncs = {\n    'NUMERIC': function(a, b) {\n        return Number(a) - Number(b); },\n    'TEXT': function(a, b) {\n        return String(a) > String(b) ? 1 : -1; },\n    'IGNORE_CASE': function(a, b) {\n        return String(a).toLowerCase() > String(b).toLowerCase() ? 1 : -1; },\n  };\n  var compare = compareFuncs[type];\n  return function(a, b) { return compare(a, b) * direction; };\n}\n      `))+'("'+e+'", '+s+"))",t.FUNCTION_CALL]},lists_split:function(e,i){let n=i.valueToCode(e,"INPUT",t.MEMBER);if(i=i.valueToCode(e,"DELIM",t.NONE)||"''","SPLIT"===(e=e.getFieldValue("MODE")))n||(n="''"),e="split";else{if("JOIN"!==e)throw Error("Unknown mode: "+e);n||(n="[]"),e="join"}return[n+"."+e+"("+i+")",t.FUNCTION_CALL]}},m={};m.controls_if=s,m.controls_ifelse=s,m.logic_boolean=function(e,i){return["TRUE"===e.getFieldValue("BOOL")?"true":"false",t.ATOMIC]},m.logic_compare=function(e,i){const n={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],s="=="===n||"!="===n?t.EQUALITY:t.RELATIONAL;return[(i.valueToCode(e,"A",s)||"0")+" "+n+" "+(e=i.valueToCode(e,"B",s)||"0"),s]},m.logic_negate=function(e,i){const n=t.LOGICAL_NOT;return["!"+(i.valueToCode(e,"BOOL",n)||"true"),n]},m.logic_null=function(e,i){return["null",t.ATOMIC]},m.logic_operation=function(e,i){const n="AND"===e.getFieldValue("OP")?"&&":"||",s="&&"===n?t.LOGICAL_AND:t.LOGICAL_OR;let o=i.valueToCode(e,"A",s);return e=i.valueToCode(e,"B",s),o||e?(i="&&"===n?"true":"false",o||(o=i),e||(e=i)):e=o="false",[o+" "+n+" "+e,s]},m.logic_ternary=function(e,i){return[(i.valueToCode(e,"IF",t.CONDITIONAL)||"false")+" ? "+(i.valueToCode(e,"THEN",t.CONDITIONAL)||"null")+" : "+(e=i.valueToCode(e,"ELSE",t.CONDITIONAL)||"null"),t.CONDITIONAL]};var f={controls_flow_statements:function(e,t){let i="";if(t.STATEMENT_PREFIX&&(i+=t.injectId(t.STATEMENT_PREFIX,e)),t.STATEMENT_SUFFIX&&(i+=t.injectId(t.STATEMENT_SUFFIX,e)),t.STATEMENT_PREFIX){const n=e.getSurroundLoop();n&&!n.suppressPrefixSuffix&&(i+=t.injectId(t.STATEMENT_PREFIX,n))}switch(e.getFieldValue("FLOW")){case"BREAK":return i+"break;\n";case"CONTINUE":return i+"continue;\n"}throw Error("Unknown flow statement.")},controls_for:function(e,i){var s=i.getVariableName(e.getFieldValue("VAR")),o=i.valueToCode(e,"FROM",t.ASSIGNMENT)||"0",r=i.valueToCode(e,"TO",t.ASSIGNMENT)||"0";const a=i.valueToCode(e,"BY",t.ASSIGNMENT)||"1";let l=i.statementToCode(e,"DO");if(l=i.addLoopTrap(l,e),n.isNumber$$module$build$src$core$utils$string(o)&&n.isNumber$$module$build$src$core$utils$string(r)&&n.isNumber$$module$build$src$core$utils$string(a))e="for ("+s+" = "+o+"; "+s+((i=Number(o)<=Number(r))?" <= ":" >= ")+r+"; "+s,e=1===(s=Math.abs(Number(a)))?e+(i?"++":"--"):e+(i?" += ":" -= ")+s,e+=") {\n"+l+"}\n";else{e="";let t=o;o.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(o)||(e+="var "+(t=i.nameDB_.getDistinctName(s+"_start",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+o+";\n"),o=r,r.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(r)||(e+="var "+(o=i.nameDB_.getDistinctName(s+"_end",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+r+";\n"),e+="var "+(r=i.nameDB_.getDistinctName(s+"_inc",n.NameType$$module$build$src$core$names.VARIABLE))+" = ",e=n.isNumber$$module$build$src$core$utils$string(a)?e+(Math.abs(Number(a))+";\n"):e+"Math.abs("+a+");\n",e+="if ("+t+" > "+o+") {\n",e=(e+=i.INDENT+r+" = -"+r+";\n")+"}\nfor ("+s+" = "+t+"; "+r+" >= 0 ? "+s+" <= "+o+" : "+s+" >= "+o+"; "+s+" += "+r+") {\n"+l+"}\n"}return e},controls_forEach:function(e,i){const s=i.getVariableName(e.getFieldValue("VAR"));var o=i.valueToCode(e,"LIST",t.ASSIGNMENT)||"[]";let r=i.statementToCode(e,"DO");r=i.addLoopTrap(r,e),e="";let a=o;return o.match(/^\w+$/)||(e+="var "+(a=i.nameDB_.getDistinctName(s+"_list",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+o+";\n"),e+"for (var "+(o=i.nameDB_.getDistinctName(s+"_index",n.NameType$$module$build$src$core$names.VARIABLE))+" in "+a+") {\n"+(r=i.INDENT+s+" = "+a+"["+o+"];\n"+r)+"}\n"}};f.controls_repeat=o,f.controls_repeat_ext=o,f.controls_whileUntil=function(e,i){const n="UNTIL"===e.getFieldValue("MODE");let s=i.valueToCode(e,"BOOL",n?t.LOGICAL_NOT:t.NONE)||"false",o=i.statementToCode(e,"DO");return n&&(s="!"+s),"while ("+s+") {\n"+(o=i.addLoopTrap(o,e))+"}\n"};var _={math_arithmetic:function(e,i){var n={ADD:[" + ",t.ADDITION],MINUS:[" - ",t.SUBTRACTION],MULTIPLY:[" * ",t.MULTIPLICATION],DIVIDE:[" / ",t.DIVISION],POWER:[null,t.NONE]}[e.getFieldValue("OP")];const s=n[0];n=n[1];const o=i.valueToCode(e,"A",n)||"0";return e=i.valueToCode(e,"B",n)||"0",s?[o+s+e,n]:["Math.pow("+o+", "+e+")",t.FUNCTION_CALL]},math_atan2:function(e,i){const n=i.valueToCode(e,"X",t.NONE)||"0";return["Math.atan2("+(i.valueToCode(e,"Y",t.NONE)||"0")+", "+n+") / Math.PI * 180",t.DIVISION]},math_change:function(e,i){const n=i.valueToCode(e,"DELTA",t.ADDITION)||"0";return(e=i.getVariableName(e.getFieldValue("VAR")))+" = (typeof "+e+" === 'number' ? "+e+" : 0) + "+n+";\n"},math_constant:function(e,i){return{PI:["Math.PI",t.MEMBER],E:["Math.E",t.MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",t.DIVISION],SQRT2:["Math.SQRT2",t.MEMBER],SQRT1_2:["Math.SQRT1_2",t.MEMBER],INFINITY:["Infinity",t.ATOMIC]}[e.getFieldValue("CONSTANT")]},math_constrain:function(e,i){return["Math.min(Math.max("+(i.valueToCode(e,"VALUE",t.NONE)||"0")+", "+(i.valueToCode(e,"LOW",t.NONE)||"0")+"), "+(e=i.valueToCode(e,"HIGH",t.NONE)||"Infinity")+")",t.FUNCTION_CALL]},math_modulo:function(e,i){return[(i.valueToCode(e,"DIVIDEND",t.MODULUS)||"0")+" % "+(e=i.valueToCode(e,"DIVISOR",t.MODULUS)||"0"),t.MODULUS]},math_number:function(e,i){return e=Number(e.getFieldValue("NUM")),[String(e),0<=e?t.ATOMIC:t.UNARY_NEGATION]},math_number_property:function(e,i){var n={EVEN:[" % 2 === 0",t.MODULUS,t.EQUALITY],ODD:[" % 2 === 1",t.MODULUS,t.EQUALITY],WHOLE:[" % 1 === 0",t.MODULUS,t.EQUALITY],POSITIVE:[" > 0",t.RELATIONAL,t.RELATIONAL],NEGATIVE:[" < 0",t.RELATIONAL,t.RELATIONAL],DIVISIBLE_BY:[null,t.MODULUS,t.EQUALITY],PRIME:[null,t.NONE,t.FUNCTION_CALL]};const s=e.getFieldValue("PROPERTY"),[o,r,a]=n[s];return n=i.valueToCode(e,"NUMBER_TO_CHECK",r)||"0",[e="PRIME"===s?i.provideFunction_("mathIsPrime",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(n) {\n  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods\n  if (n == 2 || n == 3) {\n    return true;\n  }\n  // False if n is NaN, negative, is 1, or not whole.\n  // And false if n is divisible by 2 or 3.\n  if (isNaN(n) || n <= 1 || n % 1 !== 0 || n % 2 === 0 || n % 3 === 0) {\n    return false;\n  }\n  // Check all the numbers of form 6k +/- 1, up to sqrt(n).\n  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {\n    if (n % (x - 1) === 0 || n % (x + 1) === 0) {\n      return false;\n    }\n  }\n  return true;\n}\n`)+"("+n+")":"DIVISIBLE_BY"===s?n+" % "+(e=i.valueToCode(e,"DIVISOR",t.MODULUS)||"0")+" === 0":n+o,a]},math_on_list:function(e,i){var n=e.getFieldValue("OP");switch(n){case"SUM":e=i.valueToCode(e,"LIST",t.MEMBER)||"[]",e+=".reduce(function(x, y) {return x + y;}, 0)";break;case"MIN":e="Math.min.apply(null, "+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MAX":e="Math.max.apply(null, "+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"AVERAGE":e=(n=i.provideFunction_("mathMean",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  return myList.reduce(function(x, y) {return x + y;}, 0) / myList.length;\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MEDIAN":e=(n=i.provideFunction_("mathMedian",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  var localList = myList.filter(function (x) {return typeof x === 'number';});\n  if (!localList.length) return null;\n  localList.sort(function(a, b) {return b - a;});\n  if (localList.length % 2 === 0) {\n    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;\n  } else {\n    return localList[(localList.length - 1) / 2];\n  }\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MODE":e=(n=i.provideFunction_("mathModes",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(values) {\n  var modes = [];\n  var counts = [];\n  var maxCount = 0;\n  for (var i = 0; i < values.length; i++) {\n    var value = values[i];\n    var found = false;\n    var thisCount;\n    for (var j = 0; j < counts.length; j++) {\n      if (counts[j][0] === value) {\n        thisCount = ++counts[j][1];\n        found = true;\n        break;\n      }\n    }\n    if (!found) {\n      counts.push([value, 1]);\n      thisCount = 1;\n    }\n    maxCount = Math.max(thisCount, maxCount);\n  }\n  for (var j = 0; j < counts.length; j++) {\n    if (counts[j][1] === maxCount) {\n      modes.push(counts[j][0]);\n    }\n  }\n  return modes;\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"STD_DEV":e=(n=i.provideFunction_("mathStandardDeviation",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(numbers) {\n  var n = numbers.length;\n  if (!n) return null;\n  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;\n  var variance = 0;\n  for (var j = 0; j < n; j++) {\n    variance += Math.pow(numbers[j] - mean, 2);\n  }\n  variance /= n;\n  return Math.sqrt(variance);\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"RANDOM":e=(n=i.provideFunction_("mathRandomList",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(list) {\n  var x = Math.floor(Math.random() * list.length);\n  return list[x];\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;default:throw Error("Unknown operator: "+n)}return[e,t.FUNCTION_CALL]},math_random_float:function(e,i){return["Math.random()",t.FUNCTION_CALL]},math_random_int:function(e,i){const n=i.valueToCode(e,"FROM",t.NONE)||"0";return e=i.valueToCode(e,"TO",t.NONE)||"0",[i.provideFunction_("mathRandomInt",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(a, b) {\n  if (a > b) {\n    // Swap a and b to ensure a is smaller.\n    var c = a;\n    a = b;\n    b = c;\n  }\n  return Math.floor(Math.random() * (b - a + 1) + a);\n}\n`)+"("+n+", "+e+")",t.FUNCTION_CALL]}};_.math_round=r,_.math_single=r,_.math_trig=r;var T={procedures_callnoreturn:function(e,t){return t.forBlock.procedures_callreturn(e,t)[0]+";\n"},procedures_callreturn:function(e,i){const n=i.getProcedureName(e.getFieldValue("NAME")),s=[],o=e.getVars();for(let n=0;n<o.length;n++)s[n]=i.valueToCode(e,"ARG"+n,t.NONE)||"null";return[n+"("+s.join(", ")+")",t.FUNCTION_CALL]}};T.procedures_defnoreturn=a,T.procedures_defreturn=a,T.procedures_ifreturn=function(e,i){let n="if ("+(i.valueToCode(e,"CONDITION",t.NONE)||"false")+") {\n";return i.STATEMENT_SUFFIX&&(n+=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)),e.hasReturnValue_?(e=i.valueToCode(e,"VALUE",t.NONE)||"null",n+=i.INDENT+"return "+e+";\n"):n+=i.INDENT+"return;\n",n+"}\n"};var E=/^\s*'([^']|\\')*'\s*$/,b=function(e){return E.test(e)?[e,t.ATOMIC]:["String("+e+")",t.FUNCTION_CALL]},I=function(e,t,i){return"FIRST"===t?"0":"FROM_END"===t?e+".length - 1 - "+i:"LAST"===t?e+".length - 1":i},y={text:function(e,i){return[i.quote_(e.getFieldValue("TEXT")),t.ATOMIC]},text_append:function(e,i){const n=i.getVariableName(e.getFieldValue("VAR"));return e=i.valueToCode(e,"TEXT",t.NONE)||"''",n+" += "+b(e)[0]+";\n"},text_changeCase:function(e,i){const n={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[e.getFieldValue("CASE")];return e=i.valueToCode(e,"TEXT",n?t.MEMBER:t.NONE)||"''",[n?e+n:i.provideFunction_("textToTitleCase",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(str) {\n  return str.replace(/\\S+/g,\n      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});\n}\n`)+"("+e+")",t.FUNCTION_CALL]},text_charAt:function(e,i){const n=e.getFieldValue("WHERE")||"FROM_START",s=i.valueToCode(e,"VALUE","RANDOM"===n?t.NONE:t.MEMBER)||"''";switch(n){case"FIRST":return[s+".charAt(0)",t.FUNCTION_CALL];case"LAST":return[s+".slice(-1)",t.FUNCTION_CALL];case"FROM_START":return[s+".charAt("+(e=i.getAdjusted(e,"AT"))+")",t.FUNCTION_CALL];case"FROM_END":return[s+".slice("+(e=i.getAdjusted(e,"AT",1,!0))+").charAt(0)",t.FUNCTION_CALL];case"RANDOM":return[i.provideFunction_("textRandomLetter",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(text) {\n  var x = Math.floor(Math.random() * text.length);\n  return text[x];\n}\n`)+"("+s+")",t.FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},text_count:function(e,i){const n=i.valueToCode(e,"TEXT",t.NONE)||"''";return e=i.valueToCode(e,"SUB",t.NONE)||"''",[i.provideFunction_("textCount",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle) {\n  if (needle.length === 0) {\n    return haystack.length + 1;\n  } else {\n    return haystack.split(needle).length - 1;\n  }\n}\n`)+"("+n+", "+e+")",t.FUNCTION_CALL]},text_getSubstring:function(e,i){var n={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};const s=e.getFieldValue("WHERE1"),o=e.getFieldValue("WHERE2");var r="FROM_END"!==s&&"LAST"!==s&&"FROM_END"!==o&&"LAST"!==o,a=i.valueToCode(e,"STRING",r?t.MEMBER:t.NONE)||"''";if("FIRST"===s&&"LAST"===o)return[a,t.NONE];if(a.match(/^'?\w+'?$/)||r){switch(s){case"FROM_START":n=i.getAdjusted(e,"AT1");break;case"FROM_END":n=a+".length - "+(n=i.getAdjusted(e,"AT1",1,!1,t.SUBTRACTION));break;case"FIRST":n="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(o){case"FROM_START":i=i.getAdjusted(e,"AT2",1);break;case"FROM_END":i=a+".length - "+(i=i.getAdjusted(e,"AT2",0,!1,t.SUBTRACTION));break;case"LAST":i=a+".length";break;default:throw Error("Unhandled option (text_getSubstring).")}a=a+".slice("+n+", "+i+")"}else r=i.getAdjusted(e,"AT1"),e=i.getAdjusted(e,"AT2"),a=i.provideFunction_("subsequence"+n[s]+n[o],`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(sequence${"FROM_END"===s||"FROM_START"===s?", at1":""}${"FROM_END"===o||"FROM_START"===o?", at2":""}) {\n  var start = ${I("sequence",s,"at1")};\n  var end = ${I("sequence",o,"at2")} + 1;\n  return sequence.slice(start, end);\n}\n`)+"("+a+("FROM_END"===s||"FROM_START"===s?", "+r:"")+("FROM_END"===o||"FROM_START"===o?", "+e:"")+")";return[a,t.FUNCTION_CALL]},text_indexOf:function(e,i){const n="FIRST"===e.getFieldValue("END")?"indexOf":"lastIndexOf",s=i.valueToCode(e,"FIND",t.NONE)||"''";return i=(i.valueToCode(e,"VALUE",t.MEMBER)||"''")+"."+n+"("+s+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.ADDITION]:[i,t.FUNCTION_CALL]},text_isEmpty:function(e,i){return["!"+(i.valueToCode(e,"VALUE",t.MEMBER)||"''")+".length",t.LOGICAL_NOT]},text_join:function(e,i){switch(e.itemCount_){case 0:return["''",t.ATOMIC];case 1:return e=i.valueToCode(e,"ADD0",t.NONE)||"''",b(e);case 2:var n=i.valueToCode(e,"ADD0",t.NONE)||"''";return e=i.valueToCode(e,"ADD1",t.NONE)||"''",[b(n)[0]+" + "+b(e)[0],t.ADDITION];default:n=Array(e.itemCount_);for(let s=0;s<e.itemCount_;s++)n[s]=i.valueToCode(e,"ADD"+s,t.NONE)||"''";return["["+n.join(",")+"].join('')",t.FUNCTION_CALL]}},text_length:function(e,i){return[(i.valueToCode(e,"VALUE",t.MEMBER)||"''")+".length",t.MEMBER]},text_print:function(e,i){return"window.alert("+(i.valueToCode(e,"TEXT",t.NONE)||"''")+");\n"}};y.text_prompt=l,y.text_prompt_ext=l,y.text_replace=function(e,i){const n=i.valueToCode(e,"TEXT",t.NONE)||"''",s=i.valueToCode(e,"FROM",t.NONE)||"''";return e=i.valueToCode(e,"TO",t.NONE)||"''",[i.provideFunction_("textReplace",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement) {\n  needle = needle.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g, '\\\\$1')\n                 .replace(/\\x08/g, '\\\\x08');\n  return haystack.replace(new RegExp(needle, 'g'), replacement);\n}\n`)+"("+n+", "+s+", "+e+")",t.FUNCTION_CALL]},y.text_reverse=function(e,i){return[(i.valueToCode(e,"TEXT",t.MEMBER)||"''")+".split('').reverse().join('')",t.FUNCTION_CALL]},y.text_trim=function(e,i){const n={LEFT:".replace(/^[\\s\\xa0]+/, '')",RIGHT:".replace(/[\\s\\xa0]+$/, '')",BOTH:".trim()"}[e.getFieldValue("MODE")];return[(i.valueToCode(e,"TEXT",t.MEMBER)||"''")+n,t.FUNCTION_CALL]};var v={};v.variables_get=c,v.variables_set=u;var C={};C.variables_get_dynamic=c,C.variables_set_dynamic=u;var k=new h,O=Object.assign({},g,m,f,_,T,y,v,C);for(const e in O)k.forBlock[e]=O[e];var N={};return N.JavascriptGenerator=h,N.Order=t,N.javascriptGenerator=k,N.__namespace__=n,N},"function"==typeof define&&define.amd?define(["./blockly_compressed.js"],s):"object"==typeof i?t.exports=s(e("./blockly_compressed.js")):(n.javascript=s(n.Blockly),n.Blockly.JavaScript=n.javascript.javascriptGenerator)},{"./blockly_compressed.js":201}],210:[function(e,t,i){t.exports=e("./lua_compressed.js")},{"./lua_compressed.js":211}],211:[function(e,t,i){var n,s;n=this,s=function(e){var t,i,n=e.__namespace__,s=function(e,i){var n=0;let s="";i.STATEMENT_PREFIX&&(s+=i.injectId(i.STATEMENT_PREFIX,e));do{const o=i.valueToCode(e,"IF"+n,t.NONE)||"false";let r=i.statementToCode(e,"DO"+n);i.STATEMENT_SUFFIX&&(r=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+r),s+=(0<n?"else":"")+"if "+o+" then\n"+r,n++}while(e.getInput("IF"+n));return(e.getInput("ELSE")||i.STATEMENT_SUFFIX)&&(n=i.statementToCode(e,"ELSE"),i.STATEMENT_SUFFIX&&(n=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+n),s+="else\n"+n),s+"end\n"},o=function(e,t){return e.includes(_)?e+t+"::continue::\n":e},r=function(e,i){let s;s=e.getField("TIMES")?String(Number(e.getFieldValue("TIMES"))):i.valueToCode(e,"TIMES",t.NONE)||"0",s=n.isNumber$$module$build$src$core$utils$string(s)?parseInt(s,10):"math.floor("+s+")";let r=i.statementToCode(e,"DO");return r=i.addLoopTrap(r,e),r=o(r,i.INDENT),"for "+i.nameDB_.getDistinctName("count",n.NameType$$module$build$src$core$names.VARIABLE)+" = 1, "+s+" do\n"+r+"end\n"},a=function(e,i){var n=e.getFieldValue("OP");if("NEG"===n)return["-"+(e=i.valueToCode(e,"NUM",t.UNARY)||"0"),t.UNARY];if("POW10"===n)return["10 ^ "+(e=i.valueToCode(e,"NUM",t.EXPONENTIATION)||"0"),t.EXPONENTIATION];switch(e="ROUND"===n?i.valueToCode(e,"NUM",t.ADDITIVE)||"0":i.valueToCode(e,"NUM",t.NONE)||"0",n){case"ABS":n="math.abs("+e+")";break;case"ROOT":n="math.sqrt("+e+")";break;case"LN":n="math.log("+e+")";break;case"LOG10":n="math.log("+e+", 10)";break;case"EXP":n="math.exp("+e+")";break;case"ROUND":n="math.floor("+e+" + .5)";break;case"ROUNDUP":n="math.ceil("+e+")";break;case"ROUNDDOWN":n="math.floor("+e+")";break;case"SIN":n="math.sin(math.rad("+e+"))";break;case"COS":n="math.cos(math.rad("+e+"))";break;case"TAN":n="math.tan(math.rad("+e+"))";break;case"ASIN":n="math.deg(math.asin("+e+"))";break;case"ACOS":n="math.deg(math.acos("+e+"))";break;case"ATAN":n="math.deg(math.atan("+e+"))";break;default:throw Error("Unknown math operator: "+n)}return[n,t.HIGH]},l=function(e,i){const n=i.getProcedureName(e.getFieldValue("NAME"));var s="";i.STATEMENT_PREFIX&&(s+=i.injectId(i.STATEMENT_PREFIX,e)),i.STATEMENT_SUFFIX&&(s+=i.injectId(i.STATEMENT_SUFFIX,e)),s&&(s=i.prefixLines(s,i.INDENT));let o="";i.INFINITE_LOOP_TRAP&&(o=i.prefixLines(i.injectId(i.INFINITE_LOOP_TRAP,e),i.INDENT));let r="";e.getInput("STACK")&&(r=i.statementToCode(e,"STACK"));let a="";e.getInput("RETURN")&&(a=i.valueToCode(e,"RETURN",t.NONE)||"");let l="";r&&a&&(l=s),a?a=i.INDENT+"return "+a+"\n":r||(r="");const c=[],u=e.getVars();for(let e=0;e<u.length;e++)c[e]=i.getVariableName(u[e]);return s="function "+n+"("+c.join(", ")+")\n"+s+o+r+l+a+"end\n",s=i.scrub_(e,s),i.definitions_["%"+n]=s,null},c=function(e,i){let n;return n=e.getField("TEXT")?i.quote_(e.getFieldValue("TEXT")):i.valueToCode(e,"TEXT",t.NONE)||"''",i=i.provideFunction_("text_prompt",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(msg)\n  io.write(msg)\n  io.flush()\n  return io.read()\nend\n`)+"("+n+")","NUMBER"===e.getFieldValue("TYPE")&&(i="tonumber("+i+", 10)"),[i,t.HIGH]},u=function(e,i){return[i.getVariableName(e.getFieldValue("VAR")),t.ATOMIC]},h=function(e,i){const n=i.valueToCode(e,"VALUE",t.NONE)||"0";return i.getVariableName(e.getFieldValue("VAR"))+" = "+n+"\n"};(i=t||(t={}))[i.ATOMIC=0]="ATOMIC",i[i.HIGH=1]="HIGH",i[i.EXPONENTIATION=2]="EXPONENTIATION",i[i.UNARY=3]="UNARY",i[i.MULTIPLICATIVE=4]="MULTIPLICATIVE",i[i.ADDITIVE=5]="ADDITIVE",i[i.CONCATENATION=6]="CONCATENATION",i[i.RELATIONAL=7]="RELATIONAL",i[i.AND=8]="AND",i[i.OR=9]="OR",i[i.NONE=99]="NONE";var d=class extends n.CodeGenerator$$module$build$src$core$generator{constructor(e="Lua"){super(e),this.isInitialized=!1;for(const i in t)"string"!=typeof(e=t[i])&&(this["ORDER_"+i]=e);this.addReservedWords("_,__inext,assert,bit,colors,colours,coroutine,disk,dofile,error,fs,fetfenv,getmetatable,gps,help,io,ipairs,keys,loadfile,loadstring,math,native,next,os,paintutils,pairs,parallel,pcall,peripheral,print,printError,rawequal,rawget,rawset,read,rednet,redstone,rs,select,setfenv,setmetatable,sleep,string,table,term,textutils,tonumber,tostring,turtle,type,unpack,vector,write,xpcall,_VERSION,__indext,HTTP,and,break,do,else,elseif,end,false,for,function,if,in,local,nil,not,or,repeat,return,then,true,until,while,add,sub,mul,div,mod,pow,unm,concat,len,eq,lt,le,index,newindex,call,assert,collectgarbage,dofile,error,_G,getmetatable,inpairs,load,loadfile,next,pairs,pcall,print,rawequal,rawget,rawlen,rawset,select,setmetatable,tonumber,tostring,type,_VERSION,xpcall,require,package,string,table,math,bit32,io,file,os,debug")}init(e){super.init(e),this.nameDB_?this.nameDB_.reset():this.nameDB_=new n.Names$$module$build$src$core$names(this.RESERVED_WORDS_),this.nameDB_.setVariableMap(e.getVariableMap()),this.nameDB_.populateVariables(e),this.nameDB_.populateProcedures(e),this.isInitialized=!0}finish(e){const t=Object.values(this.definitions_);return e=super.finish(e),this.isInitialized=!1,this.nameDB_.reset(),t.join("\n\n")+"\n\n\n"+e}scrubNakedValue(e){return"local _ = "+e+"\n"}quote_(e){return"'"+(e=e.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"))+"'"}multiline_quote_(e){return e.split(/\n/g).map(this.quote_).join(" .. '\\n' ..\n")}scrub_(e,t,i=!1){let s="";if(!e.outputConnection||!e.outputConnection.targetConnection){var o=e.getCommentText();o&&(o=n.wrap$$module$build$src$core$utils$string(o,this.COMMENT_WRAP-3),s+=this.prefixLines(o,"-- ")+"\n");for(let t=0;t<e.inputList.length;t++)e.inputList[t].type===n.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&(o=e.inputList[t].connection.targetBlock())&&(o=this.allNestedComments(o))&&(s+=this.prefixLines(o,"-- "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),s+t+(i?"":this.blockToCode(e))}},p={};p.LuaGenerator=d,p.Order=t;var g=function(e,t,i){return"FIRST"===t?"1":"FROM_END"===t?"#"+e+" + 1 - "+i:"LAST"===t?"#"+e:"RANDOM"===t?"math.random(#"+e+")":i},m={lists_create_empty:function(e,i){return["{}",t.HIGH]},lists_create_with:function(e,i){const n=Array(e.itemCount_);for(let s=0;s<e.itemCount_;s++)n[s]=i.valueToCode(e,"ADD"+s,t.NONE)||"nil";return["{"+n.join(", ")+"}",t.HIGH]},lists_getIndex:function(e,i){var s=e.getFieldValue("MODE")||"GET",o=e.getFieldValue("WHERE")||"FROM_START";const r=i.valueToCode(e,"VALUE",t.HIGH)||"({})";return"LAST"!==o&&"FROM_END"!==o&&"RANDOM"!==o||r.match(/^\w+$/)?(i=i.valueToCode(e,"AT","GET"===s&&"FROM_END"===o?t.ADDITIVE:t.NONE)||"1",i=g(r,o,i),"GET"===s?[r+"["+i+"]",t.HIGH]:(o="table.remove("+r+", "+i+")","GET_REMOVE"===s?[o,t.HIGH]:o+"\n")):"REMOVE"===s?(s=i.valueToCode(e,"AT","FROM_END"===o?t.ADDITIVE:t.NONE)||"1",(i=i.nameDB_.getDistinctName("tmp_list",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+r+"\ntable.remove("+i+", "+(s=g(i,o,s))+")\n"):(e=i.valueToCode(e,"AT",t.NONE)||"1",[("GET"===s?i.provideFunction_("list_get_"+o.toLowerCase(),["function "+i.FUNCTION_NAME_PLACEHOLDER_+"(t"+("FROM_END"===o||"FROM_START"===o?", at)":")"),"  return t["+g("t",o,"at")+"]","end"]):i.provideFunction_("list_remove_"+o.toLowerCase(),["function "+i.FUNCTION_NAME_PLACEHOLDER_+"(t"+("FROM_END"===o||"FROM_START"===o?", at)":")"),"  return table.remove(t, "+g("t",o,"at")+")","end"]))+"("+r+("FROM_END"===o||"FROM_START"===o?", "+e:"")+")",t.HIGH])},lists_getSublist:function(e,i){const n=i.valueToCode(e,"LIST",t.NONE)||"{}",s=e.getFieldValue("WHERE1"),o=e.getFieldValue("WHERE2"),r=i.valueToCode(e,"AT1",t.NONE)||"1";e=i.valueToCode(e,"AT2",t.NONE)||"1";const a="FROM_END"===s||"FROM_START"===s?", at1":"",l="FROM_END"===o||"FROM_START"===o?", at2":"";return[i.provideFunction_("list_sublist_"+s.toLowerCase()+"_"+o.toLowerCase(),`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(source${a}${l})\n  local t = {}\n  local start = ${g("source",s,"at1")}\n  local finish = ${g("source",o,"at2")}\n  for i = start, finish do\n    table.insert(t, source[i])\n  end\n  return t\nend\n`)+"("+n+("FROM_END"===s||"FROM_START"===s?", "+r:"")+("FROM_END"===o||"FROM_START"===o?", "+e:"")+")",t.HIGH]},lists_indexOf:function(e,i){const n=i.valueToCode(e,"FIND",t.NONE)||"''",s=i.valueToCode(e,"VALUE",t.NONE)||"{}";return[("FIRST"===e.getFieldValue("END")?i.provideFunction_("first_index",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(t, elem)\n  for k, v in ipairs(t) do\n    if v == elem then\n      return k\n    end\n  end\n  return 0\nend\n`):i.provideFunction_("last_index",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(t, elem)\n  for i = #t, 1, -1 do\n    if t[i] == elem then\n      return i\n    end\n  end\n  return 0\nend\n`))+"("+s+", "+n+")",t.HIGH]},lists_isEmpty:function(e,i){return["#"+(i.valueToCode(e,"VALUE",t.UNARY)||"{}")+" == 0",t.RELATIONAL]},lists_length:function(e,i){return["#"+(i.valueToCode(e,"VALUE",t.UNARY)||"{}"),t.UNARY]},lists_repeat:function(e,i){return[i.provideFunction_("create_list_repeated",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(item, count)\n  local t = {}\n  for i = 1, count do\n    table.insert(t, item)\n  end\n  return t\nend\n  `)+"("+(i.valueToCode(e,"ITEM",t.NONE)||"nil")+", "+(e=i.valueToCode(e,"NUM",t.NONE)||"0")+")",t.HIGH]},lists_reverse:function(e,i){return e=i.valueToCode(e,"LIST",t.NONE)||"{}",[i.provideFunction_("list_reverse",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(input)\n  local reversed = {}\n  for i = #input, 1, -1 do\n    table.insert(reversed, input[i])\n  end\n  return reversed\nend\n`)+"("+e+")",t.HIGH]},lists_setIndex:function(e,i){let s=i.valueToCode(e,"LIST",t.HIGH)||"{}";const o=e.getFieldValue("MODE")||"SET",r=e.getFieldValue("WHERE")||"FROM_START",a=i.valueToCode(e,"AT",t.ADDITIVE)||"1";e=i.valueToCode(e,"TO",t.NONE)||"Nil";let l="";return"LAST"!==r&&"FROM_END"!==r&&"RANDOM"!==r||s.match(/^\w+$/)||(l=(i=i.nameDB_.getDistinctName("tmp_list",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+s+"\n",s=i),(l="SET"===o?l+(s+"[")+g(s,r,a)+"] = "+e:l+"table.insert("+s+", "+g(s,r,a)+("LAST"===r?" + 1":"")+", "+e+")")+"\n"},lists_sort:function(e,i){const n=i.valueToCode(e,"LIST",t.NONE)||"{}",s="1"===e.getFieldValue("DIRECTION")?1:-1;return e=e.getFieldValue("TYPE"),[i.provideFunction_("list_sort",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(list, typev, direction)\n  local t = {}\n  for n,v in pairs(list) do table.insert(t, v) end\n  local compareFuncs = {\n    NUMERIC = function(a, b)\n      return (tonumber(tostring(a)) or 0)\n          < (tonumber(tostring(b)) or 0) end,\n    TEXT = function(a, b)\n      return tostring(a) < tostring(b) end,\n    IGNORE_CASE = function(a, b)\n      return string.lower(tostring(a)) < string.lower(tostring(b)) end\n  }\n  local compareTemp = compareFuncs[typev]\n  local compare = compareTemp\n  if direction == -1\n  then compare = function(a, b) return compareTemp(b, a) end\n  end\n  table.sort(t, compare)\n  return t\nend\n`)+"("+n+',"'+e+'", '+s+")",t.HIGH]},lists_split:function(e,i){let n=i.valueToCode(e,"INPUT",t.NONE);const s=i.valueToCode(e,"DELIM",t.NONE)||"''";if("SPLIT"===(e=e.getFieldValue("MODE")))n||(n="''"),i=i.provideFunction_("list_string_split",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(input, delim)\n  local t = {}\n  local pos = 1\n  while true do\n    next_delim = string.find(input, delim, pos)\n    if next_delim == nil then\n      table.insert(t, string.sub(input, pos))\n      break\n    else\n      table.insert(t, string.sub(input, pos, next_delim-1))\n      pos = next_delim + #delim\n    end\n  end\n  return t\nend\n`);else{if("JOIN"!==e)throw Error("Unknown mode: "+e);n||(n="{}"),i="table.concat"}return[i+"("+n+", "+s+")",t.HIGH]}},f={};f.controls_if=s,f.controls_ifelse=s,f.logic_boolean=function(e,i){return["TRUE"===e.getFieldValue("BOOL")?"true":"false",t.ATOMIC]},f.logic_compare=function(e,i){const n={EQ:"==",NEQ:"~=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")];return[(i.valueToCode(e,"A",t.RELATIONAL)||"0")+" "+n+" "+(e=i.valueToCode(e,"B",t.RELATIONAL)||"0"),t.RELATIONAL]},f.logic_negate=function(e,i){return["not "+(i.valueToCode(e,"BOOL",t.UNARY)||"true"),t.UNARY]},f.logic_null=function(e,i){return["nil",t.ATOMIC]},f.logic_operation=function(e,i){const n="AND"===e.getFieldValue("OP")?"and":"or",s="and"===n?t.AND:t.OR;let o=i.valueToCode(e,"A",s);return e=i.valueToCode(e,"B",s),o||e?(i="and"===n?"true":"false",o||(o=i),e||(e=i)):e=o="false",[o+" "+n+" "+e,s]},f.logic_ternary=function(e,i){return[(i.valueToCode(e,"IF",t.AND)||"false")+" and "+(i.valueToCode(e,"THEN",t.AND)||"nil")+" or "+(e=i.valueToCode(e,"ELSE",t.OR)||"nil"),t.OR]};var _="goto continue\n",T={controls_flow_statements:function(e,t){let i="";if(t.STATEMENT_PREFIX&&(i+=t.injectId(t.STATEMENT_PREFIX,e)),t.STATEMENT_SUFFIX&&(i+=t.injectId(t.STATEMENT_SUFFIX,e)),t.STATEMENT_PREFIX){const n=e.getSurroundLoop();n&&!n.suppressPrefixSuffix&&(i+=t.injectId(t.STATEMENT_PREFIX,n))}switch(e.getFieldValue("FLOW")){case"BREAK":return i+"break\n";case"CONTINUE":return i+_}throw Error("Unknown flow statement.")},controls_for:function(e,i){const s=i.getVariableName(e.getFieldValue("VAR")),r=i.valueToCode(e,"FROM",t.NONE)||"0",a=i.valueToCode(e,"TO",t.NONE)||"0",l=i.valueToCode(e,"BY",t.NONE)||"1";let c,u=i.statementToCode(e,"DO");return u=i.addLoopTrap(u,e),u=o(u,i.INDENT),e="",n.isNumber$$module$build$src$core$utils$string(r)&&n.isNumber$$module$build$src$core$utils$string(a)&&n.isNumber$$module$build$src$core$utils$string(l)?c=(Number(r)<=Number(a)?"":"-")+Math.abs(Number(l)):(e="",e+=(c=i.nameDB_.getDistinctName(s+"_inc",n.NameType$$module$build$src$core$names.VARIABLE))+" = ",e=(e=n.isNumber$$module$build$src$core$utils$string(l)?e+(Math.abs(l)+"\n"):e+"math.abs("+l+")\n")+"if ("+r+") > ("+a+") then\n"+(i.INDENT+c)+" = -"+c+"\n",e+="end\n"),e+"for "+s+" = "+r+", "+a+", "+c+" do\n"+u+"end\n"},controls_forEach:function(e,i){const n=i.getVariableName(e.getFieldValue("VAR")),s=i.valueToCode(e,"LIST",t.NONE)||"{}";let r=i.statementToCode(e,"DO");return r=i.addLoopTrap(r,e),"for _, "+n+" in ipairs("+s+") do \n"+(r=o(r,i.INDENT))+"end\n"}};T.controls_repeat=r,T.controls_repeat_ext=r,T.controls_whileUntil=function(e,i){const n="UNTIL"===e.getFieldValue("MODE");let s=i.valueToCode(e,"BOOL",n?t.UNARY:t.NONE)||"false",r=i.statementToCode(e,"DO");return r=i.addLoopTrap(r,e),n&&(s="not "+s),"while "+s+" do\n"+(r=o(r,i.INDENT))+"end\n"};var E={math_arithmetic:function(e,i){var n={ADD:[" + ",t.ADDITIVE],MINUS:[" - ",t.ADDITIVE],MULTIPLY:[" * ",t.MULTIPLICATIVE],DIVIDE:[" / ",t.MULTIPLICATIVE],POWER:[" ^ ",t.EXPONENTIATION]}[e.getFieldValue("OP")];const s=n[0];return n=n[1],[(i.valueToCode(e,"A",n)||"0")+s+(e=i.valueToCode(e,"B",n)||"0"),n]},math_atan2:function(e,i){const n=i.valueToCode(e,"X",t.NONE)||"0";return["math.deg(math.atan2("+(i.valueToCode(e,"Y",t.NONE)||"0")+", "+n+"))",t.HIGH]},math_change:function(e,i){const n=i.valueToCode(e,"DELTA",t.ADDITIVE)||"0";return(e=i.getVariableName(e.getFieldValue("VAR")))+" = "+e+" + "+n+"\n"},math_constant:function(e,i){return{PI:["math.pi",t.HIGH],E:["math.exp(1)",t.HIGH],GOLDEN_RATIO:["(1 + math.sqrt(5)) / 2",t.MULTIPLICATIVE],SQRT2:["math.sqrt(2)",t.HIGH],SQRT1_2:["math.sqrt(1 / 2)",t.HIGH],INFINITY:["math.huge",t.HIGH]}[e.getFieldValue("CONSTANT")]},math_constrain:function(e,i){return["math.min(math.max("+(i.valueToCode(e,"VALUE",t.NONE)||"0")+", "+(i.valueToCode(e,"LOW",t.NONE)||"-math.huge")+"), "+(e=i.valueToCode(e,"HIGH",t.NONE)||"math.huge")+")",t.HIGH]},math_modulo:function(e,i){return[(i.valueToCode(e,"DIVIDEND",t.MULTIPLICATIVE)||"0")+" % "+(e=i.valueToCode(e,"DIVISOR",t.MULTIPLICATIVE)||"0"),t.MULTIPLICATIVE]},math_number:function(e,i){return e=Number(e.getFieldValue("NUM")),[String(e),0>e?t.UNARY:t.ATOMIC]},math_number_property:function(e,i){var n={EVEN:[" % 2 == 0",t.MULTIPLICATIVE,t.RELATIONAL],ODD:[" % 2 == 1",t.MULTIPLICATIVE,t.RELATIONAL],WHOLE:[" % 1 == 0",t.MULTIPLICATIVE,t.RELATIONAL],POSITIVE:[" > 0",t.RELATIONAL,t.RELATIONAL],NEGATIVE:[" < 0",t.RELATIONAL,t.RELATIONAL],DIVISIBLE_BY:[null,t.MULTIPLICATIVE,t.RELATIONAL],PRIME:[null,t.NONE,t.HIGH]};const s=e.getFieldValue("PROPERTY"),[o,r,a]=n[s];if(n=i.valueToCode(e,"NUMBER_TO_CHECK",r)||"0","PRIME"===s)e=i.provideFunction_("math_isPrime",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(n)\n  -- https://en.wikipedia.org/wiki/Primality_test#Naive_methods\n  if n == 2 or n == 3 then\n    return true\n  end\n  -- False if n is NaN, negative, is 1, or not whole.\n  -- And false if n is divisible by 2 or 3.\n  if not(n > 1) or n % 1 ~= 0 or n % 2 == 0 or n % 3 == 0 then\n    return false\n  end\n  -- Check all the numbers of form 6k +/- 1, up to sqrt(n).\n  for x = 6, math.sqrt(n) + 1.5, 6 do\n    if n % (x - 1) == 0 or n % (x + 1) == 0 then\n      return false\n    end\n  end\n  return true\nend\n`)+"("+n+")";else if("DIVISIBLE_BY"===s){if("0"===(e=i.valueToCode(e,"DIVISOR",t.MULTIPLICATIVE)||"0"))return["nil",t.ATOMIC];e=n+" % "+e+" == 0"}else e=n+o;return[e,a]},math_on_list:function(e,i){function n(){return i.provideFunction_("math_sum",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(t)\n  local result = 0\n  for _, v in ipairs(t) do\n    result = result + v\n  end\n  return result\nend\n`)}var s=e.getFieldValue("OP");switch(e=i.valueToCode(e,"LIST",t.NONE)||"{}",s){case"SUM":s=n();break;case"MIN":s=i.provideFunction_("math_min",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(t)\n  if #t == 0 then\n    return 0\n  end\n  local result = math.huge\n  for _, v in ipairs(t) do\n    if v < result then\n      result = v\n    end\n  end\n  return result\nend\n`);break;case"AVERAGE":s=i.provideFunction_("math_average",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(t)\n  if #t == 0 then\n    return 0\n  end\n  return ${n()}(t) / #t\nend\n`);break;case"MAX":s=i.provideFunction_("math_max",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(t)\n  if #t == 0 then\n    return 0\n  end\n  local result = -math.huge\n  for _, v in ipairs(t) do\n    if v > result then\n      result = v\n    end\n  end\n  return result\nend\n`);break;case"MEDIAN":s=i.provideFunction_("math_median",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(t)\n  -- Source: http://lua-users.org/wiki/SimpleStats\n  if #t == 0 then\n    return 0\n  end\n  local temp = {}\n  for _, v in ipairs(t) do\n    if type(v) == 'number' then\n      table.insert(temp, v)\n    end\n  end\n  table.sort(temp)\n  if #temp % 2 == 0 then\n    return (temp[#temp / 2] + temp[(#temp / 2) + 1]) / 2\n  else\n    return temp[math.ceil(#temp / 2)]\n  end\nend\n`);break;case"MODE":s=i.provideFunction_("math_modes",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(t)\n  -- Source: http://lua-users.org/wiki/SimpleStats\n  local counts = {}\n  for _, v in ipairs(t) do\n    if counts[v] == nil then\n      counts[v] = 1\n    else\n      counts[v] = counts[v] + 1\n    end\n  end\n  local biggestCount = 0\n  for _, v  in pairs(counts) do\n    if v > biggestCount then\n      biggestCount = v\n    end\n  end\n  local temp = {}\n  for k, v in pairs(counts) do\n    if v == biggestCount then\n      table.insert(temp, k)\n    end\n  end\n  return temp\nend\n`);break;case"STD_DEV":s=i.provideFunction_("math_standard_deviation",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(t)\n  local m\n  local vm\n  local total = 0\n  local count = 0\n  local result\n  m = #t == 0 and 0 or ${n()}(t) / #t\n  for _, v in ipairs(t) do\n    if type(v) == 'number' then\n      vm = v - m\n      total = total + (vm * vm)\n      count = count + 1\n    end\n  end\n  result = math.sqrt(total / (count-1))\n  return result\nend\n`);break;case"RANDOM":s=i.provideFunction_("math_random_list",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(t)\n  if #t == 0 then\n    return nil\n  end\n  return t[math.random(#t)]\nend\n`);break;default:throw Error("Unknown operator: "+s)}return[s+"("+e+")",t.HIGH]},math_random_float:function(e,i){return["math.random()",t.HIGH]},math_random_int:function(e,i){return["math.random("+(i.valueToCode(e,"FROM",t.NONE)||"0")+", "+(e=i.valueToCode(e,"TO",t.NONE)||"0")+")",t.HIGH]}};E.math_round=a,E.math_single=a,E.math_trig=a;var b={procedures_callnoreturn:function(e,t){return t.forBlock.procedures_callreturn(e,t)[0]+"\n"},procedures_callreturn:function(e,i){const n=i.getProcedureName(e.getFieldValue("NAME")),s=[],o=e.getVars();for(let n=0;n<o.length;n++)s[n]=i.valueToCode(e,"ARG"+n,t.NONE)||"nil";return[n+"("+s.join(", ")+")",t.HIGH]}};b.procedures_defnoreturn=l,b.procedures_defreturn=l,b.procedures_ifreturn=function(e,i){let n="if "+(i.valueToCode(e,"CONDITION",t.NONE)||"false")+" then\n";return i.STATEMENT_SUFFIX&&(n+=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)),e.hasReturnValue_?(e=i.valueToCode(e,"VALUE",t.NONE)||"nil",n+=i.INDENT+"return "+e+"\n"):n+=i.INDENT+"return\n",n+"end\n"};var I={text:function(e,i){return[i.quote_(e.getFieldValue("TEXT")),t.ATOMIC]},text_append:function(e,i){const n=i.getVariableName(e.getFieldValue("VAR"));return n+" = "+n+" .. "+(e=i.valueToCode(e,"TEXT",t.CONCATENATION)||"''")+"\n"},text_changeCase:function(e,i){const n=e.getFieldValue("CASE");let s;return e=i.valueToCode(e,"TEXT",t.NONE)||"''","UPPERCASE"===n?s="string.upper":"LOWERCASE"===n?s="string.lower":"TITLECASE"===n&&(s=i.provideFunction_("text_titlecase",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(str)\n  local buf = {}\n  local inWord = false\n  for i = 1, #str do\n    local c = string.sub(str, i, i)\n    if inWord then\n      table.insert(buf, string.lower(c))\n      if string.find(c, "%s") then\n        inWord = false\n      end\n    else\n      table.insert(buf, string.upper(c))\n      inWord = true\n    end\n  end\n  return table.concat(buf)\nend\n`)),[s+"("+e+")",t.HIGH]},text_charAt:function(e,i){var n=e.getFieldValue("WHERE")||"FROM_START";const s=i.valueToCode(e,"VALUE",t.NONE)||"''";if("RANDOM"===n)i=i.provideFunction_("text_random_letter",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(str)\n  local index = math.random(string.len(str))\n  return string.sub(str, index, index)\nend\n`)+"("+s+")";else{if("FIRST"===n)n="1";else if("LAST"===n)n="-1";else if(e=i.valueToCode(e,"AT","FROM_END"===n?t.UNARY:t.NONE)||"1","FROM_START"===n)n=e;else{if("FROM_END"!==n)throw Error("Unhandled option (text_charAt).");n="-"+e}i=n.match(/^-?\w*$/)?"string.sub("+s+", "+n+", "+n+")":i.provideFunction_("text_char_at",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(str, index)\n  return string.sub(str, index, index)\nend\n`)+"("+s+", "+n+")"}return[i,t.HIGH]},text_count:function(e,i){const n=i.valueToCode(e,"TEXT",t.NONE)||"''";return e=i.valueToCode(e,"SUB",t.NONE)||"''",[i.provideFunction_("text_count",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle)\n  if #needle == 0 then\n    return #haystack + 1\n  end\n  local i = 1\n  local count = 0\n  while true do\n    i = string.find(haystack, needle, i, true)\n    if i == nil then\n      break\n    end\n    count = count + 1\n    i = i + #needle\n  end\n  return count\nend\n`)+"("+n+", "+e+")",t.HIGH]},text_getSubstring:function(e,i){const n=i.valueToCode(e,"STRING",t.NONE)||"''";var s=e.getFieldValue("WHERE1"),o=i.valueToCode(e,"AT1","FROM_END"===s?t.UNARY:t.NONE)||"1";if("FIRST"===s)s=1;else if("FROM_START"===s)s=o;else{if("FROM_END"!==s)throw Error("Unhandled option (text_getSubstring)");s="-"+o}if(o=e.getFieldValue("WHERE2"),e=i.valueToCode(e,"AT2","FROM_END"===o?t.UNARY:t.NONE)||"1","LAST"===o)e=-1;else if("FROM_START"!==o){if("FROM_END"!==o)throw Error("Unhandled option (text_getSubstring)");e="-"+e}return["string.sub("+n+", "+s+", "+e+")",t.HIGH]},text_indexOf:function(e,i){const n=i.valueToCode(e,"FIND",t.NONE)||"''",s=i.valueToCode(e,"VALUE",t.NONE)||"''";return[("FIRST"===e.getFieldValue("END")?i.provideFunction_("firstIndexOf",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(str, substr)\n  local i = string.find(str, substr, 1, true)\n  if i == nil then\n    return 0\n  end\n  return i\nend\n`):i.provideFunction_("lastIndexOf",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(str, substr)\n  local i = string.find(string.reverse(str), string.reverse(substr), 1, true)\n  if i then\n    return #str + 2 - i - #substr\n  end\n  return 0\nend\n`))+"("+s+", "+n+")",t.HIGH]},text_isEmpty:function(e,i){return["#"+(i.valueToCode(e,"VALUE",t.UNARY)||"''")+" == 0",t.RELATIONAL]},text_join:function(e,i){if(0===e.itemCount_)return["''",t.ATOMIC];if(1===e.itemCount_)return["tostring("+(i.valueToCode(e,"ADD0",t.NONE)||"''")+")",t.HIGH];if(2===e.itemCount_){var n=i.valueToCode(e,"ADD0",t.CONCATENATION)||"''";return[n+" .. "+(e=i.valueToCode(e,"ADD1",t.CONCATENATION)||"''"),t.CONCATENATION]}n=[];for(let s=0;s<e.itemCount_;s++)n[s]=i.valueToCode(e,"ADD"+s,t.NONE)||"''";return["table.concat({"+n.join(", ")+"})",t.HIGH]},text_length:function(e,i){return["#"+(i.valueToCode(e,"VALUE",t.UNARY)||"''"),t.UNARY]},text_print:function(e,i){return"print("+(i.valueToCode(e,"TEXT",t.NONE)||"''")+")\n"}};I.text_prompt=c,I.text_prompt_ext=c,I.text_replace=function(e,i){const n=i.valueToCode(e,"TEXT",t.NONE)||"''",s=i.valueToCode(e,"FROM",t.NONE)||"''";return e=i.valueToCode(e,"TO",t.NONE)||"''",[i.provideFunction_("text_replace",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement)\n  local buf = {}\n  local i = 1\n  while i <= #haystack do\n    if string.sub(haystack, i, i + #needle - 1) == needle then\n      for j = 1, #replacement do\n        table.insert(buf, string.sub(replacement, j, j))\n      end\n      i = i + #needle\n    else\n      table.insert(buf, string.sub(haystack, i, i))\n      i = i + 1\n    end\n  end\n  return table.concat(buf)\nend\n`)+"("+n+", "+s+", "+e+")",t.HIGH]},I.text_reverse=function(e,i){return["string.reverse("+(i.valueToCode(e,"TEXT",t.NONE)||"''")+")",t.HIGH]},I.text_trim=function(e,i){const n={LEFT:"^%s*(,-)",RIGHT:"(.-)%s*$",BOTH:"^%s*(.-)%s*$"}[e.getFieldValue("MODE")];return["string.gsub("+(i.valueToCode(e,"TEXT",t.NONE)||"''")+', "'+n+'", "%1")',t.HIGH]};var y={};y.variables_get=u,y.variables_set=h;var v={};v.variables_get_dynamic=u,v.variables_set_dynamic=h;var C=new d,k=Object.assign({},m,f,T,E,b,I,y,v);for(const e in k)C.forBlock[e]=k[e];var O={};return O.LuaGenerator=d,O.Order=t,O.luaGenerator=C,O.__namespace__=n,O},"function"==typeof define&&define.amd?define(["./blockly_compressed.js"],s):"object"==typeof i?t.exports=s(e("./blockly_compressed.js")):(n.lua=s(n.Blockly),n.Blockly.Lua=n.lua.luaGenerator)},{"./blockly_compressed.js":201}],212:[function(e,t,i){!function(e,n){if("function"==typeof define&&define.amd)define([],n);else if("object"==typeof i)t.exports=n();else{var s=n();for(var o in s)e.Blockly.Msg[o]=s[o]}}(this,(function(){"use strict";var e=e||{Msg:Object.create(null)};return e.Msg.ADD_COMMENT="Add Comment",e.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE="Can't delete the variable '%1' because it's part of the definition of the function '%2'",e.Msg.CHANGE_VALUE_TITLE="Change value:",e.Msg.CLEAN_UP="Clean up Blocks",e.Msg.COLLAPSED_WARNINGS_WARNING="Collapsed blocks contain warnings.",e.Msg.COLLAPSE_ALL="Collapse Blocks",e.Msg.COLLAPSE_BLOCK="Collapse Block",e.Msg.COLOUR_BLEND_COLOUR1="colour 1",e.Msg.COLOUR_BLEND_COLOUR2="colour 2",e.Msg.COLOUR_BLEND_HELPURL="https://meyerweb.com/eric/tools/color-blend/#:::rgbp",e.Msg.COLOUR_BLEND_RATIO="ratio",e.Msg.COLOUR_BLEND_TITLE="blend",e.Msg.COLOUR_BLEND_TOOLTIP="Blends two colours together with a given ratio (0.0 - 1.0).",e.Msg.COLOUR_PICKER_HELPURL="https://en.wikipedia.org/wiki/Color",e.Msg.COLOUR_PICKER_TOOLTIP="Choose a colour from the palette.",e.Msg.COLOUR_RANDOM_HELPURL="http://randomcolour.com",e.Msg.COLOUR_RANDOM_TITLE="random colour",e.Msg.COLOUR_RANDOM_TOOLTIP="Choose a colour at random.",e.Msg.COLOUR_RGB_BLUE="blue",e.Msg.COLOUR_RGB_GREEN="green",e.Msg.COLOUR_RGB_HELPURL="https://www.december.com/html/spec/colorpercompact.html",e.Msg.COLOUR_RGB_RED="red",e.Msg.COLOUR_RGB_TITLE="colour with",e.Msg.COLOUR_RGB_TOOLTIP="Create a colour with the specified amount of red, green, and blue. All values must be between 0 and 100.",e.Msg.CONTROLS_FLOW_STATEMENTS_HELPURL="https://github.com/google/blockly/wiki/Loops#loop-termination-blocks",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK="break out of loop",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE="continue with next iteration of loop",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK="Break out of the containing loop.",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE="Skip the rest of this loop, and continue with the next iteration.",e.Msg.CONTROLS_FLOW_STATEMENTS_WARNING="Warning: This block may only be used within a loop.",e.Msg.CONTROLS_FOREACH_HELPURL="https://github.com/google/blockly/wiki/Loops#for-each",e.Msg.CONTROLS_FOREACH_TITLE="for each item %1 in list %2",e.Msg.CONTROLS_FOREACH_TOOLTIP="For each item in a list, set the variable '%1' to the item, and then do some statements.",e.Msg.CONTROLS_FOR_HELPURL="https://github.com/google/blockly/wiki/Loops#count-with",e.Msg.CONTROLS_FOR_TITLE="count with %1 from %2 to %3 by %4",e.Msg.CONTROLS_FOR_TOOLTIP="Have the variable '%1' take on the values from the start number to the end number, counting by the specified interval, and do the specified blocks.",e.Msg.CONTROLS_IF_ELSEIF_TOOLTIP="Add a condition to the if block.",e.Msg.CONTROLS_IF_ELSE_TOOLTIP="Add a final, catch-all condition to the if block.",e.Msg.CONTROLS_IF_HELPURL="https://github.com/google/blockly/wiki/IfElse",e.Msg.CONTROLS_IF_IF_TOOLTIP="Add, remove, or reorder sections to reconfigure this if block.",e.Msg.CONTROLS_IF_MSG_ELSE="else",e.Msg.CONTROLS_IF_MSG_ELSEIF="else if",e.Msg.CONTROLS_IF_MSG_IF="if",e.Msg.CONTROLS_IF_TOOLTIP_1="If a value is true, then do some statements.",e.Msg.CONTROLS_IF_TOOLTIP_2="If a value is true, then do the first block of statements. Otherwise, do the second block of statements.",e.Msg.CONTROLS_IF_TOOLTIP_3="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.",e.Msg.CONTROLS_IF_TOOLTIP_4="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.",e.Msg.CONTROLS_REPEAT_HELPURL="https://en.wikipedia.org/wiki/For_loop",e.Msg.CONTROLS_REPEAT_INPUT_DO="do",e.Msg.CONTROLS_REPEAT_TITLE="repeat %1 times",e.Msg.CONTROLS_REPEAT_TOOLTIP="Do some statements several times.",e.Msg.CONTROLS_WHILEUNTIL_HELPURL="https://github.com/google/blockly/wiki/Loops#repeat",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_UNTIL="repeat until",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_WHILE="repeat while",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL="While a value is false, then do some statements.",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_WHILE="While a value is true, then do some statements.",e.Msg.DELETE_ALL_BLOCKS="Delete all %1 blocks?",e.Msg.DELETE_BLOCK="Delete Block",e.Msg.DELETE_VARIABLE="Delete the '%1' variable",e.Msg.DELETE_VARIABLE_CONFIRMATION="Delete %1 uses of the '%2' variable?",e.Msg.DELETE_X_BLOCKS="Delete %1 Blocks",e.Msg.DIALOG_CANCEL="Cancel",e.Msg.DIALOG_OK="OK",e.Msg.DISABLE_BLOCK="Disable Block",e.Msg.DUPLICATE_BLOCK="Duplicate",e.Msg.DUPLICATE_COMMENT="Duplicate Comment",e.Msg.ENABLE_BLOCK="Enable Block",e.Msg.EXPAND_ALL="Expand Blocks",e.Msg.EXPAND_BLOCK="Expand Block",e.Msg.EXTERNAL_INPUTS="External Inputs",e.Msg.HELP="Help",e.Msg.INLINE_INPUTS="Inline Inputs",e.Msg.LISTS_CREATE_EMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#create-empty-list",e.Msg.LISTS_CREATE_EMPTY_TITLE="create empty list",e.Msg.LISTS_CREATE_EMPTY_TOOLTIP="Returns a list, of length 0, containing no data records",e.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD="list",e.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP="Add, remove, or reorder sections to reconfigure this list block.",e.Msg.LISTS_CREATE_WITH_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",e.Msg.LISTS_CREATE_WITH_INPUT_WITH="create list with",e.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP="Add an item to the list.",e.Msg.LISTS_CREATE_WITH_TOOLTIP="Create a list with any number of items.",e.Msg.LISTS_GET_INDEX_FIRST="first",e.Msg.LISTS_GET_INDEX_FROM_END="# from end",e.Msg.LISTS_GET_INDEX_FROM_START="#",e.Msg.LISTS_GET_INDEX_GET="get",e.Msg.LISTS_GET_INDEX_GET_REMOVE="get and remove",e.Msg.LISTS_GET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-items-from-a-list",e.Msg.LISTS_GET_INDEX_LAST="last",e.Msg.LISTS_GET_INDEX_RANDOM="random",e.Msg.LISTS_GET_INDEX_REMOVE="remove",e.Msg.LISTS_GET_INDEX_TAIL="",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST="Returns the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM="Returns the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST="Returns the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM="Returns a random item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST="Removes and returns the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM="Removes and returns the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST="Removes and returns the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM="Removes and returns a random item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST="Removes the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM="Removes the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST="Removes the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM="Removes a random item in a list.",e.Msg.LISTS_GET_SUBLIST_END_FROM_END="to # from end",e.Msg.LISTS_GET_SUBLIST_END_FROM_START="to #",e.Msg.LISTS_GET_SUBLIST_END_LAST="to last",e.Msg.LISTS_GET_SUBLIST_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-a-sublist",e.Msg.LISTS_GET_SUBLIST_START_FIRST="get sub-list from first",e.Msg.LISTS_GET_SUBLIST_START_FROM_END="get sub-list from # from end",e.Msg.LISTS_GET_SUBLIST_START_FROM_START="get sub-list from #",e.Msg.LISTS_GET_SUBLIST_TAIL="",e.Msg.LISTS_GET_SUBLIST_TOOLTIP="Creates a copy of the specified portion of a list.",e.Msg.LISTS_INDEX_FROM_END_TOOLTIP="%1 is the last item.",e.Msg.LISTS_INDEX_FROM_START_TOOLTIP="%1 is the first item.",e.Msg.LISTS_INDEX_OF_FIRST="find first occurrence of item",e.Msg.LISTS_INDEX_OF_HELPURL="https://github.com/google/blockly/wiki/Lists#finding-items-in-a-list",e.Msg.LISTS_INDEX_OF_LAST="find last occurrence of item",e.Msg.LISTS_INDEX_OF_TOOLTIP="Returns the index of the first/last occurrence of the item in the list. Returns %1 if item is not found.",e.Msg.LISTS_INLIST="in list",e.Msg.LISTS_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#is-empty",e.Msg.LISTS_ISEMPTY_TITLE="%1 is empty",e.Msg.LISTS_ISEMPTY_TOOLTIP="Returns true if the list is empty.",e.Msg.LISTS_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Lists#length-of",e.Msg.LISTS_LENGTH_TITLE="length of %1",e.Msg.LISTS_LENGTH_TOOLTIP="Returns the length of a list.",e.Msg.LISTS_REPEAT_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",e.Msg.LISTS_REPEAT_TITLE="create list with item %1 repeated %2 times",e.Msg.LISTS_REPEAT_TOOLTIP="Creates a list consisting of the given value repeated the specified number of times.",e.Msg.LISTS_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Lists#reversing-a-list",e.Msg.LISTS_REVERSE_MESSAGE0="reverse %1",e.Msg.LISTS_REVERSE_TOOLTIP="Reverse a copy of a list.",e.Msg.LISTS_SET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#in-list--set",e.Msg.LISTS_SET_INDEX_INPUT_TO="as",e.Msg.LISTS_SET_INDEX_INSERT="insert at",e.Msg.LISTS_SET_INDEX_SET="set",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST="Inserts the item at the start of a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM="Inserts the item at the specified position in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST="Append the item to the end of a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM="Inserts the item randomly in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST="Sets the first item in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM="Sets the item at the specified position in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST="Sets the last item in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM="Sets a random item in a list.",e.Msg.LISTS_SORT_HELPURL="https://github.com/google/blockly/wiki/Lists#sorting-a-list",e.Msg.LISTS_SORT_ORDER_ASCENDING="ascending",e.Msg.LISTS_SORT_ORDER_DESCENDING="descending",e.Msg.LISTS_SORT_TITLE="sort %1 %2 %3",e.Msg.LISTS_SORT_TOOLTIP="Sort a copy of a list.",e.Msg.LISTS_SORT_TYPE_IGNORECASE="alphabetic, ignore case",e.Msg.LISTS_SORT_TYPE_NUMERIC="numeric",e.Msg.LISTS_SORT_TYPE_TEXT="alphabetic",e.Msg.LISTS_SPLIT_HELPURL="https://github.com/google/blockly/wiki/Lists#splitting-strings-and-joining-lists",e.Msg.LISTS_SPLIT_LIST_FROM_TEXT="make list from text",e.Msg.LISTS_SPLIT_TEXT_FROM_LIST="make text from list",e.Msg.LISTS_SPLIT_TOOLTIP_JOIN="Join a list of texts into one text, separated by a delimiter.",e.Msg.LISTS_SPLIT_TOOLTIP_SPLIT="Split text into a list of texts, breaking at each delimiter.",e.Msg.LISTS_SPLIT_WITH_DELIMITER="with delimiter",e.Msg.LOGIC_BOOLEAN_FALSE="false",e.Msg.LOGIC_BOOLEAN_HELPURL="https://github.com/google/blockly/wiki/Logic#values",e.Msg.LOGIC_BOOLEAN_TOOLTIP="Returns either true or false.",e.Msg.LOGIC_BOOLEAN_TRUE="true",e.Msg.LOGIC_COMPARE_HELPURL="https://en.wikipedia.org/wiki/Inequality_(mathematics)",e.Msg.LOGIC_COMPARE_TOOLTIP_EQ="Return true if both inputs equal each other.",e.Msg.LOGIC_COMPARE_TOOLTIP_GT="Return true if the first input is greater than the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_GTE="Return true if the first input is greater than or equal to the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_LT="Return true if the first input is smaller than the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_LTE="Return true if the first input is smaller than or equal to the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_NEQ="Return true if both inputs are not equal to each other.",e.Msg.LOGIC_NEGATE_HELPURL="https://github.com/google/blockly/wiki/Logic#not",e.Msg.LOGIC_NEGATE_TITLE="not %1",e.Msg.LOGIC_NEGATE_TOOLTIP="Returns true if the input is false. Returns false if the input is true.",e.Msg.LOGIC_NULL="null",e.Msg.LOGIC_NULL_HELPURL="https://en.wikipedia.org/wiki/Nullable_type",e.Msg.LOGIC_NULL_TOOLTIP="Returns null.",e.Msg.LOGIC_OPERATION_AND="and",e.Msg.LOGIC_OPERATION_HELPURL="https://github.com/google/blockly/wiki/Logic#logical-operations",e.Msg.LOGIC_OPERATION_OR="or",e.Msg.LOGIC_OPERATION_TOOLTIP_AND="Return true if both inputs are true.",e.Msg.LOGIC_OPERATION_TOOLTIP_OR="Return true if at least one of the inputs is true.",e.Msg.LOGIC_TERNARY_CONDITION="test",e.Msg.LOGIC_TERNARY_HELPURL="https://en.wikipedia.org/wiki/%3F:",e.Msg.LOGIC_TERNARY_IF_FALSE="if false",e.Msg.LOGIC_TERNARY_IF_TRUE="if true",e.Msg.LOGIC_TERNARY_TOOLTIP="Check the condition in 'test'. If the condition is true, returns the 'if true' value; otherwise returns the 'if false' value.",e.Msg.MATH_ADDITION_SYMBOL="+",e.Msg.MATH_ARITHMETIC_HELPURL="https://en.wikipedia.org/wiki/Arithmetic",e.Msg.MATH_ARITHMETIC_TOOLTIP_ADD="Return the sum of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_DIVIDE="Return the quotient of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MINUS="Return the difference of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MULTIPLY="Return the product of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_POWER="Return the first number raised to the power of the second number.",e.Msg.MATH_ATAN2_HELPURL="https://en.wikipedia.org/wiki/Atan2",e.Msg.MATH_ATAN2_TITLE="atan2 of X:%1 Y:%2",e.Msg.MATH_ATAN2_TOOLTIP="Return the arctangent of point (X, Y) in degrees from -180 to 180.",e.Msg.MATH_CHANGE_HELPURL="https://en.wikipedia.org/wiki/Programming_idiom#Incrementing_a_counter",e.Msg.MATH_CHANGE_TITLE="change %1 by %2",e.Msg.MATH_CHANGE_TOOLTIP="Add a number to variable '%1'.",e.Msg.MATH_CONSTANT_HELPURL="https://en.wikipedia.org/wiki/Mathematical_constant",e.Msg.MATH_CONSTANT_TOOLTIP="Return one of the common constants:  (3.141), e (2.718),  (1.618), sqrt(2) (1.414), sqrt() (0.707), or  (infinity).",e.Msg.MATH_CONSTRAIN_HELPURL="https://en.wikipedia.org/wiki/Clamping_(graphics)",e.Msg.MATH_CONSTRAIN_TITLE="constrain %1 low %2 high %3",e.Msg.MATH_CONSTRAIN_TOOLTIP="Constrain a number to be between the specified limits (inclusive).",e.Msg.MATH_DIVISION_SYMBOL="",e.Msg.MATH_IS_DIVISIBLE_BY="is divisible by",e.Msg.MATH_IS_EVEN="is even",e.Msg.MATH_IS_NEGATIVE="is negative",e.Msg.MATH_IS_ODD="is odd",e.Msg.MATH_IS_POSITIVE="is positive",e.Msg.MATH_IS_PRIME="is prime",e.Msg.MATH_IS_TOOLTIP="Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.",e.Msg.MATH_IS_WHOLE="is whole",e.Msg.MATH_MODULO_HELPURL="https://en.wikipedia.org/wiki/Modulo_operation",e.Msg.MATH_MODULO_TITLE="remainder of %1  %2",e.Msg.MATH_MODULO_TOOLTIP="Return the remainder from dividing the two numbers.",e.Msg.MATH_MULTIPLICATION_SYMBOL="",e.Msg.MATH_NUMBER_HELPURL="https://en.wikipedia.org/wiki/Number",e.Msg.MATH_NUMBER_TOOLTIP="A number.",e.Msg.MATH_ONLIST_HELPURL="",e.Msg.MATH_ONLIST_OPERATOR_AVERAGE="average of list",e.Msg.MATH_ONLIST_OPERATOR_MAX="max of list",e.Msg.MATH_ONLIST_OPERATOR_MEDIAN="median of list",e.Msg.MATH_ONLIST_OPERATOR_MIN="min of list",e.Msg.MATH_ONLIST_OPERATOR_MODE="modes of list",e.Msg.MATH_ONLIST_OPERATOR_RANDOM="random item of list",e.Msg.MATH_ONLIST_OPERATOR_STD_DEV="standard deviation of list",e.Msg.MATH_ONLIST_OPERATOR_SUM="sum of list",e.Msg.MATH_ONLIST_TOOLTIP_AVERAGE="Return the average (arithmetic mean) of the numeric values in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MAX="Return the largest number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MEDIAN="Return the median number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MIN="Return the smallest number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MODE="Return a list of the most common item(s) in the list.",e.Msg.MATH_ONLIST_TOOLTIP_RANDOM="Return a random element from the list.",e.Msg.MATH_ONLIST_TOOLTIP_STD_DEV="Return the standard deviation of the list.",e.Msg.MATH_ONLIST_TOOLTIP_SUM="Return the sum of all the numbers in the list.",e.Msg.MATH_POWER_SYMBOL="^",e.Msg.MATH_RANDOM_FLOAT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",e.Msg.MATH_RANDOM_FLOAT_TITLE_RANDOM="random fraction",e.Msg.MATH_RANDOM_FLOAT_TOOLTIP="Return a random fraction between 0.0 (inclusive) and 1.0 (exclusive).",e.Msg.MATH_RANDOM_INT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",e.Msg.MATH_RANDOM_INT_TITLE="random integer from %1 to %2",e.Msg.MATH_RANDOM_INT_TOOLTIP="Return a random integer between the two specified limits, inclusive.",e.Msg.MATH_ROUND_HELPURL="https://en.wikipedia.org/wiki/Rounding",e.Msg.MATH_ROUND_OPERATOR_ROUND="round",e.Msg.MATH_ROUND_OPERATOR_ROUNDDOWN="round down",e.Msg.MATH_ROUND_OPERATOR_ROUNDUP="round up",e.Msg.MATH_ROUND_TOOLTIP="Round a number up or down.",e.Msg.MATH_SINGLE_HELPURL="https://en.wikipedia.org/wiki/Square_root",e.Msg.MATH_SINGLE_OP_ABSOLUTE="absolute",e.Msg.MATH_SINGLE_OP_ROOT="square root",e.Msg.MATH_SINGLE_TOOLTIP_ABS="Return the absolute value of a number.",e.Msg.MATH_SINGLE_TOOLTIP_EXP="Return e to the power of a number.",e.Msg.MATH_SINGLE_TOOLTIP_LN="Return the natural logarithm of a number.",e.Msg.MATH_SINGLE_TOOLTIP_LOG10="Return the base 10 logarithm of a number.",e.Msg.MATH_SINGLE_TOOLTIP_NEG="Return the negation of a number.",e.Msg.MATH_SINGLE_TOOLTIP_POW10="Return 10 to the power of a number.",e.Msg.MATH_SINGLE_TOOLTIP_ROOT="Return the square root of a number.",e.Msg.MATH_SUBTRACTION_SYMBOL="-",e.Msg.MATH_TRIG_ACOS="acos",e.Msg.MATH_TRIG_ASIN="asin",e.Msg.MATH_TRIG_ATAN="atan",e.Msg.MATH_TRIG_COS="cos",e.Msg.MATH_TRIG_HELPURL="https://en.wikipedia.org/wiki/Trigonometric_functions",e.Msg.MATH_TRIG_SIN="sin",e.Msg.MATH_TRIG_TAN="tan",e.Msg.MATH_TRIG_TOOLTIP_ACOS="Return the arccosine of a number.",e.Msg.MATH_TRIG_TOOLTIP_ASIN="Return the arcsine of a number.",e.Msg.MATH_TRIG_TOOLTIP_ATAN="Return the arctangent of a number.",e.Msg.MATH_TRIG_TOOLTIP_COS="Return the cosine of a degree (not radian).",e.Msg.MATH_TRIG_TOOLTIP_SIN="Return the sine of a degree (not radian).",e.Msg.MATH_TRIG_TOOLTIP_TAN="Return the tangent of a degree (not radian).",e.Msg.NEW_COLOUR_VARIABLE="Create colour variable...",e.Msg.NEW_NUMBER_VARIABLE="Create number variable...",e.Msg.NEW_STRING_VARIABLE="Create string variable...",e.Msg.NEW_VARIABLE="Create variable...",e.Msg.NEW_VARIABLE_TITLE="New variable name:",e.Msg.NEW_VARIABLE_TYPE_TITLE="New variable type:",e.Msg.ORDINAL_NUMBER_SUFFIX="",e.Msg.PROCEDURES_ALLOW_STATEMENTS="allow statements",e.Msg.PROCEDURES_BEFORE_PARAMS="with:",e.Msg.PROCEDURES_CALLNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_CALLNORETURN_TOOLTIP="Run the user-defined function '%1'.",e.Msg.PROCEDURES_CALLRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_CALLRETURN_TOOLTIP="Run the user-defined function '%1' and use its output.",e.Msg.PROCEDURES_CALL_BEFORE_PARAMS="with:",e.Msg.PROCEDURES_CALL_DISABLED_DEF_WARNING="Can't run the user-defined function '%1' because the definition block is disabled.",e.Msg.PROCEDURES_CREATE_DO="Create '%1'",e.Msg.PROCEDURES_DEFNORETURN_COMMENT="Describe this function...",e.Msg.PROCEDURES_DEFNORETURN_DO="",e.Msg.PROCEDURES_DEFNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE="do something",e.Msg.PROCEDURES_DEFNORETURN_TITLE="to",e.Msg.PROCEDURES_DEFNORETURN_TOOLTIP="Creates a function with no output.",e.Msg.PROCEDURES_DEFRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_DEFRETURN_RETURN="return",e.Msg.PROCEDURES_DEFRETURN_TOOLTIP="Creates a function with an output.",e.Msg.PROCEDURES_DEF_DUPLICATE_WARNING="Warning: This function has duplicate parameters.",e.Msg.PROCEDURES_HIGHLIGHT_DEF="Highlight function definition",e.Msg.PROCEDURES_IFRETURN_HELPURL="https://c2.com/cgi/wiki?GuardClause",e.Msg.PROCEDURES_IFRETURN_TOOLTIP="If a value is true, then return a second value.",e.Msg.PROCEDURES_IFRETURN_WARNING="Warning: This block may be used only within a function definition.",e.Msg.PROCEDURES_MUTATORARG_TITLE="input name:",e.Msg.PROCEDURES_MUTATORARG_TOOLTIP="Add an input to the function.",e.Msg.PROCEDURES_MUTATORCONTAINER_TITLE="inputs",e.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP="Add, remove, or reorder inputs to this function.",e.Msg.REDO="Redo",e.Msg.REMOVE_COMMENT="Remove Comment",e.Msg.RENAME_VARIABLE="Rename variable...",e.Msg.RENAME_VARIABLE_TITLE="Rename all '%1' variables to:",e.Msg.TEXT_APPEND_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_APPEND_TITLE="to %1 append text %2",e.Msg.TEXT_APPEND_TOOLTIP="Append some text to variable '%1'.",e.Msg.TEXT_CHANGECASE_HELPURL="https://github.com/google/blockly/wiki/Text#adjusting-text-case",e.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE="to lower case",e.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE="to Title Case",e.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE="to UPPER CASE",e.Msg.TEXT_CHANGECASE_TOOLTIP="Return a copy of the text in a different case.",e.Msg.TEXT_CHARAT_FIRST="get first letter",e.Msg.TEXT_CHARAT_FROM_END="get letter # from end",e.Msg.TEXT_CHARAT_FROM_START="get letter #",e.Msg.TEXT_CHARAT_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-text",e.Msg.TEXT_CHARAT_LAST="get last letter",e.Msg.TEXT_CHARAT_RANDOM="get random letter",e.Msg.TEXT_CHARAT_TAIL="",e.Msg.TEXT_CHARAT_TITLE="in text %1 %2",e.Msg.TEXT_CHARAT_TOOLTIP="Returns the letter at the specified position.",e.Msg.TEXT_COUNT_HELPURL="https://github.com/google/blockly/wiki/Text#counting-substrings",e.Msg.TEXT_COUNT_MESSAGE0="count %1 in %2",e.Msg.TEXT_COUNT_TOOLTIP="Count how many times some text occurs within some other text.",e.Msg.TEXT_CREATE_JOIN_ITEM_TOOLTIP="Add an item to the text.",e.Msg.TEXT_CREATE_JOIN_TITLE_JOIN="join",e.Msg.TEXT_CREATE_JOIN_TOOLTIP="Add, remove, or reorder sections to reconfigure this text block.",e.Msg.TEXT_GET_SUBSTRING_END_FROM_END="to letter # from end",e.Msg.TEXT_GET_SUBSTRING_END_FROM_START="to letter #",e.Msg.TEXT_GET_SUBSTRING_END_LAST="to last letter",e.Msg.TEXT_GET_SUBSTRING_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-a-region-of-text",e.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT="in text",e.Msg.TEXT_GET_SUBSTRING_START_FIRST="get substring from first letter",e.Msg.TEXT_GET_SUBSTRING_START_FROM_END="get substring from letter # from end",e.Msg.TEXT_GET_SUBSTRING_START_FROM_START="get substring from letter #",e.Msg.TEXT_GET_SUBSTRING_TAIL="",e.Msg.TEXT_GET_SUBSTRING_TOOLTIP="Returns a specified portion of the text.",e.Msg.TEXT_INDEXOF_HELPURL="https://github.com/google/blockly/wiki/Text#finding-text",e.Msg.TEXT_INDEXOF_OPERATOR_FIRST="find first occurrence of text",e.Msg.TEXT_INDEXOF_OPERATOR_LAST="find last occurrence of text",e.Msg.TEXT_INDEXOF_TITLE="in text %1 %2 %3",e.Msg.TEXT_INDEXOF_TOOLTIP="Returns the index of the first/last occurrence of the first text in the second text. Returns %1 if text is not found.",e.Msg.TEXT_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Text#checking-for-empty-text",e.Msg.TEXT_ISEMPTY_TITLE="%1 is empty",e.Msg.TEXT_ISEMPTY_TOOLTIP="Returns true if the provided text is empty.",e.Msg.TEXT_JOIN_HELPURL="https://github.com/google/blockly/wiki/Text#text-creation",e.Msg.TEXT_JOIN_TITLE_CREATEWITH="create text with",e.Msg.TEXT_JOIN_TOOLTIP="Create a piece of text by joining together any number of items.",e.Msg.TEXT_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_LENGTH_TITLE="length of %1",e.Msg.TEXT_LENGTH_TOOLTIP="Returns the number of letters (including spaces) in the provided text.",e.Msg.TEXT_PRINT_HELPURL="https://github.com/google/blockly/wiki/Text#printing-text",e.Msg.TEXT_PRINT_TITLE="print %1",e.Msg.TEXT_PRINT_TOOLTIP="Print the specified text, number or other value.",e.Msg.TEXT_PROMPT_HELPURL="https://github.com/google/blockly/wiki/Text#getting-input-from-the-user",e.Msg.TEXT_PROMPT_TOOLTIP_NUMBER="Prompt for user for a number.",e.Msg.TEXT_PROMPT_TOOLTIP_TEXT="Prompt for user for some text.",e.Msg.TEXT_PROMPT_TYPE_NUMBER="prompt for number with message",e.Msg.TEXT_PROMPT_TYPE_TEXT="prompt for text with message",e.Msg.TEXT_REPLACE_HELPURL="https://github.com/google/blockly/wiki/Text#replacing-substrings",e.Msg.TEXT_REPLACE_MESSAGE0="replace %1 with %2 in %3",e.Msg.TEXT_REPLACE_TOOLTIP="Replace all occurances of some text within some other text.",e.Msg.TEXT_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Text#reversing-text",e.Msg.TEXT_REVERSE_MESSAGE0="reverse %1",e.Msg.TEXT_REVERSE_TOOLTIP="Reverses the order of the characters in the text.",e.Msg.TEXT_TEXT_HELPURL="https://en.wikipedia.org/wiki/String_(computer_science)",e.Msg.TEXT_TEXT_TOOLTIP="A letter, word, or line of text.",e.Msg.TEXT_TRIM_HELPURL="https://github.com/google/blockly/wiki/Text#trimming-removing-spaces",e.Msg.TEXT_TRIM_OPERATOR_BOTH="trim spaces from both sides of",e.Msg.TEXT_TRIM_OPERATOR_LEFT="trim spaces from left side of",e.Msg.TEXT_TRIM_OPERATOR_RIGHT="trim spaces from right side of",e.Msg.TEXT_TRIM_TOOLTIP="Return a copy of the text with spaces removed from one or both ends.",e.Msg.TODAY="Today",e.Msg.UNDO="Undo",e.Msg.UNNAMED_KEY="unnamed",e.Msg.VARIABLES_DEFAULT_NAME="item",e.Msg.VARIABLES_GET_CREATE_SET="Create 'set %1'",e.Msg.VARIABLES_GET_HELPURL="https://github.com/google/blockly/wiki/Variables#get",e.Msg.VARIABLES_GET_TOOLTIP="Returns the value of this variable.",e.Msg.VARIABLES_SET="set %1 to %2",e.Msg.VARIABLES_SET_CREATE_GET="Create 'get %1'",e.Msg.VARIABLES_SET_HELPURL="https://github.com/google/blockly/wiki/Variables#set",e.Msg.VARIABLES_SET_TOOLTIP="Sets this variable to be equal to the input.",e.Msg.VARIABLE_ALREADY_EXISTS="A variable named '%1' already exists.",e.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE="A variable named '%1' already exists for another type: '%2'.",e.Msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER="A variable named '%1' already exists as a parameter in the procedure '%2'.",e.Msg.WORKSPACE_ARIA_LABEL="Blockly Workspace",e.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="Say something...",e.Msg.CONTROLS_FOREACH_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_FOR_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_IF_ELSEIF_TITLE_ELSEIF=e.Msg.CONTROLS_IF_MSG_ELSEIF,e.Msg.CONTROLS_IF_ELSE_TITLE_ELSE=e.Msg.CONTROLS_IF_MSG_ELSE,e.Msg.CONTROLS_IF_IF_TITLE_IF=e.Msg.CONTROLS_IF_MSG_IF,e.Msg.CONTROLS_IF_MSG_THEN=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_WHILEUNTIL_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.LISTS_CREATE_WITH_ITEM_TITLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.LISTS_GET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_INDEX_OF_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_SET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.MATH_CHANGE_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.PROCEDURES_DEFRETURN_COMMENT=e.Msg.PROCEDURES_DEFNORETURN_COMMENT,e.Msg.PROCEDURES_DEFRETURN_DO=e.Msg.PROCEDURES_DEFNORETURN_DO,e.Msg.PROCEDURES_DEFRETURN_PROCEDURE=e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE,e.Msg.PROCEDURES_DEFRETURN_TITLE=e.Msg.PROCEDURES_DEFNORETURN_TITLE,e.Msg.TEXT_APPEND_VARIABLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.TEXT_CREATE_JOIN_ITEM_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.COLOUR_HUE="20",e.Msg.LISTS_HUE="260",e.Msg.LOGIC_HUE="210",e.Msg.LOOPS_HUE="120",e.Msg.MATH_HUE="230",e.Msg.PROCEDURES_HUE="290",e.Msg.TEXTS_HUE="160",e.Msg.VARIABLES_DYNAMIC_HUE="310",e.Msg.VARIABLES_HUE="330",e.Msg}))},{}],213:[function(e,t,i){t.exports=e("./php_compressed.js")},{"./php_compressed.js":214}],214:[function(e,t,i){var n,s;n=this,s=function(e){var t,i,n=e.__namespace__,s=function(e,i){let n,s,o=0,r="";i.STATEMENT_PREFIX&&(r+=i.injectId(i.STATEMENT_PREFIX,e));do{s=i.valueToCode(e,"IF"+o,t.NONE)||"false",n=i.statementToCode(e,"DO"+o),i.STATEMENT_SUFFIX&&(n=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+n),r+=(0<o?" else ":"")+"if ("+s+") {\n"+n+"}",o++}while(e.getInput("IF"+o));return(e.getInput("ELSE")||i.STATEMENT_SUFFIX)&&(n=i.statementToCode(e,"ELSE"),i.STATEMENT_SUFFIX&&(n=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+n),r+=" else {\n"+n+"}"),r+"\n"},o=function(e,i){let s;s=e.getField("TIMES")?String(Number(e.getFieldValue("TIMES"))):i.valueToCode(e,"TIMES",t.ASSIGNMENT)||"0";let o=i.statementToCode(e,"DO");o=i.addLoopTrap(o,e),e="";const r=i.nameDB_.getDistinctName("count",n.NameType$$module$build$src$core$names.VARIABLE);let a=s;return s.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(s)||(e+=(a=i.nameDB_.getDistinctName("repeat_end",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+s+";\n"),e+"for ("+r+" = 0; "+r+" < "+a+"; "+r+"++) {\n"+o+"}\n"},r=function(e,i){const n=e.getFieldValue("OP");let s;if("NEG"===n)return"-"===(e=i.valueToCode(e,"NUM",t.UNARY_NEGATION)||"0")[0]&&(e=" "+e),["-"+e,t.UNARY_NEGATION];switch(e="SIN"===n||"COS"===n||"TAN"===n?i.valueToCode(e,"NUM",t.DIVISION)||"0":i.valueToCode(e,"NUM",t.NONE)||"0",n){case"ABS":s="abs("+e+")";break;case"ROOT":s="sqrt("+e+")";break;case"LN":s="log("+e+")";break;case"EXP":s="exp("+e+")";break;case"POW10":s="pow(10,"+e+")";break;case"ROUND":s="round("+e+")";break;case"ROUNDUP":s="ceil("+e+")";break;case"ROUNDDOWN":s="floor("+e+")";break;case"SIN":s="sin("+e+" / 180 * pi())";break;case"COS":s="cos("+e+" / 180 * pi())";break;case"TAN":s="tan("+e+" / 180 * pi())"}if(s)return[s,t.FUNCTION_CALL];switch(n){case"LOG10":s="log("+e+") / log(10)";break;case"ASIN":s="asin("+e+") / pi() * 180";break;case"ACOS":s="acos("+e+") / pi() * 180";break;case"ATAN":s="atan("+e+") / pi() * 180";break;default:throw Error("Unknown math operator: "+n)}return[s,t.DIVISION]},a=function(e,i){var s=[],o=e.workspace,r=n.allUsedVarModels$$module$build$src$core$variables(o)||[];for(var a of r)r=a.name,e.getVars().includes(r)||s.push(i.getVariableName(r));for(o=n.allDeveloperVariables$$module$build$src$core$variables(o),a=0;a<o.length;a++)s.push(i.nameDB_.getName(o[a],n.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));o=s.length?i.INDENT+"global "+s.join(", ")+";\n":"",s=i.getProcedureName(e.getFieldValue("NAME")),a="",i.STATEMENT_PREFIX&&(a+=i.injectId(i.STATEMENT_PREFIX,e)),i.STATEMENT_SUFFIX&&(a+=i.injectId(i.STATEMENT_SUFFIX,e)),a&&(a=i.prefixLines(a,i.INDENT)),r="",i.INFINITE_LOOP_TRAP&&(r=i.prefixLines(i.injectId(i.INFINITE_LOOP_TRAP,e),i.INDENT));let l="";e.getInput("STACK")&&(l=i.statementToCode(e,"STACK"));let c="";e.getInput("RETURN")&&(c=i.valueToCode(e,"RETURN",t.NONE)||"");let u="";l&&c&&(u=a),c&&(c=i.INDENT+"return "+c+";\n");const h=[],d=e.getVars();for(let e=0;e<d.length;e++)h[e]=i.getVariableName(d[e]);return o="function "+s+"("+h.join(", ")+") {\n"+o+a+r+l+u+c+"}",o=i.scrub_(e,o),i.definitions_["%"+s]=o,null},l=function(e,i){return i="readline("+(e.getField("TEXT")?i.quote_(e.getFieldValue("TEXT")):i.valueToCode(e,"TEXT",t.NONE)||"''")+")","NUMBER"===e.getFieldValue("TYPE")&&(i="floatval("+i+")"),[i,t.FUNCTION_CALL]},c=function(e,i){return[i.getVariableName(e.getFieldValue("VAR")),t.ATOMIC]},u=function(e,i){const n=i.valueToCode(e,"VALUE",t.ASSIGNMENT)||"0";return i.getVariableName(e.getFieldValue("VAR"))+" = "+n+";\n"};(i=t||(t={}))[i.ATOMIC=0]="ATOMIC",i[i.CLONE=1]="CLONE",i[i.NEW=1]="NEW",i[i.MEMBER=2.1]="MEMBER",i[i.FUNCTION_CALL=2.2]="FUNCTION_CALL",i[i.POWER=3]="POWER",i[i.INCREMENT=4]="INCREMENT",i[i.DECREMENT=4]="DECREMENT",i[i.BITWISE_NOT=4]="BITWISE_NOT",i[i.CAST=4]="CAST",i[i.SUPPRESS_ERROR=4]="SUPPRESS_ERROR",i[i.INSTANCEOF=5]="INSTANCEOF",i[i.LOGICAL_NOT=6]="LOGICAL_NOT",i[i.UNARY_PLUS=7.1]="UNARY_PLUS",i[i.UNARY_NEGATION=7.2]="UNARY_NEGATION",i[i.MULTIPLICATION=8.1]="MULTIPLICATION",i[i.DIVISION=8.2]="DIVISION",i[i.MODULUS=8.3]="MODULUS",i[i.ADDITION=9.1]="ADDITION",i[i.SUBTRACTION=9.2]="SUBTRACTION",i[i.STRING_CONCAT=9.3]="STRING_CONCAT",i[i.BITWISE_SHIFT=10]="BITWISE_SHIFT",i[i.RELATIONAL=11]="RELATIONAL",i[i.EQUALITY=12]="EQUALITY",i[i.REFERENCE=13]="REFERENCE",i[i.BITWISE_AND=13]="BITWISE_AND",i[i.BITWISE_XOR=14]="BITWISE_XOR",i[i.BITWISE_OR=15]="BITWISE_OR",i[i.LOGICAL_AND=16]="LOGICAL_AND",i[i.LOGICAL_OR=17]="LOGICAL_OR",i[i.IF_NULL=18]="IF_NULL",i[i.CONDITIONAL=19]="CONDITIONAL",i[i.ASSIGNMENT=20]="ASSIGNMENT",i[i.LOGICAL_AND_WEAK=21]="LOGICAL_AND_WEAK",i[i.LOGICAL_XOR=22]="LOGICAL_XOR",i[i.LOGICAL_OR_WEAK=23]="LOGICAL_OR_WEAK",i[i.NONE=99]="NONE";var h=class extends n.CodeGenerator$$module$build$src$core$generator{constructor(e="PHP"){super(e),this.ORDER_OVERRIDES=[[t.MEMBER,t.FUNCTION_CALL],[t.MEMBER,t.MEMBER],[t.LOGICAL_NOT,t.LOGICAL_NOT],[t.MULTIPLICATION,t.MULTIPLICATION],[t.ADDITION,t.ADDITION],[t.LOGICAL_AND,t.LOGICAL_AND],[t.LOGICAL_OR,t.LOGICAL_OR]],this.isInitialized=!1;for(const i in t)"string"!=typeof(e=t[i])&&(this["ORDER_"+i]=e);this.addReservedWords("__halt_compiler,abstract,and,array,as,break,callable,case,catch,class,clone,const,continue,declare,default,die,do,echo,else,elseif,empty,enddeclare,endfor,endforeach,endif,endswitch,endwhile,eval,exit,extends,final,for,foreach,function,global,goto,if,implements,include,include_once,instanceof,insteadof,interface,isset,list,namespace,new,or,print,private,protected,public,require,require_once,return,static,switch,throw,trait,try,unset,use,var,while,xor,PHP_VERSION,PHP_MAJOR_VERSION,PHP_MINOR_VERSION,PHP_RELEASE_VERSION,PHP_VERSION_ID,PHP_EXTRA_VERSION,PHP_ZTS,PHP_DEBUG,PHP_MAXPATHLEN,PHP_OS,PHP_SAPI,PHP_EOL,PHP_INT_MAX,PHP_INT_SIZE,DEFAULT_INCLUDE_PATH,PEAR_INSTALL_DIR,PEAR_EXTENSION_DIR,PHP_EXTENSION_DIR,PHP_PREFIX,PHP_BINDIR,PHP_BINARY,PHP_MANDIR,PHP_LIBDIR,PHP_DATADIR,PHP_SYSCONFDIR,PHP_LOCALSTATEDIR,PHP_CONFIG_FILE_PATH,PHP_CONFIG_FILE_SCAN_DIR,PHP_SHLIB_SUFFIX,E_ERROR,E_WARNING,E_PARSE,E_NOTICE,E_CORE_ERROR,E_CORE_WARNING,E_COMPILE_ERROR,E_COMPILE_WARNING,E_USER_ERROR,E_USER_WARNING,E_USER_NOTICE,E_DEPRECATED,E_USER_DEPRECATED,E_ALL,E_STRICT,__COMPILER_HALT_OFFSET__,TRUE,FALSE,NULL,__CLASS__,__DIR__,__FILE__,__FUNCTION__,__LINE__,__METHOD__,__NAMESPACE__,__TRAIT__")}init(e){super.init(e),this.nameDB_?this.nameDB_.reset():this.nameDB_=new n.Names$$module$build$src$core$names(this.RESERVED_WORDS_,"$"),this.nameDB_.setVariableMap(e.getVariableMap()),this.nameDB_.populateVariables(e),this.nameDB_.populateProcedures(e),this.isInitialized=!0}finish(e){const t=Object.values(this.definitions_);return e=super.finish(e),this.isInitialized=!1,this.nameDB_.reset(),t.join("\n\n")+"\n\n\n"+e}scrubNakedValue(e){return e+";\n"}quote_(e){return"'"+(e=e.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"))+"'"}multiline_quote_(e){return e.split(/\n/g).map(this.quote_).join(' . "\\n" .\n')}scrub_(e,t,i=!1){let s="";if(!e.outputConnection||!e.outputConnection.targetConnection){var o=e.getCommentText();o&&(o=n.wrap$$module$build$src$core$utils$string(o,this.COMMENT_WRAP-3),s+=this.prefixLines(o,"// ")+"\n");for(let t=0;t<e.inputList.length;t++)e.inputList[t].type===n.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&(o=e.inputList[t].connection.targetBlock())&&(o=this.allNestedComments(o))&&(s+=this.prefixLines(o,"// "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),s+t+(i?"":this.blockToCode(e))}getAdjusted(e,i,s=0,o=!1,r=t.NONE){e.workspace.options.oneBasedIndex&&s--;let a=e.workspace.options.oneBasedIndex?"1":"0",l=r;return 0<s?l=t.ADDITION:0>s?l=t.SUBTRACTION:o&&(l=t.UNARY_NEGATION),e=this.valueToCode(e,i,l)||a,0!==s||o?n.isNumber$$module$build$src$core$utils$string(e)?(e=String(Number(e)+s),o&&(e=String(-Number(e))),e):(0<s?e=`${e} + ${s}`:0>s&&(e=`${e} - ${-s}`),o&&(e=s?`-(${e})`:`-${e}`),Math.floor(r)>=Math.floor(l)&&(e=`(${e})`),e):e}},d={};d.Order=t,d.PhpGenerator=h;var p={lists_create_empty:function(e,i){return["array()",t.FUNCTION_CALL]},lists_create_with:function(e,i){const n=Array(e.itemCount_);for(let s=0;s<e.itemCount_;s++)n[s]=i.valueToCode(e,"ADD"+s,t.NONE)||"null";return["array("+n.join(", ")+")",t.FUNCTION_CALL]},lists_getIndex:function(e,i){var n=e.getFieldValue("MODE")||"GET";switch(e.getFieldValue("WHERE")||"FROM_START"){case"FIRST":if("GET"===n)return[(i.valueToCode(e,"VALUE",t.MEMBER)||"array()")+"[0]",t.MEMBER];if("GET_REMOVE"===n)return["array_shift("+(i.valueToCode(e,"VALUE",t.NONE)||"array()")+")",t.FUNCTION_CALL];if("REMOVE"===n)return"array_shift("+(i.valueToCode(e,"VALUE",t.NONE)||"array()")+");\n";break;case"LAST":if("GET"===n)return["end("+(i.valueToCode(e,"VALUE",t.NONE)||"array()")+")",t.FUNCTION_CALL];if("GET_REMOVE"===n)return["array_pop("+(i.valueToCode(e,"VALUE",t.NONE)||"array()")+")",t.FUNCTION_CALL];if("REMOVE"===n)return"array_pop("+(i.valueToCode(e,"VALUE",t.NONE)||"array()")+");\n";break;case"FROM_START":var s=i.getAdjusted(e,"AT");if("GET"===n)return[(i.valueToCode(e,"VALUE",t.MEMBER)||"array()")+"["+s+"]",t.MEMBER];if("GET_REMOVE"===n)return["array_splice("+(i.valueToCode(e,"VALUE",t.NONE)||"array()")+", "+s+", 1)[0]",t.FUNCTION_CALL];if("REMOVE"===n)return"array_splice("+(i.valueToCode(e,"VALUE",t.NONE)||"array()")+", "+s+", 1);\n";break;case"FROM_END":if("GET"===n)return["array_slice("+(n=i.valueToCode(e,"VALUE",t.NONE)||"array()")+", "+(i=i.getAdjusted(e,"AT",1,!0))+", 1)[0]",t.FUNCTION_CALL];if("GET_REMOVE"===n||"REMOVE"===n){if(s=i.valueToCode(e,"VALUE",t.NONE)||"array()",i="array_splice("+s+", count("+s+") - "+(i=i.getAdjusted(e,"AT",1,!1,t.SUBTRACTION))+", 1)[0]","GET_REMOVE"===n)return[i,t.FUNCTION_CALL];if("REMOVE"===n)return i+";\n"}break;case"RANDOM":if(e=i.valueToCode(e,"VALUE",t.NONE)||"array()","GET"===n)return[i.provideFunction_("lists_get_random_item",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($list) {\n  return $list[rand(0,count($list)-1)];\n}\n`)+"("+e+")",t.FUNCTION_CALL];if("GET_REMOVE"===n)return[i.provideFunction_("lists_get_remove_random_item",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(&$list) {\n  $x = rand(0,count($list)-1);\n  unset($list[$x]);\n  return array_values($list);\n}\n`)+"("+e+")",t.FUNCTION_CALL];if("REMOVE"===n)return i.provideFunction_("lists_remove_random_item",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(&$list) {\n  unset($list[rand(0,count($list)-1)]);\n}\n`)+"("+e+");\n"}throw Error("Unhandled combination (lists_getIndex).")},lists_getSublist:function(e,i){var s=i.valueToCode(e,"LIST",t.NONE)||"array()",o=e.getFieldValue("WHERE1");const r=e.getFieldValue("WHERE2");if("FIRST"!==o||"LAST"!==r)if(s.match(/^\$\w+$/)||"FROM_END"!==o&&"FROM_START"===r){switch(o){case"FROM_START":o=i.getAdjusted(e,"AT1");break;case"FROM_END":o="count("+s+") - "+(o=i.getAdjusted(e,"AT1",1,!1,t.SUBTRACTION));break;case"FIRST":o="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(r){case"FROM_START":i=i.getAdjusted(e,"AT2",0,!1,t.SUBTRACTION),i+=" - ",i=n.isNumber$$module$build$src$core$utils$string(String(o))||String(o).match(/^\(.+\)$/)?i+o:i+"("+o+")",i+=" + 1";break;case"FROM_END":i="count("+s+") - "+(i=i.getAdjusted(e,"AT2",0,!1,t.SUBTRACTION))+" - ",i=n.isNumber$$module$build$src$core$utils$string(String(o))||String(o).match(/^\(.+\)$/)?i+o:i+"("+o+")";break;case"LAST":i="count("+s+") - ",i=n.isNumber$$module$build$src$core$utils$string(String(o))||String(o).match(/^\(.+\)$/)?i+o:i+"("+o+")";break;default:throw Error("Unhandled option (lists_getSublist).")}s="array_slice("+s+", "+o+", "+i+")"}else{const t=i.getAdjusted(e,"AT1");e=i.getAdjusted(e,"AT2"),s=i.provideFunction_("lists_get_sublist",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($list, $where1, $at1, $where2, $at2) {\n  if ($where1 == 'FROM_END') {\n    $at1 = count($list) - 1 - $at1;\n  } else if ($where1 == 'FIRST') {\n    $at1 = 0;\n  } else if ($where1 != 'FROM_START') {\n    throw new Exception('Unhandled option (lists_get_sublist).');\n  }\n  $length = 0;\n  if ($where2 == 'FROM_START') {\n    $length = $at2 - $at1 + 1;\n  } else if ($where2 == 'FROM_END') {\n    $length = count($list) - $at1 - $at2;\n  } else if ($where2 == 'LAST') {\n    $length = count($list) - $at1;\n  } else {\n    throw new Exception('Unhandled option (lists_get_sublist).');\n  }\n  return array_slice($list, $at1, $length);\n}\n`)+"("+s+", '"+o+"', "+t+", '"+r+"', "+e+")"}return[s,t.FUNCTION_CALL]},lists_indexOf:function(e,i){const n=i.valueToCode(e,"FIND",t.NONE)||"''",s=i.valueToCode(e,"VALUE",t.MEMBER)||"[]";let o=" -1",r="";return e.workspace.options.oneBasedIndex&&(o=" 0",r=" + 1"),[("FIRST"===e.getFieldValue("END")?i.provideFunction_("indexOf",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($haystack, $needle) {\n  for ($index = 0; $index < count($haystack); $index++) {\n    if ($haystack[$index] == $needle) return $index${r};\n  }\n  return ${o};\n}\n`):i.provideFunction_("lastIndexOf",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($haystack, $needle) {\n  $last = ${o};\n  for ($index = 0; $index < count($haystack); $index++) {\n    if ($haystack[$index] == $needle) $last = $index${r};\n  }\n  return $last;\n}\n`))+"("+s+", "+n+")",t.FUNCTION_CALL]},lists_isEmpty:function(e,i){return["empty("+(i.valueToCode(e,"VALUE",t.FUNCTION_CALL)||"array()")+")",t.FUNCTION_CALL]},lists_length:function(e,i){return[i.provideFunction_("length",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($value) {\n  if (is_string($value)) {\n    return strlen($value);\n  } else {\n    return count($value);\n  }\n}\n`)+"("+(e=i.valueToCode(e,"VALUE",t.NONE)||"''")+")",t.FUNCTION_CALL]},lists_repeat:function(e,i){return[i.provideFunction_("lists_repeat",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($value, $count) {\n  $array = array();\n  for ($index = 0; $index < $count; $index++) {\n    $array[] = $value;\n  }\n  return $array;\n}\n`)+"("+(i.valueToCode(e,"ITEM",t.NONE)||"null")+", "+(e=i.valueToCode(e,"NUM",t.NONE)||"0")+")",t.FUNCTION_CALL]},lists_reverse:function(e,i){return["array_reverse("+(i.valueToCode(e,"LIST",t.NONE)||"[]")+")",t.FUNCTION_CALL]},lists_setIndex:function(e,i){const s=e.getFieldValue("MODE")||"GET";var o=e.getFieldValue("WHERE")||"FROM_START";const r=i.valueToCode(e,"TO",t.ASSIGNMENT)||"null";switch(o){case"FIRST":if("SET"===s)return(i.valueToCode(e,"LIST",t.MEMBER)||"array()")+"[0] = "+r+";\n";if("INSERT"===s)return"array_unshift("+(i.valueToCode(e,"LIST",t.NONE)||"array()")+", "+r+");\n";break;case"LAST":if(e=i.valueToCode(e,"LIST",t.NONE)||"array()","SET"===s)return i.provideFunction_("lists_set_last_item",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(&$list, $value) {\n  $list[count($list) - 1] = $value;\n}\n`)+"("+e+", "+r+");\n";if("INSERT"===s)return"array_push("+e+", "+r+");\n";break;case"FROM_START":if(o=i.getAdjusted(e,"AT"),"SET"===s)return(i.valueToCode(e,"LIST",t.MEMBER)||"array()")+"["+o+"] = "+r+";\n";if("INSERT"===s)return"array_splice("+(i.valueToCode(e,"LIST",t.NONE)||"array()")+", "+o+", 0, "+r+");\n";break;case"FROM_END":if(o=i.valueToCode(e,"LIST",t.NONE)||"array()",e=i.getAdjusted(e,"AT",1),"SET"===s)return i.provideFunction_("lists_set_from_end",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(&$list, $at, $value) {\n  $list[count($list) - $at] = $value;\n}\n`)+"("+o+", "+e+", "+r+");\n";if("INSERT"===s)return i.provideFunction_("lists_insert_from_end",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(&$list, $at, $value) {\n  return array_splice($list, count($list) - $at, 0, $value);\n}\n`)+"("+o+", "+e+", "+r+");\n";break;case"RANDOM":if((e=i.valueToCode(e,"LIST",t.REFERENCE)||"array()").match(/^\$\w+$/))o="";else{var a=(o=i.nameDB_.getDistinctName("tmp_list",n.NameType$$module$build$src$core$names.VARIABLE))+" = &"+e+";\n";e=o,o=a}if(o+=(i=i.nameDB_.getDistinctName("tmp_x",n.NameType$$module$build$src$core$names.VARIABLE))+" = rand(0, count("+e+")-1);\n","SET"===s)return o+(e+"[")+i+"] = "+r+";\n";if("INSERT"===s)return o+"array_splice("+e+", "+i+", 0, "+r+");\n"}throw Error("Unhandled combination (lists_setIndex).")},lists_sort:function(e,i){const n=i.valueToCode(e,"LIST",t.NONE)||"array()",s="1"===e.getFieldValue("DIRECTION")?1:-1;return e=e.getFieldValue("TYPE"),[i.provideFunction_("lists_sort",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($list, $type, $direction) {\n  $sortCmpFuncs = array(\n    'NUMERIC' => 'strnatcasecmp',\n    'TEXT' => 'strcmp',\n    'IGNORE_CASE' => 'strcasecmp'\n  );\n  $sortCmp = $sortCmpFuncs[$type];\n  $list2 = $list;\n  usort($list2, $sortCmp);\n  if ($direction == -1) {\n    $list2 = array_reverse($list2);\n  }\n  return $list2;\n}\n`)+"("+n+', "'+e+'", '+s+")",t.FUNCTION_CALL]},lists_split:function(e,i){let n=i.valueToCode(e,"INPUT",t.NONE);if(i=i.valueToCode(e,"DELIM",t.NONE)||"''","SPLIT"===(e=e.getFieldValue("MODE")))n||(n="''"),e="explode";else{if("JOIN"!==e)throw Error("Unknown mode: "+e);n||(n="array()"),e="implode"}return[e+"("+i+", "+n+")",t.FUNCTION_CALL]}},g={};g.controls_if=s,g.controls_ifelse=s,g.logic_boolean=function(e,i){return["TRUE"===e.getFieldValue("BOOL")?"true":"false",t.ATOMIC]},g.logic_compare=function(e,i){const n={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],s="=="===n||"!="===n?t.EQUALITY:t.RELATIONAL;return[(i.valueToCode(e,"A",s)||"0")+" "+n+" "+(e=i.valueToCode(e,"B",s)||"0"),s]},g.logic_negate=function(e,i){const n=t.LOGICAL_NOT;return["!"+(i.valueToCode(e,"BOOL",n)||"true"),n]},g.logic_null=function(e,i){return["null",t.ATOMIC]},g.logic_operation=function(e,i){const n="AND"===e.getFieldValue("OP")?"&&":"||",s="&&"===n?t.LOGICAL_AND:t.LOGICAL_OR;let o=i.valueToCode(e,"A",s);return e=i.valueToCode(e,"B",s),o||e?(i="&&"===n?"true":"false",o||(o=i),e||(e=i)):e=o="false",[o+" "+n+" "+e,s]},g.logic_ternary=function(e,i){return[(i.valueToCode(e,"IF",t.CONDITIONAL)||"false")+" ? "+(i.valueToCode(e,"THEN",t.CONDITIONAL)||"null")+" : "+(e=i.valueToCode(e,"ELSE",t.CONDITIONAL)||"null"),t.CONDITIONAL]};var m={controls_flow_statements:function(e,t){let i="";if(t.STATEMENT_PREFIX&&(i+=t.injectId(t.STATEMENT_PREFIX,e)),t.STATEMENT_SUFFIX&&(i+=t.injectId(t.STATEMENT_SUFFIX,e)),t.STATEMENT_PREFIX){const n=e.getSurroundLoop();n&&!n.suppressPrefixSuffix&&(i+=t.injectId(t.STATEMENT_PREFIX,n))}switch(e.getFieldValue("FLOW")){case"BREAK":return i+"break;\n";case"CONTINUE":return i+"continue;\n"}throw Error("Unknown flow statement.")},controls_for:function(e,i){var s=i.getVariableName(e.getFieldValue("VAR")),o=i.valueToCode(e,"FROM",t.ASSIGNMENT)||"0",r=i.valueToCode(e,"TO",t.ASSIGNMENT)||"0";const a=i.valueToCode(e,"BY",t.ASSIGNMENT)||"1";let l=i.statementToCode(e,"DO");if(l=i.addLoopTrap(l,e),n.isNumber$$module$build$src$core$utils$string(o)&&n.isNumber$$module$build$src$core$utils$string(r)&&n.isNumber$$module$build$src$core$utils$string(a))e="for ("+s+" = "+o+"; "+s+((i=Number(o)<=Number(r))?" <= ":" >= ")+r+"; "+s,e=1===(s=Math.abs(Number(a)))?e+(i?"++":"--"):e+(i?" += ":" -= ")+s,e+=") {\n"+l+"}\n";else{e="";let t=o;o.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(o)||(e+=(t=i.nameDB_.getDistinctName(s+"_start",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+o+";\n"),o=r,r.match(/^\w+$/)||n.isNumber$$module$build$src$core$utils$string(r)||(e+=(o=i.nameDB_.getDistinctName(s+"_end",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+r+";\n"),e+=(r=i.nameDB_.getDistinctName(s+"_inc",n.NameType$$module$build$src$core$names.VARIABLE))+" = ",e=n.isNumber$$module$build$src$core$utils$string(a)?e+(Math.abs(Number(a))+";\n"):e+"abs("+a+");\n",e+="if ("+t+" > "+o+") {\n",e=(e+=i.INDENT+r+" = -"+r+";\n")+"}\nfor ("+s+" = "+t+"; "+r+" >= 0 ? "+s+" <= "+o+" : "+s+" >= "+o+"; "+s+" += "+r+") {\n"+l+"}\n"}return e},controls_forEach:function(e,i){const n=i.getVariableName(e.getFieldValue("VAR")),s=i.valueToCode(e,"LIST",t.ASSIGNMENT)||"[]";let o=i.statementToCode(e,"DO");return"foreach ("+s+" as "+n+") {\n"+(o=i.addLoopTrap(o,e))+"}\n"}};m.controls_repeat=o,m.controls_repeat_ext=o,m.controls_whileUntil=function(e,i){const n="UNTIL"===e.getFieldValue("MODE");let s=i.valueToCode(e,"BOOL",n?t.LOGICAL_NOT:t.NONE)||"false",o=i.statementToCode(e,"DO");return n&&(s="!"+s),"while ("+s+") {\n"+(o=i.addLoopTrap(o,e))+"}\n"};var f={math_arithmetic:function(e,i){var n={ADD:[" + ",t.ADDITION],MINUS:[" - ",t.SUBTRACTION],MULTIPLY:[" * ",t.MULTIPLICATION],DIVIDE:[" / ",t.DIVISION],POWER:[" ** ",t.POWER]}[e.getFieldValue("OP")];const s=n[0];return n=n[1],[(i.valueToCode(e,"A",n)||"0")+s+(e=i.valueToCode(e,"B",n)||"0"),n]},math_atan2:function(e,i){const n=i.valueToCode(e,"X",t.NONE)||"0";return["atan2("+(i.valueToCode(e,"Y",t.NONE)||"0")+", "+n+") / pi() * 180",t.DIVISION]},math_change:function(e,i){const n=i.valueToCode(e,"DELTA",t.ADDITION)||"0";return i.getVariableName(e.getFieldValue("VAR"))+" += "+n+";\n"},math_constant:function(e,i){return{PI:["M_PI",t.ATOMIC],E:["M_E",t.ATOMIC],GOLDEN_RATIO:["(1 + sqrt(5)) / 2",t.DIVISION],SQRT2:["M_SQRT2",t.ATOMIC],SQRT1_2:["M_SQRT1_2",t.ATOMIC],INFINITY:["INF",t.ATOMIC]}[e.getFieldValue("CONSTANT")]},math_constrain:function(e,i){return["min(max("+(i.valueToCode(e,"VALUE",t.NONE)||"0")+", "+(i.valueToCode(e,"LOW",t.NONE)||"0")+"), "+(e=i.valueToCode(e,"HIGH",t.NONE)||"Infinity")+")",t.FUNCTION_CALL]},math_modulo:function(e,i){return[(i.valueToCode(e,"DIVIDEND",t.MODULUS)||"0")+" % "+(e=i.valueToCode(e,"DIVISOR",t.MODULUS)||"0"),t.MODULUS]},math_number:function(e,i){return 1/0===(e=Number(e.getFieldValue("NUM")))?["INF",t.ATOMIC]:-1/0===e?["-INF",t.UNARY_NEGATION]:[String(e),0<=e?t.ATOMIC:t.UNARY_NEGATION]},math_number_property:function(e,i){var n={EVEN:[""," % 2 == 0",t.MODULUS,t.EQUALITY],ODD:[""," % 2 == 1",t.MODULUS,t.EQUALITY],WHOLE:["is_int(",")",t.NONE,t.FUNCTION_CALL],POSITIVE:[""," > 0",t.RELATIONAL,t.RELATIONAL],NEGATIVE:[""," < 0",t.RELATIONAL,t.RELATIONAL],DIVISIBLE_BY:[null,null,t.MODULUS,t.EQUALITY],PRIME:[null,null,t.NONE,t.FUNCTION_CALL]};const s=e.getFieldValue("PROPERTY"),[o,r,a,l]=n[s];if(n=i.valueToCode(e,"NUMBER_TO_CHECK",a)||"0","PRIME"===s)e=i.provideFunction_("math_isPrime",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($n) {\n  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods\n  if ($n == 2 || $n == 3) {\n    return true;\n  }\n  // False if n is NaN, negative, is 1, or not whole.\n  // And false if n is divisible by 2 or 3.\n  if (!is_numeric($n) || $n <= 1 || $n % 1 != 0 || $n % 2 == 0 || $n % 3 == 0) {\n    return false;\n  }\n  // Check all the numbers of form 6k +/- 1, up to sqrt(n).\n  for ($x = 6; $x <= sqrt($n) + 1; $x += 6) {\n    if ($n % ($x - 1) == 0 || $n % ($x + 1) == 0) {\n      return false;\n    }\n  }\n  return true;\n}\n`)+"("+n+")";else if("DIVISIBLE_BY"===s){if("0"===(e=i.valueToCode(e,"DIVISOR",t.MODULUS)||"0"))return["false",t.ATOMIC];e=n+" % "+e+" == 0"}else e=o+n+r;return[e,l]},math_on_list:function(e,i){var n=e.getFieldValue("OP");switch(n){case"SUM":e="array_sum("+(e=i.valueToCode(e,"LIST",t.FUNCTION_CALL)||"array()")+")";break;case"MIN":e="min("+(e=i.valueToCode(e,"LIST",t.FUNCTION_CALL)||"array()")+")";break;case"MAX":e="max("+(e=i.valueToCode(e,"LIST",t.FUNCTION_CALL)||"array()")+")";break;case"AVERAGE":e=(n=i.provideFunction_("math_mean",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($myList) {\n  return array_sum($myList) / count($myList);\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"array()")+")";break;case"MEDIAN":e=(n=i.provideFunction_("math_median",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($arr) {\n  sort($arr,SORT_NUMERIC);\n  return (count($arr) % 2) ? $arr[floor(count($arr) / 2)] :\n      ($arr[floor(count($arr) / 2)] + $arr[floor(count($arr) / 2) - 1]) / 2;\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MODE":e=(n=i.provideFunction_("math_modes",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($values) {\n  if (empty($values)) return array();\n  $counts = array_count_values($values);\n  arsort($counts); // Sort counts in descending order\n  $modes = array_keys($counts, current($counts), true);\n  return $modes;\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"STD_DEV":e=(n=i.provideFunction_("math_standard_deviation",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($numbers) {\n  $n = count($numbers);\n  if (!$n) return null;\n  $mean = array_sum($numbers) / count($numbers);\n  foreach($numbers as $key => $num) $devs[$key] = pow($num - $mean, 2);\n  return sqrt(array_sum($devs) / (count($devs) - 1));\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"RANDOM":e=(n=i.provideFunction_("math_random_list",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($list) {\n  $x = rand(0, count($list)-1);\n  return $list[$x];\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;default:throw Error("Unknown operator: "+n)}return[e,t.FUNCTION_CALL]},math_random_float:function(e,i){return["(float)rand()/(float)getrandmax()",t.FUNCTION_CALL]},math_random_int:function(e,i){const n=i.valueToCode(e,"FROM",t.NONE)||"0";return e=i.valueToCode(e,"TO",t.NONE)||"0",[i.provideFunction_("math_random_int",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($a, $b) {\n  if ($a > $b) {\n    return rand($b, $a);\n  }\n  return rand($a, $b);\n}\n`)+"("+n+", "+e+")",t.FUNCTION_CALL]}};f.math_round=r,f.math_single=r,f.math_trig=r;var _={procedures_callnoreturn:function(e,t){return t.forBlock.procedures_callreturn(e,t)[0]+";\n"},procedures_callreturn:function(e,i){const n=i.getProcedureName(e.getFieldValue("NAME")),s=[],o=e.getVars();for(let n=0;n<o.length;n++)s[n]=i.valueToCode(e,"ARG"+n,t.NONE)||"null";return[n+"("+s.join(", ")+")",t.FUNCTION_CALL]}};_.procedures_defnoreturn=a,_.procedures_defreturn=a,_.procedures_ifreturn=function(e,i){let n="if ("+(i.valueToCode(e,"CONDITION",t.NONE)||"false")+") {\n";return i.STATEMENT_SUFFIX&&(n+=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)),e.hasReturnValue_?(e=i.valueToCode(e,"VALUE",t.NONE)||"null",n+=i.INDENT+"return "+e+";\n"):n+=i.INDENT+"return;\n",n+"}\n"};var T={text:function(e,i){return[i.quote_(e.getFieldValue("TEXT")),t.ATOMIC]},text_append:function(e,i){return i.getVariableName(e.getFieldValue("VAR"))+" .= "+(e=i.valueToCode(e,"TEXT",t.ASSIGNMENT)||"''")+";\n"},text_changeCase:function(e,i){let n;return i=i.valueToCode(e,"TEXT",t.NONE)||"''","UPPERCASE"===e.getFieldValue("CASE")?n="strtoupper("+i+")":"LOWERCASE"===e.getFieldValue("CASE")?n="strtolower("+i+")":"TITLECASE"===e.getFieldValue("CASE")&&(n="ucwords(strtolower("+i+"))"),[n,t.FUNCTION_CALL]},text_charAt:function(e,i){const n=e.getFieldValue("WHERE")||"FROM_START",s=i.valueToCode(e,"VALUE",t.NONE)||"''";switch(n){case"FIRST":return["substr("+s+", 0, 1)",t.FUNCTION_CALL];case"LAST":return["substr("+s+", -1)",t.FUNCTION_CALL];case"FROM_START":return["substr("+s+", "+(e=i.getAdjusted(e,"AT"))+", 1)",t.FUNCTION_CALL];case"FROM_END":return["substr("+s+", "+(e=i.getAdjusted(e,"AT",1,!0))+", 1)",t.FUNCTION_CALL];case"RANDOM":return[i.provideFunction_("text_random_letter",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($text) {\n  return $text[rand(0, strlen($text) - 1)];\n}\n`)+"("+s+")",t.FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},text_count:function(e,i){const n=i.valueToCode(e,"TEXT",t.NONE)||"''";return["strlen("+(e=i.valueToCode(e,"SUB",t.NONE)||"''")+") === 0 ? strlen("+n+") + 1 : substr_count("+n+", "+e+")",t.CONDITIONAL]},text_getSubstring:function(e,i){const n=e.getFieldValue("WHERE1"),s=e.getFieldValue("WHERE2"),o=i.valueToCode(e,"STRING",t.NONE)||"''";if("FIRST"===n&&"LAST"===s)return[o,t.NONE];const r=i.getAdjusted(e,"AT1");return e=i.getAdjusted(e,"AT2"),[i.provideFunction_("text_get_substring",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($text, $where1, $at1, $where2, $at2) {\n  if ($where1 == 'FROM_END') {\n    $at1 = strlen($text) - 1 - $at1;\n  } else if ($where1 == 'FIRST') {\n    $at1 = 0;\n  } else if ($where1 != 'FROM_START') {\n    throw new Exception('Unhandled option (text_get_substring).');\n  }\n  $length = 0;\n  if ($where2 == 'FROM_START') {\n    $length = $at2 - $at1 + 1;\n  } else if ($where2 == 'FROM_END') {\n    $length = strlen($text) - $at1 - $at2;\n  } else if ($where2 == 'LAST') {\n    $length = strlen($text) - $at1;\n  } else {\n    throw new Exception('Unhandled option (text_get_substring).');\n  }\n  return substr($text, $at1, $length);\n}\n`)+"("+o+", '"+n+"', "+r+", '"+s+"', "+e+")",t.FUNCTION_CALL]},text_indexOf:function(e,i){const n="FIRST"===e.getFieldValue("END")?"strpos":"strrpos",s=i.valueToCode(e,"FIND",t.NONE)||"''",o=i.valueToCode(e,"VALUE",t.NONE)||"''";let r=" -1",a="";return e.workspace.options.oneBasedIndex&&(r=" 0",a=" + 1"),[i.provideFunction_("FIRST"===e.getFieldValue("END")?"text_indexOf":"text_lastIndexOf",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($text, $search) {\n  $pos = ${n}($text, $search);\n  return $pos === false ? ${r} : $pos${a};\n}\n`)+"("+o+", "+s+")",t.FUNCTION_CALL]},text_isEmpty:function(e,i){return["empty("+(i.valueToCode(e,"VALUE",t.NONE)||"''")+")",t.FUNCTION_CALL]},text_join:function(e,i){if(0===e.itemCount_)return["''",t.ATOMIC];if(1===e.itemCount_)return[i.valueToCode(e,"ADD0",t.NONE)||"''",t.NONE];if(2===e.itemCount_){var n=i.valueToCode(e,"ADD0",t.STRING_CONCAT)||"''";return[n+" . "+(e=i.valueToCode(e,"ADD1",t.STRING_CONCAT)||"''"),t.STRING_CONCAT]}n=Array(e.itemCount_);for(let s=0;s<e.itemCount_;s++)n[s]=i.valueToCode(e,"ADD"+s,t.NONE)||"''";return["implode('', array("+n.join(",")+"))",t.FUNCTION_CALL]},text_length:function(e,i){return[i.provideFunction_("length",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}($value) {\n  if (is_string($value)) {\n    return strlen($value);\n  }\n  return count($value);\n}\n`)+"("+(e=i.valueToCode(e,"VALUE",t.NONE)||"''")+")",t.FUNCTION_CALL]},text_print:function(e,i){return"print("+(i.valueToCode(e,"TEXT",t.NONE)||"''")+");\n"}};T.text_prompt=l,T.text_prompt_ext=l,T.text_replace=function(e,i){const n=i.valueToCode(e,"TEXT",t.NONE)||"''";return["str_replace("+(i.valueToCode(e,"FROM",t.NONE)||"''")+", "+(e=i.valueToCode(e,"TO",t.NONE)||"''")+", "+n+")",t.FUNCTION_CALL]},T.text_reverse=function(e,i){return["strrev("+(i.valueToCode(e,"TEXT",t.NONE)||"''")+")",t.FUNCTION_CALL]},T.text_trim=function(e,i){return[{LEFT:"ltrim",RIGHT:"rtrim",BOTH:"trim"}[e.getFieldValue("MODE")]+"("+(e=i.valueToCode(e,"TEXT",t.NONE)||"''")+")",t.FUNCTION_CALL]};var E={};E.variables_get=c,E.variables_set=u;var b={};b.variables_get_dynamic=c,b.variables_set_dynamic=u;var I=new h,y=Object.assign({},p,g,m,f,_,T,E,b);for(const e in y)I.forBlock[e]=y[e];var v={};return v.Order=t,v.PhpGenerator=h,v.phpGenerator=I,v.__namespace__=n,v},"function"==typeof define&&define.amd?define(["./blockly_compressed.js"],s):"object"==typeof i?t.exports=s(e("./blockly_compressed.js")):(n.php=s(n.Blockly),n.Blockly.PHP=n.php.phpGenerator)},{"./blockly_compressed.js":201}],215:[function(e,t,i){t.exports=e("./python_compressed.js")},{"./python_compressed.js":216}],216:[function(e,t,i){var n,s;n=this,s=function(e){var t,i,n=e.__namespace__,s=function(e,i){let n,s,o=0,r="";i.STATEMENT_PREFIX&&(r+=i.injectId(i.STATEMENT_PREFIX,e));do{s=i.valueToCode(e,"IF"+o,t.NONE)||"False",n=i.statementToCode(e,"DO"+o)||i.PASS,i.STATEMENT_SUFFIX&&(n=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+n),r+=(0===o?"if ":"elif ")+s+":\n"+n,o++}while(e.getInput("IF"+o));return(e.getInput("ELSE")||i.STATEMENT_SUFFIX)&&(n=i.statementToCode(e,"ELSE")||i.PASS,i.STATEMENT_SUFFIX&&(n=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+n),r+="else:\n"+n),r},o=function(e,i){let s;s=e.getField("TIMES")?String(parseInt(e.getFieldValue("TIMES"),10)):i.valueToCode(e,"TIMES",t.NONE)||"0",s=n.isNumber$$module$build$src$core$utils$string(s)?parseInt(s,10):"int("+s+")";let o=i.statementToCode(e,"DO");return o=i.addLoopTrap(o,e)||i.PASS,"for "+i.nameDB_.getDistinctName("count",n.NameType$$module$build$src$core$names.VARIABLE)+" in range("+s+"):\n"+o},r=function(e,i){const n=e.getFieldValue("OP");let s;if("NEG"===n)return["-"+(s=i.valueToCode(e,"NUM",t.UNARY_SIGN)||"0"),t.UNARY_SIGN];switch(i.definitions_.import_math="import math",e="SIN"===n||"COS"===n||"TAN"===n?i.valueToCode(e,"NUM",t.MULTIPLICATIVE)||"0":i.valueToCode(e,"NUM",t.NONE)||"0",n){case"ABS":s="math.fabs("+e+")";break;case"ROOT":s="math.sqrt("+e+")";break;case"LN":s="math.log("+e+")";break;case"LOG10":s="math.log10("+e+")";break;case"EXP":s="math.exp("+e+")";break;case"POW10":s="math.pow(10,"+e+")";break;case"ROUND":s="round("+e+")";break;case"ROUNDUP":s="math.ceil("+e+")";break;case"ROUNDDOWN":s="math.floor("+e+")";break;case"SIN":s="math.sin("+e+" / 180.0 * math.pi)";break;case"COS":s="math.cos("+e+" / 180.0 * math.pi)";break;case"TAN":s="math.tan("+e+" / 180.0 * math.pi)"}if(s)return[s,t.FUNCTION_CALL];switch(n){case"ASIN":s="math.asin("+e+") / math.pi * 180";break;case"ACOS":s="math.acos("+e+") / math.pi * 180";break;case"ATAN":s="math.atan("+e+") / math.pi * 180";break;default:throw Error("Unknown math operator: "+n)}return[s,t.MULTIPLICATIVE]},a=function(e,i){var s=[],o=e.workspace,r=n.allUsedVarModels$$module$build$src$core$variables(o)||[];for(var a of r)r=a.name,e.getVars().includes(r)||s.push(i.getVariableName(r));for(o=n.allDeveloperVariables$$module$build$src$core$variables(o),a=0;a<o.length;a++)s.push(i.nameDB_.getName(o[a],n.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));o=s.length?i.INDENT+"global "+s.join(", ")+"\n":"",s=i.getProcedureName(e.getFieldValue("NAME")),a="",i.STATEMENT_PREFIX&&(a+=i.injectId(i.STATEMENT_PREFIX,e)),i.STATEMENT_SUFFIX&&(a+=i.injectId(i.STATEMENT_SUFFIX,e)),a&&(a=i.prefixLines(a,i.INDENT)),r="",i.INFINITE_LOOP_TRAP&&(r=i.prefixLines(i.injectId(i.INFINITE_LOOP_TRAP,e),i.INDENT));let l="";e.getInput("STACK")&&(l=i.statementToCode(e,"STACK"));let c="";e.getInput("RETURN")&&(c=i.valueToCode(e,"RETURN",t.NONE)||"");let u="";l&&c&&(u=a),c?c=i.INDENT+"return "+c+"\n":l||(l=i.PASS);const h=[],d=e.getVars();for(let e=0;e<d.length;e++)h[e]=i.getVariableName(d[e]);return o="def "+s+"("+h.join(", ")+"):\n"+o+a+r+l+u+c,o=i.scrub_(e,o),i.definitions_["%"+s]=o,null},l=function(e,i){var n=i.provideFunction_("text_prompt",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(msg):\n  try:\n    return raw_input(msg)\n  except NameError:\n    return input(msg)\n`);return n=n+"("+(i=e.getField("TEXT")?i.quote_(e.getFieldValue("TEXT")):i.valueToCode(e,"TEXT",t.NONE)||"''")+")","NUMBER"===e.getFieldValue("TYPE")&&(n="float("+n+")"),[n,t.FUNCTION_CALL]},c=function(e,i){return[i.getVariableName(e.getFieldValue("VAR")),t.ATOMIC]},u=function(e,i){const n=i.valueToCode(e,"VALUE",t.NONE)||"0";return i.getVariableName(e.getFieldValue("VAR"))+" = "+n+"\n"};(i=t||(t={}))[i.ATOMIC=0]="ATOMIC",i[i.COLLECTION=1]="COLLECTION",i[i.STRING_CONVERSION=1]="STRING_CONVERSION",i[i.MEMBER=2.1]="MEMBER",i[i.FUNCTION_CALL=2.2]="FUNCTION_CALL",i[i.EXPONENTIATION=3]="EXPONENTIATION",i[i.UNARY_SIGN=4]="UNARY_SIGN",i[i.BITWISE_NOT=4]="BITWISE_NOT",i[i.MULTIPLICATIVE=5]="MULTIPLICATIVE",i[i.ADDITIVE=6]="ADDITIVE",i[i.BITWISE_SHIFT=7]="BITWISE_SHIFT",i[i.BITWISE_AND=8]="BITWISE_AND",i[i.BITWISE_XOR=9]="BITWISE_XOR",i[i.BITWISE_OR=10]="BITWISE_OR",i[i.RELATIONAL=11]="RELATIONAL",i[i.LOGICAL_NOT=12]="LOGICAL_NOT",i[i.LOGICAL_AND=13]="LOGICAL_AND",i[i.LOGICAL_OR=14]="LOGICAL_OR",i[i.CONDITIONAL=15]="CONDITIONAL",i[i.LAMBDA=16]="LAMBDA",i[i.NONE=99]="NONE";var h=class extends n.CodeGenerator$$module$build$src$core$generator{constructor(e="Python"){super(e),this.ORDER_OVERRIDES=[[t.FUNCTION_CALL,t.MEMBER],[t.FUNCTION_CALL,t.FUNCTION_CALL],[t.MEMBER,t.MEMBER],[t.MEMBER,t.FUNCTION_CALL],[t.LOGICAL_NOT,t.LOGICAL_NOT],[t.LOGICAL_AND,t.LOGICAL_AND],[t.LOGICAL_OR,t.LOGICAL_OR]],this.PASS="",this.isInitialized=!1;for(const i in t)"string"!=typeof(e=t[i])&&(this["ORDER_"+i]=e);this.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip")}init(e){super.init(e),this.PASS=this.INDENT+"pass\n",this.nameDB_?this.nameDB_.reset():this.nameDB_=new n.Names$$module$build$src$core$names(this.RESERVED_WORDS_),this.nameDB_.setVariableMap(e.getVariableMap()),this.nameDB_.populateVariables(e),this.nameDB_.populateProcedures(e);const t=[];var i=n.allDeveloperVariables$$module$build$src$core$variables(e);for(let e=0;e<i.length;e++)t.push(this.nameDB_.getName(i[e],n.Names$$module$build$src$core$names.DEVELOPER_VARIABLE_TYPE)+" = None");for(e=n.allUsedVarModels$$module$build$src$core$variables(e),i=0;i<e.length;i++)t.push(this.getVariableName(e[i].getId())+" = None");this.definitions_.variables=t.join("\n"),this.isInitialized=!0}finish(e){const t=[],i=[];for(let e in this.definitions_){const n=this.definitions_[e];n.match(/^(from\s+\S+\s+)?import\s+\S+/)?t.push(n):i.push(n)}return e=super.finish(e),this.isInitialized=!1,this.nameDB_.reset(),(t.join("\n")+"\n\n"+i.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+e}scrubNakedValue(e){return e+"\n"}quote_(e){let t="'";return(e=e.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n")).includes("'")&&(e.includes('"')?e=e.replace(/'/g,"\\'"):t='"'),t+e+t}multiline_quote_(e){return e.split(/\n/g).map(this.quote_).join(" + '\\n' + \n")}scrub_(e,t,i=!1){let s="";if(!e.outputConnection||!e.outputConnection.targetConnection){var o=e.getCommentText();o&&(o=n.wrap$$module$build$src$core$utils$string(o,this.COMMENT_WRAP-3),s+=this.prefixLines(o+"\n","# "));for(let t=0;t<e.inputList.length;t++)e.inputList[t].type===n.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&(o=e.inputList[t].connection.targetBlock())&&(o=this.allNestedComments(o))&&(s+=this.prefixLines(o,"# "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),s+t+(i?"":this.blockToCode(e))}getAdjustedInt(e,i,s=0,o=!1){e.workspace.options.oneBasedIndex&&s--;const r=e.workspace.options.oneBasedIndex?"1":"0";return e=this.valueToCode(e,i,s?t.ADDITIVE:t.NONE)||r,n.isNumber$$module$build$src$core$utils$string(e)?(e=parseInt(e,10)+s,o&&(e=-e)):(e=0<s?"int("+e+" + "+s+")":0>s?"int("+e+" - "+-s+")":"int("+e+")",o&&(e="-"+e)),e}},d={};d.Order=t,d.PythonGenerator=h;var p={lists_create_empty:function(e,i){return["[]",t.ATOMIC]},lists_create_with:function(e,i){const n=Array(e.itemCount_);for(let s=0;s<e.itemCount_;s++)n[s]=i.valueToCode(e,"ADD"+s,t.NONE)||"None";return["["+n.join(", ")+"]",t.ATOMIC]},lists_getIndex:function(e,i){const n=e.getFieldValue("MODE")||"GET",s=e.getFieldValue("WHERE")||"FROM_START";var o=i.valueToCode(e,"VALUE","RANDOM"===s?t.NONE:t.MEMBER)||"[]";switch(s){case"FIRST":if("GET"===n)return[o+"[0]",t.MEMBER];if("GET_REMOVE"===n)return[o+".pop(0)",t.FUNCTION_CALL];if("REMOVE"===n)return o+".pop(0)\n";break;case"LAST":if("GET"===n)return[o+"[-1]",t.MEMBER];if("GET_REMOVE"===n)return[o+".pop()",t.FUNCTION_CALL];if("REMOVE"===n)return o+".pop()\n";break;case"FROM_START":if(e=i.getAdjustedInt(e,"AT"),"GET"===n)return[o+"["+e+"]",t.MEMBER];if("GET_REMOVE"===n)return[o+".pop("+e+")",t.FUNCTION_CALL];if("REMOVE"===n)return o+".pop("+e+")\n";break;case"FROM_END":if(e=i.getAdjustedInt(e,"AT",1,!0),"GET"===n)return[o+"["+e+"]",t.MEMBER];if("GET_REMOVE"===n)return[o+".pop("+e+")",t.FUNCTION_CALL];if("REMOVE"===n)return o+".pop("+e+")\n";break;case"RANDOM":if(i.definitions_.import_random="import random","GET"===n)return["random.choice("+o+")",t.FUNCTION_CALL];if(o=i.provideFunction_("lists_remove_random_item",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(myList):\n  x = int(random.random() * len(myList))\n  return myList.pop(x)\n`)+"("+o+")","GET_REMOVE"===n)return[o,t.FUNCTION_CALL];if("REMOVE"===n)return o+"\n"}throw Error("Unhandled combination (lists_getIndex).")},lists_getSublist:function(e,i){const s=i.valueToCode(e,"LIST",t.MEMBER)||"[]";var o=e.getFieldValue("WHERE1");const r=e.getFieldValue("WHERE2");switch(o){case"FROM_START":0===(o=i.getAdjustedInt(e,"AT1"))&&(o="");break;case"FROM_END":o=i.getAdjustedInt(e,"AT1",1,!0);break;case"FIRST":o="";break;default:throw Error("Unhandled option (lists_getSublist)")}switch(r){case"FROM_START":e=i.getAdjustedInt(e,"AT2",1);break;case"FROM_END":e=i.getAdjustedInt(e,"AT2",0,!0),n.isNumber$$module$build$src$core$utils$string(String(e))?0===e&&(e=""):(i.definitions_.import_sys="import sys",e+=" or sys.maxsize");break;case"LAST":e="";break;default:throw Error("Unhandled option (lists_getSublist)")}return[s+"["+o+" : "+e+"]",t.MEMBER]},lists_indexOf:function(e,i){const n=i.valueToCode(e,"FIND",t.NONE)||"[]",s=i.valueToCode(e,"VALUE",t.NONE)||"''";let o=" -1",r="",a=" - 1";return e.workspace.options.oneBasedIndex&&(o=" 0",r=" + 1",a=""),[("FIRST"===e.getFieldValue("END")?i.provideFunction_("first_index",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(my_list, elem):\n  try: index = my_list.index(elem)${r}\n  except: index =${o}\n  return index\n`):i.provideFunction_("last_index",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(my_list, elem):\n  try: index = len(my_list) - my_list[::-1].index(elem)${a}\n  except: index =${o}\n  return index\n`))+"("+s+", "+n+")",t.FUNCTION_CALL]},lists_isEmpty:function(e,i){return["not len("+(i.valueToCode(e,"VALUE",t.NONE)||"[]")+")",t.LOGICAL_NOT]},lists_length:function(e,i){return["len("+(i.valueToCode(e,"VALUE",t.NONE)||"[]")+")",t.FUNCTION_CALL]},lists_repeat:function(e,i){return["["+(i.valueToCode(e,"ITEM",t.NONE)||"None")+"] * "+(e=i.valueToCode(e,"NUM",t.MULTIPLICATIVE)||"0"),t.MULTIPLICATIVE]},lists_reverse:function(e,i){return["list(reversed("+(i.valueToCode(e,"LIST",t.NONE)||"[]")+"))",t.FUNCTION_CALL]},lists_setIndex:function(e,i){let s=i.valueToCode(e,"LIST",t.MEMBER)||"[]";const o=e.getFieldValue("MODE")||"GET";var r=e.getFieldValue("WHERE")||"FROM_START";const a=i.valueToCode(e,"TO",t.NONE)||"None";switch(r){case"FIRST":if("SET"===o)return s+"[0] = "+a+"\n";if("INSERT"===o)return s+".insert(0, "+a+")\n";break;case"LAST":if("SET"===o)return s+"[-1] = "+a+"\n";if("INSERT"===o)return s+".append("+a+")\n";break;case"FROM_START":if(i=i.getAdjustedInt(e,"AT"),"SET"===o)return s+"["+i+"] = "+a+"\n";if("INSERT"===o)return s+".insert("+i+", "+a+")\n";break;case"FROM_END":if(i=i.getAdjustedInt(e,"AT",1,!0),"SET"===o)return s+"["+i+"] = "+a+"\n";if("INSERT"===o)return s+".insert("+i+", "+a+")\n";break;case"RANDOM":if(i.definitions_.import_random="import random",s.match(/^\w+$/)?e="":(r=(e=i.nameDB_.getDistinctName("tmp_list",n.NameType$$module$build$src$core$names.VARIABLE))+" = "+s+"\n",s=e,e=r),e+=(i=i.nameDB_.getDistinctName("tmp_x",n.NameType$$module$build$src$core$names.VARIABLE))+" = int(random.random() * len("+s+"))\n","SET"===o)return e+(s+"[")+i+"] = "+a+"\n";if("INSERT"===o)return e+(s+".insert(")+i+", "+a+")\n"}throw Error("Unhandled combination (lists_setIndex).")},lists_sort:function(e,i){const n=i.valueToCode(e,"LIST",t.NONE)||"[]",s=e.getFieldValue("TYPE");return e="1"===e.getFieldValue("DIRECTION")?"False":"True",[i.provideFunction_("lists_sort",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(my_list, type, reverse):\n  def try_float(s):\n    try:\n      return float(s)\n    except:\n      return 0\n  key_funcs = {\n    "NUMERIC": try_float,\n    "TEXT": str,\n    "IGNORE_CASE": lambda s: str(s).lower()\n  }\n  key_func = key_funcs[type]\n  list_cpy = list(my_list)\n  return sorted(list_cpy, key=key_func, reverse=reverse)\n`)+"("+n+', "'+s+'", '+e+")",t.FUNCTION_CALL]},lists_split:function(e,i){var n=e.getFieldValue("MODE");if("SPLIT"===n)e=(n=i.valueToCode(e,"INPUT",t.MEMBER)||"''")+".split("+(e=i.valueToCode(e,"DELIM",t.NONE))+")";else{if("JOIN"!==n)throw Error("Unknown mode: "+n);n=i.valueToCode(e,"INPUT",t.NONE)||"[]",e=(i.valueToCode(e,"DELIM",t.MEMBER)||"''")+".join("+n+")"}return[e,t.FUNCTION_CALL]}},g={};g.controls_if=s,g.controls_ifelse=s,g.logic_boolean=function(e,i){return["TRUE"===e.getFieldValue("BOOL")?"True":"False",t.ATOMIC]},g.logic_compare=function(e,i){const n={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],s=t.RELATIONAL;return[(i.valueToCode(e,"A",s)||"0")+" "+n+" "+(e=i.valueToCode(e,"B",s)||"0"),s]},g.logic_negate=function(e,i){return["not "+(i.valueToCode(e,"BOOL",t.LOGICAL_NOT)||"True"),t.LOGICAL_NOT]},g.logic_null=function(e,i){return["None",t.ATOMIC]},g.logic_operation=function(e,i){const n="AND"===e.getFieldValue("OP")?"and":"or",s="and"===n?t.LOGICAL_AND:t.LOGICAL_OR;let o=i.valueToCode(e,"A",s);return e=i.valueToCode(e,"B",s),o||e?(i="and"===n?"True":"False",o||(o=i),e||(e=i)):e=o="False",[o+" "+n+" "+e,s]},g.logic_ternary=function(e,i){const n=i.valueToCode(e,"IF",t.CONDITIONAL)||"False";return[(i.valueToCode(e,"THEN",t.CONDITIONAL)||"None")+" if "+n+" else "+(e=i.valueToCode(e,"ELSE",t.CONDITIONAL)||"None"),t.CONDITIONAL]};var m={controls_flow_statements:function(e,t){let i="";if(t.STATEMENT_PREFIX&&(i+=t.injectId(t.STATEMENT_PREFIX,e)),t.STATEMENT_SUFFIX&&(i+=t.injectId(t.STATEMENT_SUFFIX,e)),t.STATEMENT_PREFIX){const n=e.getSurroundLoop();n&&!n.suppressPrefixSuffix&&(i+=t.injectId(t.STATEMENT_PREFIX,n))}switch(e.getFieldValue("FLOW")){case"BREAK":return i+"break\n";case"CONTINUE":return i+"continue\n"}throw Error("Unknown flow statement.")},controls_for:function(e,i){const s=i.getVariableName(e.getFieldValue("VAR"));var o=i.valueToCode(e,"FROM",t.NONE)||"0",r=i.valueToCode(e,"TO",t.NONE)||"0",a=i.valueToCode(e,"BY",t.NONE)||"1";let l=i.statementToCode(e,"DO");l=i.addLoopTrap(l,e)||i.PASS;let c="";e=function(){return i.provideFunction_("upRange",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(start, stop, step):\n  while start <= stop:\n    yield start\n    start += abs(step)\n`)};const u=function(){return i.provideFunction_("downRange",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(start, stop, step):\n  while start >= stop:\n    yield start\n    start -= abs(step)\n`)};if(n.isNumber$$module$build$src$core$utils$string(o)&&n.isNumber$$module$build$src$core$utils$string(r)&&n.isNumber$$module$build$src$core$utils$string(a))o=Number(o),r=Number(r),a=Math.abs(Number(a)),0==o%1&&0==r%1&&0==a%1?(o<=r?(r++,e=0===o&&1===a?r:o+", "+r,1!==a&&(e+=", "+a)):e=o+", "+--r+", -"+a,e="range("+e+")"):(e=o<r?e():u(),e+="("+o+", "+r+", "+a+")");else{const t=function(e,t){return n.isNumber$$module$build$src$core$utils$string(e)?e=String(Number(e)):e.match(/^\w+$/)||(t=i.nameDB_.getDistinctName(s+t,n.NameType$$module$build$src$core$names.VARIABLE),c+=t+" = "+e+"\n",e=t),e};o=t(o,"_start"),r=t(r,"_end"),a=t(a,"_inc"),"number"==typeof o&&"number"==typeof r?(e=o<r?e():u(),e+="("+o+", "+r+", "+a+")"):e="("+o+" <= "+r+") and "+e()+"("+o+", "+r+", "+a+") or "+u()+"("+o+", "+r+", "+a+")"}return c+="for "+s+" in "+e+":\n"+l},controls_forEach:function(e,i){const n=i.getVariableName(e.getFieldValue("VAR")),s=i.valueToCode(e,"LIST",t.RELATIONAL)||"[]";let o=i.statementToCode(e,"DO");return"for "+n+" in "+s+":\n"+(i.addLoopTrap(o,e)||i.PASS)}};m.controls_repeat=o,m.controls_repeat_ext=o,m.controls_whileUntil=function(e,i){const n="UNTIL"===e.getFieldValue("MODE");let s=i.valueToCode(e,"BOOL",n?t.LOGICAL_NOT:t.NONE)||"False",o=i.statementToCode(e,"DO");return n&&(s="not "+s),"while "+s+":\n"+(i.addLoopTrap(o,e)||i.PASS)};var f={math_arithmetic:function(e,i){var n={ADD:[" + ",t.ADDITIVE],MINUS:[" - ",t.ADDITIVE],MULTIPLY:[" * ",t.MULTIPLICATIVE],DIVIDE:[" / ",t.MULTIPLICATIVE],POWER:[" ** ",t.EXPONENTIATION]}[e.getFieldValue("OP")];const s=n[0];return n=n[1],[(i.valueToCode(e,"A",n)||"0")+s+(e=i.valueToCode(e,"B",n)||"0"),n]},math_atan2:function(e,i){i.definitions_.import_math="import math";const n=i.valueToCode(e,"X",t.NONE)||"0";return["math.atan2("+(i.valueToCode(e,"Y",t.NONE)||"0")+", "+n+") / math.pi * 180",t.MULTIPLICATIVE]},math_change:function(e,i){i.definitions_.from_numbers_import_Number="from numbers import Number";const n=i.valueToCode(e,"DELTA",t.ADDITIVE)||"0";return(e=i.getVariableName(e.getFieldValue("VAR")))+" = ("+e+" if isinstance("+e+", Number) else 0) + "+n+"\n"},math_constant:function(e,i){const n={PI:["math.pi",t.MEMBER],E:["math.e",t.MEMBER],GOLDEN_RATIO:["(1 + math.sqrt(5)) / 2",t.MULTIPLICATIVE],SQRT2:["math.sqrt(2)",t.MEMBER],SQRT1_2:["math.sqrt(1.0 / 2)",t.MEMBER],INFINITY:["float('inf')",t.ATOMIC]};return"INFINITY"!==(e=e.getFieldValue("CONSTANT"))&&(i.definitions_.import_math="import math"),n[e]},math_constrain:function(e,i){return["min(max("+(i.valueToCode(e,"VALUE",t.NONE)||"0")+", "+(i.valueToCode(e,"LOW",t.NONE)||"0")+"), "+(e=i.valueToCode(e,"HIGH",t.NONE)||"float('inf')")+")",t.FUNCTION_CALL]},math_modulo:function(e,i){return[(i.valueToCode(e,"DIVIDEND",t.MULTIPLICATIVE)||"0")+" % "+(e=i.valueToCode(e,"DIVISOR",t.MULTIPLICATIVE)||"0"),t.MULTIPLICATIVE]},math_number:function(e,i){return 1/0===(e=Number(e.getFieldValue("NUM")))?['float("inf")',t.FUNCTION_CALL]:-1/0===e?['-float("inf")',t.UNARY_SIGN]:[String(e),0>e?t.UNARY_SIGN:t.ATOMIC]},math_number_property:function(e,i){var n={EVEN:[" % 2 == 0",t.MULTIPLICATIVE,t.RELATIONAL],ODD:[" % 2 == 1",t.MULTIPLICATIVE,t.RELATIONAL],WHOLE:[" % 1 == 0",t.MULTIPLICATIVE,t.RELATIONAL],POSITIVE:[" > 0",t.RELATIONAL,t.RELATIONAL],NEGATIVE:[" < 0",t.RELATIONAL,t.RELATIONAL],DIVISIBLE_BY:[null,t.MULTIPLICATIVE,t.RELATIONAL],PRIME:[null,t.NONE,t.FUNCTION_CALL]};const s=e.getFieldValue("PROPERTY"),[o,r,a]=n[s];if(n=i.valueToCode(e,"NUMBER_TO_CHECK",r)||"0","PRIME"===s)i.definitions_.import_math="import math",i.definitions_.from_numbers_import_Number="from numbers import Number",e=i.provideFunction_("math_isPrime",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(n):\n  # https://en.wikipedia.org/wiki/Primality_test#Naive_methods\n  # If n is not a number but a string, try parsing it.\n  if not isinstance(n, Number):\n    try:\n      n = float(n)\n    except:\n      return False\n  if n == 2 or n == 3:\n    return True\n  # False if n is negative, is 1, or not whole, or if n is divisible by 2 or 3.\n  if n <= 1 or n % 1 != 0 or n % 2 == 0 or n % 3 == 0:\n    return False\n  # Check all the numbers of form 6k +/- 1, up to sqrt(n).\n  for x in range(6, int(math.sqrt(n)) + 2, 6):\n    if n % (x - 1) == 0 or n % (x + 1) == 0:\n      return False\n  return True\n`)+"("+n+")";else if("DIVISIBLE_BY"===s){if("0"===(e=i.valueToCode(e,"DIVISOR",t.MULTIPLICATIVE)||"0"))return["False",t.ATOMIC];e=n+" % "+e+" == 0"}else e=n+o;return[e,a]},math_on_list:function(e,i){const n=e.getFieldValue("OP");switch(e=i.valueToCode(e,"LIST",t.NONE)||"[]",n){case"SUM":i="sum("+e+")";break;case"MIN":i="min("+e+")";break;case"MAX":i="max("+e+")";break;case"AVERAGE":i.definitions_.from_numbers_import_Number="from numbers import Number",i=i.provideFunction_("math_mean",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(myList):\n  localList = [e for e in myList if isinstance(e, Number)]\n  if not localList: return\n  return float(sum(localList)) / len(localList)\n`)+"("+e+")";break;case"MEDIAN":i.definitions_.from_numbers_import_Number="from numbers import Number",i=i.provideFunction_("math_median",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(myList):\n  localList = sorted([e for e in myList if isinstance(e, Number)])\n  if not localList: return\n  if len(localList) % 2 == 0:\n    return (localList[len(localList) // 2 - 1] + localList[len(localList) // 2]) / 2.0\n  else:\n    return localList[(len(localList) - 1) // 2]\n`)+"("+e+")";break;case"MODE":i=i.provideFunction_("math_modes",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(some_list):\n  modes = []\n  # Using a lists of [item, count] to keep count rather than dict\n  # to avoid "unhashable" errors when the counted item is itself a list or dict.\n  counts = []\n  maxCount = 1\n  for item in some_list:\n    found = False\n    for count in counts:\n      if count[0] == item:\n        count[1] += 1\n        maxCount = max(maxCount, count[1])\n        found = True\n    if not found:\n      counts.append([item, 1])\n  for counted_item, item_count in counts:\n    if item_count == maxCount:\n      modes.append(counted_item)\n  return modes\n`)+"("+e+")";break;case"STD_DEV":i.definitions_.import_math="import math",i=i.provideFunction_("math_standard_deviation",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(numbers):\n  n = len(numbers)\n  if n == 0: return\n  mean = float(sum(numbers)) / n\n  variance = sum((x - mean) ** 2 for x in numbers) / n\n  return math.sqrt(variance)\n`)+"("+e+")";break;case"RANDOM":i.definitions_.import_random="import random",i="random.choice("+e+")";break;default:throw Error("Unknown operator: "+n)}return[i,t.FUNCTION_CALL]},math_random_float:function(e,i){return i.definitions_.import_random="import random",["random.random()",t.FUNCTION_CALL]},math_random_int:function(e,i){return i.definitions_.import_random="import random",["random.randint("+(i.valueToCode(e,"FROM",t.NONE)||"0")+", "+(e=i.valueToCode(e,"TO",t.NONE)||"0")+")",t.FUNCTION_CALL]}};f.math_round=r,f.math_single=r,f.math_trig=r;var _={procedures_callnoreturn:function(e,t){return t.forBlock.procedures_callreturn(e,t)[0]+"\n"},procedures_callreturn:function(e,i){const n=i.getProcedureName(e.getFieldValue("NAME")),s=[],o=e.getVars();for(let n=0;n<o.length;n++)s[n]=i.valueToCode(e,"ARG"+n,t.NONE)||"None";return[n+"("+s.join(", ")+")",t.FUNCTION_CALL]}};_.procedures_defnoreturn=a,_.procedures_defreturn=a,_.procedures_ifreturn=function(e,i){let n="if "+(i.valueToCode(e,"CONDITION",t.NONE)||"False")+":\n";return i.STATEMENT_SUFFIX&&(n+=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)),e.hasReturnValue_?(e=i.valueToCode(e,"VALUE",t.NONE)||"None",n+=i.INDENT+"return "+e+"\n"):n+=i.INDENT+"return\n",n};var T=/^\s*'([^']|\\')*'\s*$/,E=function(e){return T.test(e)?[e,t.ATOMIC]:["str("+e+")",t.FUNCTION_CALL]},b={text:function(e,i){return[i.quote_(e.getFieldValue("TEXT")),t.ATOMIC]},text_append:function(e,i){const n=i.getVariableName(e.getFieldValue("VAR"));return e=i.valueToCode(e,"TEXT",t.NONE)||"''",n+" = str("+n+") + "+E(e)[0]+"\n"},text_changeCase:function(e,i){const n={UPPERCASE:".upper()",LOWERCASE:".lower()",TITLECASE:".title()"}[e.getFieldValue("CASE")];return[(i.valueToCode(e,"TEXT",t.MEMBER)||"''")+n,t.FUNCTION_CALL]},text_charAt:function(e,i){const n=e.getFieldValue("WHERE")||"FROM_START",s=i.valueToCode(e,"VALUE","RANDOM"===n?t.NONE:t.MEMBER)||"''";switch(n){case"FIRST":return[s+"[0]",t.MEMBER];case"LAST":return[s+"[-1]",t.MEMBER];case"FROM_START":return[s+"["+(e=i.getAdjustedInt(e,"AT"))+"]",t.MEMBER];case"FROM_END":return[s+"["+(e=i.getAdjustedInt(e,"AT",1,!0))+"]",t.MEMBER];case"RANDOM":return i.definitions_.import_random="import random",[i.provideFunction_("text_random_letter",`\ndef ${i.FUNCTION_NAME_PLACEHOLDER_}(text):\n  x = int(random.random() * len(text))\n  return text[x]\n`)+"("+s+")",t.FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},text_count:function(e,i){return[(i.valueToCode(e,"TEXT",t.MEMBER)||"''")+".count("+(e=i.valueToCode(e,"SUB",t.NONE)||"''")+")",t.FUNCTION_CALL]},text_getSubstring:function(e,i){var s=e.getFieldValue("WHERE1");const o=e.getFieldValue("WHERE2"),r=i.valueToCode(e,"STRING",t.MEMBER)||"''";switch(s){case"FROM_START":0===(s=i.getAdjustedInt(e,"AT1"))&&(s="");break;case"FROM_END":s=i.getAdjustedInt(e,"AT1",1,!0);break;case"FIRST":s="";break;default:throw Error("Unhandled option (text_getSubstring)")}switch(o){case"FROM_START":e=i.getAdjustedInt(e,"AT2",1);break;case"FROM_END":e=i.getAdjustedInt(e,"AT2",0,!0),n.isNumber$$module$build$src$core$utils$string(String(e))?0===e&&(e=""):(i.definitions_.import_sys="import sys",e+=" or sys.maxsize");break;case"LAST":e="";break;default:throw Error("Unhandled option (text_getSubstring)")}return[r+"["+s+" : "+e+"]",t.MEMBER]},text_indexOf:function(e,i){const n="FIRST"===e.getFieldValue("END")?"find":"rfind",s=i.valueToCode(e,"FIND",t.NONE)||"''";return i=(i.valueToCode(e,"VALUE",t.MEMBER)||"''")+"."+n+"("+s+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.ADDITIVE]:[i,t.FUNCTION_CALL]},text_isEmpty:function(e,i){return["not len("+(i.valueToCode(e,"VALUE",t.NONE)||"''")+")",t.LOGICAL_NOT]},text_join:function(e,i){switch(e.itemCount_){case 0:return["''",t.ATOMIC];case 1:return e=i.valueToCode(e,"ADD0",t.NONE)||"''",E(e);case 2:var s=i.valueToCode(e,"ADD0",t.NONE)||"''";return e=i.valueToCode(e,"ADD1",t.NONE)||"''",[E(s)[0]+" + "+E(e)[0],t.ADDITIVE];default:s=[];for(let n=0;n<e.itemCount_;n++)s[n]=i.valueToCode(e,"ADD"+n,t.NONE)||"''";return["''.join([str("+(e=i.nameDB_.getDistinctName("x",n.NameType$$module$build$src$core$names.VARIABLE))+") for "+e+" in ["+s.join(", ")+"]])",t.FUNCTION_CALL]}},text_length:function(e,i){return["len("+(i.valueToCode(e,"VALUE",t.NONE)||"''")+")",t.FUNCTION_CALL]},text_print:function(e,i){return"print("+(i.valueToCode(e,"TEXT",t.NONE)||"''")+")\n"}};b.text_prompt=l,b.text_prompt_ext=l,b.text_replace=function(e,i){return[(i.valueToCode(e,"TEXT",t.MEMBER)||"''")+".replace("+(i.valueToCode(e,"FROM",t.NONE)||"''")+", "+(e=i.valueToCode(e,"TO",t.NONE)||"''")+")",t.MEMBER]},b.text_reverse=function(e,i){return[(i.valueToCode(e,"TEXT",t.MEMBER)||"''")+"[::-1]",t.MEMBER]},b.text_trim=function(e,i){const n={LEFT:".lstrip()",RIGHT:".rstrip()",BOTH:".strip()"}[e.getFieldValue("MODE")];return[(i.valueToCode(e,"TEXT",t.MEMBER)||"''")+n,t.FUNCTION_CALL]};var I={};I.variables_get=c,I.variables_set=u;var y={};y.variables_get_dynamic=c,y.variables_set_dynamic=u;var v=new h;v.addReservedWords("math,random,Number");var C=Object.assign({},p,g,m,f,_,b,I,y);for(const e in C)v.forBlock[e]=C[e];var k={};return k.Order=t,k.PythonGenerator=h,k.pythonGenerator=v,k.__namespace__=n,k},"function"==typeof define&&define.amd?define(["./blockly_compressed.js"],s):"object"==typeof i?t.exports=s(e("./blockly_compressed.js")):(n.python=s(n.Blockly),n.Blockly.Python=n.python.pythonGenerator)},{"./blockly_compressed.js":201}],217:[function(e,t,i){"use strict";var n=e("react-is"),s={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return n.isMemo(e)?r:a[e.$$typeof]||s}a[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[n.Memo]=r;var c=Object.defineProperty,u=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,g=Object.prototype;t.exports=function e(t,i,n){if("string"!=typeof i){if(g){var s=p(i);s&&s!==g&&e(t,s,n)}var r=u(i);h&&(r=r.concat(h(i)));for(var a=l(t),m=l(i),f=0;f<r.length;++f){var _=r[f];if(!(o[_]||n&&n[_]||m&&m[_]||a&&a[_])){var T=d(i,_);try{c(t,_,T)}catch(t){}}}}return t}},{"react-is":225}],218:[function(e,t,i){"use strict";var n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function r(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var i,a,l=r(e),c=1;c<arguments.length;c++){for(var u in i=Object(arguments[c]))s.call(i,u)&&(l[u]=i[u]);if(n){a=n(i);for(var h=0;h<a.length;h++)o.call(i,a[h])&&(l[a[h]]=i[a[h]])}}return l}},{}],219:[function(e,t,i){"use strict";var n=e("./lib/ReactPropTypesSecret");function s(){}function o(){}o.resetWarningCache=s,t.exports=function(){function e(e,t,i,s,o,r){if(r!==n){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:s};return i.PropTypes=i,i}},{"./lib/ReactPropTypesSecret":221}],220:[function(e,t,i){t.exports=e("./factoryWithThrowingShims")()},{"./factoryWithThrowingShims":219}],221:[function(e,t,i){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}],222:[function(e,t,i){"use strict";var n=e("react"),s=e("object-assign"),o=e("scheduler");function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!n)throw Error(r(227));var a=new Set,l={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(l[e]=t,e=0;e<t.length;e++)a.add(t[e])}var h=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p=Object.prototype.hasOwnProperty,g={},m={};function f(e,t,i,n,s,o,r){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=r}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){_[e]=new f(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];_[t]=new f(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){_[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){_[e]=new f(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){_[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){_[e]=new f(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){_[e]=new f(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){_[e]=new f(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){_[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)}));var T=/[\-:]([a-z])/g;function E(e){return e[1].toUpperCase()}function b(e,t,i,n){var s=_.hasOwnProperty(t)?_[t]:null;(null!==s?0===s.type:!n&&2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1]))||(function(e,t,i,n){if(null==t||function(e,t,i,n){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,n))return!0;if(n)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,s,n)&&(i=null),n||null===s?function(e){return!!p.call(m,e)||!p.call(g,e)&&(d.test(e)?m[e]=!0:(g[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):s.mustUseProperty?e[s.propertyName]=null===i?3!==s.type&&"":i:(t=s.attributeName,n=s.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(s=s.type)||4===s&&!0===i?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(T,E);_[t]=new f(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(T,E);_[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(T,E);_[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){_[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)})),_.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){_[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)}));var I=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,y=60103,v=60106,C=60107,k=60108,O=60114,N=60109,A=60110,S=60112,R=60113,w=60120,L=60115,x=60116,$=60121,D=60128,M=60129,P=60130,B=60131;if("function"==typeof Symbol&&Symbol.for){var F=Symbol.for;y=F("react.element"),v=F("react.portal"),C=F("react.fragment"),k=F("react.strict_mode"),O=F("react.profiler"),N=F("react.provider"),A=F("react.context"),S=F("react.forward_ref"),R=F("react.suspense"),w=F("react.suspense_list"),L=F("react.memo"),x=F("react.lazy"),$=F("react.block"),F("react.scope"),D=F("react.opaque.id"),M=F("react.debug_trace_mode"),P=F("react.offscreen"),B=F("react.legacy_hidden")}var U,H="function"==typeof Symbol&&Symbol.iterator;function G(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=H&&e[H]||e["@@iterator"])?e:null}function V(e){if(void 0===U)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);U=t&&t[1]||""}return"\n"+U+e}var j=!1;function W(e,t){if(!e||j)return"";j=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var n=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){n=e}e.call(t.prototype)}else{try{throw Error()}catch(e){n=e}e()}}catch(e){if(e&&n&&"string"==typeof e.stack){for(var s=e.stack.split("\n"),o=n.stack.split("\n"),r=s.length-1,a=o.length-1;1<=r&&0<=a&&s[r]!==o[a];)a--;for(;1<=r&&0<=a;r--,a--)if(s[r]!==o[a]){if(1!==r||1!==a)do{if(r--,0>--a||s[r]!==o[a])return"\n"+s[r].replace(" at new "," at ")}while(1<=r&&0<=a);break}}}finally{j=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?V(e):""}function X(e){switch(e.tag){case 5:return V(e.type);case 16:return V("Lazy");case 13:return V("Suspense");case 19:return V("SuspenseList");case 0:case 2:case 15:return W(e.type,!1);case 11:return W(e.type.render,!1);case 22:return W(e.type._render,!1);case 1:return W(e.type,!0);default:return""}}function Y(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case C:return"Fragment";case v:return"Portal";case O:return"Profiler";case k:return"StrictMode";case R:return"Suspense";case w:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case N:return(e._context.displayName||"Context")+".Provider";case S:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case L:return Y(e.type);case $:return Y(e._render);case x:t=e._payload,e=e._init;try{return Y(e(t))}catch(e){}}return null}function z(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==i&&"function"==typeof i.get&&"function"==typeof i.set){var s=i.get,o=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=K(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function Z(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var i=t.checked;return s({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function ee(e,t){var i=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;i=z(null!=t.value?t.value:i),e._wrapperState={initialChecked:n,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function ie(e,t){te(e,t);var i=z(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?se(e,t.type,i):t.hasOwnProperty("defaultValue")&&se(e,t.type,z(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ne(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function se(e,t,i){"number"===t&&Z(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}function oe(e,t){return e=s({children:void 0},t),(t=function(e){var t="";return n.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function re(e,t,i,n){if(e=e.options,t){t={};for(var s=0;s<i.length;s++)t["$"+i[s]]=!0;for(i=0;i<e.length;i++)s=t.hasOwnProperty("$"+e[i].value),e[i].selected!==s&&(e[i].selected=s),s&&n&&(e[i].defaultSelected=!0)}else{for(i=""+z(i),t=null,s=0;s<e.length;s++){if(e[s].value===i)return e[s].selected=!0,void(n&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function ae(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(r(91));return s({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function le(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(r(92));if(Array.isArray(i)){if(!(1>=i.length))throw Error(r(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:z(i)}}function ce(e,t){var i=z(t.value),n=z(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=n&&(e.defaultValue=""+n)}function ue(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var he="http://www.w3.org/1999/xhtml",de="http://www.w3.org/2000/svg";function pe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ge(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?pe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var me,fe,_e=(fe=function(e,t){if(e.namespaceURI!==de||"innerHTML"in e)e.innerHTML=t;else{for((me=me||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=me.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,n){MSApp.execUnsafeLocalFunction((function(){return fe(e,t)}))}:fe);function Te(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var Ee={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},be=["Webkit","ms","Moz","O"];function Ie(e,t,i){return null==t||"boolean"==typeof t||""===t?"":i||"number"!=typeof t||0===t||Ee.hasOwnProperty(e)&&Ee[e]?(""+t).trim():t+"px"}function ye(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var n=0===i.indexOf("--"),s=Ie(i,t[i],n);"float"===i&&(i="cssFloat"),n?e.setProperty(i,s):e[i]=s}}Object.keys(Ee).forEach((function(e){be.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ee[t]=Ee[e]}))}));var ve=s({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ce(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(r(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(r(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(r(62))}}function ke(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Oe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ne=null,Ae=null,Se=null;function Re(e){if(e=es(e)){if("function"!=typeof Ne)throw Error(r(280));var t=e.stateNode;t&&(t=is(t),Ne(e.stateNode,e.type,t))}}function we(e){Ae?Se?Se.push(e):Se=[e]:Ae=e}function Le(){if(Ae){var e=Ae,t=Se;if(Se=Ae=null,Re(e),t)for(e=0;e<t.length;e++)Re(t[e])}}function xe(e,t){return e(t)}function $e(e,t,i,n,s){return e(t,i,n,s)}function De(){}var Me=xe,Pe=!1,Be=!1;function Fe(){null===Ae&&null===Se||(De(),Le())}function Ue(e,t){var i=e.stateNode;if(null===i)return null;var n=is(i);if(null===n)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(i&&"function"!=typeof i)throw Error(r(231,t,typeof i));return i}var He=!1;if(h)try{var Ge={};Object.defineProperty(Ge,"passive",{get:function(){He=!0}}),window.addEventListener("test",Ge,Ge),window.removeEventListener("test",Ge,Ge)}catch(fe){He=!1}function Ve(e,t,i,n,s,o,r,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(e){this.onError(e)}}var je=!1,We=null,Xe=!1,Ye=null,ze={onError:function(e){je=!0,We=e}};function Ke(e,t,i,n,s,o,r,a,l){je=!1,We=null,Ve.apply(ze,arguments)}function qe(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function Je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Ze(e){if(qe(e)!==e)throw Error(r(188))}function Qe(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(r(188));return t!==e?null:e}for(var i=e,n=t;;){var s=i.return;if(null===s)break;var o=s.alternate;if(null===o){if(null!==(n=s.return)){i=n;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===i)return Ze(s),e;if(o===n)return Ze(s),t;o=o.sibling}throw Error(r(188))}if(i.return!==n.return)i=s,n=o;else{for(var a=!1,l=s.child;l;){if(l===i){a=!0,i=s,n=o;break}if(l===n){a=!0,n=s,i=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===i){a=!0,i=o,n=s;break}if(l===n){a=!0,n=o,i=s;break}l=l.sibling}if(!a)throw Error(r(189))}}if(i.alternate!==n)throw Error(r(190))}if(3!==i.tag)throw Error(r(188));return i.stateNode.current===i?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var i=e.alternate;null!==t;){if(t===e||t===i)return!0;t=t.return}return!1}var tt,it,nt,st,ot=!1,rt=[],at=null,lt=null,ct=null,ut=new Map,ht=new Map,dt=[],pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gt(e,t,i,n,s){return{blockedOn:e,domEventName:t,eventSystemFlags:16|i,nativeEvent:s,targetContainers:[n]}}function mt(e,t){switch(e){case"focusin":case"focusout":at=null;break;case"dragenter":case"dragleave":lt=null;break;case"mouseover":case"mouseout":ct=null;break;case"pointerover":case"pointerout":ut.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ht.delete(t.pointerId)}}function ft(e,t,i,n,s,o){return null===e||e.nativeEvent!==o?(e=gt(t,i,n,s,o),null!==t&&null!==(t=es(t))&&it(t),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function _t(e){var t=Qn(e.target);if(null!==t){var i=qe(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=Je(i)))return e.blockedOn=t,void st(e.lanePriority,(function(){o.unstable_runWithPriority(e.priority,(function(){nt(i)}))}))}else if(3===t&&i.stateNode.hydrate)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function Tt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=es(i))&&it(t),e.blockedOn=i,!1;t.shift()}return!0}function Et(e,t,i){Tt(e)&&i.delete(t)}function bt(){for(ot=!1;0<rt.length;){var e=rt[0];if(null!==e.blockedOn){null!==(e=es(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var i=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i){e.blockedOn=i;break}t.shift()}null===e.blockedOn&&rt.shift()}null!==at&&Tt(at)&&(at=null),null!==lt&&Tt(lt)&&(lt=null),null!==ct&&Tt(ct)&&(ct=null),ut.forEach(Et),ht.forEach(Et)}function It(e,t){e.blockedOn===t&&(e.blockedOn=null,ot||(ot=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,bt)))}function yt(e){function t(t){return It(t,e)}if(0<rt.length){It(rt[0],e);for(var i=1;i<rt.length;i++){var n=rt[i];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==at&&It(at,e),null!==lt&&It(lt,e),null!==ct&&It(ct,e),ut.forEach(t),ht.forEach(t),i=0;i<dt.length;i++)(n=dt[i]).blockedOn===e&&(n.blockedOn=null);for(;0<dt.length&&null===(i=dt[0]).blockedOn;)_t(i),null===i.blockedOn&&dt.shift()}function vt(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var Ct={animationend:vt("Animation","AnimationEnd"),animationiteration:vt("Animation","AnimationIteration"),animationstart:vt("Animation","AnimationStart"),transitionend:vt("Transition","TransitionEnd")},kt={},Ot={};function Nt(e){if(kt[e])return kt[e];if(!Ct[e])return e;var t,i=Ct[e];for(t in i)if(i.hasOwnProperty(t)&&t in Ot)return kt[e]=i[t];return e}h&&(Ot=document.createElement("div").style,"AnimationEvent"in window||(delete Ct.animationend.animation,delete Ct.animationiteration.animation,delete Ct.animationstart.animation),"TransitionEvent"in window||delete Ct.transitionend.transition);var At=Nt("animationend"),St=Nt("animationiteration"),Rt=Nt("animationstart"),wt=Nt("transitionend"),Lt=new Map,xt=new Map,$t=["abort","abort",At,"animationEnd",St,"animationIteration",Rt,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",wt,"transitionEnd","waiting","waiting"];function Dt(e,t){for(var i=0;i<e.length;i+=2){var n=e[i],s=e[i+1];s="on"+(s[0].toUpperCase()+s.slice(1)),xt.set(n,t),Lt.set(n,s),c(s,[n])}}(0,o.unstable_now)();var Mt=8;function Pt(e){if(0!=(1&e))return Mt=15,1;if(0!=(2&e))return Mt=14,2;if(0!=(4&e))return Mt=13,4;var t=24&e;return 0!==t?(Mt=12,t):0!=(32&e)?(Mt=11,32):0!=(t=192&e)?(Mt=10,t):0!=(256&e)?(Mt=9,256):0!=(t=3584&e)?(Mt=8,t):0!=(4096&e)?(Mt=7,4096):0!=(t=4186112&e)?(Mt=6,t):0!=(t=62914560&e)?(Mt=5,t):67108864&e?(Mt=4,67108864):0!=(134217728&e)?(Mt=3,134217728):0!=(t=805306368&e)?(Mt=2,t):0!=(1073741824&e)?(Mt=1,1073741824):(Mt=8,e)}function Bt(e,t){var i=e.pendingLanes;if(0===i)return Mt=0;var n=0,s=0,o=e.expiredLanes,r=e.suspendedLanes,a=e.pingedLanes;if(0!==o)n=o,s=Mt=15;else if(0!=(o=134217727&i)){var l=o&~r;0!==l?(n=Pt(l),s=Mt):0!=(a&=o)&&(n=Pt(a),s=Mt)}else 0!=(o=i&~r)?(n=Pt(o),s=Mt):0!==a&&(n=Pt(a),s=Mt);if(0===n)return 0;if(n=i&((0>(n=31-jt(n))?0:1<<n)<<1)-1,0!==t&&t!==n&&0==(t&r)){if(Pt(t),s<=Mt)return t;Mt=s}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)s=1<<(i=31-jt(t)),n|=e[i],t&=~s;return n}function Ft(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Ut(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Ht(24&~t))?Ut(10,t):e;case 10:return 0===(e=Ht(192&~t))?Ut(8,t):e;case 8:return 0===(e=Ht(3584&~t))&&0===(e=Ht(4186112&~t))&&(e=512),e;case 2:return 0===(t=Ht(805306368&~t))&&(t=268435456),t}throw Error(r(358,e))}function Ht(e){return e&-e}function Gt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Vt(e,t,i){e.pendingLanes|=t;var n=t-1;e.suspendedLanes&=n,e.pingedLanes&=n,(e=e.eventTimes)[t=31-jt(t)]=i}var jt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Wt(e)/Xt|0)|0},Wt=Math.log,Xt=Math.LN2;var Yt=o.unstable_UserBlockingPriority,zt=o.unstable_runWithPriority,Kt=!0;function qt(e,t,i,n){Pe||De();var s=Zt,o=Pe;Pe=!0;try{$e(s,e,t,i,n)}finally{(Pe=o)||Fe()}}function Jt(e,t,i,n){zt(Yt,Zt.bind(null,e,t,i,n))}function Zt(e,t,i,n){var s;if(Kt)if((s=0==(4&t))&&0<rt.length&&-1<pt.indexOf(e))e=gt(null,e,t,i,n),rt.push(e);else{var o=Qt(e,t,i,n);if(null===o)s&&mt(e,n);else{if(s){if(-1<pt.indexOf(e))return e=gt(o,e,t,i,n),void rt.push(e);if(function(e,t,i,n,s){switch(t){case"focusin":return at=ft(at,e,t,i,n,s),!0;case"dragenter":return lt=ft(lt,e,t,i,n,s),!0;case"mouseover":return ct=ft(ct,e,t,i,n,s),!0;case"pointerover":var o=s.pointerId;return ut.set(o,ft(ut.get(o)||null,e,t,i,n,s)),!0;case"gotpointercapture":return o=s.pointerId,ht.set(o,ft(ht.get(o)||null,e,t,i,n,s)),!0}return!1}(o,e,t,i,n))return;mt(e,n)}Ln(e,t,n,null,i)}}}function Qt(e,t,i,n){var s=Oe(n);if(null!==(s=Qn(s))){var o=qe(s);if(null===o)s=null;else{var r=o.tag;if(13===r){if(null!==(s=Je(o)))return s;s=null}else if(3===r){if(o.stateNode.hydrate)return 3===o.tag?o.stateNode.containerInfo:null;s=null}else o!==s&&(s=null)}}return Ln(e,t,n,s,i),null}var ei=null,ti=null,ii=null;function ni(){if(ii)return ii;var e,t,i=ti,n=i.length,s="value"in ei?ei.value:ei.textContent,o=s.length;for(e=0;e<n&&i[e]===s[e];e++);var r=n-e;for(t=1;t<=r&&i[n-t]===s[o-t];t++);return ii=s.slice(e,1<t?1-t:void 0)}function si(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function oi(){return!0}function ri(){return!1}function ai(e){function t(t,i,n,s,o){for(var r in this._reactName=t,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(r)&&(t=e[r],this[r]=t?t(s):s[r]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?oi:ri,this.isPropagationStopped=ri,this}return s(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=oi)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=oi)},persist:function(){},isPersistent:oi}),t}var li,ci,ui,hi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},di=ai(hi),pi=s({},hi,{view:0,detail:0}),gi=ai(pi),mi=s({},pi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Oi,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ui&&(ui&&"mousemove"===e.type?(li=e.screenX-ui.screenX,ci=e.screenY-ui.screenY):ci=li=0,ui=e),li)},movementY:function(e){return"movementY"in e?e.movementY:ci}}),fi=ai(mi),_i=ai(s({},mi,{dataTransfer:0})),Ti=ai(s({},pi,{relatedTarget:0})),Ei=ai(s({},hi,{animationName:0,elapsedTime:0,pseudoElement:0})),bi=ai(s({},hi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),Ii=ai(s({},hi,{data:0})),yi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ci={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ki(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Ci[e])&&!!t[e]}function Oi(){return ki}var Ni=ai(s({},pi,{key:function(e){if(e.key){var t=yi[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=si(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?vi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Oi,charCode:function(e){return"keypress"===e.type?si(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?si(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Ai=ai(s({},mi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Si=ai(s({},pi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Oi})),Ri=ai(s({},hi,{propertyName:0,elapsedTime:0,pseudoElement:0})),wi=ai(s({},mi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Li=[9,13,27,32],xi=h&&"CompositionEvent"in window,$i=null;h&&"documentMode"in document&&($i=document.documentMode);var Di=h&&"TextEvent"in window&&!$i,Mi=h&&(!xi||$i&&8<$i&&11>=$i),Pi=String.fromCharCode(32),Bi=!1;function Fi(e,t){switch(e){case"keyup":return-1!==Li.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ui(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Hi=!1;var Gi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gi[e.type]:"textarea"===t}function ji(e,t,i,n){we(n),0<(t=$n(t,"onChange")).length&&(i=new di("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Wi=null,Xi=null;function Yi(e){On(e,0)}function zi(e){if(J(ts(e)))return e}function Ki(e,t){if("change"===e)return t}var qi=!1;if(h){var Ji;if(h){var Zi="oninput"in document;if(!Zi){var Qi=document.createElement("div");Qi.setAttribute("oninput","return;"),Zi="function"==typeof Qi.oninput}Ji=Zi}else Ji=!1;qi=Ji&&(!document.documentMode||9<document.documentMode)}function en(){Wi&&(Wi.detachEvent("onpropertychange",tn),Xi=Wi=null)}function tn(e){if("value"===e.propertyName&&zi(Xi)){var t=[];if(ji(t,Xi,e,Oe(e)),e=Yi,Pe)e(t);else{Pe=!0;try{xe(e,t)}finally{Pe=!1,Fe()}}}}function nn(e,t,i){"focusin"===e?(en(),Xi=i,(Wi=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function sn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return zi(Xi)}function on(e,t){if("click"===e)return zi(t)}function rn(e,t){if("input"===e||"change"===e)return zi(t)}var an="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},ln=Object.prototype.hasOwnProperty;function cn(e,t){if(an(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++)if(!ln.call(t,i[n])||!an(e[i[n]],t[i[n]]))return!1;return!0}function un(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hn(e,t){var i,n=un(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=un(n)}}function dn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pn(){for(var e=window,t=Z();t instanceof e.HTMLIFrameElement;){try{var i="string"==typeof t.contentWindow.location.href}catch(e){i=!1}if(!i)break;t=Z((e=t.contentWindow).document)}return t}function gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var mn=h&&"documentMode"in document&&11>=document.documentMode,fn=null,_n=null,Tn=null,En=!1;function bn(e,t,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;En||null==fn||fn!==Z(n)||(n="selectionStart"in(n=fn)&&gn(n)?{start:n.selectionStart,end:n.selectionEnd}:{anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Tn&&cn(Tn,n)||(Tn=n,0<(n=$n(_n,"onSelect")).length&&(t=new di("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=fn)))}Dt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Dt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Dt($t,2);for(var In="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),yn=0;yn<In.length;yn++)xt.set(In[yn],0);u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Cn=new Set("cancel close invalid load scroll toggle".split(" ").concat(vn));function kn(e,t,i){var n=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,n,s,o,a,l,c){if(Ke.apply(this,arguments),je){if(!je)throw Error(r(198));var u=We;je=!1,We=null,Xe||(Xe=!0,Ye=u)}}(n,t,void 0,e),e.currentTarget=null}function On(e,t){t=0!=(4&t);for(var i=0;i<e.length;i++){var n=e[i],s=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var r=n.length-1;0<=r;r--){var a=n[r],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&s.isPropagationStopped())break e;kn(s,a,c),o=l}else for(r=0;r<n.length;r++){if(l=(a=n[r]).instance,c=a.currentTarget,a=a.listener,l!==o&&s.isPropagationStopped())break e;kn(s,a,c),o=l}}}if(Xe)throw e=Ye,Xe=!1,Ye=null,e}function Nn(e,t){var i=ns(t),n=e+"__bubble";i.has(n)||(wn(t,e,2,!1),i.add(n))}var An="_reactListening"+Math.random().toString(36).slice(2);function Sn(e){e[An]||(e[An]=!0,a.forEach((function(t){Cn.has(t)||Rn(t,!1,e,null),Rn(t,!0,e,null)})))}function Rn(e,t,i,n){var s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=i;if("selectionchange"===e&&9!==i.nodeType&&(o=i.ownerDocument),null!==n&&!t&&Cn.has(e)){if("scroll"!==e)return;s|=2,o=n}var r=ns(o),a=e+"__"+(t?"capture":"bubble");r.has(a)||(t&&(s|=4),wn(o,e,s,t),r.add(a))}function wn(e,t,i,n){var s=xt.get(t);switch(void 0===s?2:s){case 0:s=qt;break;case 1:s=Jt;break;default:s=Zt}i=s.bind(null,t,i,e),s=void 0,!He||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),n?void 0!==s?e.addEventListener(t,i,{capture:!0,passive:s}):e.addEventListener(t,i,!0):void 0!==s?e.addEventListener(t,i,{passive:s}):e.addEventListener(t,i,!1)}function Ln(e,t,i,n,s){var o=n;if(0==(1&t)&&0==(2&t)&&null!==n)e:for(;;){if(null===n)return;var r=n.tag;if(3===r||4===r){var a=n.stateNode.containerInfo;if(a===s||8===a.nodeType&&a.parentNode===s)break;if(4===r)for(r=n.return;null!==r;){var l=r.tag;if((3===l||4===l)&&((l=r.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;r=r.return}for(;null!==a;){if(null===(r=Qn(a)))return;if(5===(l=r.tag)||6===l){n=o=r;continue e}a=a.parentNode}}n=n.return}!function(e,t,i){if(Be)return e(t,i);Be=!0;try{Me(e,t,i)}finally{Be=!1,Fe()}}((function(){var n=o,s=Oe(i),r=[];e:{var a=Lt.get(e);if(void 0!==a){var l=di,c=e;switch(e){case"keypress":if(0===si(i))break e;case"keydown":case"keyup":l=Ni;break;case"focusin":c="focus",l=Ti;break;case"focusout":c="blur",l=Ti;break;case"beforeblur":case"afterblur":l=Ti;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=_i;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Si;break;case At:case St:case Rt:l=Ei;break;case wt:l=Ri;break;case"scroll":l=gi;break;case"wheel":l=wi;break;case"copy":case"cut":case"paste":l=bi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Ai}var u=0!=(4&t),h=!u&&"scroll"===e,d=u?null!==a?a+"Capture":null:a;u=[];for(var p,g=n;null!==g;){var m=(p=g).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&null!=(m=Ue(g,d))&&u.push(xn(g,m,p))),h)break;g=g.return}0<u.length&&(a=new l(a,c,null,i,s),r.push({event:a,listeners:u}))}}if(0==(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||0!=(16&t)||!(c=i.relatedTarget||i.fromElement)||!Qn(c)&&!c[Jn])&&(l||a)&&(a=s.window===s?s:(a=s.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=n,null!==(c=(c=i.relatedTarget||i.toElement)?Qn(c):null)&&(c!==(h=qe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(u=fi,m="onMouseLeave",d="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(u=Ai,m="onPointerLeave",d="onPointerEnter",g="pointer"),h=null==l?a:ts(l),p=null==c?a:ts(c),(a=new u(m,g+"leave",l,i,s)).target=h,a.relatedTarget=p,m=null,Qn(s)===n&&((u=new u(d,g+"enter",c,i,s)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,g=0,p=u=l;p;p=Dn(p))g++;for(p=0,m=d;m;m=Dn(m))p++;for(;0<g-p;)u=Dn(u),g--;for(;0<p-g;)d=Dn(d),p--;for(;g--;){if(u===d||null!==d&&u===d.alternate)break e;u=Dn(u),d=Dn(d)}u=null}else u=null;null!==l&&Mn(r,a,l,u,!1),null!==c&&null!==h&&Mn(r,h,c,u,!0)}if("select"===(l=(a=n?ts(n):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var f=Ki;else if(Vi(a))if(qi)f=rn;else{f=sn;var _=nn}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(f=on);switch(f&&(f=f(e,n))?ji(r,f,i,s):(_&&_(e,a,n),"focusout"===e&&(_=a._wrapperState)&&_.controlled&&"number"===a.type&&se(a,"number",a.value)),_=n?ts(n):window,e){case"focusin":(Vi(_)||"true"===_.contentEditable)&&(fn=_,_n=n,Tn=null);break;case"focusout":Tn=_n=fn=null;break;case"mousedown":En=!0;break;case"contextmenu":case"mouseup":case"dragend":En=!1,bn(r,i,s);break;case"selectionchange":if(mn)break;case"keydown":case"keyup":bn(r,i,s)}var T;if(xi)e:{switch(e){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Hi?Fi(e,i)&&(E="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(E="onCompositionStart");E&&(Mi&&"ko"!==i.locale&&(Hi||"onCompositionStart"!==E?"onCompositionEnd"===E&&Hi&&(T=ni()):(ti="value"in(ei=s)?ei.value:ei.textContent,Hi=!0)),0<(_=$n(n,E)).length&&(E=new Ii(E,e,null,i,s),r.push({event:E,listeners:_}),(T||null!==(T=Ui(i)))&&(E.data=T))),(T=Di?function(e,t){switch(e){case"compositionend":return Ui(t);case"keypress":return 32!==t.which?null:(Bi=!0,Pi);case"textInput":return(e=t.data)===Pi&&Bi?null:e;default:return null}}(e,i):function(e,t){if(Hi)return"compositionend"===e||!xi&&Fi(e,t)?(e=ni(),ii=ti=ei=null,Hi=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mi&&"ko"!==t.locale?null:t.data;default:return null}}(e,i))&&0<(n=$n(n,"onBeforeInput")).length&&(s=new Ii("onBeforeInput","beforeinput",null,i,s),r.push({event:s,listeners:n}),s.data=T)}On(r,t)}))}function xn(e,t,i){return{instance:e,listener:t,currentTarget:i}}function $n(e,t){for(var i=t+"Capture",n=[];null!==e;){var s=e,o=s.stateNode;5===s.tag&&null!==o&&(s=o,null!=(o=Ue(e,i))&&n.unshift(xn(e,o,s)),null!=(o=Ue(e,t))&&n.push(xn(e,o,s))),e=e.return}return n}function Dn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Mn(e,t,i,n,s){for(var o=t._reactName,r=[];null!==i&&i!==n;){var a=i,l=a.alternate,c=a.stateNode;if(null!==l&&l===n)break;5===a.tag&&null!==c&&(a=c,s?null!=(l=Ue(i,o))&&r.unshift(xn(i,l,a)):s||null!=(l=Ue(i,o))&&r.push(xn(i,l,a))),i=i.return}0!==r.length&&e.push({event:t,listeners:r})}function Pn(){}var Bn=null,Fn=null;function Un(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Hn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Gn="function"==typeof setTimeout?setTimeout:void 0,Vn="function"==typeof clearTimeout?clearTimeout:void 0;function jn(e){(1===e.nodeType||9===e.nodeType&&null!=(e=e.body))&&(e.textContent="")}function Wn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Xn(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var Yn=0;var zn=Math.random().toString(36).slice(2),Kn="__reactFiber$"+zn,qn="__reactProps$"+zn,Jn="__reactContainer$"+zn,Zn="__reactEvents$"+zn;function Qn(e){var t=e[Kn];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Jn]||i[Kn]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=Xn(e);null!==e;){if(i=e[Kn])return i;e=Xn(e)}return t}i=(e=i).parentNode}return null}function es(e){return!(e=e[Kn]||e[Jn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ts(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(r(33))}function is(e){return e[qn]||null}function ns(e){var t=e[Zn];return void 0===t&&(t=e[Zn]=new Set),t}var ss=[],os=-1;function rs(e){return{current:e}}function as(e){0>os||(e.current=ss[os],ss[os]=null,os--)}function ls(e,t){ss[++os]=e.current,e.current=t}var cs={},us=rs(cs),hs=rs(!1),ds=cs;function ps(e,t){var i=e.type.contextTypes;if(!i)return cs;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s,o={};for(s in i)o[s]=t[s];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function gs(e){return null!=e.childContextTypes}function ms(){as(hs),as(us)}function fs(e,t,i){if(us.current!==cs)throw Error(r(168));ls(us,t),ls(hs,i)}function _s(e,t,i){var n=e.stateNode;if(e=t.childContextTypes,"function"!=typeof n.getChildContext)return i;for(var o in n=n.getChildContext())if(!(o in e))throw Error(r(108,Y(t)||"Unknown",o));return s({},i,n)}function Ts(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||cs,ds=us.current,ls(us,e),ls(hs,hs.current),!0}function Es(e,t,i){var n=e.stateNode;if(!n)throw Error(r(169));i?(e=_s(e,t,ds),n.__reactInternalMemoizedMergedChildContext=e,as(hs),as(us),ls(us,e)):as(hs),ls(hs,i)}var bs=null,Is=null,ys=o.unstable_runWithPriority,vs=o.unstable_scheduleCallback,Cs=o.unstable_cancelCallback,ks=o.unstable_shouldYield,Os=o.unstable_requestPaint,Ns=o.unstable_now,As=o.unstable_getCurrentPriorityLevel,Ss=o.unstable_ImmediatePriority,Rs=o.unstable_UserBlockingPriority,ws=o.unstable_NormalPriority,Ls=o.unstable_LowPriority,xs=o.unstable_IdlePriority,$s={},Ds=void 0!==Os?Os:function(){},Ms=null,Ps=null,Bs=!1,Fs=Ns(),Us=1e4>Fs?Ns:function(){return Ns()-Fs};function Hs(){switch(As()){case Ss:return 99;case Rs:return 98;case ws:return 97;case Ls:return 96;case xs:return 95;default:throw Error(r(332))}}function Gs(e){switch(e){case 99:return Ss;case 98:return Rs;case 97:return ws;case 96:return Ls;case 95:return xs;default:throw Error(r(332))}}function Vs(e,t){return e=Gs(e),ys(e,t)}function js(e,t,i){return e=Gs(e),vs(e,t,i)}function Ws(){if(null!==Ps){var e=Ps;Ps=null,Cs(e)}Xs()}function Xs(){if(!Bs&&null!==Ms){Bs=!0;var e=0;try{var t=Ms;Vs(99,(function(){for(;e<t.length;e++){var i=t[e];do{i=i(!0)}while(null!==i)}})),Ms=null}catch(t){throw null!==Ms&&(Ms=Ms.slice(e+1)),vs(Ss,Ws),t}finally{Bs=!1}}}var Ys=I.ReactCurrentBatchConfig;function zs(e,t){if(e&&e.defaultProps){for(var i in t=s({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}var Ks=rs(null),qs=null,Js=null,Zs=null;function Qs(){Zs=Js=qs=null}function eo(e){var t=Ks.current;as(Ks),e.type._context._currentValue=t}function to(e,t){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)===t){if(null===i||(i.childLanes&t)===t)break;i.childLanes|=t}else e.childLanes|=t,null!==i&&(i.childLanes|=t);e=e.return}}function io(e,t){qs=e,Zs=Js=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&($r=!0),e.firstContext=null)}function no(e,t){if(Zs!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(Zs=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Js){if(null===qs)throw Error(r(308));Js=t,qs.dependencies={lanes:0,firstContext:t,responders:null}}else Js=Js.next=t;return e._currentValue}var so=!1;function oo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function ro(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ao(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function lo(e,t){if(null!==(e=e.updateQueue)){var i=(e=e.shared).pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}}function co(e,t){var i=e.updateQueue,n=e.alternate;if(null!==n&&i===(n=n.updateQueue)){var s=null,o=null;if(null!==(i=i.firstBaseUpdate)){do{var r={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===o?s=o=r:o=o.next=r,i=i.next}while(null!==i);null===o?s=o=t:o=o.next=t}else s=o=t;return i={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:o,shared:n.shared,effects:n.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function uo(e,t,i,n){var o=e.updateQueue;so=!1;var r=o.firstBaseUpdate,a=o.lastBaseUpdate,l=o.shared.pending;if(null!==l){o.shared.pending=null;var c=l,u=c.next;c.next=null,null===a?r=u:a.next=u,a=c;var h=e.alternate;if(null!==h){var d=(h=h.updateQueue).lastBaseUpdate;d!==a&&(null===d?h.firstBaseUpdate=u:d.next=u,h.lastBaseUpdate=c)}}if(null!==r){for(d=o.baseState,a=0,h=u=c=null;;){l=r.lane;var p=r.eventTime;if((n&l)===l){null!==h&&(h=h.next={eventTime:p,lane:0,tag:r.tag,payload:r.payload,callback:r.callback,next:null});e:{var g=e,m=r;switch(l=t,p=i,m.tag){case 1:if("function"==typeof(g=m.payload)){d=g.call(p,d,l);break e}d=g;break e;case 3:g.flags=-4097&g.flags|64;case 0:if(null==(l="function"==typeof(g=m.payload)?g.call(p,d,l):g))break e;d=s({},d,l);break e;case 2:so=!0}}null!==r.callback&&(e.flags|=32,null===(l=o.effects)?o.effects=[r]:l.push(r))}else p={eventTime:p,lane:l,tag:r.tag,payload:r.payload,callback:r.callback,next:null},null===h?(u=h=p,c=d):h=h.next=p,a|=l;if(null===(r=r.next)){if(null===(l=o.shared.pending))break;r=l.next,l.next=null,o.lastBaseUpdate=l,o.shared.pending=null}}null===h&&(c=d),o.baseState=c,o.firstBaseUpdate=u,o.lastBaseUpdate=h,Pa|=a,e.lanes=a,e.memoizedState=d}}function ho(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(null!==s){if(n.callback=null,n=i,"function"!=typeof s)throw Error(r(191,s));s.call(n)}}}var po=(new n.Component).refs;function go(e,t,i,n){i=null==(i=i(n,t=e.memoizedState))?t:s({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var mo={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var n=ll(),s=cl(e),o=ao(n,s);o.payload=t,null!=i&&(o.callback=i),lo(e,o),ul(e,s,n)},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=ll(),s=cl(e),o=ao(n,s);o.tag=1,o.payload=t,null!=i&&(o.callback=i),lo(e,o),ul(e,s,n)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ll(),n=cl(e),s=ao(i,n);s.tag=2,null!=t&&(s.callback=t),lo(e,s),ul(e,n,i)}};function fo(e,t,i,n,s,o,r){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,o,r):!(t.prototype&&t.prototype.isPureReactComponent&&cn(i,n)&&cn(s,o))}function _o(e,t,i){var n=!1,s=cs,o=t.contextType;return"object"==typeof o&&null!==o?o=no(o):(s=gs(t)?ds:us.current,o=(n=null!=(n=t.contextTypes))?ps(e,s):cs),t=new t(i,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=mo,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=o),t}function To(e,t,i,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&mo.enqueueReplaceState(t,t.state,null)}function Eo(e,t,i,n){var s=e.stateNode;s.props=i,s.state=e.memoizedState,s.refs=po,oo(e);var o=t.contextType;"object"==typeof o&&null!==o?s.context=no(o):(o=gs(t)?ds:us.current,s.context=ps(e,o)),uo(e,i,s,n),s.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(go(e,t,o,i),s.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof s.getSnapshotBeforeUpdate||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||(t=s.state,"function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&mo.enqueueReplaceState(s,s.state,null),uo(e,i,s,n),s.state=e.memoizedState),"function"==typeof s.componentDidMount&&(e.flags|=4)}var bo=Array.isArray;function Io(e,t,i){if(null!==(e=i.ref)&&"function"!=typeof e&&"object"!=typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(r(309));var n=i.stateNode}if(!n)throw Error(r(147,e));var s=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===s?t.ref:((t=function(e){var t=n.refs;t===po&&(t=n.refs={}),null===e?delete t[s]:t[s]=e})._stringRef=s,t)}if("string"!=typeof e)throw Error(r(284));if(!i._owner)throw Error(r(290,e))}return e}function yo(e,t){if("textarea"!==e.type)throw Error(r(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function vo(e){function t(t,i){if(e){var n=t.lastEffect;null!==n?(n.nextEffect=i,t.lastEffect=i):t.firstEffect=t.lastEffect=i,i.nextEffect=null,i.flags=8}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=Gl(e,t)).index=0,e.sibling=null,e}function o(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<i?(t.flags=2,i):n:(t.flags=2,i):i}function a(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,i,n){return null===t||6!==t.tag?((t=Xl(i,e.mode,n)).return=e,t):((t=s(t,i)).return=e,t)}function c(e,t,i,n){return null!==t&&t.elementType===i.type?((n=s(t,i.props)).ref=Io(e,t,i),n.return=e,n):((n=Vl(i.type,i.key,i.props,null,e.mode,n)).ref=Io(e,t,i),n.return=e,n)}function u(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=Yl(i,e.mode,n)).return=e,t):((t=s(t,i.children||[])).return=e,t)}function h(e,t,i,n,o){return null===t||7!==t.tag?((t=jl(i,e.mode,n,o)).return=e,t):((t=s(t,i)).return=e,t)}function d(e,t,i){if("string"==typeof t||"number"==typeof t)return(t=Xl(""+t,e.mode,i)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case y:return(i=Vl(t.type,t.key,t.props,null,e.mode,i)).ref=Io(e,null,t),i.return=e,i;case v:return(t=Yl(t,e.mode,i)).return=e,t}if(bo(t)||G(t))return(t=jl(t,e.mode,i,null)).return=e,t;yo(e,t)}return null}function p(e,t,i,n){var s=null!==t?t.key:null;if("string"==typeof i||"number"==typeof i)return null!==s?null:l(e,t,""+i,n);if("object"==typeof i&&null!==i){switch(i.$$typeof){case y:return i.key===s?i.type===C?h(e,t,i.props.children,n,s):c(e,t,i,n):null;case v:return i.key===s?u(e,t,i,n):null}if(bo(i)||G(i))return null!==s?null:h(e,t,i,n,null);yo(e,i)}return null}function g(e,t,i,n,s){if("string"==typeof n||"number"==typeof n)return l(t,e=e.get(i)||null,""+n,s);if("object"==typeof n&&null!==n){switch(n.$$typeof){case y:return e=e.get(null===n.key?i:n.key)||null,n.type===C?h(t,e,n.props.children,s,n.key):c(t,e,n,s);case v:return u(t,e=e.get(null===n.key?i:n.key)||null,n,s)}if(bo(n)||G(n))return h(t,e=e.get(i)||null,n,s,null);yo(t,n)}return null}function m(s,r,a,l){for(var c=null,u=null,h=r,m=r=0,f=null;null!==h&&m<a.length;m++){h.index>m?(f=h,h=null):f=h.sibling;var _=p(s,h,a[m],l);if(null===_){null===h&&(h=f);break}e&&h&&null===_.alternate&&t(s,h),r=o(_,r,m),null===u?c=_:u.sibling=_,u=_,h=f}if(m===a.length)return i(s,h),c;if(null===h){for(;m<a.length;m++)null!==(h=d(s,a[m],l))&&(r=o(h,r,m),null===u?c=h:u.sibling=h,u=h);return c}for(h=n(s,h);m<a.length;m++)null!==(f=g(h,s,m,a[m],l))&&(e&&null!==f.alternate&&h.delete(null===f.key?m:f.key),r=o(f,r,m),null===u?c=f:u.sibling=f,u=f);return e&&h.forEach((function(e){return t(s,e)})),c}function f(s,a,l,c){var u=G(l);if("function"!=typeof u)throw Error(r(150));if(null==(l=u.call(l)))throw Error(r(151));for(var h=u=null,m=a,f=a=0,_=null,T=l.next();null!==m&&!T.done;f++,T=l.next()){m.index>f?(_=m,m=null):_=m.sibling;var E=p(s,m,T.value,c);if(null===E){null===m&&(m=_);break}e&&m&&null===E.alternate&&t(s,m),a=o(E,a,f),null===h?u=E:h.sibling=E,h=E,m=_}if(T.done)return i(s,m),u;if(null===m){for(;!T.done;f++,T=l.next())null!==(T=d(s,T.value,c))&&(a=o(T,a,f),null===h?u=T:h.sibling=T,h=T);return u}for(m=n(s,m);!T.done;f++,T=l.next())null!==(T=g(m,s,f,T.value,c))&&(e&&null!==T.alternate&&m.delete(null===T.key?f:T.key),a=o(T,a,f),null===h?u=T:h.sibling=T,h=T);return e&&m.forEach((function(e){return t(s,e)})),u}return function(e,n,o,l){var c="object"==typeof o&&null!==o&&o.type===C&&null===o.key;c&&(o=o.props.children);var u="object"==typeof o&&null!==o;if(u)switch(o.$$typeof){case y:e:{for(u=o.key,c=n;null!==c;){if(c.key===u){switch(c.tag){case 7:if(o.type===C){i(e,c.sibling),(n=s(c,o.props.children)).return=e,e=n;break e}break;default:if(c.elementType===o.type){i(e,c.sibling),(n=s(c,o.props)).ref=Io(e,c,o),n.return=e,e=n;break e}}i(e,c);break}t(e,c),c=c.sibling}o.type===C?((n=jl(o.props.children,e.mode,l,o.key)).return=e,e=n):((l=Vl(o.type,o.key,o.props,null,e.mode,l)).ref=Io(e,n,o),l.return=e,e=l)}return a(e);case v:e:{for(c=o.key;null!==n;){if(n.key===c){if(4===n.tag&&n.stateNode.containerInfo===o.containerInfo&&n.stateNode.implementation===o.implementation){i(e,n.sibling),(n=s(n,o.children||[])).return=e,e=n;break e}i(e,n);break}t(e,n),n=n.sibling}(n=Yl(o,e.mode,l)).return=e,e=n}return a(e)}if("string"==typeof o||"number"==typeof o)return o=""+o,null!==n&&6===n.tag?(i(e,n.sibling),(n=s(n,o)).return=e,e=n):(i(e,n),(n=Xl(o,e.mode,l)).return=e,e=n),a(e);if(bo(o))return m(e,n,o,l);if(G(o))return f(e,n,o,l);if(u&&yo(e,o),void 0===o&&!c)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(r(152,Y(e.type)||"Component"))}return i(e,n)}}var Co=vo(!0),ko=vo(!1),Oo={},No=rs(Oo),Ao=rs(Oo),So=rs(Oo);function Ro(e){if(e===Oo)throw Error(r(174));return e}function wo(e,t){switch(ls(So,t),ls(Ao,e),ls(No,Oo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ge(null,"");break;default:t=ge(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}as(No),ls(No,t)}function Lo(){as(No),as(Ao),as(So)}function xo(e){Ro(So.current);var t=Ro(No.current),i=ge(t,e.type);t!==i&&(ls(Ao,e),ls(No,i))}function $o(e){Ao.current===e&&(as(No),as(Ao))}var Do=rs(0);function Mo(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Po=null,Bo=null,Fo=!1;function Uo(e,t){var i=Ul(5,null,null,0);i.elementType="DELETED",i.type="DELETED",i.stateNode=t,i.return=e,i.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=i,e.lastEffect=i):e.firstEffect=e.lastEffect=i}function Ho(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Go(e){if(Fo){var t=Bo;if(t){var i=t;if(!Ho(e,t)){if(!(t=Wn(i.nextSibling))||!Ho(e,t))return e.flags=-1025&e.flags|2,Fo=!1,void(Po=e);Uo(Po,i)}Po=e,Bo=Wn(t.firstChild)}else e.flags=-1025&e.flags|2,Fo=!1,Po=e}}function Vo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Po=e}function jo(e){if(e!==Po)return!1;if(!Fo)return Vo(e),Fo=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Hn(t,e.memoizedProps))for(t=Bo;t;)Uo(e,t),t=Wn(t.nextSibling);if(Vo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){Bo=Wn(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}Bo=null}}else Bo=Po?Wn(e.stateNode.nextSibling):null;return!0}function Wo(){Bo=Po=null,Fo=!1}var Xo=[];function Yo(){for(var e=0;e<Xo.length;e++)Xo[e]._workInProgressVersionPrimary=null;Xo.length=0}var zo=I.ReactCurrentDispatcher,Ko=I.ReactCurrentBatchConfig,qo=0,Jo=null,Zo=null,Qo=null,er=!1,tr=!1;function ir(){throw Error(r(321))}function nr(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!an(e[i],t[i]))return!1;return!0}function sr(e,t,i,n,s,o){if(qo=o,Jo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,zo.current=null===e||null===e.memoizedState?Rr:wr,e=i(n,s),tr){o=0;do{if(tr=!1,!(25>o))throw Error(r(301));o+=1,Qo=Zo=null,t.updateQueue=null,zo.current=Lr,e=i(n,s)}while(tr)}if(zo.current=Sr,t=null!==Zo&&null!==Zo.next,qo=0,Qo=Zo=Jo=null,er=!1,t)throw Error(r(300));return e}function or(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Qo?Jo.memoizedState=Qo=e:Qo=Qo.next=e,Qo}function rr(){if(null===Zo){var e=Jo.alternate;e=null!==e?e.memoizedState:null}else e=Zo.next;var t=null===Qo?Jo.memoizedState:Qo.next;if(null!==t)Qo=t,Zo=e;else{if(null===e)throw Error(r(310));e={memoizedState:(Zo=e).memoizedState,baseState:Zo.baseState,baseQueue:Zo.baseQueue,queue:Zo.queue,next:null},null===Qo?Jo.memoizedState=Qo=e:Qo=Qo.next=e}return Qo}function ar(e,t){return"function"==typeof t?t(e):t}function lr(e){var t=rr(),i=t.queue;if(null===i)throw Error(r(311));i.lastRenderedReducer=e;var n=Zo,s=n.baseQueue,o=i.pending;if(null!==o){if(null!==s){var a=s.next;s.next=o.next,o.next=a}n.baseQueue=s=o,i.pending=null}if(null!==s){s=s.next,n=n.baseState;var l=a=o=null,c=s;do{var u=c.lane;if((qo&u)===u)null!==l&&(l=l.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),n=c.eagerReducer===e?c.eagerState:e(n,c.action);else{var h={lane:u,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(a=l=h,o=n):l=l.next=h,Jo.lanes|=u,Pa|=u}c=c.next}while(null!==c&&c!==s);null===l?o=n:l.next=a,an(n,t.memoizedState)||($r=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=l,i.lastRenderedState=n}return[t.memoizedState,i.dispatch]}function cr(e){var t=rr(),i=t.queue;if(null===i)throw Error(r(311));i.lastRenderedReducer=e;var n=i.dispatch,s=i.pending,o=t.memoizedState;if(null!==s){i.pending=null;var a=s=s.next;do{o=e(o,a.action),a=a.next}while(a!==s);an(o,t.memoizedState)||($r=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),i.lastRenderedState=o}return[o,n]}function ur(e,t,i){var n=t._getVersion;n=n(t._source);var s=t._workInProgressVersionPrimary;if(null!==s?e=s===n:(e=e.mutableReadLanes,(e=(qo&e)===e)&&(t._workInProgressVersionPrimary=n,Xo.push(t))),e)return i(t._source);throw Xo.push(t),Error(r(350))}function hr(e,t,i,n){var s=Sa;if(null===s)throw Error(r(349));var o=t._getVersion,a=o(t._source),l=zo.current,c=l.useState((function(){return ur(s,t,i)})),u=c[1],h=c[0];c=Qo;var d=e.memoizedState,p=d.refs,g=p.getSnapshot,m=d.source;d=d.subscribe;var f=Jo;return e.memoizedState={refs:p,source:t,subscribe:n},l.useEffect((function(){p.getSnapshot=i,p.setSnapshot=u;var e=o(t._source);if(!an(a,e)){e=i(t._source),an(h,e)||(u(e),e=cl(f),s.mutableReadLanes|=e&s.pendingLanes),e=s.mutableReadLanes,s.entangledLanes|=e;for(var n=s.entanglements,r=e;0<r;){var l=31-jt(r),c=1<<l;n[l]|=e,r&=~c}}}),[i,t,n]),l.useEffect((function(){return n(t._source,(function(){var e=p.getSnapshot,i=p.setSnapshot;try{i(e(t._source));var n=cl(f);s.mutableReadLanes|=n&s.pendingLanes}catch(e){i((function(){throw e}))}}))}),[t,n]),an(g,i)&&an(m,t)&&an(d,n)||((e={pending:null,dispatch:null,lastRenderedReducer:ar,lastRenderedState:h}).dispatch=u=Ar.bind(null,Jo,e),c.queue=e,c.baseQueue=null,h=ur(s,t,i),c.memoizedState=c.baseState=h),h}function dr(e,t,i){return hr(rr(),e,t,i)}function pr(e){var t=or();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:ar,lastRenderedState:e}).dispatch=Ar.bind(null,Jo,e),[t.memoizedState,e]}function gr(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===(t=Jo.updateQueue)?(t={lastEffect:null},Jo.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function mr(e){return e={current:e},or().memoizedState=e}function fr(){return rr().memoizedState}function _r(e,t,i,n){var s=or();Jo.flags|=e,s.memoizedState=gr(1|t,i,void 0,void 0===n?null:n)}function Tr(e,t,i,n){var s=rr();n=void 0===n?null:n;var o=void 0;if(null!==Zo){var r=Zo.memoizedState;if(o=r.destroy,null!==n&&nr(n,r.deps))return void gr(t,i,o,n)}Jo.flags|=e,s.memoizedState=gr(1|t,i,o,n)}function Er(e,t){return _r(516,4,e,t)}function br(e,t){return Tr(516,4,e,t)}function Ir(e,t){return Tr(4,2,e,t)}function yr(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function vr(e,t,i){return i=null!=i?i.concat([e]):null,Tr(4,2,yr.bind(null,t,e),i)}function Cr(){}function kr(e,t){var i=rr();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&nr(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Or(e,t){var i=rr();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&nr(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)}function Nr(e,t){var i=Hs();Vs(98>i?98:i,(function(){e(!0)})),Vs(97<i?97:i,(function(){var i=Ko.transition;Ko.transition=1;try{e(!1),t()}finally{Ko.transition=i}}))}function Ar(e,t,i){var n=ll(),s=cl(e),o={lane:s,action:i,eagerReducer:null,eagerState:null,next:null},r=t.pending;if(null===r?o.next=o:(o.next=r.next,r.next=o),t.pending=o,r=e.alternate,e===Jo||null!==r&&r===Jo)tr=er=!0;else{if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var a=t.lastRenderedState,l=r(a,i);if(o.eagerReducer=r,o.eagerState=l,an(l,a))return}catch(e){}ul(e,s,n)}}var Sr={readContext:no,useCallback:ir,useContext:ir,useEffect:ir,useImperativeHandle:ir,useLayoutEffect:ir,useMemo:ir,useReducer:ir,useRef:ir,useState:ir,useDebugValue:ir,useDeferredValue:ir,useTransition:ir,useMutableSource:ir,useOpaqueIdentifier:ir,unstable_isNewReconciler:!1},Rr={readContext:no,useCallback:function(e,t){return or().memoizedState=[e,void 0===t?null:t],e},useContext:no,useEffect:Er,useImperativeHandle:function(e,t,i){return i=null!=i?i.concat([e]):null,_r(4,2,yr.bind(null,t,e),i)},useLayoutEffect:function(e,t){return _r(4,2,e,t)},useMemo:function(e,t){var i=or();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=or();return t=void 0!==i?i(t):t,n.memoizedState=n.baseState=t,e=(e=n.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Ar.bind(null,Jo,e),[n.memoizedState,e]},useRef:mr,useState:pr,useDebugValue:Cr,useDeferredValue:function(e){var t=pr(e),i=t[0],n=t[1];return Er((function(){var t=Ko.transition;Ko.transition=1;try{n(e)}finally{Ko.transition=t}}),[e]),i},useTransition:function(){var e=pr(!1),t=e[0];return mr(e=Nr.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,i){var n=or();return n.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:i},hr(n,e,t,i)},useOpaqueIdentifier:function(){if(Fo){var e=!1,t=function(e){return{$$typeof:D,toString:e,valueOf:e}}((function(){throw e||(e=!0,i("r:"+(Yn++).toString(36))),Error(r(355))})),i=pr(t)[1];return 0==(2&Jo.mode)&&(Jo.flags|=516,gr(5,(function(){i("r:"+(Yn++).toString(36))}),void 0,null)),t}return pr(t="r:"+(Yn++).toString(36)),t},unstable_isNewReconciler:!1},wr={readContext:no,useCallback:kr,useContext:no,useEffect:br,useImperativeHandle:vr,useLayoutEffect:Ir,useMemo:Or,useReducer:lr,useRef:fr,useState:function(){return lr(ar)},useDebugValue:Cr,useDeferredValue:function(e){var t=lr(ar),i=t[0],n=t[1];return br((function(){var t=Ko.transition;Ko.transition=1;try{n(e)}finally{Ko.transition=t}}),[e]),i},useTransition:function(){var e=lr(ar)[0];return[fr().current,e]},useMutableSource:dr,useOpaqueIdentifier:function(){return lr(ar)[0]},unstable_isNewReconciler:!1},Lr={readContext:no,useCallback:kr,useContext:no,useEffect:br,useImperativeHandle:vr,useLayoutEffect:Ir,useMemo:Or,useReducer:cr,useRef:fr,useState:function(){return cr(ar)},useDebugValue:Cr,useDeferredValue:function(e){var t=cr(ar),i=t[0],n=t[1];return br((function(){var t=Ko.transition;Ko.transition=1;try{n(e)}finally{Ko.transition=t}}),[e]),i},useTransition:function(){var e=cr(ar)[0];return[fr().current,e]},useMutableSource:dr,useOpaqueIdentifier:function(){return cr(ar)[0]},unstable_isNewReconciler:!1},xr=I.ReactCurrentOwner,$r=!1;function Dr(e,t,i,n){t.child=null===e?ko(t,null,i,n):Co(t,e.child,i,n)}function Mr(e,t,i,n,s){i=i.render;var o=t.ref;return io(t,s),n=sr(e,t,i,n,o,s),null===e||$r?(t.flags|=1,Dr(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~s,ta(e,t,s))}function Pr(e,t,i,n,s,o){if(null===e){var r=i.type;return"function"!=typeof r||Hl(r)||void 0!==r.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=Vl(i.type,null,n,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,Br(e,t,r,n,s,o))}return r=e.child,0==(s&o)&&(s=r.memoizedProps,(i=null!==(i=i.compare)?i:cn)(s,n)&&e.ref===t.ref)?ta(e,t,o):(t.flags|=1,(e=Gl(r,n)).ref=t.ref,e.return=t,t.child=e)}function Br(e,t,i,n,s,o){if(null!==e&&cn(e.memoizedProps,n)&&e.ref===t.ref){if($r=!1,0==(o&s))return t.lanes=e.lanes,ta(e,t,o);0!=(16384&e.flags)&&($r=!0)}return Hr(e,t,i,n,o)}function Fr(e,t,i){var n=t.pendingProps,s=n.children,o=null!==e?e.memoizedState:null;if("hidden"===n.mode||"unstable-defer-without-hiding"===n.mode)if(0==(4&t.mode))t.memoizedState={baseLanes:0},Tl(t,i);else{if(0==(1073741824&i))return e=null!==o?o.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},Tl(t,e),null;t.memoizedState={baseLanes:0},Tl(t,null!==o?o.baseLanes:i)}else null!==o?(n=o.baseLanes|i,t.memoizedState=null):n=i,Tl(t,n);return Dr(e,t,s,i),t.child}function Ur(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=128)}function Hr(e,t,i,n,s){var o=gs(i)?ds:us.current;return o=ps(t,o),io(t,s),i=sr(e,t,i,n,o,s),null===e||$r?(t.flags|=1,Dr(e,t,i,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~s,ta(e,t,s))}function Gr(e,t,i,n,s){if(gs(i)){var o=!0;Ts(t)}else o=!1;if(io(t,s),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),_o(t,i,n),Eo(t,i,n,s),n=!0;else if(null===e){var r=t.stateNode,a=t.memoizedProps;r.props=a;var l=r.context,c=i.contextType;c="object"==typeof c&&null!==c?no(c):ps(t,c=gs(i)?ds:us.current);var u=i.getDerivedStateFromProps,h="function"==typeof u||"function"==typeof r.getSnapshotBeforeUpdate;h||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(a!==n||l!==c)&&To(t,r,n,c),so=!1;var d=t.memoizedState;r.state=d,uo(t,n,r,s),l=t.memoizedState,a!==n||d!==l||hs.current||so?("function"==typeof u&&(go(t,i,u,n),l=t.memoizedState),(a=so||fo(t,i,a,n,d,l,c))?(h||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||("function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"==typeof r.componentDidMount&&(t.flags|=4)):("function"==typeof r.componentDidMount&&(t.flags|=4),t.memoizedProps=n,t.memoizedState=l),r.props=n,r.state=l,r.context=c,n=a):("function"==typeof r.componentDidMount&&(t.flags|=4),n=!1)}else{r=t.stateNode,ro(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:zs(t.type,a),r.props=c,h=t.pendingProps,d=r.context,l="object"==typeof(l=i.contextType)&&null!==l?no(l):ps(t,l=gs(i)?ds:us.current);var p=i.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof r.getSnapshotBeforeUpdate)||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(a!==h||d!==l)&&To(t,r,n,l),so=!1,d=t.memoizedState,r.state=d,uo(t,n,r,s);var g=t.memoizedState;a!==h||d!==g||hs.current||so?("function"==typeof p&&(go(t,i,p,n),g=t.memoizedState),(c=so||fo(t,i,c,n,d,g,l))?(u||"function"!=typeof r.UNSAFE_componentWillUpdate&&"function"!=typeof r.componentWillUpdate||("function"==typeof r.componentWillUpdate&&r.componentWillUpdate(n,g,l),"function"==typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(n,g,l)),"function"==typeof r.componentDidUpdate&&(t.flags|=4),"function"==typeof r.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!=typeof r.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),t.memoizedProps=n,t.memoizedState=g),r.props=n,r.state=g,r.context=l,n=c):("function"!=typeof r.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),n=!1)}return Vr(e,t,i,n,o,s)}function Vr(e,t,i,n,s,o){Ur(e,t);var r=0!=(64&t.flags);if(!n&&!r)return s&&Es(t,i,!1),ta(e,t,o);n=t.stateNode,xr.current=t;var a=r&&"function"!=typeof i.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&r?(t.child=Co(t,e.child,null,o),t.child=Co(t,null,a,o)):Dr(e,t,a,o),t.memoizedState=n.state,s&&Es(t,i,!0),t.child}function jr(e){var t=e.stateNode;t.pendingContext?fs(0,t.pendingContext,t.pendingContext!==t.context):t.context&&fs(0,t.context,!1),wo(e,t.containerInfo)}var Wr,Xr,Yr,zr,Kr={dehydrated:null,retryLane:0};function qr(e,t,i){var n,s=t.pendingProps,o=Do.current,r=!1;return(n=0!=(64&t.flags))||(n=(null===e||null!==e.memoizedState)&&0!=(2&o)),n?(r=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===s.fallback||!0===s.unstable_avoidThisFallback||(o|=1),ls(Do,1&o),null===e?(void 0!==s.fallback&&Go(t),e=s.children,o=s.fallback,r?(e=Jr(t,e,o,i),t.child.memoizedState={baseLanes:i},t.memoizedState=Kr,e):"number"==typeof s.unstable_expectedLoadTime?(e=Jr(t,e,o,i),t.child.memoizedState={baseLanes:i},t.memoizedState=Kr,t.lanes=33554432,e):((i=Wl({mode:"visible",children:e},t.mode,i,null)).return=t,t.child=i)):(e.memoizedState,r?(s=function(e,t,i,n,s){var o=t.mode,r=e.child;e=r.sibling;var a={mode:"hidden",children:i};return 0==(2&o)&&t.child!==r?((i=t.child).childLanes=0,i.pendingProps=a,null!==(r=i.lastEffect)?(t.firstEffect=i.firstEffect,t.lastEffect=r,r.nextEffect=null):t.firstEffect=t.lastEffect=null):i=Gl(r,a),null!==e?n=Gl(e,n):(n=jl(n,o,s,null)).flags|=2,n.return=t,i.return=t,i.sibling=n,t.child=i,n}(e,t,s.children,s.fallback,i),r=t.child,o=e.child.memoizedState,r.memoizedState=null===o?{baseLanes:i}:{baseLanes:o.baseLanes|i},r.childLanes=e.childLanes&~i,t.memoizedState=Kr,s):(i=function(e,t,i,n){var s=e.child;return e=s.sibling,i=Gl(s,{mode:"visible",children:i}),0==(2&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=i}(e,t,s.children,i),t.memoizedState=null,i))}function Jr(e,t,i,n){var s=e.mode,o=e.child;return t={mode:"hidden",children:t},0==(2&s)&&null!==o?(o.childLanes=0,o.pendingProps=t):o=Wl(t,s,0,null),i=jl(i,s,n,null),o.return=e,i.return=e,o.sibling=i,e.child=o,i}function Zr(e,t){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),to(e.return,t)}function Qr(e,t,i,n,s,o){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:s,lastEffect:o}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=n,r.tail=i,r.tailMode=s,r.lastEffect=o)}function ea(e,t,i){var n=t.pendingProps,s=n.revealOrder,o=n.tail;if(Dr(e,t,n.children,i),0!=(2&(n=Do.current)))n=1&n|2,t.flags|=64;else{if(null!==e&&0!=(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Zr(e,i);else if(19===e.tag)Zr(e,i);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(ls(Do,n),0==(2&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(i=t.child,s=null;null!==i;)null!==(e=i.alternate)&&null===Mo(e)&&(s=i),i=i.sibling;null===(i=s)?(s=t.child,t.child=null):(s=i.sibling,i.sibling=null),Qr(t,!1,s,i,o,t.lastEffect);break;case"backwards":for(i=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===Mo(e)){t.child=s;break}e=s.sibling,s.sibling=i,i=s,s=e}Qr(t,!0,i,null,o,t.lastEffect);break;case"together":Qr(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ta(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Pa|=t.lanes,0!=(i&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(i=Gl(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Gl(e,e.pendingProps)).return=t;i.sibling=null}return t.child}return null}function ia(e,t){if(!Fo)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function na(e,t,i){var n=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return gs(t.type)&&ms(),null;case 3:return Lo(),as(hs),as(us),Yo(),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(jo(t)?t.flags|=4:n.hydrate||(t.flags|=256)),Xr(t),null;case 5:$o(t);var o=Ro(So.current);if(i=t.type,null!==e&&null!=t.stateNode)Yr(e,t,i,n,o),e.ref!==t.ref&&(t.flags|=128);else{if(!n){if(null===t.stateNode)throw Error(r(166));return null}if(e=Ro(No.current),jo(t)){n=t.stateNode,i=t.type;var a=t.memoizedProps;switch(n[Kn]=t,n[qn]=a,i){case"dialog":Nn("cancel",n),Nn("close",n);break;case"iframe":case"object":case"embed":Nn("load",n);break;case"video":case"audio":for(e=0;e<vn.length;e++)Nn(vn[e],n);break;case"source":Nn("error",n);break;case"img":case"image":case"link":Nn("error",n),Nn("load",n);break;case"details":Nn("toggle",n);break;case"input":ee(n,a),Nn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},Nn("invalid",n);break;case"textarea":le(n,a),Nn("invalid",n)}for(var c in Ce(i,a),e=null,a)a.hasOwnProperty(c)&&(o=a[c],"children"===c?"string"==typeof o?n.textContent!==o&&(e=["children",o]):"number"==typeof o&&n.textContent!==""+o&&(e=["children",""+o]):l.hasOwnProperty(c)&&null!=o&&"onScroll"===c&&Nn("scroll",n));switch(i){case"input":q(n),ne(n,a,!0);break;case"textarea":q(n),ue(n);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(n.onclick=Pn)}n=e,t.updateQueue=n,null!==n&&(t.flags|=4)}else{switch(c=9===o.nodeType?o:o.ownerDocument,e===he&&(e=pe(i)),e===he?"script"===i?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof n.is?e=c.createElement(i,{is:n.is}):(e=c.createElement(i),"select"===i&&(c=e,n.multiple?c.multiple=!0:n.size&&(c.size=n.size))):e=c.createElementNS(e,i),e[Kn]=t,e[qn]=n,Wr(e,t,!1,!1),t.stateNode=e,c=ke(i,n),i){case"dialog":Nn("cancel",e),Nn("close",e),o=n;break;case"iframe":case"object":case"embed":Nn("load",e),o=n;break;case"video":case"audio":for(o=0;o<vn.length;o++)Nn(vn[o],e);o=n;break;case"source":Nn("error",e),o=n;break;case"img":case"image":case"link":Nn("error",e),Nn("load",e),o=n;break;case"details":Nn("toggle",e),o=n;break;case"input":ee(e,n),o=Q(e,n),Nn("invalid",e);break;case"option":o=oe(e,n);break;case"select":e._wrapperState={wasMultiple:!!n.multiple},o=s({},n,{value:void 0}),Nn("invalid",e);break;case"textarea":le(e,n),o=ae(e,n),Nn("invalid",e);break;default:o=n}Ce(i,o);var u=o;for(a in u)if(u.hasOwnProperty(a)){var h=u[a];"style"===a?ye(e,h):"dangerouslySetInnerHTML"===a?null!=(h=h?h.__html:void 0)&&_e(e,h):"children"===a?"string"==typeof h?("textarea"!==i||""!==h)&&Te(e,h):"number"==typeof h&&Te(e,""+h):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(l.hasOwnProperty(a)?null!=h&&"onScroll"===a&&Nn("scroll",e):null!=h&&b(e,a,h,c))}switch(i){case"input":q(e),ne(e,n,!1);break;case"textarea":q(e),ue(e);break;case"option":null!=n.value&&e.setAttribute("value",""+z(n.value));break;case"select":e.multiple=!!n.multiple,null!=(a=n.value)?re(e,!!n.multiple,a,!1):null!=n.defaultValue&&re(e,!!n.multiple,n.defaultValue,!0);break;default:"function"==typeof o.onClick&&(e.onclick=Pn)}Un(i,n)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)zr(e,t,e.memoizedProps,n);else{if("string"!=typeof n&&null===t.stateNode)throw Error(r(166));i=Ro(So.current),Ro(No.current),jo(t)?(n=t.stateNode,i=t.memoizedProps,n[Kn]=t,n.nodeValue!==i&&(t.flags|=4)):((n=(9===i.nodeType?i:i.ownerDocument).createTextNode(n))[Kn]=t,t.stateNode=n)}return null;case 13:return as(Do),n=t.memoizedState,0!=(64&t.flags)?(t.lanes=i,t):(n=null!==n,i=!1,null===e?void 0!==t.memoizedProps.fallback&&jo(t):i=null!==e.memoizedState,n&&!i&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Do.current)?0===$a&&($a=3):(0!==$a&&3!==$a||($a=4),null===Sa||0==(134217727&Pa)&&0==(134217727&Ba)||gl(Sa,wa))),(n||i)&&(t.flags|=4),null);case 4:return Lo(),Xr(t),null===e&&Sn(t.stateNode.containerInfo),null;case 10:return eo(t),null;case 17:return gs(t.type)&&ms(),null;case 19:if(as(Do),null===(n=t.memoizedState))return null;if(a=0!=(64&t.flags),null===(c=n.rendering))if(a)ia(n,!1);else{if(0!==$a||null!==e&&0!=(64&e.flags))for(e=t.child;null!==e;){if(null!==(c=Mo(e))){for(t.flags|=64,ia(n,!1),null!==(a=c.updateQueue)&&(t.updateQueue=a,t.flags|=4),null===n.lastEffect&&(t.firstEffect=null),t.lastEffect=n.lastEffect,n=i,i=t.child;null!==i;)e=n,(a=i).flags&=2,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return ls(Do,1&Do.current|2),t.child}e=e.sibling}null!==n.tail&&Us()>Ga&&(t.flags|=64,a=!0,ia(n,!1),t.lanes=33554432)}else{if(!a)if(null!==(e=Mo(c))){if(t.flags|=64,a=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),ia(n,!0),null===n.tail&&"hidden"===n.tailMode&&!c.alternate&&!Fo)return null!==(t=t.lastEffect=n.lastEffect)&&(t.nextEffect=null),null}else 2*Us()-n.renderingStartTime>Ga&&1073741824!==i&&(t.flags|=64,a=!0,ia(n,!1),t.lanes=33554432);n.isBackwards?(c.sibling=t.child,t.child=c):(null!==(i=n.last)?i.sibling=c:t.child=c,n.last=c)}return null!==n.tail?(i=n.tail,n.rendering=i,n.tail=i.sibling,n.lastEffect=t.lastEffect,n.renderingStartTime=Us(),i.sibling=null,t=Do.current,ls(Do,a?1&t|2:1&t),i):null;case 23:case 24:return El(),null!==e&&null!==e.memoizedState!=(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==n.mode&&(t.flags|=4),null}throw Error(r(156,t.tag))}function sa(e){switch(e.tag){case 1:gs(e.type)&&ms();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Lo(),as(hs),as(us),Yo(),0!=(64&(t=e.flags)))throw Error(r(285));return e.flags=-4097&t|64,e;case 5:return $o(e),null;case 13:return as(Do),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return as(Do),null;case 4:return Lo(),null;case 10:return eo(e),null;case 23:case 24:return El(),null;default:return null}}function oa(e,t){try{var i="",n=t;do{i+=X(n),n=n.return}while(n);var s=i}catch(e){s="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:s}}function ra(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}Wr=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Xr=function(){},Yr=function(e,t,i,n){var o=e.memoizedProps;if(o!==n){e=t.stateNode,Ro(No.current);var r,a=null;switch(i){case"input":o=Q(e,o),n=Q(e,n),a=[];break;case"option":o=oe(e,o),n=oe(e,n),a=[];break;case"select":o=s({},o,{value:void 0}),n=s({},n,{value:void 0}),a=[];break;case"textarea":o=ae(e,o),n=ae(e,n),a=[];break;default:"function"!=typeof o.onClick&&"function"==typeof n.onClick&&(e.onclick=Pn)}for(h in Ce(i,n),i=null,o)if(!n.hasOwnProperty(h)&&o.hasOwnProperty(h)&&null!=o[h])if("style"===h){var c=o[h];for(r in c)c.hasOwnProperty(r)&&(i||(i={}),i[r]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(l.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in n){var u=n[h];if(c=null!=o?o[h]:void 0,n.hasOwnProperty(h)&&u!==c&&(null!=u||null!=c))if("style"===h)if(c){for(r in c)!c.hasOwnProperty(r)||u&&u.hasOwnProperty(r)||(i||(i={}),i[r]="");for(r in u)u.hasOwnProperty(r)&&c[r]!==u[r]&&(i||(i={}),i[r]=u[r])}else i||(a||(a=[]),a.push(h,i)),i=u;else"dangerouslySetInnerHTML"===h?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(a=a||[]).push(h,u)):"children"===h?"string"!=typeof u&&"number"!=typeof u||(a=a||[]).push(h,""+u):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(l.hasOwnProperty(h)?(null!=u&&"onScroll"===h&&Nn("scroll",e),a||c===u||(a=[])):"object"==typeof u&&null!==u&&u.$$typeof===D?u.toString():(a=a||[]).push(h,u))}i&&(a=a||[]).push("style",i);var h=a;(t.updateQueue=h)&&(t.flags|=4)}},zr=function(e,t,i,n){i!==n&&(t.flags|=4)};var aa="function"==typeof WeakMap?WeakMap:Map;function la(e,t,i){(i=ao(-1,i)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){Xa||(Xa=!0,Ya=n),ra(e,t)},i}function ca(e,t,i){(i=ao(-1,i)).tag=3;var n=e.type.getDerivedStateFromError;if("function"==typeof n){var s=t.value;i.payload=function(){return ra(e,t),n(s)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(i.callback=function(){"function"!=typeof n&&(null===za?za=new Set([this]):za.add(this),ra(e,t));var i=t.stack;this.componentDidCatch(t.value,{componentStack:null!==i?i:""})}),i}var ua="function"==typeof WeakSet?WeakSet:Set;function ha(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Ml(e,t)}else t.current=null}function da(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var i=e.memoizedProps,n=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?i:zs(t.type,i),n),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&jn(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(r(163))}function pa(e,t,i){switch(i.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=i.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3==(3&e.tag)){var n=e.create;e.destroy=n()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=i.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var s=e;n=s.next,0!=(4&(s=s.tag))&&0!=(1&s)&&(xl(i,e),Ll(i,e)),e=n}while(e!==t)}return;case 1:return e=i.stateNode,4&i.flags&&(null===t?e.componentDidMount():(n=i.elementType===i.type?t.memoizedProps:zs(i.type,t.memoizedProps),e.componentDidUpdate(n,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=i.updateQueue)&&ho(i,t,e));case 3:if(null!==(t=i.updateQueue)){if(e=null,null!==i.child)switch(i.child.tag){case 5:e=i.child.stateNode;break;case 1:e=i.child.stateNode}ho(i,t,e)}return;case 5:return e=i.stateNode,void(null===t&&4&i.flags&&Un(i.type,i.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===i.memoizedState&&(i=i.alternate,null!==i&&(i=i.memoizedState,null!==i&&(i=i.dehydrated,null!==i&&yt(i)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(r(163))}function ga(e,t){for(var i=e;;){if(5===i.tag){var n=i.stateNode;if(t)"function"==typeof(n=n.style).setProperty?n.setProperty("display","none","important"):n.display="none";else{n=i.stateNode;var s=i.memoizedProps.style;s=null!=s&&s.hasOwnProperty("display")?s.display:null,n.style.display=Ie("display",s)}}else if(6===i.tag)i.stateNode.nodeValue=t?"":i.memoizedProps;else if((23!==i.tag&&24!==i.tag||null===i.memoizedState||i===e)&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function ma(e,t){if(Is&&"function"==typeof Is.onCommitFiberUnmount)try{Is.onCommitFiberUnmount(bs,t)}catch(e){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var i=e=e.next;do{var n=i,s=n.destroy;if(n=n.tag,void 0!==s)if(0!=(4&n))xl(t,i);else{n=t;try{s()}catch(e){Ml(n,e)}}i=i.next}while(i!==e)}break;case 1:if(ha(t),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(e){Ml(t,e)}break;case 5:ha(t);break;case 4:Ia(e,t)}}function fa(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function _a(e){return 5===e.tag||3===e.tag||4===e.tag}function Ta(e){e:{for(var t=e.return;null!==t;){if(_a(t))break e;t=t.return}throw Error(r(160))}var i=t;switch(t=i.stateNode,i.tag){case 5:var n=!1;break;case 3:case 4:t=t.containerInfo,n=!0;break;default:throw Error(r(161))}16&i.flags&&(Te(t,""),i.flags&=-17);e:t:for(i=e;;){for(;null===i.sibling;){if(null===i.return||_a(i.return)){i=null;break e}i=i.return}for(i.sibling.return=i.return,i=i.sibling;5!==i.tag&&6!==i.tag&&18!==i.tag;){if(2&i.flags)continue t;if(null===i.child||4===i.tag)continue t;i.child.return=i,i=i.child}if(!(2&i.flags)){i=i.stateNode;break e}}n?Ea(e,i,t):ba(e,i,t)}function Ea(e,t,i){var n=e.tag,s=5===n||6===n;if(s)e=s?e.stateNode:e.stateNode.instance,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!=(i=i._reactRootContainer)||null!==t.onclick||(t.onclick=Pn));else if(4!==n&&null!==(e=e.child))for(Ea(e,t,i),e=e.sibling;null!==e;)Ea(e,t,i),e=e.sibling}function ba(e,t,i){var n=e.tag,s=5===n||6===n;if(s)e=s?e.stateNode:e.stateNode.instance,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==n&&null!==(e=e.child))for(ba(e,t,i),e=e.sibling;null!==e;)ba(e,t,i),e=e.sibling}function Ia(e,t){for(var i,n,s=t,o=!1;;){if(!o){o=s.return;e:for(;;){if(null===o)throw Error(r(160));switch(i=o.stateNode,o.tag){case 5:n=!1;break e;case 3:case 4:i=i.containerInfo,n=!0;break e}o=o.return}o=!0}if(5===s.tag||6===s.tag){e:for(var a=e,l=s,c=l;;)if(ma(a,c),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===l)break e;for(;null===c.sibling;){if(null===c.return||c.return===l)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}n?(a=i,l=s.stateNode,8===a.nodeType?a.parentNode.removeChild(l):a.removeChild(l)):i.removeChild(s.stateNode)}else if(4===s.tag){if(null!==s.child){i=s.stateNode.containerInfo,n=!0,s.child.return=s,s=s.child;continue}}else if(ma(e,s),null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break;for(;null===s.sibling;){if(null===s.return||s.return===t)return;4===(s=s.return).tag&&(o=!1)}s.sibling.return=s.return,s=s.sibling}}function ya(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var n=i=i.next;do{3==(3&n.tag)&&(e=n.destroy,n.destroy=void 0,void 0!==e&&e()),n=n.next}while(n!==i)}return;case 1:return;case 5:if(null!=(i=t.stateNode)){n=t.memoizedProps;var s=null!==e?e.memoizedProps:n;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(i[qn]=n,"input"===e&&"radio"===n.type&&null!=n.name&&te(i,n),ke(e,s),t=ke(e,n),s=0;s<o.length;s+=2){var a=o[s],l=o[s+1];"style"===a?ye(i,l):"dangerouslySetInnerHTML"===a?_e(i,l):"children"===a?Te(i,l):b(i,a,l,t)}switch(e){case"input":ie(i,n);break;case"textarea":ce(i,n);break;case"select":e=i._wrapperState.wasMultiple,i._wrapperState.wasMultiple=!!n.multiple,null!=(o=n.value)?re(i,!!n.multiple,o,!1):e!==!!n.multiple&&(null!=n.defaultValue?re(i,!!n.multiple,n.defaultValue,!0):re(i,!!n.multiple,n.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(r(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((i=t.stateNode).hydrate&&(i.hydrate=!1,yt(i.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(Ha=Us(),ga(t.child,!0)),void va(t);case 19:return void va(t);case 17:return;case 23:case 24:return void ga(t,null!==t.memoizedState)}throw Error(r(163))}function va(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new ua),t.forEach((function(t){var n=Bl.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))}))}}function Ca(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&null!==(t=t.memoizedState)&&null===t.dehydrated}var ka=Math.ceil,Oa=I.ReactCurrentDispatcher,Na=I.ReactCurrentOwner,Aa=0,Sa=null,Ra=null,wa=0,La=0,xa=rs(0),$a=0,Da=null,Ma=0,Pa=0,Ba=0,Fa=0,Ua=null,Ha=0,Ga=1/0;function Va(){Ga=Us()+500}var ja,Wa=null,Xa=!1,Ya=null,za=null,Ka=!1,qa=null,Ja=90,Za=[],Qa=[],el=null,tl=0,il=null,nl=-1,sl=0,ol=0,rl=null,al=!1;function ll(){return 0!=(48&Aa)?Us():-1!==nl?nl:nl=Us()}function cl(e){if(0==(2&(e=e.mode)))return 1;if(0==(4&e))return 99===Hs()?1:2;if(0===sl&&(sl=Ma),0!==Ys.transition){0!==ol&&(ol=null!==Ua?Ua.pendingLanes:0),e=sl;var t=4186112&~ol;return 0==(t&=-t)&&0==(t=(e=4186112&~e)&-e)&&(t=8192),t}return e=Hs(),e=Ut(0!=(4&Aa)&&98===e?12:e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),sl)}function ul(e,t,i){if(50<tl)throw tl=0,il=null,Error(r(185));if(null===(e=hl(e,t)))return null;Vt(e,t,i),e===Sa&&(Ba|=t,4===$a&&gl(e,wa));var n=Hs();1===t?0!=(8&Aa)&&0==(48&Aa)?ml(e):(dl(e,i),0===Aa&&(Va(),Ws())):(0==(4&Aa)||98!==n&&99!==n||(null===el?el=new Set([e]):el.add(e)),dl(e,i)),Ua=e}function hl(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}function dl(e,t){for(var i=e.callbackNode,n=e.suspendedLanes,s=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var l=31-jt(a),c=1<<l,u=o[l];if(-1===u){if(0==(c&n)||0!=(c&s)){u=t,Pt(c);var h=Mt;o[l]=10<=h?u+250:6<=h?u+5e3:-1}}else u<=t&&(e.expiredLanes|=c);a&=~c}if(n=Bt(e,e===Sa?wa:0),t=Mt,0===n)null!==i&&(i!==$s&&Cs(i),e.callbackNode=null,e.callbackPriority=0);else{if(null!==i){if(e.callbackPriority===t)return;i!==$s&&Cs(i)}15===t?(i=ml.bind(null,e),null===Ms?(Ms=[i],Ps=vs(Ss,Xs)):Ms.push(i),i=$s):i=14===t?js(99,ml.bind(null,e)):js(i=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(r(358,e))}}(t),pl.bind(null,e)),e.callbackPriority=t,e.callbackNode=i}}function pl(e){if(nl=-1,ol=sl=0,0!=(48&Aa))throw Error(r(327));var t=e.callbackNode;if(wl()&&e.callbackNode!==t)return null;var i=Bt(e,e===Sa?wa:0);if(0===i)return null;var n=i,s=Aa;Aa|=16;var o=yl();for(Sa===e&&wa===n||(Va(),bl(e,n));;)try{kl();break}catch(t){Il(e,t)}if(Qs(),Oa.current=o,Aa=s,null!==Ra?n=0:(Sa=null,wa=0,n=$a),0!=(Ma&Ba))bl(e,0);else if(0!==n){if(2===n&&(Aa|=64,e.hydrate&&(e.hydrate=!1,jn(e.containerInfo)),0!==(i=Ft(e))&&(n=vl(e,i))),1===n)throw t=Da,bl(e,0),gl(e,i),dl(e,Us()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=i,n){case 0:case 1:throw Error(r(345));case 2:Al(e);break;case 3:if(gl(e,i),(62914560&i)===i&&10<(n=Ha+500-Us())){if(0!==Bt(e,0))break;if(((s=e.suspendedLanes)&i)!==i){ll(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=Gn(Al.bind(null,e),n);break}Al(e);break;case 4:if(gl(e,i),(4186112&i)===i)break;for(n=e.eventTimes,s=-1;0<i;){var a=31-jt(i);o=1<<a,(a=n[a])>s&&(s=a),i&=~o}if(i=s,10<(i=(120>(i=Us()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*ka(i/1960))-i)){e.timeoutHandle=Gn(Al.bind(null,e),i);break}Al(e);break;case 5:Al(e);break;default:throw Error(r(329))}}return dl(e,Us()),e.callbackNode===t?pl.bind(null,e):null}function gl(e,t){for(t&=~Fa,t&=~Ba,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-jt(t),n=1<<i;e[i]=-1,t&=~n}}function ml(e){if(0!=(48&Aa))throw Error(r(327));if(wl(),e===Sa&&0!=(e.expiredLanes&wa)){var t=wa,i=vl(e,t);0!=(Ma&Ba)&&(i=vl(e,t=Bt(e,t)))}else i=vl(e,t=Bt(e,0));if(0!==e.tag&&2===i&&(Aa|=64,e.hydrate&&(e.hydrate=!1,jn(e.containerInfo)),0!==(t=Ft(e))&&(i=vl(e,t))),1===i)throw i=Da,bl(e,0),gl(e,t),dl(e,Us()),i;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Al(e),dl(e,Us()),null}function fl(e,t){var i=Aa;Aa|=1;try{return e(t)}finally{0===(Aa=i)&&(Va(),Ws())}}function _l(e,t){var i=Aa;Aa&=-2,Aa|=8;try{return e(t)}finally{0===(Aa=i)&&(Va(),Ws())}}function Tl(e,t){ls(xa,La),La|=t,Ma|=t}function El(){La=xa.current,as(xa)}function bl(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,Vn(i)),null!==Ra)for(i=Ra.return;null!==i;){var n=i;switch(n.tag){case 1:null!=(n=n.type.childContextTypes)&&ms();break;case 3:Lo(),as(hs),as(us),Yo();break;case 5:$o(n);break;case 4:Lo();break;case 13:case 19:as(Do);break;case 10:eo(n);break;case 23:case 24:El()}i=i.return}Sa=e,Ra=Gl(e.current,null),wa=La=Ma=t,$a=0,Da=null,Fa=Ba=Pa=0}function Il(e,t){for(;;){var i=Ra;try{if(Qs(),zo.current=Sr,er){for(var n=Jo.memoizedState;null!==n;){var s=n.queue;null!==s&&(s.pending=null),n=n.next}er=!1}if(qo=0,Qo=Zo=Jo=null,tr=!1,Na.current=null,null===i||null===i.return){$a=1,Da=t,Ra=null;break}e:{var o=e,r=i.return,a=i,l=t;if(t=wa,a.flags|=2048,a.firstEffect=a.lastEffect=null,null!==l&&"object"==typeof l&&"function"==typeof l.then){var c=l;if(0==(2&a.mode)){var u=a.alternate;u?(a.updateQueue=u.updateQueue,a.memoizedState=u.memoizedState,a.lanes=u.lanes):(a.updateQueue=null,a.memoizedState=null)}var h=0!=(1&Do.current),d=r;do{var p;if(p=13===d.tag){var g=d.memoizedState;if(null!==g)p=null!==g.dehydrated;else{var m=d.memoizedProps;p=void 0!==m.fallback&&(!0!==m.unstable_avoidThisFallback||!h)}}if(p){var f=d.updateQueue;if(null===f){var _=new Set;_.add(c),d.updateQueue=_}else f.add(c);if(0==(2&d.mode)){if(d.flags|=64,a.flags|=16384,a.flags&=-2981,1===a.tag)if(null===a.alternate)a.tag=17;else{var T=ao(-1,1);T.tag=2,lo(a,T)}a.lanes|=1;break e}l=void 0,a=t;var E=o.pingCache;if(null===E?(E=o.pingCache=new aa,l=new Set,E.set(c,l)):void 0===(l=E.get(c))&&(l=new Set,E.set(c,l)),!l.has(a)){l.add(a);var b=Pl.bind(null,o,c,a);c.then(b,b)}d.flags|=4096,d.lanes=t;break e}d=d.return}while(null!==d);l=Error((Y(a.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==$a&&($a=2),l=oa(l,a),d=r;do{switch(d.tag){case 3:o=l,d.flags|=4096,t&=-t,d.lanes|=t,co(d,la(d,o,t));break e;case 1:o=l;var I=d.type,y=d.stateNode;if(0==(64&d.flags)&&("function"==typeof I.getDerivedStateFromError||null!==y&&"function"==typeof y.componentDidCatch&&(null===za||!za.has(y)))){d.flags|=4096,t&=-t,d.lanes|=t,co(d,ca(d,o,t));break e}}d=d.return}while(null!==d)}Nl(i)}catch(e){t=e,Ra===i&&null!==i&&(Ra=i=i.return);continue}break}}function yl(){var e=Oa.current;return Oa.current=Sr,null===e?Sr:e}function vl(e,t){var i=Aa;Aa|=16;var n=yl();for(Sa===e&&wa===t||bl(e,t);;)try{Cl();break}catch(t){Il(e,t)}if(Qs(),Aa=i,Oa.current=n,null!==Ra)throw Error(r(261));return Sa=null,wa=0,$a}function Cl(){for(;null!==Ra;)Ol(Ra)}function kl(){for(;null!==Ra&&!ks();)Ol(Ra)}function Ol(e){var t=ja(e.alternate,e,La);e.memoizedProps=e.pendingProps,null===t?Nl(e):Ra=t,Na.current=null}function Nl(e){var t=e;do{var i=t.alternate;if(e=t.return,0==(2048&t.flags)){if(null!==(i=na(i,t,La)))return void(Ra=i);if(24!==(i=t).tag&&23!==i.tag||null===i.memoizedState||0!=(1073741824&La)||0==(4&i.mode)){for(var n=0,s=i.child;null!==s;)n|=s.lanes|s.childLanes,s=s.sibling;i.childLanes=n}null!==e&&0==(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(i=sa(t)))return i.flags&=2047,void(Ra=i);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Ra=t);Ra=t=e}while(null!==t);0===$a&&($a=5)}function Al(e){var t=Hs();return Vs(99,Sl.bind(null,e,t)),null}function Sl(e,t){do{wl()}while(null!==qa);if(0!=(48&Aa))throw Error(r(327));var i=e.finishedWork;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(r(177));e.callbackNode=null;var n=i.lanes|i.childLanes,s=n,o=e.pendingLanes&~s;e.pendingLanes=s,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=s,e.mutableReadLanes&=s,e.entangledLanes&=s,s=e.entanglements;for(var a=e.eventTimes,l=e.expirationTimes;0<o;){var c=31-jt(o),u=1<<c;s[c]=0,a[c]=-1,l[c]=-1,o&=~u}if(null!==el&&0==(24&n)&&el.has(e)&&el.delete(e),e===Sa&&(Ra=Sa=null,wa=0),1<i.flags?null!==i.lastEffect?(i.lastEffect.nextEffect=i,n=i.firstEffect):n=i:n=i.firstEffect,null!==n){if(s=Aa,Aa|=32,Na.current=null,Bn=Kt,gn(a=pn())){if("selectionStart"in a)l={start:a.selectionStart,end:a.selectionEnd};else e:if(l=(l=a.ownerDocument)&&l.defaultView||window,(u=l.getSelection&&l.getSelection())&&0!==u.rangeCount){l=u.anchorNode,o=u.anchorOffset,c=u.focusNode,u=u.focusOffset;try{l.nodeType,c.nodeType}catch(e){l=null;break e}var h=0,d=-1,p=-1,g=0,m=0,f=a,_=null;t:for(;;){for(var T;f!==l||0!==o&&3!==f.nodeType||(d=h+o),f!==c||0!==u&&3!==f.nodeType||(p=h+u),3===f.nodeType&&(h+=f.nodeValue.length),null!==(T=f.firstChild);)_=f,f=T;for(;;){if(f===a)break t;if(_===l&&++g===o&&(d=h),_===c&&++m===u&&(p=h),null!==(T=f.nextSibling))break;_=(f=_).parentNode}f=T}l=-1===d||-1===p?null:{start:d,end:p}}else l=null;l=l||{start:0,end:0}}else l=null;Fn={focusedElem:a,selectionRange:l},Kt=!1,rl=null,al=!1,Wa=n;do{try{Rl()}catch(e){if(null===Wa)throw Error(r(330));Ml(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);rl=null,Wa=n;do{try{for(a=e;null!==Wa;){var E=Wa.flags;if(16&E&&Te(Wa.stateNode,""),128&E){var b=Wa.alternate;if(null!==b){var I=b.ref;null!==I&&("function"==typeof I?I(null):I.current=null)}}switch(1038&E){case 2:Ta(Wa),Wa.flags&=-3;break;case 6:Ta(Wa),Wa.flags&=-3,ya(Wa.alternate,Wa);break;case 1024:Wa.flags&=-1025;break;case 1028:Wa.flags&=-1025,ya(Wa.alternate,Wa);break;case 4:ya(Wa.alternate,Wa);break;case 8:Ia(a,l=Wa);var y=l.alternate;fa(l),null!==y&&fa(y)}Wa=Wa.nextEffect}}catch(e){if(null===Wa)throw Error(r(330));Ml(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);if(I=Fn,b=pn(),E=I.focusedElem,a=I.selectionRange,b!==E&&E&&E.ownerDocument&&dn(E.ownerDocument.documentElement,E)){null!==a&&gn(E)&&(b=a.start,void 0===(I=a.end)&&(I=b),"selectionStart"in E?(E.selectionStart=b,E.selectionEnd=Math.min(I,E.value.length)):(I=(b=E.ownerDocument||document)&&b.defaultView||window).getSelection&&(I=I.getSelection(),l=E.textContent.length,y=Math.min(a.start,l),a=void 0===a.end?y:Math.min(a.end,l),!I.extend&&y>a&&(l=a,a=y,y=l),l=hn(E,y),o=hn(E,a),l&&o&&(1!==I.rangeCount||I.anchorNode!==l.node||I.anchorOffset!==l.offset||I.focusNode!==o.node||I.focusOffset!==o.offset)&&((b=b.createRange()).setStart(l.node,l.offset),I.removeAllRanges(),y>a?(I.addRange(b),I.extend(o.node,o.offset)):(b.setEnd(o.node,o.offset),I.addRange(b))))),b=[];for(I=E;I=I.parentNode;)1===I.nodeType&&b.push({element:I,left:I.scrollLeft,top:I.scrollTop});for("function"==typeof E.focus&&E.focus(),E=0;E<b.length;E++)(I=b[E]).element.scrollLeft=I.left,I.element.scrollTop=I.top}Kt=!!Bn,Fn=Bn=null,e.current=i,Wa=n;do{try{for(E=e;null!==Wa;){var v=Wa.flags;if(36&v&&pa(E,Wa.alternate,Wa),128&v){b=void 0;var C=Wa.ref;if(null!==C){var k=Wa.stateNode;switch(Wa.tag){case 5:b=k;break;default:b=k}"function"==typeof C?C(b):C.current=b}}Wa=Wa.nextEffect}}catch(e){if(null===Wa)throw Error(r(330));Ml(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);Wa=null,Ds(),Aa=s}else e.current=i;if(Ka)Ka=!1,qa=e,Ja=t;else for(Wa=n;null!==Wa;)t=Wa.nextEffect,Wa.nextEffect=null,8&Wa.flags&&((v=Wa).sibling=null,v.stateNode=null),Wa=t;if(0===(n=e.pendingLanes)&&(za=null),1===n?e===il?tl++:(tl=0,il=e):tl=0,i=i.stateNode,Is&&"function"==typeof Is.onCommitFiberRoot)try{Is.onCommitFiberRoot(bs,i,void 0,64==(64&i.current.flags))}catch(e){}if(dl(e,Us()),Xa)throw Xa=!1,e=Ya,Ya=null,e;return 0!=(8&Aa)||Ws(),null}function Rl(){for(;null!==Wa;){var e=Wa.alternate;al||null===rl||(0!=(8&Wa.flags)?et(Wa,rl)&&(al=!0):13===Wa.tag&&Ca(e,Wa)&&et(Wa,rl)&&(al=!0));var t=Wa.flags;0!=(256&t)&&da(e,Wa),0==(512&t)||Ka||(Ka=!0,js(97,(function(){return wl(),null}))),Wa=Wa.nextEffect}}function wl(){if(90!==Ja){var e=97<Ja?97:Ja;return Ja=90,Vs(e,$l)}return!1}function Ll(e,t){Za.push(t,e),Ka||(Ka=!0,js(97,(function(){return wl(),null})))}function xl(e,t){Qa.push(t,e),Ka||(Ka=!0,js(97,(function(){return wl(),null})))}function $l(){if(null===qa)return!1;var e=qa;if(qa=null,0!=(48&Aa))throw Error(r(331));var t=Aa;Aa|=32;var i=Qa;Qa=[];for(var n=0;n<i.length;n+=2){var s=i[n],o=i[n+1],a=s.destroy;if(s.destroy=void 0,"function"==typeof a)try{a()}catch(e){if(null===o)throw Error(r(330));Ml(o,e)}}for(i=Za,Za=[],n=0;n<i.length;n+=2){s=i[n],o=i[n+1];try{var l=s.create;s.destroy=l()}catch(e){if(null===o)throw Error(r(330));Ml(o,e)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return Aa=t,Ws(),!0}function Dl(e,t,i){lo(e,t=la(e,t=oa(i,t),1)),t=ll(),null!==(e=hl(e,1))&&(Vt(e,1,t),dl(e,t))}function Ml(e,t){if(3===e.tag)Dl(e,e,t);else for(var i=e.return;null!==i;){if(3===i.tag){Dl(i,e,t);break}if(1===i.tag){var n=i.stateNode;if("function"==typeof i.type.getDerivedStateFromError||"function"==typeof n.componentDidCatch&&(null===za||!za.has(n))){var s=ca(i,e=oa(t,e),1);if(lo(i,s),s=ll(),null!==(i=hl(i,1)))Vt(i,1,s),dl(i,s);else if("function"==typeof n.componentDidCatch&&(null===za||!za.has(n)))try{n.componentDidCatch(t,e)}catch(e){}break}}i=i.return}}function Pl(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),t=ll(),e.pingedLanes|=e.suspendedLanes&i,Sa===e&&(wa&i)===i&&(4===$a||3===$a&&(62914560&wa)===wa&&500>Us()-Ha?bl(e,0):Fa|=i),dl(e,t)}function Bl(e,t){var i=e.stateNode;null!==i&&i.delete(t),0==(t=0)&&(0==(2&(t=e.mode))?t=1:0==(4&t)?t=99===Hs()?1:2:(0===sl&&(sl=Ma),0===(t=Ht(62914560&~sl))&&(t=4194304))),i=ll(),null!==(e=hl(e,t))&&(Vt(e,t,i),dl(e,i))}function Fl(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Ul(e,t,i,n){return new Fl(e,t,i,n)}function Hl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Gl(e,t){var i=e.alternate;return null===i?((i=Ul(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null),i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Vl(e,t,i,n,s,o){var a=2;if(n=e,"function"==typeof e)Hl(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case C:return jl(i.children,s,o,t);case M:a=8,s|=16;break;case k:a=8,s|=1;break;case O:return(e=Ul(12,i,t,8|s)).elementType=O,e.type=O,e.lanes=o,e;case R:return(e=Ul(13,i,t,s)).type=R,e.elementType=R,e.lanes=o,e;case w:return(e=Ul(19,i,t,s)).elementType=w,e.lanes=o,e;case P:return Wl(i,s,o,t);case B:return(e=Ul(24,i,t,s)).elementType=B,e.lanes=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case N:a=10;break e;case A:a=9;break e;case S:a=11;break e;case L:a=14;break e;case x:a=16,n=null;break e;case $:a=22;break e}throw Error(r(130,null==e?e:typeof e,""))}return(t=Ul(a,i,t,s)).elementType=e,t.type=n,t.lanes=o,t}function jl(e,t,i,n){return(e=Ul(7,e,n,t)).lanes=i,e}function Wl(e,t,i,n){return(e=Ul(23,e,n,t)).elementType=P,e.lanes=i,e}function Xl(e,t,i){return(e=Ul(6,e,null,t)).lanes=i,e}function Yl(e,t,i){return(t=Ul(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zl(e,t,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=i,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Gt(0),this.expirationTimes=Gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gt(0),this.mutableSourceEagerHydrationData=null}function Kl(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:v,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}function ql(e,t,i,n){var s=t.current,o=ll(),a=cl(s);e:if(i){t:{if(qe(i=i._reactInternals)!==i||1!==i.tag)throw Error(r(170));var l=i;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(gs(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(r(171))}if(1===i.tag){var c=i.type;if(gs(c)){i=_s(i,c,l);break e}}i=l}else i=cs;return null===t.context?t.context=i:t.pendingContext=i,(t=ao(o,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),lo(s,t),ul(s,a,o),a}function Jl(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Zl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function Ql(e,t){Zl(e,t),(e=e.alternate)&&Zl(e,t)}function ec(e,t,i){var n=null!=i&&null!=i.hydrationOptions&&i.hydrationOptions.mutableSources||null;if(i=new zl(e,t,null!=i&&!0===i.hydrate),t=Ul(3,null,null,2===t?7:1===t?3:0),i.current=t,t.stateNode=i,oo(t),e[Jn]=i.current,Sn(8===e.nodeType?e.parentNode:e),n)for(e=0;e<n.length;e++){var s=(t=n[e])._getVersion;s=s(t._source),null==i.mutableSourceEagerHydrationData?i.mutableSourceEagerHydrationData=[t,s]:i.mutableSourceEagerHydrationData.push(t,s)}this._internalRoot=i}function tc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ic(e,t,i,n,s){var o=i._reactRootContainer;if(o){var r=o._internalRoot;if("function"==typeof s){var a=s;s=function(){var e=Jl(r);a.call(e)}}ql(t,r,e,s)}else{if(o=i._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var i;i=e.lastChild;)e.removeChild(i);return new ec(e,0,t?{hydrate:!0}:void 0)}(i,n),r=o._internalRoot,"function"==typeof s){var l=s;s=function(){var e=Jl(r);l.call(e)}}_l((function(){ql(t,r,e,s)}))}return Jl(r)}function nc(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!tc(t))throw Error(r(200));return Kl(e,t,null,i)}ja=function(e,t,i){var n=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||hs.current)$r=!0;else{if(0==(i&n)){switch($r=!1,t.tag){case 3:jr(t),Wo();break;case 5:xo(t);break;case 1:gs(t.type)&&Ts(t);break;case 4:wo(t,t.stateNode.containerInfo);break;case 10:n=t.memoizedProps.value;var s=t.type._context;ls(Ks,s._currentValue),s._currentValue=n;break;case 13:if(null!==t.memoizedState)return 0!=(i&t.child.childLanes)?qr(e,t,i):(ls(Do,1&Do.current),null!==(t=ta(e,t,i))?t.sibling:null);ls(Do,1&Do.current);break;case 19:if(n=0!=(i&t.childLanes),0!=(64&e.flags)){if(n)return ea(e,t,i);t.flags|=64}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),ls(Do,Do.current),n)break;return null;case 23:case 24:return t.lanes=0,Fr(e,t,i)}return ta(e,t,i)}$r=0!=(16384&e.flags)}else $r=!1;switch(t.lanes=0,t.tag){case 2:if(n=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,s=ps(t,us.current),io(t,i),s=sr(null,t,n,e,s,i),t.flags|=1,"object"==typeof s&&null!==s&&"function"==typeof s.render&&void 0===s.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,gs(n)){var o=!0;Ts(t)}else o=!1;t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,oo(t);var a=n.getDerivedStateFromProps;"function"==typeof a&&go(t,n,a,e),s.updater=mo,t.stateNode=s,s._reactInternals=t,Eo(t,n,e,i),t=Vr(null,t,n,!0,o,i)}else t.tag=0,Dr(null,t,s,i),t=t.child;return t;case 16:s=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,s=(o=s._init)(s._payload),t.type=s,o=t.tag=function(e){if("function"==typeof e)return Hl(e)?1:0;if(null!=e){if((e=e.$$typeof)===S)return 11;if(e===L)return 14}return 2}(s),e=zs(s,e),o){case 0:t=Hr(null,t,s,e,i);break e;case 1:t=Gr(null,t,s,e,i);break e;case 11:t=Mr(null,t,s,e,i);break e;case 14:t=Pr(null,t,s,zs(s.type,e),n,i);break e}throw Error(r(306,s,""))}return t;case 0:return n=t.type,s=t.pendingProps,Hr(e,t,n,s=t.elementType===n?s:zs(n,s),i);case 1:return n=t.type,s=t.pendingProps,Gr(e,t,n,s=t.elementType===n?s:zs(n,s),i);case 3:if(jr(t),n=t.updateQueue,null===e||null===n)throw Error(r(282));if(n=t.pendingProps,s=null!==(s=t.memoizedState)?s.element:null,ro(e,t),uo(t,n,null,i),(n=t.memoizedState.element)===s)Wo(),t=ta(e,t,i);else{if((o=(s=t.stateNode).hydrate)&&(Bo=Wn(t.stateNode.containerInfo.firstChild),Po=t,o=Fo=!0),o){if(null!=(e=s.mutableSourceEagerHydrationData))for(s=0;s<e.length;s+=2)(o=e[s])._workInProgressVersionPrimary=e[s+1],Xo.push(o);for(i=ko(t,null,n,i),t.child=i;i;)i.flags=-3&i.flags|1024,i=i.sibling}else Dr(e,t,n,i),Wo();t=t.child}return t;case 5:return xo(t),null===e&&Go(t),n=t.type,s=t.pendingProps,o=null!==e?e.memoizedProps:null,a=s.children,Hn(n,s)?a=null:null!==o&&Hn(n,o)&&(t.flags|=16),Ur(e,t),Dr(e,t,a,i),t.child;case 6:return null===e&&Go(t),null;case 13:return qr(e,t,i);case 4:return wo(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Co(t,null,n,i):Dr(e,t,n,i),t.child;case 11:return n=t.type,s=t.pendingProps,Mr(e,t,n,s=t.elementType===n?s:zs(n,s),i);case 7:return Dr(e,t,t.pendingProps,i),t.child;case 8:case 12:return Dr(e,t,t.pendingProps.children,i),t.child;case 10:e:{n=t.type._context,s=t.pendingProps,a=t.memoizedProps,o=s.value;var l=t.type._context;if(ls(Ks,l._currentValue),l._currentValue=o,null!==a)if(l=a.value,0==(o=an(l,o)?0:0|("function"==typeof n._calculateChangedBits?n._calculateChangedBits(l,o):1073741823))){if(a.children===s.children&&!hs.current){t=ta(e,t,i);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){a=l.child;for(var u=c.firstContext;null!==u;){if(u.context===n&&0!=(u.observedBits&o)){1===l.tag&&((u=ao(-1,i&-i)).tag=2,lo(l,u)),l.lanes|=i,null!==(u=l.alternate)&&(u.lanes|=i),to(l.return,i),c.lanes|=i;break}u=u.next}}else a=10===l.tag&&l.type===t.type?null:l.child;if(null!==a)a.return=l;else for(a=l;null!==a;){if(a===t){a=null;break}if(null!==(l=a.sibling)){l.return=a.return,a=l;break}a=a.return}l=a}Dr(e,t,s.children,i),t=t.child}return t;case 9:return s=t.type,n=(o=t.pendingProps).children,io(t,i),n=n(s=no(s,o.unstable_observedBits)),t.flags|=1,Dr(e,t,n,i),t.child;case 14:return o=zs(s=t.type,t.pendingProps),Pr(e,t,s,o=zs(s.type,o),n,i);case 15:return Br(e,t,t.type,t.pendingProps,n,i);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:zs(n,s),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,gs(n)?(e=!0,Ts(t)):e=!1,io(t,i),_o(t,n,s),Eo(t,n,s,i),Vr(null,t,n,!0,e,i);case 19:return ea(e,t,i);case 23:case 24:return Fr(e,t,i)}throw Error(r(156,t.tag))},ec.prototype.render=function(e){ql(e,this._internalRoot,null,null)},ec.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;ql(null,e,null,(function(){t[Jn]=null}))},tt=function(e){13===e.tag&&(ul(e,4,ll()),Ql(e,4))},it=function(e){13===e.tag&&(ul(e,67108864,ll()),Ql(e,67108864))},nt=function(e){if(13===e.tag){var t=ll(),i=cl(e);ul(e,i,t),Ql(e,i)}},st=function(e,t){return t()},Ne=function(e,t,i){switch(t){case"input":if(ie(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var s=is(n);if(!s)throw Error(r(90));J(n),ie(n,s)}}}break;case"textarea":ce(e,i);break;case"select":null!=(t=i.value)&&re(e,!!i.multiple,t,!1)}},xe=fl,$e=function(e,t,i,n,s){var o=Aa;Aa|=4;try{return Vs(98,e.bind(null,t,i,n,s))}finally{0===(Aa=o)&&(Va(),Ws())}},De=function(){0==(49&Aa)&&(function(){if(null!==el){var e=el;el=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,dl(e,Us())}))}Ws()}(),wl())},Me=function(e,t){var i=Aa;Aa|=2;try{return e(t)}finally{0===(Aa=i)&&(Va(),Ws())}};var sc={Events:[es,ts,is,we,Le,wl,{current:!1}]},oc={findFiberByHostInstance:Qn,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},rc={bundleType:oc.bundleType,version:oc.version,rendererPackageName:oc.rendererPackageName,rendererConfig:oc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:I.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Qe(e))?null:e.stateNode},findFiberByHostInstance:oc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ac=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ac.isDisabled&&ac.supportsFiber)try{bs=ac.inject(rc),Is=ac}catch(fe){}}i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sc,i.createPortal=nc,i.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(r(188));throw Error(r(268,Object.keys(e)))}return null===(e=Qe(t))?null:e.stateNode},i.flushSync=function(e,t){var i=Aa;if(0!=(48&i))return e(t);Aa|=1;try{if(e)return Vs(99,e.bind(null,t))}finally{Aa=i,Ws()}},i.hydrate=function(e,t,i){if(!tc(t))throw Error(r(200));return ic(null,e,t,!0,i)},i.render=function(e,t,i){if(!tc(t))throw Error(r(200));return ic(null,e,t,!1,i)},i.unmountComponentAtNode=function(e){if(!tc(e))throw Error(r(40));return!!e._reactRootContainer&&(_l((function(){ic(null,null,e,!1,(function(){e._reactRootContainer=null,e[Jn]=null}))})),!0)},i.unstable_batchedUpdates=fl,i.unstable_createPortal=function(e,t){return nc(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},i.unstable_renderSubtreeIntoContainer=function(e,t,i,n){if(!tc(i))throw Error(r(200));if(null==e||void 0===e._reactInternals)throw Error(r(38));return ic(e,t,i,!1,n)},i.version="17.0.2"},{"object-assign":218,react:255,scheduler:259}],223:[function(e,t,i){"use strict";(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}})(),t.exports=e("./cjs/react-dom.production.min.js")},{"./cjs/react-dom.production.min.js":222}],224:[function(e,t,i){"use strict";var n="function"==typeof Symbol&&Symbol.for,s=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,r=n?Symbol.for("react.fragment"):60107,a=n?Symbol.for("react.strict_mode"):60108,l=n?Symbol.for("react.profiler"):60114,c=n?Symbol.for("react.provider"):60109,u=n?Symbol.for("react.context"):60110,h=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,p=n?Symbol.for("react.forward_ref"):60112,g=n?Symbol.for("react.suspense"):60113,m=n?Symbol.for("react.suspense_list"):60120,f=n?Symbol.for("react.memo"):60115,_=n?Symbol.for("react.lazy"):60116,T=n?Symbol.for("react.block"):60121,E=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,I=n?Symbol.for("react.scope"):60119;function y(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case s:switch(e=e.type){case h:case d:case r:case l:case a:case g:return e;default:switch(e=e&&e.$$typeof){case u:case p:case _:case f:case c:return e;default:return t}}case o:return t}}}function v(e){return y(e)===d}i.AsyncMode=h,i.ConcurrentMode=d,i.ContextConsumer=u,i.ContextProvider=c,i.Element=s,i.ForwardRef=p,i.Fragment=r,i.Lazy=_,i.Memo=f,i.Portal=o,i.Profiler=l,i.StrictMode=a,i.Suspense=g,i.isAsyncMode=function(e){return v(e)||y(e)===h},i.isConcurrentMode=v,i.isContextConsumer=function(e){return y(e)===u},i.isContextProvider=function(e){return y(e)===c},i.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===s},i.isForwardRef=function(e){return y(e)===p},i.isFragment=function(e){return y(e)===r},i.isLazy=function(e){return y(e)===_},i.isMemo=function(e){return y(e)===f},i.isPortal=function(e){return y(e)===o},i.isProfiler=function(e){return y(e)===l},i.isStrictMode=function(e){return y(e)===a},i.isSuspense=function(e){return y(e)===g},i.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===d||e===l||e===a||e===g||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===_||e.$$typeof===f||e.$$typeof===c||e.$$typeof===u||e.$$typeof===p||e.$$typeof===E||e.$$typeof===b||e.$$typeof===I||e.$$typeof===T)},i.typeOf=y},{}],225:[function(e,t,i){"use strict";t.exports=e("./cjs/react-is.production.min.js")},{"./cjs/react-is.production.min.js":224}],226:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=i.ReactReduxContext=void 0;var s=n(e("react")).default.createContext(null);i.ReactReduxContext=s;var o=s;i.default=o},{"@babel/runtime/helpers/interopRequireDefault":192,react:255}],227:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault").default,s=e("@babel/runtime/helpers/interopRequireWildcard").default;i.__esModule=!0,i.default=void 0;var o=s(e("react")),r=(n(e("prop-types")),e("./Context")),a=e("../utils/Subscription"),l=e("../utils/useIsomorphicLayoutEffect");var c=function(e){var t=e.store,i=e.context,n=e.children,s=(0,o.useMemo)((function(){var e=(0,a.createSubscription)(t);return{store:t,subscription:e}}),[t]),c=(0,o.useMemo)((function(){return t.getState()}),[t]);(0,l.useIsomorphicLayoutEffect)((function(){var e=s.subscription;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),c!==t.getState()&&e.notifyNestedSubs(),function(){e.tryUnsubscribe(),e.onStateChange=null}}),[s,c]);var u=i||r.ReactReduxContext;return o.default.createElement(u.Provider,{value:s},n)};i.default=c},{"../utils/Subscription":242,"../utils/useIsomorphicLayoutEffect":248,"./Context":226,"@babel/runtime/helpers/interopRequireDefault":192,"@babel/runtime/helpers/interopRequireWildcard":193,"prop-types":220,react:255}],228:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault").default,s=e("@babel/runtime/helpers/interopRequireWildcard").default;i.__esModule=!0,i.default=function(e,t){void 0===t&&(t={});var i=t,n=i.getDisplayName,s=void 0===n?function(e){return"ConnectAdvanced("+e+")"}:n,h=i.methodName,y=void 0===h?"connectAdvanced":h,v=i.renderCountProp,C=void 0===v?void 0:v,k=i.shouldHandleStateChanges,O=void 0===k||k,N=i.storeKey,A=void 0===N?"store":N,S=(i.withRef,i.forwardRef),R=void 0!==S&&S,w=i.context,L=void 0===w?d.ReactReduxContext:w,x=(0,r.default)(i,p),$=L;return function(t){var i=t.displayName||t.name||"Component",n=s(i),h=(0,o.default)({},x,{getDisplayName:s,methodName:y,renderCountProp:C,shouldHandleStateChanges:O,storeKey:A,displayName:n,wrappedComponentName:i,WrappedComponent:t}),d=x.pure,p=d?l.useMemo:function(e){return e()};function v(i){var n=(0,l.useMemo)((function(){var e=i.reactReduxForwardedRef,t=(0,r.default)(i,g);return[i.context,e,t]}),[i]),s=n[0],a=n[1],d=n[2],y=(0,l.useMemo)((function(){return s&&s.Consumer&&(0,c.isContextConsumer)(l.default.createElement(s.Consumer,null))?s:$}),[s,$]),v=(0,l.useContext)(y),C=Boolean(i.store)&&Boolean(i.store.getState)&&Boolean(i.store.dispatch);Boolean(v)&&Boolean(v.store);var k=C?i.store:v.store,N=(0,l.useMemo)((function(){return function(t){return e(t.dispatch,h)}(k)}),[k]),A=(0,l.useMemo)((function(){if(!O)return f;var e=(0,u.createSubscription)(k,C?null:v.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[k,C,v]),S=A[0],R=A[1],w=(0,l.useMemo)((function(){return C?v:(0,o.default)({},v,{subscription:S})}),[C,v,S]),L=(0,l.useReducer)(_,m,I),x=L[0][0],D=L[1];if(x&&x.error)throw x.error;var M=(0,l.useRef)(),P=(0,l.useRef)(d),B=(0,l.useRef)(),F=(0,l.useRef)(!1),U=p((function(){return B.current&&d===P.current?B.current:N(k.getState(),d)}),[k,x,d]);T(E,[P,M,F,d,U,B,R]),T(b,[O,k,S,N,P,M,F,B,R,D],[k,S,N]);var H=(0,l.useMemo)((function(){return l.default.createElement(t,(0,o.default)({},U,{ref:a}))}),[a,t,U]);return(0,l.useMemo)((function(){return O?l.default.createElement(y.Provider,{value:w},H):H}),[y,H,w])}var k=d?l.default.memo(v):v;if(k.WrappedComponent=t,k.displayName=v.displayName=n,R){var N=l.default.forwardRef((function(e,t){return l.default.createElement(k,(0,o.default)({},e,{reactReduxForwardedRef:t}))}));return N.displayName=n,N.WrappedComponent=t,(0,a.default)(N,t)}return(0,a.default)(k,t)}};var o=n(e("@babel/runtime/helpers/extends")),r=n(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),a=n(e("hoist-non-react-statics")),l=s(e("react")),c=e("react-is"),u=e("../utils/Subscription"),h=e("../utils/useIsomorphicLayoutEffect"),d=e("./Context"),p=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],g=["reactReduxForwardedRef"],m=[],f=[null,null];function _(e,t){var i=e[1];return[t.payload,i+1]}function T(e,t,i){(0,h.useIsomorphicLayoutEffect)((function(){return e.apply(void 0,t)}),i)}function E(e,t,i,n,s,o,r){e.current=n,t.current=s,i.current=!1,o.current&&(o.current=null,r())}function b(e,t,i,n,s,o,r,a,l,c){if(e){var u=!1,h=null,d=function(){if(!u){var e,i,d=t.getState();try{e=n(d,s.current)}catch(e){i=e,h=e}i||(h=null),e===o.current?r.current||l():(o.current=e,a.current=e,r.current=!0,c({type:"STORE_UPDATED",payload:{error:i}}))}};return i.onStateChange=d,i.trySubscribe(),d(),function(){if(u=!0,i.tryUnsubscribe(),i.onStateChange=null,h)throw h}}}var I=function(){return[null,0]}},{"../utils/Subscription":242,"../utils/useIsomorphicLayoutEffect":248,"./Context":226,"@babel/runtime/helpers/extends":191,"@babel/runtime/helpers/interopRequireDefault":192,"@babel/runtime/helpers/interopRequireWildcard":193,"@babel/runtime/helpers/objectWithoutPropertiesLoose":195,"hoist-non-react-statics":217,react:255,"react-is":252}],229:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.createConnect=m,i.default=void 0;var s=n(e("@babel/runtime/helpers/extends")),o=n(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),r=n(e("../components/connectAdvanced")),a=n(e("../utils/shallowEqual")),l=n(e("./mapDispatchToProps")),c=n(e("./mapStateToProps")),u=n(e("./mergeProps")),h=n(e("./selectorFactory")),d=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function p(e,t,i){for(var n=t.length-1;n>=0;n--){var s=t[n](e);if(s)return s}return function(t,n){throw new Error("Invalid value of type "+typeof e+" for "+i+" argument when connecting component "+n.wrappedComponentName+".")}}function g(e,t){return e===t}function m(e){var t=void 0===e?{}:e,i=t.connectHOC,n=void 0===i?r.default:i,m=t.mapStateToPropsFactories,f=void 0===m?c.default:m,_=t.mapDispatchToPropsFactories,T=void 0===_?l.default:_,E=t.mergePropsFactories,b=void 0===E?u.default:E,I=t.selectorFactory,y=void 0===I?h.default:I;return function(e,t,i,r){void 0===r&&(r={});var l=r,c=l.pure,u=void 0===c||c,h=l.areStatesEqual,m=void 0===h?g:h,_=l.areOwnPropsEqual,E=void 0===_?a.default:_,I=l.areStatePropsEqual,v=void 0===I?a.default:I,C=l.areMergedPropsEqual,k=void 0===C?a.default:C,O=(0,o.default)(l,d),N=p(e,f,"mapStateToProps"),A=p(t,T,"mapDispatchToProps"),S=p(i,b,"mergeProps");return n(y,(0,s.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:N,initMapDispatchToProps:A,initMergeProps:S,pure:u,areStatesEqual:m,areOwnPropsEqual:E,areStatePropsEqual:v,areMergedPropsEqual:k},O))}}var f=m();i.default=f},{"../components/connectAdvanced":228,"../utils/shallowEqual":247,"./mapDispatchToProps":230,"./mapStateToProps":231,"./mergeProps":232,"./selectorFactory":233,"@babel/runtime/helpers/extends":191,"@babel/runtime/helpers/interopRequireDefault":192,"@babel/runtime/helpers/objectWithoutPropertiesLoose":195}],230:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=void 0,i.whenMapDispatchToPropsIsFunction=r,i.whenMapDispatchToPropsIsMissing=a,i.whenMapDispatchToPropsIsObject=l;var s=n(e("../utils/bindActionCreators")),o=e("./wrapMapToProps");function r(e){return"function"==typeof e?(0,o.wrapMapToPropsFunc)(e,"mapDispatchToProps"):void 0}function a(e){return e?void 0:(0,o.wrapMapToPropsConstant)((function(e){return{dispatch:e}}))}function l(e){return e&&"object"==typeof e?(0,o.wrapMapToPropsConstant)((function(t){return(0,s.default)(e,t)})):void 0}var c=[r,a,l];i.default=c},{"../utils/bindActionCreators":244,"./wrapMapToProps":235,"@babel/runtime/helpers/interopRequireDefault":192}],231:[function(e,t,i){"use strict";i.__esModule=!0,i.default=void 0,i.whenMapStateToPropsIsFunction=s,i.whenMapStateToPropsIsMissing=o;var n=e("./wrapMapToProps");function s(e){return"function"==typeof e?(0,n.wrapMapToPropsFunc)(e,"mapStateToProps"):void 0}function o(e){return e?void 0:(0,n.wrapMapToPropsConstant)((function(){return{}}))}var r=[s,o];i.default=r},{"./wrapMapToProps":235}],232:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=void 0,i.defaultMergeProps=o,i.whenMergePropsIsFunction=a,i.whenMergePropsIsOmitted=l,i.wrapMergePropsFunc=r;var s=n(e("@babel/runtime/helpers/extends"));n(e("../utils/verifyPlainObject"));function o(e,t,i){return(0,s.default)({},i,e,t)}function r(e){return function(t,i){i.displayName;var n,s=i.pure,o=i.areMergedPropsEqual,r=!1;return function(t,i,a){var l=e(t,i,a);return r?s&&o(l,n)||(n=l):(r=!0,n=l),n}}}function a(e){return"function"==typeof e?r(e):void 0}function l(e){return e?void 0:function(){return o}}var c=[a,l];i.default=c},{"../utils/verifyPlainObject":249,"@babel/runtime/helpers/extends":191,"@babel/runtime/helpers/interopRequireDefault":192}],233:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=function(e,t){var i=t.initMapStateToProps,n=t.initMapDispatchToProps,l=t.initMergeProps,c=(0,s.default)(t,o),u=i(e,c),h=n(e,c),d=l(e,c);return(c.pure?a:r)(u,h,d,e,c)},i.impureFinalPropsSelectorFactory=r,i.pureFinalPropsSelectorFactory=a;var s=n(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),o=(n(e("./verifySubselectors")),["initMapStateToProps","initMapDispatchToProps","initMergeProps"]);function r(e,t,i,n){return function(s,o){return i(e(s,o),t(n,o),o)}}function a(e,t,i,n,s){var o,r,a,l,c,u=s.areStatesEqual,h=s.areOwnPropsEqual,d=s.areStatePropsEqual,p=!1;function g(s,p){var g,m,f=!h(p,r),_=!u(s,o,p,r);return o=s,r=p,f&&_?(a=e(o,r),t.dependsOnOwnProps&&(l=t(n,r)),c=i(a,l,r)):f?(e.dependsOnOwnProps&&(a=e(o,r)),t.dependsOnOwnProps&&(l=t(n,r)),c=i(a,l,r)):_?(g=e(o,r),m=!d(g,a),a=g,m&&(c=i(a,l,r)),c):c}return function(s,u){return p?g(s,u):(a=e(o=s,r=u),l=t(n,r),c=i(a,l,r),p=!0,c)}}},{"./verifySubselectors":234,"@babel/runtime/helpers/interopRequireDefault":192,"@babel/runtime/helpers/objectWithoutPropertiesLoose":195}],234:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=function(e,t,i,n){o(e,"mapStateToProps",n),o(t,"mapDispatchToProps",n),o(i,"mergeProps",n)};var s=n(e("../utils/warning"));function o(e,t,i){if(!e)throw new Error("Unexpected value for "+t+" in "+i+".");"mapStateToProps"!==t&&"mapDispatchToProps"!==t||Object.prototype.hasOwnProperty.call(e,"dependsOnOwnProps")||(0,s.default)("The selector for "+t+" of "+i+" did not specify a value for dependsOnOwnProps.")}},{"../utils/warning":250,"@babel/runtime/helpers/interopRequireDefault":192}],235:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.getDependsOnOwnProps=s,i.wrapMapToPropsConstant=function(e){return function(t,i){var n=e(t,i);function s(){return n}return s.dependsOnOwnProps=!1,s}},i.wrapMapToPropsFunc=function(e,t){return function(t,i){i.displayName;var n=function(e,t){return n.dependsOnOwnProps?n.mapToProps(e,t):n.mapToProps(e)};return n.dependsOnOwnProps=!0,n.mapToProps=function(t,i){n.mapToProps=e,n.dependsOnOwnProps=s(e);var o=n(t,i);return"function"==typeof o&&(n.mapToProps=o,n.dependsOnOwnProps=s(o),o=n(t,i)),o},n}};n(e("../utils/verifyPlainObject"));function s(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}},{"../utils/verifyPlainObject":249,"@babel/runtime/helpers/interopRequireDefault":192}],236:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0;var s=n(e("./components/Provider"));i.Provider=s.default;var o=n(e("./components/connectAdvanced"));i.connectAdvanced=o.default;var r=e("./components/Context");i.ReactReduxContext=r.ReactReduxContext;var a=n(e("./connect/connect"));i.connect=a.default;var l=e("./hooks/useDispatch");i.useDispatch=l.useDispatch,i.createDispatchHook=l.createDispatchHook;var c=e("./hooks/useSelector");i.useSelector=c.useSelector,i.createSelectorHook=c.createSelectorHook;var u=e("./hooks/useStore");i.useStore=u.useStore,i.createStoreHook=u.createStoreHook;var h=n(e("./utils/shallowEqual"));i.shallowEqual=h.default},{"./components/Context":226,"./components/Provider":227,"./components/connectAdvanced":228,"./connect/connect":229,"./hooks/useDispatch":237,"./hooks/useSelector":239,"./hooks/useStore":240,"./utils/shallowEqual":247,"@babel/runtime/helpers/interopRequireDefault":192}],237:[function(e,t,i){"use strict";i.__esModule=!0,i.createDispatchHook=o,i.useDispatch=void 0;var n=e("../components/Context"),s=e("./useStore");function o(e){void 0===e&&(e=n.ReactReduxContext);var t=e===n.ReactReduxContext?s.useStore:(0,s.createStoreHook)(e);return function(){return t().dispatch}}var r=o();i.useDispatch=r},{"../components/Context":226,"./useStore":240}],238:[function(e,t,i){"use strict";i.__esModule=!0,i.useReduxContext=function(){return(0,n.useContext)(s.ReactReduxContext)};var n=e("react"),s=e("../components/Context")},{"../components/Context":226,react:255}],239:[function(e,t,i){"use strict";i.__esModule=!0,i.createSelectorHook=c,i.useSelector=void 0;var n=e("react"),s=e("./useReduxContext"),o=e("../utils/Subscription"),r=e("../utils/useIsomorphicLayoutEffect"),a=e("../components/Context"),l=function(e,t){return e===t};function c(e){void 0===e&&(e=a.ReactReduxContext);var t=e===a.ReactReduxContext?s.useReduxContext:function(){return(0,n.useContext)(e)};return function(e,i){void 0===i&&(i=l);var s=t(),a=function(e,t,i,s){var a,l=(0,n.useReducer)((function(e){return e+1}),0)[1],c=(0,n.useMemo)((function(){return(0,o.createSubscription)(i,s)}),[i,s]),u=(0,n.useRef)(),h=(0,n.useRef)(),d=(0,n.useRef)(),p=(0,n.useRef)(),g=i.getState();try{if(e!==h.current||g!==d.current||u.current){var m=e(g);a=void 0!==p.current&&t(m,p.current)?p.current:m}else a=p.current}catch(e){throw u.current&&(e.message+="\nThe error may be correlated with this previous error:\n"+u.current.stack+"\n\n"),e}return(0,r.useIsomorphicLayoutEffect)((function(){h.current=e,d.current=g,p.current=a,u.current=void 0})),(0,r.useIsomorphicLayoutEffect)((function(){function e(){try{var e=i.getState();if(e===d.current)return;var n=h.current(e);if(t(n,p.current))return;p.current=n,d.current=e}catch(e){u.current=e}l()}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}}),[i,c]),a}(e,i,s.store,s.subscription);return(0,n.useDebugValue)(a),a}}var u=c();i.useSelector=u},{"../components/Context":226,"../utils/Subscription":242,"../utils/useIsomorphicLayoutEffect":248,"./useReduxContext":238,react:255}],240:[function(e,t,i){"use strict";i.__esModule=!0,i.createStoreHook=r,i.useStore=void 0;var n=e("react"),s=e("../components/Context"),o=e("./useReduxContext");function r(e){void 0===e&&(e=s.ReactReduxContext);var t=e===s.ReactReduxContext?o.useReduxContext:function(){return(0,n.useContext)(e)};return function(){return t().store}}var a=r();i.useStore=a},{"../components/Context":226,"./useReduxContext":238,react:255}],241:[function(e,t,i){"use strict";i.__esModule=!0;var n={batch:!0},s=e("./exports");Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in i&&i[e]===s[e]||(i[e]=s[e]))}));var o=e("./utils/reactBatchedUpdates");i.batch=o.unstable_batchedUpdates,(0,e("./utils/batch").setBatch)(o.unstable_batchedUpdates)},{"./exports":236,"./utils/batch":243,"./utils/reactBatchedUpdates":246}],242:[function(e,t,i){"use strict";i.__esModule=!0,i.createSubscription=function(e,t){var i,o=s;function r(){l.onStateChange&&l.onStateChange()}function a(){i||(i=t?t.addNestedSub(r):e.subscribe(r),o=function(){var e=(0,n.getBatch)(),t=null,i=null;return{clear:function(){t=null,i=null},notify:function(){e((function(){for(var e=t;e;)e.callback(),e=e.next}))},get:function(){for(var e=[],i=t;i;)e.push(i),i=i.next;return e},subscribe:function(e){var n=!0,s=i={callback:e,next:null,prev:i};return s.prev?s.prev.next=s:t=s,function(){n&&null!==t&&(n=!1,s.next?s.next.prev=s.prev:i=s.prev,s.prev?s.prev.next=s.next:t=s.next)}}}}())}var l={addNestedSub:function(e){return a(),o.subscribe(e)},notifyNestedSubs:function(){o.notify()},handleChangeWrapper:r,isSubscribed:function(){return Boolean(i)},trySubscribe:a,tryUnsubscribe:function(){i&&(i(),i=void 0,o.clear(),o=s)},getListeners:function(){return o}};return l};var n=e("./batch");var s={notify:function(){},get:function(){return[]}}},{"./batch":243}],243:[function(e,t,i){"use strict";i.__esModule=!0,i.setBatch=i.getBatch=void 0;var n=function(e){e()};i.setBatch=function(e){return n=e};i.getBatch=function(){return n}},{}],244:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e,t){var i={},n=function(n){var s=e[n];"function"==typeof s&&(i[n]=function(){return t(s.apply(void 0,arguments))})};for(var s in e)n(s);return i}},{}],245:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){if("object"!=typeof e||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var i=t;null!==Object.getPrototypeOf(i);)i=Object.getPrototypeOf(i);return t===i}},{}],246:[function(e,t,i){"use strict";i.__esModule=!0,i.unstable_batchedUpdates=void 0;var n=e("react-dom");i.unstable_batchedUpdates=n.unstable_batchedUpdates},{"react-dom":223}],247:[function(e,t,i){"use strict";function n(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}i.__esModule=!0,i.default=function(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(var o=0;o<i.length;o++)if(!Object.prototype.hasOwnProperty.call(t,i[o])||!n(e[i[o]],t[i[o]]))return!1;return!0}},{}],248:[function(e,t,i){"use strict";i.__esModule=!0,i.useIsomorphicLayoutEffect=void 0;var n=e("react"),s="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?n.useLayoutEffect:n.useEffect;i.useIsomorphicLayoutEffect=s},{react:255}],249:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=function(e,t,i){(0,s.default)(e)||(0,o.default)(i+"() in "+t+" must return a plain object. Instead received "+e+".")};var s=n(e("./isPlainObject")),o=n(e("./warning"))},{"./isPlainObject":245,"./warning":250,"@babel/runtime/helpers/interopRequireDefault":192}],250:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},{}],251:[function(e,t,i){"use strict";var n=60103,s=60106,o=60107,r=60108,a=60114,l=60109,c=60110,u=60112,h=60113,d=60120,p=60115,g=60116,m=60121,f=60122,_=60117,T=60129,E=60131;if("function"==typeof Symbol&&Symbol.for){var b=Symbol.for;n=b("react.element"),s=b("react.portal"),o=b("react.fragment"),r=b("react.strict_mode"),a=b("react.profiler"),l=b("react.provider"),c=b("react.context"),u=b("react.forward_ref"),h=b("react.suspense"),d=b("react.suspense_list"),p=b("react.memo"),g=b("react.lazy"),m=b("react.block"),f=b("react.server.block"),_=b("react.fundamental"),T=b("react.debug_trace_mode"),E=b("react.legacy_hidden")}function I(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case o:case a:case r:case h:case d:return e;default:switch(e=e&&e.$$typeof){case c:case u:case g:case p:case l:return e;default:return t}}case s:return t}}}var y=l,v=n,C=u,k=o,O=g,N=p,A=s,S=a,R=r,w=h;i.ContextConsumer=c,i.ContextProvider=y,i.Element=v,i.ForwardRef=C,i.Fragment=k,i.Lazy=O,i.Memo=N,i.Portal=A,i.Profiler=S,i.StrictMode=R,i.Suspense=w,i.isAsyncMode=function(){return!1},i.isConcurrentMode=function(){return!1},i.isContextConsumer=function(e){return I(e)===c},i.isContextProvider=function(e){return I(e)===l},i.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},i.isForwardRef=function(e){return I(e)===u},i.isFragment=function(e){return I(e)===o},i.isLazy=function(e){return I(e)===g},i.isMemo=function(e){return I(e)===p},i.isPortal=function(e){return I(e)===s},i.isProfiler=function(e){return I(e)===a},i.isStrictMode=function(e){return I(e)===r},i.isSuspense=function(e){return I(e)===h},i.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===a||e===T||e===r||e===h||e===d||e===E||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===p||e.$$typeof===l||e.$$typeof===c||e.$$typeof===u||e.$$typeof===_||e.$$typeof===m||e[0]===f)},i.typeOf=I},{}],252:[function(e,t,i){"use strict";t.exports=e("./cjs/react-is.production.min.js")},{"./cjs/react-is.production.min.js":251}],253:[function(e,t,i){"use strict";e("object-assign");var n=e("react"),s=60103;if(i.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var o=Symbol.for;s=o("react.element"),i.Fragment=o("react.fragment")}var r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var n,o={},c=null,u=null;for(n in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,n)&&!l.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:s,type:e,key:c,ref:u,props:o,_owner:r.current}}i.jsx=c,i.jsxs=c},{"object-assign":218,react:255}],254:[function(e,t,i){"use strict";var n=e("object-assign"),s=60103,o=60106;i.Fragment=60107,i.StrictMode=60108,i.Profiler=60114;var r=60109,a=60110,l=60112;i.Suspense=60113;var c=60115,u=60116;if("function"==typeof Symbol&&Symbol.for){var h=Symbol.for;s=h("react.element"),o=h("react.portal"),i.Fragment=h("react.fragment"),i.StrictMode=h("react.strict_mode"),i.Profiler=h("react.profiler"),r=h("react.provider"),a=h("react.context"),l=h("react.forward_ref"),i.Suspense=h("react.suspense"),c=h("react.memo"),u=h("react.lazy")}var d="function"==typeof Symbol&&Symbol.iterator;function p(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m={};function f(e,t,i){this.props=e,this.context=t,this.refs=m,this.updater=i||g}function _(){}function T(e,t,i){this.props=e,this.context=t,this.refs=m,this.updater=i||g}f.prototype.isReactComponent={},f.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(p(85));this.updater.enqueueSetState(this,e,t,"setState")},f.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=f.prototype;var E=T.prototype=new _;E.constructor=T,n(E,f.prototype),E.isPureReactComponent=!0;var b={current:null},I=Object.prototype.hasOwnProperty,y={key:!0,ref:!0,__self:!0,__source:!0};function v(e,t,i){var n,o={},r=null,a=null;if(null!=t)for(n in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(r=""+t.key),t)I.call(t,n)&&!y.hasOwnProperty(n)&&(o[n]=t[n]);var l=arguments.length-2;if(1===l)o.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps)void 0===o[n]&&(o[n]=l[n]);return{$$typeof:s,type:e,key:r,ref:a,props:o,_owner:b.current}}function C(e){return"object"==typeof e&&null!==e&&e.$$typeof===s}var k=/\/+/g;function O(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function N(e,t,i,n,r){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case s:case o:l=!0}}if(l)return r=r(l=e),e=""===n?"."+O(l,0):n,Array.isArray(r)?(i="",null!=e&&(i=e.replace(k,"$&/")+"/"),N(r,t,i,"",(function(e){return e}))):null!=r&&(C(r)&&(r=function(e,t){return{$$typeof:s,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(r,i+(!r.key||l&&l.key===r.key?"":(""+r.key).replace(k,"$&/")+"/")+e)),t.push(r)),1;if(l=0,n=""===n?".":n+":",Array.isArray(e))for(var c=0;c<e.length;c++){var u=n+O(a=e[c],c);l+=N(a,t,i,u,r)}else if("function"==typeof(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e)))for(e=u.call(e),c=0;!(a=e.next()).done;)l+=N(a=a.value,t,i,u=n+O(a,c++),r);else if("object"===a)throw t=""+e,Error(p(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function A(e,t,i){if(null==e)return e;var n=[],s=0;return N(e,n,"","",(function(e){return t.call(i,e,s++)})),n}function S(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var R={current:null};function w(){var e=R.current;if(null===e)throw Error(p(321));return e}var L={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:b,IsSomeRendererActing:{current:!1},assign:n};i.Children={map:A,forEach:function(e,t,i){A(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error(p(143));return e}},i.Component=f,i.PureComponent=T,i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,i.cloneElement=function(e,t,i){if(null==e)throw Error(p(267,e));var o=n({},e.props),r=e.key,a=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,l=b.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)I.call(t,u)&&!y.hasOwnProperty(u)&&(o[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)o.children=i;else if(1<u){c=Array(u);for(var h=0;h<u;h++)c[h]=arguments[h+2];o.children=c}return{$$typeof:s,type:e.type,key:r,ref:a,props:o,_owner:l}},i.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:a,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:r,_context:e},e.Consumer=e},i.createElement=v,i.createFactory=function(e){var t=v.bind(null,e);return t.type=e,t},i.createRef=function(){return{current:null}},i.forwardRef=function(e){return{$$typeof:l,render:e}},i.isValidElement=C,i.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:S}},i.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},i.useCallback=function(e,t){return w().useCallback(e,t)},i.useContext=function(e,t){return w().useContext(e,t)},i.useDebugValue=function(){},i.useEffect=function(e,t){return w().useEffect(e,t)},i.useImperativeHandle=function(e,t,i){return w().useImperativeHandle(e,t,i)},i.useLayoutEffect=function(e,t){return w().useLayoutEffect(e,t)},i.useMemo=function(e,t){return w().useMemo(e,t)},i.useReducer=function(e,t,i){return w().useReducer(e,t,i)},i.useRef=function(e){return w().useRef(e)},i.useState=function(e){return w().useState(e)},i.version="17.0.2"},{"object-assign":218}],255:[function(e,t,i){"use strict";t.exports=e("./cjs/react.production.min.js")},{"./cjs/react.production.min.js":254}],256:[function(e,t,i){"use strict";t.exports=e("./cjs/react-jsx-runtime.production.min.js")},{"./cjs/react-jsx-runtime.production.min.js":253}],257:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("@babel/runtime/helpers/objectSpread2");var s,o=(s=n)&&"object"==typeof s&&"default"in s?s:{default:s};function r(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var a="function"==typeof Symbol&&Symbol.observable||"@@observable",l=function(){return Math.random().toString(36).substring(7).split("").join(".")},c={INIT:"@@redux/INIT"+l(),REPLACE:"@@redux/REPLACE"+l(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+l()}};function u(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function h(e,t,i){var n;if("function"==typeof t&&"function"==typeof i||"function"==typeof i&&"function"==typeof arguments[3])throw new Error(r(0));if("function"==typeof t&&void 0===i&&(i=t,t=void 0),void 0!==i){if("function"!=typeof i)throw new Error(r(1));return i(h)(e,t)}if("function"!=typeof e)throw new Error(r(2));var s=e,o=t,l=[],d=l,p=!1;function g(){d===l&&(d=l.slice())}function m(){if(p)throw new Error(r(3));return o}function f(e){if("function"!=typeof e)throw new Error(r(4));if(p)throw new Error(r(5));var t=!0;return g(),d.push(e),function(){if(t){if(p)throw new Error(r(6));t=!1,g();var i=d.indexOf(e);d.splice(i,1),l=null}}}function _(e){if(!u(e))throw new Error(r(7));if(void 0===e.type)throw new Error(r(8));if(p)throw new Error(r(9));try{p=!0,o=s(o,e)}finally{p=!1}for(var t=l=d,i=0;i<t.length;i++)(0,t[i])();return e}return _({type:c.INIT}),(n={dispatch:_,subscribe:f,getState:m,replaceReducer:function(e){if("function"!=typeof e)throw new Error(r(10));s=e,_({type:c.REPLACE})}})[a]=function(){var e,t=f;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(r(11));function i(){e.next&&e.next(m())}return i(),{unsubscribe:t(i)}}})[a]=function(){return this},e},n}var d=h;function p(e,t){return function(){return t(e.apply(this,arguments))}}function g(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}i.__DO_NOT_USE__ActionTypes=c,i.applyMiddleware=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return function(){var i=e.apply(void 0,arguments),n=function(){throw new Error(r(15))},s={getState:i.getState,dispatch:function(){return n.apply(void 0,arguments)}},a=t.map((function(e){return e(s)}));return n=g.apply(void 0,a)(i.dispatch),o.default(o.default({},i),{},{dispatch:n})}}},i.bindActionCreators=function(e,t){if("function"==typeof e)return p(e,t);if("object"!=typeof e||null===e)throw new Error(r(16));var i={};for(var n in e){var s=e[n];"function"==typeof s&&(i[n]=p(s,t))}return i},i.combineReducers=function(e){for(var t=Object.keys(e),i={},n=0;n<t.length;n++){var s=t[n];"function"==typeof e[s]&&(i[s]=e[s])}var o,a=Object.keys(i);try{!function(e){Object.keys(e).forEach((function(t){var i=e[t];if(void 0===i(void 0,{type:c.INIT}))throw new Error(r(12));if(void 0===i(void 0,{type:c.PROBE_UNKNOWN_ACTION()}))throw new Error(r(13))}))}(i)}catch(e){o=e}return function(e,t){if(void 0===e&&(e={}),o)throw o;for(var n=!1,s={},l=0;l<a.length;l++){var c=a[l],u=i[c],h=e[c],d=u(h,t);if(void 0===d)throw t&&t.type,new Error(r(14));s[c]=d,n=n||d!==h}return(n=n||a.length!==Object.keys(e).length)?s:e}},i.compose=g,i.createStore=h,i.legacy_createStore=d},{"@babel/runtime/helpers/objectSpread2":194}],258:[function(e,t,i){"use strict";var n,s,o,r;if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;i.unstable_now=function(){return a.now()}}else{var l=Date,c=l.now();i.unstable_now=function(){return l.now()-c}}if("undefined"==typeof window||"function"!=typeof MessageChannel){var u=null,h=null,d=function(){if(null!==u)try{var e=i.unstable_now();u(!0,e),u=null}catch(e){throw setTimeout(d,0),e}};n=function(e){null!==u?setTimeout(n,0,e):(u=e,setTimeout(d,0))},s=function(e,t){h=setTimeout(e,t)},o=function(){clearTimeout(h)},i.unstable_shouldYield=function(){return!1},r=i.unstable_forceFrameRate=function(){}}else{var p=window.setTimeout,g=window.clearTimeout;if("undefined"!=typeof console){var m=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!=typeof m&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var f=!1,_=null,T=-1,E=5,b=0;i.unstable_shouldYield=function(){return i.unstable_now()>=b},r=function(){},i.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5};var I=new MessageChannel,y=I.port2;I.port1.onmessage=function(){if(null!==_){var e=i.unstable_now();b=e+E;try{_(!0,e)?y.postMessage(null):(f=!1,_=null)}catch(e){throw y.postMessage(null),e}}else f=!1},n=function(e){_=e,f||(f=!0,y.postMessage(null))},s=function(e,t){T=p((function(){e(i.unstable_now())}),t)},o=function(){g(T),T=-1}}function v(e,t){var i=e.length;e.push(t);e:for(;;){var n=i-1>>>1,s=e[n];if(!(void 0!==s&&0<O(s,t)))break e;e[n]=t,e[i]=s,i=n}}function C(e){return void 0===(e=e[0])?null:e}function k(e){var t=e[0];if(void 0!==t){var i=e.pop();if(i!==t){e[0]=i;e:for(var n=0,s=e.length;n<s;){var o=2*(n+1)-1,r=e[o],a=o+1,l=e[a];if(void 0!==r&&0>O(r,i))void 0!==l&&0>O(l,r)?(e[n]=l,e[a]=i,n=a):(e[n]=r,e[o]=i,n=o);else{if(!(void 0!==l&&0>O(l,i)))break e;e[n]=l,e[a]=i,n=a}}}return t}return null}function O(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}var N=[],A=[],S=1,R=null,w=3,L=!1,x=!1,$=!1;function D(e){for(var t=C(A);null!==t;){if(null===t.callback)k(A);else{if(!(t.startTime<=e))break;k(A),t.sortIndex=t.expirationTime,v(N,t)}t=C(A)}}function M(e){if($=!1,D(e),!x)if(null!==C(N))x=!0,n(P);else{var t=C(A);null!==t&&s(M,t.startTime-e)}}function P(e,t){x=!1,$&&($=!1,o()),L=!0;var n=w;try{for(D(t),R=C(N);null!==R&&(!(R.expirationTime>t)||e&&!i.unstable_shouldYield());){var r=R.callback;if("function"==typeof r){R.callback=null,w=R.priorityLevel;var a=r(R.expirationTime<=t);t=i.unstable_now(),"function"==typeof a?R.callback=a:R===C(N)&&k(N),D(t)}else k(N);R=C(N)}if(null!==R)var l=!0;else{var c=C(A);null!==c&&s(M,c.startTime-t),l=!1}return l}finally{R=null,w=n,L=!1}}var B=r;i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(e){e.callback=null},i.unstable_continueExecution=function(){x||L||(x=!0,n(P))},i.unstable_getCurrentPriorityLevel=function(){return w},i.unstable_getFirstCallbackNode=function(){return C(N)},i.unstable_next=function(e){switch(w){case 1:case 2:case 3:var t=3;break;default:t=w}var i=w;w=t;try{return e()}finally{w=i}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=B,i.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=w;w=e;try{return t()}finally{w=i}},i.unstable_scheduleCallback=function(e,t,r){var a=i.unstable_now();switch(r="object"==typeof r&&null!==r&&"number"==typeof(r=r.delay)&&0<r?a+r:a,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:S++,callback:t,priorityLevel:e,startTime:r,expirationTime:l=r+l,sortIndex:-1},r>a?(e.sortIndex=r,v(A,e),null===C(N)&&e===C(A)&&($?o():$=!0,s(M,r-a))):(e.sortIndex=l,v(N,e),x||L||(x=!0,n(P))),e},i.unstable_wrapCallback=function(e){var t=w;return function(){var i=w;w=t;try{return e.apply(this,arguments)}finally{w=i}}}},{}],259:[function(e,t,i){"use strict";t.exports=e("./cjs/scheduler.production.min.js")},{"./cjs/scheduler.production.min.js":258}]},{},[140]);